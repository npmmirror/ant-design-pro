(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[7567],{90829:function(Ze,H,R){"use strict";var Y=R(67294),J=R(75842),v=R(23185),te=R(4322),B=R(24770),Q=R(89182),ie=function(re,Ge){var Ce={};for(var tt in re)Object.prototype.hasOwnProperty.call(re,tt)&&Ge.indexOf(tt)<0&&(Ce[tt]=re[tt]);if(re!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Mt=0,tt=Object.getOwnPropertySymbols(re);Mt<tt.length;Mt++)Ge.indexOf(tt[Mt])<0&&Object.prototype.propertyIsEnumerable.call(re,tt[Mt])&&(Ce[tt[Mt]]=re[tt[Mt]]);return Ce},Ee=(0,Y.forwardRef)(function(re,Ge){var Ce=re.chartRef,tt=re.style,Mt=tt===void 0?{height:"inherit"}:tt,ir=re.className,bt=re.loading,qt=re.loadingTemplate,At=re.errorTemplate,ot=ie(re,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),ct=(0,v.Z)(J.TZ,ot),Qt=ct.chart,X=ct.container;return(0,Y.useEffect)(function(){(0,te.J)(Ce,Qt.current)},[Qt.current]),(0,Y.useImperativeHandle)(Ge,function(){return{getChart:function(){return Qt.current}}}),Y.createElement(B.Z,{errorTemplate:At},bt&&Y.createElement(Q.Z,{loadingTemplate:qt,theme:re.theme}),Y.createElement("div",{className:ir,style:Mt,ref:X}))});H.Z=Ee},93343:function(Ze,H,R){"use strict";var Y=R(67294),J=R(75842),v=R(23185),te=R(4322),B=R(24770),Q=R(89182),ie=function(re,Ge){var Ce={};for(var tt in re)Object.prototype.hasOwnProperty.call(re,tt)&&Ge.indexOf(tt)<0&&(Ce[tt]=re[tt]);if(re!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Mt=0,tt=Object.getOwnPropertySymbols(re);Mt<tt.length;Mt++)Ge.indexOf(tt[Mt])<0&&Object.prototype.propertyIsEnumerable.call(re,tt[Mt])&&(Ce[tt[Mt]]=re[tt[Mt]]);return Ce},Ee=(0,Y.forwardRef)(function(re,Ge){var Ce=re.chartRef,tt=re.style,Mt=tt===void 0?{height:"inherit"}:tt,ir=re.className,bt=re.loading,qt=re.loadingTemplate,At=re.errorTemplate,ot=ie(re,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),ct=(0,v.Z)(J.m,ot),Qt=ct.chart,X=ct.container;return(0,Y.useEffect)(function(){(0,te.J)(Ce,Qt.current)},[Qt.current]),(0,Y.useImperativeHandle)(Ge,function(){return{getChart:function(){return Qt.current}}}),Y.createElement(B.Z,{errorTemplate:At},bt&&Y.createElement(Q.Z,{loadingTemplate:qt,theme:re.theme}),Y.createElement("div",{className:ir,style:Mt,ref:X}))});H.Z=Ee},64335:function(Ze,H,R){"use strict";var Y=R(67294),J=(0,Y.createContext)({});H.Z=J},21349:function(Ze,H,R){"use strict";var Y=R(84305),J=R(39559),v=R(53645),te=R.n(v),B=R(67294),Q=R(94184),ie=R.n(Q),Ee=R(64335),re=function(Ce){var tt=(0,B.useContext)(Ee.Z),Mt=Ce.children,ir=Ce.contentWidth,bt=Ce.className,qt=Ce.style,At=(0,B.useContext)(J.ZP.ConfigContext),ot=At.getPrefixCls,ct=Ce.prefixCls||ot("pro"),Qt=ir||tt.contentWidth,X="".concat(ct,"-grid-content");return B.createElement("div",{className:ie()(X,bt,{wide:Qt==="Fixed"}),style:qt},B.createElement("div",{className:"".concat(ct,"-grid-content-children")},Mt))};H.Z=re},66213:function(Ze,H,R){"use strict";R.d(H,{Z:function(){return v}});var Y=R(77608);function J(te,B){for(;!Object.prototype.hasOwnProperty.call(te,B)&&(te=(0,Y.Z)(te),te!==null););return te}function v(){return typeof Reflect!="undefined"&&Reflect.get?v=Reflect.get:v=function(B,Q,ie){var Ee=J(B,Q);if(!!Ee){var re=Object.getOwnPropertyDescriptor(Ee,Q);return re.get?re.get.call(arguments.length<3?B:ie):re.value}},v.apply(this,arguments)}},31795:function(Ze,H,R){var Y=R(75752);Ze.exports.geometry=J,Ze.exports.ring=te;function J(Q){var ie=0,Ee;switch(Q.type){case"Polygon":return v(Q.coordinates);case"MultiPolygon":for(Ee=0;Ee<Q.coordinates.length;Ee++)ie+=v(Q.coordinates[Ee]);return ie;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(Ee=0;Ee<Q.geometries.length;Ee++)ie+=J(Q.geometries[Ee]);return ie}}function v(Q){var ie=0;if(Q&&Q.length>0){ie+=Math.abs(te(Q[0]));for(var Ee=1;Ee<Q.length;Ee++)ie-=Math.abs(te(Q[Ee]))}return ie}function te(Q){var ie,Ee,re,Ge,Ce,tt,Mt,ir=0,bt=Q.length;if(bt>2){for(Mt=0;Mt<bt;Mt++)Mt===bt-2?(Ge=bt-2,Ce=bt-1,tt=0):Mt===bt-1?(Ge=bt-1,Ce=0,tt=1):(Ge=Mt,Ce=Mt+1,tt=Mt+2),ie=Q[Ge],Ee=Q[Ce],re=Q[tt],ir+=(B(re[0])-B(ie[0]))*Math.sin(B(Ee[1]));ir=ir*Y.RADIUS*Y.RADIUS/2}return ir}function B(Q){return Q*Math.PI/180}},38163:function(Ze,H,R){var Y=R(31795);Ze.exports=J;function J(Ee,re){switch(Ee&&Ee.type||null){case"FeatureCollection":return Ee.features=Ee.features.map(v(J,re)),Ee;case"GeometryCollection":return Ee.geometries=Ee.geometries.map(v(J,re)),Ee;case"Feature":return Ee.geometry=J(Ee.geometry,re),Ee;case"Polygon":case"MultiPolygon":return te(Ee,re);default:return Ee}}function v(Ee,re){return function(Ge){return Ee(Ge,re)}}function te(Ee,re){return Ee.type==="Polygon"?Ee.coordinates=B(Ee.coordinates,re):Ee.type==="MultiPolygon"&&(Ee.coordinates=Ee.coordinates.map(v(B,re))),Ee}function B(Ee,re){re=!!re,Ee[0]=Q(Ee[0],re);for(var Ge=1;Ge<Ee.length;Ge++)Ee[Ge]=Q(Ee[Ge],!re);return Ee}function Q(Ee,re){return ie(Ee)===re?Ee:Ee.reverse()}function ie(Ee){return Y.ring(Ee)>=0}},70499:function(Ze){Ze.exports={activeChart:"activeChart___15gpK",activeChartGrid:"activeChartGrid___3PL4c",activeChartLegend:"activeChartLegend___2Ieyc",dashedLine:"dashedLine___2fgZX",line:"line___2cxqk"}},19134:function(Ze){Ze.exports={mapChart:"mapChart___4fQJB",pieCard:"pieCard___1ETZj"}},53645:function(){},37210:function(Ze,H,R){"use strict";R.r(H),R.d(H,{default:function(){return c5}});var Y={};R.r(Y),R.d(Y,{add:function(){return Ui},adjoint:function(){return zr},clone:function(){return Rr},copy:function(){return jr},create:function(){return Sr},determinant:function(){return hr},equals:function(){return Bt},exactEquals:function(){return Me},frob:function(){return ni},fromQuat:function(){return os},fromQuat2:function(){return $n},fromRotation:function(){return Jr},fromRotationTranslation:function(){return en},fromRotationTranslationScale:function(){return mo},fromRotationTranslationScaleOrigin:function(){return zi},fromScaling:function(){return $r},fromTranslation:function(){return wr},fromValues:function(){return Er},fromXRotation:function(){return yi},fromYRotation:function(){return ai},fromZRotation:function(){return qr},frustum:function(){return Ka},getRotation:function(){return co},getScaling:function(){return Ni},getTranslation:function(){return pi},identity:function(){return ut},invert:function(){return br},lookAt:function(){return Xo},mul:function(){return Ct},multiply:function(){return Ar},multiplyScalar:function(){return Po},multiplyScalarAndAdd:function(){return Sl},ortho:function(){return go},orthoNO:function(){return ss},orthoZO:function(){return _i},perspective:function(){return Eo},perspectiveFromFieldOfView:function(){return Wo},perspectiveNO:function(){return Ho},perspectiveZO:function(){return ts},rotate:function(){return tr},rotateX:function(){return ar},rotateY:function(){return _n},rotateZ:function(){return Gr},scale:function(){return On},set:function(){return Mr},str:function(){return us},sub:function(){return dn},subtract:function(){return fa},targetTo:function(){return na},translate:function(){return Vr},transpose:function(){return Xt}});var J=R(58024),v=R(39144),te=R(13062),B=R(71230),Q=R(89032),ie=R(15746),Ee=R(95300),re=R(7277),Ge=R(21010),Ce=R(67294),tt=R(75842),Mt=R(23185),ir=R(4322),bt=R(24770),qt=R(89182),At=function(e,i){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&i.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(e);a<n.length;a++)i.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(r[n[a]]=e[n[a]]);return r},ot=(0,Ce.forwardRef)(function(e,i){var r=e.chartRef,n=e.style,a=n===void 0?{height:"inherit"}:n,s=e.className,h=e.loading,m=e.loadingTemplate,y=e.errorTemplate,b=At(e,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),A=(0,Mt.Z)(tt.aC,b),P=A.chart,k=A.container;return(0,Ce.useEffect)(function(){(0,ir.J)(r,P.current)},[P.current]),(0,Ce.useImperativeHandle)(i,function(){return{getChart:function(){return P.current}}}),Ce.createElement(bt.Z,{errorTemplate:y},h&&Ce.createElement(qt.Z,{loadingTemplate:m,theme:e.theme}),Ce.createElement("div",{className:s,style:a,ref:k}))}),ct=ot,Qt=function(e,i){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&i.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(e);a<n.length;a++)i.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(r[n[a]]=e[n[a]]);return r},X=(0,Ce.forwardRef)(function(e,i){var r=e.chartRef,n=e.style,a=n===void 0?{height:"inherit"}:n,s=e.className,h=e.loading,m=e.loadingTemplate,y=e.errorTemplate,b=Qt(e,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),A=(0,Mt.Z)(tt.kB,b),P=A.chart,k=A.container;return(0,Ce.useEffect)(function(){(0,ir.J)(r,P.current)},[P.current]),(0,Ce.useImperativeHandle)(i,function(){return{getChart:function(){return P.current}}}),Ce.createElement(bt.Z,{errorTemplate:y},h&&Ce.createElement(qt.Z,{loadingTemplate:m,theme:e.theme}),Ce.createElement("div",{className:s,style:a,ref:k}))}),Kt=X,vt=function(e,i){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&i.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(e);a<n.length;a++)i.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(r[n[a]]=e[n[a]]);return r},qe=(0,Ce.forwardRef)(function(e,i){var r=e.chartRef,n=e.style,a=n===void 0?{height:"inherit"}:n,s=e.className,h=e.loading,m=e.loadingTemplate,y=e.errorTemplate,b=vt(e,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),A=(0,Mt.Z)(tt.Kj,b),P=A.chart,k=A.container;return(0,Ce.useEffect)(function(){(0,ir.J)(r,P.current)},[P.current]),(0,Ce.useImperativeHandle)(i,function(){return{getChart:function(){return P.current}}}),Ce.createElement(bt.Z,{errorTemplate:y},h&&Ce.createElement(qt.Z,{loadingTemplate:m,theme:e.theme}),Ce.createElement("div",{className:s,style:a,ref:k}))}),dt=qe,$e=R(90829),kt=R(21349),yr=R(92077),Pr=R.n(yr),Wr=R(2824),Te=R(3182),Ye=R(69610),De=R(54941),wt=R(81306),gt=R(19809),Ut=R(94043),Jt=R.n(Ut),Cr=(0,Ce.createContext)({});function Yn(){return(0,Ce.useContext)(Cr)}var hn={},qi={},jn=function(i){return qi[i]},Xn=function(i,r){qi[i]=r},vi=function(i){return hn[i]},qn=function(i,r){hn[i]=r},li={},aa={},Di=34,Ai=10,Vi=13;function la(e){return new Function("d","return {"+e.map(function(i,r){return JSON.stringify(i)+": d["+r+'] || ""'}).join(",")+"}")}function wi(e,i){var r=la(e);return function(n,a){return i(r(n),a,e)}}function Sa(e){var i=Object.create(null),r=[];return e.forEach(function(n){for(var a in n)a in i||r.push(i[a]=a)}),r}function Mn(e,i){var r=e+"",n=r.length;return n<i?new Array(i-n+1).join(0)+r:r}function Si(e){return e<0?"-"+Mn(-e,6):e>9999?"+"+Mn(e,6):Mn(e,4)}function ji(e){var i=e.getUTCHours(),r=e.getUTCMinutes(),n=e.getUTCSeconds(),a=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":Si(e.getUTCFullYear(),4)+"-"+Mn(e.getUTCMonth()+1,2)+"-"+Mn(e.getUTCDate(),2)+(a?"T"+Mn(i,2)+":"+Mn(r,2)+":"+Mn(n,2)+"."+Mn(a,3)+"Z":n?"T"+Mn(i,2)+":"+Mn(r,2)+":"+Mn(n,2)+"Z":r||i?"T"+Mn(i,2)+":"+Mn(r,2)+"Z":"")}function Ki(e){var i=new RegExp('["'+e+`
\r]`),r=e.charCodeAt(0);function n(P,k){var F,q,oe=a(P,function(ue,Pe){if(F)return F(ue,Pe-1);q=ue,F=k?wi(ue,k):la(ue)});return oe.columns=q||[],oe}function a(P,k){var F=[],q=P.length,oe=0,ue=0,Pe,et=q<=0,at=!1;P.charCodeAt(q-1)===Ai&&--q,P.charCodeAt(q-1)===Vi&&--q;function _t(){if(et)return aa;if(at)return at=!1,li;var Ht,nr=oe,mr;if(P.charCodeAt(nr)===Di){for(;oe++<q&&P.charCodeAt(oe)!==Di||P.charCodeAt(++oe)===Di;);return(Ht=oe)>=q?et=!0:(mr=P.charCodeAt(oe++))===Ai?at=!0:mr===Vi&&(at=!0,P.charCodeAt(oe)===Ai&&++oe),P.slice(nr+1,Ht-1).replace(/""/g,'"')}for(;oe<q;){if((mr=P.charCodeAt(Ht=oe++))===Ai)at=!0;else if(mr===Vi)at=!0,P.charCodeAt(oe)===Ai&&++oe;else if(mr!==r)continue;return P.slice(nr,Ht)}return et=!0,P.slice(nr,q)}for(;(Pe=_t())!==aa;){for(var Nt=[];Pe!==li&&Pe!==aa;)Nt.push(Pe),Pe=_t();k&&(Nt=k(Nt,ue++))==null||F.push(Nt)}return F}function s(P,k){return P.map(function(F){return k.map(function(q){return A(F[q])}).join(e)})}function h(P,k){return k==null&&(k=Sa(P)),[k.map(A).join(e)].concat(s(P,k)).join(`
`)}function m(P,k){return k==null&&(k=Sa(P)),s(P,k).join(`
`)}function y(P){return P.map(b).join(`
`)}function b(P){return P.map(A).join(e)}function A(P){return P==null?"":P instanceof Date?ji(P):i.test(P+="")?'"'+P.replace(/"/g,'""')+'"':P}return{parse:n,parseRows:a,format:h,formatBody:m,formatRows:y,formatRow:b,formatValue:A}}var Wa=Ki(","),ve=Wa.parse,Fn=Wa.parseRows,Xa=Wa.format,fs=Wa.formatBody,jt=Wa.formatRows,sr=Wa.formatRow,Tr=Wa.formatValue,I=R(96156),ur=R(85061),Ln=R(38163),ci=R.n(Ln);function Gn(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function rn(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Gn(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Gn(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Pi(e,i){var r=i.x,n=i.y,a=i.x1,s=i.y1,h=i.coordinates,m=[];return e.forEach(function(y,b){var A=[];if(r&&n&&(A=[parseFloat(y[r]),parseFloat(y[n])]),r&&n&&a&&s){var P=[parseFloat(y[r]),parseFloat(y[n])],k=[parseFloat(y[a]),parseFloat(y[s])];A=[P,k]}if(h){var F="Polygon";Array.isArray(h[0])||(F="Point"),Array.isArray(h[0])&&!Array.isArray(h[0][0])&&(F="LineString");var q={type:F,coordinates:(0,ur.Z)(y[h])};ci()(q,!0),A=q.coordinates}var oe=rn(rn({},y),{},{_id:b,coordinates:A});m.push(oe)}),{dataArray:m}}var Ii=[{lng1:100,lat1:30,lng2:130,lat2:30}],Ja={parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}};function hs(e,i){var r=ve(e);return Pi(r,i)}var _a=63710088e-1,Da={centimeters:_a*100,centimetres:_a*100,degrees:_a/111325,feet:_a*3.28084,inches:_a*39.37,kilometers:_a/1e3,kilometres:_a/1e3,meters:_a,metres:_a,miles:_a/1609.344,millimeters:_a*1e3,millimetres:_a*1e3,nauticalmiles:_a/1852,radians:1,yards:_a*1.0936},Ta={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/_a,yards:1.0936133},V={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function $(e,i,r){r===void 0&&(r={});var n={type:"Feature"};return(r.id===0||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=i||{},n.geometry=e,n}function se(e,i,r){switch(r===void 0&&(r={}),e){case"Point":return ge(i).geometry;case"LineString":return pe(i).geometry;case"Polygon":return We(i).geometry;case"MultiPoint":return Dt(i).geometry;case"MultiLineString":return dr(i).geometry;case"MultiPolygon":return zt(i).geometry;default:throw new Error(e+" is invalid")}}function ge(e,i,r){if(r===void 0&&(r={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!ea(e[0])||!ea(e[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:e};return $(n,i,r)}function Oe(e,i,r){return r===void 0&&(r={}),yt(e.map(function(n){return ge(n,i)}),r)}function We(e,i,r){r===void 0&&(r={});for(var n=0,a=e;n<a.length;n++){var s=a[n];if(s.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var h=0;h<s[s.length-1].length;h++)if(s[s.length-1][h]!==s[0][h])throw new Error("First and last Position are not equivalent.")}var m={type:"Polygon",coordinates:e};return $(m,i,r)}function nt(e,i,r){return r===void 0&&(r={}),yt(e.map(function(n){return We(n,i)}),r)}function pe(e,i,r){if(r===void 0&&(r={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:e};return $(n,i,r)}function Fe(e,i,r){return r===void 0&&(r={}),yt(e.map(function(n){return pe(n,i)}),r)}function yt(e,i){i===void 0&&(i={});var r={type:"FeatureCollection"};return i.id&&(r.id=i.id),i.bbox&&(r.bbox=i.bbox),r.features=e,r}function dr(e,i,r){r===void 0&&(r={});var n={type:"MultiLineString",coordinates:e};return $(n,i,r)}function Dt(e,i,r){r===void 0&&(r={});var n={type:"MultiPoint",coordinates:e};return $(n,i,r)}function zt(e,i,r){r===void 0&&(r={});var n={type:"MultiPolygon",coordinates:e};return $(n,i,r)}function gr(e,i,r){r===void 0&&(r={});var n={type:"GeometryCollection",geometries:e};return $(n,i,r)}function En(e,i){if(i===void 0&&(i=0),i&&!(i>=0))throw new Error("precision must be a positive number");var r=Math.pow(10,i||0);return Math.round(e*r)/r}function un(e,i){i===void 0&&(i="kilometers");var r=Da[i];if(!r)throw new Error(i+" units is invalid");return e*r}function Tt(e,i){i===void 0&&(i="kilometers");var r=Da[i];if(!r)throw new Error(i+" units is invalid");return e/r}function nn(e,i){return Yr(Tt(e,i))}function Zr(e){var i=e%360;return i<0&&(i+=360),i}function Yr(e){var i=e%(2*Math.PI);return i*180/Math.PI}function oi(e){var i=e%360;return i*Math.PI/180}function Qr(e,i,r){if(i===void 0&&(i="kilometers"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("length must be a positive number");return un(Tt(e,i),r)}function Ti(e,i,r){if(i===void 0&&(i="meters"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("area must be a positive number");var n=V[i];if(!n)throw new Error("invalid original units");var a=V[r];if(!a)throw new Error("invalid final units");return e/n*a}function ea(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function bi(e){return!!e&&e.constructor===Object}function Oi(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(i){if(!ea(i))throw new Error("bbox must only contain numbers")})}function Ci(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}function ti(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Xi(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Fa(e){if(e.length>1&&isNumber(e[0])&&isNumber(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return Fa(e[0]);throw new Error("coordinates must only contain numbers")}function oa(e,i,r){if(!i||!r)throw new Error("type and name required");if(!e||e.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+e.type)}function Ri(e,i,r){if(!e)throw new Error("No feature passed");if(!r)throw new Error(".featureOf() requires a name");if(!e||e.type!=="Feature"||!e.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!e.geometry||e.geometry.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+e.geometry.type)}function Gi(e,i,r){if(!e)throw new Error("No featureCollection passed");if(!r)throw new Error(".collectionOf() requires a name");if(!e||e.type!=="FeatureCollection")throw new Error("Invalid input to "+r+", FeatureCollection required");for(var n=0,a=e.features;n<a.length;n++){var s=a[n];if(!s||s.type!=="Feature"||!s.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!s.geometry||s.geometry.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+s.geometry.type)}}function Za(e){return e.type==="Feature"?e.geometry:e}function au(e,i){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}function Ma(e,i,r){if(e!==null)for(var n,a,s,h,m,y,b,A=0,P=0,k,F=e.type,q=F==="FeatureCollection",oe=F==="Feature",ue=q?e.features.length:1,Pe=0;Pe<ue;Pe++){b=q?e.features[Pe].geometry:oe?e.geometry:e,k=b?b.type==="GeometryCollection":!1,m=k?b.geometries.length:1;for(var et=0;et<m;et++){var at=0,_t=0;if(h=k?b.geometries[et]:b,h!==null){y=h.coordinates;var Nt=h.type;switch(A=r&&(Nt==="Polygon"||Nt==="MultiPolygon")?1:0,Nt){case null:break;case"Point":if(i(y,P,Pe,at,_t)===!1)return!1;P++,at++;break;case"LineString":case"MultiPoint":for(n=0;n<y.length;n++){if(i(y[n],P,Pe,at,_t)===!1)return!1;P++,Nt==="MultiPoint"&&at++}Nt==="LineString"&&at++;break;case"Polygon":case"MultiLineString":for(n=0;n<y.length;n++){for(a=0;a<y[n].length-A;a++){if(i(y[n][a],P,Pe,at,_t)===!1)return!1;P++}Nt==="MultiLineString"&&at++,Nt==="Polygon"&&_t++}Nt==="Polygon"&&at++;break;case"MultiPolygon":for(n=0;n<y.length;n++){for(_t=0,a=0;a<y[n].length;a++){for(s=0;s<y[n][a].length-A;s++){if(i(y[n][a][s],P,Pe,at,_t)===!1)return!1;P++}_t++}at++}break;case"GeometryCollection":for(n=0;n<h.geometries.length;n++)if(Ma(h.geometries[n],i,r)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Pa(e,i,r,n){var a=r;return Ma(e,function(s,h,m,y,b){h===0&&r===void 0?a=s:a=i(a,s,h,m,y,b)},n),a}function Es(e,i){var r;switch(e.type){case"FeatureCollection":for(r=0;r<e.features.length&&i(e.features[r].properties,r)!==!1;r++);break;case"Feature":i(e.properties,0);break}}function ps(e,i,r){var n=r;return Es(e,function(a,s){s===0&&r===void 0?n=a:n=i(n,a,s)}),n}function ra(e,i){if(e.type==="Feature")i(e,0);else if(e.type==="FeatureCollection")for(var r=0;r<e.features.length&&i(e.features[r],r)!==!1;r++);}function ju(e,i,r){var n=r;return ra(e,function(a,s){s===0&&r===void 0?n=a:n=i(n,a,s)}),n}function yo(e){var i=[];return Ma(e,function(r){i.push(r)}),i}function ja(e,i){var r,n,a,s,h,m,y,b,A,P,k=0,F=e.type==="FeatureCollection",q=e.type==="Feature",oe=F?e.features.length:1;for(r=0;r<oe;r++){for(m=F?e.features[r].geometry:q?e.geometry:e,b=F?e.features[r].properties:q?e.properties:{},A=F?e.features[r].bbox:q?e.bbox:void 0,P=F?e.features[r].id:q?e.id:void 0,y=m?m.type==="GeometryCollection":!1,h=y?m.geometries.length:1,a=0;a<h;a++){if(s=y?m.geometries[a]:m,s===null){if(i(null,k,b,A,P)===!1)return!1;continue}switch(s.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(i(s,k,b,A,P)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<s.geometries.length;n++)if(i(s.geometries[n],k,b,A,P)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}k++}}function oo(e,i,r){var n=r;return ja(e,function(a,s,h,m,y){s===0&&r===void 0?n=a:n=i(n,a,s,h,m,y)}),n}function $i(e,i){ja(e,function(r,n,a,s,h){var m=r===null?null:r.type;switch(m){case null:case"Point":case"LineString":case"Polygon":return i($(r,a,{bbox:s,id:h}),n,0)===!1?!1:void 0}var y;switch(m){case"MultiPoint":y="Point";break;case"MultiLineString":y="LineString";break;case"MultiPolygon":y="Polygon";break}for(var b=0;b<r.coordinates.length;b++){var A=r.coordinates[b],P={type:y,coordinates:A};if(i($(P,a),n,b)===!1)return!1}})}function qo(e,i,r){var n=r;return $i(e,function(a,s,h){s===0&&h===0&&r===void 0?n=a:n=i(n,a,s,h)}),n}function Ko(e,i){$i(e,function(r,n,a){var s=0;if(!!r.geometry){var h=r.geometry.type;if(!(h==="Point"||h==="MultiPoint")){var m,y=0,b=0,A=0;if(Ma(r,function(P,k,F,q,oe){if(m===void 0||n>y||q>b||oe>A){m=P,y=n,b=q,A=oe,s=0;return}var ue=lineString([m,P],r.properties);if(i(ue,n,a,oe,s)===!1)return!1;s++,m=P})===!1)return!1}}})}function Vu(e,i,r){var n=r,a=!1;return Ko(e,function(s,h,m,y,b){a===!1&&r===void 0?n=s:n=i(n,s,h,m,y,b),a=!0}),n}function Co(e,i){if(!e)throw new Error("geojson is required");$i(e,function(r,n,a){if(r.geometry!==null){var s=r.geometry.type,h=r.geometry.coordinates;switch(s){case"LineString":if(i(r,n,a,0,0)===!1)return!1;break;case"Polygon":for(var m=0;m<h.length;m++)if(i(lineString(h[m],r.properties),n,a,m)===!1)return!1;break}}})}function $o(e,i,r){var n=r;return Co(e,function(a,s,h,m){s===0&&r===void 0?n=a:n=i(n,a,s,h,m)}),n}function xa(e,i){if(i=i||{},!isObject(i))throw new Error("options is invalid");var r=i.featureIndex||0,n=i.multiFeatureIndex||0,a=i.geometryIndex||0,s=i.segmentIndex||0,h=i.properties,m;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),h=h||e.features[r].properties,m=e.features[r].geometry;break;case"Feature":h=h||e.properties,m=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":m=e;break;default:throw new Error("geojson is invalid")}if(m===null)return null;var y=m.coordinates;switch(m.type){case"Point":case"MultiPoint":return null;case"LineString":return s<0&&(s=y.length+s-1),lineString([y[s],y[s+1]],h,i);case"Polygon":return a<0&&(a=y.length+a),s<0&&(s=y[a].length+s-1),lineString([y[a][s],y[a][s+1]],h,i);case"MultiLineString":return n<0&&(n=y.length+n),s<0&&(s=y[n].length+s-1),lineString([y[n][s],y[n][s+1]],h,i);case"MultiPolygon":return n<0&&(n=y.length+n),a<0&&(a=y[n].length+a),s<0&&(s=y[n][a].length-s-1),lineString([y[n][a][s],y[n][a][s+1]],h,i)}throw new Error("geojson is invalid")}function _o(e,i){if(i=i||{},!isObject(i))throw new Error("options is invalid");var r=i.featureIndex||0,n=i.multiFeatureIndex||0,a=i.geometryIndex||0,s=i.coordIndex||0,h=i.properties,m;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),h=h||e.features[r].properties,m=e.features[r].geometry;break;case"Feature":h=h||e.properties,m=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":m=e;break;default:throw new Error("geojson is invalid")}if(m===null)return null;var y=m.coordinates;switch(m.type){case"Point":return point(y,h,i);case"MultiPoint":return n<0&&(n=y.length+n),point(y[n],h,i);case"LineString":return s<0&&(s=y.length+s),point(y[s],h,i);case"Polygon":return a<0&&(a=y.length+a),s<0&&(s=y[a].length+s),point(y[a][s],h,i);case"MultiLineString":return n<0&&(n=y.length+n),s<0&&(s=y[n].length+s),point(y[n][s],h,i);case"MultiPolygon":return n<0&&(n=y.length+n),a<0&&(a=y[n].length+a),s<0&&(s=y[n][a].length-s),point(y[n][a][s],h,i)}throw new Error("geojson is invalid")}function Jo(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function so(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Jo(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Jo(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function ou(e,i){var r=[],n={};if(e.features=e.features.filter(function(s){var h=s.geometry;return s!=null&&h&&h.type&&h.coordinates&&h.coordinates.length>0}),ci()(e,!0),e.features.length===0)return{dataArray:[],featureKeys:n};var a=0;return $i(e,function(s,h){var m=Xi(s),y=h,b=so(so({},s.properties),{},{coordinates:m,_id:y});r.push(b)}),{dataArray:r,featureKeys:n}}function xc(e){var i=131,r=137,n=0;e+="x";for(var a=Math.floor(9007199254740991/r),s=0;s<e.length;s++)n>a&&(n=Math.floor(n/r)),n=n*i+e.charCodeAt(s);return n}function Ds(e){e=e.toString();for(var i=5381,r=e.length;r;)i=i*33^e.charCodeAt(--r);return i>>>0}var ne=R(28481),be="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function Qe(e){this.message=e}Qe.prototype=new Error,Qe.prototype.name="InvalidCharacterError";function Rt(e){var i=String(e).replace(/=+$/,"");if(i.length%4==1)throw new Qe("'atob' failed: The string to be decoded is not correctly encoded.");for(var r="",n=0,a,s,h=0;s=i.charAt(h++);~s&&(a=n%4?a*64+s:s,n++%4)?r+=String.fromCharCode(255&a>>(-2*n&6)):0)s=be.indexOf(s);return r}function kr(e){e=String(e);for(var i,r,n,a,s="",h=0,m=e.length%3;h<e.length;){if((r=e.charCodeAt(h++))>255||(n=e.charCodeAt(h++))>255||(a=e.charCodeAt(h++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");i=r<<16|n<<8|a,s+=be.charAt(i>>18&63)+be.charAt(i>>12&63)+be.charAt(i>>6&63)+be.charAt(i&63)}return m?s.slice(0,m-3)+"===".substring(m):s}var lt=R(6610),It=R(5991),uo=function(){function e(i,r){(0,lt.Z)(this,e),this.buffers=i,this.type=r}return(0,It.Z)(e,[{key:"arraybuffer",value:function(){return Promise.resolve(this.buffers[0])}},{key:"stream",value:function(){throw new Error("not implemented")}},{key:"text",value:function(){throw new Error("not implemented")}},{key:"slice",value:function(r,n,a){throw new Error("not implemented")}}]),e}(),Ji;typeof window=="undefined"?Ji={devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(i){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(i){return null},clearMeasures:function(i){return null},clearMarks:function(i){return null},measure:function(i,r,n){return{duration:0}},now:function(){return new Date().getTime()}},Blob:"",dispatchEvent:function(i){return!0},Event:function(i,r){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:Ji=window;var Ya=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",Qo=Ya?my.getSystemInfoSync().pixelRatio:Ji.devicePixelRatio,pn=R(10379),cn=R(46070),Yt=R(77608),Zo=(0,It.Z)(function e(i,r){(0,lt.Z)(this,e),(0,I.Z)(this,"cancelBubble",void 0),(0,I.Z)(this,"cancelable",void 0),(0,I.Z)(this,"target",void 0),(0,I.Z)(this,"currentTarget",void 0),(0,I.Z)(this,"preventDefault",void 0),(0,I.Z)(this,"stopPropagation",void 0),(0,I.Z)(this,"type",void 0),(0,I.Z)(this,"timeStamp",void 0),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=i,this.timeStamp=Date.now()}),xe=R(63349);function Ks(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=su(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(b){throw b},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,h=!1,m;return{s:function(){r=r.call(e)},n:function(){var b=r.next();return s=b.done,b},e:function(b){h=!0,m=b},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(h)throw m}}}}function su(e,i){if(!!e){if(typeof e=="string")return ds(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ds(e,i)}}function ds(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var sa=new WeakMap,xo=function(){function e(){(0,lt.Z)(this,e),sa.set(this,{})}return(0,It.Z)(e,[{key:"addEventListener",value:function(r,n){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=sa.get(this);s||(s={}),s[r]||(s[r]=[]),s[r].push(n),sa.set(this,s),a.capture,a.once,a.passive}},{key:"removeEventListener",value:function(r,n){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=sa.get(this);if(s){var h=s[r];if(h&&h.length>0){for(var m=h.length;m--;m>0)if(h[m]===n){h.splice(m,1);break}}}}},{key:"dispatchEvent",value:function(r){var n=sa.get(this)[r.type];if(n){var a=Ks(n),s;try{for(a.s();!(s=a.n()).done;){var h=s.value;h(r)}}catch(m){a.e(m)}finally{a.f()}}}}]),e}();function Wl(e){var i=bc();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function bc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Gu=function(e){(0,pn.Z)(r,e);var i=Wl(r);function r(){var n;return(0,lt.Z)(this,r),n=i.call(this),(0,I.Z)((0,xe.Z)(n),"childNodes",void 0),n.childNodes=[],n}return(0,It.Z)(r,[{key:"appendChild",value:function(a){this.childNodes.push(a)}},{key:"cloneNode",value:function(){var a=Object.create(this);return Object.assign(a,this),a}},{key:"removeChild",value:function(a){var s=this.childNodes.findIndex(function(h){return h===a});return s>-1?this.childNodes.splice(s,1):null}}]),r}(xo);function Ec(e){var i=Tl();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function Tl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Hu=function(e){(0,pn.Z)(r,e);var i=Ec(r);function r(){var n;return(0,lt.Z)(this,r),n=i.call(this),(0,I.Z)((0,xe.Z)(n),"className",void 0),(0,I.Z)((0,xe.Z)(n),"children",void 0),n.className="",n.children=[],n}return(0,It.Z)(r,[{key:"setAttribute",value:function(a,s){this[a]=s}},{key:"getAttribute",value:function(a){return this[a]}},{key:"setAttributeNS",value:function(a,s){this[a]=s}},{key:"getAttributeNS",value:function(a){return this[a]}}]),r}(Gu),uu=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",Wu,_,w,N;if(uu){var O=my.getSystemInfoSync();Wu=O.screenWidth,_=O.screenHeight,w=O.windowWidth,N=O.windowHeight}else{var K=Ji.innerWidth,_e=Ji.innerHeight;Wu=K,_=_e,w=K,N=_e}var Xe={width:Wu,height:_,availWidth:w,availHeight:N,availLeft:0,availTop:0},ft=Xe.availWidth,mt=Xe.availHeight,cr={style:[]};function xr(e,i){if(!("parentNode"in e)){var r;i===0?r=function(){return null}:i===1?r=function(){return cr}:r=function(){return null},Object.defineProperty(e,"parentNode",{enumerable:!0,get:r})}if(!("parentElement"in e)){var n;i===0?n=function(){return null}:i===1?n=function(){return cr}:n=function(){return null},Object.defineProperty(e,"parentElement",{enumerable:!0,get:n})}}function Pn(e){e.style=e.style||{},Object.assign(e.style,{top:"0px",left:"0px",width:ft+"px",height:mt+"px",margin:"0px",padding:"0px"})}function fi(e){"clientLeft"in e||(e.clientLeft=0,e.clientTop=0),"clientWidth"in e||(e.clientWidth=ft,e.clientHeight=mt),"getBoundingClientRect"in e||(e.getBoundingClientRect=function(){var i={x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight};return i})}function Qn(e){"offsetLeft"in e||(e.offsetLeft=0,e.offsetTop=0),"offsetWidth"in e||(e.offsetWidth=ft,e.offsetHeight=mt)}function Yi(e){"scrollLeft"in e||(e.scrollLeft=0,e.scrollTop=0),"scrollWidth"in e||(e.scrollWidth=ft,e.scrollHeight=mt)}function da(e){var i=function(){return!0};e.classList=[],e.classList.add=i,e.classList.remove=i,e.classList.contains=i,e.classList.toggle=i}function Ra(e){var i=Hi();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function Hi(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Lo(){}var Ss=function(e){(0,pn.Z)(r,e);var i=Ra(r);function r(){var n,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",s=arguments.length>1?arguments[1]:void 0;return(0,lt.Z)(this,r),n=i.call(this),(0,I.Z)((0,xe.Z)(n),"className",void 0),(0,I.Z)((0,xe.Z)(n),"children",void 0),(0,I.Z)((0,xe.Z)(n),"focus",void 0),(0,I.Z)((0,xe.Z)(n),"blur",void 0),(0,I.Z)((0,xe.Z)(n),"insertBefore",void 0),(0,I.Z)((0,xe.Z)(n),"appendChild",void 0),(0,I.Z)((0,xe.Z)(n),"removeChild",void 0),(0,I.Z)((0,xe.Z)(n),"remove",void 0),(0,I.Z)((0,xe.Z)(n),"innerHTML",void 0),(0,I.Z)((0,xe.Z)(n),"tagName",void 0),n.className="",n.children=[],n.focus=Lo,n.blur=Lo,n.insertBefore=Lo,n.appendChild=Lo,n.removeChild=Lo,n.remove=Lo,n.innerHTML="",n.tagName=a.toUpperCase(),xr((0,xe.Z)(n),s),Pn((0,xe.Z)(n)),da((0,xe.Z)(n)),fi((0,xe.Z)(n)),Qn((0,xe.Z)(n)),Yi((0,xe.Z)(n)),n}return(0,It.Z)(r)}(Hu);function hl(e){var i=Gc();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function Gc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Xu=function(e){(0,pn.Z)(r,e);var i=hl(r);function r(n){return(0,lt.Z)(this,r),i.call(this,n)}return(0,It.Z)(r,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),r}(Ss);function Sc(e){var i=Mu();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function Mu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var vu=function(e){(0,pn.Z)(r,e);var i=Sc(r);function r(){return(0,lt.Z)(this,r),i.call(this,"video")}return(0,It.Z)(r)}(Xu),Ao={},va={};function uh(e,i){Ao=e,Ao.id=i,"tagName"in Ao||(Ao.tagName="CANVAS"),Ao.type="canvas",Mixin.parentNode(Ao),Mixin.style(Ao),Mixin.classList(Ao),Mixin.clientRegion(Ao),Mixin.offsetRegion(Ao),Ao.focus=function(){},Ao.blur=function(){}}function lh(e,i){var r=1024,n=1024;va={width:r,height:n,clientWidth:r/devicePixelRatio,clientHeight:n/devicePixelRatio,id:i,type:"canvas"},"tagName"in va||(va.tagName="CANVAS"),Mixin.parentNode(va),Mixin.style(va),Mixin.classList(va),Mixin.clientRegion(va),Mixin.offsetRegion(va),va.getContext=function(a){if(a==="2d")return e},va.focus=function(){},va.blur=function(){}}function ho(){return Ao}function Pf(){return va}var mu=(0,It.Z)(function e(){(0,lt.Z)(this,e);var i=ho(),r=i.createImage&&i.createImage()||{};return"tagName"in r||(r.tagName="IMG",r.__proto__=e.prototype),xr(r),da(r),Object.assign(r,{addEventListener:function(a,s){r["on".concat(a)]=s.bind(r)},removeEventListener:function(a){r["on".concat(a)]=null}}),r}),Fs={href:"",protocol:"",host:""};function Cc(e){var i=pl();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function pl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ca=function(e){(0,pn.Z)(r,e);var i=Cc(r);function r(){return(0,lt.Z)(this,r),i.call(this,"body",0)}return(0,It.Z)(r,[{key:"addEventListener",value:function(a,s){var h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(a,s,h){}},{key:"dispatchEvent",value:function(a){}}]),r}(Ss),Ml=function(e){(0,pn.Z)(r,e);var i=Cc(r);function r(){return(0,lt.Z)(this,r),i.call(this,"html",0)}return(0,It.Z)(r,[{key:"addEventListener",value:function(a,s){var h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(a,s){}},{key:"dispatchEvent",value:function(a){}}]),r}(Ss),Xl={},ns={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:Fs,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(i){return i=i.toLowerCase(),i==="canvas"?my.createOffscreenCanvas(1024,128,"2d"):i==="img"?new mu:i==="video"?new vu:new Ss(i)},createElementNS:function(i,r){return this.createElement(r)},createTextNode:function(i){return i},getElementById:function(i){return null},getElementsByTagName:function(i){return i=i.toLowerCase(),[]},getElementsByTagNameNS:function(i,r){return this.getElementsByTagName(r)},getElementsByName:function(i){return[]},querySelector:function(i){return null},querySelectorAll:function(i){return[]},addEventListener:function(i,r,n){Xl[i]||(Xl[i]=[]),Xl[i].push(r)},removeEventListener:function(i,r){var n=Xl[i];if(n&&n.length>0){for(var a=n.length;a--;a>0)if(n[a]===r){n.splice(a,1);break}}},dispatchEvent:function(i){var r=i.type,n=Xl[r];if(n)for(var a=0;a<n.length;a++)n[a](i);i.target&&typeof i.target["on"+r]=="function"&&i.target["on"+r](i)},createEvent:function(i){return new Zo(i)}};ns.documentElement=new Ml,ns.head=new Ss("head"),ns.body=new Ca;var If=Object,ch=R(90484),fh=function(){function e(){(0,lt.Z)(this,e),(0,I.Z)(this,"_w",void 0),(0,I.Z)(this,"_h",void 0),(0,I.Z)(this,"_data",void 0);var i=arguments.length;if(i===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){this._w=arguments[0],this._h=arguments[1],this._data=new Uint8ClampedArray(this._w*this._h*4);return}}else i===3&&(0,ch.Z)(arguments[0])==="object"&&typeof arguments[1]=="number"&&typeof arguments[2]=="number"&&(this._data=arguments[0],this._w=arguments[1],this._h=arguments[2]);throw new Error("ImageData: params error")}return(0,It.Z)(e,[{key:"width",get:function(){return this._w}},{key:"height",get:function(){return this._h}},{key:"data",get:function(){return this._data}}]),e}(),Hc=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",dl,jo,Pu;if(Hc){var Yu=my.getSystemInfoSync();dl=Yu.system,jo=Yu.platform,Pu=Yu.language}else{var Vo={versions:function(){var e=Ji.navigator.userAgent;return{trident:e.indexOf("Trident")>-1,presto:e.indexOf("Presto")>-1,webKit:e.indexOf("AppleWebKit")>-1,gecko:e.indexOf("Gecko")>-1&&e.indexOf("KHTML")===-1,mobile:!!e.match(/AppleWebKit.*Mobile.*/),ios:!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:e.indexOf("Android")>-1||e.indexOf("Linux")>-1,iPhone:e.indexOf("iPhone")>-1,iPad:e.indexOf("iPad")>-1,webApp:e.indexOf("Safari")===-1,weixin:e.indexOf("MicroMessenger")>-1,qq:e.match(/\sQQ/i)===" qq"}}(),language:(Ji.navigator.browserLanguage||Ji.navigator.language).toLowerCase()};Vo.versions.android?jo="android":Vo.versions.trident?jo="IE":Vo.versions.presto?jo="Opera":Vo.versions.webKit?jo="webKit":Vo.versions.gecko?jo="Firefox":Vo.versions.mobile?jo="mobile":Vo.versions.ios?jo="ios":Vo.versions.iPhone?jo="iPhone":Vo.versions.iPad?jo="ipad":Vo.versions.webApp?jo="webApp":Vo.versions.weixin?jo="weixin":Vo.versions.qq&&(jo="qq"),dl=Ji.navigator.userAgent,Pu=Vo.language}var Pl=dl.toLowerCase().indexOf("android")!==-1,qu=Pl?"Android; CPU Android 6.0":"iPhone; CPU iPhone OS 10_3_1 like Mac OS X",$s="Mozilla/5.0 (".concat(qu,") AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/").concat(Pu),Wc={platform:jo,language:Pu,appVersion:"5.0 (".concat(qu,") AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1"),userAgent:$s},Xc={mark:function(i){return null},clearMeasures:function(i){return null},clearMarks:function(i){return null},measure:function(i,r,n){return{duration:0}},now:function(){}},Yc=0,Ku=0;function Yl(e){var i=Date.now(),r=Math.max(Yc+23,i);return Ku=setTimeout(function(){e(Yc=r)},r-i),Ku}function Ac(e){var i=ho();return i.requestAnimationFrame?i.requestAnimationFrame(e):Yl(e)}function qc(e){var i=ho();return i.cancelAnimationFrame?i.cancelAnimationFrame(e):clearTimeout(e)}var wc=function(){function e(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if((0,lt.Z)(this,e),(0,I.Z)(this,"href",void 0),i.indexOf("http://")==0||i.indexOf("https://")==0){this.href=i;return}this.href=r+i}return(0,It.Z)(e,null,[{key:"createObjectURL",value:function(r){var n=r.buffers[0],a=r.type,s=hh(n),h="data:".concat(a,";base64, ");return h+s}}]),e}();function hh(e){for(var i="",r=new Uint8Array(e),n=r.byteLength,a=0;a<n;a++)i+=String.fromCharCode(r[a]);return kr(i)}var Tc={GCCSO_SHADER_BINARY_FJ:37472,_3DC_XY_AMD:34810,_3DC_X_AMD:34809,ACTIVE_ATTRIBUTES:35721,ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_PROGRAM_EXT:33369,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ACTIVE_UNIFORM_MAX_LENGTH:35719,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALL_COMPLETED_NV:34034,ALL_SHADER_BITS_EXT:4294967295,ALPHA:6406,ALPHA16F_EXT:34844,ALPHA32F_EXT:34838,ALPHA8_EXT:32828,ALPHA8_OES:32828,ALPHA_BITS:3413,ALPHA_TEST_FUNC_QCOM:3009,ALPHA_TEST_QCOM:3008,ALPHA_TEST_REF_QCOM:3010,ALREADY_SIGNALED_APPLE:37146,ALWAYS:519,AMD_compressed_3DC_texture:1,AMD_compressed_ATC_texture:1,AMD_performance_monitor:1,AMD_program_binary_Z400:1,ANGLE_depth_texture:1,ANGLE_framebuffer_blit:1,ANGLE_framebuffer_multisample:1,ANGLE_instanced_arrays:1,ANGLE_pack_reverse_row_order:1,ANGLE_program_binary:1,ANGLE_texture_compression_dxt3:1,ANGLE_texture_compression_dxt5:1,ANGLE_texture_usage:1,ANGLE_translated_shader_source:1,ANY_SAMPLES_PASSED_CONSERVATIVE_EXT:36202,ANY_SAMPLES_PASSED_EXT:35887,APPLE_copy_texture_levels:1,APPLE_framebuffer_multisample:1,APPLE_rgb_422:1,APPLE_sync:1,APPLE_texture_format_BGRA8888:1,APPLE_texture_max_level:1,ARM_mali_program_binary:1,ARM_mali_shader_binary:1,ARM_rgba8:1,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATC_RGBA_EXPLICIT_ALPHA_AMD:35987,ATC_RGBA_INTERPOLATED_ALPHA_AMD:34798,ATC_RGB_AMD:35986,ATTACHED_SHADERS:35717,BACK:1029,BGRA8_EXT:37793,BGRA_EXT:32993,BGRA_IMG:32993,BINNING_CONTROL_HINT_QCOM:36784,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BUFFER:33504,BUFFER_ACCESS_OES:35003,BUFFER_MAPPED_OES:35004,BUFFER_MAP_POINTER_OES:35005,BUFFER_OBJECT_EXT:37201,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_BORDER_NV:33069,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_ATTACHMENT0_NV:36064,COLOR_ATTACHMENT10_NV:36074,COLOR_ATTACHMENT11_NV:36075,COLOR_ATTACHMENT12_NV:36076,COLOR_ATTACHMENT13_NV:36077,COLOR_ATTACHMENT14_NV:36078,COLOR_ATTACHMENT15_NV:36079,COLOR_ATTACHMENT1_NV:36065,COLOR_ATTACHMENT2_NV:36066,COLOR_ATTACHMENT3_NV:36067,COLOR_ATTACHMENT4_NV:36068,COLOR_ATTACHMENT5_NV:36069,COLOR_ATTACHMENT6_NV:36070,COLOR_ATTACHMENT7_NV:36071,COLOR_ATTACHMENT8_NV:36072,COLOR_ATTACHMENT9_NV:36073,COLOR_ATTACHMENT_EXT:37104,COLOR_BUFFER_BIT:16384,COLOR_BUFFER_BIT0_QCOM:1,COLOR_BUFFER_BIT1_QCOM:2,COLOR_BUFFER_BIT2_QCOM:4,COLOR_BUFFER_BIT3_QCOM:8,COLOR_BUFFER_BIT4_QCOM:16,COLOR_BUFFER_BIT5_QCOM:32,COLOR_BUFFER_BIT6_QCOM:64,COLOR_BUFFER_BIT7_QCOM:128,COLOR_CLEAR_VALUE:3106,COLOR_EXT:6144,COLOR_WRITEMASK:3107,COMPARE_REF_TO_TEXTURE_EXT:34894,COMPILE_STATUS:35713,COMPRESSED_RGBA_ASTC_10x10_KHR:37819,COMPRESSED_RGBA_ASTC_10x5_KHR:37816,COMPRESSED_RGBA_ASTC_10x6_KHR:37817,COMPRESSED_RGBA_ASTC_10x8_KHR:37818,COMPRESSED_RGBA_ASTC_12x10_KHR:37820,COMPRESSED_RGBA_ASTC_12x12_KHR:37821,COMPRESSED_RGBA_ASTC_4x4_KHR:37808,COMPRESSED_RGBA_ASTC_5x4_KHR:37809,COMPRESSED_RGBA_ASTC_5x5_KHR:37810,COMPRESSED_RGBA_ASTC_6x5_KHR:37811,COMPRESSED_RGBA_ASTC_6x6_KHR:37812,COMPRESSED_RGBA_ASTC_8x5_KHR:37813,COMPRESSED_RGBA_ASTC_8x6_KHR:37814,COMPRESSED_RGBA_ASTC_8x8_KHR:37815,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_PVRTC_2BPPV2_IMG:37175,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_4BPPV2_IMG:37176,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_ANGLE:33778,COMPRESSED_RGBA_S3TC_DXT5_ANGLE:33779,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:37853,COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:37847,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_NV:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_NV:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_NV:35919,COMPRESSED_SRGB_S3TC_DXT1_NV:35916,COMPRESSED_TEXTURE_FORMATS:34467,CONDITION_SATISFIED_APPLE:37148,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_FLAG_DEBUG_BIT:2,CONTEXT_ROBUST_ACCESS_EXT:37107,COUNTER_RANGE_AMD:35777,COUNTER_TYPE_AMD:35776,COVERAGE_ALL_FRAGMENTS_NV:36565,COVERAGE_ATTACHMENT_NV:36562,COVERAGE_AUTOMATIC_NV:36567,COVERAGE_BUFFERS_NV:36563,COVERAGE_BUFFER_BIT_NV:32768,COVERAGE_COMPONENT4_NV:36561,COVERAGE_COMPONENT_NV:36560,COVERAGE_EDGE_FRAGMENTS_NV:36566,COVERAGE_SAMPLES_NV:36564,CPU_OPTIMIZED_QCOM:36785,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_QUERY_EXT:34917,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DEBUG_CALLBACK_FUNCTION:33348,DEBUG_CALLBACK_USER_PARAM:33349,DEBUG_GROUP_STACK_DEPTH:33389,DEBUG_LOGGED_MESSAGES:37189,DEBUG_NEXT_LOGGED_MESSAGE_LENGTH:33347,DEBUG_OUTPUT:37600,DEBUG_OUTPUT_SYNCHRONOUS:33346,DEBUG_SEVERITY_HIGH:37190,DEBUG_SEVERITY_LOW:37192,DEBUG_SEVERITY_MEDIUM:37191,DEBUG_SEVERITY_NOTIFICATION:33387,DEBUG_SOURCE_API:33350,DEBUG_SOURCE_APPLICATION:33354,DEBUG_SOURCE_OTHER:33355,DEBUG_SOURCE_SHADER_COMPILER:33352,DEBUG_SOURCE_THIRD_PARTY:33353,DEBUG_SOURCE_WINDOW_SYSTEM:33351,DEBUG_TYPE_DEPRECATED_BEHAVIOR:33357,DEBUG_TYPE_ERROR:33356,DEBUG_TYPE_MARKER:33384,DEBUG_TYPE_OTHER:33361,DEBUG_TYPE_PERFORMANCE:33360,DEBUG_TYPE_POP_GROUP:33386,DEBUG_TYPE_PORTABILITY:33359,DEBUG_TYPE_PUSH_GROUP:33385,DEBUG_TYPE_UNDEFINED_BEHAVIOR:33358,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH24_STENCIL8_OES:35056,DEPTH_ATTACHMENT:36096,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_BUFFER_BIT0_QCOM:256,DEPTH_BUFFER_BIT1_QCOM:512,DEPTH_BUFFER_BIT2_QCOM:1024,DEPTH_BUFFER_BIT3_QCOM:2048,DEPTH_BUFFER_BIT4_QCOM:4096,DEPTH_BUFFER_BIT5_QCOM:8192,DEPTH_BUFFER_BIT6_QCOM:16384,DEPTH_BUFFER_BIT7_QCOM:32768,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,DEPTH_COMPONENT16:33189,DEPTH_COMPONENT16_NONLINEAR_NV:36396,DEPTH_COMPONENT16_OES:33189,DEPTH_COMPONENT24_OES:33190,DEPTH_COMPONENT32_OES:33191,DEPTH_EXT:6145,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_OES:34041,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DMP_shader_binary:1,DONT_CARE:4352,DRAW_BUFFER0_NV:34853,DRAW_BUFFER10_NV:34863,DRAW_BUFFER11_NV:34864,DRAW_BUFFER12_NV:34865,DRAW_BUFFER13_NV:34866,DRAW_BUFFER14_NV:34867,DRAW_BUFFER15_NV:34868,DRAW_BUFFER1_NV:34854,DRAW_BUFFER2_NV:34855,DRAW_BUFFER3_NV:34856,DRAW_BUFFER4_NV:34857,DRAW_BUFFER5_NV:34858,DRAW_BUFFER6_NV:34859,DRAW_BUFFER7_NV:34860,DRAW_BUFFER8_NV:34861,DRAW_BUFFER9_NV:34862,DRAW_BUFFER_EXT:3073,DRAW_FRAMEBUFFER_ANGLE:36009,DRAW_FRAMEBUFFER_APPLE:36009,DRAW_FRAMEBUFFER_BINDING_ANGLE:36006,DRAW_FRAMEBUFFER_BINDING_APPLE:36006,DRAW_FRAMEBUFFER_BINDING_NV:36006,DRAW_FRAMEBUFFER_NV:36009,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,ES_VERSION_2_0:1,ETC1_RGB8_OES:36196,ETC1_SRGB8_NV:35054,EXTENSIONS:7939,EXT_blend_minmax:1,EXT_color_buffer_half_float:1,EXT_debug_label:1,EXT_debug_marker:1,EXT_discard_framebuffer:1,EXT_map_buffer_range:1,EXT_multi_draw_arrays:1,EXT_multisampled_render_to_texture:1,EXT_multiview_draw_buffers:1,EXT_occlusion_query_boolean:1,EXT_read_format_bgra:1,EXT_robustness:1,EXT_sRGB:1,EXT_separate_shader_objects:1,EXT_shader_framebuffer_fetch:1,EXT_shader_texture_lod:1,EXT_shadow_samplers:1,EXT_texture_compression_dxt1:1,EXT_texture_filter_anisotropic:1,EXT_texture_format_BGRA8888:1,EXT_texture_rg:1,EXT_texture_storage:1,EXT_texture_type_2_10_10_10_REV:1,EXT_unpack_subimage:1,FALSE:0,FASTEST:4353,FENCE_CONDITION_NV:34036,FENCE_STATUS_NV:34035,FIXED:5132,FJ_shader_binary_GCCSO:1,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAGMENT_SHADER_BIT_EXT:2,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,FRAGMENT_SHADER_DISCARDS_SAMPLES_EXT:35410,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_ANGLE:37795,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_3D_ZOFFSET_OES:36052,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_SAMPLES_EXT:36204,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_ANGLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_APPLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_EXT:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_IMG:37172,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_NV:36182,FRAMEBUFFER_UNDEFINED_OES:33305,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GPU_OPTIMIZED_QCOM:36786,GREATER:516,GREEN_BITS:3411,GUILTY_CONTEXT_RESET_EXT:33363,HALF_FLOAT_OES:36193,HIGH_FLOAT:36338,HIGH_INT:36341,IMG_multisampled_render_to_texture:1,IMG_program_binary:1,IMG_read_format:1,IMG_shader_binary:1,IMG_texture_compression_pvrtc:1,IMG_texture_compression_pvrtc2:1,IMPLEMENTATION_COLOR_READ_FORMAT:35739,IMPLEMENTATION_COLOR_READ_TYPE:35738,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INNOCENT_CONTEXT_RESET_EXT:33364,INT:5124,INT_10_10_10_2_OES:36343,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,KHR_debug:1,KHR_texture_compression_astc_ldr:1,LEFT:1030,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOSE_CONTEXT_ON_RESET_EXT:33362,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE16F_EXT:34846,LUMINANCE32F_EXT:34840,LUMINANCE4_ALPHA4_OES:32835,LUMINANCE8_ALPHA8_EXT:32837,LUMINANCE8_ALPHA8_OES:32837,LUMINANCE8_EXT:32832,LUMINANCE8_OES:32832,LUMINANCE_ALPHA:6410,LUMINANCE_ALPHA16F_EXT:34847,LUMINANCE_ALPHA32F_EXT:34841,MALI_PROGRAM_BINARY_ARM:36705,MALI_SHADER_BINARY_ARM:36704,MAP_FLUSH_EXPLICIT_BIT_EXT:16,MAP_INVALIDATE_BUFFER_BIT_EXT:8,MAP_INVALIDATE_RANGE_BIT_EXT:4,MAP_READ_BIT_EXT:1,MAP_UNSYNCHRONIZED_BIT_EXT:32,MAP_WRITE_BIT_EXT:2,MAX_3D_TEXTURE_SIZE_OES:32883,MAX_COLOR_ATTACHMENTS_NV:36063,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_DEBUG_GROUP_STACK_DEPTH:33388,MAX_DEBUG_LOGGED_MESSAGES:37188,MAX_DEBUG_MESSAGE_LENGTH:37187,MAX_DRAW_BUFFERS_NV:34852,MAX_EXT:32776,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_LABEL_LENGTH:33512,MAX_MULTIVIEW_BUFFERS_EXT:37106,MAX_RENDERBUFFER_SIZE:34024,MAX_SAMPLES_ANGLE:36183,MAX_SAMPLES_APPLE:36183,MAX_SAMPLES_EXT:36183,MAX_SAMPLES_IMG:37173,MAX_SAMPLES_NV:36183,MAX_SERVER_WAIT_TIMEOUT_APPLE:37137,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIN_EXT:32775,MIRRORED_REPEAT:33648,MULTISAMPLE_BUFFER_BIT0_QCOM:16777216,MULTISAMPLE_BUFFER_BIT1_QCOM:33554432,MULTISAMPLE_BUFFER_BIT2_QCOM:67108864,MULTISAMPLE_BUFFER_BIT3_QCOM:134217728,MULTISAMPLE_BUFFER_BIT4_QCOM:268435456,MULTISAMPLE_BUFFER_BIT5_QCOM:536870912,MULTISAMPLE_BUFFER_BIT6_QCOM:1073741824,MULTISAMPLE_BUFFER_BIT7_QCOM:2147483648,MULTIVIEW_EXT:37105,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,NO_RESET_NOTIFICATION_EXT:33377,NUM_COMPRESSED_TEXTURE_FORMATS:34466,NUM_PROGRAM_BINARY_FORMATS_OES:34814,NUM_SHADER_BINARY_FORMATS:36345,NV_coverage_sample:1,NV_depth_nonlinear:1,NV_draw_buffers:1,NV_draw_instanced:1,NV_fbo_color_attachments:1,NV_fence:1,NV_framebuffer_blit:1,NV_framebuffer_multisample:1,NV_generate_mipmap_sRGB:1,NV_instanced_arrays:1,NV_read_buffer:1,NV_read_buffer_front:1,NV_read_depth:1,NV_read_depth_stencil:1,NV_read_stencil:1,NV_sRGB_formats:1,NV_shadow_samplers_array:1,NV_shadow_samplers_cube:1,NV_texture_border_clamp:1,NV_texture_compression_s3tc_update:1,NV_texture_npot_2D_mipmap:1,OBJECT_TYPE_APPLE:37138,OES_EGL_image:1,OES_EGL_image_external:1,OES_compressed_ETC1_RGB8_texture:1,OES_compressed_paletted_texture:1,OES_depth24:1,OES_depth32:1,OES_depth_texture:1,OES_element_index_uint:1,OES_fbo_render_mipmap:1,OES_fragment_precision_high:1,OES_get_program_binary:1,OES_mapbuffer:1,OES_packed_depth_stencil:1,OES_required_internalformat:1,OES_rgb8_rgba8:1,OES_standard_derivatives:1,OES_stencil1:1,OES_stencil4:1,OES_surfaceless_context:1,OES_texture_3D:1,OES_texture_float:1,OES_texture_float_linear:1,OES_texture_half_float:1,OES_texture_half_float_linear:1,OES_texture_npot:1,OES_vertex_array_object:1,OES_vertex_half_float:1,OES_vertex_type_10_10_10_2:1,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,PACK_REVERSE_ROW_ORDER_ANGLE:37796,PALETTE4_R5_G6_B5_OES:35730,PALETTE4_RGB5_A1_OES:35732,PALETTE4_RGB8_OES:35728,PALETTE4_RGBA4_OES:35731,PALETTE4_RGBA8_OES:35729,PALETTE8_R5_G6_B5_OES:35735,PALETTE8_RGB5_A1_OES:35737,PALETTE8_RGB8_OES:35733,PALETTE8_RGBA4_OES:35736,PALETTE8_RGBA8_OES:35734,PERCENTAGE_AMD:35779,PERFMON_GLOBAL_MODE_QCOM:36768,PERFMON_RESULT_AMD:35782,PERFMON_RESULT_AVAILABLE_AMD:35780,PERFMON_RESULT_SIZE_AMD:35781,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,PROGRAM:33506,PROGRAM_BINARY_ANGLE:37798,PROGRAM_BINARY_FORMATS_OES:34815,PROGRAM_BINARY_LENGTH_OES:34625,PROGRAM_OBJECT_EXT:35648,PROGRAM_PIPELINE_BINDING_EXT:33370,PROGRAM_PIPELINE_OBJECT_EXT:35407,PROGRAM_SEPARABLE_EXT:33368,QCOM_alpha_test:1,QCOM_binning_control:1,QCOM_driver_control:1,QCOM_extended_get:1,QCOM_extended_get2:1,QCOM_perfmon_global_mode:1,QCOM_tiled_rendering:1,QCOM_writeonly_rendering:1,QUERY:33507,QUERY_OBJECT_EXT:37203,QUERY_RESULT_AVAILABLE_EXT:34919,QUERY_RESULT_EXT:34918,R16F_EXT:33325,R32F_EXT:33326,R8_EXT:33321,READ_BUFFER_EXT:3074,READ_BUFFER_NV:3074,READ_FRAMEBUFFER_ANGLE:36008,READ_FRAMEBUFFER_APPLE:36008,READ_FRAMEBUFFER_BINDING_ANGLE:36010,READ_FRAMEBUFFER_BINDING_APPLE:36010,READ_FRAMEBUFFER_BINDING_NV:36010,READ_FRAMEBUFFER_NV:36008,RED_BITS:3410,RED_EXT:6403,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_SAMPLES_ANGLE:36011,RENDERBUFFER_SAMPLES_APPLE:36011,RENDERBUFFER_SAMPLES_EXT:36011,RENDERBUFFER_SAMPLES_IMG:37171,RENDERBUFFER_SAMPLES_NV:36011,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,RENDER_DIRECT_TO_FRAMEBUFFER_QCOM:36787,REPEAT:10497,REPLACE:7681,REQUIRED_TEXTURE_IMAGE_UNITS_OES:36200,RESET_NOTIFICATION_STRATEGY_EXT:33366,RG16F_EXT:33327,RG32F_EXT:33328,RG8_EXT:33323,RGB:6407,RGB10_A2_EXT:32857,RGB10_EXT:32850,RGB16F_EXT:34843,RGB32F_EXT:34837,RGB565:36194,RGB565_OES:36194,RGB5_A1:32855,RGB5_A1_OES:32855,RGB8_OES:32849,RGBA:6408,RGBA16F_EXT:34842,RGBA32F_EXT:34836,RGBA4:32854,RGBA4_OES:32854,RGBA8_OES:32856,RGB_422_APPLE:35359,RG_EXT:33319,RIGHT:1031,SAMPLER:33510,SAMPLER_2D:35678,SAMPLER_2D_ARRAY_SHADOW_NV:36292,SAMPLER_2D_SHADOW_EXT:35682,SAMPLER_3D_OES:35679,SAMPLER_CUBE:35680,SAMPLER_CUBE_SHADOW_NV:36293,SAMPLER_EXTERNAL_OES:36198,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SGX_BINARY_IMG:35850,SGX_PROGRAM_BINARY_IMG:37168,SHADER:33505,SHADER_BINARY_DMP:37456,SHADER_BINARY_FORMATS:36344,SHADER_BINARY_VIV:36804,SHADER_COMPILER:36346,SHADER_OBJECT_EXT:35656,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SIGNALED_APPLE:37145,SLUMINANCE8_ALPHA8_NV:35909,SLUMINANCE8_NV:35911,SLUMINANCE_ALPHA_NV:35908,SLUMINANCE_NV:35910,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,SRGB8_ALPHA8_EXT:35907,SRGB8_NV:35905,SRGB_ALPHA_EXT:35906,SRGB_EXT:35904,STACK_OVERFLOW:1283,STACK_UNDERFLOW:1284,STATE_RESTORE:35804,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_BUFFER_BIT0_QCOM:65536,STENCIL_BUFFER_BIT1_QCOM:131072,STENCIL_BUFFER_BIT2_QCOM:262144,STENCIL_BUFFER_BIT3_QCOM:524288,STENCIL_BUFFER_BIT4_QCOM:1048576,STENCIL_BUFFER_BIT5_QCOM:2097152,STENCIL_BUFFER_BIT6_QCOM:4194304,STENCIL_BUFFER_BIT7_QCOM:8388608,STENCIL_CLEAR_VALUE:2961,STENCIL_EXT:6146,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX1_OES:36166,STENCIL_INDEX4_OES:36167,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,SYNC_CONDITION_APPLE:37139,SYNC_FENCE_APPLE:37142,SYNC_FLAGS_APPLE:37141,SYNC_FLUSH_COMMANDS_BIT_APPLE:1,SYNC_GPU_COMMANDS_COMPLETE_APPLE:37143,SYNC_OBJECT_APPLE:35411,SYNC_STATUS_APPLE:37140,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE2:33986,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE3:33987,TEXTURE30:34014,TEXTURE31:34015,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE_2D:3553,TEXTURE_3D_OES:32879,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_3D_OES:32874,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_BINDING_EXTERNAL_OES:36199,TEXTURE_BORDER_COLOR_NV:4100,TEXTURE_COMPARE_FUNC_EXT:34893,TEXTURE_COMPARE_MODE_EXT:34892,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_DEPTH_QCOM:35796,TEXTURE_EXTERNAL_OES:36197,TEXTURE_FORMAT_QCOM:35798,TEXTURE_HEIGHT_QCOM:35795,TEXTURE_IMAGE_VALID_QCOM:35800,TEXTURE_IMMUTABLE_FORMAT_EXT:37167,TEXTURE_INTERNAL_FORMAT_QCOM:35797,TEXTURE_MAG_FILTER:10240,TEXTURE_MAX_ANISOTROPY_EXT:34046,TEXTURE_MAX_LEVEL_APPLE:33085,TEXTURE_MIN_FILTER:10241,TEXTURE_NUM_LEVELS_QCOM:35801,TEXTURE_OBJECT_VALID_QCOM:35803,TEXTURE_SAMPLES_IMG:37174,TEXTURE_TARGET_QCOM:35802,TEXTURE_TYPE_QCOM:35799,TEXTURE_USAGE_ANGLE:37794,TEXTURE_WIDTH_QCOM:35794,TEXTURE_WRAP_R_OES:32882,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TIMEOUT_EXPIRED_APPLE:37147,TIMEOUT_IGNORED_APPLE:18446744073709552e3,TRANSLATED_SHADER_SOURCE_LENGTH_ANGLE:37792,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,TRUE:1,UNKNOWN_CONTEXT_RESET_EXT:33365,UNPACK_ALIGNMENT:3317,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_PIXELS:3316,UNPACK_SKIP_ROWS:3315,UNSIGNALED_APPLE:37144,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_INT64_AMD:35778,UNSIGNED_INT_10_10_10_2_OES:36342,UNSIGNED_INT_24_8_OES:34042,UNSIGNED_INT_2_10_10_10_REV_EXT:33640,UNSIGNED_NORMALIZED_EXT:35863,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_1_5_5_5_REV_EXT:33638,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_4_4_4_4_REV_EXT:33637,UNSIGNED_SHORT_4_4_4_4_REV_IMG:33637,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,UNSIGNED_SHORT_8_8_APPLE:34234,UNSIGNED_SHORT_8_8_REV_APPLE:34235,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ARRAY_BINDING_OES:34229,VERTEX_ARRAY_OBJECT_EXT:37204,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,VERTEX_ATTRIB_ARRAY_DIVISOR_NV:35070,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VERTEX_SHADER_BIT_EXT:1,VIEWPORT:2978,VIV_shader_binary:1,WAIT_FAILED_APPLE:37149,WRITEONLY_RENDERING_QCOM:34851,WRITE_ONLY_OES:35001,Z400_BINARY_AMD:34624,ZERO:0,RASTERIZER_DISCARD:35977,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444},vl={};function Kc(e){var i=$c();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function $c(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Iu=new Map,Jc=new Map,Of=new Map,ph={json:"application/json",text:"application/text",arraybuffer:"application/octet-stream"};function Il(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{target:this};typeof this["on".concat(e)]=="function"&&this["on".concat(e)].call(this,i)}function Wh(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{readyState:e};this.readyState=e,Il.call(this,"readystatechange",i)}var is=function(e){(0,pn.Z)(r,e);var i=Kc(r);function r(){var n;return(0,lt.Z)(this,r),n=i.call(this),(0,I.Z)((0,xe.Z)(n),"onabort",void 0),(0,I.Z)((0,xe.Z)(n),"onerror",void 0),(0,I.Z)((0,xe.Z)(n),"onload",void 0),(0,I.Z)((0,xe.Z)(n),"onloadstart",void 0),(0,I.Z)((0,xe.Z)(n),"onprogress",void 0),(0,I.Z)((0,xe.Z)(n),"ontimeout",void 0),(0,I.Z)((0,xe.Z)(n),"onloadend",void 0),(0,I.Z)((0,xe.Z)(n),"onreadystatechange",void 0),(0,I.Z)((0,xe.Z)(n),"readyState",void 0),(0,I.Z)((0,xe.Z)(n),"response",void 0),(0,I.Z)((0,xe.Z)(n),"responseText",void 0),(0,I.Z)((0,xe.Z)(n),"_responseType",void 0),(0,I.Z)((0,xe.Z)(n),"responseXML",void 0),(0,I.Z)((0,xe.Z)(n),"status",void 0),(0,I.Z)((0,xe.Z)(n),"statusText",void 0),(0,I.Z)((0,xe.Z)(n),"upload",void 0),(0,I.Z)((0,xe.Z)(n),"withCredentials",void 0),(0,I.Z)((0,xe.Z)(n),"timeout",void 0),(0,I.Z)((0,xe.Z)(n),"_url",void 0),(0,I.Z)((0,xe.Z)(n),"_method",void 0),n.onabort=null,n.onerror=null,n.onload=null,n.onloadstart=null,n.onprogress=null,n.ontimeout=null,n.onloadend=null,n.onreadystatechange=null,n.readyState=0,n.response=null,n.responseText=null,n._responseType="text",n.responseXML=null,n.status=0,n.statusText="",n.upload={},n.withCredentials=!1,Iu.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),n}return(0,It.Z)(r,[{key:"responseType",set:function(a){this._responseType=a}},{key:"abort",value:function(){var a=Of.get("requestTask");a&&a.abort()}},{key:"getAllResponseHeaders",value:function(){var a=Jc.get("responseHeader");return Object.keys(a).map(function(s){return"".concat(s,": ").concat(a[s])}).join(`
`)}},{key:"getResponseHeader",value:function(a){return Jc.get("responseHeader")[a]}},{key:"open",value:function(a,s,h){this._method=a,this._url=s}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:""}},{key:"setRequestHeader",value:function(a,s){var h=Iu.get("requestHeader");h[a]=s,Iu.set("requestHeader",h)}},{key:"addEventListener",value:function(a,s){var h=this;typeof s=="function"&&(this["on"+a]=function(){var m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};m.target=m.target||h,s.call(h,m)})}},{key:"removeEventListener",value:function(a,s){this["on"+a]===s&&(this["on"+a]=null)}}]),r}(xo);(0,I.Z)(is,"UNSEND",void 0),(0,I.Z)(is,"OPENED",void 0),(0,I.Z)(is,"HEADERS_RECEIVED",void 0),(0,I.Z)(is,"LOADING",void 0),(0,I.Z)(is,"DONE",void 0),is.UNSEND=0,is.OPENED=1,is.HEADERS_RECEIVED=2,is.LOADING=3,is.DONE=4;function qa(e){var i=ql();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function ql(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ol=function(e){(0,pn.Z)(r,e);var i=qa(r);function r(n){var a;return(0,lt.Z)(this,r),a=i.call(this,n),(0,I.Z)((0,xe.Z)(a),"touches",void 0),(0,I.Z)((0,xe.Z)(a),"targetTouches",void 0),(0,I.Z)((0,xe.Z)(a),"changedTouches",void 0),a.touches=[],a.targetTouches=[],a.changedTouches=[],a.target=ho(),a.currentTarget=ho(),a}return(0,It.Z)(r)}(Zo);function lu(e){var i=e||{},r=i.x,n=r===void 0?0:r,a=i.y,s=a===void 0?0:a,h=i.clientX,m=h===void 0?0:h,y=i.clientY,b=y===void 0?0:y;Object.keys(e).indexOf("x")!==-1?(e.pageX=e.clientX=n,e.pageY=e.clientY=s):(e.x=m,e.y=b)}function Fi(e){return function(i){var r=new Ol(e);r.changedTouches=i.changedTouches,r.touches=i.touches,r.targetTouches=Array.prototype.slice.call(i.touches),r.timeStamp=i.timeStamp,r.changedTouches.forEach(function(n){return lu(n)}),r.touches.forEach(function(n){return lu(n)}),r.targetTouches.forEach(function(n){return lu(n)}),ns.dispatchEvent(r)}}function Ba(e){return function(i){i.type=e,ns.dispatchEvent(i)}}var Bs=Fi("touchstart"),Qc=Fi("touchmove"),ml=Fi("touchend"),ef=Ba("mapCameaParams");function Xh(e){var i=Yh();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function Yh(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Mc=function(e){(0,pn.Z)(r,e);var i=Xh(r);function r(n){var a;return(0,lt.Z)(this,r),a=i.call(this,n),(0,I.Z)((0,xe.Z)(a),"buttons",void 0),(0,I.Z)((0,xe.Z)(a),"which",void 0),(0,I.Z)((0,xe.Z)(a),"pointerId",void 0),(0,I.Z)((0,xe.Z)(a),"bubbles",void 0),(0,I.Z)((0,xe.Z)(a),"button",void 0),(0,I.Z)((0,xe.Z)(a),"width",void 0),(0,I.Z)((0,xe.Z)(a),"height",void 0),(0,I.Z)((0,xe.Z)(a),"pressure",void 0),(0,I.Z)((0,xe.Z)(a),"isPrimary",void 0),(0,I.Z)((0,xe.Z)(a),"pointerType",void 0),(0,I.Z)((0,xe.Z)(a),"altKey",void 0),(0,I.Z)((0,xe.Z)(a),"ctrlKey",void 0),(0,I.Z)((0,xe.Z)(a),"metaKey",void 0),(0,I.Z)((0,xe.Z)(a),"shiftKey",void 0),a.target=ho(),a.currentTarget=ho(),a}return(0,It.Z)(r)}(Zo),Kl=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","pageX","pageY","timeStamp"],$u=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,0,0,0],ko="touch";function $l(e,i,r){for(var n=new Mc(e),a=0;a<Kl.length;a++){var s=Kl[a];n[s]=i[s]||$u[a]}return n.type=e,n.target=ho(),n.currentTarget=ho(),n.buttons=Jl(e),n.which=n.buttons,n.pointerId=(i.identifier||0)+2,n.bubbles=!0,n.cancelable=!0,n.button=0,n.width=(i.radiusX||.5)*2,n.height=(i.radiusY||.5)*2,n.pressure=i.force||.5,n.isPrimary=yn(i),n.pointerType=ko,n.altKey=r.altKey,n.ctrlKey=r.ctrlKey,n.metaKey=r.metaKey,n.shiftKey=r.shiftKey,r.preventDefault&&(n.preventDefault=function(){r.preventDefault()}),n}function Jl(e){var i=0;return(e==="touchstart"||e==="touchmove"||e==="pointerdown"||e==="pointermove")&&(i=1),i}var Qa=null;function yn(e){return Qa===e.identifier}function lo(e){Qa===null&&(Qa=e.identifier)}function Ju(e){Qa===e.identifier&&(Qa=null)}function Qu(e){return function(i){for(var r=i.changedTouches,n=0;n<r.length;n++){var a=r[n];n===0&&e==="pointerdown"?lo(a):(e==="pointerup"||e==="pointercancel")&&Ju(a);var s=$l(e,a,i);ns.dispatchEvent(s)}}}var gu=Qu("pointerdown"),Ns=Qu("pointermove"),Rf=Qu("pointerup");function Kr(e){var i=tf();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function tf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Lf=function(e){(0,pn.Z)(r,e);var i=Kr(r);function r(n){return(0,lt.Z)(this,r),i.call(this,n)}return(0,It.Z)(r)}(Zo);function Ou(e){return function(i){i.type=e,ns.dispatchEvent(i)}}var Ga=Ou("mousedown"),zs=Ou("mousemove"),rf=Ou("mouseup"),Ru=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",Ms=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),wo=Ru||Ms,dh={atob:Rt,btoa:kr,devicePixelRatio:Qo,Blob:uo,document:ns,Element:Hu,Event:Zo,EventTarget:xo,HTMLCanvasElement:If,HTMLElement:Ss,HTMLMediaElement:Xu,HTMLVideoElement:vu,Image:mu,ImageData:fh,navigator:Wc,Node:Gu,requestAnimationFrame:Ac,cancelAnimationFrame:qc,screen:Xe,XMLHttpRequest:is,performance:Xc,URL:wc,WebGLRenderingContext:Tc,WebGL2RenderingContext:vl,addEventListener:function(i,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};ns.addEventListener(i,r,n)},removeEventListener:function(i,r,n){ns.removeEventListener(i,r)},dispatchEvent:function(i){ns.dispatchEvent(i)},innerWidth:Xe.availWidth,innerHeight:Xe.availHeight,setTimeout,clearTimeout,setInterval,clearInterval},ba=wo?dh:Ji,kf=wo?is:Ji.XMLHttpRequest,vh=wo?Fs:Ji.location;function Js(e){var i=e;return typeof e=="string"&&(i=ba.document.getElementById(e)),i}function Ps(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function Li(e){return Ps(e).split(/\s+/)}function yu(e){var i,r,n=ba==null||(i=ba.document)===null||i===void 0||(r=i.documentElement)===null||r===void 0?void 0:r.style;if(!n)return e[0];for(var a in e)if(e[a]&&e[a]in n)return e[a];return e[0]}function ma(e,i,r){var n=ba.document.createElement(e);return n.className=i||"",r&&r.appendChild(n),n}function po(e){var i=e.parentNode;i&&i.removeChild(e)}function Us(e,i){if(e.classList!==void 0)for(var r=Li(i),n=0,a=r.length;n<a;n++)e.classList.add(r[n]);else if(!Zs(e,i)){var s=js(e);vs(e,(s?s+" ":"")+i)}}function cu(e,i){e.classList!==void 0?e.classList.remove(i):vs(e,Ps((" "+js(e)+" ").replace(" "+i+" "," ")))}function Zs(e,i){if(e.classList!==void 0)return e.classList.contains(i);var r=js(e);return r.length>0&&new RegExp("(^|\\s)"+i+"(\\s|$)").test(r)}function vs(e,i){e instanceof HTMLElement?e.className=i:e.className.baseVal=i}function js(e){return e instanceof SVGElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function In(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}var An=yu(["transform","WebkitTransform"]);function Ql(e,i){e.style[An]=i}function ms(){if(typeof Event=="function")ba.dispatchEvent(new Event("resize"));else{var e=ba.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,ba,0),ba.dispatchEvent(e)}}function _u(e){var i=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log(`%c
`,i.join(""))}function es(){var e,i=ba.document.querySelector('meta[name="viewport"]');if(!i)return 1;var r=(e=i.content)===null||e===void 0?void 0:e.split(","),n=r.find(function(a){var s=a.split("="),h=(0,ne.Z)(s,2),m=h[0],y=h[1];return m==="initial-scale"});return n?n.split("=")[1]*1:1}var Aa=es()<1?1:ba.devicePixelRatio,Pc=R(14665);function Ic(e){return Function.toString.call(e).indexOf("[native code]")!==-1}var ga=R(51814);function Ia(e,i,r){return(0,ga.Z)()?Ia=Reflect.construct:Ia=function(a,s,h){var m=[null];m.push.apply(m,s);var y=Function.bind.apply(a,m),b=new y;return h&&(0,Pc.Z)(b,h.prototype),b},Ia.apply(null,arguments)}function Oc(e){var i=typeof Map=="function"?new Map:void 0;return Oc=function(n){if(n===null||!Ic(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof i!="undefined"){if(i.has(n))return i.get(n);i.set(n,a)}function a(){return Ia(n,arguments,(0,Yt.Z)(this).constructor)}return a.prototype=Object.create(n.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),(0,Pc.Z)(a,n)},Oc(e)}function Rl(e){var i=xu();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function xu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Qs=function(e){(0,pn.Z)(r,e);var i=Rl(r);function r(n,a,s){var h;return(0,lt.Z)(this,r),h=i.call(this,n),(0,I.Z)((0,xe.Z)(h),"status",void 0),(0,I.Z)((0,xe.Z)(h),"url",void 0),h.status=a,h.url=s,h.name=h.constructor.name,h.message=n,h}return(0,It.Z)(r,[{key:"toString",value:function(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}]),r}(Oc(Error));function Do(e){var i=new kf;i.open("GET",e.url,!0);for(var r in e.headers)e.headers.hasOwnProperty(r)&&i.setRequestHeader(r,e.headers[r]);return i.withCredentials=e.credentials==="include",i}var gl=function(i,r){var n=Do(i);return n.setRequestHeader("Accept","application/json"),n.onerror=function(){r(new Error(n.statusText))},n.onload=function(){if(n.status>=200&&n.status<300&&n.response){var a;try{a=JSON.parse(n.response)}catch(s){return r(s)}r(null,a)}else n.status===401?r(new Qs("".concat(n.statusText),n.status,i.url)):r(new Qs(n.statusText,n.status,i.url))},n.send(),n},bu=function(i,r){var n=Do(i);return n.responseType="arraybuffer",n.onerror=function(){r(new Error(n.statusText))},n.onload=function(){var a=n.response;if(a.byteLength===0&&n.status===200)return r(new Error("http status 200 returned without content."));n.status>=200&&n.status<300&&n.response?r(null,{data:a,cacheControl:n.getResponseHeader("Cache-Control"),expires:n.getResponseHeader("Expires")}):r(new Qs(n.statusText,n.status,i.url))},n.send(),n};function nf(e){var i=$window.document.createElement("a");return i.href=e,i.protocol===$window.document.location.protocol&&i.host===$window.document.location.host}var Ll="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",kl=function(i,r){return bu(i,function(n,a){if(n)r(n);else if(a){var s=new ba.Image;s.crossOrigin="anonymous";var h=ba.URL||ba.webkitURL;s.onload=function(){r(null,s),h.revokeObjectURL(s.src)};var m=new ba.Blob([new Uint8Array(a.data)],{type:"image/png"});s.src=a.data.byteLength?h.createObjectURL(m):Ll}})},Dl=2*Math.PI*6378137/2;function ec(e){var i=[Infinity,Infinity,-Infinity,-Infinity];return e.forEach(function(r){var n=r.coordinates;yl(i,n)}),i}function yl(e,i){return Array.isArray(i[0])?i.forEach(function(r){yl(e,r)}):(e[0]>i[0]&&(e[0]=i[0]),e[1]>i[1]&&(e[1]=i[1]),e[2]<i[0]&&(e[2]=i[0]),e[3]<i[1]&&(e[3]=i[1])),e}function mh(e,i){return el(e,i)}function el(e,i){return Array.isArray(e[0])?e.map(function(r){return el(r,i)}):i(e)}function Lu(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};e=af(e,i);var n=e[0],a=e[1],s=n*Dl/180,h=Math.log(Math.tan((90+a)*Math.PI/360))/(Math.PI/180);return h=h*Dl/180,r.enable&&(s=Number(s.toFixed(r.decimal)),h=Number(h.toFixed(r.decimal))),e.length===3?[s,h,e[2]]:[s,h]}function Df(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,r=e[0],n=e[1],a=r/Dl*180,s=n/Dl*180;return s=180/Math.PI*(2*Math.atan(Math.exp(s*Math.PI/180))-Math.PI/2),i!=null&&(a=Number(a.toFixed(i)),s=Number(s.toFixed(i))),e.length===3?[a,s,e[2]]:[a,s]}function _l(e){if(e==null)throw new Error("lng is required");return(e>180||e<-180)&&(e=e%360,e>180&&(e=-360+e),e<-180&&(e=360+e),e===0&&(e=0)),e}function eu(e){if(e==null)throw new Error("lat is required");return(e>90||e<-90)&&(e=e%180,e>90&&(e=-180+e),e<-90&&(e=180+e),e===0&&(e=0)),e}function af(e,i){if(i===!1)return e;var r=_l(e[0]),n=eu(e[1]);return n>85&&(n=85),n<-85&&(n=-85),e.length===3?[r,n,e[2]]:[r,n]}function Vs(e){var i=85.0511287798,r=Math.max(Math.min(i,e[1]),-i),n=256<<20,a=Math.PI/180,s=e[0]*a,h=r*a;h=Math.log(Math.tan(Math.PI/4+h/2));var m=.5/Math.PI,y=.5,b=-.5/Math.PI;return a=.5,s=n*(m*s+y),h=n*(b*h+a),[Math.floor(s),Math.floor(h)]}function gh(e){var i=.5/Math.PI,r=.5,n=-.5/Math.PI,a=.5,s=256<<20,h=_slicedToArray(e,2),m=h[0],y=h[1];m=(m/s-r)/i,y=(y/s-a)/n,y=(Math.atan(Math.pow(Math.E,y))-Math.PI/4)*2,a=Math.PI/180;var b=y/a,A=m/a;return[A,b]}function tc(e,i,r){var n=oi(i[1]-e[1]),a=oi(i[0]-e[0]),s=oi(e[1]),h=oi(i[1]),m=Math.pow(Math.sin(n/2),2)+Math.pow(Math.sin(a/2),2)*Math.cos(s)*Math.cos(h);return un(2*Math.atan2(Math.sqrt(m),Math.sqrt(1-m)),r="meters")}function l(e){var i=Math.PI/180,r=85.0511287798,n=6378137,a=Math.max(Math.min(r,e[1]),-r),s=Math.sin(a*i),h=n*e[0]*i,m=n*Math.log((1+s)/(1-s))/2;return[h,m]}function f(e,i){var r=Math.abs(e[1][1]-e[0][1])*i,n=Math.abs(e[1][0]-e[0][0])*i;return[[e[0][0]-n,e[0][1]-r],[e[1][0]+n,e[1][1]+r]]}function c(e,i){return e[0][0]<=i[0][0]&&e[0][1]<=i[0][1]&&e[1][0]>=i[1][0]&&e[1][1]>=i[1][1]}function d(e){return[[e[0],e[1]],[e[2],e[3]]]}function E(e,i){return Math.sqrt(Math.pow(e[0]-i[0],2)+Math.pow(e[1]-i[1],2))}function C(e,i){return e[0]*i[0]+e[1]*i[1]}function T(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function L(e,i){return Math.acos(C(e,i)/(T(e)*T(i)))*180/Math.PI}function Z(e,i){return i[0]>0?i[1]>0?90-Math.atan(i[1]/i[0])*180/Math.PI:90+Math.atan(-i[1]/i[0])*180/Math.PI:i[1]<0?180+(90-Math.atan(i[1]/i[0])*180/Math.PI):270+Math.atan(i[1]/-i[0])*180/Math.PI}function W(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100;if(!(!e||e.length<2)){for(var r=[0,1],n=0,a=[],s=0;s<e.length-1;s++){var h=e[s],m=e[s+1],y=E(h,m);n+=y;var b=[h[0]-m[0],h[1]-m[1]],A=Z(r,b);if(s>0){var P=a[s-1].rotation;P-A>360-P+A&&(A=A+360)}a.push({start:h,end:m,dis:y,rotation:A,duration:0})}return a.map(function(k){k.duration=i*(k.dis/n)}),a}}var fe=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,r=arguments.length>1?arguments[1]:void 0;(0,lt.Z)(this,e),(0,I.Z)(this,"limit",void 0),(0,I.Z)(this,"cache",void 0),(0,I.Z)(this,"destroy",void 0),(0,I.Z)(this,"order",void 0),this.limit=i,this.destroy=r||this.defaultDestroy,this.order=[],this.clear()}return(0,It.Z)(e,[{key:"clear",value:function(){var r=this;this.order.forEach(function(n){r.delete(n)}),this.cache={},this.order=[]}},{key:"get",value:function(r){var n=this.cache[r];return n&&(this.deleteOrder(r),this.appendOrder(r)),n}},{key:"set",value:function(r,n){this.cache[r]?(this.delete(r),this.cache[r]=n,this.appendOrder(r)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[r]=n,this.appendOrder(r))}},{key:"delete",value:function(r){var n=this.cache[r];n&&(this.deleteCache(r),this.deleteOrder(r),this.destroy(n,r))}},{key:"deleteCache",value:function(r){delete this.cache[r]}},{key:"deleteOrder",value:function(r){var n=this.order.findIndex(function(a){return a===r});n>=0&&this.order.splice(n,1)}},{key:"appendOrder",value:function(r){this.order.push(r)}},{key:"defaultDestroy",value:function(r,n){return null}}]),e}();function he(e,i){e.forEach(function(r){!i[r]||(i[r]=i[r].bind(i))})}var de=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16;(0,lt.Z)(this,e),(0,I.Z)(this,"duration",16),(0,I.Z)(this,"timestamp",new Date().getTime()),this.duration=i}return(0,It.Z)(e,[{key:"run",value:function(r){var n=new Date().getTime(),a=n-this.timestamp;this.timestamp=n,a>=this.duration&&r()}}]),e}(),Le=R(2650);function Re(e){return typeof e=="string"?!!Le.ZP(e):!1}function Be(e){var i=Le.ZP(e),r=[0,0,0,0];return i!=null&&(r[0]=i.r/255,r[1]=i.g/255,r[2]=i.b/255,r[3]=i.opacity),r}function Ae(e){var i=e&&e[0],r=e&&e[1],n=e&&e[2],a=i+r*256+n*65536-1;return a}function Ve(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function rt(e){var i=ba.document.createElement("canvas"),r=i.getContext("2d");i.width=256,i.height=1;for(var n=r.createLinearGradient(0,0,256,1),a=null,s=e.positions[0],h=e.positions[e.positions.length-1],m=0;m<e.colors.length;++m){var y=(e.positions[m]-s)/(h-s);n.addColorStop(y,e.colors[m])}return r.fillStyle=n,r.fillRect(0,0,256,1),a=new Uint8ClampedArray(r.getImageData(0,0,256,1).data),wo?{data:a,width:256,height:1}:new ImageData(a,256,1)}var xt;(function(e){e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e.LEFT="left",e.RIGHT="right"})(xt||(xt={}));var Wt={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Vt(e,i,r){var n=e.classList;for(var a in Wt)Wt.hasOwnProperty(a)&&n.remove("l7-".concat(r,"-anchor-").concat(a));n.add("l7-".concat(r,"-anchor-").concat(i))}function Ot(e,i){return{enable:e,mask:255,func:{cmp:514,ref:i?1:0,mask:255}}}function vr(e){if(e.length===0)throw new Error("max requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]>i&&(i=e[r]);return i*1}function Br(e){if(e.length===0)throw new Error("min requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]<i&&(i=e[r]);return i*1}function Dr(e){if(e.length===0)return 0;for(var i=e[0]*1,r=1;r<e.length;r++)i+=e[r]*1;return i}function an(e){if(e.length===0)throw new Error("mean requires at least one data point");return Dr(e)/e.length}function Bn(e){if(e.length===0)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var i=e[0],r=NaN,n=0,a=1,s=1;s<e.length+1;s++)e[s]!==i?(a>n&&(n=a,r=i),a=1,i=e[s]):a++;return r*1}var kn={min:Br,max:vr,mean:an,sum:Dr,mode:Bn};function Nn(e,i){return e.map(function(r){return r[i]})}function Bi(e,i){return kn[e](i)}function on(e,i){var r=i.extent,n=r===void 0?[121.168,30.2828,121.384,30.4219]:r,a=new Promise(function(h){si(e,function(m){h(m)})}),s={originData:e,images:a,_id:1,dataArray:[{_id:0,coordinates:[[n[0],n[1]],[n[2],n[3]]]}]};return s}function si(e,i){var r=e,n=[];if(typeof r=="string")kl({url:r},function(h,m){n.push(m),i(n)});else{var a=r.length,s=0;r.forEach(function(h){kl({url:h},function(m,y){s++,n.push(y),s===a&&i(n)})})}return on}function hi(e,i){var r=i.extent,n=i.width,a=i.height,s=i.min,h=i.max,m={_id:1,dataArray:[{_id:1,data:Array.from(e),width:n,height:a,min:s,max:h,coordinates:[[r[0],r[1]],[r[2],r[3]]]}]};return m}var ri=R(30236),Hn=R.n(ri),mi=R(47037),Rn=R.n(mi),Wn=R(23560),Ha=R.n(Wn),eo=R(50361),bo=R.n(eo),To=R(34155);/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function to(e,i,r,n){function a(s){return s instanceof r?s:new r(function(h){h(s)})}return new(r||(r=Promise))(function(s,h){function m(A){try{b(n.next(A))}catch(P){h(P)}}function y(A){try{b(n.throw(A))}catch(P){h(P)}}function b(A){A.done?s(A.value):a(A.value).then(m,y)}b((n=n.apply(e,i||[])).next())})}function vo(e,i){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,a,s,h;return h={next:m(0),throw:m(1),return:m(2)},typeof Symbol=="function"&&(h[Symbol.iterator]=function(){return this}),h;function m(b){return function(A){return y([b,A])}}function y(b){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(s=b[0]&2?a.return:b[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,b[1])).done)return s;switch(a=0,s&&(b=[b[0]&2,s.value]),b[0]){case 0:case 1:s=b;break;case 4:return r.label++,{value:b[1],done:!1};case 5:r.label++,a=b[1],b=[0];continue;case 7:b=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(b[0]===6||b[0]===2)){r=0;continue}if(b[0]===3&&(!s||b[1]>s[0]&&b[1]<s[3])){r.label=b[1];break}if(b[0]===6&&r.label<s[1]){r.label=s[1],s=b;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(b);break}s[2]&&r.ops.pop(),r.trys.pop();continue}b=i.call(e,r)}catch(A){b=[6,A],a=0}finally{n=s=0}if(b[0]&5)throw b[1];return{value:b[0]?b[1]:void 0,done:!0}}}function Is(e,i){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),a,s=[],h;try{for(;(i===void 0||i-- >0)&&!(a=n.next()).done;)s.push(a.value)}catch(m){h={error:m}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(h)throw h.error}}return s}function gs(){for(var e=[],i=0;i<arguments.length;i++)e=e.concat(Is(arguments[i]));return e}function Va(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function ca(e,i){return i={exports:{}},e(i,i.exports),i.exports}var Os=ca(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){return n&&typeof n.length=="number"&&n.length>=0&&n.length%1==0}e.exports=i.default});Va(Os);var Gs=ca(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(r){return function(){for(var n=[],a=arguments.length;a--;)n[a]=arguments[a];var s=n.pop();return r.call(this,n,s)}},e.exports=i.default});Va(Gs);var Eu=ca(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.fallback=a,i.wrap=s;var r=i.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,n=i.hasNextTick=typeof To=="object"&&typeof To.nextTick=="function";function a(m){setTimeout(m,0)}function s(m){return function(y){for(var b=[],A=arguments.length-1;A-- >0;)b[A]=arguments[A+1];return m(function(){return y.apply(void 0,b)})}}var h;r?h=setImmediate:n?h=To.nextTick:h=a,i.default=s(h)});Va(Eu);var rc=Eu.fallback,tl=Eu.wrap,nc=Eu.hasSetImmediate,Rc=Eu.hasNextTick,tu=ca(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=s;var r=a(Gs),n=a(Eu);function a(y){return y&&y.__esModule?y:{default:y}}function s(y){return(0,ys.isAsync)(y)?function(){for(var b=[],A=arguments.length;A--;)b[A]=arguments[A];var P=b.pop(),k=y.apply(this,b);return h(k,P)}:(0,r.default)(function(b,A){var P;try{P=y.apply(this,b)}catch(k){return A(k)}if(P&&typeof P.then=="function")return h(P,A);A(null,P)})}function h(y,b){return y.then(function(A){m(b,null,A)},function(A){m(b,A&&A.message?A:new Error(A))})}function m(y,b,A){try{y(b,A)}catch(P){(0,n.default)(function(k){throw k},P)}}e.exports=i.default});Va(tu);var ys=ca(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.isAsyncIterable=i.isAsyncGenerator=i.isAsync=void 0;var r=n(tu);function n(y){return y&&y.__esModule?y:{default:y}}function a(y){return y[Symbol.toStringTag]==="AsyncFunction"}function s(y){return y[Symbol.toStringTag]==="AsyncGenerator"}function h(y){return typeof y[Symbol.asyncIterator]=="function"}function m(y){if(typeof y!="function")throw new Error("expected a function");return a(y)?(0,r.default)(y):y}i.default=m,i.isAsync=a,i.isAsyncGenerator=s,i.isAsyncIterable=h});Va(ys);var ku=ys.isAsyncIterable,Fo=ys.isAsyncGenerator,rl=ys.isAsync,Hs=ca(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n,a){if(a===void 0&&(a=n.length),!a)throw new Error("arity is undefined");function s(){for(var h=this,m=[],y=arguments.length;y--;)m[y]=arguments[y];return typeof m[a-1]=="function"?n.apply(this,m):new Promise(function(b,A){m[a-1]=function(P){for(var k=[],F=arguments.length-1;F-- >0;)k[F]=arguments[F+1];if(P)return A(P);b(k.length>1?k:k[0])},n.apply(h,m)})}return Object.defineProperty(s,"name",{configurable:!0,value:"awaitable("+n.name+")"}),s}e.exports=i.default});Va(Hs);var Su=ca(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=s(Os),n=s(ys),a=s(Hs);function s(h){return h&&h.__esModule?h:{default:h}}i.default=(0,a.default)(function(h,m,y){var b=(0,r.default)(m)?[]:{};h(m,function(A,P,k){(0,n.default)(A)(function(F){for(var q,oe=[],ue=arguments.length-1;ue-- >0;)oe[ue]=arguments[ue+1];oe.length<2&&(q=oe,oe=q[0]),b[P]=oe,k(F)})},function(A){return y(A,b)})},3),e.exports=i.default});Va(Su);var Qi=ca(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){function a(){for(var s=[],h=arguments.length;h--;)s[h]=arguments[h];if(n!==null){var m=n;n=null,m.apply(this,s)}}return Object.assign(a,n),a}e.exports=i.default});Va(Qi);var Rs=ca(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(r){return r[Symbol.iterator]&&r[Symbol.iterator]()},e.exports=i.default});Va(Rs);var as=ca(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=y;var r=a(Os),n=a(Rs);function a(b){return b&&b.__esModule?b:{default:b}}function s(b){var A=-1,P=b.length;return function(){return++A<P?{value:b[A],key:A}:null}}function h(b){var A=-1;return function(){var k=b.next();return k.done?null:(A++,{value:k.value,key:A})}}function m(b){var A=b?Object.keys(b):[],P=-1,k=A.length;return function(){var q=A[++P];return P<k?{value:b[q],key:q}:null}}function y(b){if((0,r.default)(b))return s(b);var A=(0,n.default)(b);return A?h(A):m(b)}e.exports=i.default});Va(as);var fu=ca(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){return function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];if(n===null)throw new Error("Callback was already called.");var h=n;n=null,h.apply(this,a)}}e.exports=i.default});Va(fu);var xl=ca(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r={};i.default=r,e.exports=i.default});Va(xl);var ic=ca(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=a;var r=n(xl);function n(s){return s&&s.__esModule?s:{default:s}}function a(s,h,m,y){var b=!1,A=!1,P=!1,k=0,F=0;function q(){k>=h||P||b||(P=!0,s.next().then(function(Pe){var et=Pe.value,at=Pe.done;if(!(A||b)){if(P=!1,at){b=!0,k<=0&&y(null);return}k++,m(et,F,oe),F++,q()}}).catch(ue))}function oe(Pe,et){if(k-=1,!A){if(Pe)return ue(Pe);if(Pe===!1){b=!0,A=!0;return}if(et===r.default||b&&k<=0)return b=!0,y(null);q()}}function ue(Pe){A||(P=!1,b=!0,y(Pe))}q()}e.exports=i.default});Va(ic);var Lc=ca(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=m(Qi),n=m(as),a=m(fu),s=m(ic),h=m(xl);function m(y){return y&&y.__esModule?y:{default:y}}i.default=function(y){return function(b,A,P){if(P=(0,r.default)(P),y<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!b)return P(null);if((0,ys.isAsyncGenerator)(b))return(0,s.default)(b,y,A,P);if((0,ys.isAsyncIterable)(b))return(0,s.default)(b[Symbol.asyncIterator](),y,A,P);var k=(0,n.default)(b),F=!1,q=!1,oe=0,ue=!1;function Pe(at,_t){if(!q)if(oe-=1,at)F=!0,P(at);else if(at===!1)F=!0,q=!0;else{if(_t===h.default||F&&oe<=0)return F=!0,P(null);ue||et()}}function et(){for(ue=!0;oe<y&&!F;){var at=k();if(at===null){F=!0,oe<=0&&P(null);return}oe+=1,A(at.value,at.key,(0,a.default)(Pe))}ue=!1}et()}},e.exports=i.default});Va(Lc);var Ls=ca(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=s(Lc),n=s(ys),a=s(Hs);function s(m){return m&&m.__esModule?m:{default:m}}function h(m,y,b,A){return(0,r.default)(y)(m,(0,n.default)(b),A)}i.default=(0,a.default)(h,4),e.exports=i.default});Va(Ls);var Fl=ca(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=a(Ls),n=a(Hs);function a(h){return h&&h.__esModule?h:{default:h}}function s(h,m,y){return(0,r.default)(h,1,m,y)}i.default=(0,n.default)(s,3),e.exports=i.default});Va(Fl);var hu=ca(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=s;var r=a(Su),n=a(Fl);function a(h){return h&&h.__esModule?h:{default:h}}function s(h,m){return(0,r.default)(n.default,h,m)}e.exports=i.default}),nl=Va(hu),Ws=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return this.args=r,nl(this.tasks)},e.prototype.tap=function(i,r){var n=this;this.tasks.push(function(a){r.apply(void 0,gs(n.args)),a(null,i)})},e}(),pu=ca(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=b(Os),n=b(xl),a=b(Ls),s=b(Qi),h=b(fu),m=b(ys),y=b(Hs);function b(F){return F&&F.__esModule?F:{default:F}}function A(F,q,oe){oe=(0,s.default)(oe);var ue=0,Pe=0,et=F.length,at=!1;et===0&&oe(null);function _t(Nt,Ht){Nt===!1&&(at=!0),at!==!0&&(Nt?oe(Nt):(++Pe===et||Ht===n.default)&&oe(null))}for(;ue<et;ue++)q(F[ue],ue,(0,h.default)(_t))}function P(F,q,oe){return(0,a.default)(F,Infinity,q,oe)}function k(F,q,oe){var ue=(0,r.default)(F)?A:P;return ue(F,(0,m.default)(q),oe)}i.default=(0,y.default)(k,3),e.exports=i.default});Va(pu);var Go=ca(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=s;var r=a(pu),n=a(Su);function a(h){return h&&h.__esModule?h:{default:h}}function s(h,m){return(0,n.default)(r.default,h,m)}e.exports=i.default}),kc=Va(Go),Ff=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.tasks=[]}return e.prototype.promise=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return kc(this.tasks)},e.prototype.tapPromise=function(i,r){var n=this;this.tasks.push(function(a){return to(n,void 0,void 0,function(){return vo(this,function(s){switch(s.label){case 0:return[4,r()];case 1:return s.sent(),a(null,i),[2]}})})})},e}(),yh=ca(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=h(Qi),n=h(fu),a=h(ys),s=h(Hs);function h(y){return y&&y.__esModule?y:{default:y}}function m(y,b){if(b=(0,r.default)(b),!Array.isArray(y))return b(new Error("First argument to waterfall must be an array of functions"));if(!y.length)return b();var A=0;function P(F){var q=(0,a.default)(y[A++]);q.apply(void 0,F.concat([(0,n.default)(k)]))}function k(F){for(var q=[],oe=arguments.length-1;oe-- >0;)q[oe]=arguments[oe+1];if(F!==!1){if(F||A===y.length)return b.apply(void 0,[F].concat(q));P(q)}}P([])}i.default=(0,s.default)(m),e.exports=i.default}),Bf=Va(yh),qh=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return Bf(this.tasks)},e.prototype.tap=function(i,r){this.tasks.length===0?this.tasks.push(function(n){var a=r();n(a?null:!1,a)}):this.tasks.push(function(n,a){var s=r();a(s?null:!1,i)})},e}(),Nf=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return nl(this.tasks)},e.prototype.tap=function(i,r){this.tasks.push(function(n){var a=r();n(a,i)})},e}(),Cs=R(26729),of=R.n(Cs),_h=R(69848),Kh=R.n(_h);function bl(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Dc(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?bl(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):bl(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function $h(e,i){var r=i.radius,n=r===void 0?40:r,a=i.maxZoom,s=a===void 0?18:a,h=i.minZoom,m=h===void 0?0:h,y=i.zoom,b=y===void 0?2:y;if(e.pointIndex){var A=e.pointIndex.getClusters(e.extent,Math.floor(b));return e.dataArray=Ad(A),e}var P=new(Kh())({radius:n,minZoom:m,maxZoom:s}),k={type:"FeatureCollection",features:[]};return k.features=e.dataArray.map(function(F){return{type:"Feature",geometry:{type:"Point",coordinates:F.coordinates},properties:Dc({},F)}}),P.load(k.features),P}function Ad(e){return e.map(function(i,r){return Dc({coordinates:i.geometry.coordinates,_id:r+1},i.properties)})}function sf(e){if(e.length===0)throw new Error("max requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]>i&&(i=e[r]);return i}function Jh(e){if(e.length===0)throw new Error("min requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]<i&&(i=e[r]);return i}function Np(e){if(e.length===0)return 0;for(var i=e[0],r=0,n,a=1;a<e.length;a++)n=i+e[a]*1,Math.abs(i)>=Math.abs(e[a])?r+=i-n+e[a]:r+=e[a]-n+i,i=n;return i+r*1}function wd(e){if(e.length===0)throw new Error("mean requires at least one data point");return Np(e)/e.length}var zp={min:Jh,max:sf,mean:wd,sum:Np};function Qh(e,i){return e.map(function(r){return r[i]*1})}function Up(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Fc(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Up(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Up(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Td(e){var i=Bo();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function Bo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function xh(e,i){if(Array.isArray(i))return i}var Zp=function(e){(0,pn.Z)(r,e);var i=Td(r);function r(n,a){var s;return(0,lt.Z)(this,r),s=i.call(this),(0,I.Z)((0,xe.Z)(s),"data",void 0),(0,I.Z)((0,xe.Z)(s),"extent",void 0),(0,I.Z)((0,xe.Z)(s),"hooks",{init:new Ws}),(0,I.Z)((0,xe.Z)(s),"parser",{type:"geojson"}),(0,I.Z)((0,xe.Z)(s),"transforms",[]),(0,I.Z)((0,xe.Z)(s),"cluster",!1),(0,I.Z)((0,xe.Z)(s),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,I.Z)((0,xe.Z)(s),"mapService",void 0),(0,I.Z)((0,xe.Z)(s),"invalidExtent",!1),(0,I.Z)((0,xe.Z)(s),"originData",void 0),(0,I.Z)((0,xe.Z)(s),"rawData",void 0),(0,I.Z)((0,xe.Z)(s),"cfg",{}),(0,I.Z)((0,xe.Z)(s),"clusterIndex",void 0),s.originData=n,s.initCfg(a),s.hooks.init.tap("parser",function(){s.excuteParser()}),s.hooks.init.tap("cluster",function(){s.initCluster()}),s.hooks.init.tap("transform",function(){s.executeTrans()}),s.init(),s}return(0,It.Z)(r,[{key:"setData",value:function(a,s){this.rawData=a,this.originData=a,this.initCfg(s),this.init(),this.emit("update")}},{key:"getClusters",value:function(a){return this.clusterIndex.getClusters(this.caculClusterExtent(2),a)}},{key:"getClustersLeaves",value:function(a){return this.clusterIndex.getLeaves(a,Infinity)}},{key:"updateClusterData",value:function(a){var s=this,h=this.clusterOptions,m=h.method,y=m===void 0?"sum":m,b=h.field,A=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(a));this.clusterOptions.zoom=a,A.forEach(function(P){P.id||(P.properties.point_count=1)}),(b||Ha()(y))&&(A=A.map(function(P){var k=P.id;if(k){var F=s.clusterIndex.getLeaves(k,Infinity),q=F.map(function(Pe){return Pe.properties}),oe;if(Rn()(y)&&b){var ue=Qh(q,b);oe=zp[y](ue)}Ha()(y)&&(oe=y(q)),P.properties.stat=oe}else P.properties.point_count=1;return P})),this.data=jn("geojson")({type:"FeatureCollection",features:A}),this.executeTrans()}},{key:"getFeatureById",value:function(a){var s=this.parser.type,h=s===void 0?"geojson":s;if(h==="geojson"&&!this.cluster){var m=a<this.originData.features.length?this.originData.features[a]:"null",y=bo()(m);if(this.transforms.length!==0){var b=this.data.dataArray.find(function(A){return A._id===a});y.properties=b}return y}else return a<this.data.dataArray.length?this.data.dataArray[a]:"null"}},{key:"getFeatureId",value:function(a,s){var h=this.data.dataArray.find(function(m){return m[a]===name});return h==null?void 0:h._id}},{key:"destroy",value:function(){this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null}},{key:"caculClusterExtent",value:function(a){var s=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(s=f(d(this.extent),a)),s[0].concat(s[1])}},{key:"initCfg",value:function(a){this.cfg=Hn()(this.cfg,a,xh);var s=this.cfg;s&&(s.parser&&(this.parser=s.parser),s.transforms&&(this.transforms=s.transforms),this.cluster=s.cluster||!1,s.clusterOptions&&(this.cluster=!0,this.clusterOptions=Fc(Fc({},this.clusterOptions),s.clusterOptions)))}},{key:"excuteParser",value:function(){var a=this.parser,s=a.type||"geojson";if(s==="imagetile"){this.data={tileurl:this.originData,dataArray:[]};return}var h=jn(s);this.data=h(this.originData,a),this.extent=ec(this.data.dataArray),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3]}},{key:"executeTrans",value:function(){var a=this,s=this.transforms;s.forEach(function(h){var m=h.type,y=vi(m)(a.data,h);Object.assign(a.data,y)})}},{key:"initCluster",value:function(){if(!!this.cluster){var a=this.clusterOptions||{};this.clusterIndex=$h(this.data,a)}}},{key:"init",value:function(){this.hooks.init.call(this)}}]),r}(Cs.EventEmitter);function bh(e,i){var r=i.callback;return r&&(e.dataArray=e.dataArray.filter(r)),e}function zf(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Uf(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(b){throw b},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,h=!1,m;return{s:function(){r=r.call(e)},n:function(){var b=r.next();return s=b.done,b},e:function(b){h=!0,m=b},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(h)throw m}}}}function Uf(e,i){if(!!e){if(typeof e=="string")return Zf(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Zf(e,i)}}function Zf(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Bc=6378e3;function ac(e,i){var r=e.dataArray,n=i.size,a=n===void 0?10:n,s=a/(2*Math.PI*Bc)*(256<<20)/2,h=uf(r,a),m=h.gridHash,y=h.gridOffset,b=Sh(m,y,i);return{yOffset:s,xOffset:s,radius:s,type:"grid",dataArray:b}}function uf(e,i){var r=Infinity,n=-Infinity,a,s=zf(e),h;try{for(s.s();!(h=s.n()).done;){var m=h.value;a=m.coordinates[1],Number.isFinite(a)&&(r=a<r?a:r,n=a>n?a:n)}}catch(at){s.e(at)}finally{s.f()}var y=(r+n)/2,b=jf(i,y);if(b.xOffset<=0||b.yOffset<=0)return{gridHash:{},gridOffset:b};var A={},P=zf(e),k;try{for(P.s();!(k=P.n()).done;){var F=k.value,q=F.coordinates[1],oe=F.coordinates[0];if(Number.isFinite(q)&&Number.isFinite(oe)){var ue=Math.floor((q+90)/b.yOffset),Pe=Math.floor((oe+180)/b.xOffset),et="".concat(ue,"-").concat(Pe);A[et]=A[et]||{count:0,points:[]},A[et].count+=1,A[et].points.push(F)}}}catch(at){P.e(at)}finally{P.f()}return{gridHash:A,gridOffset:b}}function jf(e,i){var r=Eh(e),n=oc(i,e);return{yOffset:r,xOffset:n}}function Eh(e){return e/Bc*(180/Math.PI)}function oc(e,i){return i/Bc*(180/Math.PI)/Math.cos(e*Math.PI/180)}function Sh(e,i,r){return Object.keys(e).reduce(function(n,a,s){var h=a.split("-"),m=parseInt(h[0],10),y=parseInt(h[1],10),b={};if(r.field&&r.method){var A=Nn(e[a].points,r.field);b[r.method]=kn[r.method](A)}return Object.assign(b,{_id:s,coordinates:Vs([-180+i.xOffset*(y+.5),-90+i.yOffset*(m+.5)]),rawData:e[a].points,count:e[a].count}),n.push(b),n},[])}var El=Math.PI/3,Ch=[0,El,2*El,3*El,4*El,5*El];function lf(e){return e[0]}function cf(e){return e[1]}function ru(){var e=0,i=0,r=1,n=1,a=lf,s=cf,h,m,y;function b(P){var k={},F=[],q,oe=P.length;for(q=0;q<oe;++q)if(!(isNaN(Pe=+a.call(null,ue=P[q],q,P))||isNaN(et=+s.call(null,ue,q,P)))){var ue,Pe,et,at=Math.round(et=et/y),_t=Math.round(Pe=Pe/m-(at&1)/2),Nt=et-at;if(Math.abs(Nt)*3>1){var Ht=Pe-_t,nr=_t+(Pe<_t?-1:1)/2,mr=at+(et<at?-1:1),Hr=Pe-nr,fn=et-mr;Ht*Ht+Nt*Nt>Hr*Hr+fn*fn&&(_t=nr+(at&1?1:-1)/2,at=mr)}var Or=_t+"-"+at,Tn=k[Or];Tn?Tn.push(ue):(F.push(Tn=k[Or]=[ue]),Tn.x=(_t+(at&1)/2)*m,Tn.y=at*y)}return F}function A(P){var k=0,F=0;return Ch.map(function(q){var oe=Math.sin(q)*P,ue=-Math.cos(q)*P,Pe=oe-k,et=ue-F;return k=oe,F=ue,[Pe,et]})}return b.hexagon=function(P){return"m"+A(P==null?h:+P).join("l")+"z"},b.centers=function(){for(var P=[],k=Math.round(i/y),F=Math.round(e/m),q=k*y;q<n+h;q+=y,++k)for(var oe=F*m+(k&1)*m/2;oe<r+m/2;oe+=m)P.push([oe,q]);return P},b.mesh=function(){var P=A(h).slice(0,4).join("l");return b.centers().map(function(k){return"M"+k+"m"+P}).join("")},b.x=function(P){return arguments.length?(a=P,b):a},b.y=function(P){return arguments.length?(s=P,b):s},b.radius=function(P){return arguments.length?(h=+P,m=h*2*Math.sin(El),y=h*1.5,b):h},b.size=function(P){return arguments.length?(e=i=0,r=+P[0],n=+P[1],b):[r-e,n-i]},b.extent=function(P){return arguments.length?(e=+P[0][0],i=+P[0][1],r=+P[1][0],n=+P[1][1],b):[[e,i],[r,n]]},b.radius(1)}function ff(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function hf(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ff(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ff(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Vf=6378e3;function Gf(e,i){var r=e.dataArray,n=i.size,a=n===void 0?10:n,s=i.method,h=s===void 0?"sum":s,m=a/(2*Math.PI*Vf)*(256<<20)/2,y=r.map(function(k){var F=Vs(k.coordinates),q=(0,ne.Z)(F,2),oe=q[0],ue=q[1];return hf(hf({},k),{},{coordinates:[oe,ue]})}),b=ru().radius(m).x(function(k){return k.coordinates[0]}).y(function(k){return k.coordinates[1]}),A=b(y),P={dataArray:A.map(function(k,F){var q;if(i.field&&h){var oe=Nn(k,i.field);k[h]=kn[h](oe)}return q={},(0,I.Z)(q,i.method,k[h]),(0,I.Z)(q,"count",k.length),(0,I.Z)(q,"rawData",k),(0,I.Z)(q,"coordinates",[k.x,k.y]),(0,I.Z)(q,"_id",F),q}),radius:m,xOffset:m,yOffset:m,type:"hexagon"};return P}function Hf(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function il(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Hf(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Hf(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Nc(e,i){var r=i.sourceField,n=i.targetField,a=i.data,s={};return a.forEach(function(h){s[h[r]]=h}),e.dataArray=e.dataArray.map(function(h){var m=h[n];return il(il({},h),s[m])}),e}function jp(e,i){var r=i.callback;return r&&(e.dataArray=e.dataArray.map(r)),e}Xn("geojson",ou),Xn("image",on),Xn("csv",hs),Xn("json",Pi),Xn("raster",hi),qn("cluster",$h),qn("filter",bh),qn("join",Nc),qn("map",jp),qn("grid",ac),qn("hexagon",Gf);var Ah=Ii,Vp=Ja,Md=Zp,yv=R(28660),Lr=R(86700),Gp=R(84879),$t={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},pf=R(31745),al=R.n(pf);function ep(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Hp(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ep(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ep(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function ol(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=df(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(b){throw b},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,h=!1,m;return{s:function(){r=r.call(e)},n:function(){var b=r.next();return s=b.done,b},e:function(b){h=!0,m=b},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(h)throw m}}}}function df(e,i){if(!!e){if(typeof e=="string")return sc(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return sc(e,i)}}function sc(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Du=30;function Wp(e){var i=e.characterSet,r=e.getFontWidth,n=e.fontHeight,a=e.buffer,s=e.maxCanvasWidth,h=e.mapping,m=h===void 0?{}:h,y=e.xOffset,b=y===void 0?0:y,A=e.yOffset,P=A===void 0?0:A,k=0,F=b;Array.from(i).forEach(function(oe,ue){if(!m[oe]){var Pe=r(oe,ue);F+Du>s&&(F=0,k++),m[oe]={x:F,y:P+k*Du,width:Du,height:Du,advance:Pe},F+=Du}});var q=n+a*2;return{mapping:m,xOffset:F,yOffset:P+k*q,canvasHeight:wh(P+(k+1)*q)}}function tp(e,i,r){var n=0,a=0,s=0,h=[],m={},y=ol(e),b;try{for(y.s();!(b=y.n()).done;){var A=b.value;if(!m[A.id]){var P=A.size;n+P+i>r&&(Wf(m,h,a),n=0,a=s+a+i,s=0,h=[]),h.push({icon:A,xOffset:n}),n=n+P+i,s=Math.max(s,P)}}}catch(F){y.e(F)}finally{y.f()}h.length>0&&Wf(m,h,a);var k=wh(s+a+i);return{mapping:m,canvasHeight:k}}function Wf(e,i,r){var n=ol(i),a;try{for(n.s();!(a=n.n()).done;){var s=a.value,h=s.icon,m=s.xOffset;e[h.id]=Hp(Hp({},h),{},{x:m,y:r,image:h.image,width:h.width,height:h.height})}}catch(y){n.e(y)}finally{n.f()}}function wh(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var ya,Bl;function Mo(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=nu(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(b){throw b},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,h=!1,m;return{s:function(){r=r.call(e)},n:function(){var b=r.next();return s=b.done,b},e:function(b){h=!0,m=b},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(h)throw m}}}}function nu(e,i){if(!!e){if(typeof e=="string")return rp(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return rp(e,i)}}function rp(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function np(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ip(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?np(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):np(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Pd=vf(),Id="sans-serif",ap="normal",Od=24,Rd=3,Xf=.25,Xp=8,op=1024,Yf=1,La=1,sp=3,uc=null;function vf(){for(var e=[],i=32;i<128;i++)e.push(String.fromCharCode(i));return e}function Th(e,i,r,n){e.font="".concat(n," ").concat(r,"px ").concat(i),e.fillStyle="black",e.textBaseline="middle"}function Yp(e,i){for(var r=0;r<e.length;r++)i.data[4*r+3]=e[r]}var z=(ya=(0,Lr.b2)(),ya(Bl=function(){function e(){(0,lt.Z)(this,e),(0,I.Z)(this,"fontAtlas",void 0),(0,I.Z)(this,"iconFontMap",void 0),(0,I.Z)(this,"iconFontGlyphs",{}),(0,I.Z)(this,"fontOptions",void 0),(0,I.Z)(this,"key",void 0),(0,I.Z)(this,"cache",new fe(sp))}return(0,It.Z)(e,[{key:"scale",get:function(){return La}},{key:"canvas",get:function(){var r=this.cache.get(this.key);return r&&r.data}},{key:"mapping",get:function(){var r=this.cache.get(this.key);return r&&r.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:Id,fontWeight:ap,characterSet:Pd,fontSize:Od,buffer:Rd,sdf:!0,cutoff:Xf,radius:Xp,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(r){var n=this;r.forEach(function(a){n.iconFontGlyphs[a.name]=a.unicode})}},{key:"addIconFont",value:function(r,n){this.iconFontMap.set(r,n)}},{key:"getIconFontKey",value:function(r){return this.iconFontMap.get(r)||r}},{key:"getGlyph",value:function(r){return this.iconFontGlyphs[r]?String.fromCharCode(parseInt(this.iconFontGlyphs[r],16)):""}},{key:"setFontOptions",value:function(r){this.fontOptions=ip(ip({},this.fontOptions),r),this.key=this.getKey();var n=this.getNewChars(this.key,this.fontOptions.characterSet),a=this.cache.get(this.key);if(!(a&&n.length===0)){var s=this.generateFontAtlas(this.key,n,a);this.fontAtlas=s,this.cache.set(this.key,s)}}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(r,n,a){var s=this.fontOptions,h=s.fontFamily,m=s.fontWeight,y=s.fontSize,b=s.buffer,A=s.sdf,P=s.radius,k=s.cutoff,F=s.iconfont,q=a&&a.data;q||(q=ba.document.createElement("canvas"),q.width=op);var oe=q.getContext("2d");Th(oe,h,y,m);var ue=Wp(ip({getFontWidth:function(Tu){return oe.measureText(Tu).width},fontHeight:y*La,buffer:b,characterSet:n,maxCanvasWidth:op},a&&{mapping:a.mapping,xOffset:a.xOffset,yOffset:a.yOffset})),Pe=ue.mapping,et=ue.canvasHeight,at=ue.xOffset,_t=ue.yOffset,Nt=oe.getImageData(0,0,q.width,q.height);if(q.height=et,oe.putImageData(Nt,0,0),Th(oe,h,y,m),A){var Ht=new(al())(y,b,P,k,h,m),nr=oe.getImageData(0,0,Ht.size,Ht.size),mr=Mo(n),Hr;try{for(mr.s();!(Hr=mr.n()).done;){var fn=Hr.value;if(F){var Or=String.fromCharCode(parseInt(fn.replace("&#x","").replace(";",""),16)),Tn=Ht.draw(Or);Yp(Tn,nr)}else Yp(Ht.draw(fn),nr);oe.putImageData(nr,Pe[fn].x,Pe[fn].y)}}catch(rs){mr.e(rs)}finally{mr.f()}}else{var zn=Mo(n),gi;try{for(zn.s();!(gi=zn.n()).done;){var io=gi.value;oe.fillText(io,Pe[io].x,Pe[io].y+y*Yf)}}catch(rs){zn.e(rs)}finally{zn.f()}}return{xOffset:at,yOffset:_t,mapping:Pe,data:q,width:q.width,height:q.height}}},{key:"getKey",value:function(){return"key";var r,n,a,s,h,m,y,b}},{key:"getNewChars",value:function(r,n){var a=this.cache.get(r);if(!a)return n;var s=[],h=a.mapping,m=new Set(Object.keys(h)),y=new Set(n);return y.forEach(function(b){m.has(b)||s.push(b)}),s}}]),e}())||Bl),me,ze;function Ft(e){var i=lr();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function lr(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Lt=3,er=1024,fr=64,_r=(me=(0,Lr.b2)(),me(ze=function(e){(0,pn.Z)(r,e);var i=Ft(r);function r(){var n;(0,lt.Z)(this,r);for(var a=arguments.length,s=new Array(a),h=0;h<a;h++)s[h]=arguments[h];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,xe.Z)(n),"canvasHeight",128),(0,I.Z)((0,xe.Z)(n),"texture",void 0),(0,I.Z)((0,xe.Z)(n),"canvas",void 0),(0,I.Z)((0,xe.Z)(n),"iconData",void 0),(0,I.Z)((0,xe.Z)(n),"iconMap",void 0),(0,I.Z)((0,xe.Z)(n),"ctx",void 0),(0,I.Z)((0,xe.Z)(n),"loadingImageCount",0),n}return(0,It.Z)(r,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=ba.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(a,s){var h=this,m=new Image;if(this.loadingImageCount++,this.hasImage(a))throw new Error("Image Id already exists");this.iconData.push({id:a,size:fr}),this.updateIconMap(),this.loadImage(s).then(function(y){m=y;var b=h.iconData.find(function(A){return A.id===a});b&&(b.image=m,b.width=m.width,b.height=m.height),h.update()})}},{key:"addImageMini",value:function(a,s,h){var m=this,y=h.getSceneConfig().canvas,b=y.createImage();if(this.loadingImageCount++,this.hasImage(a))throw new Error("Image Id already exists");this.iconData.push({id:a,size:fr}),this.updateIconMap(),this.loadImageMini(s,y).then(function(A){b=A;var P=m.iconData.find(function(k){return k.id===a});P&&(P.image=b,P.width=b.width,P.height=b.height),m.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(a){return this.iconMap.hasOwnProperty(a)}},{key:"removeImage",value:function(a){this.hasImage(a)&&(this.iconData=this.iconData.filter(function(s){return s.id!==a}),delete this.iconMap[a],this.update())}},{key:"destroy",value:function(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var a=this;this.canvas.width=er,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(s){var h=a.iconMap[s],m=h.x,y=h.y,b=h.image,A=h.width,P=A===void 0?64:A,k=h.height,F=k===void 0?64:k,q=Math.max(P,F),oe=q/fr,ue=F/oe,Pe=P/oe;b&&a.ctx.drawImage(b,m+(fr-Pe)/2,y+(fr-ue)/2,Pe,ue)})}},{key:"updateIconMap",value:function(){var a=tp(this.iconData,Lt,er),s=a.mapping,h=a.canvasHeight;this.iconMap=s,this.canvasHeight=h}},{key:"loadImage",value:function(a){return new Promise(function(s,h){if(a instanceof HTMLImageElement){s(a);return}var m=new Image;m.crossOrigin="anonymous",m.onload=function(){s(m)},m.onerror=function(){h(new Error("Could not load image at "+a))},m.src=a instanceof File?URL.createObjectURL(a):a})}},{key:"loadImageMini",value:function(a,s){return new Promise(function(h,m){var y=s.createImage();y.crossOrigin="anonymous",y.onload=function(){h(y)},y.onerror=function(){m(new Error("Could not load image at "+a))},y.src=a})}}]),r}(Cs.EventEmitter))||ze),rr=R(49685);function Sr(){var e=new rr.WT(16);return rr.WT!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function Rr(e){var i=new rr.WT(16);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function jr(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function Er(e,i,r,n,a,s,h,m,y,b,A,P,k,F,q,oe){var ue=new rr.WT(16);return ue[0]=e,ue[1]=i,ue[2]=r,ue[3]=n,ue[4]=a,ue[5]=s,ue[6]=h,ue[7]=m,ue[8]=y,ue[9]=b,ue[10]=A,ue[11]=P,ue[12]=k,ue[13]=F,ue[14]=q,ue[15]=oe,ue}function Mr(e,i,r,n,a,s,h,m,y,b,A,P,k,F,q,oe,ue){return e[0]=i,e[1]=r,e[2]=n,e[3]=a,e[4]=s,e[5]=h,e[6]=m,e[7]=y,e[8]=b,e[9]=A,e[10]=P,e[11]=k,e[12]=F,e[13]=q,e[14]=oe,e[15]=ue,e}function ut(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Xt(e,i){if(e===i){var r=i[1],n=i[2],a=i[3],s=i[6],h=i[7],m=i[11];e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=r,e[6]=i[9],e[7]=i[13],e[8]=n,e[9]=s,e[11]=i[14],e[12]=a,e[13]=h,e[14]=m}else e[0]=i[0],e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=i[1],e[5]=i[5],e[6]=i[9],e[7]=i[13],e[8]=i[2],e[9]=i[6],e[10]=i[10],e[11]=i[14],e[12]=i[3],e[13]=i[7],e[14]=i[11],e[15]=i[15];return e}function br(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],h=i[4],m=i[5],y=i[6],b=i[7],A=i[8],P=i[9],k=i[10],F=i[11],q=i[12],oe=i[13],ue=i[14],Pe=i[15],et=r*m-n*h,at=r*y-a*h,_t=r*b-s*h,Nt=n*y-a*m,Ht=n*b-s*m,nr=a*b-s*y,mr=A*oe-P*q,Hr=A*ue-k*q,fn=A*Pe-F*q,Or=P*ue-k*oe,Tn=P*Pe-F*oe,zn=k*Pe-F*ue,gi=et*zn-at*Tn+_t*Or+Nt*fn-Ht*Hr+nr*mr;return gi?(gi=1/gi,e[0]=(m*zn-y*Tn+b*Or)*gi,e[1]=(a*Tn-n*zn-s*Or)*gi,e[2]=(oe*nr-ue*Ht+Pe*Nt)*gi,e[3]=(k*Ht-P*nr-F*Nt)*gi,e[4]=(y*fn-h*zn-b*Hr)*gi,e[5]=(r*zn-a*fn+s*Hr)*gi,e[6]=(ue*_t-q*nr-Pe*at)*gi,e[7]=(A*nr-k*_t+F*at)*gi,e[8]=(h*Tn-m*fn+b*mr)*gi,e[9]=(n*fn-r*Tn-s*mr)*gi,e[10]=(q*Ht-oe*_t+Pe*et)*gi,e[11]=(P*_t-A*Ht-F*et)*gi,e[12]=(m*Hr-h*Or-y*mr)*gi,e[13]=(r*Or-n*Hr+a*mr)*gi,e[14]=(oe*at-q*Nt-ue*et)*gi,e[15]=(A*Nt-P*at+k*et)*gi,e):null}function zr(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],h=i[4],m=i[5],y=i[6],b=i[7],A=i[8],P=i[9],k=i[10],F=i[11],q=i[12],oe=i[13],ue=i[14],Pe=i[15];return e[0]=m*(k*Pe-F*ue)-P*(y*Pe-b*ue)+oe*(y*F-b*k),e[1]=-(n*(k*Pe-F*ue)-P*(a*Pe-s*ue)+oe*(a*F-s*k)),e[2]=n*(y*Pe-b*ue)-m*(a*Pe-s*ue)+oe*(a*b-s*y),e[3]=-(n*(y*F-b*k)-m*(a*F-s*k)+P*(a*b-s*y)),e[4]=-(h*(k*Pe-F*ue)-A*(y*Pe-b*ue)+q*(y*F-b*k)),e[5]=r*(k*Pe-F*ue)-A*(a*Pe-s*ue)+q*(a*F-s*k),e[6]=-(r*(y*Pe-b*ue)-h*(a*Pe-s*ue)+q*(a*b-s*y)),e[7]=r*(y*F-b*k)-h*(a*F-s*k)+A*(a*b-s*y),e[8]=h*(P*Pe-F*oe)-A*(m*Pe-b*oe)+q*(m*F-b*P),e[9]=-(r*(P*Pe-F*oe)-A*(n*Pe-s*oe)+q*(n*F-s*P)),e[10]=r*(m*Pe-b*oe)-h*(n*Pe-s*oe)+q*(n*b-s*m),e[11]=-(r*(m*F-b*P)-h*(n*F-s*P)+A*(n*b-s*m)),e[12]=-(h*(P*ue-k*oe)-A*(m*ue-y*oe)+q*(m*k-y*P)),e[13]=r*(P*ue-k*oe)-A*(n*ue-a*oe)+q*(n*k-a*P),e[14]=-(r*(m*ue-y*oe)-h*(n*ue-a*oe)+q*(n*y-a*m)),e[15]=r*(m*k-y*P)-h*(n*k-a*P)+A*(n*y-a*m),e}function hr(e){var i=e[0],r=e[1],n=e[2],a=e[3],s=e[4],h=e[5],m=e[6],y=e[7],b=e[8],A=e[9],P=e[10],k=e[11],F=e[12],q=e[13],oe=e[14],ue=e[15],Pe=i*h-r*s,et=i*m-n*s,at=i*y-a*s,_t=r*m-n*h,Nt=r*y-a*h,Ht=n*y-a*m,nr=b*q-A*F,mr=b*oe-P*F,Hr=b*ue-k*F,fn=A*oe-P*q,Or=A*ue-k*q,Tn=P*ue-k*oe;return Pe*Tn-et*Or+at*fn+_t*Hr-Nt*mr+Ht*nr}function Ar(e,i,r){var n=i[0],a=i[1],s=i[2],h=i[3],m=i[4],y=i[5],b=i[6],A=i[7],P=i[8],k=i[9],F=i[10],q=i[11],oe=i[12],ue=i[13],Pe=i[14],et=i[15],at=r[0],_t=r[1],Nt=r[2],Ht=r[3];return e[0]=at*n+_t*m+Nt*P+Ht*oe,e[1]=at*a+_t*y+Nt*k+Ht*ue,e[2]=at*s+_t*b+Nt*F+Ht*Pe,e[3]=at*h+_t*A+Nt*q+Ht*et,at=r[4],_t=r[5],Nt=r[6],Ht=r[7],e[4]=at*n+_t*m+Nt*P+Ht*oe,e[5]=at*a+_t*y+Nt*k+Ht*ue,e[6]=at*s+_t*b+Nt*F+Ht*Pe,e[7]=at*h+_t*A+Nt*q+Ht*et,at=r[8],_t=r[9],Nt=r[10],Ht=r[11],e[8]=at*n+_t*m+Nt*P+Ht*oe,e[9]=at*a+_t*y+Nt*k+Ht*ue,e[10]=at*s+_t*b+Nt*F+Ht*Pe,e[11]=at*h+_t*A+Nt*q+Ht*et,at=r[12],_t=r[13],Nt=r[14],Ht=r[15],e[12]=at*n+_t*m+Nt*P+Ht*oe,e[13]=at*a+_t*y+Nt*k+Ht*ue,e[14]=at*s+_t*b+Nt*F+Ht*Pe,e[15]=at*h+_t*A+Nt*q+Ht*et,e}function Vr(e,i,r){var n=r[0],a=r[1],s=r[2],h,m,y,b,A,P,k,F,q,oe,ue,Pe;return i===e?(e[12]=i[0]*n+i[4]*a+i[8]*s+i[12],e[13]=i[1]*n+i[5]*a+i[9]*s+i[13],e[14]=i[2]*n+i[6]*a+i[10]*s+i[14],e[15]=i[3]*n+i[7]*a+i[11]*s+i[15]):(h=i[0],m=i[1],y=i[2],b=i[3],A=i[4],P=i[5],k=i[6],F=i[7],q=i[8],oe=i[9],ue=i[10],Pe=i[11],e[0]=h,e[1]=m,e[2]=y,e[3]=b,e[4]=A,e[5]=P,e[6]=k,e[7]=F,e[8]=q,e[9]=oe,e[10]=ue,e[11]=Pe,e[12]=h*n+A*a+q*s+i[12],e[13]=m*n+P*a+oe*s+i[13],e[14]=y*n+k*a+ue*s+i[14],e[15]=b*n+F*a+Pe*s+i[15]),e}function On(e,i,r){var n=r[0],a=r[1],s=r[2];return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[3]=i[3]*n,e[4]=i[4]*a,e[5]=i[5]*a,e[6]=i[6]*a,e[7]=i[7]*a,e[8]=i[8]*s,e[9]=i[9]*s,e[10]=i[10]*s,e[11]=i[11]*s,e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function tr(e,i,r,n){var a=n[0],s=n[1],h=n[2],m=Math.hypot(a,s,h),y,b,A,P,k,F,q,oe,ue,Pe,et,at,_t,Nt,Ht,nr,mr,Hr,fn,Or,Tn,zn,gi,io;return m<rr.Ib?null:(m=1/m,a*=m,s*=m,h*=m,y=Math.sin(r),b=Math.cos(r),A=1-b,P=i[0],k=i[1],F=i[2],q=i[3],oe=i[4],ue=i[5],Pe=i[6],et=i[7],at=i[8],_t=i[9],Nt=i[10],Ht=i[11],nr=a*a*A+b,mr=s*a*A+h*y,Hr=h*a*A-s*y,fn=a*s*A-h*y,Or=s*s*A+b,Tn=h*s*A+a*y,zn=a*h*A+s*y,gi=s*h*A-a*y,io=h*h*A+b,e[0]=P*nr+oe*mr+at*Hr,e[1]=k*nr+ue*mr+_t*Hr,e[2]=F*nr+Pe*mr+Nt*Hr,e[3]=q*nr+et*mr+Ht*Hr,e[4]=P*fn+oe*Or+at*Tn,e[5]=k*fn+ue*Or+_t*Tn,e[6]=F*fn+Pe*Or+Nt*Tn,e[7]=q*fn+et*Or+Ht*Tn,e[8]=P*zn+oe*gi+at*io,e[9]=k*zn+ue*gi+_t*io,e[10]=F*zn+Pe*gi+Nt*io,e[11]=q*zn+et*gi+Ht*io,i!==e&&(e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e)}function ar(e,i,r){var n=Math.sin(r),a=Math.cos(r),s=i[4],h=i[5],m=i[6],y=i[7],b=i[8],A=i[9],P=i[10],k=i[11];return i!==e&&(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[4]=s*a+b*n,e[5]=h*a+A*n,e[6]=m*a+P*n,e[7]=y*a+k*n,e[8]=b*a-s*n,e[9]=A*a-h*n,e[10]=P*a-m*n,e[11]=k*a-y*n,e}function _n(e,i,r){var n=Math.sin(r),a=Math.cos(r),s=i[0],h=i[1],m=i[2],y=i[3],b=i[8],A=i[9],P=i[10],k=i[11];return i!==e&&(e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=s*a-b*n,e[1]=h*a-A*n,e[2]=m*a-P*n,e[3]=y*a-k*n,e[8]=s*n+b*a,e[9]=h*n+A*a,e[10]=m*n+P*a,e[11]=y*n+k*a,e}function Gr(e,i,r){var n=Math.sin(r),a=Math.cos(r),s=i[0],h=i[1],m=i[2],y=i[3],b=i[4],A=i[5],P=i[6],k=i[7];return i!==e&&(e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=s*a+b*n,e[1]=h*a+A*n,e[2]=m*a+P*n,e[3]=y*a+k*n,e[4]=b*a-s*n,e[5]=A*a-h*n,e[6]=P*a-m*n,e[7]=k*a-y*n,e}function wr(e,i){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function $r(e,i){return e[0]=i[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=i[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Jr(e,i,r){var n=r[0],a=r[1],s=r[2],h=Math.hypot(n,a,s),m,y,b;return h<rr.Ib?null:(h=1/h,n*=h,a*=h,s*=h,m=Math.sin(i),y=Math.cos(i),b=1-y,e[0]=n*n*b+y,e[1]=a*n*b+s*m,e[2]=s*n*b-a*m,e[3]=0,e[4]=n*a*b-s*m,e[5]=a*a*b+y,e[6]=s*a*b+n*m,e[7]=0,e[8]=n*s*b+a*m,e[9]=a*s*b-n*m,e[10]=s*s*b+y,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function yi(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ai(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function qr(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function en(e,i,r){var n=i[0],a=i[1],s=i[2],h=i[3],m=n+n,y=a+a,b=s+s,A=n*m,P=n*y,k=n*b,F=a*y,q=a*b,oe=s*b,ue=h*m,Pe=h*y,et=h*b;return e[0]=1-(F+oe),e[1]=P+et,e[2]=k-Pe,e[3]=0,e[4]=P-et,e[5]=1-(A+oe),e[6]=q+ue,e[7]=0,e[8]=k+Pe,e[9]=q-ue,e[10]=1-(A+F),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function $n(e,i){var r=new rr.WT(3),n=-i[0],a=-i[1],s=-i[2],h=i[3],m=i[4],y=i[5],b=i[6],A=i[7],P=n*n+a*a+s*s+h*h;return P>0?(r[0]=(m*h+A*n+y*s-b*a)*2/P,r[1]=(y*h+A*a+b*n-m*s)*2/P,r[2]=(b*h+A*s+m*a-y*n)*2/P):(r[0]=(m*h+A*n+y*s-b*a)*2,r[1]=(y*h+A*a+b*n-m*s)*2,r[2]=(b*h+A*s+m*a-y*n)*2),en(e,i,r),e}function pi(e,i){return e[0]=i[12],e[1]=i[13],e[2]=i[14],e}function Ni(e,i){var r=i[0],n=i[1],a=i[2],s=i[4],h=i[5],m=i[6],y=i[8],b=i[9],A=i[10];return e[0]=Math.hypot(r,n,a),e[1]=Math.hypot(s,h,m),e[2]=Math.hypot(y,b,A),e}function co(e,i){var r=new rr.WT(3);Ni(r,i);var n=1/r[0],a=1/r[1],s=1/r[2],h=i[0]*n,m=i[1]*a,y=i[2]*s,b=i[4]*n,A=i[5]*a,P=i[6]*s,k=i[8]*n,F=i[9]*a,q=i[10]*s,oe=h+A+q,ue=0;return oe>0?(ue=Math.sqrt(oe+1)*2,e[3]=.25*ue,e[0]=(P-F)/ue,e[1]=(k-y)/ue,e[2]=(m-b)/ue):h>A&&h>q?(ue=Math.sqrt(1+h-A-q)*2,e[3]=(P-F)/ue,e[0]=.25*ue,e[1]=(m+b)/ue,e[2]=(k+y)/ue):A>q?(ue=Math.sqrt(1+A-h-q)*2,e[3]=(k-y)/ue,e[0]=(m+b)/ue,e[1]=.25*ue,e[2]=(P+F)/ue):(ue=Math.sqrt(1+q-h-A)*2,e[3]=(m-b)/ue,e[0]=(k+y)/ue,e[1]=(P+F)/ue,e[2]=.25*ue),e}function mo(e,i,r,n){var a=i[0],s=i[1],h=i[2],m=i[3],y=a+a,b=s+s,A=h+h,P=a*y,k=a*b,F=a*A,q=s*b,oe=s*A,ue=h*A,Pe=m*y,et=m*b,at=m*A,_t=n[0],Nt=n[1],Ht=n[2];return e[0]=(1-(q+ue))*_t,e[1]=(k+at)*_t,e[2]=(F-et)*_t,e[3]=0,e[4]=(k-at)*Nt,e[5]=(1-(P+ue))*Nt,e[6]=(oe+Pe)*Nt,e[7]=0,e[8]=(F+et)*Ht,e[9]=(oe-Pe)*Ht,e[10]=(1-(P+q))*Ht,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function zi(e,i,r,n,a){var s=i[0],h=i[1],m=i[2],y=i[3],b=s+s,A=h+h,P=m+m,k=s*b,F=s*A,q=s*P,oe=h*A,ue=h*P,Pe=m*P,et=y*b,at=y*A,_t=y*P,Nt=n[0],Ht=n[1],nr=n[2],mr=a[0],Hr=a[1],fn=a[2],Or=(1-(oe+Pe))*Nt,Tn=(F+_t)*Nt,zn=(q-at)*Nt,gi=(F-_t)*Ht,io=(1-(k+Pe))*Ht,rs=(ue+et)*Ht,Tu=(q+at)*nr,fl=(ue-et)*nr,Zu=(1-(k+oe))*nr;return e[0]=Or,e[1]=Tn,e[2]=zn,e[3]=0,e[4]=gi,e[5]=io,e[6]=rs,e[7]=0,e[8]=Tu,e[9]=fl,e[10]=Zu,e[11]=0,e[12]=r[0]+mr-(Or*mr+gi*Hr+Tu*fn),e[13]=r[1]+Hr-(Tn*mr+io*Hr+fl*fn),e[14]=r[2]+fn-(zn*mr+rs*Hr+Zu*fn),e[15]=1,e}function os(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],h=r+r,m=n+n,y=a+a,b=r*h,A=n*h,P=n*m,k=a*h,F=a*m,q=a*y,oe=s*h,ue=s*m,Pe=s*y;return e[0]=1-P-q,e[1]=A+Pe,e[2]=k-ue,e[3]=0,e[4]=A-Pe,e[5]=1-b-q,e[6]=F+oe,e[7]=0,e[8]=k+ue,e[9]=F-oe,e[10]=1-b-P,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ka(e,i,r,n,a,s,h){var m=1/(r-i),y=1/(a-n),b=1/(s-h);return e[0]=s*2*m,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s*2*y,e[6]=0,e[7]=0,e[8]=(r+i)*m,e[9]=(a+n)*y,e[10]=(h+s)*b,e[11]=-1,e[12]=0,e[13]=0,e[14]=h*s*2*b,e[15]=0,e}function Ho(e,i,r,n,a){var s=1/Math.tan(i/2),h;return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,a!=null&&a!==Infinity?(h=1/(n-a),e[10]=(a+n)*h,e[14]=2*a*n*h):(e[10]=-1,e[14]=-2*n),e}var Eo=Ho;function ts(e,i,r,n,a){var s=1/Math.tan(i/2),h;return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,a!=null&&a!==Infinity?(h=1/(n-a),e[10]=a*h,e[14]=a*n*h):(e[10]=-1,e[14]=-n),e}function Wo(e,i,r,n){var a=Math.tan(i.upDegrees*Math.PI/180),s=Math.tan(i.downDegrees*Math.PI/180),h=Math.tan(i.leftDegrees*Math.PI/180),m=Math.tan(i.rightDegrees*Math.PI/180),y=2/(h+m),b=2/(a+s);return e[0]=y,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=b,e[6]=0,e[7]=0,e[8]=-((h-m)*y*.5),e[9]=(a-s)*b*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e}function ss(e,i,r,n,a,s,h){var m=1/(i-r),y=1/(n-a),b=1/(s-h);return e[0]=-2*m,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*y,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*b,e[11]=0,e[12]=(i+r)*m,e[13]=(a+n)*y,e[14]=(h+s)*b,e[15]=1,e}var go=ss;function _i(e,i,r,n,a,s,h){var m=1/(i-r),y=1/(n-a),b=1/(s-h);return e[0]=-2*m,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*y,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=b,e[11]=0,e[12]=(i+r)*m,e[13]=(a+n)*y,e[14]=s*b,e[15]=1,e}function Xo(e,i,r,n){var a,s,h,m,y,b,A,P,k,F,q=i[0],oe=i[1],ue=i[2],Pe=n[0],et=n[1],at=n[2],_t=r[0],Nt=r[1],Ht=r[2];return Math.abs(q-_t)<rr.Ib&&Math.abs(oe-Nt)<rr.Ib&&Math.abs(ue-Ht)<rr.Ib?ut(e):(A=q-_t,P=oe-Nt,k=ue-Ht,F=1/Math.hypot(A,P,k),A*=F,P*=F,k*=F,a=et*k-at*P,s=at*A-Pe*k,h=Pe*P-et*A,F=Math.hypot(a,s,h),F?(F=1/F,a*=F,s*=F,h*=F):(a=0,s=0,h=0),m=P*h-k*s,y=k*a-A*h,b=A*s-P*a,F=Math.hypot(m,y,b),F?(F=1/F,m*=F,y*=F,b*=F):(m=0,y=0,b=0),e[0]=a,e[1]=m,e[2]=A,e[3]=0,e[4]=s,e[5]=y,e[6]=P,e[7]=0,e[8]=h,e[9]=b,e[10]=k,e[11]=0,e[12]=-(a*q+s*oe+h*ue),e[13]=-(m*q+y*oe+b*ue),e[14]=-(A*q+P*oe+k*ue),e[15]=1,e)}function na(e,i,r,n){var a=i[0],s=i[1],h=i[2],m=n[0],y=n[1],b=n[2],A=a-r[0],P=s-r[1],k=h-r[2],F=A*A+P*P+k*k;F>0&&(F=1/Math.sqrt(F),A*=F,P*=F,k*=F);var q=y*k-b*P,oe=b*A-m*k,ue=m*P-y*A;return F=q*q+oe*oe+ue*ue,F>0&&(F=1/Math.sqrt(F),q*=F,oe*=F,ue*=F),e[0]=q,e[1]=oe,e[2]=ue,e[3]=0,e[4]=P*ue-k*oe,e[5]=k*q-A*ue,e[6]=A*oe-P*q,e[7]=0,e[8]=A,e[9]=P,e[10]=k,e[11]=0,e[12]=a,e[13]=s,e[14]=h,e[15]=1,e}function us(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function ni(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function Ui(e,i,r){return e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e[3]=i[3]+r[3],e[4]=i[4]+r[4],e[5]=i[5]+r[5],e[6]=i[6]+r[6],e[7]=i[7]+r[7],e[8]=i[8]+r[8],e[9]=i[9]+r[9],e[10]=i[10]+r[10],e[11]=i[11]+r[11],e[12]=i[12]+r[12],e[13]=i[13]+r[13],e[14]=i[14]+r[14],e[15]=i[15]+r[15],e}function fa(e,i,r){return e[0]=i[0]-r[0],e[1]=i[1]-r[1],e[2]=i[2]-r[2],e[3]=i[3]-r[3],e[4]=i[4]-r[4],e[5]=i[5]-r[5],e[6]=i[6]-r[6],e[7]=i[7]-r[7],e[8]=i[8]-r[8],e[9]=i[9]-r[9],e[10]=i[10]-r[10],e[11]=i[11]-r[11],e[12]=i[12]-r[12],e[13]=i[13]-r[13],e[14]=i[14]-r[14],e[15]=i[15]-r[15],e}function Po(e,i,r){return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=i[3]*r,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[7]=i[7]*r,e[8]=i[8]*r,e[9]=i[9]*r,e[10]=i[10]*r,e[11]=i[11]*r,e[12]=i[12]*r,e[13]=i[13]*r,e[14]=i[14]*r,e[15]=i[15]*r,e}function Sl(e,i,r,n){return e[0]=i[0]+r[0]*n,e[1]=i[1]+r[1]*n,e[2]=i[2]+r[2]*n,e[3]=i[3]+r[3]*n,e[4]=i[4]+r[4]*n,e[5]=i[5]+r[5]*n,e[6]=i[6]+r[6]*n,e[7]=i[7]+r[7]*n,e[8]=i[8]+r[8]*n,e[9]=i[9]+r[9]*n,e[10]=i[10]+r[10]*n,e[11]=i[11]+r[11]*n,e[12]=i[12]+r[12]*n,e[13]=i[13]+r[13]*n,e[14]=i[14]+r[14]*n,e[15]=i[15]+r[15]*n,e}function Me(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]&&e[4]===i[4]&&e[5]===i[5]&&e[6]===i[6]&&e[7]===i[7]&&e[8]===i[8]&&e[9]===i[9]&&e[10]===i[10]&&e[11]===i[11]&&e[12]===i[12]&&e[13]===i[13]&&e[14]===i[14]&&e[15]===i[15]}function Bt(e,i){var r=e[0],n=e[1],a=e[2],s=e[3],h=e[4],m=e[5],y=e[6],b=e[7],A=e[8],P=e[9],k=e[10],F=e[11],q=e[12],oe=e[13],ue=e[14],Pe=e[15],et=i[0],at=i[1],_t=i[2],Nt=i[3],Ht=i[4],nr=i[5],mr=i[6],Hr=i[7],fn=i[8],Or=i[9],Tn=i[10],zn=i[11],gi=i[12],io=i[13],rs=i[14],Tu=i[15];return Math.abs(r-et)<=rr.Ib*Math.max(1,Math.abs(r),Math.abs(et))&&Math.abs(n-at)<=rr.Ib*Math.max(1,Math.abs(n),Math.abs(at))&&Math.abs(a-_t)<=rr.Ib*Math.max(1,Math.abs(a),Math.abs(_t))&&Math.abs(s-Nt)<=rr.Ib*Math.max(1,Math.abs(s),Math.abs(Nt))&&Math.abs(h-Ht)<=rr.Ib*Math.max(1,Math.abs(h),Math.abs(Ht))&&Math.abs(m-nr)<=rr.Ib*Math.max(1,Math.abs(m),Math.abs(nr))&&Math.abs(y-mr)<=rr.Ib*Math.max(1,Math.abs(y),Math.abs(mr))&&Math.abs(b-Hr)<=rr.Ib*Math.max(1,Math.abs(b),Math.abs(Hr))&&Math.abs(A-fn)<=rr.Ib*Math.max(1,Math.abs(A),Math.abs(fn))&&Math.abs(P-Or)<=rr.Ib*Math.max(1,Math.abs(P),Math.abs(Or))&&Math.abs(k-Tn)<=rr.Ib*Math.max(1,Math.abs(k),Math.abs(Tn))&&Math.abs(F-zn)<=rr.Ib*Math.max(1,Math.abs(F),Math.abs(zn))&&Math.abs(q-gi)<=rr.Ib*Math.max(1,Math.abs(q),Math.abs(gi))&&Math.abs(oe-io)<=rr.Ib*Math.max(1,Math.abs(oe),Math.abs(io))&&Math.abs(ue-rs)<=rr.Ib*Math.max(1,Math.abs(ue),Math.abs(rs))&&Math.abs(Pe-Tu)<=rr.Ib*Math.max(1,Math.abs(Pe),Math.abs(Tu))}var Ct=Ar,dn=fa,Zi,Se,ce=(Zi=(0,Lr.b2)(),Zi(Se=function(){function e(){(0,lt.Z)(this,e),(0,I.Z)(this,"viewport",void 0),(0,I.Z)(this,"overridedViewProjectionMatrix",void 0),(0,I.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,I.Z)(this,"jitteredProjectionMatrix",void 0),(0,I.Z)(this,"viewMatrixInverse",void 0),(0,I.Z)(this,"cameraPosition",void 0)}return(0,It.Z)(e,[{key:"init",value:function(){}},{key:"update",value:function(r){this.viewport=r,this.viewMatrixInverse=Sr(),br(this.viewMatrixInverse,r.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var r=this.viewport.getCenter(),n=(0,ne.Z)(r,2),a=n[0],s=n[1];return[a,s]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}},{key:"setViewProjectionMatrix",value:function(r){this.overridedViewProjectionMatrix=r}},{key:"jitterProjectionMatrix",value:function(r,n){var a=wr(Sr(),[r,n,0]);this.jitteredProjectionMatrix=Ar(Sr(),a,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=Ar(Sr(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}())||Se),He,ht;function Pt(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Je(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(b){throw b},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,h=!1,m;return{s:function(){r=r.call(e)},n:function(){var b=r.next();return s=b.done,b},e:function(b){h=!0,m=b},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(h)throw m}}}}function Je(e,i){if(!!e){if(typeof e=="string")return Ne(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ne(e,i)}}function Ne(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var it=(He=(0,Lr.b2)(),He(ht=function(){function e(){(0,lt.Z)(this,e),(0,I.Z)(this,"container",void 0),(0,I.Z)(this,"controlCorners",void 0),(0,I.Z)(this,"controlContainer",void 0),(0,I.Z)(this,"scene",void 0),(0,I.Z)(this,"mapsService",void 0),(0,I.Z)(this,"controls",[]),(0,I.Z)(this,"unAddControls",[])}return(0,It.Z)(e,[{key:"init",value:function(r,n){this.container=r.container,this.scene=n,this.mapsService=n.get($t.IMapService),this.initControlPos()}},{key:"addControl",value:function(r,n){var a=n.get($t.IMapService);a.map?(r.addTo(this.scene),this.controls.push(r)):this.unAddControls.push(r)}},{key:"getControlByName",value:function(r){return this.controls.find(function(n){return n.controlOption.name===r})}},{key:"removeControl",value:function(r){var n=this.controls.indexOf(r);return n>-1&&this.controls.splice(n,1),r.remove(),this}},{key:"addControls",value:function(){var r=this;this.unAddControls.forEach(function(n){n.addTo(r.scene),r.controls.push(n)}),this.unAddControls=[]}},{key:"destroy",value:function(){var r=Pt(this.controls),n;try{for(r.s();!(n=r.n()).done;){var a=n.value;a.remove()}}catch(s){r.e(s)}finally{r.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var r=this.controlCorners={},n="l7-",a=this.controlContainer=ma("div",n+"control-container",this.container);function s(){var h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],m=h.map(function(y){return n+y}).join(" ");r[h.join("")]=ma("div",m,a)}s(["top","left"]),s(["top","right"]),s(["bottom","left"]),s(["bottom","right"]),s(["top","center"]),s(["right","center"]),s(["left","center"]),s(["bottom","center"])}},{key:"clearControlPos",value:function(){for(var r in this.controlCorners)this.controlCorners[r]&&po(this.controlCorners[r]);this.controlContainer&&po(this.controlContainer),delete this.controlCorners,delete this.controlContainer}}]),e}())||ht),ye,je,we=(ye=(0,Lr.b2)(),ye(je=function(){function e(){(0,lt.Z)(this,e),(0,I.Z)(this,"container",void 0),(0,I.Z)(this,"scene",void 0),(0,I.Z)(this,"mapsService",void 0),(0,I.Z)(this,"markers",[]),(0,I.Z)(this,"markerLayers",[]),(0,I.Z)(this,"unAddMarkers",[]),(0,I.Z)(this,"unAddMarkerLayers",[])}return(0,It.Z)(e,[{key:"addMarkerLayer",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(r),r.addTo(this.scene)):this.unAddMarkerLayers.push(r)}},{key:"removeMarkerLayer",value:function(r){r.destroy(),this.markerLayers.indexOf(r);var n=this.markerLayers.indexOf(r);n>-1&&this.markerLayers.splice(n,1)}},{key:"addMarker",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(r),r.addTo(this.scene)):this.unAddMarkers.push(r)}},{key:"addMarkers",value:function(){var r=this;this.unAddMarkers.forEach(function(n){n.addTo(r.scene),r.markers.push(n)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var r=this;this.unAddMarkerLayers.forEach(function(n){r.markerLayers.push(n),n.addTo(r.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(r){r.remove(),this.markers.indexOf(r);var n=this.markers.indexOf(r);n>-1&&this.markers.splice(n,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get($t.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(r){r.remove()}),this.markers=[],this.markerLayers.forEach(function(r){r.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(r){r.destroy()}}]),e}())||je),pt,Et,pr=(pt=(0,Lr.b2)(),pt(Et=function(){function e(){(0,lt.Z)(this,e),(0,I.Z)(this,"scene",void 0),(0,I.Z)(this,"popup",void 0),(0,I.Z)(this,"mapsService",void 0),(0,I.Z)(this,"unAddPopup",void 0)}return(0,It.Z)(e,[{key:"removePopup",value:function(r){r.remove()}},{key:"destroy",value:function(){this.popup.remove()}},{key:"addPopup",value:function(r){this.popup&&this.popup.remove(),this.mapsService.map&&this.mapsService.getMarkerContainer()?(r.addTo(this.scene),this.popup=r):this.unAddPopup=r}},{key:"initPopup",value:function(){this.unAddPopup&&(this.addPopup(this.unAddPopup),this.unAddPopup=null)}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get($t.IMapService)}}]),e}())||Et),Ur=R(82492),Nr=R.n(Ur),tn={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo\u6D4B\u8BD5\u5730\u56FEtoken\uFF0C\u5982\u679C\u751F\u4EA7\u73AF\u5883\u4E2D\u4F7F\u7528\u53BB\u5BF9\u5E94\u5730\u56FE\u8BF7\u6CE8\u518CToken",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},Fr=tn,Sn,sn;function bn(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function vn(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?bn(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):bn(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var mn={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},Kn={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},wa=(Sn=(0,Lr.b2)(),Sn(sn=function(){function e(){(0,lt.Z)(this,e),(0,I.Z)(this,"sceneConfigCache",{}),(0,I.Z)(this,"layerConfigCache",{})}return(0,It.Z)(e,[{key:"getSceneConfig",value:function(r){return this.sceneConfigCache[r]}},{key:"getSceneWarninfo",value:function(r){return Fr[r]}},{key:"setSceneConfig",value:function(r,n){this.sceneConfigCache[r]=vn(vn({},mn),n)}},{key:"getLayerConfig",value:function(r){return this.layerConfigCache[r]}},{key:"setLayerConfig",value:function(r,n,a){this.layerConfigCache[n]=vn({},Nr()({},this.sceneConfigCache[r],Kn,a))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}())||sn);function Vn(e,i,r,n){!r||Object.defineProperty(e,i,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(n):void 0})}function wn(e,i,r,n,a){var s={};return Object.keys(n).forEach(function(h){s[h]=n[h]}),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=r.slice().reverse().reduce(function(h,m){return m(e,i,h)||h},s),a&&s.initializer!==void 0&&(s.value=s.initializer?s.initializer.call(a):void 0,s.initializer=void 0),s.initializer===void 0&&(Object.defineProperty(e,i,s),s=null),s}function ha(){var e=new rr.WT(4);return rr.WT!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Nl(e){var i=new glMatrix.ARRAY_TYPE(4);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i}function ks(e,i,r,n){var a=new rr.WT(4);return a[0]=e,a[1]=i,a[2]=r,a[3]=n,a}function Cl(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e}function Fu(e,i,r,n,a){return e[0]=i,e[1]=r,e[2]=n,e[3]=a,e}function qp(e,i,r){return e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e[3]=i[3]+r[3],e}function Bu(e,i,r){return e[0]=i[0]-r[0],e[1]=i[1]-r[1],e[2]=i[2]-r[2],e[3]=i[3]-r[3],e}function zc(e,i,r){return e[0]=i[0]*r[0],e[1]=i[1]*r[1],e[2]=i[2]*r[2],e[3]=i[3]*r[3],e}function Mh(e,i,r){return e[0]=i[0]/r[0],e[1]=i[1]/r[1],e[2]=i[2]/r[2],e[3]=i[3]/r[3],e}function _m(e,i){return e[0]=Math.ceil(i[0]),e[1]=Math.ceil(i[1]),e[2]=Math.ceil(i[2]),e[3]=Math.ceil(i[3]),e}function ls(e,i){return e[0]=Math.floor(i[0]),e[1]=Math.floor(i[1]),e[2]=Math.floor(i[2]),e[3]=Math.floor(i[3]),e}function Kp(e,i,r){return e[0]=Math.min(i[0],r[0]),e[1]=Math.min(i[1],r[1]),e[2]=Math.min(i[2],r[2]),e[3]=Math.min(i[3],r[3]),e}function mf(e,i,r){return e[0]=Math.max(i[0],r[0]),e[1]=Math.max(i[1],r[1]),e[2]=Math.max(i[2],r[2]),e[3]=Math.max(i[3],r[3]),e}function Ld(e,i){return e[0]=Math.round(i[0]),e[1]=Math.round(i[1]),e[2]=Math.round(i[2]),e[3]=Math.round(i[3]),e}function $p(e,i,r){return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=i[3]*r,e}function _v(e,i,r,n){return e[0]=i[0]+r[0]*n,e[1]=i[1]+r[1]*n,e[2]=i[2]+r[2]*n,e[3]=i[3]+r[3]*n,e}function up(e,i){var r=i[0]-e[0],n=i[1]-e[1],a=i[2]-e[2],s=i[3]-e[3];return Math.hypot(r,n,a,s)}function gf(e,i){var r=i[0]-e[0],n=i[1]-e[1],a=i[2]-e[2],s=i[3]-e[3];return r*r+n*n+a*a+s*s}function xm(e){var i=e[0],r=e[1],n=e[2],a=e[3];return Math.hypot(i,r,n,a)}function bm(e){var i=e[0],r=e[1],n=e[2],a=e[3];return i*i+r*r+n*n+a*a}function p0(e,i){return e[0]=-i[0],e[1]=-i[1],e[2]=-i[2],e[3]=-i[3],e}function As(e,i){return e[0]=1/i[0],e[1]=1/i[1],e[2]=1/i[2],e[3]=1/i[3],e}function qf(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],h=r*r+n*n+a*a+s*s;return h>0&&(h=1/Math.sqrt(h)),e[0]=r*h,e[1]=n*h,e[2]=a*h,e[3]=s*h,e}function Em(e,i){return e[0]*i[0]+e[1]*i[1]+e[2]*i[2]+e[3]*i[3]}function t(e,i,r,n){var a=r[0]*n[1]-r[1]*n[0],s=r[0]*n[2]-r[2]*n[0],h=r[0]*n[3]-r[3]*n[0],m=r[1]*n[2]-r[2]*n[1],y=r[1]*n[3]-r[3]*n[1],b=r[2]*n[3]-r[3]*n[2],A=i[0],P=i[1],k=i[2],F=i[3];return e[0]=P*b-k*y+F*m,e[1]=-(A*b)+k*h-F*s,e[2]=A*y-P*h+F*a,e[3]=-(A*m)+P*s-k*a,e}function o(e,i,r,n){var a=i[0],s=i[1],h=i[2],m=i[3];return e[0]=a+n*(r[0]-a),e[1]=s+n*(r[1]-s),e[2]=h+n*(r[2]-h),e[3]=m+n*(r[3]-m),e}function u(e,i){i=i||1;var r,n,a,s,h,m;do r=glMatrix.RANDOM()*2-1,n=glMatrix.RANDOM()*2-1,h=r*r+n*n;while(h>=1);do a=glMatrix.RANDOM()*2-1,s=glMatrix.RANDOM()*2-1,m=a*a+s*s;while(m>=1);var y=Math.sqrt((1-h)/m);return e[0]=i*r,e[1]=i*n,e[2]=i*a*y,e[3]=i*s*y,e}function p(e,i,r){var n=i[0],a=i[1],s=i[2],h=i[3];return e[0]=r[0]*n+r[4]*a+r[8]*s+r[12]*h,e[1]=r[1]*n+r[5]*a+r[9]*s+r[13]*h,e[2]=r[2]*n+r[6]*a+r[10]*s+r[14]*h,e[3]=r[3]*n+r[7]*a+r[11]*s+r[15]*h,e}function g(e,i,r){var n=i[0],a=i[1],s=i[2],h=r[0],m=r[1],y=r[2],b=r[3],A=b*n+m*s-y*a,P=b*a+y*n-h*s,k=b*s+h*a-m*n,F=-h*n-m*a-y*s;return e[0]=A*b+F*-h+P*-y-k*-m,e[1]=P*b+F*-m+k*-h-A*-y,e[2]=k*b+F*-y+A*-m-P*-h,e[3]=i[3],e}function x(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function S(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function M(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]}function D(e,i){var r=e[0],n=e[1],a=e[2],s=e[3],h=i[0],m=i[1],y=i[2],b=i[3];return Math.abs(r-h)<=glMatrix.EPSILON*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(n-m)<=glMatrix.EPSILON*Math.max(1,Math.abs(n),Math.abs(m))&&Math.abs(a-y)<=glMatrix.EPSILON*Math.max(1,Math.abs(a),Math.abs(y))&&Math.abs(s-b)<=glMatrix.EPSILON*Math.max(1,Math.abs(s),Math.abs(b))}var U=null,j=null,G=null,ae=null,le=null,Ie=null,ke=null,Ke=function(){var e=ha();return function(i,r,n,a,s,h){var m,y;for(r||(r=4),n||(n=0),a?y=Math.min(a*r+n,i.length):y=i.length,m=n;m<y;m+=r)e[0]=i[m],e[1]=i[m+1],e[2]=i[m+2],e[3]=i[m+3],s(e,e,h),i[m]=e[0],i[m+1]=e[1],i[m+2]=e[2],i[m+3]=e[3];return i}}(),Ue=Math.PI/180,st=512,St=4003e4;function Gt(e){var i=e.latitude,r=i===void 0?0:i,n=e.zoom,a=n===void 0?0:n,s=e.scale,h=e.highPrecision,m=h===void 0?!1:h,y=e.flipY,b=y===void 0?!1:y;s=s!==void 0?s:Math.pow(2,a);var A={},P=st*s,k=Math.cos(r*Ue),F=P/360,q=F/k,oe=P/St/k;if(A.pixelsPerMeter=[oe,-oe,oe],A.metersPerPixel=[1/oe,-1/oe,1/oe],A.pixelsPerDegree=[F,-q,oe],A.degreesPerPixel=[1/F,-1/q,1/oe],m){var ue=Ue*Math.tan(r*Ue)/k,Pe=F*ue/2,et=P/St*ue,at=et/q*oe;A.pixelsPerDegree2=[0,-Pe,et],A.pixelsPerMeter2=[at,0,at],b&&(A.pixelsPerDegree2[1]=-A.pixelsPerDegree2[1],A.pixelsPerMeter2[1]=-A.pixelsPerMeter2[1])}return b&&(A.pixelsPerMeter[1]=-A.pixelsPerMeter[1],A.metersPerPixel[1]=-A.metersPerPixel[1],A.pixelsPerDegree[1]=-A.pixelsPerDegree[1],A.degreesPerPixel[1]=-A.degreesPerPixel[1]),A}var Zt;(function(e){e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.P20=5]="P20",e[e.P20_OFFSET=6]="P20_OFFSET",e[e.METER_OFFSET=7]="METER_OFFSET",e[e.P20_2=8]="P20_2"})(Zt||(Zt={}));var or={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},Ir,Xr,Dn,ln,Un,gn=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],ki=(Ir=(0,Lr.b2)(),Xr=(0,Lr.f3)($t.ICameraService),Ir(Dn=(ln=function(){function e(){(0,lt.Z)(this,e),(0,I.Z)(this,"needRefresh",!0),Vn(this,"cameraService",Un,this),(0,I.Z)(this,"coordinateSystem",void 0),(0,I.Z)(this,"viewportCenter",void 0),(0,I.Z)(this,"viewportCenterProjection",void 0),(0,I.Z)(this,"pixelsPerDegree",void 0),(0,I.Z)(this,"pixelsPerDegree2",void 0),(0,I.Z)(this,"pixelsPerMeter",void 0)}return(0,It.Z)(e,[{key:"refresh",value:function(){var r=this.cameraService.getZoom(),n=this.cameraService.getZoomScale(),a=this.cameraService.getCenter(),s=Gt({latitude:a[1],zoom:r}),h=s.pixelsPerMeter,m=s.pixelsPerDegree;this.viewportCenter=a,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=h,this.pixelsPerDegree=m,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===Zt.LNGLAT||this.coordinateSystem===Zt.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===Zt.LNGLAT_OFFSET?this.calculateLnglatOffset(a,r):this.coordinateSystem===Zt.P20_OFFSET&&this.calculateLnglatOffset(a,r,n,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(r){this.coordinateSystem=r}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(r,n,a,s){var h=Gt({latitude:r[1],zoom:n,scale:a,flipY:s,highPrecision:!0}),m=h.pixelsPerMeter,y=h.pixelsPerDegree,b=h.pixelsPerDegree2,A=this.cameraService.getViewMatrix(),P=this.cameraService.getProjectionMatrix(),k=Ar([],P,A),F=this.cameraService.projectFlat([Math.fround(r[0]),Math.fround(r[1])],Math.pow(2,n));this.viewportCenterProjection=p([],[F[0],F[1],0,1],k),A=this.cameraService.getViewMatrixUncentered()||A,k=Ar([],P,A),k=Ar([],k,gn),this.cameraService.setViewProjectionMatrix(k),this.pixelsPerMeter=m,this.pixelsPerDegree=y,this.pixelsPerDegree2=b}}]),e}(),Un=wn(ln.prototype,"cameraService",[Xr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ln))||Dn),ii=R(20396),Cn=R.n(ii),ei;(function(e){e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag"})(ei||(ei={}));var Ei,ta,Zn,ua,ro;function Io(e){var i=So();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function So(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var fo={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},Oo=(Ei=(0,Lr.b2)(),ta=(0,Lr.f3)($t.IMapService),Ei(Zn=(ua=function(e){(0,pn.Z)(r,e);var i=Io(r);function r(){var n;(0,lt.Z)(this,r);for(var a=arguments.length,s=new Array(a),h=0;h<a;h++)s[h]=arguments[h];return n=i.call.apply(i,[this].concat(s)),Vn((0,xe.Z)(n),"mapService",ro,(0,xe.Z)(n)),(0,I.Z)((0,xe.Z)(n),"hammertime",void 0),(0,I.Z)((0,xe.Z)(n),"lastClickTime",0),(0,I.Z)((0,xe.Z)(n),"lastClickXY",[-1,-1]),(0,I.Z)((0,xe.Z)(n),"clickTimer",void 0),(0,I.Z)((0,xe.Z)(n),"$containter",void 0),(0,I.Z)((0,xe.Z)(n),"onDrag",function(m){var y=n.interactionEvent(m);y.type=fo[y.type],n.emit(ei.Drag,y)}),(0,I.Z)((0,xe.Z)(n),"onHammer",function(m){m.srcEvent.stopPropagation();var y=n.interactionEvent(m);n.emit(ei.Hover,y)}),(0,I.Z)((0,xe.Z)(n),"onTouch",function(m){var y=m.touches[0];n.onHover({x:y.pageX,y:y.pageY,type:"touch"})}),(0,I.Z)((0,xe.Z)(n),"onHover",function(m){var y=m.clientX,b=m.clientY,A=y,P=b,k=m.type,F=n.mapService.getMapContainer();if(F)if(wo)A=A-F.left-0,P=P-F.top-0;else{var q=F.getBoundingClientRect(),oe=q.top,ue=q.left;A=A-ue-F.clientLeft,P=P-oe-F.clientTop}var Pe=n.mapService.containerToLngLat([A,P]);if(k==="click"){if(!wo&&"ontouchstart"in document.documentElement)return;n.isDoubleTap(A,P,Pe);return}if(k==="touch"){n.isDoubleTap(A,P,Pe);return}k!=="click"&&k!=="dblclick"&&n.emit(ei.Hover,{x:A,y:P,lngLat:Pe,type:k,target:m})}),n}return(0,It.Z)(r,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(ei.Hover)}},{key:"triggerHover",value:function(a){var s=a.x,h=a.y;this.emit(ei.Hover,{x:s,y:h})}},{key:"triggerSelect",value:function(a){this.emit(ei.Select,{featureId:a})}},{key:"triggerActive",value:function(a){this.emit(ei.Active,{featureId:a})}},{key:"handleMiniEvent",value:function(a){this.onHover({clientX:a.touches[0].pageX,clientY:a.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var a=this.mapService.getMapContainer();if(a)if(wo)ba.document.addEventListener("touchstart",this.handleMiniEvent.bind(this));else{var s=new(Cn()).Manager(a);s.add(new(Cn()).Tap({event:"dblclick",taps:2})),s.add(new(Cn()).Tap({event:"click"})),s.add(new(Cn()).Pan({threshold:0,pointers:0})),s.add(new(Cn()).Press({})),s.on("dblclick click",this.onHammer),s.on("panstart panmove panend pancancel",this.onDrag),a.addEventListener("mousemove",this.onHover),a.addEventListener("mousedown",this.onHover,!0),a.addEventListener("mouseup",this.onHover),a.addEventListener("contextmenu",this.onHover),this.hammertime=s}}},{key:"removeEventListenerOnMap",value:function(){if(wo)ba.document.removeEventListener("touchstart",this.handleMiniEvent.bind(this));else{var a=this.mapService.getMapContainer();a&&(a.removeEventListener("mousemove",this.onHover),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),a.removeEventListener("mousedown",this.onHover),a.removeEventListener("mouseup",this.onHover),a.removeEventListener("contextmenu",this.onHover))}}},{key:"interactionEvent",value:function(a){var s=a.type,h=a.pointerType,m,y;h==="touch"?(y=Math.floor(a.pointers[0].clientY),m=Math.floor(a.pointers[0].clientX)):(y=Math.floor(a.srcEvent.y),m=Math.floor(a.srcEvent.x));var b=this.mapService.getMapContainer();if(b){var A=b.getBoundingClientRect(),P=A.top,k=A.left;m-=k,y-=P}var F=this.mapService.containerToLngLat([m,y]);return{x:m,y,lngLat:F,type:s,target:a.srcEvent}}},{key:"isDoubleTap",value:function(a,s,h){var m=this,y=new Date().getTime(),b="click";y-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-a)<10&&Math.abs(this.lastClickXY[1]-s)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),b="dblclick",this.emit(ei.Hover,{x:a,y:s,lngLat:h,type:b})):(this.lastClickTime=y,this.lastClickXY=[a,s],this.clickTimer=setTimeout(function(){b="click",m.emit(ei.Hover,{x:a,y:s,lngLat:h,type:b})},400))}}]),r}(of()),ro=wn(ua.prototype,"mapService",[ta],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ua))||Zn),Ea=R(92137),cs=R(87757),Mi=R.n(cs),_s=0;function Xs(e){if(wo)return null;var i=e;if(typeof e=="string"&&(i=document.getElementById(e)),i){var r=document.createElement("div");return r.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,r.id="l7-scene-".concat(_s++),r.classList.add("l7-scene"),i.appendChild(r),r}return null}function No(e){var i,r,n=!0;return e==null||(i=e.target)===null||i===void 0||(r=i.path)===null||r===void 0||r.map(function(a){if(a!=null&&a.classList){var s;a==null||(s=a.classList)===null||s===void 0||s.forEach(function(h){(h==="l7-marker"||h==="l7-popup")&&(n=!1)})}}),n}var ee;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"})(ee||(ee={}));var Wi,Na,Oa,ia,Ys,ws,ka,zo,Ts,pa,zl;function Cu(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function sl(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Cu(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Cu(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Uo=(Wi=(0,Lr.b2)(),Na=(0,Lr.f3)($t.IRendererService),Oa=(0,Lr.f3)($t.IGlobalConfigService),ia=(0,Lr.f3)($t.IInteractionService),Ys=(0,Lr.f3)($t.ILayerService),Wi(ws=(ka=function(){function e(){var i=this;(0,lt.Z)(this,e),Vn(this,"rendererService",zo,this),Vn(this,"configService",Ts,this),Vn(this,"interactionService",pa,this),Vn(this,"layerService",zl,this),(0,I.Z)(this,"pickingFBO",void 0),(0,I.Z)(this,"width",0),(0,I.Z)(this,"height",0),(0,I.Z)(this,"alreadyInPicking",!1),(0,I.Z)(this,"pickBufferScale",1),(0,I.Z)(this,"lastPickTime",new Date().getTime()),(0,I.Z)(this,"pickFromPickingFBO",function(r,n){var a,s=n.x,h=n.y,m=n.lngLat,y=n.type,b=n.target,A=!1,P=i.rendererService,k=P.getViewportSize,F=P.readPixels,q=P.getContainer,oe=i.getContainerSize(q()),ue=oe.width,Pe=oe.height;ue*=Aa,Pe*=Aa;var et=r.getLayerConfig(),at=et.enableHighlight,_t=et.enableSelect,Nt=s*Aa,Ht=h*Aa;if(Nt>ue-1*Aa||Nt<0||Ht>Pe-1*Aa||Ht<0)return!1;var nr;if(nr=F({x:Math.floor(Nt/i.pickBufferScale),y:Math.floor((Pe-(h+1)*Aa)/i.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:i.pickingFBO}),nr[0]!==0||nr[1]!==0||nr[2]!==0){var mr=Ae(nr),Hr=r.getSource().getFeatureById(mr);mr!==r.getCurrentPickId()&&y==="mousemove"&&(y="mouseenter");var fn={x:s,y:h,type:y,lngLat:m,featureId:mr,feature:Hr,target:b};Hr&&(A=!0,r.setCurrentPickId(mr),i.triggerHoverOnLayer(r,fn))}else{var Or={x:s,y:h,lngLat:m,type:r.getCurrentPickId()!==null&&y==="mousemove"?"mouseout":"un"+y,featureId:null,target:b,feature:null};i.triggerHoverOnLayer(r,sl(sl({},Or),{},{type:"unpick"})),i.triggerHoverOnLayer(r,Or),r.setCurrentPickId(null)}if(at&&i.highlightPickedFeature(r,nr),_t&&y==="click"&&((a=nr)===null||a===void 0?void 0:a.toString())!==[0,0,0,0].toString()){var Tn=Ae(nr);r.getCurrentSelectedId()===null||Tn!==r.getCurrentSelectedId()?(i.selectFeature(r,nr),r.setCurrentSelectedId(Tn)):(i.selectFeature(r,new Uint8Array([0,0,0,0])),r.setCurrentSelectedId(null))}return A})}return(0,It.Z)(e,[{key:"init",value:function(r){var n=this.rendererService,a=n.createTexture2D,s=n.createFramebuffer,h=n.getViewportSize,m=n.getContainer,y=this.getContainerSize(m()),b=y.width,A=y.height;b*=Aa,A*=Aa,this.pickBufferScale=this.configService.getSceneConfig(r).pickBufferScale||1,this.pickingFBO=s({color:a({width:Math.round(b/this.pickBufferScale),height:Math.round(A/this.pickBufferScale),wrapS:ee.CLAMP_TO_EDGE,wrapT:ee.CLAMP_TO_EDGE})}),this.interactionService.on(ei.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var i=(0,Ea.Z)(Mi().mark(function n(a,s,h){var m=this,y,b,A,P;return Mi().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:y=this.rendererService,b=y.useFramebuffer,A=y.clear,P=y.getContainer,this.resizePickingFBO(),b(this.pickingFBO,function(){A({framebuffer:m.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),a.hooks.beforePickingEncode.call(),a.renderModels(),a.hooks.afterPickingEncode.call();var q=m.pickBox(a,s);h(q)});case 3:case"end":return F.stop()}},n,this)}));function r(n,a,s){return i.apply(this,arguments)}return r}()},{key:"pickBox",value:function(r,n){var a=this,s=n.map(function(Or){var Tn=Or<0?0:Or;return Math.floor(Tn*Aa/a.pickBufferScale)}),h=(0,ne.Z)(s,4),m=h[0],y=h[1],b=h[2],A=h[3],P=this.rendererService,k=P.getViewportSize,F=P.readPixels,q=P.getContainer,oe=this.getContainerSize(q()),ue=oe.width,Pe=oe.height;if(ue*=Aa,Pe*=Aa,m>(ue-1)*Aa/this.pickBufferScale||b<0||y>(Pe-1)*Aa/this.pickBufferScale||A<0)return[];var et,at=Math.min(ue/this.pickBufferScale,b)-m,_t=Math.min(Pe/this.pickBufferScale,A)-y;et=F({x:m,y:Math.floor(Pe/this.pickBufferScale-(A+1)),width:at,height:_t,data:new Uint8Array(at*_t*4),framebuffer:this.pickingFBO});for(var Nt=[],Ht={},nr=0;nr<et.length/4;nr=nr+1){var mr=et.slice(nr*4,nr*4+4),Hr=Ae(mr);if(Hr!==-1&&!Ht[Hr]){var fn=r.getSource().getFeatureById(Hr);Nt.push(sl(sl({},fn),{},{pickedFeatureIdx:Hr})),Ht[Hr]=!0}}return Nt}},{key:"getContainerSize",value:function(r){return r.getContext?{width:r.width/Aa,height:r.height/Aa}:r.getBoundingClientRect()}},{key:"pickingAllLayer",value:function(){var i=(0,Ea.Z)(Mi().mark(function n(a){var s;return Mi().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.layerService.isMapDragging()||!this.layerService.getShaderPickStat())){m.next=2;break}return m.abrupt("return");case 2:if(this.alreadyInPicking=!0,s=new Date().getTime(),!(s-this.lastPickTime>10||a.type==="contextmenu")){m.next=7;break}return m.next=7,this.pickingLayers(a);case 7:this.lastPickTime=s,this.layerService.renderLayers(),this.alreadyInPicking=!1;case 10:case"end":return m.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"resizePickingFBO",value:function(){var r=this.rendererService.getContainer,n=this.getContainerSize(r()),a=n.width,s=n.height;a*=Aa,s*=Aa,(this.width!==a||this.height!==s)&&(this.pickingFBO.resize({width:Math.round(a/this.pickBufferScale),height:Math.round(s/this.pickBufferScale)}),this.width=a,this.height=s)}},{key:"pickingLayers",value:function(){var i=(0,Ea.Z)(Mi().mark(function n(a){var s=this,h,m,y,b,A;return Mi().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:h=this.rendererService,m=h.getViewportSize,y=h.useFramebuffer,b=h.clear,A=h.getContainer,this.resizePickingFBO(),y(this.pickingFBO,function(){var F=s.layerService.getRenderList();F.filter(function(q){return q.needPick(a.type)}).reverse().some(function(q){b({framebuffer:s.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),q.hooks.beforePickingEncode.call(),q.renderModels(!0),q.hooks.afterPickingEncode.call();var oe=s.pickFromPickingFBO(q,a);return oe&&!q.getLayerConfig().enablePropagation})});case 3:case"end":return k.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"triggerHoverOnLayer",value:function(r,n){No(n)&&r.emit(n.type,n)}},{key:"highlightPickedFeature",value:function(r,n){var a=(0,ne.Z)(n,3),s=a[0],h=a[1],m=a[2];r.hooks.beforeHighlight.call([s,h,m])}},{key:"selectFeature",value:function(r,n){var a=(0,ne.Z)(n,3),s=a[0],h=a[1],m=a[2];r.hooks.beforeSelect.call([s,h,m])}}]),e}(),zo=wn(ka.prototype,"rendererService",[Na],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ts=wn(ka.prototype,"configService",[Oa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pa=wn(ka.prototype,"interactionService",[ia],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zl=wn(ka.prototype,"layerService",[Ys],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ka))||ws),lc=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,lt.Z)(this,e),(0,I.Z)(this,"autoStart",void 0),(0,I.Z)(this,"startTime",0),(0,I.Z)(this,"oldTime",0),(0,I.Z)(this,"running",!1),(0,I.Z)(this,"elapsedTime",0),this.autoStart=i}return(0,It.Z)(e,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var r=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var n=(typeof performance=="undefined"?Date:performance).now();r=(n-this.oldTime)/1e3,this.oldTime=n,this.elapsedTime+=r}return r}}]),e}(),ul,Kf,yf,$f,cc,fc,lp,Jf,Ph;function Jp(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Qp(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(b){throw b},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,h=!1,m;return{s:function(){r=r.call(e)},n:function(){var b=r.next();return s=b.done,b},e:function(b){h=!0,m=b},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(h)throw m}}}}function Qp(e,i){if(!!e){if(typeof e=="string")return hc(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return hc(e,i)}}function hc(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var cp=(ul=(0,Lr.b2)(),Kf=(0,Lr.f3)($t.IRendererService),yf=(0,Lr.f3)($t.IMapService),$f=(0,Lr.f3)($t.IGlobalConfigService),ul(cc=(fc=function(){function e(){(0,lt.Z)(this,e),(0,I.Z)(this,"clock",new lc),(0,I.Z)(this,"alreadyInRendering",!1),(0,I.Z)(this,"layers",[]),(0,I.Z)(this,"layerList",[]),(0,I.Z)(this,"layerRenderID",void 0),(0,I.Z)(this,"sceneInited",!1),(0,I.Z)(this,"animateInstanceCount",0),(0,I.Z)(this,"shaderPicking",!0),(0,I.Z)(this,"enableRender",!0),Vn(this,"renderService",lp,this),Vn(this,"mapService",Jf,this),Vn(this,"configService",Ph,this)}return(0,It.Z)(e,[{key:"add",value:function(r){this.sceneInited&&r.init(),this.layers.push(r),this.updateLayerRenderList()}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach(function(r){r.inited||r.init()}),this.updateLayerRenderList()}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(r){return this.layers.find(function(n){return n.id===r})}},{key:"getLayerByName",value:function(r){return this.layers.find(function(n){return n.name===r})}},{key:"cleanRemove",value:function(r,n){if(n){var a=n.layerChildren.indexOf(r);a>-1&&n.layerChildren.splice(a,1)}else{var s=this.layers.indexOf(r);s>-1&&this.layers.splice(s,1)}this.updateLayerRenderList(),this.renderLayers()}},{key:"remove",value:function(r,n){if(n){var a=n.layerChildren.indexOf(r);a>-1&&n.layerChildren.splice(a,1)}else{var s=this.layers.indexOf(r);s>-1&&this.layers.splice(s,1)}this.updateLayerRenderList(),r.destroy(),this.renderLayers()}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"setEnableRender",value:function(r){this.enableRender=r}},{key:"renderLayers",value:function(){var i=(0,Ea.Z)(Mi().mark(function n(){var a,s,h;return Mi().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(!(this.alreadyInRendering||!this.enableRender)){y.next=2;break}return y.abrupt("return");case 2:this.alreadyInRendering=!0,this.clear(),a=Jp(this.layerList),y.prev=5,a.s();case 7:if((s=a.n()).done){y.next=20;break}if(h=s.value,h.hooks.beforeRenderData.call(),h.hooks.beforeRender.call(),!h.getLayerConfig().enableMultiPassRenderer){y.next=16;break}return y.next=14,h.renderMultiPass();case 14:y.next=17;break;case 16:h.render();case 17:h.hooks.afterRender.call();case 18:y.next=7;break;case 20:y.next=25;break;case 22:y.prev=22,y.t0=y.catch(5),a.e(y.t0);case 25:return y.prev=25,a.f(),y.finish(25);case 28:this.alreadyInRendering=!1;case 29:case"end":return y.stop()}},n,this,[[5,22,25,28]])}));function r(){return i.apply(this,arguments)}return r}()},{key:"updateLayerRenderList",value:function(){var r=this;this.layerList=[],this.layers.filter(function(n){return n.inited}).filter(function(n){return n.isVisible()}).forEach(function(n){r.layerList.push(n),n.layerChildren.filter(function(a){return a.inited}).filter(function(a){return a.isVisible()}).forEach(function(a){r.layerList.push(a)})}),this.layerList.sort(function(n,a){return n.zIndex-a.zIndex})}},{key:"destroy",value:function(){this.layers.forEach(function(r){r.layerChildren&&(r.layerChildren.forEach(function(n){return n.destroy()}),r.layerChildren=[]),r.destroy()}),this.layers=[],this.layerList=[],this.renderLayers()}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"isMapDragging",value:function(){return this.mapService.dragging}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=ba.requestAnimationFrame(this.runRender.bind(this))}},{key:"clear",value:function(){var r=Be(this.mapService.bgColor);this.renderService.clear({color:r,depth:1,stencil:0,framebuffer:null})}},{key:"stopRender",value:function(){ba.cancelAnimationFrame(this.layerRenderID)}}]),e}(),lp=wn(fc.prototype,"renderService",[Kf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jf=wn(fc.prototype,"mapService",[yf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ph=wn(fc.prototype,"configService",[$f],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fc))||cc),pc=R(81253),_f=R(14293),Nu=R.n(_f),ed=function(){function e(i){var r=this;(0,lt.Z)(this,e),(0,I.Z)(this,"name",void 0),(0,I.Z)(this,"type",void 0),(0,I.Z)(this,"scale",void 0),(0,I.Z)(this,"descriptor",void 0),(0,I.Z)(this,"featureBufferLayout",[]),(0,I.Z)(this,"needRescale",!1),(0,I.Z)(this,"needRemapping",!1),(0,I.Z)(this,"needRegenerateVertices",!1),(0,I.Z)(this,"featureRange",{startIndex:0,endIndex:Infinity}),(0,I.Z)(this,"vertexAttribute",void 0),(0,I.Z)(this,"defaultCallback",function(n){if(n.length===0){var a;return((a=r.scale)===null||a===void 0?void 0:a.defaultValues)||[]}return n.map(function(s,h){var m,y=(m=r.scale)===null||m===void 0?void 0:m.scalers[h].func,b=y(s);return b})}),this.setProps(i)}return(0,It.Z)(e,[{key:"setProps",value:function(r){Object.assign(this,r)}},{key:"mapping",value:function(r){var n;if((n=this.scale)!==null&&n!==void 0&&n.callback){var a,s=(a=this.scale)===null||a===void 0?void 0:a.callback.apply(a,(0,ur.Z)(r));if(!Nu()(s))return[s]}return this.defaultCallback(r)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),td=["buffer","update","name"],Uc,Ih,fp,Oh,Qf,Rh;function hp(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function xf(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?hp(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):hp(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function kd(e){return new Promise(function(i){return setTimeout(i,e)})}var Lh=(Uc={},(0,I.Z)(Uc,ee.FLOAT,4),(0,I.Z)(Uc,ee.UNSIGNED_BYTE,1),(0,I.Z)(Uc,ee.UNSIGNED_SHORT,2),Uc),pp=(Ih=(0,Lr.b2)(),fp=(0,Lr.f3)($t.IRendererService),Ih(Oh=(Qf=function(){function e(){(0,lt.Z)(this,e),(0,I.Z)(this,"attributesAndIndices",void 0),Vn(this,"rendererService",Rh,this),(0,I.Z)(this,"attributes",[]),(0,I.Z)(this,"triangulation",void 0),(0,I.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,It.Z)(e,[{key:"registerStyleAttribute",value:function(r){var n=this.getLayerStyleAttribute(r.name||"");return n?n.setProps(r):(n=new ed(r),this.attributes.push(n)),n}},{key:"updateStyleAttribute",value:function(r,n,a){var s=this.getLayerStyleAttribute(r);s||(s=this.registerStyleAttribute(xf(xf({},n),{},{name:r})));var h=n.scale;h&&s&&(s.scale=h,s.needRescale=!0,s.needRemapping=!0,s.needRegenerateVertices=!0,a&&a.featureRange&&(s.featureRange=a.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(r){return this.attributes.find(function(n){return n.name===r})}},{key:"getLayerAttributeScale",value:function(r){var n,a=this.getLayerStyleAttribute(r),s=a==null||(n=a.scale)===null||n===void 0?void 0:n.scalers;return s&&s[0]?s[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(r,n){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=arguments.length>3?arguments[3]:void 0,h=this.attributes.find(function(_t){return _t.name===r});if(h&&h.descriptor){var m=h.descriptor,y=m.update,b=m.buffer,A=m.size,P=A===void 0?0:A,k=Lh[b.type||ee.FLOAT];if(y){var F=this.featureLayout,q=F.elements,oe=F.sizePerElement,ue=q.slice(a,s);if(!ue.length)return;var Pe=ue[0].offset,et=Pe*P*k,at=ue.map(function(_t,Nt){for(var Ht=_t.featureIdx,nr=_t.vertices,mr=_t.normals,Hr=nr.length/oe,fn=[],Or=0;Or<Hr;Or++){var Tn=mr?mr.slice(Or*3,Or*3+3):[];fn.push.apply(fn,(0,ur.Z)(y(n[Ht],Ht,nr.slice(Or*oe,Or*oe+oe),Nt,Tn)))}return fn}).reduce(function(_t,Nt){return _t.push.apply(_t,(0,ur.Z)(Nt)),_t},[]);h.vertexAttribute.updateBuffer({data:at,offset:et})}}}},{key:"createAttributesAndIndices",value:function(r,n,a){var s=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var h=this.attributes.map(function(et){return et.resetDescriptor(),et.descriptor}),m=0,y=[],b=[],A=[],P=3;r.forEach(function(et,at){var _t=s.triangulation(et,a),Nt=_t.indices,Ht=_t.vertices,nr=_t.normals,mr=_t.size;Nt.forEach(function(Tn){b.push(Tn+m)}),P=mr;var Hr=Ht.length/mr;s.featureLayout.sizePerElement=P,s.featureLayout.elements.push({featureIdx:at,vertices:Ht,normals:nr,offset:m}),m+=Hr;for(var fn=function(zn){var gi=(nr==null?void 0:nr.slice(zn*3,zn*3+3))||[],io=Ht.slice(zn*mr,zn*mr+mr);h.forEach(function(rs,Tu){if(rs&&rs.update){var fl;(fl=rs.buffer.data).push.apply(fl,(0,ur.Z)(rs.update(et,at,io,zn,gi)))}})},Or=0;Or<Hr;Or++)fn(Or)});var k=this.rendererService,F=k.createAttribute,q=k.createBuffer,oe=k.createElements,ue={};h.forEach(function(et,at){if(et){var _t=et.buffer,Nt=et.update,Ht=et.name,nr=(0,pc.Z)(et,td),mr=F(xf({buffer:q(_t)},nr));ue[et.name||""]=mr,s.attributes[at].vertexAttribute=mr}});var Pe=oe({data:b,type:ee.UNSIGNED_INT,count:b.length});return this.attributesAndIndices={attributes:ue,elements:Pe},this.attributesAndIndices}},{key:"clearAllAttributes",value:function(){var r;this.attributes.forEach(function(n){n.vertexAttribute&&n.vertexAttribute.destroy()}),(r=this.attributesAndIndices)===null||r===void 0||r.elements.destroy(),this.attributes=[]}}]),e}(),Rh=wn(Qf.prototype,"rendererService",[fp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qf))||Oh),bf=R(67709),dp=R.n(bf),eh,rd,Dd,nd,Fd,id,xv,kh,Ro,Al,bv,Zc,ad,Bd,vp,Ul,mp,xs,gp,yp,od,Nd,Dh,zd,Ud,Zd,jd,Vd,Au,_p,Gd,Zl,Ev;function Sv(e){var i=th();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function th(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Fh=(eh=(0,Lr.b2)(),rd=(0,Lr.f3)($t.SceneID),Dd=(0,Lr.f3)($t.IIconService),nd=(0,Lr.f3)($t.IFontService),Fd=(0,Lr.f3)($t.IControlService),id=(0,Lr.f3)($t.IGlobalConfigService),xv=(0,Lr.f3)($t.IMapService),kh=(0,Lr.f3)($t.ICoordinateSystemService),Ro=(0,Lr.f3)($t.IRendererService),Al=(0,Lr.f3)($t.ILayerService),bv=(0,Lr.f3)($t.ICameraService),Zc=(0,Lr.f3)($t.IInteractionService),ad=(0,Lr.f3)($t.IPickingService),Bd=(0,Lr.f3)($t.IShaderModuleService),vp=(0,Lr.f3)($t.IMarkerService),Ul=(0,Lr.f3)($t.IPopupService),eh(mp=(xs=function(e){(0,pn.Z)(r,e);var i=Sv(r);function r(){var n;return(0,lt.Z)(this,r),n=i.call(this),(0,I.Z)((0,xe.Z)(n),"destroyed",!1),(0,I.Z)((0,xe.Z)(n),"loaded",!1),(0,I.Z)((0,xe.Z)(n),"loadFont",!1),(0,I.Z)((0,xe.Z)(n),"fontFamily",""),Vn((0,xe.Z)(n),"id",gp,(0,xe.Z)(n)),Vn((0,xe.Z)(n),"iconService",yp,(0,xe.Z)(n)),Vn((0,xe.Z)(n),"fontService",od,(0,xe.Z)(n)),Vn((0,xe.Z)(n),"controlService",Nd,(0,xe.Z)(n)),Vn((0,xe.Z)(n),"configService",Dh,(0,xe.Z)(n)),Vn((0,xe.Z)(n),"map",zd,(0,xe.Z)(n)),Vn((0,xe.Z)(n),"coordinateSystemService",Ud,(0,xe.Z)(n)),Vn((0,xe.Z)(n),"rendererService",Zd,(0,xe.Z)(n)),Vn((0,xe.Z)(n),"layerService",jd,(0,xe.Z)(n)),Vn((0,xe.Z)(n),"cameraService",Vd,(0,xe.Z)(n)),Vn((0,xe.Z)(n),"interactionService",Au,(0,xe.Z)(n)),Vn((0,xe.Z)(n),"pickingService",_p,(0,xe.Z)(n)),Vn((0,xe.Z)(n),"shaderModuleService",Gd,(0,xe.Z)(n)),Vn((0,xe.Z)(n),"markerService",Zl,(0,xe.Z)(n)),Vn((0,xe.Z)(n),"popupService",Ev,(0,xe.Z)(n)),(0,I.Z)((0,xe.Z)(n),"inited",!1),(0,I.Z)((0,xe.Z)(n),"initPromise",void 0),(0,I.Z)((0,xe.Z)(n),"rendering",!1),(0,I.Z)((0,xe.Z)(n),"$container",void 0),(0,I.Z)((0,xe.Z)(n),"canvas",void 0),(0,I.Z)((0,xe.Z)(n),"markerContainer",void 0),(0,I.Z)((0,xe.Z)(n),"hooks",void 0),(0,I.Z)((0,xe.Z)(n),"handleWindowResized",function(){n.emit("resize"),n.$container&&(n.initContainer(),ms(),n.coordinateSystemService.needRefresh=!0,n.render())}),(0,I.Z)((0,xe.Z)(n),"handleMapCameraChanged",function(a){n.cameraService.update(a),n.render()}),n.hooks={init:new Ff},n}return(0,It.Z)(r,[{key:"init",value:function(a){var s=this;this.configService.setSceneConfig(this.id,a),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return s.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,Ea.Z)(Mi().mark(function h(){return Mi().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,new Promise(function(b){s.map.onCameraChanged(function(A){s.cameraService.init(),s.cameraService.update(A),s.map.version!=="GAODE2.x"&&b()}),s.map.version!=="GAODE2.x"?s.map.init():b()});case 2:if(!(s.map.version==="GAODE2.x"&&s.map.initViewPort)){y.next=6;break}return y.next=5,s.map.init();case 5:s.map.initViewPort();case 6:s.map.onCameraChanged(s.handleMapCameraChanged),s.map.addMarkerContainer(),s.markerService.addMarkers(),s.markerService.addMarkerLayers(),s.popupService.initPopup(),s.interactionService.init(),s.interactionService.on(ei.Drag,s.addSceneEvent.bind(s));case 13:case"end":return y.stop()}},h)}))),this.hooks.init.tapPromise("initRenderer",(0,Ea.Z)(Mi().mark(function h(){var m,y;return Mi().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(m=Xs(s.configService.getSceneConfig(s.id).id||""),s.$container=m,!m){A.next=11;break}return s.canvas=ma("canvas","",m),s.setCanvas(),A.next=7,s.rendererService.init(s.canvas,s.configService.getSceneConfig(s.id));case 7:dp()(s.$container,s.handleWindowResized),ba.matchMedia&&((y=ba.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||y===void 0||y.addListener(s.handleWindowResized)),A.next=12;break;case 11:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 12:s.pickingService.init(s.id);case 13:case"end":return A.stop()}},h)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"initMiniScene",value:function(a){var s=this;this.configService.setSceneConfig(this.id,a),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return s.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,Ea.Z)(Mi().mark(function h(){return Mi().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,new Promise(function(b){s.map.onCameraChanged(function(A){s.cameraService.init(),s.cameraService.update(A),s.map.version!=="GAODE2.x"&&b()}),s.map.initMiniMap()});case 2:s.map.onCameraChanged(s.handleMapCameraChanged),s.interactionService.init(),s.interactionService.on(ei.Drag,s.addSceneEvent.bind(s));case 5:case"end":return y.stop()}},h)}))),this.hooks.init.tapPromise("initRenderer",(0,Ea.Z)(Mi().mark(function h(){var m;return Mi().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(m=a.canvas,s.$container=m||null,!s.$container){b.next=7;break}return b.next=5,s.rendererService.init(a.canvas,s.configService.getSceneConfig(s.id));case 5:b.next=8;break;case 7:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 8:s.pickingService.init(s.id);case 9:case"end":return b.stop()}},h)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(a){this.layerService.sceneService=this,this.layerService.add(a),this.render()}},{key:"render",value:function(){var n=(0,Ea.Z)(Mi().mark(function s(){return Mi().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(!(this.rendering||this.destroyed)){m.next=2;break}return m.abrupt("return");case 2:if(this.rendering=!0,this.inited){m.next=15;break}return m.next=6,this.initPromise;case 6:if(this.destroyed&&this.destroy(),!(this.loadFont&&document.fonts)){m.next=10;break}return m.next=10,document.fonts.load("24px ".concat(this.fontFamily),"L7text");case 10:this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 15:this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this.rendering=!1;case 18:case"end":return m.stop()}},s,this)}));function a(){return n.apply(this,arguments)}return a}()},{key:"addFontFace",value:function(a,s){this.fontFamily=a;var h=document.createElement("style");h.type="text/css",h.innerText=`
        @font-face{
            font-family: '`.concat(a,`';
            src: url('`).concat(s,`') format('woff2'),
            url('`).concat(s,`') format('woff'),
            url('`).concat(s,`') format('truetype');
        }`),document.getElementsByTagName("head")[0].appendChild(h),this.loadFont=!0}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(a){var s,h=(s=this.$container)===null||s===void 0?void 0:s.getElementsByTagName("canvas")[0];this.render();var m=a==="jpg"?h==null?void 0:h.toDataURL("image/jpeg"):h==null?void 0:h.toDataURL("image/png");return m}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var a=this.$container.parentElement;a!==null&&(this.markerContainer=ma("div","l7-marker-container",a))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var a=this,s,h;if(!this.inited){this.destroyed=!0;return}if(this.emit("destroy"),this.layerService.destroy(),setTimeout(function(){a.rendererService.destroy()}),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),(s=this.$container)===null||s===void 0||(h=s.parentNode)===null||h===void 0||h.removeChild(this.$container),this.removeAllListeners(),this.inited=!1,(0,bf.unbind)(this.$container,this.handleWindowResized),ba.matchMedia){var m;(m=ba.matchMedia("screen and (min-resolution: 2dppx)"))===null||m===void 0||m.removeListener(this.handleWindowResized)}}},{key:"initContainer",value:function(){var a,s,h=Aa,m=((a=this.$container)===null||a===void 0?void 0:a.clientWidth)||400,y=((s=this.$container)===null||s===void 0?void 0:s.clientHeight)||300,b=this.canvas;b&&(b.width=m*h,b.height=y*h),this.rendererService.viewport({x:0,y:0,width:h*m,height:h*y})}},{key:"setCanvas",value:function(){var a,s,h=Aa,m=((a=this.$container)===null||a===void 0?void 0:a.clientWidth)||400,y=((s=this.$container)===null||s===void 0?void 0:s.clientHeight)||300,b=this.canvas;b.width=m*h,b.height=y*h,b.style.width="100%",b.style.height="100%"}},{key:"addSceneEvent",value:function(a){this.emit(a.type,a)}}]),r}(Cs.EventEmitter),gp=wn(xs.prototype,"id",[rd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yp=wn(xs.prototype,"iconService",[Dd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),od=wn(xs.prototype,"fontService",[nd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nd=wn(xs.prototype,"controlService",[Fd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dh=wn(xs.prototype,"configService",[id],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zd=wn(xs.prototype,"map",[xv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ud=wn(xs.prototype,"coordinateSystemService",[kh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zd=wn(xs.prototype,"rendererService",[Ro],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jd=wn(xs.prototype,"layerService",[Al],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vd=wn(xs.prototype,"cameraService",[bv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Au=wn(xs.prototype,"interactionService",[Zc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_p=wn(xs.prototype,"pickingService",[ad],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gd=wn(xs.prototype,"shaderModuleService",[Bd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zl=wn(xs.prototype,"markerService",[vp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ev=wn(xs.prototype,"popupService",[Ul],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xs))||mp),Bh=R(44908),rh=R.n(Bh);function Nh(e){var i=0;switch(e){case"vec2":case"ivec2":i=2;break;case"vec3":case"ivec3":i=3;break;case"vec4":case"ivec4":case"mat2":i=4;break;case"mat3":i=9;break;case"mat4":i=16;break;default:}return i}var Cv=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function Hd(e){var i={};return e=e.replace(Cv,function(r,n,a){var s=a.split(":"),h=s[0].trim(),m="";switch(s.length>1&&(m=s[1].trim()),n){case"bool":m=m==="true";break;case"float":case"int":m=Number(m);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":m?m=m.replace("[","").replace("]","").split(",").reduce(function(y,b){return y.push(Number(b.trim())),y},[]):m=new Array(Nh(n)).fill(0);break;default:}return i[h]=m,"uniform ".concat(n," ").concat(h,`;
`)}),{content:e,uniforms:i}}var Wd,Xd;function sd(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function nh(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?sd(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):sd(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var dc="#define PI 3.14159265359",Av=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,Yd=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,qd=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,wv=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_shaderPick;

uniform float u_activeMix: 0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define HIGHLIGHT 1.0
#define SELECT 2.0

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float weight) {
  float selected = v_PickingResult.a;

  if (selected == SELECT) {
    // \u70B9\u51FB\u9009\u4E2D\u72B6\u6001
    vec4 selectColor = u_SelectColor * COLOR_SCALE;
    return selectColor;
  } else if (selected == HIGHLIGHT) {
    // hover \u9AD8\u4EAE\u72B6\u6001
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }
  
}

// TODO: \u4F18\u5316\u6C34\u6CE2\u70B9 blend additive \u6A21\u5F0F\u4E0B\u6709\u7684\u62FE\u53D6\u6548\u679C 
vec4 filterColorAnimate(vec4 color) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, color.a));
  }
}

vec4 filterColorWithLight(vec4 color, float lightWeight) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, lightWeight));
  }
}

`,Kd=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec3 u_CurrentSelectedId : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;
uniform float u_shaderPick;
uniform float u_EnableSelect: 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define NORMAL 0.0
#define HIGHLIGHT 1.0
#define SELECT 2.0

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

// \u5224\u65AD\u5F53\u524D\u70B9\u662F\u5426\u5DF2\u7ECF\u88AB select \u9009\u4E2D
bool isVertexSelected(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_CurrentSelectedId.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_CurrentSelectedId.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_CurrentSelectedId.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage
  if (u_EnableSelect == 1.0 && u_PickingStage == PICKING_HIGHLIGHT && isVertexSelected(pickingColor)) {
    // \u9009\u4E2D\u6001
    v_PickingResult.a = SELECT;
  } else if (u_PickingStage == PICKING_HIGHLIGHT && isVertexPicked(pickingColor)) {
    // \u9AD8\u4EAE\u6001
    v_PickingResult.a = HIGHLIGHT;
  } else {
    v_PickingResult.a = NORMAL;
  }

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,Tv=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,Mv=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel;
}

// \u9002\u914D\u7EB9\u7406\u8D34\u56FE\u7684\u7B49\u50CF\u7D20\u5927\u5C0F
float project_pixel_texture(float pixel) {
  // mapbox zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }

  // amap2 zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }

  // amap zoom > 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }
  
  // amap zoom < 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return pixel * pow(2.0, (20.0 - u_Zoom));
  }
  return pixel * 2.0;
}

// \u5728\u4E0D\u8BBA\u4EC0\u4E48\u5E95\u56FE\u4E0B\u9700\u8981\u7EDF\u4E00\u5904\u7406\u7684\u65F6\u5019\u4F7F\u7528
float project_float_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // mapbox P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,$d=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,Pv=`attribute float a_vertexId;

uniform mat4 u_cellTypeLayout;      // \u63CF\u8FF0\u6570\u636E\u7EB9\u7406 cell \u7ED3\u6784\u7684\u77E9\u9635
uniform sampler2D u_dataTexture;    // \u6570\u636E\u7EB9\u7406

bool hasOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 opacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeOpacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeWidth() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeWidth \u7684\u6570\u636E
  return u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStroke() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 stroke \u7684\u6570\u636E
  return u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasOffsets() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 offsets \u7684\u6570\u636E
  return u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasThetaOffset() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 thetaOffset \u7684\u6570\u636E
  return u_cellTypeLayout[2][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

// \u6839\u636E\u5750\u6807\u4F4D\u7F6E\u5148\u662F\u8BA1\u7B97 uv \uFF0C\u7136\u540E\u6839\u636E uv \u4ECE\u6570\u636E\u7EB9\u7406\u4E2D\u53D6\u503C
float pos2value(vec2 pos, float columnWidth, float rowHeight) {
  float u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;
  float v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);
  return texture2D(u_dataTexture, vec2(u, v)).r;
}

/*
  currentRow \u5F53\u524D\u884C
  currentColumn \u5F53\u524D\u5217
  columnCount \u6709\u591A\u5C11\u5217
  nextStep \u9700\u8981\u8BA1\u7B97\u5F53\u524D cell \u540E\u7684\u7B2C\u51E0\u4E2A cell \uFF08\u5F53\u524D cell \u5219 nextStep = 0\uFF09
*/
vec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {
  float nextColumn = currentColumn;
  float nextRow = currentRow;
  if(currentColumn + nextStep <= columnCount){
    nextColumn = currentColumn + nextStep;
  } else {
    nextColumn = mod(currentColumn + nextStep, columnCount); // \u4E0D\u4F1A\u51FA\u73B0\u8DE8\u4E24\u884C
    nextRow = currentRow + 1.0;
  }
  return vec2(nextColumn, nextRow);
}

// \u8BA1\u7B97\u5F53\u524D\u5355\u4E2A cell \u7684\u5927\u5C0F
float calCellCount() { 
  //   u_cellTypeLayout
  //   cal_height, WIDTH, 0.0, 0.0, // rowCount columnCount - \u51E0\u884C\u51E0\u5217
  //   1.0, 1.0, 1.0, 0.0, // opacity strokeOpacity strokeWidth stroke - 1.0 \u8868\u793A\u6709\u6570\u636E\u6620\u5C04\u30010.0 \u8868\u793A\u6CA1\u6709
  //   1.0, 1.0, 0.0, 0.0, // offsets thetaOffset
  //   0.0, 0.0, 0.0, 0.0
  
  return  u_cellTypeLayout[1][0] +        // opacity
          u_cellTypeLayout[1][1] +        // strokeOpacity
          u_cellTypeLayout[1][2] +        // strokeWidth
          u_cellTypeLayout[1][3] * 4.0 +  // stroke
          u_cellTypeLayout[2][0] * 2.0 +  // offsets
          u_cellTypeLayout[2][1];         // thetaOffset
}`,xp=`
// \u8BA1\u7B97 opacity \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasOpacity()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 opacity \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureOpacity, textureOffset + 1.0);
  }
}
`,Iv=`
// \u8BA1\u7B97 strokeOpaicty \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeOpacity()) {
    return vec2(u_stroke_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeOpacity, textureOffset + 1.0);
  }
}
`,ud=`
// \u8BA1\u7B97 strokeWidth \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeWidth()) {
    return vec2(u_stroke_width, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeWidth, textureOffset + 1.0);
  }
}
`,Sm=`
// \u8BA1\u7B97 thetaOffset \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calThetaOffsetAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasThetaOffset()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 thetaOffset \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_thetaOffset, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureThetaOffset = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureThetaOffset, textureOffset + 1.0);
  }
}
`,Ov=/precision\s+(high|low|medium)p\s+float/,Cm=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,Am=/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,wm=(Wd=(0,Lr.b2)(),Wd(Xd=function(){function e(){(0,lt.Z)(this,e),(0,I.Z)(this,"moduleCache",{}),(0,I.Z)(this,"rawContentCache",{})}return(0,It.Z)(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:dc,fs:dc}),this.registerModule("decode",{vs:Av,fs:""}),this.registerModule("projection",{vs:Mv,fs:""}),this.registerModule("project",{vs:Tv,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:$d}),this.registerModule("lighting",{vs:qd,fs:""}),this.registerModule("light",{vs:Yd,fs:""}),this.registerModule("picking",{vs:Kd,fs:wv}),this.registerModule("styleMapping",{vs:Pv,fs:""}),this.registerModule("styleMappingCalThetaOffset",{vs:Sm,fs:""}),this.registerModule("styleMappingCalOpacity",{vs:xp,fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:Iv,fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:ud,fs:""})}},{key:"registerModule",value:function(r,n){if(!this.rawContentCache[r]){var a=n.vs,s=n.fs,h=n.uniforms,m=Hd(a),y=m.content,b=m.uniforms,A=Hd(s),P=A.content,k=A.uniforms;this.rawContentCache[r]={fs:P,uniforms:nh(nh(nh({},b),k),h),vs:y}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(r){var n=this;if(this.moduleCache[r])return this.moduleCache[r];var a=this.rawContentCache[r].vs,s=this.rawContentCache[r].fs,h=this.processModule(a,[],"vs"),m=h.content,y=h.includeList,b=this.processModule(s,[],"fs"),A=b.content,P=b.includeList,k=A,F=rh()(y.concat(P).concat(r)).reduce(function(q,oe){return nh(nh({},q),n.rawContentCache[oe].uniforms)},{});return Ov.test(A)||(k=Cm+A),this.moduleCache[r]={fs:k.trim(),uniforms:F,vs:m.trim()},this.moduleCache[r]}},{key:"processModule",value:function(r,n,a){var s=this,h=r.replace(Am,function(m,y){var b=y.split(" "),A=b[0].replace(/"/g,"");if(n.indexOf(A)>-1)return"";var P=s.rawContentCache[A][a];n.push(A);var k=s.processModule(P,n,a),F=k.content;return F});return{content:h,includeList:n}}}]),e}())||Xd),ld=R(66213),Ef;(function(e){e.Normal="normal",e.PostProcessing="post-processing"})(Ef||(Ef={}));var Rv,Lv,cd=(Rv=(0,Lr.b2)(),Rv(Lv=function(){function e(){(0,lt.Z)(this,e),(0,I.Z)(this,"shaderModuleService",void 0),(0,I.Z)(this,"rendererService",void 0),(0,I.Z)(this,"cameraService",void 0),(0,I.Z)(this,"mapService",void 0),(0,I.Z)(this,"interactionService",void 0),(0,I.Z)(this,"layerService",void 0),(0,I.Z)(this,"config",void 0)}return(0,It.Z)(e,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return Ef.Normal}},{key:"init",value:function(r,n){this.config=n,this.rendererService=r.getContainer().get($t.IRendererService),this.cameraService=r.getContainer().get($t.ICameraService),this.mapService=r.getContainer().get($t.IMapService),this.interactionService=r.getContainer().get($t.IInteractionService),this.layerService=r.getContainer().get($t.ILayerService),this.shaderModuleService=r.getContainer().get($t.IShaderModuleService)}},{key:"render",value:function(r){}}]),e}())||Lv),jl,bp;function kv(e){var i=Ep();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function Ep(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Dv=(jl=(0,Lr.b2)(),jl(bp=function(e){(0,pn.Z)(r,e);var i=kv(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(a,s){(0,ld.Z)((0,Yt.Z)(r.prototype),"init",this).call(this,a,s)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),r}(cd))||bp),d0,v0,m0,Tm,g0;function Hx(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Wx(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(b){throw b},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,h=!1,m;return{s:function(){r=r.call(e)},n:function(){var b=r.next();return s=b.done,b},e:function(b){h=!0,m=b},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(h)throw m}}}}function Wx(e,i){if(!!e){if(typeof e=="string")return y0(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return y0(e,i)}}function y0(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Xx=(d0=(0,Lr.b2)(),v0=(0,Lr.f3)($t.IPostProcessor),d0(m0=(Tm=function(){function e(){(0,lt.Z)(this,e),(0,I.Z)(this,"passes",[]),Vn(this,"postProcessor",g0,this),(0,I.Z)(this,"layer",void 0),(0,I.Z)(this,"renderFlag",void 0),(0,I.Z)(this,"width",0),(0,I.Z)(this,"height",0)}return(0,It.Z)(e,[{key:"setLayer",value:function(r){this.layer=r}},{key:"setRenderFlag",value:function(r){this.renderFlag=r}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var i=(0,Ea.Z)(Mi().mark(function n(){var a,s,h;return Mi().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:a=Hx(this.passes),y.prev=1,a.s();case 3:if((s=a.n()).done){y.next=9;break}return h=s.value,y.next=7,h.render(this.layer);case 7:y.next=3;break;case 9:y.next=14;break;case 11:y.prev=11,y.t0=y.catch(1),a.e(y.t0);case 14:return y.prev=14,a.f(),y.finish(14);case 17:return y.next=19,this.postProcessor.render(this.layer);case 19:case"end":return y.stop()}},n,this,[[1,11,14,17]])}));function r(){return i.apply(this,arguments)}return r}()},{key:"resize",value:function(r,n){(this.width!==r||this.height!==n)&&(this.postProcessor.resize(r,n),this.width=r,this.height=n)}},{key:"add",value:function(r,n){r.getType()===Ef.PostProcessing?this.postProcessor.add(r,this.layer,n):(r.init(this.layer,n),this.passes.push(r))}},{key:"insert",value:function(r,n,a){r.init(this.layer,n),this.passes.splice(a,0,r)}},{key:"destroy",value:function(){this.passes.length=0}}]),e}(),g0=wn(Tm.prototype,"postProcessor",[v0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tm))||m0),_0,x0;function b0(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function E0(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?b0(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):b0(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Yx(e){var i=qx();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function qx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Kx=(_0=(0,Lr.b2)(),_0(x0=function(e){(0,pn.Z)(r,e);var i=Yx(r);function r(){var n;(0,lt.Z)(this,r);for(var a=arguments.length,s=new Array(a),h=0;h<a;h++)s[h]=arguments[h];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,xe.Z)(n),"pickingFBO",void 0),(0,I.Z)((0,xe.Z)(n),"layer",void 0),(0,I.Z)((0,xe.Z)(n),"width",0),(0,I.Z)((0,xe.Z)(n),"height",0),(0,I.Z)((0,xe.Z)(n),"alreadyInRendering",!1),(0,I.Z)((0,xe.Z)(n),"pickFromPickingFBO",function(m){var y=m.x,b=m.y,A=m.lngLat,P=m.type;if(!(!n.layer.isVisible()||!n.layer.needPick(P))){var k=n.rendererService,F=k.getViewportSize,q=k.readPixels,oe=k.useFramebuffer,ue=F(),Pe=ue.width,et=ue.height,at=n.layer.getLayerConfig(),_t=at.enableHighlight,Nt=at.enableSelect,Ht=y*Aa,nr=b*Aa;if(!(Ht>Pe||Ht<0||nr>et||nr<0)){var mr;oe(n.pickingFBO,function(){var Hr;if(mr=q({x:Math.round(Ht),y:Math.round(et-(b+1)*Aa),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:n.pickingFBO}),mr[0]!==0||mr[1]!==0||mr[2]!==0){var fn=Ae(mr),Or=n.layer.getSource().getFeatureById(fn),Tn={x:y,y:b,type:P,lngLat:A,featureId:fn,feature:Or};Or&&(n.layer.setCurrentPickId(fn),n.triggerHoverOnLayer(Tn))}else{var zn={x:y,y:b,lngLat:A,type:n.layer.getCurrentPickId()===null?"un"+P:"mouseout",featureId:null,feature:null};n.triggerHoverOnLayer(E0(E0({},zn),{},{type:"unpick"})),n.triggerHoverOnLayer(zn),n.layer.setCurrentPickId(null)}_t&&n.highlightPickedFeature(mr),Nt&&P==="click"&&((Hr=mr)===null||Hr===void 0?void 0:Hr.toString())!==[0,0,0,0].toString()&&n.selectFeature(mr)})}}}),n}return(0,It.Z)(r,[{key:"getType",value:function(){return Ef.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(a,s){(0,ld.Z)((0,Yt.Z)(r.prototype),"init",this).call(this,a,s),this.layer=a;var h=this.rendererService,m=h.createTexture2D,y=h.createFramebuffer,b=h.getViewportSize,A=b(),P=A.width,k=A.height;this.pickingFBO=y({color:m({width:P,height:k,wrapS:ee.CLAMP_TO_EDGE,wrapT:ee.CLAMP_TO_EDGE})}),this.interactionService.on(ei.Hover,this.pickFromPickingFBO),this.interactionService.on(ei.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(ei.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(a){var s=this;if(!this.alreadyInRendering){var h=this.rendererService,m=h.getViewportSize,y=h.useFramebuffer,b=h.clear,A=m(),P=A.width,k=A.height;this.alreadyInRendering=!0,(this.width!==P||this.height!==k)&&(this.pickingFBO.resize({width:P,height:k}),this.width=P,this.height=k),y(this.pickingFBO,function(){b({framebuffer:s.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var F=s.layer.multiPassRenderer.getRenderFlag();s.layer.multiPassRenderer.setRenderFlag(!1),a.hooks.beforePickingEncode.call(),a.render(),a.hooks.afterPickingEncode.call(),s.layer.multiPassRenderer.setRenderFlag(F),s.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(a){this.layer.emit(a.type,a)}},{key:"highlightPickedFeature",value:function(a){var s=(0,ne.Z)(a,3),h=s[0],m=s[1],y=s[2];this.layer.hooks.beforeHighlight.call([h,m,y]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(a){var s=(0,ne.Z)(a,3),h=s[0],m=s[1],y=s[2];this.layer.hooks.beforeSelect.call([h,m,y]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(a){var s=a.featureId,h=Ve(s);this.selectFeature(new Uint8Array(h))}},{key:"highlightFeatureHandle",value:function(a){var s=a.featureId,h=Ve(s);this.highlightPickedFeature(new Uint8Array(h))}}]),r}(cd))||x0),$x=R(11700),Jx=R.n($x),Qx=R(68929),eb=R.n(Qx),S0,C0,A0,Mm,w0;function T0(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Jd(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?T0(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):T0(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var tb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,ih=(S0=(0,Lr.b2)(),C0=(0,Lr.f3)($t.IShaderModuleService),S0(A0=(Mm=function(){function e(){(0,lt.Z)(this,e),Vn(this,"shaderModuleService",w0,this),(0,I.Z)(this,"rendererService",void 0),(0,I.Z)(this,"config",void 0),(0,I.Z)(this,"quad",tb),(0,I.Z)(this,"enabled",!0),(0,I.Z)(this,"renderToScreen",!1),(0,I.Z)(this,"model",void 0),(0,I.Z)(this,"name",void 0),(0,I.Z)(this,"optionsToUpdate",{})}return(0,It.Z)(e,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(r){this.name=r}},{key:"getType",value:function(){return Ef.PostProcessing}},{key:"init",value:function(r,n){this.config=n,this.rendererService=r.getContainer().get($t.IRendererService),this.shaderModuleService=r.getContainer().get($t.IShaderModuleService);var a=this.rendererService,s=a.createAttribute,h=a.createBuffer,m=a.createModel,y=this.setupShaders(),b=y.vs,A=y.fs,P=y.uniforms;this.model=m({vs:b,fs:A,attributes:{a_Position:s({buffer:h({data:[-4,-4,4,-4,0,4],type:ee.FLOAT}),size:2})},uniforms:Jd(Jd({u_Texture:null},P),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(r,n){var a=this,s=r.multiPassRenderer.getPostProcessor(),h=this.rendererService,m=h.useFramebuffer,y=h.getViewportSize,b=h.clear,A=y(),P=A.width,k=A.height;m(this.renderToScreen?null:s.getWriteFBO(),function(){b({framebuffer:s.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});var F=Jd({u_BloomFinal:0,u_Texture:s.getReadFBO(),u_ViewportSize:[P,k]},a.convertOptionsToUniforms(a.optionsToUpdate));n&&(F.u_BloomFinal=1,F.u_Texture2=n),a.model.draw({uniforms:F})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(r){this.enabled=r}},{key:"setRenderToScreen",value:function(r){this.renderToScreen=r}},{key:"updateOptions",value:function(r){this.optionsToUpdate=Jd(Jd({},this.optionsToUpdate),r)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(r){var n={};return Object.keys(r).forEach(function(a){Nu()(r[a])||(n["u_".concat(Jx()(eb()(a)))]=r[a])}),n}}]),e}(),w0=wn(Mm.prototype,"shaderModuleService",[C0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mm))||A0),M0,P0;function I0(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function O0(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?I0(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):I0(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function rb(e){var i=nb();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function nb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ib=`varying vec2 v_UV;

uniform float u_BloomFinal: 0.0;
uniform sampler2D u_Texture;
uniform sampler2D u_Texture2;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_radius: 5.0;
uniform float u_intensity: 0.3;
uniform float u_baseRadio: 0.5;

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

float luminance(vec4 color) {
  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;
}

void main() {
  // vec4 baseColor = texture2D(u_Texture, v_UV);
  // float lum = luminance(baseColor);
  // baseColor.a *= lum;

  // gl_FragColor = baseColor;

  // if(u_BloomFinal > 0.0) { // 
  //   gl_FragColor = baseColor; //-- 
  // }

  float r = sqrt(u_radius);

  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));
  // c1 *= luminance(c1);
  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));
  // c2 *= luminance(c2);
  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));
  // c3 *= luminance(c3);
  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));
  // c4 *= luminance(c4);
  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;

  // float lum = luminance(inbloomColor);
  // inbloomColor.rgb *= lum;

  if(u_BloomFinal > 0.0) {
    vec4 baseColor = texture2D(u_Texture2, v_UV);
    float baselum = luminance(baseColor);
    // float lum = luminance(inbloomColor);
    // vec4 bloom = vec4(lum);
    // inbloomColor.a *= lum;
    // gl_FragColor = inbloomColor * u_intensity + texture2D(u_Texture2, v_UV);
    // gl_FragColor = inbloomColor * 0.5 + texture2D(u_Texture2, v_UV);
    // gl_FragColor = baseColor;
    // gl_FragColor = inbloomColor;
    // vec4 mixColor = mix(baseColor, inbloomColor, max(u_intensity - 0.3, 0.0));
    // mixColor.a = max(baseColor.a, mixColor.a);
    gl_FragColor = mix(inbloomColor, baseColor, max(1.0 - u_intensity, u_baseRadio));
    // gl_FragColor = mixColor;
    // gl_FragColor = baseColor;
    
    if(baselum <= 0.0) {
      // float lum = luminance(inbloomColor);
      // inbloomColor.rgb *= lum;
      gl_FragColor += inbloomColor * u_intensity;
    }
    // gl_FragColor = inbloomColor * baseColor + baseColor;
    // gl_FragColor = baseColor + bloom * 0.5;
  } else {
    gl_FragColor = inbloomColor;
  }
  // gl_FragColor = inbloomColor;

  // float h = 0.01;
  
  // vec4 color11 = texture2D( u_Texture, vec2( v_UV.x - 1.0 * h, v_UV.y + 1.0 * h) );
  // vec4 color12 = texture2D( u_Texture, vec2( v_UV.x - 0.0 * h, v_UV.y + 1.0 * h) );
  // vec4 color13 = texture2D( u_Texture, vec2( v_UV.x + 1.0 * h, v_UV.y + 1.0 * h) );

  // vec4 color21 = texture2D( u_Texture, vec2( v_UV.x - 1.0 * h, v_UV.y) );
  // vec4 color23 = texture2D( u_Texture, vec2( v_UV.x + 1.0 * h, v_UV.y) );

  // vec4 color31 = texture2D( u_Texture, vec2( v_UV.x - 1.0 * h, v_UV.y-1.0*h) );
  // vec4 color32 = texture2D( u_Texture, vec2( v_UV.x - 0.0 * h, v_UV.y-1.0*h) );
  // vec4 color33 = texture2D( u_Texture, vec2( v_UV.x + 1.0 * h, v_UV.y-1.0*h) );

  // vec4 bloomColor =
  //   color11 + 
  //   color12 + 
  //   color13 + 
  //   color21 + 
  //   color21 + 
  //   color23 + 
  //   color31 + 
  //   color32 + 
  //   color33;

  //   if(baseColor.a > 0.0) {
      
  //     gl_FragColor.r = min(bloomColor.r, baseColor.r);
  //     gl_FragColor.g = min(bloomColor.g, baseColor.g);
  //     gl_FragColor.b = min(bloomColor.b, baseColor.b);
  //     gl_FragColor.a = min(bloomColor.a, baseColor.a);

  //     gl_FragColor = mix(inbloomColor, gl_FragColor, 0.7);
  //   } else {
  //     gl_FragColor = bloomColor/9.0;
  //   } 
}`,ab=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,ob=(M0=(0,Lr.b2)(),M0(P0=function(e){(0,pn.Z)(r,e);var i=rb(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:ab,fs:ib});var a=this.shaderModuleService.getModule("blur-pass"),s=a.vs,h=a.fs,m=a.uniforms,y=this.rendererService.getViewportSize(),b=y.width,A=y.height;return{vs:s,fs:h,uniforms:O0(O0({},m),{},{u_ViewportSize:[b,A]})}}},{key:"convertOptionsToUniforms",value:function(a){var s={};return Nu()(a.bloomRadius)||(s.u_radius=a.bloomRadius),Nu()(a.bloomIntensity)||(s.u_intensity=a.bloomIntensity),Nu()(a.bloomBaseRadio)||(s.u_baseRadio=a.bloomBaseRadio),s}}]),r}(ih))||P0),R0,L0;function k0(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function D0(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?k0(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):k0(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function sb(e){var i=ub();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function ub(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var lb=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,cb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,fb=(R0=(0,Lr.b2)(),R0(L0=function(e){(0,pn.Z)(r,e);var i=sb(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:cb,fs:lb});var a=this.shaderModuleService.getModule("blur-pass"),s=a.vs,h=a.fs,m=a.uniforms,y=this.rendererService.getViewportSize(),b=y.width,A=y.height;return{vs:s,fs:h,uniforms:D0(D0({},m),{},{u_ViewportSize:[b,A]})}}},{key:"convertOptionsToUniforms",value:function(a){var s={};return Nu()(a.blurRadius)||(s.u_BlurDir=[a.blurRadius,0]),s}}]),r}(ih))||L0),F0,B0;function N0(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function z0(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?N0(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):N0(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function hb(e){var i=pb();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function pb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var db=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,vb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,mb=(F0=(0,Lr.b2)(),F0(B0=function(e){(0,pn.Z)(r,e);var i=hb(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:vb,fs:db});var a=this.shaderModuleService.getModule("blur-pass"),s=a.vs,h=a.fs,m=a.uniforms,y=this.rendererService.getViewportSize(),b=y.width,A=y.height;return{vs:s,fs:h,uniforms:z0(z0({},m),{},{u_ViewportSize:[b,A]})}}},{key:"convertOptionsToUniforms",value:function(a){var s={};return Nu()(a.blurRadius)||(s.u_BlurDir=[0,a.blurRadius]),s}}]),r}(ih))||B0),U0,Z0;function j0(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function V0(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?j0(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):j0(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function gb(e){var i=yb();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function yb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _b=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,xb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,bb=(U0=(0,Lr.b2)(),U0(Z0=function(e){(0,pn.Z)(r,e);var i=gb(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:xb,fs:_b});var a=this.shaderModuleService.getModule("colorhalftone-pass"),s=a.vs,h=a.fs,m=a.uniforms,y=this.rendererService.getViewportSize(),b=y.width,A=y.height;return{vs:s,fs:h,uniforms:V0(V0({},m),{},{u_ViewportSize:[b,A]})}}}]),r}(ih))||Z0),G0,H0;function Eb(e){var i=Sb();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function Sb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Cb=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,Ab=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,wb=(G0=(0,Lr.b2)(),G0(H0=function(e){(0,pn.Z)(r,e);var i=Eb(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:Ab,fs:Cb}),this.shaderModuleService.getModule("copy-pass")}}]),r}(ih))||H0),W0,X0;function Y0(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function q0(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Y0(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Y0(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Tb(e){var i=Mb();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function Mb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Pb=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,Ib=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Ob=(W0=(0,Lr.b2)(),W0(X0=function(e){(0,pn.Z)(r,e);var i=Tb(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:Ib,fs:Pb});var a=this.shaderModuleService.getModule("hexagonalpixelate-pass"),s=a.vs,h=a.fs,m=a.uniforms,y=this.rendererService.getViewportSize(),b=y.width,A=y.height;return{vs:s,fs:h,uniforms:q0(q0({},m),{},{u_ViewportSize:[b,A]})}}}]),r}(ih))||X0),K0,$0;function J0(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Q0(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?J0(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):J0(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Rb(e){var i=Lb();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function Lb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var kb=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,Db=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Fb=(K0=(0,Lr.b2)(),K0($0=function(e){(0,pn.Z)(r,e);var i=Rb(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:Db,fs:kb});var a=this.shaderModuleService.getModule("ink-pass"),s=a.vs,h=a.fs,m=a.uniforms,y=this.rendererService.getViewportSize(),b=y.width,A=y.height;return{vs:s,fs:h,uniforms:Q0(Q0({},m),{},{u_ViewportSize:[b,A]})}}}]),r}(ih))||$0),eg,tg;function Bb(e){var i=Nb();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function Nb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var zb=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,Ub=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Zb=(eg=(0,Lr.b2)(),eg(tg=function(e){(0,pn.Z)(r,e);var i=Bb(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:Ub,fs:zb}),this.shaderModuleService.getModule("noise-pass")}}]),r}(ih))||tg),rg,ng;function jb(e){var i=Vb();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function Vb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Gb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Hb=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,Wb=(rg=(0,Lr.b2)(),rg(ng=function(e){(0,pn.Z)(r,e);var i=jb(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:Gb,fs:Hb}),this.shaderModuleService.getModule("sepia-pass")}}]),r}(ih))||ng),ig,ag,og,sg,fd,ug,Xb=(ig=(0,Lr.b2)(),ag=(0,Lr.f3)($t.IRendererService),og=(0,Lr.zY)(),ig(sg=(fd=function(){function e(){(0,lt.Z)(this,e),Vn(this,"rendererService",ug,this),(0,I.Z)(this,"passes",[]),(0,I.Z)(this,"readFBO",void 0),(0,I.Z)(this,"writeFBO",void 0)}return(0,It.Z)(e,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"getCurrentFBOTex",value:function(){var r=this.rendererService,n=r.getViewportSize,a=r.createTexture2D,s=n(),h=s.width,m=s.height;return a({x:0,y:0,width:h,height:m,copy:!0})}},{key:"getReadFBOTex",value:function(){var r=this,n=this.rendererService.useFramebuffer;return new Promise(function(a,s){n(r.readFBO,(0,Ea.Z)(Mi().mark(function h(){return Mi().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:a(r.getCurrentFBOTex());case 1:case"end":return y.stop()}},h)})))})}},{key:"renderBloomPass",value:function(){var i=(0,Ea.Z)(Mi().mark(function n(a,s){var h,m;return Mi().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,this.getReadFBOTex();case 2:h=b.sent,m=0;case 4:if(!(m<4)){b.next=11;break}return b.next=7,s.render(a,h);case 7:this.swap(),m++,b.next=4;break;case 11:case"end":return b.stop()}},n,this)}));function r(n,a){return i.apply(this,arguments)}return r}()},{key:"render",value:function(){var i=(0,Ea.Z)(Mi().mark(function n(a){var s,h;return Mi().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:s=0;case 1:if(!(s<this.passes.length)){y.next=15;break}if(h=this.passes[s],h.setRenderToScreen(this.isLastEnabledPass(s)),h.getName()!=="bloom"){y.next=9;break}return y.next=7,this.renderBloomPass(a,h);case 7:y.next=12;break;case 9:return y.next=11,h.render(a);case 11:s!==this.passes.length-1&&this.swap();case 12:s++,y.next=1;break;case 15:case"end":return y.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"resize",value:function(r,n){this.readFBO.resize({width:r,height:n}),this.writeFBO.resize({width:r,height:n})}},{key:"add",value:function(r,n,a){r.init(n,a),this.passes.push(r)}},{key:"insert",value:function(r,n,a,s){r.init(a,s),this.passes.splice(n,0,r)}},{key:"getPostProcessingPassByName",value:function(r){return this.passes.find(function(n){return n.getName()===r})}},{key:"init",value:function(){var r=this.rendererService,n=r.createFramebuffer,a=r.createTexture2D;this.readFBO=n({color:a({width:1,height:1,wrapS:ee.CLAMP_TO_EDGE,wrapT:ee.CLAMP_TO_EDGE})}),this.writeFBO=n({color:a({width:1,height:1,wrapS:ee.CLAMP_TO_EDGE,wrapT:ee.CLAMP_TO_EDGE})})}},{key:"isLastEnabledPass",value:function(r){for(var n=r+1;n<this.passes.length;n++)if(this.passes[n].isEnabled())return!1;return!0}},{key:"swap",value:function(){var r=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=r}}]),e}(),ug=wn(fd.prototype,"rendererService",[ag],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wn(fd.prototype,"init",[og],Object.getOwnPropertyDescriptor(fd.prototype,"init"),fd.prototype),fd))||sg),lg,cg;function Yb(e){var i=qb();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function qb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Kb=(lg=(0,Lr.b2)(),lg(cg=function(e){(0,pn.Z)(r,e);var i=Yb(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"getType",value:function(){return Ef.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(a,s){(0,ld.Z)((0,Yt.Z)(r.prototype),"init",this).call(this,a,s)}},{key:"render",value:function(a){var s=this.rendererService,h=s.useFramebuffer,m=s.clear,y=a.multiPassRenderer.getPostProcessor().getReadFBO();h(y,function(){m({color:[0,0,0,0],depth:1,stencil:0,framebuffer:y}),a.multiPassRenderer.setRenderFlag(!1),a.models.forEach(function(b){b.draw({uniforms:a.layerModel.getUninforms()})}),a.multiPassRenderer.setRenderFlag(!0)})}}]),r}(cd))||cg),fg,hg,pg,Pm,dg;function vg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function mg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?vg(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):vg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function $b(e){var i=Jb();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function Jb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Qb=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,gg=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,e2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function yg(e,i){for(var r=0,n=1/i,a=e;a>0;)r=r+n*(a%i),a=Math.floor(a/i),n=n/i;return r}var t2=1,r2=(fg=(0,Lr.b2)(),hg=(0,Lr.f3)($t.IShaderModuleService),fg(pg=(Pm=function(e){(0,pn.Z)(r,e);var i=$b(r);function r(){var n;(0,lt.Z)(this,r);for(var a=arguments.length,s=new Array(a),h=0;h<a;h++)s[h]=arguments[h];return n=i.call.apply(i,[this].concat(s)),Vn((0,xe.Z)(n),"shaderModuleService",dg,(0,xe.Z)(n)),(0,I.Z)((0,xe.Z)(n),"haltonSequence",[]),(0,I.Z)((0,xe.Z)(n),"accumulatingId",0),(0,I.Z)((0,xe.Z)(n),"frame",0),(0,I.Z)((0,xe.Z)(n),"timer",void 0),(0,I.Z)((0,xe.Z)(n),"sampleRenderTarget",void 0),(0,I.Z)((0,xe.Z)(n),"prevRenderTarget",void 0),(0,I.Z)((0,xe.Z)(n),"outputRenderTarget",void 0),(0,I.Z)((0,xe.Z)(n),"copyRenderTarget",void 0),(0,I.Z)((0,xe.Z)(n),"blendModel",void 0),(0,I.Z)((0,xe.Z)(n),"outputModel",void 0),(0,I.Z)((0,xe.Z)(n),"copyModel",void 0),n}return(0,It.Z)(r,[{key:"getType",value:function(){return Ef.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(a,s){(0,ld.Z)((0,Yt.Z)(r.prototype),"init",this).call(this,a,s);var h=this.rendererService,m=h.createFramebuffer,y=h.createTexture2D;this.sampleRenderTarget=m({color:y({width:1,height:1,wrapS:ee.CLAMP_TO_EDGE,wrapT:ee.CLAMP_TO_EDGE})}),this.prevRenderTarget=m({color:y({width:1,height:1,wrapS:ee.CLAMP_TO_EDGE,wrapT:ee.CLAMP_TO_EDGE})}),this.outputRenderTarget=m({color:y({width:1,height:1,wrapS:ee.CLAMP_TO_EDGE,wrapT:ee.CLAMP_TO_EDGE})}),this.copyRenderTarget=m({color:y({width:1,height:1,wrapS:ee.CLAMP_TO_EDGE,wrapT:ee.CLAMP_TO_EDGE})});for(var b=0;b<30;b++)this.haltonSequence.push([yg(b,2),yg(b,3)]);this.blendModel=this.createTriangleModel("blend-pass",Qb),this.outputModel=this.createTriangleModel("copy-pass",gg,{blend:{enable:!0,func:{srcRGB:ee.ONE,dstRGB:ee.ONE_MINUS_SRC_ALPHA,srcAlpha:ee.ONE,dstAlpha:ee.ONE_MINUS_SRC_ALPHA},equation:{rgb:ee.FUNC_ADD,alpha:ee.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",gg)}},{key:"render",value:function(a){var s=this,h=this.rendererService,m=h.clear,y=h.getViewportSize,b=h.useFramebuffer,A=y(),P=A.width,k=A.height;this.sampleRenderTarget.resize({width:P,height:k}),this.prevRenderTarget.resize({width:P,height:k}),this.outputRenderTarget.resize({width:P,height:k}),this.copyRenderTarget.resize({width:P,height:k}),this.resetFrame(),this.stopAccumulating();var F=a.multiPassRenderer.getPostProcessor().getReadFBO();b(F,function(){m({color:[0,0,0,0],depth:1,stencil:0,framebuffer:F}),a.multiPassRenderer.setRenderFlag(!1),a.render(),a.multiPassRenderer.setRenderFlag(!0)});var q=function oe(ue){!s.accumulatingId||ue!==s.accumulatingId||s.isFinished()||(s.doRender(a),ba.requestAnimationFrame(function(){oe(ue)}))};this.accumulatingId=t2++,this.timer=ba.setTimeout(function(){q(s.accumulatingId)},50)}},{key:"doRender",value:function(a){var s=this,h=this.rendererService,m=h.clear,y=h.getViewportSize,b=h.useFramebuffer,A=y(),P=A.width,k=A.height,F=a.getLayerConfig(),q=F.jitterScale,oe=q===void 0?1:q,ue=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((ue[0]*2-1)/P*oe,(ue[1]*2-1)/k*oe),a.multiPassRenderer.setRenderFlag(!1),a.hooks.beforeRender.call(),b(this.sampleRenderTarget,function(){m({color:[0,0,0,0],depth:1,stencil:0,framebuffer:s.sampleRenderTarget}),a.render()}),a.hooks.afterRender.call(),a.multiPassRenderer.setRenderFlag(!0);var Pe=a.getLayerConfig();b(this.outputRenderTarget,function(){s.blendModel.draw({uniforms:{u_opacity:Pe.opacity||1,u_MixRatio:s.frame===0?1:.9,u_Diffuse1:s.sampleRenderTarget,u_Diffuse2:s.frame===0?a.multiPassRenderer.getPostProcessor().getReadFBO():s.prevRenderTarget}})}),this.frame===0&&m({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(b(this.copyRenderTarget,function(){s.outputModel.draw({uniforms:{u_Texture:s.outputRenderTarget}})}),b(a.multiPassRenderer.getPostProcessor().getReadFBO(),function(){s.copyModel.draw({uniforms:{u_Texture:s.copyRenderTarget}})}),a.multiPassRenderer.getPostProcessor().render(a));var et=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=et,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,ba.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(a,s,h){this.shaderModuleService.registerModule(a,{vs:e2,fs:s});var m=this.shaderModuleService.getModule(a),y=m.vs,b=m.fs,A=m.uniforms,P=this.rendererService,k=P.createAttribute,F=P.createBuffer,q=P.createModel;return q(mg({vs:y,fs:b,attributes:{a_Position:k({buffer:F({data:[-4,-4,4,-4,0,4],type:ee.FLOAT}),size:2})},uniforms:mg({},A),depth:{enable:!1},count:3},h))}}]),r}(cd),dg=wn(Pm.prototype,"shaderModuleService",[hg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pm))||pg),Qd=new Lr.W2;Qd.bind($t.IGlobalConfigService).to(wa).inSingletonScope(),(0,Lr.GW)((0,Lr.b2)(),Cs.EventEmitter),Qd.bind($t.IEventEmitter).to(Cs.EventEmitter);var _g=(0,Gp.Z)(Qd,!1),Im=function(i){var r=_g.lazyInject(i);return function(n,a,s){r.call(this,n,a),s&&(s.initializer=function(){return n[a]})}},_5=function(i){var r=_g.lazyMultiInject(i);return function(n,a,s){r.call(this,n,a),s&&(s.initializer=function(){return n[a]})}},Vl=Qd,n2=0;function i2(){var e=new Lr.W2;return e.parent=Qd,e.bind($t.SceneID).toConstantValue("".concat(n2++)),e.bind($t.IShaderModuleService).to(wm).inSingletonScope(),e.bind($t.ILayerService).to(cp).inSingletonScope(),e.bind($t.ISceneService).to(Fh).inSingletonScope(),e.bind($t.ICameraService).to(ce).inSingletonScope(),e.bind($t.ICoordinateSystemService).to(ki).inSingletonScope(),e.bind($t.IInteractionService).to(Oo).inSingletonScope(),e.bind($t.IPickingService).to(Uo).inSingletonScope(),e.bind($t.IControlService).to(it).inSingletonScope(),e.bind($t.IMarkerService).to(we).inSingletonScope(),e.bind($t.IIconService).to(_r).inSingletonScope(),e.bind($t.IFontService).to(z).inSingletonScope(),e.bind($t.IPopupService).to(pr).inSingletonScope(),e.bind($t.INormalPass).to(Dv).whenTargetNamed("clear"),e.bind($t.INormalPass).to(Kx).whenTargetNamed("pixelPicking"),e.bind($t.INormalPass).to(Kb).whenTargetNamed("render"),e.bind($t.INormalPass).to(r2).whenTargetNamed("taa"),e.bind($t.IFactoryNormalPass).toFactory(function(i){return function(r){return i.container.getNamed($t.INormalPass,r)}}),e.bind($t.IPostProcessingPass).to(wb).whenTargetNamed("copy"),e.bind($t.IPostProcessingPass).to(ob).whenTargetNamed("bloom"),e.bind($t.IPostProcessingPass).to(fb).whenTargetNamed("blurH"),e.bind($t.IPostProcessingPass).to(mb).whenTargetNamed("blurV"),e.bind($t.IPostProcessingPass).to(Zb).whenTargetNamed("noise"),e.bind($t.IPostProcessingPass).to(Wb).whenTargetNamed("sepia"),e.bind($t.IPostProcessingPass).to(bb).whenTargetNamed("colorHalftone"),e.bind($t.IPostProcessingPass).to(Ob).whenTargetNamed("hexagonalPixelate"),e.bind($t.IPostProcessingPass).to(Fb).whenTargetNamed("ink"),e.bind($t.IFactoryPostProcessingPass).toFactory(function(i){return function(r){var n=i.container.getNamed($t.IPostProcessingPass,r);return n.setName(r),n}}),e}function a2(e){var i=new Lr.W2;return i.parent=e,i.bind($t.IStyleAttributeService).to(pp).inSingletonScope(),i.bind($t.IMultiPassRenderer).to(Xx).inSingletonScope(),i.bind($t.IPostProcessor).to(Xb).inSingletonScope(),i}var x5=R(74691),o2=null;function b5(e){return o2.indexOf(e)}var s2=2,E5=4,u2=64,S5=128,l2=256,c2=512,C5=8192,A5=16384,w5=32768,f2=null,xg=131072,T5=262144,h2=524288,M5=1048576,p2=2097152,P5=4194304,d2=8388608,v2=16777216,m2=null;function Fv(e,i){return e=_clamp(Math.floor(e),0,255),i=_clamp(Math.floor(i),0,255),256*e+i}function I5(e){var i=e.color,r=e.radius,n=e.tileX,a=e.tileY,s=e.shape,h=e.opacity,m=e.stroke,y=e.strokeWidth,b=e.strokeOpacity,A=[],P=[],k=[],F=[Fv(i[0],i[1]),Fv(i[2],i[3])],q=[Fv(m[0],m[1]),Fv(m[2],m[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(oe){var ue=_slicedToArray(oe,2),Pe=ue[0],et=ue[1];A.push([].concat(F,[(Pe+1)*d2+(et+1)*p2+getShapeIndex(s)*xg+r,(n+512)*h2+(a+512)*u2])),P.push([].concat(q,[y,b])),k.push([h,0,0,0])}),{packedBuffer:A,packedBuffer2:P,packedBuffer3:k}}function O5(e,i){if(e===0&&!i)return 0;if(e===1&&i)return 4294967295;var r=i?1:0,n=Math.floor(e*127);return n*m2+r*v2+n*xg+r*f2+n*c2+r*l2+n*s2+r}var vc;(function(e){e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none"})(vc||(vc={}));var iu;(function(e){e.LINEAR="linear",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat"})(iu||(iu={}));var zh;(function(e){e.CONSTANT="constant",e.VARIABLE="variable"})(zh||(zh={}));var Jn;(function(e){e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform"})(Jn||(Jn={}));var g2=["mapload","mapchange"],Sp={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},Om=["loaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"],Uh;(function(e){e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter"})(Uh||(Uh={}));function bg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Eg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?bg(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):bg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function y2(e){var i=_2();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function _2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var x2=0,Bv=function(e){(0,pn.Z)(r,e);var i=y2(r);function r(n){var a;return(0,lt.Z)(this,r),a=i.call(this),(0,I.Z)((0,xe.Z)(a),"controlOption",void 0),(0,I.Z)((0,xe.Z)(a),"container",void 0),(0,I.Z)((0,xe.Z)(a),"sceneContainer",void 0),(0,I.Z)((0,xe.Z)(a),"mapsService",void 0),(0,I.Z)((0,xe.Z)(a),"renderService",void 0),(0,I.Z)((0,xe.Z)(a),"layerService",void 0),(0,I.Z)((0,xe.Z)(a),"controlService",void 0),(0,I.Z)((0,xe.Z)(a),"isShow",void 0),a.controlOption=Eg(Eg({},a.getDefault()),n||{}),a}return(0,It.Z)(r,[{key:"getDefault",value:function(){return{position:Uh.TOPRIGHT,name:"".concat(x2++)}}},{key:"setPosition",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Uh.BOTTOMRIGHT,s=this.controlService;return s&&s.removeControl(this),this.controlOption.position=a,s&&s.addControl(this,this.sceneContainer),this}},{key:"addTo",value:function(a){this.mapsService=a.get($t.IMapService),this.renderService=a.get($t.IRendererService),this.layerService=a.get($t.ILayerService),this.controlService=a.get($t.IControlService),this.sceneContainer=a,this.isShow=!0,this.container=this.onAdd();var s=this.container,h=this.controlOption.position,m=this.controlService.controlCorners[h];return Us(s,"l7-control"),h.indexOf("bottom")!==-1?m.insertBefore(s,m.firstChild):m.appendChild(s),this}},{key:"onAdd",value:function(){throw new Error("Method not implemented.")}},{key:"onRemove",value:function(){throw new Error("Method not implemented.")}},{key:"hide",value:function(){var a=this.container;Us(a,"l7-control-hide"),this.isShow=!1}},{key:"show",value:function(){var a=this.container;cu(a,"l7-control-hide"),this.isShow=!0}},{key:"remove",value:function(){if(!this.mapsService)return this;po(this.container),this.onRemove()}},{key:"_refocusOnMap",value:function(a){if(this.mapsService&&a&&a.screenX>0&&a.screenY>0){var s=this.mapsService.getContainer();s!==null&&s.focus()}}}]),r}(Cs.EventEmitter);function b2(e){var i=E2();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function E2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var R5=function(e){(0,pn.Z)(r,e);var i=b2(r);function r(n){var a;return(0,lt.Z)(this,r),a=i.call(this,n),(0,I.Z)((0,xe.Z)(a),"layerControlInputs",void 0),(0,I.Z)((0,xe.Z)(a),"layers",void 0),(0,I.Z)((0,xe.Z)(a),"lastZIndex",void 0),(0,I.Z)((0,xe.Z)(a),"handlingClick",void 0),(0,I.Z)((0,xe.Z)(a),"layersLink",void 0),(0,I.Z)((0,xe.Z)(a),"baseLayersList",void 0),(0,I.Z)((0,xe.Z)(a),"separator",void 0),(0,I.Z)((0,xe.Z)(a),"overlaysList",void 0),(0,I.Z)((0,xe.Z)(a),"form",void 0),a.layerControlInputs=[],a.layers=[],a.lastZIndex=0,a.handlingClick=!1,a.initLayers(),he(["checkDisabledLayers","onLayerChange","collapse","extend","expand","onInputClick"],(0,xe.Z)(a)),a}return(0,It.Z)(r,[{key:"getDefault",value:function(){return{collapsed:!0,position:Uh.TOPRIGHT,autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,name:"layers"}}},{key:"onAdd",value:function(){var a=this;return this.initLayout(),this.update(),this.mapsService.on("zoomend",this.checkDisabledLayers),this.layers.forEach(function(s){s.layer.on("remove",a.onLayerChange),s.layer.on("add",a.onLayerChange)}),this.container}},{key:"addVisualLayer",value:function(a,s){return this.addLayer(a,s,!0),this.mapsService?this.update():this}},{key:"expand",value:function(){var a=this.renderService.getViewportSize(),s=a.height;Us(this.container,"l7-control-layers-expanded"),this.form.style.height="null";var h=s-(this.container.offsetTop+50);return h<this.form.clientHeight?(Us(this.form,"l7-control-layers-scrollbar"),this.form.style.height=h+"px"):cu(this.form,"l7-control-layers-scrollbar"),this.checkDisabledLayers(),this}},{key:"collapse",value:function(){return cu(this.container,"l7-control-layers-expanded"),this}},{key:"onRemove",value:function(){var a=this;!this.mapsService||(this.mapsService.off("click",this.collapse),this.layers.forEach(function(s){s.layer.off("remove",a.onLayerChange),s.layer.off("add",a.onLayerChange)}))}},{key:"initLayout",value:function(){var a="l7-control-layers",s=this.container=ma("div",a),h=this.controlOption.collapsed;s.setAttribute("aria-haspopup","true");var m=this.form=ma("form",a+"-list");h&&(this.mapsService.on("click",this.collapse),s.addEventListener("mouseenter",this.expand),s.addEventListener("mouseleave",this.collapse)),this.layersLink=ma("a",a+"-toggle",s);var y=this.layersLink;y.title="Layers",h||this.expand(),this.baseLayersList=ma("div",a+"-base",m),this.separator=ma("div",a+"-separator",m),this.overlaysList=ma("div",a+"-overlays",m),s.appendChild(m)}},{key:"initLayers",value:function(){var a=this,s=this.controlOption,h=s.baseLayers,m=h===void 0?{}:h,y=s.overlayers,b=y===void 0?{}:y;Object.keys(m).forEach(function(A,P){a.addLayer(m[A],A,!1)}),Object.keys(b).forEach(function(A,P){a.addLayer(b[A],A,!0)})}},{key:"update",value:function(){if(!this.container)return this;In(this.baseLayersList),In(this.overlaysList),this.layerControlInputs=[];var a,s,h,m,y=0;for(h=0;h<this.layers.length;h++)m=this.layers[h],this.addItem(m),s=s||m.overlay,a=a||!m.overlay,y+=m.overlay?0:1;return this.controlOption.hideSingleBase&&(a=a&&y>1,this.baseLayersList.style.display=a?"":"none"),this.separator.style.display=s&&a?"":"none",this}},{key:"checkDisabledLayers",value:function(){for(var a=this.layerControlInputs,s,h,m=this.mapsService.getZoom(),y=a.length-1;y>=0;y--)if(s=a[y],h=this.layerService.getLayer(s.layerId),h&&h.inited){var b=h.getMinZoom(),A=h.getMaxZoom();s.disabled=m<b||m>A}}},{key:"addLayer",value:function(a,s,h){this.mapsService&&(a.on("add",this.onLayerChange),a.on("remove",this.onLayerChange)),this.layers.push({layer:a,name:s,overlay:h});var m=this.controlOption,y=m.sortLayers,b=m.sortFunction,A=m.autoZIndex;y&&this.layers.sort(function(P,k){return b(P.layer,k.layer,P.name,k.name)}),A&&a.setZIndex&&(this.lastZIndex++,a.setZIndex(this.lastZIndex)),this.expandIfNotCollapsed()}},{key:"expandIfNotCollapsed",value:function(){return this.mapsService&&!this.controlOption.collapsed&&this.expand(),this}},{key:"onLayerChange",value:function(a){this.handlingClick||this.update();var s=this.layerService.getLayer(a.target.layerId),h=s!=null&&s.overlay?a.type==="add"?"overlayadd":"overlayremove":a.type==="add"?"baselayerchange":null;h&&this.emit(h,s)}},{key:"createRadioElement",value:function(a,s){var h='<input type="radio" class="l7-control-layers-selector" name="'+a+'"'+(s?' checked="checked"':"")+"/>",m=document.createElement("div");return m.innerHTML=h,m.firstChild}},{key:"addItem",value:function(a){var s=document.createElement("label"),h=this.layerService.getLayer(a.layer.id),m=h&&h.inited&&a.layer.isVisible(),y;a.overlay?(y=document.createElement("input"),y.type="checkbox",y.className="l7-control-layers-selector",y.defaultChecked=m):y=this.createRadioElement("l7-base-layers",m),this.layerControlInputs.push(y),y.layerId=a.layer.id,y.addEventListener("click",this.onInputClick);var b=document.createElement("span");b.innerHTML=" "+a.name;var A=document.createElement("div");s.appendChild(A),A.appendChild(y),A.appendChild(b);var P=a.overlay?this.overlaysList:this.baseLayersList;return P.appendChild(s),this.checkDisabledLayers(),s}},{key:"onInputClick",value:function(){var a=this.layerControlInputs,s,h,m=[],y=[];this.handlingClick=!0;for(var b=a.length-1;b>=0;b--)s=a[b],h=this.layerService.getLayer(s.layerId),s.checked?m.push(h):s.checked||y.push(h);y.forEach(function(A){A.hide()}),m.forEach(function(A){A.show()}),this.handlingClick=!1}}]),r}(Bv);function S2(e){var i=C2();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function C2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var A2=function(e){(0,pn.Z)(r,e);var i=S2(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"getDefault",value:function(){return{position:Uh.BOTTOMLEFT,name:"logo"}}},{key:"onAdd",value:function(){var a="l7-control-logo",s=ma("div",a),h=ma("a","l7-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://antv.alipay.com/l7",h.setAttribute("aria-label","AntV logo"),h.setAttribute("rel","noopener nofollow"),s.appendChild(h),s}},{key:"onRemove",value:function(){return null}}]),r}(Bv);function w2(e){var i=T2();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function T2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var L5=function(e){(0,pn.Z)(r,e);var i=w2(r);function r(n){var a;return(0,lt.Z)(this,r),a=i.call(this,n),(0,I.Z)((0,xe.Z)(a),"mScale",void 0),(0,I.Z)((0,xe.Z)(a),"iScale",void 0),he(["update"],(0,xe.Z)(a)),a}return(0,It.Z)(r,[{key:"getDefault",value:function(){return{position:Uh.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,name:"scale"}}},{key:"onAdd",value:function(){var a="l7-control-scale",s=ma("div",a);this.addScales(a+"-line",s);var h=this.controlOption.updateWhenIdle;return this.mapsService.on(h?"moveend":"mapmove",this.update),this.mapsService.on(h?"zoomend":"zoomchange",this.update),this.update(),s}},{key:"onRemove",value:function(){var a=this.controlOption.updateWhenIdle;this.mapsService.off(a?"zoomend":"zoomchange",this.update),this.mapsService.off(a?"moveend":"mapmove",this.update)}},{key:"update",value:function(){var a=this.mapsService,s=this.controlOption.maxWidth,h=a.getSize()[1]/2,m=a.containerToLngLat([0,h]),y=a.containerToLngLat([s,h]),b=tc([m.lng,m.lat],[y.lng,y.lat]);this.updateScales(b)}},{key:"updateScales",value:function(a){var s=this.controlOption,h=s.metric,m=s.imperial;h&&a&&this.updateMetric(a),m&&a&&this.updateImperial(a)}},{key:"updateMetric",value:function(a){var s=this.getRoundNum(a),h=s<1e3?s+" m":s/1e3+" km";this.updateScale(this.mScale,h,s/a)}},{key:"updateImperial",value:function(a){var s=a*3.2808399,h,m,y;s>5280?(h=s/5280,m=this.getRoundNum(h),this.updateScale(this.iScale,m+" mi",m/h)):(y=this.getRoundNum(s),this.updateScale(this.iScale,y+" ft",y/s))}},{key:"updateScale",value:function(a,s,h){var m=this.controlOption.maxWidth;a.style.width=Math.round(m*h)+"px",a.innerHTML=s}},{key:"getRoundNum",value:function(a){var s=Math.pow(10,(Math.floor(a)+"").length-1),h=a/s;return h=h>=10?10:h>=5?5:h>=3?3:h>=2?2:1,s*h}},{key:"addScales",value:function(a,s){var h=this.controlOption,m=h.metric,y=h.imperial;m&&(this.mScale=ma("div",a,s)),y&&(this.iScale=ma("div",a,s))}}]),r}(Bv);function M2(e){var i=P2();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function P2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var k5=function(e){(0,pn.Z)(r,e);var i=M2(r);function r(n){var a;return(0,lt.Z)(this,r),a=i.call(this,n),(0,I.Z)((0,xe.Z)(a),"disabled",void 0),(0,I.Z)((0,xe.Z)(a),"zoomInButton",void 0),(0,I.Z)((0,xe.Z)(a),"zoomOutButton",void 0),he(["updateDisabled","zoomIn","zoomOut"],(0,xe.Z)(a)),a}return(0,It.Z)(r,[{key:"getDefault",value:function(){return{position:Uh.TOPLEFT,zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out",name:"zoom"}}},{key:"onAdd",value:function(){var a="l7-control-zoom",s=ma("div",a+" l7-bar");return this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,a+"-in",s,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,a+"-out",s,this.zoomOut),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),this.updateDisabled(),s}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"zoomIn",value:function(){!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}},{key:"zoomOut",value:function(){!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}},{key:"createButton",value:function(a,s,h,m,y){var b=ma("a",h,m);return b.innerHTML=a,b.title=s,b.href="javascript:void(0)",b.addEventListener("click",y),b}},{key:"updateDisabled",value:function(){var a=this.mapsService,s="l7-disabled";cu(this.zoomInButton,s),cu(this.zoomOutButton,s),(this.disabled||a.getZoom()<=a.getMinZoom())&&Us(this.zoomOutButton,s),(this.disabled||a.getZoom()>=a.getMaxZoom())&&Us(this.zoomInButton,s)}}]),r}(Bv);function Sg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Cg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Sg(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Sg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function I2(e){var i=O2();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function O2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ag=function(e){(0,pn.Z)(r,e);var i=I2(r);function r(n){var a;return(0,lt.Z)(this,r),a=i.call(this),(0,I.Z)((0,xe.Z)(a),"markerOption",void 0),(0,I.Z)((0,xe.Z)(a),"defaultMarker",void 0),(0,I.Z)((0,xe.Z)(a),"popup",void 0),(0,I.Z)((0,xe.Z)(a),"mapsService",void 0),(0,I.Z)((0,xe.Z)(a),"sceneSerive",void 0),(0,I.Z)((0,xe.Z)(a),"lngLat",void 0),(0,I.Z)((0,xe.Z)(a),"scene",void 0),(0,I.Z)((0,xe.Z)(a),"added",!1),(0,I.Z)((0,xe.Z)(a),"eventHandle",function(s){a.emit(s.type,{target:s,data:a.markerOption.extData,lngLat:a.lngLat})}),a.markerOption=Cg(Cg({},a.getDefault()),n),he(["update","onMove","onUp","addDragHandler","onMapClick"],(0,xe.Z)(a)),a.init(),a}return(0,It.Z)(r,[{key:"getDefault",value:function(){return{element:void 0,anchor:xt.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(a){this.scene=a,this.mapsService=a.get($t.IMapService),this.sceneSerive=a.get($t.ISceneService);var s=this.markerOption,h=s.element,m=s.draggable;return this.mapsService.getMarkerContainer().appendChild(h),this.registerMarkerEvent(h),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var a=this.markerOption.element;return a&&po(a),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(a){return this.lngLat=a,Array.isArray(a)&&(this.lngLat={lng:a[0],lat:a[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(a){var s=this;if(!this.added)return this.once("added",function(){s.setElement(a)}),this;var h=this.markerOption.element;return h&&po(h),this.markerOption.element=a,this.init(),this.mapsService.getMarkerContainer().appendChild(a),this.registerMarkerEvent(a),this.update(),this}},{key:"openPopup",value:function(){var a=this;if(!this.added)return this.once("added",function(){a.openPopup()}),this;var s=this.popup;return s?(s.isOpen()||s.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var a=this;this.added||this.once("added",function(){a.closePopup()});var s=this.popup;return s&&s.remove(),this}},{key:"setPopup",value:function(a){return this.popup=a,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var a=this.popup;if(a)a.isOpen()?a.remove():a.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(a){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(a){this.markerOption.extData=a}},{key:"update",value:function(){if(!!this.mapsService){var a=this.markerOption,s=a.element,h=a.anchor;this.updatePosition(),Ql(s,"".concat(Wt[h]))}}},{key:"onMapClick",value:function(a){var s=this.markerOption.element;this.popup&&s&&this.togglePopup()}},{key:"updatePosition",value:function(){if(!!this.mapsService){var a=this.markerOption,s=a.element,h=a.offsets,m=this.lngLat,y=m.lng,b=m.lat,A=this.mapsService.getBounds(),P=this.mapsService.lngLatToContainer([y,b]);if(s){s.style.display="block",s.style.whiteSpace="nowrap";var k=this.mapsService.getContainer(),F=0,q=0;if(k&&(F=k.scrollWidth,q=k.scrollHeight),Math.abs(A[0][0])>180||Math.abs(A[1][0])>180){if(P.x>F){var oe=this.mapsService.lngLatToContainer([y-360,b]);P.x=oe.x}if(P.x<0){var ue=this.mapsService.lngLatToContainer([y+360,b]);P.x=ue.x}}(P.x>F||P.x<0||P.y>q||P.y<0)&&(s.style.display="none"),s.style.left=P.x+h[0]+"px",s.style.top=P.y-h[1]+"px"}}}},{key:"init",value:function(){var a=this,s=this.markerOption.element,h=this.markerOption,m=h.color,y=h.anchor;if(!s){this.defaultMarker=!0,s=ma("div"),this.markerOption.element=s;var b=document.createElementNS("http://www.w3.org/2000/svg","svg");b.setAttributeNS(null,"display","block"),b.setAttributeNS(null,"height","48px"),b.setAttributeNS(null,"width","48px"),b.setAttributeNS(null,"viewBox","0 0 1024 1024");var A=document.createElementNS("http://www.w3.org/2000/svg","path");A.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),A.setAttributeNS(null,"fill",m),b.appendChild(A),s.appendChild(b)}Us(s,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(P){var k,F,q=((k=a.markerOption)===null||k===void 0?void 0:k.style)&&((F=a.markerOption)===null||F===void 0?void 0:F.style[P]);s&&(s.style[P]=q)}),s.addEventListener("click",function(P){a.onMapClick(P)}),s.addEventListener("click",this.eventHandle),Vt(s,y,"marker")}},{key:"registerMarkerEvent",value:function(a){a.addEventListener("mousemove",this.eventHandle),a.addEventListener("click",this.eventHandle),a.addEventListener("mousedown",this.eventHandle),a.addEventListener("mouseup",this.eventHandle),a.addEventListener("dblclick",this.eventHandle),a.addEventListener("contextmenu",this.eventHandle),a.addEventListener("mouseover",this.eventHandle),a.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var a=this.getElement();a.removeEventListener("mousemove",this.eventHandle),a.removeEventListener("click",this.eventHandle),a.removeEventListener("mousedown",this.eventHandle),a.removeEventListener("mouseup",this.eventHandle),a.removeEventListener("dblclick",this.eventHandle),a.removeEventListener("contextmenu",this.eventHandle),a.removeEventListener("mouseover",this.eventHandle),a.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(a){throw new Error("Method not implemented.")}},{key:"onUp",value:function(a){throw new Error("Method not implemented.")}}]),r}(Cs.EventEmitter);function wg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Tg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?wg(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):wg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function R2(e){var i=L2();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function L2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var D5=function(e){(0,pn.Z)(r,e);var i=R2(r);function r(n){var a,s;return(0,lt.Z)(this,r),s=i.call(this),(0,I.Z)((0,xe.Z)(s),"markers",[]),(0,I.Z)((0,xe.Z)(s),"markerLayerOption",void 0),(0,I.Z)((0,xe.Z)(s),"clusterIndex",void 0),(0,I.Z)((0,xe.Z)(s),"points",[]),(0,I.Z)((0,xe.Z)(s),"clusterMarkers",[]),(0,I.Z)((0,xe.Z)(s),"mapsService",void 0),(0,I.Z)((0,xe.Z)(s),"scene",void 0),(0,I.Z)((0,xe.Z)(s),"zoom",void 0),(0,I.Z)((0,xe.Z)(s),"bbox",void 0),s.markerLayerOption=Nr()(s.getDefault(),n),he(["update"],(0,xe.Z)(s)),s.zoom=((a=s.markerLayerOption.clusterOption)===null||a===void 0?void 0:a.zoom)||-99,s}return(0,It.Z)(r,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(a){return this.scene=a,this.mapsService=a.get($t.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.addMarkers(),this}},{key:"addMarker",value:function(a){var s=this.markerLayerOption.cluster;s&&this.addPoint(a,this.markers.length),this.markers.push(a)}},{key:"removeMarker",value:function(a){this.markers.indexOf(a);var s=this.markers.indexOf(a);s>-1&&this.markers.splice(s,1)}},{key:"hide",value:function(){this.markers.map(function(a){a.getElement().style.opacity="0"}),this.clusterMarkers.map(function(a){a.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(a){a.getElement().style.opacity="1"}),this.clusterMarkers.map(function(a){a.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var a=this.markerLayerOption.cluster;return a?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var a=this;this.getMarkers().forEach(function(s){s.addTo(a.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(a){a.remove()}),this.clusterMarkers.forEach(function(a){a.remove()}),this.mapsService.off("camerachange",this.update),this.markers=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"addPoint",value:function(a,s){var h=a.getLnglat(),m=h.lng,y=h.lat,b={geometry:{type:"Point",coordinates:[m,y]},properties:Tg(Tg({},a.getExtData()),{},{marker_id:s})};this.points.push(b)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var a=this.markerLayerOption.clusterOption,s=a.radius,h=a.minZoom,m=h===void 0?0:h,y=a.maxZoom;this.clusterIndex=new(Kh())({radius:s,minZoom:m,maxZoom:y}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(a,s){var h=this,m=a[0].concat(a[1]),y=this.clusterIndex.getClusters(m,s);this.clusterMarkers.forEach(function(b){b.remove()}),this.clusterMarkers=[],y.forEach(function(b){var A,P=h.markerLayerOption.clusterOption,k=P.field,F=P.method;if(b.properties&&(A=b.properties)!==null&&A!==void 0&&A.cluster_id){var q,oe=h.getLeaves((q=b.properties)===null||q===void 0?void 0:q.cluster_id);if(b.properties.clusterData=oe,k&&F){var ue=oe==null?void 0:oe.map(function(Nt){var Ht=(0,I.Z)({},k,Nt.properties[k]);return Ht}),Pe=Nn(ue,k),et=Bi(F,Pe),at="point_"+F;b.properties[at]=et.toFixed(2)}}var _t=h.clusterMarker(b);h.clusterMarkers.push(_t),_t.addTo(h.scene)})}},{key:"getLeaves",value:function(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return a?this.clusterIndex.getLeaves(a,s,h):null}},{key:"clusterMarker",value:function(a){var s=this.markerLayerOption.clusterOption,h=s,m=h.element,y=m===void 0?this.generateElement.bind(this):m,b=new Ag({element:y(a)}).setLnglat({lng:a.geometry.coordinates[0],lat:a.geometry.coordinates[1]});return b}},{key:"normalMarker",value:function(a){var s=a.properties.marker_id;return this.markers[s]}},{key:"update",value:function(){var a=this.mapsService.getZoom(),s=this.mapsService.getBounds();(!this.bbox||Math.abs(a-this.zoom)>=1||!c(this.bbox,s))&&(this.bbox=f(s,.5),this.zoom=Math.floor(a),this.getClusterMarker(this.bbox,this.zoom))}},{key:"generateElement",value:function(a){var s=ma("div","l7-marker-cluster"),h=ma("div","",s),m=ma("span","",h),y=this.markerLayerOption.clusterOption,b=y.field,A=y.method;a.properties.point_count=a.properties.point_count||1;var P=b&&A?a.properties["point_"+A]||a.properties[b]:a.properties.point_count;return m.textContent=P,s}}]),r}(Cs.EventEmitter);function Mg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Pg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Mg(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Mg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function k2(e){var i=D2();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function D2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ig=function(e){(0,pn.Z)(r,e);var i=k2(r);function r(n){var a;return(0,lt.Z)(this,r),a=i.call(this),(0,I.Z)((0,xe.Z)(a),"popupOption",void 0),(0,I.Z)((0,xe.Z)(a),"mapsService",void 0),(0,I.Z)((0,xe.Z)(a),"sceneSerive",void 0),(0,I.Z)((0,xe.Z)(a),"lngLat",void 0),(0,I.Z)((0,xe.Z)(a),"content",void 0),(0,I.Z)((0,xe.Z)(a),"closeButton",void 0),(0,I.Z)((0,xe.Z)(a),"timeoutInstance",void 0),(0,I.Z)((0,xe.Z)(a),"container",void 0),(0,I.Z)((0,xe.Z)(a),"tip",void 0),(0,I.Z)((0,xe.Z)(a),"scene",void 0),a.popupOption=Pg(Pg({},a.getdefault()),n),he(["update","onClickClose","remove"],(0,xe.Z)(a)),a}return(0,It.Z)(r,[{key:"addTo",value:function(a){var s=this;return this.mapsService=a.get($t.IMapService),this.sceneSerive=a.get($t.ISceneService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=a,this.update(),this.popupOption.closeOnClick&&(this.timeoutInstance=setTimeout(function(){s.mapsService.on("click",s.onClickClose)},30)),this.emit("open"),this}},{key:"close",value:function(){this.remove()}},{key:"open",value:function(){this.addTo(this.scene)}},{key:"setHTML",value:function(a){var s=window.document.createDocumentFragment(),h=window.document.createElement("body"),m;for(h.innerHTML=a;m=h.firstChild,!!m;)s.appendChild(m);return this.setDOMContent(s)}},{key:"setLnglat",value:function(a){return this.lngLat=a,Array.isArray(a)&&(this.lngLat={lng:a[0],lat:a[1]}),this.mapsService&&(this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setText",value:function(a){return this.setDOMContent(window.document.createTextNode(a))}},{key:"setMaxWidth",value:function(a){return this.popupOption.maxWidth=a,this.update(),this}},{key:"setDOMContent",value:function(a){return this.createContent(),this.content.appendChild(a),this.update(),this}},{key:"remove",value:function(){return this.content&&this.removeDom(this.content),this.container&&(this.removeDom(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("click",this.onClickClose),delete this.mapsService),clearTimeout(this.timeoutInstance),this.emit("close"),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"createContent",value:function(){this.content&&po(this.content),this.content=ma("div","l7-popup-content",this.container),this.popupOption.closeButton&&(this.closeButton=ma("button","l7-popup-close-button",this.content),this.popupOption.closeButtonOffsets&&(this.closeButton.style.right=this.popupOption.closeButtonOffsets[0]+"px",this.closeButton.style.top=this.popupOption.closeButtonOffsets[1]+"px"),this.closeButton.setAttribute("aria-label","Close popup"),this.closeButton.innerHTML="&#215;",this.closeButton.addEventListener("click",this.onClickClose))}},{key:"creatDom",value:function(a,s,h){var m=window.document.createElement(a);return s!==void 0&&(m.className=s),h&&h.appendChild(m),m}},{key:"removeDom",value:function(a){a.parentNode&&a.parentNode.removeChild(a)}},{key:"getdefault",value:function(){return{closeButton:!0,closeOnClick:!0,maxWidth:"240px",offsets:[0,0],anchor:xt.BOTTOM,className:"",stopPropagation:!0}}},{key:"onClickClose",value:function(a){a.stopPropagation&&a.stopPropagation(),this.remove()}},{key:"update",value:function(){var a=this,s=this.lngLat,h=this.popupOption,m=h.className,y=h.maxWidth,b=h.anchor;if(!(!this.mapsService||!s||!this.content)){var A=this.mapsService.getMarkerContainer();if(!this.container&&A){this.container=this.creatDom("div","l7-popup",A),this.tip=this.creatDom("div","l7-popup-tip",this.container),this.container.appendChild(this.content),m&&m.split(" ").forEach(function(k){return a.container.classList.add(k)});var P=this.popupOption.stopPropagation;P&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(k){a.container.addEventListener(k,function(F){F.stopPropagation()})}),this.container.style.whiteSpace="nowrap"}y&&this.container.style.maxWidth!==y&&(this.container.style.maxWidth=y),this.updatePosition(),Ql(this.container,"".concat(Wt[b])),Vt(this.container,b,"popup")}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var a=this.lngLat,s=a.lng,h=a.lat,m=this.popupOption.offsets,y=this.mapsService.lngLatToContainer([s,h]);this.container.style.left=y.x+m[0]+"px",this.container.style.top=y.y-m[1]+"px"}}}]),r}(Cs.EventEmitter);function F2(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var a=i.head||i.getElementsByTagName("head")[0];if(!a){a=i.createElement("head");var s=i.body||i.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):i.documentElement.appendChild(a)}var h=i.createElement("style");return h.type="text/css",h.styleSheet?h.styleSheet.cssText=e:h.appendChild(i.createTextNode(e)),a.appendChild(h),h}}F2(`.l7-marker-container {
  width: 100%;
  height: 100%;
  overflow: hidden;
  position: absolute;
}

.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}

.l7-marker-cluster {
  background-clip: padding-box;
  border-radius: 20px;
  background-color: rgba(181, 226, 140, 0.6);
  width: 40px;
  height: 40px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-left: 5px;
  margin-top: 5px;
  text-align: center;
  border-radius: 15px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  background-color: rgba(110, 204, 57, 0.6);
}
.l7-marker-cluster span {
  line-height: 30px;
}

.l7-popup-anchor-bottom,
.l7-popup-anchor-bottom-left,
.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 5px;
}
.l7-popup-anchor-top,
.l7-popup-anchor-top-left,
.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}

.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
  z-index: 5;
}
.l7-popup-tip {
  width: 0;
  height: 0;
  border: 10px solid transparent;
  z-index: 1;
}
.l7-popup-anchor-top .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-left: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-bottom: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-bottom: none;
  border-left: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-bottom: none;
  border-right: none;
  border-top-color: #fff;
}

.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-left: none;
  border-right-color: #fff;
}

.l7-popup-anchor-right .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  padding: 0;
  font-size: 25px;
  line-height: 20px;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}

.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}

.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}

.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}

.l7-popup-track-pointer {
  display: none;
}

.l7-popup-track-pointer * {
  pointer-events: none;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}

.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}

.l7-map:active .l7-popup-track-pointer {
  display: none;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* general toolbar styles */

.l7-bar {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
  border-radius: 4px;
}
.l7-bar a,
.l7-bar a:hover {
  background-color: #fff;
  width: 30px;
  height: 30px;
  font-size: 20px;
  display: block;
  text-align: center;
  text-decoration: none;
  color: #8e9dab;
}
.l7-bar a,
.l7-control-layers-toggle {
  background-position: 50% 50%;
  background-repeat: no-repeat;
  display: block;
}
.l7-bar a:hover {
  background-color: #f4f4f4;
}
.l7-bar a:first-child {
  border-top-left-radius: 2px;
  border-top-right-radius: 2px;
}
.l7-bar a:last-child {
  border-bottom-left-radius: 2px;
  border-bottom-right-radius: 2px;
  border-bottom: none;
}
.l7-bar a.l7-disabled {
  cursor: default;
  background-color: #f4f4f4;
  color: #bbb;
}

/* control positioning */

.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-hide {
  display: none;
}
.l7-control {
  position: relative;
  z-index: 800;
  pointer-events: visiblePainted; /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control {
  float: left;
  clear: both;
}
.l7-top,
.l7-bottom {
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-top {
  top: 0;
}
.l7-right {
  right: 0;
}
.l7-bottom {
  bottom: 0;
}
.l7-left {
  left: 0;
}
.l7-center {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-bottom.l7-center,
.l7-top.l7-center {
  width: 100%;
}
.l7-right.l7-center,
.l7-left.l7-center {
  height: 100%;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-top.l7-center,
.l7-left.l7-center {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}

.l7-bottom.l7-center,
.l7-right.l7-center {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}

.l7-center .l7-control {
  margin-right: 10px;
  margin-bottom: 10px;
}

.l7-control {
  float: left;
  clear: both;
}
.l7-right .l7-control {
  float: right;
}
.l7-top .l7-control {
  margin-top: 10px;
}
.l7-bottom .l7-control {
  margin-bottom: 10px;
}
.l7-left .l7-control {
  margin-left: 10px;
}
.l7-right .l7-control {
  margin-right: 10px;
}

/* attribution and scale controls */

.l7-control-container .l7-control-attribution {
  background: #fff;
  background: rgba(255, 255, 255, 0.7);
  margin: 0;
}
.l7-control-attribution,
.l7-control-scale-line {
  padding: 0 5px;
  color: #333;
}
.l7-control-attribution a {
  text-decoration: none;
}
.l7-control-attribution a:hover {
  text-decoration: underline;
}
.l7-container .l7-control-attribution,
.l7-container .l7-control-scale {
  font-size: 11px;
  padding: 5px 5px 2px 5px;
  background: rgba(255, 255, 255, 0.7);
}
.l7-left .l7-control-scale {
  margin-left: 5px;
}
.l7-bottom .l7-control-scale {
  margin-bottom: 5px;
}
.l7-control-scale-line {
  border: 2px solid #000;
  border-top: none;
  color: #000;
  line-height: 1.1;
  padding: 2px 5px 1px;
  font-size: 11px;
  white-space: nowrap;
  overflow: hidden;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;

  background: #fff;
}
.l7-control-scale-line:not(:first-child) {
  border-top: 2px solid #777;
  border-bottom: none;
  margin-top: -2px;
}
.l7-control-scale-line:not(:first-child):not(:last-child) {
  border-bottom: 2px solid #777;
}

.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  border: 2px solid rgba(0, 0, 0, 0.2);
  background-clip: padding-box;
}
/*logo */

.l7-ctrl-logo {
  background-size: 100% 100%;
  width: 89px;
  height: 16px;
  margin: 0 0 -3px -3px;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  background-repeat: no-repeat;
  cursor: pointer;
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALIAAAAgCAYAAAHBIxK2AAAABGdBTUEAALGPC/xhBQAAIJZJREFUeAHtfAl8Tkf3/9z7PNmDRFbZSawhQcRSaqva1xCqpataqrT2UkuUUiqlaKtafe1VS1pUiypB0dIgIkpKRPZIELI/2/zO98akN48nltL3838//84nNzNzzpkzc+eee+bMOXMfxijNaMJ7LOrGO/HdYfZ8fb12gD2JJINJdR8WNHVQnRtSn7hilpz0u2DMKaEcFhZmhdzLNbiPyNVlwPxcm4Qh93Fr0gO4Ol5hfqiz6Q14G+QzGpYzQ9nXrUl7X/fgbrXdG3skX7m26+bNW2fQqJ5XmCs6RQKd6EQwB0zgtKgsvCidGF+N8wV/SBLqSKnXzx2WKIHw1xNxq2xtrKsBXqgrbePt1rivJFmloa5OoD129NcVQwa9Phxwaflw3ifvHCus1YIVjW7fwEF66dIhdYO/XV7Qk+9HY/5F7RA+w0G5TdRxq7gw10FBPWwA+3r9jpkYGcoJ5/7YiFxMiYCjLspsekOeCiJ1AhJJNER+8rfTX/j4BNcUMNCLMmhF+wC3cE9RZmMd/0IQjeTtGdwJjURD5EajsRQN1EwEHjAkUVce2LLhnKf8xGId3ZhkX4uxmj7MMKqJz0ZmMr3MJNZBmphV8WDBOCCgo+2QiE7DF3005wvU75e8vMLs4+P3HwwN7do5MzOu2NcjpPHRX/csCqjt2wvtxEAy8xJ3o+7j3jjkcurpn2xtrT0EPiS0oQPKSOfi/ygqL9H/qNbls8EXuer4+65xUa149QnBvGYFgapAN21EZ+pnuH3rrrnKdNA/zCRmjoqGzu36RoL21q38BLAAjRgo6iir63g1QAOcOoU27DAgwKtpPzVMKU+qBWIuve3Jx0zw4j/eQ0CASeNnjUi5mrYH72ZxUfFV0emJ479/BvrM9KxDAgZZEjziTp1d8+pL415sEdJloIAhF7QCZmnQoCkuLkkXNPfkozU8b4wVb30P4i4ADNQ41P08mtSBogHc27Vx70CPEHeUgRNwgUOuTqBR8wwODraGSIkrKipKxqVuI300mntri1jz9OOs0IHeHUdvms2t0iG+vn5nxmnan5QeUff6GGWttpidSjvGbCSZJdAAGTMwtjWSH2G5XrOp3oEv9wuWxqdeUPchZkW8OGqcedmcdujgUcMOH/zltmgL2YW2Fu22fbMz6q2xM+IEvmvHiCGyRq7AK3QLe959+T6v46co0uVBisLk0/9SqIIhcnQiVBPqULJ4dPVd2ypLg6Dx8wxuhAGDHrCOHTtqUfZ2b6KsYYIOuUiXL1/dKW4SMJRxkbbpG9nv5ecVutlt+PSoNvw7VPg8V4X5wqf4YQVp9g+NDQZDITr2cm/8lNIGlbvp+edGD/946eqJqOKmoBJRhjyjrclk0qlZAqeumw8YOEwE6ILdgh0raN9pcHeWx9n3mViPh9IKnlmBVBWI4bfoePDAEcOGPz9WWUDBzMe1cUdft5CnUfb2DvFR8rsz2avrkOdmT18wJisz5zDaqthVWjwAtzRgtBF9VbSdVofXIPWmB2CCouYqUBUFH59QbwwEqg0XykAi96/VuCEetRrm59msEfA+nqEtAUeqNEt324JGJEsDxpMi26gnaCpUxqJk6bahkGFp3akrZO8IBurcVGponpGW+VOdQP++uIAznzE1/cBBvRRZTc+OP0miUBJ78OiyxNxE6uX+KSP3vDIZuEE/z9BgWZZtHHj1oxZbkS6uJFNqIn+SWSy1AubjFtLd171xoHrQooyFQJRB7+0eHBrk2cxNtBW5mgYwoYNFXg5r7CvoFXWxajQ3mjiTc84wVkB2kTWt5NYk3lZ02SCvzphDDVrNZOY2p3mdA0wrhQoGSm5ig6SRyTsqwSxUaMKk+t4tXJIy4/IsoP82yNu7pYusKwk2WdslZmScvGHOyNs1tJ5GNrjVaeT2W2xsLCnuv5J6woQq/QtbXoLCMJqYtbWj208pKbGK4aamgWJR19XlCvpFEdxn6SDOl0byAjXB/cp8rlM/PteZ83k1T92PTuAw0Ly8GychmosWLB/v7xFSW+AeJQ/0auyLiYFEBgQ0dYKdDRsJfFOvpe0V76fgCVrgkNQTao63hAONr2vjFtAFltoTTFLzB415Al7RFdNipHRviWlLbzCHhZ05HxfEy9e7T/zX8FV+XLk+96e8Tl0xOJZfOpjdKp4kzboZXgGrouDj1rTunHnTQl1caoZ/unLNlKnTx32sNxobR0ZGakQTDCY8tEtEkG+LfihDg+NC2ccjpBXoyMTqVaLjTaFLduxe219XqH+67HYGKU5D0pbN30X5+vl0a9m6mZOPTxvFUIayPRAbM1RpS1uztp0a/SD6e9hcYlKVqgi7QEg/DAyRsAUsKSlNLyvT56Bs8e2Ias4LZzfnfEowJyOOVocZDs9jt8YnMDvUZzblZ+jis1rwtqg/KMHgwEThCUOCUS64U/An6iiL9oIGcFjwqMOQQB0JdTyEXd/tfR/1rMzsWCrPBxwPCxJMfJMELVYq0KO+fNkXk6CHRV/qXPSLXA0XZejpqiRZ0IgcY7hzu+AS2TB3quInaNnU2vzSlNqcT/fhHSqAVJgawAunEXxCPU4W9MMlcRN0ryZMAl2XcOHm6YlnYgMAToIOuxks+YBBErGrAa0YtKDDDkeYAaBFErjSUl2uKOfm5v1GE9y1nOLe/4IO+b3YchfKw0wy3lZ6m2arxyr4KV4RURH54qtS/fGufEMZZ7Hja/Ko0ptsgYML0+kKGM+4wbTbmGQUtPfLMfBrWWc3gIZenX4aJmUp9OQdqunk4nv2QmzMus0rO730wtj0qu2DqnuQjCYbrOjYrINq5JuRe/CKQp3QtRMweivm0yur+FBQf9xk6WFQX99Tvw2GDO0390jssWXW1vKf6n4q7Dc1EOXledJwQxF7RV/EomQbptMXssJlNyT5YSe4dq1m/s907eik1WprNKjdur9sW/1AWt7535Ur6/zvN2/lpcds/37eM892mEgTXGHuHD1y4qLRYK0YvrJsMly5knKu0tg0csmObbvfC2/ZbETK9bOnW4TU7xtGEw0a2geZbKysz/Xu9txQvV6fX6VOrMTw/hVsdF8b/tbGgX1feqF1m7Bq5hda+/o+pVgXm9Ztmzk0ctTBlMyEi/fnaoZ9g3HH1xmv5GgwI/m3+oAZUOzkj4fx7rQBt7qdxnhJDiuj/YlBe9dG1pLNbF9D8c2dem2xVMA3NQhjBk6WMyVaelmZVaL0+vmcB/Tz/zVa+8lIPlWW2SLMQh559ZSNCE2sbCq/FBuLyrrbLJVHsYZMr/sdfpiKJOv1pOxtyISp0tQRtHXqhNWQZffSy5d/LBOwJ5H71mrcAnzSSA2Z84ObJPlCbiujSZubkRefZI5X61hL5pavbzMvY4kuTCuzm6nXE4+Ztwf/lBRmcW1zcSkwxsXF6bWmEnbQSPJsoqWMZumwUqYC7QCVi3Y6tMmnCZdYDItiJezj0v3MaLJmRmXX58w0zKJ3w3ww2IwE+fk7JSUll9b2Crl4NfPcJXOav1OH7fyfdSs6cS7zl18Y65GRd36Pmk/S+dwex0/tHTN54pxNJ0/I2tTsM5WccqDFQgn9rW4nyphg4J95ut9gZis7p6Ym3BI4L9eQ+sS/ntrbLXDIE8/fLKaHVP7goyN5whKyKKMHcsWboSasqsznORfSRYEaz3v29uZt4JiDxMC8QVJLjzntg+ow+dBe7BhRJ1MwQ/AVkRbwQbBj7OtTXgVu49qt79LDrW/OX4yrqjEJ/OIPVrwlfM2CB/rW6XQ3wd9SgjsM41SsC9pLt+H0AptK2fdRjFdYHHwdhY0QOsL1VZDimkIHfLLD8xThcmCF+p3SjOxc0WlV+Zervm2x68dN/QQ+MLC2DVSHqOOVw6ZFXDRgCXjUBQ1y7Py+3bO+HyQLO0bArGV2auRrkxRv1orPPgjXF6XVARxJz0vCPvz4vbkoT50899yTenvAD0ljLx0L8Gr2Et4C9XXnTkEiecNKv/xiU/q1nHNXlQmN2iYVlpWwL0qLmSR3ZNFgQCpCogXuLDMa45WrTH8AcCVpTL8Q7ChbVDhAgO6XmwwGj7AWoa9lZ+UcBt3ufZvn6Ar0bUSbP/+42cJQ7NhbNjj3ybpW2p0G3LtP966DUIYk0TbZDr4Kk9Ho7lXLw1+0g6qo6Wtz8+f9sfmARQzqPZNWiCCBJ/NLtrOz9SkoKPxDlmT1SiJIHiuH6oAeF5e1o9XRGjWqa6pXrxbcqlm3YY7Wtifu6WDeU1xHF59an1cDki9wm8nnU7h3AV0fergDNrsln0+BtKUoP0yizYJr/57DhuJ1wnY5/mziepTVr6e3R0hrsbPLyck7BrxIZO/eAi2uuwE4I3Aok5rIAtzPPbjtxQuXtgCOOtQTwkqrPvlqMmBd2vcfDGeSpfGCXrS7H96SujCnBy+oj6LComSoEoGvUA0A6EvZ8DLaO9nYsUOoSzNy57Oi4mJyBu2SpuRcj2rGvZievUsRgleBf5gk6cpabd62egFoaYtr6NFl8DaUoz96LzTAq0kDlNWppLhE2UTg9Tuf8MdG2sw4DRjQU9H7e3b/FE2vomLoU3nJjm92rYSEwoXZuX3EJvDZsWtdz/+sjGlqMJqCXx/90jzALlz4syQl5awi7aj/EwnxPfC1srJy7ti232Sb6jZHRT+VJvm909I3pjKWayxjYdODeLkO1hnC2OLC/mhQWsJO6UvInCtjHQWDB+XKK2tvF3Dq5JkvVR4t/tzwiHk6namuefunwruvEq9ft86RW4Ef9sqQcK2WXRkzYtKBgtsFGYCNHjHpt3enzd+cnpvwo8pHbKQd2Wg9M3qDhjz9tqd+O7tao2XZqP+TKf8Ga3vyzP630EdGRpY+OTnutuiv0iQDqDOxVgaaSDLpjqMuResukoXHpwTw7jT5XnQlfHBBOgPcgxIiEqu+jG4NuoYN63a4mHzio0vJvy7Blhcwa2srWW0NAFZVgh0uaTSKj0LQYFERZVmy+WP1Z2uno25vZyd/tX5FO5T79x72faoF+xm4J5m4geLOPl7PHPvl1CeyLF1T875nkpdckq7qdOwIqY4aEz35i+XEXCYJ30MXs7dnSghSzaSqMunN2n36dZsBfG7uzYt3r0vpaVm/AHbkxJ4xJYWpD80PbapK6bmnL8+dvURRJXsPbXu5W49OU6n/ItA/zEapKr4PA8fC7OVVS1EXgwe8sq9Nh4aJ6nYWdyrFmayLvQsrIwleF8n4Jk9ntlCvo00gZ6ujE6UHBujQAZw2ZY52Cv8fvj/wwahXJu6VGFdu2sh4rdTs+M6+fl7dSAI+kTS0yfkbCWEndbhJIzPdjRu3TgcGBijqbcHc6Km21iz+b7C22KTEaGxFi1slHDyLsrGgKHr5kvYCsW3btkpeynskGYSrmaQnvTufLubhyL6WDGwK0zH9ypvSKMHoQXmuoaztz0diJoHu9VfePp6el3BYeOGstVYJ0Ys/VSR81OjhPmQqKAvbg3hqZNOd9PTsZNAt/3Rhi+5dW/cmy6SzaGfv7HS817NDlUUWsFWfrU9LzkxMFfjHyadMe3MZ7HPzCwJjMnK/8JbNI6rib1GSQfxpoTT7TRs+mYzLSJJoWkTYsKqYWIIbTNzWuaZTA0iWOT4l+2zKxx99fpXCUKxXv+5hn6/akP7n5eRztbw9O5rToi7cnx5+0rWIvi/uSU4/M2BgZJ/ZAwb2KiO9HynaXLp0rIAkTZeff/tc7MFju2Qm0T7r8RPcnJa43MjL1+PtocUif8SrE2ZkpWWX0Tmbex4q5q/KNFLLO8mcHSTXRc7nRsmzSkILCOzWsJkAypLjBXE4U+mdtmSCGclC+AEbC8US0Wh+u5Jz7jraIWREYfRGuJG064n7AAvxCHHIMxorpLcac4q9lHesYjLRb06qrgtZMoVpuecqzCi0tZRg2wq4pXEiKCDwlnIRMMD9WFvrjGqrwhK9RRj5kp+bwLgS37NI8C/wgTOgSPLyV7ibxoa9Rp7kV8nrVo1E3qSjJSr/CuNlBUxHTswSZmLFkhWTtLSGUqSEjO7yXEN1DZW1FBuQrQllxzK5FVuTc5HtnnOIwlRf1X6Waa1GM24KoNGQT69SkpiGFtIyYwwrMK1jb1+9/U9bApV6/7fyxGYAwewzZ1IdiosNBvF2PzHmD8FIWfcoKPIV7ZZ7Q8rImmJGPWPpR0jqdMxEAs5IgEkWCUm6mf6YRITIOXIFUC6heCvIyguhPIR5s1PE9TYrMixlWkM9ZqRwC2jLkywKSm4tPc005KKeOxe+qb+oKhE9fAUOvLLi0ubYH6AVNpoaLU++lnWezs8/OLbw8D09GUp8HkB7wHCEEwVHjBkOxqvX7x906kgOzMvn89qZWLm7SbSXmXwnqLHLMdVmWKAq5eolSY2wtDyp8aIcFNSqekl+Uftjhy5IbduGV0tKulrCdMEGrcRupeYm/iLoLOXkMpJqe4fUN+hZHRM3keQ9Wip3IGiSEIupmLjooXwByeoUA2daCrSw4nx2Kucye86qhJUq7MUKSznt+SqSHcq0KAqY1okZxqySrlcQUIEvJ7e+RDocW2JdmR3T8K0UT2lOwk1viKQnh2oUuaIqrFt120ct4ySGwaALHDPuVb8ZM9+OxjlFOh95oGXzrsvpxk2e/jb7ERB6VL6PQw9hS79427lUqzOOGBGZj5i64IcPYUp1paHDXxzs+UH07NUCvnrVumlzZ334h0ajuZqWc+68gKtz+Bq//CSmq4kbrRL/PDbPyalGKPDJySm7n27V+wtJywozshMPqduYl4Ugw/oHDm455A8ryDjEhp3CkV+/HxEYGKC0/XDRyreXLVmVbKeyE8HTPOE0DNmONhS3Gu0f4NPTHP+gOj7JGRwx4icYzRU7kUlfSzMW9+PJJMTLS03MztqahXs1YuuK8tmAqFgp70FM74eXxpeHTvhkR3eKY2wic6K5YmRoWBE51UdI825tuV/7h8Uh1qQzFAf26vusy8zZE1eKdt6+Xl1ooovbt+795fVUXRuC03rzzyecisZBYwoCsvETRgbcupFfunrl1mwSHtIW7EpqduKF5My4VBIG9w3rt7L+g3qtggsRI3t91IvzNq7d/sKVK1drk8bOtaSZ16zc3pw0sdV332/sLYSYzofd7tdj+H/Aw1O2/S0DhX8wlWvFv7eI0jpJqs1gs33brv09ej6TT7wqFKulIbt7utalw5RKxJwO4+yCEGMDFdjILbFCkNFw6k7py0XP8qu0Fm8nl4UTcW1nY81ORHXjPaL2SZcFcxq2xNbUXsSstB0oiCbA5TkWCCMvYQbda9KotCuVkCbTQGYyNCFb3ESh72wmayOlRbePV6L5m5UAOh+sK8wNh4tzxaeLF99lY6KjunGuri7h0BZf/GfZBfhQfDyaNEnPSUgw70o5bm8yuZrDUcdSTXftYL4EaiT5tobZJqXknsq+p52e+wB28vT+cfQyPYtyxOA+nw/oPXwPyiKl5ibE+Xs06UJb9x/OJB4OdXd3aUMmkPX2XWsnNAvu8EGZJDWhZfi62izyouPDRh2v9cabr/iGt2o6UvCa9c7CqfQFo0Gy0ZyJyyg/uiZw/0SuNocelX9qbvwv8F5+suxzv6VLPo211J6EvRZWnCXL5jUb+sKAoaDBh5SYKzyT1JxzRzAvlQQZRNN+kn6Oepq3JXn8gar+JKZBRPQbffnSJ+qEpAgdCTjnt/UbGCt7jkq+lbZwVmQqGPlcaVJWhRBHPcXd6ciG29xDbOecNtIGCm3VkKJLnqiy0JfcbIvxxx7fOc7Gxkpx6G3ZEDNn1rsLEy5cOb6GIkIuPXt3eef5FwaO3LxpByNteTM9Pb7yGO7az7+fPTBR+Km2bIyZPWPa/Pi1m1b0b0FONnt7Oz/0g0Su6oLLSVd+GP/G9G9154uLtZL2lsnGPo6XFjyDB0wx33JCC/8NBoavKQKBogB8noskH89jxs5dOw78MC7h5/VkUjiSQD+1fvPKDi8+/+ZhX0/lawzl5bv70jZ1dHTQTJ0xfr5gv+/HQ4vXr/smC/GC9Ixz6QL+T+aPo5ExrvT0E/BwX7I0RoR9TSajFebgmWc7TgINjk6OG/POKVnLctKzE06SECtNK2+67nKLOipdIEEOp7jI73QKg+lKWE3aDB56N5wPuUvCpInpCazEEM7yS86wQloh7tBVXFLEbpa8REL8fjkdl2Y158NItDOp/XnZimXM/ZW3lJY+WSH2dwttRt5o+6+3r+6C4A/6Tkq6EjNp4uz44pIS05wZi94V4164ZNYSN1cXKyz54hyowFnK+0X0GJGccXpneKuwQRcvJB3YvXPfAgSX6CPVeBK2avUb1huy79COLecuHp1Dx5fgU+wCId70zapnhNdZaGPwb9mq2SgBRx45uK87p1Xgjh3NjrV0FmHm92YtnirGggfYp09XV5PRFIBNIeDGohstke/9edtrCNmifC0l/YdXXxz3Cxy76dfPVz4DC4L/sYQvkhFh+HT1h62EEP+45+dFEGJ8xp6enXhSfUsWBRkEM45KubIDe5qE+DsE9XSlNM2lbMv0YP4OxaJIzsm+ePd6DivMb8vu6GKYviyJFRq7Se/d+hq4KMa104PZLBLgDXRiRkPhbU5h7s03PNgx4J9UCvBsGqDnBh/YoO07PDUefEtLyzK7tI9Yh80dQtTr1m7JPHL4+HLg6GxB9f2Hy0M1CNtg5wx4VUnWaO1bNn12YJBfizf69hr+5Zujpqx5PnLUp43rtZvVtFHHCBFAdHFxDlu28v1w8JEljf6FIaN/FseJ8DGe4I9wvYAj37Z113XZVnsaZxUyM8+nkYJJw5Gjn386/JFos3Tl+3NQ1nMpDB/aGbmpxkfL329Wu46fcqiD7je7U9u+n0M72jr5nhDt/ldzH7fgIJOJ+0+aNjaw34AeihI6ezph7YiX3zpGk3sjI/fsWfN7q1KQQUibvNIF51kECfMysmuNlFPUjy2sHchWvhzAyXNM9aWshDTsQOmD0vrShwWKkI704vZFddkXRDuXhJgsELKYS9n7CxKkF1b8KNFr8WQS3Gw6g74JztRNeefNDwXXyeNnzSIBI88gl40GpkRyhg4aeeD69RvKQ8aSHbNrfS+Exvy8yn9OQ7Q1z2kCd+D8BDZnGdcTTqTmJCTjRKgky3nQntezc0+JNl7etRT7WqM1XcOuX9ZoKnlvBB1yrdb6CmhwqU2cjNzEs/A2vPj82Nj0tMz9oLWzt/Pfd3DbYNjntJmr06x5Ywf6ZEIRbuBHvz5lWplOp7jrnvRxZPD/byZ8IE0u3IZ16wbaTpw8Zgn6pjBiQq9uQ2Po6/SyjJwEiy/qfQW5/AYkvviyNIEEcgIFqstweou07GgXA4sZ6cxrlNP89X9MDe7sILM9JK4v60CrYyUlejZy0Z/SrL+oHr8EB7w4q7hr78ZZcLMJritXL16jXr5FGZsoQdOqTfNRM2ZNrGvU81pVfXUGWnoZlN2seqOl8PgH/dFWtm4noF07te33KX0GmIv+GjdpOIzs4SCUN2xZ9Q5lyrPbuuW7uT/tPXjLykq6bMmzAfr/pVQs3WmG8W785rMRlCkr//w50eWrKWPx9zyHuzenvZs/MItOl1a85cGvajjbpJNYdYpd97C3YkfH2fGeK0qkdDCg3x4JoI3fXknH6hMNRnFLx9igZTnSwQd28IgExw9fpO9PTVbQVOR6CkFzslvP0pI/+36scLwRp+9A88a4Vxbt2bV3WHz8hUb0uzm3yn9i4H6tVbgHmCQqykcuptBX2/6uYXFk37d4+413pn62Jvo/YPLm+Nfmt+/QZouzs5PiL066dHnrhHEz4xB8QLDnkTv6hxuQtyWAPESKXV9VV5JReyM193QWBNTXlT4Y4boaeGF9fL26og3cbF9vjsmRtdqcq9nxVX6R9NCCDKYf50jfv+3EO5gYHYbjzItATZg1OzVG5t3IFrWmjeGPpL9cCQ8HXYpGw3rQB38XUX2SCd8ilOmMrouXzAmBpgJvsnUNg/u/shBlnMC2dD7Wzy24HTaAzVuFxtSrFxhBk6fd+u1X8+rXaT2Jlcmt6ZzVHQMYPKEk0SecYEVnd/WCpZNzjZoKjII28FrgvK9tDftjly//dkfQIL+WF5dF9nDyrl37WLeYZ+b3j+g5kzaX9s2aN3kV+OLC4iud2vXfiMMqdYJdfk2NBfT/jfTc0P49unXrVKXQiVEWFhUXvT12xgHaK+jpxf3doNH7IUjWf0DPZwXNvh8OHkFZMsiKshRw8/yRBBmNl+VLZ0fb8ZayzH4krdyEnpQnudbiKRxMAbry9Y5gJwnfOzpfUpZF804fp46dOwlxvY5dnnZ64aVIRbOC39ovN8/GAW9ZsrpoSYhBU82dnczPkbpiI5iUcrK1ra2Nl2M1x7oHf/lueOd2/TeYmEnxAID2iSSDdQbZVp6ff7J214IPZ3YnnnLdunUiyNSJuMvfSC/fi8eOnepAp6EOnss5Rydc/kp0EDORfuXOZeyoqSeDmzSIQVtg8Q3K4IGvzkSZW9vd87sdgP+3Ejw05n3hFxroMgffU6f7KBs4uM8fy5euTjFKRkf6ks4FRJ61PJojL7hTePH99z5Kwsuael3R2gBbTPcMwiKVBeBkxh0KtGw7mQ/dhbeUynihvrU2sKEr2JPb1Km7h238a+ylp4zc6IRNXsdObV3JTswqKCw0kUeCNmLxiWp68zLOBpTeLm5LGydt377dXJycnazhewUd/K/YLZPmk8aOf80/LSW96Ntvf8jFRGodXA5iyRf88Es5xQZda0GbkZZVtGP77ntocaKXlRW3wQOv5ugot+vUyqluUGB18CGT5hZ+jwuOfRx0FbzVOcLQaz7Z0Q6eCsDRHzayiodCI58URwXVbR6l/Lghavw6hYGZsDr/rYSNLSKQcfS7AwiOSGWF4eJewRAmRVAD59MPOjPytwUZncAN5yyzhVacDSFlbDJIbO1qkzQXuP9Gql+/bTXj7WLbUq1t4V3H+kN3q5zWOnq5Jn05Jdm6GvMTExPJnC9PCDgYC2/X1Mp6o38j1xv3m0Q1LT5wu985DghlzGcxdqUaKzvSRpLJXtaFhdUpND8mLsZhKQcPuhSTxRL+UWFCkM3bPexZC/N2/9b/nYF/Z+AxZuD/AA8zEhkTLyOGAAAAAElFTkSuQmCC');
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 2px;
}
.l7-control-layers-toggle {
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAkCAYAAAGf7Ah0AAAABGdBTUEAALGPC/xhBQAABzdJREFUWAnVV3lslEUUn/l2F0tpwdAih1HEqCReDcphNCo1EkgFkXa5PNpuC0Fo2e7Wgko8KiaKWrvbK5672xYFpNtiRRuNiY0aURA14BGviBcVlaKltVa6+42/N9v5Mrtt05rwj/PHzjt+8743b+a9N8vYwKgMNlUQyemnMtAkaJajvb3dToQSGp8e6boopkr4VYgEMYwO0vhCTfMVzBcMf8bx086YyODcuM80zTqp9IWat+7evW8sMdIxIqqCLa6oiAaJpuEtcBqcc2HEWMZ0JclgZR/Nchf++ubrzKjJSguXS4tVjXvPjfb3/UAAacGTn/MOMb7QnjNpNqP/bKZ50Ai0tqYmCi0n4zbM+W+lBc7JBOa+QPhDwcTsxJXE2+32edKCL9h8hRDmRzpIOWydAylhrcMfDN+ugBRKSdP3KwPhsFJIPth02FISIYQwYsDYcVfWhy/Bon4JgumffMGmiGTwQ0B/sHml4q2ZFAD3WQIQVhx0IdFw8B189lolN+w8w5PnjPmlhJgtA8/vfn3iye7u3yGzDljDxZEG4097Cp3rSSjBtMHunp6vFR+HHoIxmbgTe1xHKssDHecLNFUjMzbqMs5ZlHF7ute17M84+TMHDzr+OvR9JwKdCms9yRkzJq6bPTsWXh05QOPUN+PUHyPWMPhm6UHd7vaUohWZPSRE8OqxpTyibQa/qcTlbEP0vwF7AWUAT3JM9dy69FfSNza+MU4awNE8iQtXSkJuGLleV852ov2h5jkwVof0mUs8aO4LhTuYYFOAjExId0wcFIPahpaLTkWiX9ECfHG/sLNi1i8+HODfgLFFRI96+INNi0cNTgTS1obKQh03aAuk9DeELzcj4pACYivvwvXrFK/PcQZiQWo+hmidpYMUjQC7EOB6xdNsGfAHwk/RDdOVw9Dm+NTUSWtWLDohDVQ37JkbiUT2DwMeVswZP+gtdM4x3HnLDhjcGM2XLWOISaenIGee9MCSgqgMht/H/q/SZYk0qviV3oKcj5XcioESyOoqIseFYDYloxnAGm/hcrcuk3JV2XBMl+pKqn6mENux11+w12m6jpqMMFn7rPPTHdwfCm8yTfG4tMaNu+GepPUFiqbM7T105ARSPQU+dY/LOC/N2gI65WEkyWUEtjmSppfkLvlRLaQ5VnZFDtGGzbheNRROKZmbu/AvUvh3tE4Wff2/0IUC+y2q+4VVoXBW1BSvkR7Rb8BW84lWJQBdlGozcs7GLy3Nd35OSqTxBqtfgkc1+sPjcqbDgEl6xK0dH5lv545LOCVL1/F+3CoY4eyY1+WcBiC2KYEHQBd5XDkyndE17xCm2Ug6BLcSwb3LigE1AlOYu6TS4HUwVEw0Df1osfBnLDwnpiFDCQPuvQ73Fkqxg8/hEVYLXt66MXbbzOK8bKre1hhkgDT0RDja3fEHytwZxCMLH0YWPkD0fxqjqUZDejDSV3z1LbexqPkEPJxKWLqtKOGbvPnZL460NlE/KgfkIZiRrfjShsQcG2QQDUwwXjcuZcID61Ys6ErUJ/LDOiCfLUzUjVQdEg0O4jn/ABEq0iuIjrEcwE0x/KGWNbjPj4BO00Gni0ZOoIPzLR5X9vMqqaQDqDzzENra4V5zp8sBZQcROYjsLvYUOPdbEVBKeiZ193QjCmwtZCM+ldS6EWYTH3wuNSV1i+pFCj/IAaWgGUfBq0N78qPM3DZcp9TxcTQeyzZm3ON2LatXpSlOP8BIB6qDLddHmHnFrBlpNZmZmdZbNXEB9XsRlZXFennqGHzoXW5DaId4iSoc/Q365EjnRjszPnYXZL9NDWUtGsqzCjAw7xprTypbn7fkaILcYqkInzzeX06C8emO8sKlS7stZQLxVMPes/+O9FVAvEpXob+utY6gZmfrtMjf/RUI+2odhF7wJbq+Gzf3zTj5CAwyaoEwozVoCzN1KKK00z7WUbZx9dIOklsO6CAZpu87i5gpHoJ8gtLh9vZixSO2KckV7qysf5Sc5uq2tjOix3rL0FW3IJuSNV0XM/iDs85LqxvqeKUD8n3LxUobt5WVuLJlS9IM4O9i09VRwWtxLWfpcix+hXjs8mZdjn19YuOiuKRgufzXqOuqQi2r8O+yAk/tl2Q/RMW7ETe8UdX1GJhHDM5qjDHJ5e7bs07qBp7ZsTe9t6/vUXykkLKEdLFbLgLJSUn3rrt1yXEdX/1C23jzVG+5Keg/B5r2wJD9g/NcaUAJq4MvXxxl/TWoATcoGc0Av4eUKnIXZlsvXpLHO0CS2KgOtGQgdeuwqWuUjGbUgrdszLHRXXDLF0oe54AS0kyPnc5Iz/2CmV7EeIzSwcjvsHQPXkUhld/kCP6Xu+DRNjg/SWHh+SnODF+aPeVh9XCydAPEsA4kAqsCzcuiTPiw7+maTj6SwGsVk/9gY9xbUpizR8MNS47aAd0C7s35CG8VdrxYyjl/FcdUgo73nY77X9D/Au9RDMh+aBoVAAAAAElFTkSuQmCC');
  width: 30px;
  height: 30px;
  background-size: 20px 20px;
}

.l7-touch .l7-control-layers-toggle {
  width: 44px;
  height: 44px;
}
.l7-control-layers .l7-control-layers-list,
.l7-control-layers-expanded .l7-control-layers-toggle {
  display: none;
}
.l7-control-layers-expanded .l7-control-layers-list {
  display: block;
  position: relative;
}
.l7-control-layers-expanded {
  padding: 6px 10px 6px 6px;
  color: #59626b;
  background: #fff;
}
.l7-control-layers-scrollbar {
  overflow-y: scroll;
  overflow-x: hidden;
  padding-right: 5px;
}
.l7-control-layers-selector {
  margin-top: 2px;
  position: relative;
  top: 1px;
}
.l7-control-layers label {
  display: block;
  padding: 8px;
}
.l7-control-layers label input[type='radio'],
.l7-control-layers label input[type='checkbox'] {
  width: 14px;
  height: 14px;
  margin: 0;
}
.l7-control-layers-separator {
  height: 0;
  border-top: 1px solid #d8d8d8;
  margin: 5px -10px 5px -6px;
}
.mapboxgl-ctrl-logo {
  display: none !important;
}
.amap-logo {
  display: none !important;
}
`);var B2=R(88307),N2=R.n(B2),z2=function(){function e(i,r){(0,lt.Z)(this,e),(0,I.Z)(this,"attribute",void 0),(0,I.Z)(this,"buffer",void 0);var n=r.buffer,a=r.offset,s=r.stride,h=r.normalized,m=r.size,y=r.divisor;this.buffer=n,this.attribute={buffer:n.get(),offset:a||0,stride:s||0,normalized:h||!1,divisor:y||0},m&&(this.attribute.size=m)}return(0,It.Z)(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(r){this.buffer.subData(r)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),ah,ev,oh,mc,tv,Zh,rv,Nv,Sf,Cp,wu,Cf,Af,zv,U2=(ah={},(0,I.Z)(ah,ee.POINTS,"points"),(0,I.Z)(ah,ee.LINES,"lines"),(0,I.Z)(ah,ee.LINE_LOOP,"line loop"),(0,I.Z)(ah,ee.LINE_STRIP,"line strip"),(0,I.Z)(ah,ee.TRIANGLES,"triangles"),(0,I.Z)(ah,ee.TRIANGLE_FAN,"triangle fan"),(0,I.Z)(ah,ee.TRIANGLE_STRIP,"triangle strip"),ah),Og=(ev={},(0,I.Z)(ev,ee.STATIC_DRAW,"static"),(0,I.Z)(ev,ee.DYNAMIC_DRAW,"dynamic"),(0,I.Z)(ev,ee.STREAM_DRAW,"stream"),ev),Rm=(oh={},(0,I.Z)(oh,ee.BYTE,"int8"),(0,I.Z)(oh,ee.UNSIGNED_INT,"int16"),(0,I.Z)(oh,ee.INT,"int32"),(0,I.Z)(oh,ee.UNSIGNED_BYTE,"uint8"),(0,I.Z)(oh,ee.UNSIGNED_SHORT,"uint16"),(0,I.Z)(oh,ee.UNSIGNED_INT,"uint32"),(0,I.Z)(oh,ee.FLOAT,"float"),oh),Z2=(mc={},(0,I.Z)(mc,ee.ALPHA,"alpha"),(0,I.Z)(mc,ee.LUMINANCE,"luminance"),(0,I.Z)(mc,ee.LUMINANCE_ALPHA,"luminance alpha"),(0,I.Z)(mc,ee.RGB,"rgb"),(0,I.Z)(mc,ee.RGBA,"rgba"),(0,I.Z)(mc,ee.RGBA4,"rgba4"),(0,I.Z)(mc,ee.RGB5_A1,"rgb5 a1"),(0,I.Z)(mc,ee.RGB565,"rgb565"),(0,I.Z)(mc,ee.DEPTH_COMPONENT,"depth"),(0,I.Z)(mc,ee.DEPTH_STENCIL,"depth stencil"),mc),j2=(tv={},(0,I.Z)(tv,ee.DONT_CARE,"dont care"),(0,I.Z)(tv,ee.NICEST,"nice"),(0,I.Z)(tv,ee.FASTEST,"fast"),tv),Rg=(Zh={},(0,I.Z)(Zh,ee.NEAREST,"nearest"),(0,I.Z)(Zh,ee.LINEAR,"linear"),(0,I.Z)(Zh,ee.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,I.Z)(Zh,ee.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,I.Z)(Zh,ee.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,I.Z)(Zh,ee.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),Zh),Lg=(rv={},(0,I.Z)(rv,ee.REPEAT,"repeat"),(0,I.Z)(rv,ee.CLAMP_TO_EDGE,"clamp"),(0,I.Z)(rv,ee.MIRRORED_REPEAT,"mirror"),rv),V2=(Nv={},(0,I.Z)(Nv,ee.NONE,"none"),(0,I.Z)(Nv,ee.BROWSER_DEFAULT_WEBGL,"browser"),Nv),G2=(Sf={},(0,I.Z)(Sf,ee.NEVER,"never"),(0,I.Z)(Sf,ee.ALWAYS,"always"),(0,I.Z)(Sf,ee.LESS,"less"),(0,I.Z)(Sf,ee.LEQUAL,"lequal"),(0,I.Z)(Sf,ee.GREATER,"greater"),(0,I.Z)(Sf,ee.GEQUAL,"gequal"),(0,I.Z)(Sf,ee.EQUAL,"equal"),(0,I.Z)(Sf,ee.NOTEQUAL,"notequal"),Sf),kg=(Cp={},(0,I.Z)(Cp,ee.FUNC_ADD,"add"),(0,I.Z)(Cp,ee.MIN_EXT,"min"),(0,I.Z)(Cp,ee.MAX_EXT,"max"),(0,I.Z)(Cp,ee.FUNC_SUBTRACT,"subtract"),(0,I.Z)(Cp,ee.FUNC_REVERSE_SUBTRACT,"reverse subtract"),Cp),Uv=(wu={},(0,I.Z)(wu,ee.ZERO,"zero"),(0,I.Z)(wu,ee.ONE,"one"),(0,I.Z)(wu,ee.SRC_COLOR,"src color"),(0,I.Z)(wu,ee.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,I.Z)(wu,ee.SRC_ALPHA,"src alpha"),(0,I.Z)(wu,ee.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,I.Z)(wu,ee.DST_COLOR,"dst color"),(0,I.Z)(wu,ee.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,I.Z)(wu,ee.DST_ALPHA,"dst alpha"),(0,I.Z)(wu,ee.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,I.Z)(wu,ee.CONSTANT_COLOR,"constant color"),(0,I.Z)(wu,ee.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,I.Z)(wu,ee.CONSTANT_ALPHA,"constant alpha"),(0,I.Z)(wu,ee.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,I.Z)(wu,ee.SRC_ALPHA_SATURATE,"src alpha saturate"),wu),H2=(Cf={},(0,I.Z)(Cf,ee.NEVER,"never"),(0,I.Z)(Cf,ee.ALWAYS,"always"),(0,I.Z)(Cf,ee.LESS,"less"),(0,I.Z)(Cf,ee.LEQUAL,"lequal"),(0,I.Z)(Cf,ee.GREATER,"greater"),(0,I.Z)(Cf,ee.GEQUAL,"gequal"),(0,I.Z)(Cf,ee.EQUAL,"equal"),(0,I.Z)(Cf,ee.NOTEQUAL,"notequal"),Cf),hd=(Af={},(0,I.Z)(Af,ee.ZERO,"zero"),(0,I.Z)(Af,ee.KEEP,"keep"),(0,I.Z)(Af,ee.REPLACE,"replace"),(0,I.Z)(Af,ee.INVERT,"invert"),(0,I.Z)(Af,ee.INCR,"increment"),(0,I.Z)(Af,ee.DECR,"decrement"),(0,I.Z)(Af,ee.INCR_WRAP,"increment wrap"),(0,I.Z)(Af,ee.DECR_WRAP,"decrement wrap"),Af),W2=(zv={},(0,I.Z)(zv,ee.FRONT,"front"),(0,I.Z)(zv,ee.BACK,"back"),zv),X2=function(){function e(i,r){(0,lt.Z)(this,e),(0,I.Z)(this,"buffer",void 0);var n=r.data,a=r.usage,s=r.type;this.buffer=i.buffer({data:n,usage:Og[a||ee.STATIC_DRAW],type:Rm[s||ee.UNSIGNED_BYTE]})}return(0,It.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(r){var n=r.data,a=r.offset;this.buffer.subdata(n,a)}}]),e}(),Y2=function(){function e(i,r){(0,lt.Z)(this,e),(0,I.Z)(this,"elements",void 0);var n=r.data,a=r.usage,s=r.type,h=r.count;this.elements=i.elements({data:n,usage:Og[a||ee.STATIC_DRAW],type:Rm[s||ee.UNSIGNED_BYTE],count:h})}return(0,It.Z)(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(r){var n=r.data;this.elements.subdata(n)}},{key:"destroy",value:function(){}}]),e}(),q2=function(){function e(i,r){(0,lt.Z)(this,e),(0,I.Z)(this,"framebuffer",void 0);var n=r.width,a=r.height,s=r.color,h=r.colors,m=r.depth,y=r.stencil,b={width:n,height:a};Array.isArray(h)&&(b.colors=h.map(function(A){return A.get()})),s&&typeof s!="boolean"&&(b.color=s.get()),this.framebuffer=i.framebuffer(b)}return(0,It.Z)(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(r){var n=r.width,a=r.height;this.framebuffer.resize(n,a)}}]),e}(),K2=R(36719),$2=R.n(K2),J2=R(68630),Q2=R.n(J2);function Dg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function wf(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Dg(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Dg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var eE=function(){function e(i,r){(0,lt.Z)(this,e),(0,I.Z)(this,"reGl",void 0),(0,I.Z)(this,"destroyed",!1),(0,I.Z)(this,"drawCommand",void 0),(0,I.Z)(this,"drawPickCommand",void 0),(0,I.Z)(this,"drawParams",void 0),(0,I.Z)(this,"options",void 0),(0,I.Z)(this,"uniforms",{}),this.reGl=i;var n=r.vs,a=r.fs,s=r.attributes,h=r.uniforms,m=r.primitive,y=r.count,b=r.elements,A=r.depth,P=r.blend,k=r.stencil,F=r.cull,q=r.instances,oe={};this.options=r,h&&(this.uniforms=this.extractUniforms(h),Object.keys(h).forEach(function(at){oe[at]=i.prop(at)}));var ue={};Object.keys(s).forEach(function(at){ue[at]=s[at].get()});var Pe={attributes:ue,frag:a,uniforms:oe,vert:n,blend:{},primitive:U2[m===void 0?ee.TRIANGLES:m]};q&&(Pe.instances=q),y&&(Pe.count=y),b&&(Pe.elements=b.get()),this.initDepthDrawParams({depth:A},Pe),this.initBlendDrawParams({blend:P},Pe),this.initStencilDrawParams({stencil:k},Pe),this.initCullDrawParams({cull:F},Pe),this.drawCommand=i(Pe);var et=bo()(Pe);et.blend=wf(wf({},et.blend),{},{enable:!1}),et.stencil=wf(wf({},et.stencil),{},{enable:!1}),this.drawPickCommand=i(et),this.drawParams=Pe}return(0,It.Z)(e,[{key:"addUniforms",value:function(r){this.uniforms=wf(wf({},this.uniforms),this.extractUniforms(r))}},{key:"draw",value:function(r,n){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var a=wf(wf({},this.uniforms),this.extractUniforms(r.uniforms||{})),s={};Object.keys(a).forEach(function(h){var m=(0,ch.Z)(a[h]);m==="boolean"||m==="number"||Array.isArray(a[h])||a[h].BYTES_PER_ELEMENT?s[h]=a[h]:s[h]=a[h].get()}),n?this.drawPickCommand(s):this.drawCommand(s)}}},{key:"destroy",value:function(){this.drawParams.elements.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(r){r.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(r,n){var a=r.depth;a&&(n.depth={enable:a.enable===void 0?!0:!!a.enable,mask:a.mask===void 0?!0:!!a.mask,func:G2[a.func||ee.LESS],range:a.range||[0,1]})}},{key:"initBlendDrawParams",value:function(r,n){var a=r.blend;if(a){var s=a.enable,h=a.func,m=a.equation,y=a.color,b=y===void 0?[0,0,0,0]:y;n.blend={enable:!!s,func:{srcRGB:Uv[h&&h.srcRGB||ee.SRC_ALPHA],srcAlpha:Uv[h&&h.srcAlpha||ee.SRC_ALPHA],dstRGB:Uv[h&&h.dstRGB||ee.ONE_MINUS_SRC_ALPHA],dstAlpha:Uv[h&&h.dstAlpha||ee.ONE_MINUS_SRC_ALPHA]},equation:{rgb:kg[m&&m.rgb||ee.FUNC_ADD],alpha:kg[m&&m.alpha||ee.FUNC_ADD]},color:b}}}},{key:"initStencilDrawParams",value:function(r,n){var a=r.stencil;if(a){var s=a.enable,h=a.mask,m=h===void 0?-1:h,y=a.func,b=y===void 0?{cmp:ee.ALWAYS,ref:0,mask:-1}:y,A=a.opFront,P=A===void 0?{fail:ee.KEEP,zfail:ee.KEEP,zpass:ee.KEEP}:A,k=a.opBack,F=k===void 0?{fail:ee.KEEP,zfail:ee.KEEP,zpass:ee.KEEP}:k;n.stencil={enable:!!s,mask:m,func:wf(wf({},b),{},{cmp:H2[b.cmp]}),opFront:{fail:hd[P.fail],zfail:hd[P.zfail],zpass:hd[P.zpass]},opBack:{fail:hd[F.fail],zfail:hd[F.zfail],zpass:hd[F.zpass]}}}}},{key:"initCullDrawParams",value:function(r,n){var a=r.cull;if(a){var s=a.enable,h=a.face,m=h===void 0?ee.BACK:h;n.cull={enable:!!s,face:W2[m]}}}},{key:"extractUniforms",value:function(r){var n=this,a={};return Object.keys(r).forEach(function(s){n.extractUniformsRecursively(s,r[s],a,"")}),a}},{key:"extractUniformsRecursively",value:function(r,n,a,s){var h=this;if(n===null||typeof n=="number"||typeof n=="boolean"||Array.isArray(n)&&typeof n[0]=="number"||$2()(n)||n===""||"resize"in n){a["".concat(s&&s+".").concat(r)]=n;return}Q2()(n)&&Object.keys(n).forEach(function(m){h.extractUniformsRecursively(m,n[m],a,"".concat(s&&s+".").concat(r))}),Array.isArray(n)&&n.forEach(function(m,y){Object.keys(m).forEach(function(b){h.extractUniformsRecursively(b,m[b],a,"".concat(s&&s+".").concat(r,"[").concat(y,"]"))})})}}]),e}(),tE=function(){function e(i,r){(0,lt.Z)(this,e),(0,I.Z)(this,"texture",void 0),(0,I.Z)(this,"width",void 0),(0,I.Z)(this,"height",void 0),(0,I.Z)(this,"isDistroy",!1);var n=r.data,a=r.type,s=a===void 0?ee.UNSIGNED_BYTE:a,h=r.width,m=r.height,y=r.flipY,b=y===void 0?!1:y,A=r.format,P=A===void 0?ee.RGBA:A,k=r.mipmap,F=k===void 0?!1:k,q=r.wrapS,oe=q===void 0?ee.CLAMP_TO_EDGE:q,ue=r.wrapT,Pe=ue===void 0?ee.CLAMP_TO_EDGE:ue,et=r.aniso,at=et===void 0?0:et,_t=r.alignment,Nt=_t===void 0?1:_t,Ht=r.premultiplyAlpha,nr=Ht===void 0?!1:Ht,mr=r.mag,Hr=mr===void 0?ee.NEAREST:mr,fn=r.min,Or=fn===void 0?ee.NEAREST:fn,Tn=r.colorSpace,zn=Tn===void 0?ee.BROWSER_DEFAULT_WEBGL:Tn,gi=r.x,io=gi===void 0?0:gi,rs=r.y,Tu=rs===void 0?0:rs,fl=r.copy,Zu=fl===void 0?!1:fl;this.width=h,this.height=m;var Cd={width:h,height:m,type:Rm[s],format:Z2[P],wrapS:Lg[oe],wrapT:Lg[Pe],mag:Rg[Hr],min:Rg[Or],alignment:Nt,flipY:b,colorSpace:V2[zn],premultiplyAlpha:nr,aniso:at,x:io,y:Tu,copy:Zu};n&&(Cd.data=n),typeof F=="number"?Cd.mipmap=j2[F]:typeof F=="boolean"&&(Cd.mipmap=F),this.texture=i.texture(Cd)}return(0,It.Z)(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(r)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(r){var n=r.width,a=r.height;this.texture.resize(n,a),this.width=n,this.height=a}},{key:"destroy",value:function(){this.isDistroy||this.texture.destroy(),this.isDistroy=!0}}]),e}(),Fg,Bg,rE=(Fg=(0,Lr.b2)(),Fg(Bg=function(){function e(){var i=this;(0,lt.Z)(this,e),(0,I.Z)(this,"extensionObject",void 0),(0,I.Z)(this,"gl",void 0),(0,I.Z)(this,"$container",void 0),(0,I.Z)(this,"canvas",void 0),(0,I.Z)(this,"width",void 0),(0,I.Z)(this,"height",void 0),(0,I.Z)(this,"isDirty",void 0),(0,I.Z)(this,"createModel",function(r){return new eE(i.gl,r)}),(0,I.Z)(this,"createAttribute",function(r){return new z2(i.gl,r)}),(0,I.Z)(this,"createBuffer",function(r){return new X2(i.gl,r)}),(0,I.Z)(this,"createElements",function(r){return new Y2(i.gl,r)}),(0,I.Z)(this,"createTexture2D",function(r){return new tE(i.gl,r)}),(0,I.Z)(this,"createFramebuffer",function(r){return new q2(i.gl,r)}),(0,I.Z)(this,"useFramebuffer",function(r,n){i.gl({framebuffer:r?r.get():null})(n)}),(0,I.Z)(this,"clear",function(r){var n=r.color,a=r.depth,s=r.stencil,h=r.framebuffer,m=h===void 0?null:h,y={color:n,depth:a,stencil:s};y.framebuffer=m===null?m:m.get(),i.gl.clear(y)}),(0,I.Z)(this,"viewport",function(r){var n=r.x,a=r.y,s=r.width,h=r.height;i.gl._gl.viewport(n,a,s,h),i.width=s,i.height=h,i.gl._refresh()}),(0,I.Z)(this,"readPixels",function(r){var n=r.framebuffer,a=r.x,s=r.y,h=r.width,m=r.height,y={x:a,y:s,width:h,height:m};return n&&(y.framebuffer=n.get()),i.gl.read(y)}),(0,I.Z)(this,"getViewportSize",function(){return{width:i.gl._gl.drawingBufferWidth,height:i.gl._gl.drawingBufferHeight}}),(0,I.Z)(this,"getContainer",function(){if(wo)return i.canvas;var r;return(r=i.canvas)===null||r===void 0?void 0:r.parentElement}),(0,I.Z)(this,"getCanvas",function(){return i.canvas}),(0,I.Z)(this,"getGLContext",function(){return i.gl._gl}),(0,I.Z)(this,"destroy",function(){i.gl.destroy()})}return(0,It.Z)(e,[{key:"init",value:function(){var i=(0,Ea.Z)(Mi().mark(function n(a,s){var h=this;return Mi().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return this.canvas=a,y.next=3,new Promise(function(b,A){N2()({canvas:h.canvas,attributes:{alpha:!0,antialias:s.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:s.preserveDrawingBuffer,stencil:s.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(k,F){(k||!F)&&A(k),b(F)}})});case 3:this.gl=y.sent,this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 5:case"end":return y.stop()}},n,this)}));function r(n,a){return i.apply(this,arguments)}return r}()},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(r){return!!this.getGLContext().getExtension(r)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var r=this.getGLContext();r.disable(r.CULL_FACE)}},{key:"setDirty",value:function(r){this.isDirty=r}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||Bg);function Ng(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function zg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Ng(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ng(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var nE=function(){function e(i){(0,lt.Z)(this,e),(0,I.Z)(this,"sceneService",void 0),(0,I.Z)(this,"mapService",void 0),(0,I.Z)(this,"controlService",void 0),(0,I.Z)(this,"layerService",void 0),(0,I.Z)(this,"iconService",void 0),(0,I.Z)(this,"markerService",void 0),(0,I.Z)(this,"popupService",void 0),(0,I.Z)(this,"fontService",void 0),(0,I.Z)(this,"interactionService",void 0),(0,I.Z)(this,"container",void 0);var r=i.id,n=i.map,a=i.canvas,s=i.hasBaseMap,h=i2();this.container=h,n.setContainer(h,r,a,s),h.bind($t.IRendererService).to(rE).inSingletonScope(),this.sceneService=h.get($t.ISceneService),this.mapService=h.get($t.IMapService),this.iconService=h.get($t.IIconService),this.fontService=h.get($t.IFontService),this.controlService=h.get($t.IControlService),this.layerService=h.get($t.ILayerService),this.markerService=h.get($t.IMarkerService),this.interactionService=h.get($t.IInteractionService),this.popupService=h.get($t.IPopupService),wo?this.sceneService.initMiniScene(i):(this.initComponent(r),this.sceneService.init(i),this.initControl())}return(0,It.Z)(e,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(r){return this.sceneService.exportPng(r)}},{key:"exportMap",value:function(r){return this.sceneService.exportPng(r)}},{key:"registerRenderService",value:function(r){var n=this;if(this.sceneService.loaded){var a=new r(this);a.init()}else this.on("loaded",function(){var s=new r(n);s.init()})}},{key:"setBgColor",value:function(r){this.mapService.setBgColor(r)}},{key:"addLayer",value:function(r){var n=a2(this.container);r.setContainer(n,this.container),this.sceneService.addLayer(r)}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(r){return this.layerService.getLayer(r)}},{key:"getLayerByName",value:function(r){return this.layerService.getLayerByName(r)}},{key:"removeLayer",value:function(r,n){this.layerService.remove(r,n)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(r){this.layerService.setEnableRender(r)}},{key:"addIconFont",value:function(r,n){this.fontService.addIconFont(r,n)}},{key:"addIconFonts",value:function(r){var n=this;r.forEach(function(a){var s=(0,ne.Z)(a,2),h=s[0],m=s[1];n.fontService.addIconFont(h,m)})}},{key:"addFontFace",value:function(r,n){this.sceneService.addFontFace(r,n)}},{key:"addImage",value:function(r,n){wo?this.iconService.addImageMini(r,n,this.sceneService):this.iconService.addImage(r,n)}},{key:"hasImage",value:function(r){return this.iconService.hasImage(r)}},{key:"removeImage",value:function(r){this.iconService.removeImage(r)}},{key:"addIconFontGlyphs",value:function(r,n){this.fontService.addIconGlyphs(n)}},{key:"addControl",value:function(r){this.controlService.addControl(r,this.container)}},{key:"removeControl",value:function(r){this.controlService.removeControl(r)}},{key:"getControlByName",value:function(r){return this.controlService.getControlByName(r)}},{key:"addMarker",value:function(r){this.markerService.addMarker(r)}},{key:"addMarkerLayer",value:function(r){this.markerService.addMarkerLayer(r)}},{key:"removeMarkerLayer",value:function(r){this.markerService.removeMarkerLayer(r)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(r){this.popupService.addPopup(r)}},{key:"on",value:function(r,n){Om.indexOf(r)===-1?this.mapService.on(r,n):this.sceneService.on(r,n)}},{key:"once",value:function(r,n){Om.indexOf(r)===-1?this.mapService.once(r,n):this.sceneService.once(r,n)}},{key:"off",value:function(r,n){Om.indexOf(r)===-1?this.mapService.off(r,n):this.sceneService.off(r,n)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(r){return this.mapService.getCenter(r)}},{key:"setCenter",value:function(r,n){return this.mapService.setCenter(r,n)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(r){return this.mapService.setPitch(r)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(r){this.mapService.setRotation(r)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(r){this.mapService.panTo(r)}},{key:"panBy",value:function(r,n){this.mapService.panBy(r,n)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(r){this.mapService.setZoom(r)}},{key:"fitBounds",value:function(r,n){var a=this.sceneService.getSceneConfig(),s=a.fitBoundsOptions,h=a.animate;this.mapService.fitBounds(r,n||zg(zg({},s),{},{animate:h}))}},{key:"setZoomAndCenter",value:function(r,n){this.mapService.setZoomAndCenter(r,n)}},{key:"setMapStyle",value:function(r){this.mapService.setMapStyle(r)}},{key:"setMapStatus",value:function(r){this.mapService.setMapStatus(r)}},{key:"pixelToLngLat",value:function(r){return this.mapService.pixelToLngLat(r)}},{key:"lngLatToPixel",value:function(r){return this.mapService.lngLatToPixel(r)}},{key:"containerToLngLat",value:function(r){return this.mapService.containerToLngLat(r)}},{key:"lngLatToContainer",value:function(r){return this.mapService.lngLatToContainer(r)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(r,n){this.container.bind($t.IPostProcessingPass).to(r).whenTargetNamed(n)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(r){this.controlService.init({container:Js(r)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var r=this.sceneService.getSceneConfig(),n=r.logoVisible,a=r.logoPosition;n&&this.addControl(new A2({position:a}))}}]),e}(),iE=R(13218),zu=R.n(iE),Ug,Zg,jg,Lm,Vg;function Gg(e){return e.map(function(i){return typeof i=="string"&&(i=[i,{}]),i})}var aE=(Ug=(0,Lr.b2)(),Zg=(0,Lr.f3)($t.IGlobalConfigService),Ug(jg=(Lm=function(){function e(){(0,lt.Z)(this,e),Vn(this,"configService",Vg,this),(0,I.Z)(this,"enabled",void 0)}return(0,It.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.rendererService,h=n.postProcessingPassFactory,m=n.normalPassFactory;r.hooks.init.tap("MultiPassRendererPlugin",function(){var y=r.getLayerConfig(),b=y.enableMultiPassRenderer,A=y.passes,P=A===void 0?[]:A;a.enabled=!!b&&r.getLayerConfig().enableMultiPassRenderer!==!1,a.enabled&&(r.multiPassRenderer=a.createMultiPassRenderer(r,P,h,m),r.multiPassRenderer.setRenderFlag(!0))}),r.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){if(a.enabled){var y=s.getViewportSize(),b=y.width,A=y.height;r.multiPassRenderer.resize(b,A)}})}},{key:"createMultiPassRenderer",value:function(r,n,a,s){var h=r.multiPassRenderer,m=r.getLayerConfig(),y=m.enablePicking,b=m.enableTAA;return b?h.add(s("taa")):h.add(s("render")),Gg(n).forEach(function(A){var P=(0,ne.Z)(A,2),k=P[0],F=P[1];h.add(a(k),F)}),h.add(a("copy")),h}}]),e}(),Vg=wn(Lm.prototype,"configService",[Zg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lm))||jg),jh,Hg=(jh={},(0,I.Z)(jh,vc.additive,{enable:!0,func:{srcRGB:ee.ONE,dstRGB:ee.ONE,srcAlpha:1,dstAlpha:1}}),(0,I.Z)(jh,vc.none,{enable:!1}),(0,I.Z)(jh,vc.normal,{enable:!0,func:{srcRGB:ee.SRC_ALPHA,dstRGB:ee.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,I.Z)(jh,vc.subtractive,{enable:!0,func:{srcRGB:ee.ONE,dstRGB:ee.ONE,srcAlpha:ee.ZERO,dstAlpha:ee.ONE_MINUS_SRC_COLOR},equation:{rgb:ee.FUNC_SUBTRACT,alpha:ee.FUNC_SUBTRACT}}),(0,I.Z)(jh,vc.max,{enable:!0,func:{srcRGB:ee.ONE,dstRGB:ee.ONE},equation:{rgb:ee.MAX_EXT}}),(0,I.Z)(jh,vc.min,{enable:!0,func:{srcRGB:ee.ONE,dstRGB:ee.ONE},equation:{rgb:ee.MIN_EXT}}),jh),oE=R(81763),za=R.n(oE),sE=R(1469),Ap=R.n(sE),F5=1024;function ll(e,i,r,n,a){i.updateStyleAttribute(e,r,n,a)}function uE(e,i){e.opacity&&Zv("opacity",i,e.opacity),e.strokeWidth&&Zv("strokeWidth",i,e.strokeWidth),e.strokeOpacity&&Zv("strokeOpacity",i,e.strokeOpacity),e.stroke&&lE("stroke",i,e.stroke),e.offsets&&Wg("offsets",i,e.offsets),e.textOffset&&Wg("textOffset",i,e.textOffset),e.thetaOffset&&Zv("thetaOffset",i,e.thetaOffset)}function Zv(e,i,r){Rn()(r)?ll(e,i,r,function(n){return n}):za()(r)?ll(e,i,[r],void 0):Ap()(r)&&r.length===2?Rn()(r[0])&&Ha()(r[1])||Rn()(r[0])&&Ap()(r[1])&&za()(r[1][0])&&za()(r[1][1])?ll(e,i,r[0],r[1]):ll(e,i,[1],void 0):ll(e,i,[1],void 0)}function Wg(e,i,r){Rn()(r)?ll(e,i,r,function(n){return n}):Ap()(r)&&r.length===2&&Rn()(r[0])&&Ha()(r[1])?ll(e,i,r[0],r[1]):Ap()(r)&&r.length===2&&za()(r[0])&&za()(r[1])?ll(e,i,r,void 0):ll(e,i,[0,0],void 0)}function lE(e,i,r){Rn()(r)?ll(e,i,r,void 0):Ap()(r)&&r.length===2&&(Rn()(r[0])&&Ha()(r[1])||Rn()(r[0])&&Ap()(r[1])&&r[1].length>0)?ll(e,i,r[0],r[1]):ll(e,i,"#fff",void 0)}var cE=[["circle","cylinder"],["square","cylinder"],["triangle","cylinder"],["pentagon","cylinder"],["hexagon","cylinder"],["octogon","cylinder"],["hexagram","cylinder"],["rhombus","cylinder"],["vesica","cylinder"]];function fE(e,i,r){typeof i=="string"&&typeof r=="string"&&i!==r&&cE.map(function(n){n.includes(i)&&n.includes(r)&&(e.dataState.dataSourceNeedUpdate=!0)})}var hE=["passes"],pE=["moduleName","vertexShader","fragmentShader","triangulation","segmentNumber"],Xg,km,Yg;function dE(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=vE(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(b){throw b},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,h=!1,m;return{s:function(){r=r.call(e)},n:function(){var b=r.next();return s=b.done,b},e:function(b){h=!0,m=b},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(h)throw m}}}}function vE(e,i){if(!!e){if(typeof e=="string")return qg(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return qg(e,i)}}function qg(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function Kg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Uu(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Kg(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Kg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function mE(e){var i=gE();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function gE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $g=0,wp=(Xg=Im($t.IGlobalConfigService),km=function(e){(0,pn.Z)(r,e);var i=mE(r);function r(){var n,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,lt.Z)(this,r),n=i.call(this),(0,I.Z)((0,xe.Z)(n),"id","".concat($g++)),(0,I.Z)((0,xe.Z)(n),"name","".concat($g)),(0,I.Z)((0,xe.Z)(n),"type",void 0),(0,I.Z)((0,xe.Z)(n),"visible",!0),(0,I.Z)((0,xe.Z)(n),"zIndex",0),(0,I.Z)((0,xe.Z)(n),"minZoom",void 0),(0,I.Z)((0,xe.Z)(n),"maxZoom",void 0),(0,I.Z)((0,xe.Z)(n),"inited",!1),(0,I.Z)((0,xe.Z)(n),"layerModelNeedUpdate",!1),(0,I.Z)((0,xe.Z)(n),"pickedFeatureID",null),(0,I.Z)((0,xe.Z)(n),"selectedFeatureID",null),(0,I.Z)((0,xe.Z)(n),"styleNeedUpdate",!1),(0,I.Z)((0,xe.Z)(n),"rendering",void 0),(0,I.Z)((0,xe.Z)(n),"clusterZoom",0),(0,I.Z)((0,xe.Z)(n),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,I.Z)((0,xe.Z)(n),"hooks",{init:new Nf,afterInit:new Nf,beforeRender:new Nf,beforeRenderData:new qh,afterRender:new Ws,beforePickingEncode:new Ws,afterPickingEncode:new Ws,beforeHighlight:new Ws(["pickedColor"]),afterHighlight:new Ws,beforeSelect:new Ws(["pickedColor"]),afterSelect:new Ws,beforeDestroy:new Ws,afterDestroy:new Ws}),(0,I.Z)((0,xe.Z)(n),"models",[]),(0,I.Z)((0,xe.Z)(n),"multiPassRenderer",void 0),(0,I.Z)((0,xe.Z)(n),"plugins",void 0),(0,I.Z)((0,xe.Z)(n),"sourceOption",void 0),(0,I.Z)((0,xe.Z)(n),"layerModel",void 0),(0,I.Z)((0,xe.Z)(n),"sceneContainer",void 0),(0,I.Z)((0,xe.Z)(n),"layerChildren",[]),Vn((0,xe.Z)(n),"configService",Yg,(0,xe.Z)(n)),(0,I.Z)((0,xe.Z)(n),"shaderModuleService",void 0),(0,I.Z)((0,xe.Z)(n),"cameraService",void 0),(0,I.Z)((0,xe.Z)(n),"coordinateService",void 0),(0,I.Z)((0,xe.Z)(n),"iconService",void 0),(0,I.Z)((0,xe.Z)(n),"fontService",void 0),(0,I.Z)((0,xe.Z)(n),"pickingService",void 0),(0,I.Z)((0,xe.Z)(n),"rendererService",void 0),(0,I.Z)((0,xe.Z)(n),"layerService",void 0),(0,I.Z)((0,xe.Z)(n),"interactionService",void 0),(0,I.Z)((0,xe.Z)(n),"mapService",void 0),(0,I.Z)((0,xe.Z)(n),"styleAttributeService",void 0),(0,I.Z)((0,xe.Z)(n),"layerSource",void 0),(0,I.Z)((0,xe.Z)(n),"postProcessingPassFactory",void 0),(0,I.Z)((0,xe.Z)(n),"normalPassFactory",void 0),(0,I.Z)((0,xe.Z)(n),"animateOptions",{enable:!1}),(0,I.Z)((0,xe.Z)(n),"container",void 0),(0,I.Z)((0,xe.Z)(n),"encodedData",void 0),(0,I.Z)((0,xe.Z)(n),"configSchema",void 0),(0,I.Z)((0,xe.Z)(n),"currentPickId",null),(0,I.Z)((0,xe.Z)(n),"rawConfig",void 0),(0,I.Z)((0,xe.Z)(n),"needUpdateConfig",void 0),(0,I.Z)((0,xe.Z)(n),"pendingStyleAttributes",[]),(0,I.Z)((0,xe.Z)(n),"scaleOptions",{}),(0,I.Z)((0,xe.Z)(n),"animateStartTime",void 0),(0,I.Z)((0,xe.Z)(n),"aniamateStatus",!1),(0,I.Z)((0,xe.Z)(n),"bottomColor","rgba(0, 0, 0, 0)"),(0,I.Z)((0,xe.Z)(n),"isDestroied",!1),(0,I.Z)((0,xe.Z)(n),"sourceEvent",function(){n.dataState.dataSourceNeedUpdate=!0;var s=n.getLayerConfig(),h=s.autoFit,m=s.fitBoundsOptions;h&&n.fitBounds(m),n.emit("dataUpdate"),n.reRender()}),n.name=a.name||n.id,n.zIndex=a.zIndex||0,n.rawConfig=a,n}return(0,It.Z)(r,[{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(a){if(!this.inited)this.needUpdateConfig=Uu(Uu({},this.needUpdateConfig),a);else{var s=this.container.get($t.SceneID);uE(a,this),this.configService.setLayerConfig(s,this.id,Uu(Uu(Uu({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),a)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(a,s){this.container=a,this.sceneContainer=s}},{key:"getContainer",value:function(){return this.container}},{key:"setBottomColor",value:function(a){this.bottomColor=a}},{key:"getBottomColor",value:function(){return this.bottomColor}},{key:"addPlugin",value:function(a){return this.plugins.push(a),this}},{key:"init",value:function(){var a=this,s=this.container.get($t.SceneID);this.configService.setLayerConfig(s,this.id,this.rawConfig),this.iconService=this.container.get($t.IIconService),this.fontService=this.container.get($t.IFontService),this.rendererService=this.container.get($t.IRendererService),this.layerService=this.container.get($t.ILayerService),this.interactionService=this.container.get($t.IInteractionService),this.pickingService=this.container.get($t.IPickingService),this.mapService=this.container.get($t.IMapService),this.cameraService=this.container.get($t.ICameraService),this.coordinateService=this.container.get($t.ICoordinateSystemService),this.shaderModuleService=this.container.get($t.IShaderModuleService),this.postProcessingPassFactory=this.container.get($t.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get($t.IFactoryNormalPass),this.styleAttributeService=this.container.get($t.IStyleAttributeService),this.multiPassRenderer=this.container.get($t.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach(function(b){var A=b.attributeName,P=b.attributeField,k=b.attributeValues,F=b.updateOptions;a.styleAttributeService.updateStyleAttribute(A,{scale:Uu({field:P},a.splitValuesAndCallbackInAttribute(k,a.getLayerConfig()[A]))},F)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll($t.ILayerPlugin);var h=dE(this.plugins),m;try{for(h.s();!(m=h.n()).done;){var y=m.value;y.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(b){h.e(b)}finally{h.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig(Uu(Uu({},this.getDefaultConfig()),this.rawConfig));var a=this.getLayerConfig(),s=a.animateOption;s!=null&&s.enable&&(this.layerService.startAnimate(),this.aniamateStatus=!0)}},{key:"color",value:function(a,s,h){return this.updateStyleAttribute("color",a,s,h),this}},{key:"texture",value:function(a,s,h){return this.updateStyleAttribute("texture",a,s,h),this}},{key:"rotate",value:function(a,s,h){return this.updateStyleAttribute("rotate",a,s,h),this}},{key:"size",value:function(a,s,h){return this.updateStyleAttribute("size",a,s,h),this}},{key:"filter",value:function(a,s,h){return this.updateStyleAttribute("filter",a,s,h),this}},{key:"shape",value:function(a,s,h){var m,y,b,A=(m=this.styleAttributeService)===null||m===void 0||(y=m.getLayerStyleAttribute("shape"))===null||y===void 0||(b=y.scale)===null||b===void 0?void 0:b.field,P=a;return this.updateStyleAttribute("shape",a,s,h),fE(this,A,P),this}},{key:"label",value:function(a,s,h){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:a,attributeValues:s,updateOptions:h}),this}},{key:"animate",value:function(a){var s={};return zu()(a)?(s.enable=!0,s=Uu(Uu({},s),a)):s.enable=a,this.updateLayerConfig({animateOption:s}),this}},{key:"source",value:function(a,s){return a!=null&&a.data?(this.setSource(a),this):(this.sourceOption={data:a,options:s},this.clusterZoom=0,this)}},{key:"setData",value:function(a,s){var h=this;return this.inited?this.layerSource.setData(a,s):this.on("inited",function(){h.layerSource.setData(a,s)}),this}},{key:"style",value:function(a){var s=this,h=a.passes,m=(0,pc.Z)(a,hE);return h&&Gg(h).forEach(function(y){var b=s.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(y[0]);b&&b.updateOptions(y[1])}),this.rawConfig=Uu(Uu({},this.rawConfig),m),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),this}},{key:"scale",value:function(a,s){return zu()(a)?this.scaleOptions=Uu(Uu({},this.scaleOptions),a):this.scaleOptions[a]=s,this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.renderLayers(),this.rendering=!1}},{key:"render",value:function(){return this.getEncodedData().length!==0&&this.renderModels(),this}},{key:"renderMultiPass",value:function(){var n=(0,Ea.Z)(Mi().mark(function s(){return Mi().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(this.getEncodedData().length===0){m.next=7;break}if(!(this.multiPassRenderer&&this.multiPassRenderer.getRenderFlag())){m.next=6;break}return m.next=4,this.multiPassRenderer.render();case 4:m.next=7;break;case 6:this.multiPassRenderer?this.renderModels():this.renderModels();case 7:case"end":return m.stop()}},s,this)}));function a(){return n.apply(this,arguments)}return a}()},{key:"active",value:function(a){var s={};return s.enableHighlight=zu()(a)?!0:a,zu()(a)?(s.enableHighlight=!0,a.color&&(s.highlightColor=a.color),a.mix&&(s.activeMix=a.mix)):s.enableHighlight=!!a,this.updateLayerConfig(s),this}},{key:"setActive",value:function(a,s){var h=this;if(zu()(a)){var m=a.x,y=m===void 0?0:m,b=a.y,A=b===void 0?0:b;this.updateLayerConfig({highlightColor:zu()(s)?s.color:this.getLayerConfig().highlightColor,activeMix:zu()(s)?s.mix:this.getLayerConfig().activeMix}),this.pick({x:y,y:A})}else this.updateLayerConfig({pickedFeatureID:a,highlightColor:zu()(s)?s.color:this.getLayerConfig().highlightColor,activeMix:zu()(s)?s.mix:this.getLayerConfig().activeMix}),this.hooks.beforeSelect.call(Ve(a)).then(function(){setTimeout(function(){h.reRender()},1)})}},{key:"select",value:function(a){var s={};return s.enableSelect=zu()(a)?!0:a,zu()(a)?(s.enableSelect=!0,a.color&&(s.selectColor=a.color),a.mix&&(s.selectMix=a.mix)):s.enableSelect=!!a,this.updateLayerConfig(s),this}},{key:"setSelect",value:function(a,s){var h=this;if(zu()(a)){var m=a.x,y=m===void 0?0:m,b=a.y,A=b===void 0?0:b;this.updateLayerConfig({selectColor:zu()(s)?s.color:this.getLayerConfig().selectColor,selectMix:zu()(s)?s.mix:this.getLayerConfig().selectMix}),this.pick({x:y,y:A})}else this.updateLayerConfig({pickedFeatureID:a,selectColor:zu()(s)?s.color:this.getLayerConfig().selectColor,selectMix:zu()(s)?s.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(Ve(a)).then(function(){setTimeout(function(){h.reRender()},1)})}},{key:"setBlend",value:function(a){this.updateLayerConfig({blend:a}),this.layerModelNeedUpdate=!0,this.reRender()}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"setIndex",value:function(a){return this.zIndex=a,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(a){this.currentPickId=a}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(a){this.selectedFeatureID=a}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var a=this.mapService.getZoom(),s=this.getLayerConfig(),h=s.visible,m=s.minZoom,y=m===void 0?-Infinity:m,b=s.maxZoom,A=b===void 0?Infinity:b;return!!h&&a>=y&&a<=A}},{key:"setMinZoom",value:function(a){return this.updateLayerConfig({minZoom:a}),this}},{key:"getMinZoom",value:function(){var a=this.getLayerConfig(),s=a.minZoom;return s}},{key:"getMaxZoom",value:function(){var a=this.getLayerConfig(),s=a.maxZoom;return s}},{key:"get",value:function(a){var s=this.getLayerConfig();return s[a]}},{key:"setMaxZoom",value:function(a){return this.updateLayerConfig({maxZoom:a}),this}},{key:"fitBounds",value:function(a){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var s=this.getSource(),h=s.extent,m=h.some(function(y){return Math.abs(y)===Infinity});return m?this:(this.mapService.fitBounds([[h[0],h[1]],[h[2],h[3]]],a),this)}},{key:"destroy",value:function(){this.isDestroied||(this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),this.multiPassRenderer.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),this.models=[],this.layerService.cleanRemove(this),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroied=!0)}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){this.models.forEach(function(a){return a.destroy()}),this.layerModel.clearModels()}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(a){return a.needRescale||a.needRemapping||a.needRegenerateVertices}).length}},{key:"setSource",value:function(a){if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=a,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var s=this.mapService.getZoom();this.layerSource.updateClusterData(s)}this.layerSource.on("update",this.sourceEvent)}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(a){this.encodedData=a}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getLegendItems",value:function(a){var s=this.styleAttributeService.getLayerAttributeScale(a);if(s){if(s.ticks){var h=s.ticks().map(function(b){return(0,I.Z)({value:b},a,s(b))});return h}else if(s.invertExtent){var m=s.range().map(function(b){return(0,I.Z)({value:s.invertExtent(b)},a,b)});return m}else if(s!=null&&s.domain){var y=s.domain().map(function(b){return{value:b||"\u65E0",color:s(b)}});return y}}else return[]}},{key:"pick",value:function(a){var s=a.x,h=a.y;this.interactionService.triggerHover({x:s,y:h})}},{key:"boxSelect",value:function(a,s){this.pickingService.boxPickLayer(this,a,s)}},{key:"buildLayerModel",value:function(a){var s=a.moduleName,h=a.vertexShader,m=a.fragmentShader,y=a.triangulation,b=a.segmentNumber,A=(0,pc.Z)(a,pE);this.shaderModuleService.registerModule(s,{vs:h,fs:m});var P=this.shaderModuleService.getModule(s),k=P.vs,F=P.fs,q=P.uniforms,oe=this.rendererService.createModel,ue=this.styleAttributeService.createAttributesAndIndices(this.encodedData,y,b),Pe=ue.attributes,et=ue.elements;return oe(Uu({attributes:Pe,uniforms:q,fs:F,vs:k,elements:et,blend:Hg[vc.normal]},A))}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.aniamateStatus&&(this.layerService.stopAnimate(),this.aniamateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(a){var s=this.getLayerConfig(),h=s.enableHighlight,m=h===void 0?!0:h,y=s.enableSelect,b=y===void 0?!0:y,A=this.eventNames().indexOf(a)!==-1||this.eventNames().indexOf("un"+a)!==-1;return(a==="click"||a==="dblclick")&&b&&(A=!0),a==="mousemove"&&(m||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(A=!0),this.isVisible()&&A}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderMulPass",value:function(){var n=(0,Ea.Z)(Mi().mark(function s(h){return Mi().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,h.render();case 2:case"end":return y.stop()}},s)}));function a(s){return n.apply(this,arguments)}return a}()},{key:"renderModels",value:function(a){var s=this;return this.getEncodedData().length>0&&(this.layerModelNeedUpdate&&this.layerModel&&(this.models=this.layerModel.buildModels(),this.hooks.beforeRender.call(),this.layerModelNeedUpdate=!1),this.models.forEach(function(h){h.draw({uniforms:s.layerModel.getUninforms()},a)})),this}},{key:"updateStyleAttribute",value:function(a,s,h,m){this.inited?this.styleAttributeService.updateStyleAttribute(a,{scale:Uu({field:s},this.splitValuesAndCallbackInAttribute(h,this.getLayerConfig()[s]))},m):this.pendingStyleAttributes.push({attributeName:a,attributeField:s,attributeValues:h,updateOptions:m})}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(a){console.warn("empty fn")}},{key:"getConfigSchema",value:function(){throw new Error("Method not implemented.")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"reRender",value:function(){this.inited&&(this.layerService.updateLayerRenderList(),this.layerService.renderLayers())}},{key:"splitValuesAndCallbackInAttribute",value:function(a,s){return{values:Ha()(a)?void 0:a||s,callback:Ha()(a)?a:void 0}}}]),r}(Cs.EventEmitter),Yg=wn(km.prototype,"configService",[Xg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),km),yE=R(18446),pd=R.n(yE),Jg,Dm,Qg;function _E(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=xE(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(b){throw b},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,h=!1,m;return{s:function(){r=r.call(e)},n:function(){var b=r.next();return s=b.done,b},e:function(b){h=!0,m=b},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(h)throw m}}}}function xE(e,i){if(!!e){if(typeof e=="string")return ey(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ey(e,i)}}function ey(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var bs=(Jg=Im($t.IGlobalConfigService),Dm=function(){function e(i){(0,lt.Z)(this,e),(0,I.Z)(this,"triangulation",void 0),(0,I.Z)(this,"createTexture2D",void 0),(0,I.Z)(this,"layer",void 0),(0,I.Z)(this,"dataTexture",void 0),(0,I.Z)(this,"DATA_TEXTURE_WIDTH",void 0),(0,I.Z)(this,"rowCount",void 0),(0,I.Z)(this,"cacheStyleProperties",void 0),(0,I.Z)(this,"cellLength",void 0),(0,I.Z)(this,"cellProperties",void 0),(0,I.Z)(this,"cellTypeLayout",void 0),(0,I.Z)(this,"stylePropertyesExist",void 0),(0,I.Z)(this,"dataTextureTest",void 0),Vn(this,"configService",Qg,this),(0,I.Z)(this,"shaderModuleService",void 0),(0,I.Z)(this,"rendererService",void 0),(0,I.Z)(this,"iconService",void 0),(0,I.Z)(this,"fontService",void 0),(0,I.Z)(this,"styleAttributeService",void 0),(0,I.Z)(this,"mapService",void 0),(0,I.Z)(this,"cameraService",void 0),(0,I.Z)(this,"layerService",void 0),this.layer=i,this.rendererService=i.getContainer().get($t.IRendererService),this.shaderModuleService=i.getContainer().get($t.IShaderModuleService),this.styleAttributeService=i.getContainer().get($t.IStyleAttributeService),this.mapService=i.getContainer().get($t.IMapService),this.iconService=i.getContainer().get($t.IIconService),this.fontService=i.getContainer().get($t.IFontService),this.cameraService=i.getContainer().get($t.ICameraService),this.layerService=i.getContainer().get($t.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var r=this.rendererService.createTexture2D;this.createTexture2D=r,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={thetaOffset:void 0,opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new Uint8ClampedArray(4),mag:ee.NEAREST,min:ee.NEAREST,width:1,height:1}))}return(0,It.Z)(e,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertyesExist.hasOpacity,this.stylePropertyesExist.hasStrokeOpacity,this.stylePropertyesExist.hasStrokeWidth,this.stylePropertyesExist.hasStroke,this.stylePropertyesExist.hasOffsets,this.stylePropertyesExist.hasThetaOffset,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(r){var n=!1;return pd()(r.thetaOffset,this.cacheStyleProperties.thetaOffset)||(n=!0,this.cacheStyleProperties.thetaOffset=r.thetaOffset),pd()(r.opacity,this.cacheStyleProperties.opacity)||(n=!0,this.cacheStyleProperties.opacity=r.opacity),pd()(r.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(n=!0,this.cacheStyleProperties.strokeOpacity=r.strokeOpacity),pd()(r.strokeWidth,this.cacheStyleProperties.strokeWidth)||(n=!0,this.cacheStyleProperties.strokeWidth=r.strokeWidth),pd()(r.stroke,this.cacheStyleProperties.stroke)||(n=!0,this.cacheStyleProperties.stroke=r.stroke),pd()(r.offsets,this.cacheStyleProperties.offsets)||(n=!0,this.cacheStyleProperties.offsets=r.offsets),this.dataTexture===void 0&&(n=!0),n}},{key:"judgeStyleAttributes",value:function(r){this.clearLastCalRes(),r.opacity!==void 0&&!za()(r.opacity)&&(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertyesExist.hasOpacity=1,this.cellLength+=1),r.strokeOpacity!==void 0&&!za()(r.strokeOpacity)&&(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertyesExist.hasStrokeOpacity=1,this.cellLength+=1),r.strokeWidth!==void 0&&!za()(r.strokeWidth)&&(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertyesExist.hasStrokeWidth=1,this.cellLength+=1),r.stroke!==void 0&&!this.isStaticColor(r.stroke)&&(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertyesExist.hasStroke=1,this.cellLength+=4),r.offsets!==void 0&&!this.isOffsetStatic(r.offsets)&&(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertyesExist.hasOffsets=1,this.cellLength+=2),r.thetaOffset!==void 0&&!za()(r.thetaOffset)&&(this.cellProperties.push({attr:"thetaOffset",count:1}),this.stylePropertyesExist.hasThetaOffset=1,this.cellLength+=1)}},{key:"isStaticColor",value:function(r){return Rn()(r)?!!(0,Le.ZP)(r):!1}},{key:"getStrokeColor",value:function(r){if(this.isStaticColor(r)){var n=Be(r);return n[0]=n[0]?n[0]:0,n[1]=n[1]?n[1]:0,n[2]=n[2]?n[2]:0,n[3]=n[3]?n[3]:0,n}else return[0,0,0,0]}},{key:"isOffsetStatic",value:function(r){return!!(Ap()(r)&&r.length===2&&za()(r[0])&&za()(r[1]))}},{key:"patchMod",value:function(r,n){for(var a=0;a<n;a++)r.push(-1)}},{key:"patchData",value:function(r,n,a){var s=_E(a),h;try{for(s.s();!(h=s.n()).done;){var m=h.value,y=m.attr,b=m.count,A=n[y];A!==void 0?y==="stroke"?r.push.apply(r,(0,ur.Z)(Be(A))):y==="offsets"?this.isOffsetStatic(A)?r.push(-A[0],A[1]):r.push(0,0):r.push(za()(A)?A:1):this.patchMod(r,b)}}catch(P){s.e(P)}finally{s.f()}}},{key:"calDataFrame",value:function(r,n,a){for(var s=n.length,h=Math.ceil(s*r/this.DATA_TEXTURE_WIDTH),m=h*this.DATA_TEXTURE_WIDTH,y=[],b=0;b<s;b++){var A=n[b];this.patchData(y,A,a)}for(var P=y.length;P<m;P++)y.push(-1);return{data:y,width:this.DATA_TEXTURE_WIDTH,height:h}}},{key:"getBlend",value:function(){var r=this.layer.getLayerConfig(),n=r.blend,a=n===void 0?"normal":n;return Hg[vc[a]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(r){return[r.enable?0:1,r.duration||4,r.interval||.2,r.trailLength||.1]}},{key:"startModelAnimate",value:function(){var r=this.layer.getLayerConfig(),n=r.animateOption;n.enable&&this.layer.setAnimateStartTime()}}]),e}(),Qg=wn(Dm.prototype,"configService",[Jg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dm),bE=R(9187),Tf=R.n(bE),ty=100,B5=36,N5=40;function ry(e){return e/180*Math.acos(-1)}function ny(e){var i=ry(e[0])+Math.PI/2,r=ry(e[1]),n=ty+Math.random()*.4,a=n*Math.cos(r)*Math.cos(i),s=n*Math.cos(r)*Math.sin(i),h=n*Math.sin(r);return[s,h,a]}function z5(e,i){var r=mat4.create(),n=mat4.create(),a=vec3.fromValues(0,1,0),s=vec3.fromValues(0,0,0);i=i||{},e=typeof e!="undefined"?e:1;for(var h=typeof i.segments!="undefined"?i.segments:32,m=2+h,y=2*m,b=[],A=[],P=[],k=[],F=[],q=[],oe=0;oe<=m;oe++){for(var ue=oe/m,Pe=ue*Math.PI,et=0;et<=y;et++){var at=et/y,_t=at*Math.PI*2;mat4.identity(n),mat4.rotateZ(n,n,-Pe),mat4.identity(r),mat4.rotateY(r,r,_t),vec3.transformMat4(s,a,n),vec3.transformMat4(s,s,r),vec3.scale(s,s,-e),P.push(s.slice()),k.push.apply(k,_toConsumableArray(s.slice())),vec3.normalize(s,s),F.push.apply(F,_toConsumableArray(s.slice())),q.push([at,1-ue]),k.push(at,1-ue)}if(oe>0)for(var Nt=P.length,Ht=Nt-2*(y+1);Ht+y+2<Nt;Ht++)b.push([Ht,Ht+1,Ht+y+1]),A.push(Ht,Ht+1,Ht+y+1),b.push([Ht+y+1,Ht+1,Ht+y+2]),A.push(Ht+y+1,Ht+1,Ht+y+2)}return{cells:b,positions:P,uvs:q,positionsArr:k,indicesArr:A,normalArr:F}}var xi=R(31437),jv=xi.Ue(),U5=xi.Ue(),qs=xi.Ue(),Vh=xi.Ue(),dd=xi.Ue();function Fm(e,i,r,n,a){xi.IH(e,r,n),xi.Fv(e,e),i=xi.al(-e[1],e[0]);var s=xi.al(-r[1],r[0]);return[a/xi.AK(i,s),i]}function Gh(e,i){return xi.t8(e,-i[1],i[0])}function vd(e,i,r){return xi.lu(e,i,r),xi.Fv(e,e),e}function Bm(e,i){return e[0]===i[0]&&e[1]===i[1]}function Z5(e){for(var i=new Map,r=0;r<e.length;r++){var n=e[0].toString()+"-"+e[1].toString();i.get(n)?(e.splice(r,1),r++):i.set(n,n)}return e}var iy=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,lt.Z)(this,e),(0,I.Z)(this,"complex",void 0),(0,I.Z)(this,"join",void 0),(0,I.Z)(this,"cap",void 0),(0,I.Z)(this,"miterLimit",void 0),(0,I.Z)(this,"thickness",void 0),(0,I.Z)(this,"normal",void 0),(0,I.Z)(this,"lastFlip",-1),(0,I.Z)(this,"miter",xi.al(0,0)),(0,I.Z)(this,"started",!1),(0,I.Z)(this,"dash",!1),(0,I.Z)(this,"totalDistance",0),this.join=i.join||"miter",this.cap=i.cap||"butt",this.miterLimit=i.miterLimit||10,this.thickness=i.thickness||1,this.dash=i.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0}}return(0,It.Z)(e,[{key:"extrude_gaode2",value:function(r,n){var a=this.complex;if(r.length<=1)return a;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var s=r.length,h=a.startIndex,m=1;m<s;m++){var y,b,A,P=r[m-1];P.push((y=n[m-1][2])!==null&&y!==void 0?y:0);var k=n[m-1],F=r[m];F.push((b=n[m][2])!==null&&b!==void 0?b:0);var q=n[m],oe=m<r.length-1?[].concat((0,ur.Z)(r[m+1]),[(A=n[m+1][2])!==null&&A!==void 0?A:0]):null,ue=m<n.length-1?n[m+1]:null,Pe=this.segment_gaode2(a,h,P,F,oe,k,q,ue);h+=Pe}if(this.dash)for(var et=0;et<a.positions.length/6;et++)a.positions[et*6+5]=this.totalDistance;return a.startIndex=a.positions.length/6,a}},{key:"simpleExtrude_gaode2",value:function(r,n){var a=this.complex;if(r.length<=1)return a;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var s=r.length,h=a.startIndex,m=1;m<s;m++){var y,b,A,P=r[m-1];P.push((y=n[m-1][2])!==null&&y!==void 0?y:0);var k=n[m-1],F=r[m];F.push((b=n[m][2])!==null&&b!==void 0?b:0);var q=n[m],oe=m<r.length-1?[].concat((0,ur.Z)(r[m+1]),[(A=n[m+1][2])!==null&&A!==void 0?A:0]):null,ue=m<n.length-1?n[m+1]:null,Pe=this.simpleSegment(a,h,P,F,oe,k,q,ue);h+=Pe}if(this.dash)for(var et=0;et<a.positions.length/6;et++)a.positions[et*6+5]=this.totalDistance;return a.startIndex=a.positions.length/6,a}},{key:"extrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=r.length,s=n.startIndex,h=1;h<a;h++){var m=r[h-1],y=r[h],b=h<r.length-1?r[h+1]:null,A=this.segment(n,s,m,y,b);s+=A}if(this.dash)for(var P=0;P<n.positions.length/6;P++)n.positions[P*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=r.length,s=n.startIndex,h=1;h<a;h++){var m=r[h-1],y=r[h],b=h<r.length-1?r[h+1]:null,A=this.simpleSegment(n,s,m,y,b);s+=A}if(this.dash)for(var P=0;P<n.positions.length/6;P++)n.positions[P*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"segment_gaode2",value:function(r,n,a,s,h,m,y,b){var A=0,P=r.indices,k=r.positions,F=r.normals,q=this.cap==="square",oe=this.join==="bevel",ue=Vs([y[0],y[1]]),Pe=Vs([m[0],m[1]]);vd(qs,s,a);var et=0;if(this.dash&&(et=this.lineSegmentDistance(ue,Pe),this.totalDistance+=et),this.normal||(this.normal=xi.Ue(),Gh(this.normal,qs)),!this.started)if(this.started=!0,q){var at=xi.Ue(),_t=xi.Ue();xi.IH(at,this.normal,qs),xi.IH(_t,this.normal,qs),F.push(_t[0],_t[1],0),F.push(at[0],at[1],0),k.push(a[0],a[1],a[2]|0,this.totalDistance-et,-this.thickness,a[2]|0),k.push(a[0],a[1],a[2]|0,this.totalDistance-et,this.thickness,a[2]|0)}else this.extrusions(k,F,a,this.normal,this.thickness,this.totalDistance-et);if(P.push(n+0,n+1,n+2),h){Bm(s,h)&&xi.IH(h,s,xi.Fv(h,xi.$X(h,s,a))),vd(Vh,h,s);var nr=Fm(dd,xi.Ue(),qs,Vh,this.thickness),mr=(0,ne.Z)(nr,2),Hr=mr[0],fn=mr[1],Or=xi.AK(dd,this.normal)<0?-1:1,Tn=oe;if(!Tn&&this.join==="miter"){var zn=Hr;zn>this.miterLimit&&(Tn=!0)}Tn?(F.push(this.normal[0],this.normal[1],0),F.push(fn[0],fn[1],0),k.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*Or,s[2]|0),k.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness*Or,s[2]|0),P.push.apply(P,(0,ur.Z)(this.lastFlip!==-Or?[n,n+2,n+3]:[n+2,n+1,n+3])),P.push(n+2,n+3,n+4),Gh(jv,Vh),xi.JG(this.normal,jv),F.push(this.normal[0],this.normal[1],0),k.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*Or,s[2]|0),A+=3):(this.extrusions(k,F,s,fn,Hr,this.totalDistance),P.push.apply(P,(0,ur.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Or=-1,xi.JG(this.normal,fn),A+=2),this.lastFlip=Or}else{if(Gh(this.normal,qs),q){var Nt=xi.Ue(),Ht=xi.Ue();xi.lu(Ht,qs,this.normal),xi.IH(Nt,qs,this.normal),F.push(Ht[0],Ht[1],0),F.push(Nt[0],Nt[1],0),k.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),k.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0)}else this.extrusions(k,F,s,this.normal,this.thickness,this.totalDistance);P.push.apply(P,(0,ur.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),A+=2}return A}},{key:"simpleSegment",value:function(r,n,a,s,h){var m=0,y=r.indices,b=r.positions,A=r.normals,P=Vs([s[0],s[1]]),k=Vs([a[0],a[1]]);vd(qs,P,k);var F=0;if(this.dash&&(F=this.lineSegmentDistance(P,k),this.totalDistance+=F),this.normal||(this.normal=xi.Ue(),Gh(this.normal,qs)),this.started||(this.started=!0,this.extrusions(b,A,a,this.normal,this.thickness,this.totalDistance-F)),y.push(n+0,n+1,n+2),!h)Gh(this.normal,qs),this.extrusions(b,A,s,this.normal,this.thickness,this.totalDistance),y.push.apply(y,(0,ur.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),m+=2;else{var q=Vs([h[0],h[1]]);Bm(P,q)&&xi.IH(q,P,xi.Fv(q,xi.$X(q,P,k))),vd(Vh,q,P);var oe=Fm(dd,xi.Ue(),qs,Vh,this.thickness),ue=(0,ne.Z)(oe,2),Pe=ue[0],et=ue[1],at=xi.AK(dd,this.normal)<0?-1:1;this.extrusions(b,A,s,et,Pe,this.totalDistance),y.push.apply(y,(0,ur.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),at=-1,xi.JG(this.normal,et),m+=2,this.lastFlip=at}return m}},{key:"segment",value:function(r,n,a,s,h){var m=0,y=r.indices,b=r.positions,A=r.normals,P=this.cap==="square",k=this.join==="bevel",F=Vs([s[0],s[1]]),q=Vs([a[0],a[1]]);vd(qs,F,q);var oe=0;if(this.dash&&(oe=this.lineSegmentDistance(F,q),this.totalDistance+=oe),this.normal||(this.normal=xi.Ue(),Gh(this.normal,qs)),!this.started)if(this.started=!0,P){var ue=xi.Ue(),Pe=xi.Ue();xi.IH(ue,this.normal,qs),xi.IH(Pe,this.normal,qs),A.push(Pe[0],Pe[1],0),A.push(ue[0],ue[1],0),b.push(a[0],a[1],a[2]|0,this.totalDistance-oe,-this.thickness,a[2]|0),b.push(a[0],a[1],a[2]|0,this.totalDistance-oe,this.thickness,a[2]|0)}else this.extrusions(b,A,a,this.normal,this.thickness,this.totalDistance-oe);if(y.push(n+0,n+1,n+2),h){var _t=Vs([h[0],h[1]]);Bm(F,_t)&&xi.IH(_t,F,xi.Fv(_t,xi.$X(_t,F,q))),vd(Vh,_t,F);var Nt=Fm(dd,xi.Ue(),qs,Vh,this.thickness),Ht=(0,ne.Z)(Nt,2),nr=Ht[0],mr=Ht[1],Hr=xi.AK(dd,this.normal)<0?-1:1,fn=k;if(!fn&&this.join==="miter"){var Or=nr;Or>this.miterLimit&&(fn=!0)}fn?(A.push(this.normal[0],this.normal[1],0),A.push(mr[0],mr[1],0),b.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*Hr,s[2]|0),b.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness*Hr,s[2]|0),y.push.apply(y,(0,ur.Z)(this.lastFlip!==-Hr?[n,n+2,n+3]:[n+2,n+1,n+3])),y.push(n+2,n+3,n+4),Gh(jv,Vh),xi.JG(this.normal,jv),A.push(this.normal[0],this.normal[1],0),b.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*Hr,s[2]|0),m+=3):(this.extrusions(b,A,s,mr,nr,this.totalDistance),y.push.apply(y,(0,ur.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Hr=-1,xi.JG(this.normal,mr),m+=2),this.lastFlip=Hr}else{if(Gh(this.normal,qs),P){var et=xi.Ue(),at=xi.Ue();xi.lu(at,qs,this.normal),xi.IH(et,qs,this.normal),A.push(at[0],at[1],0),A.push(et[0],et[1],0),b.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),b.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0)}else this.extrusions(b,A,s,this.normal,this.thickness,this.totalDistance);y.push.apply(y,(0,ur.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),m+=2}return m}},{key:"extrusions",value:function(r,n,a,s,h,m){n.push(s[0],s[1],0),n.push(s[0],s[1],0),r.push(a[0],a[1],a[2]|0,m,-h,a[2]|0),r.push(a[0],a[1],a[2]|0,m,h,a[2]|0)}},{key:"lineSegmentDistance",value:function(r,n){var a=n[0]-r[0],s=n[1]-r[1];return Math.sqrt(a*a+s*s)}}]),e}();function Tp(e){if(za()(e[0]))return e;if(za()(e[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(za()(e[0][0][0])){var i=e,r=0,n=0,a=0;return i.forEach(function(s){s.forEach(function(h){r+=h[0],n+=h[1],a++})}),[r/a,n/a,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}function EE(e){for(var i=e[0],r=e[1],n=e[0],a=e[1],s=0,h=0,m=0,y=0;y<e.length;y+=2){var b=e[y],A=e[y+1];b&&A&&(i=Math.max(b,i),r=Math.max(A,r),n=Math.min(b,n),a=Math.min(A,a),s+=b,h+=A,m++)}return{center:[s/m,h/m],radius:Math.sqrt(Math.pow(i-n,2)+Math.pow(r-a,2))/2}}var $a=R(77160);function SE(e){var i=e[0][0],r=e[0][e[0].length-1];i[0]===r[0]&&i[1]===r[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var n=e[0].length,a=Tf().flatten(e),s=a.vertices,h=a.dimensions,m=[],y=[],b=0;b<s.length/h;b++)h===2?m.push(s[b*2],s[b*2+1],1):m.push(s[b*3],s[b*3+1],1);var A=Tf()(a.vertices,a.holes,a.dimensions);y.push.apply(y,(0,ur.Z)(A));for(var P=function(q){var oe=a.vertices.slice(q*h,(q+1)*h),ue=a.vertices.slice((q+1)*h,(q+2)*h);ue.length===0&&(ue=a.vertices.slice(0,h));var Pe=m.length/3;m.push(oe[0],oe[1],1,ue[0],ue[1],1,oe[0],oe[1],0,ue[0],ue[1],0),y.push.apply(y,(0,ur.Z)([0,2,1,2,3,1].map(function(et){return et+Pe})))},k=0;k<n;k++)P(k);return{positions:m,index:y}}function CE(e){var i=Tf().flatten(e),r=Tf()(i.vertices,i.holes,i.dimensions);return{positions:i.vertices,index:r}}function ay(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=e[0][0],n=e[0][e[0].length-1];r[0]===n[0]&&r[1]===n[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var a=e[0].length,s=Tf().flatten(e),h=s.vertices,m=s.dimensions,y=[],b=[],A=[],P=0;P<h.length/m;P++)m===2?y.push(h[P*2],h[P*2+1],1,-1,-1):y.push(h[P*3],h[P*3+1],1,-1,-1),A.push(0,0,1);var k=Tf()(s.vertices,s.holes,s.dimensions);b.push.apply(b,(0,ur.Z)(k));for(var F=function(ue){var Pe=s.vertices.slice(ue*m,(ue+1)*m),et=s.vertices.slice((ue+1)*m,(ue+2)*m);et.length===0&&(et=s.vertices.slice(0,m));var at=y.length/5;y.push(Pe[0],Pe[1],1,0,0,et[0],et[1],1,.1,0,Pe[0],Pe[1],0,0,.8,et[0],et[1],0,.1,.8);var _t=AE([et[0],et[1],1],[Pe[0],Pe[1],0],[Pe[0],Pe[1],1],i);A.push.apply(A,(0,ur.Z)(_t).concat((0,ur.Z)(_t),(0,ur.Z)(_t),(0,ur.Z)(_t))),b.push.apply(b,(0,ur.Z)([1,2,0,3,2,1].map(function(Nt){return Nt+at})))},q=0;q<a;q++)F(q);return{positions:y,index:b,normals:A}}function AE(e,i,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,a=$a.create(),s=$a.create(),h=$a.create();n&&(e=Lu(e),i=Lu(i),r=Lu(r));var m=$a.fromValues.apply($a,(0,ur.Z)(e)),y=$a.fromValues.apply($a,(0,ur.Z)(i)),b=$a.fromValues.apply($a,(0,ur.Z)(r));$a.sub(a,b,y),$a.sub(s,m,y),$a.cross(h,a,s);var A=$a.create();return $a.normalize(A,h),A}var gc,Mp;(function(e){e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn"})(Mp||(Mp={}));var Pp;(function(e){e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon"})(Pp||(Pp={}));function nv(e){for(var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=Math.PI*2/e,n=[],a=0;a<e;a++)n.push(r*a+i*Math.PI/12);var s=n.map(function(h){var m=Math.sin(h+Math.PI/4),y=Math.cos(h+Math.PI/4);return[m,y,0]});return s}function oy(){return nv(30)}function sy(){return nv(4)}function uy(){return nv(3)}function ly(){return nv(6,1)}function cy(){return nv(5)}var md=(gc={},(0,I.Z)(gc,Pp.CIRCLE,oy),(0,I.Z)(gc,Pp.HEXAGON,ly),(0,I.Z)(gc,Pp.TRIANGLE,uy),(0,I.Z)(gc,Pp.SQUARE,sy),(0,I.Z)(gc,Pp.PENTAGON,cy),(0,I.Z)(gc,Mp.CYLINDER,oy),(0,I.Z)(gc,Mp.HEXAGONCOLUMN,ly),(0,I.Z)(gc,Mp.TRIANGLECOLUMN,uy),(0,I.Z)(gc,Mp.SQUARECOLUMN,sy),(0,I.Z)(gc,Mp.PENTAGONCOLUMN,cy),gc),Vv={};function fy(e){var i=Tp(e.coordinates);return{vertices:[].concat((0,ur.Z)(i),(0,ur.Z)(i),(0,ur.Z)(i),(0,ur.Z)(i)),indices:[0,1,2,2,3,0],size:i.length}}function wE(e){var i=Tp(e.coordinates),r=ny(i);return{vertices:[].concat((0,ur.Z)(r),(0,ur.Z)(r),(0,ur.Z)(r),(0,ur.Z)(r)),indices:[0,1,2,2,3,0],size:r.length}}function hy(e){var i=e.shape,r=RE(i,!1),n=r.positions,a=r.index,s=r.normals;return{vertices:n,indices:a,normals:s,size:5}}function py(e){var i=Tp(e.coordinates);return{vertices:(0,ur.Z)(i),indices:[0],size:i.length}}function dy(e){var i=e.coordinates,r=e.originCoordinates,n=e.version,a=new iy({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var s=i;Array.isArray(s[0][0])||(s=[i]);var h=r;Array.isArray(h[0][0])||(h=[r]);for(var m=0;m<s.length;m++){var y=s[m],b=h[m];a.extrude_gaode2(y,b)}}else{var A=i;Array.isArray(A[0][0])||(A=[i]),A.forEach(function(k){a.extrude(k)})}var P=a.complex;return{vertices:P.positions,indices:P.indices,normals:P.normals,size:6}}function TE(e){var i=e.coordinates,r=e.originCoordinates,n=e.version,a=new iy({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var s=i;Array.isArray(s[0][0])||(s=[i]);var h=r;Array.isArray(h[0][0])||(h=[r]);for(var m=0;m<s.length;m++){var y=s[m],b=h[m];a.simpleExtrude_gaode2(y,b)}}else{var A=i;Array.isArray(A[0][0])||(A=[i]),A.forEach(function(k){a.simpleExtrude(k)})}var P=a.complex;return{vertices:P.positions,indices:P.indices,normals:P.normals,size:6}}function ME(e){var i=e.coordinates,r=Tf().flatten(i),n=r.vertices,a=r.dimensions,s=r.holes;return{indices:Tf()(n,s,a),vertices:n,size:a}}function PE(e){var i=e.coordinates,r=Tf().flatten(i),n=r.vertices,a=r.dimensions,s=r.holes;return{indices:Tf()(n,s,a),vertices:IE(n),size:a+4}}function IE(e){for(var i=[],r=EE(e),n=r.center,a=r.radius,s=0;s<e.length;s+=2){var h=e[s],m=e[s+1];i.push.apply(i,[h,m,0].concat((0,ur.Z)(n),[a]))}return i}function vy(e){var i=e.coordinates,r=ay(i,!0),n=r.positions,a=r.index,s=r.normals;return{vertices:n,indices:a,normals:s,size:5}}function gy(e){var i=e.shape,r=kE(i),n=r.positions,a=r.index;return{vertices:n,indices:a,size:3}}function yy(e){var i=e.coordinates,r=[].concat((0,ur.Z)(i[0]),[0,0,1,i[1][0],i[0][1],0,1,1],(0,ur.Z)(i[1]),[0,1,0],(0,ur.Z)(i[0]),[0,0,1],(0,ur.Z)(i[1]),[0,1,0,i[0][0],i[1][1],0,0,0]),n=[0,1,2,3,4,5];return{vertices:r,indices:n,size:5}}function Gv(e,i){for(var r=i||30,n=e.coordinates,a=[],s=[],h=function(b){a.push(b,1,b,n[0][0],n[0][1],n[1][0],n[1][1],b,-1,b,n[0][0],n[0][1],n[1][0],n[1][1]),b!==r-1&&s.push.apply(s,(0,ur.Z)([0,1,2,1,3,2].map(function(A){return b*2+A})))},m=0;m<r;m++)h(m);return{vertices:a,indices:s,size:7}}function OE(e){var i=e.coordinates;i.length===2&&i.push(0);var r=e.size,n=Hv(-1,1),a=Hv(1,1),s=Hv(-1,-1),h=Hv(1,-1),m=[].concat((0,ur.Z)(i),(0,ur.Z)(n),(0,ur.Z)(i),(0,ur.Z)(s),(0,ur.Z)(i),(0,ur.Z)(h),(0,ur.Z)(i),(0,ur.Z)(a)),y=[0,1,2,3,0,2];return{vertices:m,indices:y,size:5}}function RE(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(Vv&&Vv[e])return Vv[e];var r=md[e]?md[e]():md.cylinder(),n=ay([r],i);return Vv[e]=n,n}function j5(e,i){for(var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,a=new Float32Array(e.length/r*3),s,h,m,y=vec3.create(),b=vec3.create(),A=vec3.create(),P=0,k=i.length;P<k;P+=3){s=i[P+0]*3,h=i[P+1]*3,m=i[P+2]*3;var F=[e[s],e[s+1]],q=[e[h],e[h+1]],oe=[e[m],e[m+1]];n&&(F=lngLatToMeters(F),q=lngLatToMeters(q),oe=lngLatToMeters(oe));var ue=F,Pe=_slicedToArray(ue,2),et=Pe[0],at=Pe[1],_t=vec3.fromValues(et,at,e[s+2]),Nt=q,Ht=_slicedToArray(Nt,2),nr=Ht[0],mr=Ht[1],Hr=vec3.fromValues(nr,mr,e[h+2]),fn=oe,Or=_slicedToArray(fn,2),Tn=Or[0],zn=Or[1],gi=vec3.fromValues(Tn,zn,e[m+2]);vec3.sub(y,gi,Hr),vec3.sub(b,_t,Hr),vec3.cross(A,y,b),a[s]+=y[0],a[s+1]+=y[1],a[s+2]+=y[2],a[h]+=y[0],a[h+1]+=y[1],a[h+2]+=y[2],a[m]+=y[0],a[m+1]+=y[1],a[m+2]+=y[2]}return LE(a),a}function LE(e){for(var i=0,r=e.length;i<r;i+=3){var n=vec3.fromValues(e[i],e[i+1],e[i+2]),a=vec3.create();vec3.normalize(a,n),e.set(a,i)}}function V5(e){var i=e[0][0],r=e[0][e[0].length-1];return i[0]===r[0]&&i[1]===r[1]}function kE(e){var i=["cylinder","triangleColumn","hexagonColumn","squareColumn"],r=md[e]?md[e]():md.circle(),n=i.indexOf(e)===-1?CE([r]):SE([r]);return n}function Hv(e,i){var r=(e+1)/2,n=(i+1)/2;return[r,n]}function G5(){var e=primitiveSphere(EARTH_RADIUS,{segments:EARTH_SEGMENTS}),i=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:i,indices:r,size:5,normals:n}}function H5(){var e=primitiveSphere(EARTH_RADIUS+EARTH_RADIUS_OUTER,{segments:EARTH_SEGMENTS}),i=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:i,indices:r,size:5,normals:n}}function DE(e){var i=FE();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function FE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var BE=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

uniform float u_circleSweep;
uniform float u_cityMinSize;
uniform vec3 u_circleSweepColor;
uniform float u_circleSweepSpeed;

varying float v_worldDis;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }


  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {
    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);
    gl_FragColor.rgb += r * r * u_circleSweepColor;
  }
   
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,NE=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;
uniform mat4 u_Mvp;

uniform float u_circleSweep;
uniform vec2 u_cityCenter;

varying float v_worldDis;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"


void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

   v_texCoord = a_Uv;

  if(u_circleSweep > 0.0) {
     vec2 lnglatscale = vec2(0.0);
    if(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {
      lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);
    }
    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);
  }
 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,zE=function(e){(0,pn.Z)(r,e);var i=DE(r);function r(){var n;(0,lt.Z)(this,r);for(var a=arguments.length,s=new Array(a),h=0;h<a;h++)s[h]=arguments[h];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,xe.Z)(n),"cityCenter",void 0),(0,I.Z)((0,xe.Z)(n),"cityMinSize",void 0),n}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,h=s===void 0?1:s,m=a.baseColor,y=m===void 0?"rgb(16,16,16)":m,b=a.brightColor,A=b===void 0?"rgb(255,176,38)":b,P=a.windowColor,k=P===void 0?"rgb(30,60,89)":P,F=a.time,q=F===void 0?0:F,oe=a.sweep,ue=oe===void 0?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}:oe;return{u_cityCenter:ue.sweepCenter||this.cityCenter,u_cityMinSize:this.cityMinSize*ue.sweepRadius,u_circleSweep:ue.enable?1:0,u_circleSweepColor:Be(ue.sweepColor).slice(0,3),u_circleSweepSpeed:ue.sweepSpeed,u_opacity:h,u_baseColor:Be(y),u_brightColor:Be(A),u_windowColor:Be(k),u_time:this.layer.getLayerAnimateTime()||q}}},{key:"calCityGeo",value:function(){var a=(0,ne.Z)(this.layer.getSource().extent,4),s=a[0],h=a[1],m=a[2],y=a[3];if(this.mapService.version==="GAODE2.x"){this.cityCenter=this.mapService.lngLatToCoord([(m+s)/2,(y+h)/2]);var b=this.mapService.lngLatToCoord([m,y]),A=this.mapService.lngLatToCoord([s,h]);this.cityMinSize=Math.sqrt(Math.pow(b[0]-A[0],2)+Math.pow(b[1]-A[1],2))/4}else{var P=m-s,k=y-h;this.cityCenter=[(m+s)/2,(y+h)/2],this.cityMinSize=Math.sqrt(Math.pow(P,2)+Math.pow(k,2))/4}}},{key:"initModels",value:function(){return this.calCityGeo(),this.startModelAnimate(),[this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:NE,fragmentShader:BE,triangulation:vy})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:Jn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:ee.STATIC_DRAW,data:[],type:ee.FLOAT},size:3,update:function(s,h,m,y,b){return b}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Jn.Attribute,descriptor:{name:"a_Size",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:1,update:function(s,h,m,y){var b=s.size,A=b===void 0?10:b;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Jn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:2,update:function(s,h,m,y){var b=s.size;return[m[3],m[4]]}}})}}]),r}(bs);function UE(e){var i=ZE();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function ZE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var jE=function(e){(0,pn.Z)(r,e);var i=UE(r);function r(){var n;(0,lt.Z)(this,r);for(var a=arguments.length,s=new Array(a),h=0;h<a;h++)s[h]=arguments[h];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,xe.Z)(n),"type","PolygonLayer"),n}return(0,It.Z)(r,[{key:"buildModels",value:function(){this.layerModel=new zE(this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"setLight",value:function(a){this.updateLayerConfig({time:a})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"citybuilding"}}]),r}(wp);function VE(e){var i=GE();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function GE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var HE=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
uniform mat4 u_Mvp;\r
varying vec4 v_color;\r
\r
uniform vec2 u_SceneCenterMKT;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,WE=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,XE=function(e){(0,pn.Z)(r,e);var i=VE(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,h=a.coverage,m=a.angle;return{u_opacity:s||1,u_coverage:h||.9,u_angle:m||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,h=s===void 0?!1:s,m=a.maskInside,y=m===void 0?!0:m;return[this.layer.buildLayerModel({moduleName:"gridheatmap",vertexShader:HE,fragmentShader:WE,triangulation:gy,depth:{enable:!1},primitive:ee.TRIANGLES,blend:this.getBlend(),stencil:Ot(h,y)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:Jn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:3,update:function(s,h){var m=s.version==="GAODE2.x"?s.originCoordinates:s.coordinates;return[m[0],m[1],0]}}})}}]),r}(bs);function YE(e){var i=qE();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function qE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var KE=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
  // vec2 lnglat = (a_Pos.xy + offset); 
  // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
  // gl_Position = project_common_position_to_clipspace(project_pos);
  // float lightWeight = calc_lighting(project_pos);
  // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 lnglat = (a_Pos.xy + offset); 
    // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));

    // float lightWeight = calc_lighting(project_pos);
    // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    // gl_Position = u_Mvp * vec4(lnglat , a_Position.z * a_Size, 1.0);
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,$E=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,JE=function(e){(0,pn.Z)(r,e);var i=YE(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,h=a.coverage,m=a.angle;return{u_opacity:s||1,u_coverage:h||1,u_angle:m||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,h=s===void 0?!1:s,m=a.maskInside,y=m===void 0?!0:m;return[this.layer.buildLayerModel({moduleName:"grid3dheatmap",vertexShader:KE,fragmentShader:$E,triangulation:hy,depth:{enable:!0},blend:this.getBlend(),stencil:Ot(h,y)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Jn.Attribute,descriptor:{name:"a_Size",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:1,update:function(s,h,m,y){var b=s.size;return Array.isArray(b)?[b[0]]:[b]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Jn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:ee.STATIC_DRAW,data:[],type:ee.FLOAT},size:3,update:function(s,h,m,y,b){return b}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Jn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:3,update:function(s,h){var m=s.version==="GAODE2.x"?s.originCoordinates:s.coordinates;return[m[0],m[1],0]}}})}}]),r}(bs);function QE(e,i){for(var r=[],n=[],a=[],s=e+1,h=i+1,m=e/2,y=i/2,b=0;b<h;b++)for(var A=b-y,P=0;P<s;P++){var k=P-m;n.push(k/m,-A/y,0),a.push(P/e),a.push(1-b/i)}for(var F=0;F<i;F++)for(var q=0;q<e;q++){var oe=q+s*F,ue=q+s*(F+1),Pe=q+1+s*(F+1),et=q+1+s*F;r.push(oe,ue,et),r.push(ue,Pe,et)}return{vertices:n,indices:r,uvs:a}}var _y,xy;function by(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Ey(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?by(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):by(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function eS(e){var i=tS();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function tS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var rS=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,nS=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,iS=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,aS=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,oS=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,sS=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
varying float v_intensity;
void main() {
  v_texCoord = a_Uv;
  v_intensity = texture2D(u_texture, v_texCoord).r;
  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,Sy=(_y=(0,Lr.b2)(),_y(xy=function(e){(0,pn.Z)(r,e);var i=eS(r);function r(){var n;(0,lt.Z)(this,r);for(var a=arguments.length,s=new Array(a),h=0;h<a;h++)s[h]=arguments[h];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,xe.Z)(n),"texture",void 0),(0,I.Z)((0,xe.Z)(n),"colorTexture",void 0),(0,I.Z)((0,xe.Z)(n),"heatmapFramerBuffer",void 0),(0,I.Z)((0,xe.Z)(n),"intensityModel",void 0),(0,I.Z)((0,xe.Z)(n),"colorModel",void 0),(0,I.Z)((0,xe.Z)(n),"shapeType",void 0),n}return(0,It.Z)(r,[{key:"render",value:function(){var a=this,s=this.rendererService,h=s.clear,m=s.useFramebuffer;m(this.heatmapFramerBuffer,function(){h({color:[0,0,0,0],depth:1,stencil:0,framebuffer:a.heatmapFramerBuffer}),a.drawIntensityMode()}),this.layer.styleNeedUpdate&&this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var a,s=this.rendererService,h=s.createFramebuffer,m=s.clear,y=s.getViewportSize,b=s.createTexture2D,A=s.useFramebuffer,P=this.styleAttributeService.getLayerStyleAttribute("shape"),k=(P==null||(a=P.scale)===null||a===void 0?void 0:a.field)||"heatmap";this.shapeType=k,this.intensityModel=this.buildHeatMapIntensity(),this.colorModel=k==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap();var F=y(),q=F.width,oe=F.height;return this.heatmapFramerBuffer=h({color:b({width:Math.floor(q/4),height:Math.floor(oe/4),wrapS:ee.CLAMP_TO_EDGE,wrapT:ee.CLAMP_TO_EDGE,min:ee.LINEAR,mag:ee.LINEAR}),depth:!1}),this.updateColorTexture(),[this.intensityModel,this.colorModel]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:Jn.Attribute,descriptor:{name:"a_Dir",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:2,update:function(s,h,m,y){return[m[3],m[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Jn.Attribute,descriptor:{name:"a_Size",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:1,update:function(s,h,m,y){var b=s.size,A=b===void 0?1:b;return[A]}}})}},{key:"buildHeatMapIntensity",value:function(){return this.layer.buildLayerModel({moduleName:"heatmapintensity",vertexShader:oS,fragmentShader:aS,triangulation:OE,depth:{enable:!1},blend:{enable:!0,func:{srcRGB:ee.ONE,srcAlpha:1,dstRGB:ee.ONE,dstAlpha:1}}})}},{key:"buildHeatmapColor",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,h=s===void 0?!1:s,m=a.maskInside,y=m===void 0?!0:m;this.shaderModuleService.registerModule("heatmapColor",{vs:sS,fs:iS});var b=this.shaderModuleService.getModule("heatmapColor"),A=b.vs,P=b.fs,k=b.uniforms,F=this.rendererService,q=F.createAttribute,oe=F.createElements,ue=F.createBuffer,Pe=F.createModel;return Pe({vs:A,fs:P,attributes:{a_Position:q({buffer:ue({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:ee.FLOAT}),size:3}),a_Uv:q({buffer:ue({data:[0,1,1,1,0,0,1,0],type:ee.FLOAT}),size:2})},uniforms:Ey({},k),depth:{enable:!1},blend:this.getBlend(),count:6,elements:oe({data:[0,2,1,2,3,1],type:ee.UNSIGNED_INT,count:6}),stencil:Ot(h,y)})}},{key:"drawIntensityMode",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,h=a.intensity,m=h===void 0?10:h,y=a.radius,b=y===void 0?5:y;this.intensityModel.draw({uniforms:{u_opacity:s||1,u_radius:b,u_intensity:m}})}},{key:"drawColorMode",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity;this.colorModel.draw({uniforms:{u_opacity:s||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,h=Sr();br(h,this.cameraService.getViewProjectionMatrixUncentered()),this.colorModel.draw({uniforms:{u_opacity:s||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,ur.Z)(h)}})}},{key:"build3dHeatMap",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,h=s===void 0?!1:s,m=a.maskInside,y=m===void 0?!0:m,b=this.rendererService.getViewportSize,A=b(),P=A.width,k=A.height,F=QE(P/4,k/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:nS,fs:rS});var q=this.shaderModuleService.getModule("heatmap3dColor"),oe=q.vs,ue=q.fs,Pe=q.uniforms,et=this.rendererService,at=et.createAttribute,_t=et.createElements,Nt=et.createBuffer,Ht=et.createModel;return Ht({vs:oe,fs:ue,attributes:{a_Position:at({buffer:Nt({data:F.vertices,type:ee.FLOAT}),size:3}),a_Uv:at({buffer:Nt({data:F.uvs,type:ee.FLOAT}),size:2})},primitive:ee.TRIANGLES,uniforms:Ey({},Pe),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:ee.SRC_ALPHA,srcAlpha:1,dstRGB:ee.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:_t({data:F.indices,type:ee.UNSIGNED_INT,count:F.indices.length}),stencil:Ot(h,y)})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var a=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var s=this.layer.getLayerConfig(),h=s.rampColors,m=rt(h);this.colorTexture=a({data:new Uint8Array(m.data),width:m.width,height:m.height,wrapS:ee.CLAMP_TO_EDGE,wrapT:ee.CLAMP_TO_EDGE,min:ee.NEAREST,mag:ee.NEAREST,flipY:!1})}}]),r}(bs))||xy);function uS(e){var i=lS();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function lS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var cS=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,fS=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,hS=function(e){(0,pn.Z)(r,e);var i=uS(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,h=a.coverage,m=a.angle;return{u_opacity:s||1,u_coverage:h||.9,u_angle:m||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,h=s===void 0?!1:s,m=a.maskInside,y=m===void 0?!0:m;return[this.layer.buildLayerModel({moduleName:"hexagonheatmap",vertexShader:fS,fragmentShader:cS,triangulation:gy,depth:{enable:!1},primitive:ee.TRIANGLES,blend:this.getBlend(),stencil:Ot(h,y)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:Jn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:3,update:function(s,h){var m=s.version==="GAODE2.x"?s.originCoordinates:s.coordinates;return[m[0],m[1],0]}}})}}]),r}(bs),pS={heatmap:Sy,heatmap3d:Sy,grid:XE,grid3d:JE,hexagon:hS},dS=pS;function vS(e){var i=mS();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function mS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var gS=function(e){(0,pn.Z)(r,e);var i=vS(r);function r(){var n;(0,lt.Z)(this,r);for(var a=arguments.length,s=new Array(a),h=0;h<a;h++)s[h]=arguments[h];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,xe.Z)(n),"type","HeatMapLayer"),n}return(0,It.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new dS[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"renderModels",value:function(){var a=this,s=this.getModelType();return s==="heatmap"?(this.layerModel&&this.layerModel.render(),this):(this.layerModelNeedUpdate&&(this.models=this.layerModel.buildModels(),this.layerModelNeedUpdate=!1),this.models.forEach(function(h){return h.draw({uniforms:a.layerModel.getUninforms()})}),this)}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var a,s=this.styleAttributeService.getLayerStyleAttribute("shape"),h=this.getLayerConfig(),m=h.shape3d,y=this.getSource(),b=y.data.type,A=(s==null||(a=s.scale)===null||a===void 0?void 0:a.field)||"heatmap";return A==="heatmap"||A==="heatmap3d"?"heatmap":b==="hexagon"?(m==null?void 0:m.indexOf(A))===-1?"hexagon":"grid3d":b==="grid"?(m==null?void 0:m.indexOf(A))===-1?"grid":"grid3d":"heatmap"}}]),r}(wp);function yS(e){var i=_S();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function _S(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xS=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,bS=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,ES=function(e){(0,pn.Z)(r,e);var i=yS(r);function r(){var n;(0,lt.Z)(this,r);for(var a=arguments.length,s=new Array(a),h=0;h<a;h++)s[h]=arguments[h];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,xe.Z)(n),"texture",void 0),n}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity;return{u_opacity:s||1,u_texture:this.texture}}},{key:"initModels",value:function(){var a=this,s=this.layer.getLayerConfig(),h=s.mask,m=h===void 0?!1:h,y=s.maskInside,b=y===void 0?!0:y,A=this.layer.getSource(),P=this.rendererService.createTexture2D;if(this.texture=P({height:0,width:0}),wo){var k=this.layerService.sceneService.getSceneConfig().canvas,F=k.createImage();F.crossOrigin="anonymous",F.src=A.data.originData,F.onload=function(){a.texture=P({data:F,width:F.width,height:F.height}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()}}else A.data.images.then(function(q){a.texture=P({data:q[0],width:q[0].width,height:q[0].height}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()});return[this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:bS,fragmentShader:xS,triangulation:yy,primitive:ee.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:Ot(m,b)})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Jn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:2,update:function(s,h,m,y){return[m[3],m[4]]}}})}}]),r}(bs),SS={image:ES},CS=SS;function AS(e){var i=wS();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function wS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var TS=function(e){(0,pn.Z)(r,e);var i=AS(r);function r(){var n;(0,lt.Z)(this,r);for(var a=arguments.length,s=new Array(a),h=0;h<a;h++)s[h]=arguments[h];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,xe.Z)(n),"type","ImageLayer"),n}return(0,It.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new CS[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={image:{}};return s[a]}},{key:"getModelType",value:function(){return"image"}}]),r}(wp);function MS(e){var i=PS();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function PS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var IS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }
  
  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = styleMappingMat[3].g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = styleMappingMat[3].a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(gl_FragColor);
}`,OS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;

uniform float u_thetaOffset: 0.314;
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  if(u_line_type == LineTypeDash) {
      d_distance_ratio = segmentIndex / segmentNumber;

      vec2 s = source;
      vec2 t = target;
      
      if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        s = unProjCustomCoord(source);
        t = unProjCustomCoord(target);
      }
      float total_Distance = pixelDistance(s, t) / 2.0 * PI;
      // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
      v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  
  if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
     styleMappingMat[3].g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
     styleMappingMat[3].a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,RS={solid:0,dash:1},LS=function(e){(0,pn.Z)(r,e);var i=MS(r);function r(){var n;(0,lt.Z)(this,r);for(var a=arguments.length,s=new Array(a),h=0;h<a;h++)s[h]=arguments[h];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,xe.Z)(n),"texture",void 0),(0,I.Z)((0,xe.Z)(n),"updateTexture",function(){var m=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=m({data:n.iconService.getCanvas(),mag:ee.NEAREST,min:ee.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,h=a.sourceColor,m=a.targetColor,y=a.textureBlend,b=y===void 0?"normal":y,A=a.lineType,P=A===void 0?"solid":A,k=a.dashArray,F=k===void 0?[10,5]:k,q=a.forward,oe=q===void 0?!0:q,ue=a.lineTexture,Pe=ue===void 0?!1:ue,et=a.iconStep,at=et===void 0?100:et,_t=a.segmentNumber,Nt=_t===void 0?30:_t,Ht=a.thetaOffset,nr=Ht===void 0?.314:Ht;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s,thetaOffset:nr})){this.judgeStyleAttributes({opacity:s,thetaOffset:nr});var mr=this.layer.getEncodedData(),Hr=this.calDataFrame(this.cellLength,mr,this.cellProperties),fn=Hr.data,Or=Hr.width,Tn=Hr.height;this.rowCount=Tn,this.dataTexture=this.cellLength>0&&fn.length>0?this.createTexture2D({flipY:!0,data:fn,format:ee.LUMINANCE,type:ee.FLOAT,width:Or,height:Tn}):this.createTexture2D({flipY:!0,data:[1],format:ee.LUMINANCE,type:ee.FLOAT,width:1,height:1})}F.length===2&&F.push(0,0);var zn=0,gi=[0,0,0,0],io=[0,0,0,0];return h&&m&&(gi=Be(h),io=Be(m),zn=1),this.rendererService.getDirty()&&this.texture.bind(),{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_thetaOffset:za()(nr)?nr:0,u_opacity:za()(s)?s:1,u_textureBlend:b==="normal"?0:1,segmentNumber:Nt,u_line_type:RS[P||"solid"],u_dash_array:F,u_blur:.9,u_lineDir:oe?1:-1,u_texture:this.texture,u_line_texture:Pe?1:0,u_icon_step:at,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:zn,u_sourceColor:gi,u_targetColor:io}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.segmentNumber,h=s===void 0?30:s,m=a.mask,y=m===void 0?!1:m,b=a.maskInside,A=b===void 0?!0:b;return[this.layer.buildLayerModel({moduleName:"arc2dline",vertexShader:OS,fragmentShader:IS,triangulation:Gv,depth:{enable:!1},blend:this.getBlend(),segmentNumber:h,stencil:Ot(y,A)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Jn.Attribute,descriptor:{name:"a_Size",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:1,update:function(h,m,y,b){var A=h.size,P=A===void 0?1:A;return Array.isArray(P)?[P[0]]:[P]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Jn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:ee.STATIC_DRAW,data:[],type:ee.FLOAT},size:4,update:function(h,m,y,b){return[y[3],y[4],y[5],y[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Jn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:2,update:function(h,m,y,b){var A=a.iconService.getIconMap(),P=h.texture,k=A[P]||{x:0,y:0},F=k.x,q=k.y;return[F,q]}}})}}]),r}(bs);function kS(e){var i=DS();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function DS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var FS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,BS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,NS={solid:0,dash:1},zS=function(e){(0,pn.Z)(r,e);var i=kS(r);function r(){var n;(0,lt.Z)(this,r);for(var a=arguments.length,s=new Array(a),h=0;h<a;h++)s[h]=arguments[h];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,xe.Z)(n),"texture",void 0),(0,I.Z)((0,xe.Z)(n),"updateTexture",function(){var m=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=m({data:n.iconService.getCanvas(),mag:ee.NEAREST,min:ee.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,h=a.sourceColor,m=a.targetColor,y=a.textureBlend,b=y===void 0?"normal":y,A=a.lineType,P=A===void 0?"solid":A,k=a.dashArray,F=k===void 0?[10,5]:k,q=a.lineTexture,oe=q===void 0?!1:q,ue=a.iconStep,Pe=ue===void 0?100:ue,et=a.segmentNumber,at=et===void 0?30:et,_t=a.globalArcHeight,Nt=_t===void 0?10:_t;F.length===2&&F.push(0,0);var Ht=0,nr=[0,0,0,0],mr=[0,0,0,0];if(h&&m&&(nr=Be(h),mr=Be(m),Ht=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var Hr=this.layer.getEncodedData(),fn=this.calDataFrame(this.cellLength,Hr,this.cellProperties),Or=fn.data,Tn=fn.width,zn=fn.height;this.rowCount=zn,this.dataTexture=this.cellLength>0&&Or.length>0?this.createTexture2D({flipY:!0,data:Or,format:ee.LUMINANCE,type:ee.FLOAT,width:Tn,height:zn}):this.createTexture2D({flipY:!0,data:[1],format:ee.LUMINANCE,type:ee.FLOAT,width:1,height:1})}return{u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:ty,u_global_height:Nt,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:za()(s)?s:1,u_textureBlend:b==="normal"?0:1,segmentNumber:at,u_line_type:NS[P]||0,u_dash_array:F,u_texture:this.texture,u_line_texture:oe?1:0,u_icon_step:Pe,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Ht,u_sourceColor:nr,u_targetColor:mr}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.segmentNumber,h=s===void 0?30:s,m=a.mask,y=m===void 0?!1:m,b=a.maskInside,A=b===void 0?!0:b;return[this.layer.buildLayerModel({moduleName:"arc3Dline",vertexShader:BS,fragmentShader:FS,triangulation:Gv,blend:this.getBlend(),segmentNumber:h,stencil:Ot(y,A)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Jn.Attribute,descriptor:{name:"a_Size",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:1,update:function(h,m,y,b){var A=h.size,P=A===void 0?1:A;return Array.isArray(P)?[P[0]]:[P]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Jn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:ee.STATIC_DRAW,data:[],type:ee.FLOAT},size:4,update:function(h,m,y,b){return[y[3],y[4],y[5],y[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Jn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:2,update:function(h,m,y,b){var A=a.iconService.getIconMap(),P=h.texture,k=A[P]||{x:0,y:0},F=k.x,q=k.y;return[F,q]}}})}}]),r}(bs);function US(e){var i=ZS();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function ZS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var jS=`#define LineTypeSolid 0.0
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
// varying vec2 v_normal;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float segmentNumber;
varying float v_distance_ratio;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }
  
 
  gl_FragColor.a *= u_opacity;

  if(u_aimate.x == Animate) {
      float animateSpeed = u_time / u_aimate.y; // \u8FD0\u52A8\u901F\u5EA6
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }
}`,VS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

uniform float u_lineDir: 1.0;

// \u504F\u79FB\u91CF
uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying float v_distance_ratio;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = u_thetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;
  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  v_distance_ratio = segmentIndex / segmentNumber;
  
  if(u_aimate.x == Animate && u_lineDir != 1.0) {
      v_distance_ratio = 1.0 - v_distance_ratio;
  }

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
}
`,GS=function(e){(0,pn.Z)(r,e);var i=US(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,h=a.sourceColor,m=a.targetColor,y=a.forward,b=y===void 0?!0:y,A=a.segmentNumber,P=A===void 0?30:A,k=a.thetaOffset,F=k===void 0?.314:k,q=0,oe=[0,0,0,0],ue=[0,0,0,0];return h&&m&&(oe=Be(h),ue=Be(m),q=1),{u_thetaOffset:F,u_opacity:za()(s)?s:1,segmentNumber:P,u_blur:.9,u_lineDir:b?1:-1,u_linearColor:q,u_sourceColor:oe,u_targetColor:ue}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.segmentNumber,h=s===void 0?30:s;return[this.layer.buildLayerModel({moduleName:"arc2dminiline",vertexShader:VS,fragmentShader:jS,triangulation:Gv,depth:{enable:!1},blend:this.getBlend(),segmentNumber:h})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Jn.Attribute,descriptor:{name:"a_Size",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:1,update:function(s,h,m,y){var b=s.size,A=b===void 0?1:b;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Jn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:ee.STATIC_DRAW,data:[],type:ee.FLOAT},size:4,update:function(s,h,m,y){return[m[3],m[4],m[5],m[6]]}}})}}]),r}(bs);function HS(e){var i=WS();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function WS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var XS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0;
  float d_segmentIndex = styleMappingMat[3].g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- smoothstep(0.0, 1.0, v_distance_ratio), u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = styleMappingMat[3].a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,YS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*8.0;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba);
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  styleMappingMat[3].g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
    styleMappingMat[3].b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,qS={solid:0,dash:1},KS=function(e){(0,pn.Z)(r,e);var i=HS(r);function r(){var n;(0,lt.Z)(this,r);for(var a=arguments.length,s=new Array(a),h=0;h<a;h++)s[h]=arguments[h];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,xe.Z)(n),"texture",void 0),(0,I.Z)((0,xe.Z)(n),"updateTexture",function(){var m=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=m({data:n.iconService.getCanvas(),mag:ee.NEAREST,min:ee.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,h=a.sourceColor,m=a.targetColor,y=a.textureBlend,b=y===void 0?"normal":y,A=a.lineType,P=A===void 0?"solid":A,k=a.dashArray,F=k===void 0?[10,5]:k,q=a.lineTexture,oe=q===void 0?!1:q,ue=a.iconStep,Pe=ue===void 0?100:ue,et=a.segmentNumber,at=et===void 0?30:et;F.length===2&&F.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var _t=0,Nt=[0,0,0,0],Ht=[0,0,0,0];if(h&&m&&(Nt=Be(h),Ht=Be(m),_t=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var nr=this.layer.getEncodedData(),mr=this.calDataFrame(this.cellLength,nr,this.cellProperties),Hr=mr.data,fn=mr.width,Or=mr.height;this.rowCount=Or,this.dataTexture=this.cellLength>0&&Hr.length>0?this.createTexture2D({flipY:!0,data:Hr,format:ee.LUMINANCE,type:ee.FLOAT,width:fn,height:Or}):this.createTexture2D({flipY:!0,data:[1],format:ee.LUMINANCE,type:ee.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:za()(s)?s:1,u_textureBlend:b==="normal"?0:1,segmentNumber:at,u_line_type:qS[P]||0,u_dash_array:F,u_texture:this.texture,u_line_texture:oe?1:0,u_icon_step:Pe,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:_t,u_sourceColor:Nt,u_targetColor:Ht}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,h=s===void 0?!1:s,m=a.maskInside,y=m===void 0?!0:m;return[this.layer.buildLayerModel({moduleName:"greatcircleline",vertexShader:YS,fragmentShader:XS,triangulation:Gv,depth:{enable:!1},blend:this.getBlend(),stencil:Ot(h,y)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Jn.Attribute,descriptor:{name:"a_Size",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:1,update:function(h,m,y,b){var A=h.size,P=A===void 0?1:A;return Array.isArray(P)?[P[0]]:[P]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Jn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:ee.STATIC_DRAW,data:[],type:ee.FLOAT},size:4,update:function(h,m,y,b){return[y[3],y[4],y[5],y[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Jn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:2,update:function(h,m,y,b){var A=a.iconService.getIconMap(),P=h.texture,k=A[P]||{x:0,y:0},F=k.x,q=k.y;return[F,q]}}})}}]),r}(bs);function $S(e){var i=JS();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function JS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var QS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_line_type: 0.0;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;

uniform float u_borderWidth: 0.0;
uniform vec4 u_borderColor;
varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

// dash
uniform float u_dash_offset : 0.0;
uniform float u_dash_ratio : 0.1;
varying vec4 v_dash_array;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }
 // dash line
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor += pattern;
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = pattern;
    }
  } 

    float v = styleMappingMat[3].a;
    float borderWidth = min(0.5, u_borderWidth);
    // \u7ED8\u5236 border
    if(borderWidth > 0.01) {
      float borderOuterWidth = borderWidth/2.0;

      if(v >= 1.0 - borderWidth || v <= borderWidth) {
        if(v > borderWidth) {
          float linear = smoothstep(0.0, 1.0, (v - (1.0 - borderWidth))/borderWidth);
          gl_FragColor.rgb = mix(gl_FragColor.rgb, u_borderColor.rgb, linear);
        } else if(v <= borderWidth) {
          float linear = smoothstep(0.0, 1.0, v/borderWidth);
          gl_FragColor.rgb = mix(u_borderColor.rgb, gl_FragColor.rgb, linear);
        }
      }

      if(v < borderOuterWidth) {
        gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);
      } else if(v > 1.0 - borderOuterWidth) {
        gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
      }
    }

    gl_FragColor = filterColor(gl_FragColor);
}
`,eC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

uniform float u_vertexScale: 1.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_line_type == LineTypeDash) {
    d_distance_ratio = a_Distance / a_Total_Distance;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  }
  if(u_aimate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }
  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);

  vec2 offset = project_pixel(size.xy);

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, project_pixel(a_Size.y) + h * 0.2, 1.0));
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      h *= 2.0/pow(2.0, 20.0 - u_Zoom);
    }

    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,tC={solid:0,dash:1},Cy=function(e){(0,pn.Z)(r,e);var i=$S(r);function r(){var n;(0,lt.Z)(this,r);for(var a=arguments.length,s=new Array(a),h=0;h<a;h++)s[h]=arguments[h];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,xe.Z)(n),"texture",void 0),(0,I.Z)((0,xe.Z)(n),"updateTexture",function(){var m=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=m({data:n.iconService.getCanvas(),mag:ee.NEAREST,min:ee.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,h=a.sourceColor,m=a.targetColor,y=a.textureBlend,b=y===void 0?"normal":y,A=a.lineType,P=A===void 0?"solid":A,k=a.dashArray,F=k===void 0?[10,5,0,0]:k,q=a.lineTexture,oe=q===void 0?!1:q,ue=a.iconStep,Pe=ue===void 0?100:ue,et=a.vertexHeightScale,at=et===void 0?20:et,_t=a.borderWidth,Nt=_t===void 0?0:_t,Ht=a.borderColor,nr=Ht===void 0?"#ccc":Ht;F.length===2&&F.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var mr=0,Hr=[0,0,0,0],fn=[0,0,0,0];if(h&&m&&(Hr=Be(h),fn=Be(m),mr=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var Or=this.layer.getEncodedData(),Tn=this.calDataFrame(this.cellLength,Or,this.cellProperties),zn=Tn.data,gi=Tn.width,io=Tn.height;this.rowCount=io,this.dataTexture=this.cellLength>0&&zn.length>0?this.createTexture2D({flipY:!0,data:zn,format:ee.LUMINANCE,type:ee.FLOAT,width:gi,height:io}):this.createTexture2D({flipY:!0,data:[1],format:ee.LUMINANCE,type:ee.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:za()(s)?s:1,u_textureBlend:b==="normal"?0:1,u_line_type:tC[P],u_dash_array:F,u_texture:this.texture,u_line_texture:oe?1:0,u_icon_step:Pe,u_textSize:[1024,this.iconService.canvasHeight||128],u_borderWidth:Nt,u_borderColor:Be(nr),u_linearColor:mr,u_sourceColor:Hr,u_targetColor:fn,u_vertexScale:at}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,h=s===void 0?!1:s,m=a.maskInside,y=m===void 0?!0:m;return[this.layer.buildLayerModel({moduleName:"line",vertexShader:eC,fragmentShader:QS,triangulation:dy,primitive:ee.TRIANGLES,blend:this.getBlend(),depth:{enable:!1},stencil:Ot(h,y)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:Jn.Attribute,descriptor:{name:"a_Distance",buffer:{usage:ee.STATIC_DRAW,data:[],type:ee.FLOAT},size:1,update:function(h,m,y,b){return[y[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Jn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:ee.STATIC_DRAW,data:[],type:ee.FLOAT},size:1,update:function(h,m,y,b){return[y[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Jn.Attribute,descriptor:{name:"a_Size",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:2,update:function(h,m,y,b){var A=h.size,P=A===void 0?1:A;return Array.isArray(P)?[P[0],P[1]]:[P,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Jn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:ee.STATIC_DRAW,data:[],type:ee.FLOAT},size:3,update:function(h,m,y,b,A){return A}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Jn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:ee.STATIC_DRAW,data:[],type:ee.FLOAT},size:1,update:function(h,m,y,b){return[y[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Jn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:2,update:function(h,m,y,b){var A=a.iconService.getIconMap(),P=h.texture,k=A[P]||{x:0,y:0},F=k.x,q=k.y;return[F,q]}}})}}]),r}(bs);function rC(e){var i=nC();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function nC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var iC=`
uniform float u_blur : 0.99;
uniform float u_line_type: 0.0;
uniform float u_opacity : 1.0;

uniform float u_borderWidth: 0.0;
uniform vec4 u_borderColor;
varying vec4 v_color;


uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,aC=`
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Position;


// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_vertexScale: 1.0;

#pragma include "projection"

varying vec4 v_color;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  v_color = a_Color;

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = a_Distance / a_Total_Distance; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_Size.y) + h * 0.2, 1.0));
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      h *= 2.0/pow(2.0, 20.0 - u_Zoom);
    }

    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));
  }
}
`,oC=function(e){(0,pn.Z)(r,e);var i=rC(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,h=a.sourceColor,m=a.targetColor,y=a.vertexHeightScale,b=y===void 0?20:y,A=0,P=[0,0,0,0],k=[0,0,0,0];if(h&&m&&(P=Be(h),k=Be(m),A=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var F=this.layer.getEncodedData(),q=this.calDataFrame(this.cellLength,F,this.cellProperties),oe=q.data,ue=q.width,Pe=q.height;this.rowCount=Pe,this.dataTexture=this.cellLength>0&&oe.length>0?this.createTexture2D({flipY:!0,data:oe,format:ee.LUMINANCE,type:ee.FLOAT,width:ue,height:Pe}):this.createTexture2D({flipY:!0,data:[1],format:ee.LUMINANCE,type:ee.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:za()(s)?s:1,u_linearColor:A,u_sourceColor:P,u_targetColor:k,u_vertexScale:b}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,h=s===void 0?!1:s,m=a.maskInside,y=m===void 0?!0:m;return[this.layer.buildLayerModel({moduleName:"simpleline",vertexShader:aC,fragmentShader:iC,triangulation:TE,primitive:ee.LINES,blend:this.getBlend(),depth:{enable:!1},stencil:Ot(h,y)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distance",type:Jn.Attribute,descriptor:{name:"a_Distance",buffer:{usage:ee.STATIC_DRAW,data:[],type:ee.FLOAT},size:1,update:function(s,h,m,y){return[m[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Jn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:ee.STATIC_DRAW,data:[],type:ee.FLOAT},size:1,update:function(s,h,m,y){return[m[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Jn.Attribute,descriptor:{name:"a_Size",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:2,update:function(s,h,m,y){var b=s.size,A=b===void 0?1:b;return Array.isArray(A)?[A[0],A[1]]:[A,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Jn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:ee.STATIC_DRAW,data:[],type:ee.FLOAT},size:3,update:function(s,h,m,y,b){return b}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Jn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:ee.STATIC_DRAW,data:[],type:ee.FLOAT},size:1,update:function(s,h,m,y){return[m[4]]}}})}}]),r}(bs);function sC(e){var i=uC();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function uC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var lC=`#define LineTypeSolid 0.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity : 1.0;
uniform float u_textureBlend;
uniform float u_iconStepCount;

varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

// dash
uniform float u_dash_offset : 0.0;
uniform float u_dash_ratio : 0.1;

varying vec2 v_iconMapUV;
varying float v_blur;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float v = styleMappingMat[3].a;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 start
    float flag = 0.0;
    if(u > 1.0/u_iconStepCount) {
      flag = 1.0;
    }
    u = fract(u*u_iconStepCount);
    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 end

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    // Tip: \u5224\u65AD\u7EB9\u7406\u95F4\u9694
    if(flag > 0.0) {
      pattern = vec4(0.0);
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  }
  

  // blur - AA
  if(v < v_blur) {
    gl_FragColor.a = mix(0.0, gl_FragColor.a, v/v_blur);
  } else if(v > 1.0 - v_blur) {
    gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);
  }

  gl_FragColor = filterColor(gl_FragColor);

    
  
  
}
`,cC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;
attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;
uniform float u_heightfixed;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

varying vec4 v_color;
varying float v_blur;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "light"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    d_texPixelLen = project_pixel(u_icon_step);
  } else {
    d_texPixelLen = u_icon_step;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_aimate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }

  float miter = (a_Miter + 1.0)/2.0;
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = miter;          // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C 0 - 1

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float originSize = a_Size.x;  // \u56FA\u5B9A\u9AD8\u5EA6
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    originSize = project_float_pixel(a_Size.x);
  }

  float wallHeight = originSize * miter;
  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));

  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);

  // v_lightWeight = lightWeight;
  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w);
  // v_color = a_Color;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,fC=function(e){(0,pn.Z)(r,e);var i=sC(r);function r(){var n;(0,lt.Z)(this,r);for(var a=arguments.length,s=new Array(a),h=0;h<a;h++)s[h]=arguments[h];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,xe.Z)(n),"texture",void 0),(0,I.Z)((0,xe.Z)(n),"updateTexture",function(){var m=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=m({data:n.iconService.getCanvas(),mag:ee.NEAREST,min:ee.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,h=a.sourceColor,m=a.targetColor,y=a.textureBlend,b=y===void 0?"normal":y,A=a.heightfixed,P=A===void 0?!1:A,k=a.lineTexture,F=k===void 0?!1:k,q=a.iconStep,oe=q===void 0?100:q,ue=a.iconStepCount,Pe=ue===void 0?1:ue;this.rendererService.getDirty()&&this.texture.bind();var et=0,at=[0,0,0,0],_t=[0,0,0,0];if(h&&m&&(at=Be(h),_t=Be(m),et=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var Nt=this.layer.getEncodedData(),Ht=this.calDataFrame(this.cellLength,Nt,this.cellProperties),nr=Ht.data,mr=Ht.width,Hr=Ht.height;this.rowCount=Hr,this.dataTexture=this.cellLength>0&&nr.length>0?this.createTexture2D({flipY:!0,data:nr,format:ee.LUMINANCE,type:ee.FLOAT,width:mr,height:Hr}):this.createTexture2D({flipY:!0,data:[1],format:ee.LUMINANCE,type:ee.FLOAT,width:1,height:1})}return{u_heightfixed:Number(P),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:za()(s)?s:1,u_textureBlend:b==="normal"?0:1,u_texture:this.texture,u_line_texture:F?1:0,u_iconStepCount:Pe,u_icon_step:oe,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:et,u_sourceColor:at,u_targetColor:_t}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"linewall",vertexShader:cC,fragmentShader:lC,triangulation:dy,primitive:ee.TRIANGLES,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"registerBuiltinAttributes",value:function(){var a=this,s=this.layer.getLayerConfig(),h=s.lineType,m=h===void 0?"solid":h;this.styleAttributeService.registerStyleAttribute({name:"distance",type:Jn.Attribute,descriptor:{name:"a_Distance",buffer:{usage:ee.STATIC_DRAW,data:[],type:ee.FLOAT},size:1,update:function(b,A,P,k){return[P[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Jn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:ee.STATIC_DRAW,data:[],type:ee.FLOAT},size:1,update:function(b,A,P,k){return[P[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Jn.Attribute,descriptor:{name:"a_Size",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:2,update:function(b,A,P,k){var F=b.size,q=F===void 0?1:F;return Array.isArray(q)?[q[0],q[1]]:[q,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Jn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:ee.STATIC_DRAW,data:[],type:ee.FLOAT},size:3,update:function(b,A,P,k,F){return F}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Jn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:ee.STATIC_DRAW,data:[],type:ee.FLOAT},size:1,update:function(b,A,P,k){return[P[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Jn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:2,update:function(b,A,P,k){var F=a.iconService.getIconMap(),q=b.texture,oe=F[q]||{x:0,y:0},ue=oe.x,Pe=oe.y;return[ue,Pe]}}})}}]),r}(bs),hC={arc:LS,arcmini:GS,arc3d:zS,greatcircle:KS,wall:fC,line:Cy,simple:oC},pC=hC;function dC(e){var i=vC();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function vC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mC=function(e){(0,pn.Z)(r,e);var i=dC(r);function r(){var n;(0,lt.Z)(this,r);for(var a=arguments.length,s=new Array(a),h=0;h<a;h++)s[h]=arguments[h];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,xe.Z)(n),"type","LineLayer"),n}return(0,It.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new pC[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={line:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},arcmini:{blend:"additive"},greatcircle:{blend:"additive"}};return s[a]}},{key:"getModelType",value:function(){var a,s=this.styleAttributeService.getLayerStyleAttribute("shape"),h=s==null||(a=s.scale)===null||a===void 0?void 0:a.field;return h||"line"}}]),r}(wp);function gC(e){var i=yC();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function yC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _C=`varying vec4 v_color;
uniform float u_opacity: 1.0;

varying float v_z;
varying float v_lightWeight;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;

void main() {
  float opacity = styleMappingMat[0][0];

  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_z);
    gl_FragColor.rgb *= v_lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // \u5E94\u7528\u900F\u660E\u5EA6
  gl_FragColor.a *= opacity;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - v_z): v_z;
  }

  // picking
  gl_FragColor = filterColor(gl_FragColor);
}
`,xC=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_globel;
uniform float u_r;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

varying float v_z;
varying float v_lightWeight;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  v_z = a_Position.z;

  vec2 offset = project_pixel(size.xy);

  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  vec4 pos = vec4(project_pos.xy + offset, project_pixel(size.z) * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = u_lightEnable > 0.0 ? calc_lighting(pos): 1.0;
  v_lightWeight = lightWeight;
  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }
  
  if(u_globel > 0.0) {
    // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
    //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
    float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
    float xRadian = getXRadian(a_Pos.y, r);
    float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 mx = mat4(
      1,0,0,0,  
      0,xcos,-xsin,0,  
      0,xsin,xcos,0,  
      0,0,0,1);

    //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
    float yRadian = getYRadian(a_Pos.x, a_Pos.z);
    float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 my = mat4(
      ycos,0,-ysin,0,  
      0,1,0,0,  
      ysin,0,ycos,0,  
      0,0,0,1);

    gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  }

  setPickingColor(a_PickingColor);
}
`,Ay=function(e){(0,pn.Z)(r,e);var i=gC(r);function r(){var n;(0,lt.Z)(this,r);for(var a=arguments.length,s=new Array(a),h=0;h<a;h++)s[h]=arguments[h];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,xe.Z)(n),"raiseCount",0),(0,I.Z)((0,xe.Z)(n),"raiserepeat",0),n}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption,h=s===void 0?{enable:!1,speed:.01,repeat:!1}:s,m=a.opacity,y=m===void 0?1:m,b=a.sourceColor,A=a.targetColor,P=a.opacityLinear,k=P===void 0?{enable:!1,dir:"up"}:P,F=a.lightEnable,q=F===void 0?!0:F;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:y})){this.judgeStyleAttributes({opacity:y});var oe=this.layer.getEncodedData(),ue=this.calDataFrame(this.cellLength,oe,this.cellProperties),Pe=ue.data,et=ue.width,at=ue.height;this.rowCount=at,this.dataTexture=this.cellLength>0&&Pe.length>0?this.createTexture2D({flipY:!0,data:Pe,format:ee.LUMINANCE,type:ee.FLOAT,width:et,height:at}):this.createTexture2D({flipY:!0,data:[1],format:ee.LUMINANCE,type:ee.FLOAT,width:1,height:1})}var _t=0,Nt=[0,0,0,0],Ht=[0,0,0,0];if(b&&A&&(Nt=Be(b),Ht=Be(A),_t=1),this.raiseCount<1&&this.raiserepeat>0&&h.enable){var nr=h.speed,mr=nr===void 0?.01:nr,Hr=h.repeat,fn=Hr===void 0?!1:Hr;this.raiseCount+=mr,this.raiseCount>=1&&(this.raiserepeat>1?(this.raiseCount=0,this.raiserepeat--):this.raiseCount=1)}return{u_r:h.enable&&this.raiserepeat>0?this.raiseCount:1,u_globel:this.mapService.version==="GLOBEL"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:za()(y)?y:1,u_linearColor:_t,u_sourceColor:Nt,u_targetColor:Ht,u_opacitylinear:Number(k.enable),u_opacitylinear_dir:k.dir==="up"?1:0,u_lightEnable:Number(q)}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.depth,h=s===void 0?!0:s,m=a.animateOption.repeat,y=m===void 0?1:m;return this.raiserepeat=y,[this.layer.buildLayerModel({moduleName:"pointExtrude2",vertexShader:xC,fragmentShader:_C,triangulation:hy,blend:this.getBlend(),cull:{enable:!0,face:this.mapService.version==="MAPBOX"?ee.FRONT:ee.BACK},depth:{enable:h}})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"size",type:Jn.Attribute,descriptor:{name:"a_Size",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:3,update:function(h,m,y,b){var A=h.size;if(A){var P=[];return Array.isArray(A)&&(P=A.length===2?[A[0],A[0],A[1]]:A),Array.isArray(A)||(P=[A,A,A]),P}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Jn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:ee.STATIC_DRAW,data:[],type:ee.FLOAT},size:3,update:function(h,m,y,b,A){return A}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Jn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:3,update:function(h,m){var y=Tp(h.coordinates);return a?ny([y[0],y[1]]):[y[0],y[1],0]}}})}}]),r}(bs),Ip;(function(e){e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.L7MAP="L7MAP",e.GLOBEL="GLOBEL"})(Ip||(Ip={}));function bC(e){var i=EC();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function EC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var SC=`#define Animate 0.0

uniform float u_globel;
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

 
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(u_globel > 0.0) {
    // TODO: \u5730\u7403\u6A21\u5F0F\u4E0B\u907F\u514D\u591A\u4F59\u7247\u5143\u7ED8\u5236\uFF0C\u540C\u65F6\u4E5F\u80FD\u907F\u514D\u6709\u7528\u7247\u5143\u5728\u900F\u660E\u4E14\u91CD\u53E0\u7684\u60C5\u51B5\u4E0B\u65E0\u6CD5\u5199\u5165
    // \u4ED8\u51FA\u7684\u4EE3\u4EF7\u662F\u8FB9\u7F18\u4F1A\u6709\u4E00\u4E9B\u952F\u9F7F
    if(outer_df > antialiasblur + 0.018) discard;
  }
  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);
  }

  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);

  if(u_aimate.x == Animate) {
    float d = length(v_data.xy);
    float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_aimate.z - u_aimate.y * u_time)), 0.0, 1.0);
    
    // TODO: \u6839\u636E\u53E0\u52A0\u6A21\u5F0F\u9009\u62E9\u6548\u679C
    if(u_additive > 0.0) {
      gl_FragColor *= intensity;
    } else {
      gl_FragColor = vec4(gl_FragColor.xyz, intensity);
    }
  
    // TODO: \u4F18\u5316\u5728\u6C34\u6CE2\u7EB9\u60C5\u51B5\u4E0B\u7684\u62FE\u53D6\uFF08a == 0 \u65F6\u65E0\u6CD5\u62FE\u53D6\uFF09
    if(d < 0.7) {
      gl_FragColor.a = max(gl_FragColor.a, 0.001);
    }

    if(u_additive > 0.0) {
      gl_FragColor = filterColorAnimate(gl_FragColor);
    } else {
      gl_FragColor = filterColor(gl_FragColor);
    }
    gl_FragColor.a *= opacity;
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
  } else {
    gl_FragColor.a *= opacity_t;
  }
}
`,CC=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_globel;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, u_blur);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    antialiasblur *= pow(19.0 - u_Zoom, 2.0);
    antialiasblur = max(antialiasblur, -0.01);
    // offset *= 0.5;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  if(u_globel > 0.0) {
    gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,wy=function(e){(0,pn.Z)(r,e);var i=bC(r);function r(){var n;(0,lt.Z)(this,r);for(var a=arguments.length,s=new Array(a),h=0;h<a;h++)s[h]=arguments[h];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,xe.Z)(n),"meter2coord",1),(0,I.Z)((0,xe.Z)(n),"isMeter",!1),n}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,h=s===void 0?1:s,m=a.strokeOpacity,y=m===void 0?1:m,b=a.strokeWidth,A=b===void 0?0:b,P=a.stroke,k=P===void 0?"rgba(0,0,0,0)":P,F=a.offsets,q=F===void 0?[0,0]:F,oe=a.blend;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:h,strokeOpacity:y,strokeWidth:A,stroke:k,offsets:q})){this.judgeStyleAttributes({opacity:h,strokeOpacity:y,strokeWidth:A,stroke:k,offsets:q});var ue=this.layer.getEncodedData(),Pe=this.calDataFrame(this.cellLength,ue,this.cellProperties),et=Pe.data,at=Pe.width,_t=Pe.height;this.rowCount=_t,this.dataTexture=this.cellLength>0&&et.length>0?this.createTexture2D({flipY:!0,data:et,format:ee.LUMINANCE,type:ee.FLOAT,width:at,height:_t}):this.createTexture2D({flipY:!0,data:[1],format:ee.LUMINANCE,type:ee.FLOAT,width:1,height:1})}return{u_isMeter:Number(this.isMeter),u_additive:oe==="additive"?1:0,u_globel:this.mapService.version===Ip.GLOBEL?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:za()(h)?h:1,u_stroke_opacity:za()(y)?y:1,u_stroke_width:za()(A)?A:0,u_stroke_color:this.getStrokeColor(k),u_offsets:this.isOffsetStatic(q)?q:[0,0]}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),fy)}},{key:"initModels",value:function(){var a=this.layer.getLayerConfig(),s=a.unit,h=s===void 0?"l7size":s,m=this.mapService.version;return h==="meter"&&m!==Ip.L7MAP&&m!==Ip.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var a=(0,ne.Z)(this.layer.getSource().extent,4),s=a[0],h=a[1],m=a[2],y=a[3],b=[(s+m)/2,(h+y)/2],A=this.mapService.version;if(A===Ip.MAPBOX&&window.mapboxgl.MercatorCoordinate){var P=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:b[0],lat:b[1]},0),k=1,F=k*P.meterInMercatorCoordinateUnits(),q=new window.mapboxgl.MercatorCoordinate(P.x-F,P.y,P.z),oe=q.toLngLat();this.meter2coord=b[0]-oe.lng;return}var ue=this.mapService.meterToCoord(b,[s,h]),Pe=this.mapService.meterToCoord(b,[m===s?m+.1:m,y===h?h+.1:y]);this.meter2coord=(ue+Pe)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,h=s===void 0?!1:s,m=a.maskInside,y=m===void 0?!0:m,b=this.mapService.version==="GLOBEL";return[this.layer.buildLayerModel({moduleName:"pointfill",vertexShader:CC,fragmentShader:SC,triangulation:b?wE:fy,depth:{enable:b},blend:this.getBlend(),stencil:Ot(h,y)})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"animateOption2Array",value:function(a){return[a.enable?0:1,a.speed||1,a.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var a=this,s=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Jn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:3,update:function(m,y,b,A){var P;if(s){var k=(0,ne.Z)(b,3),F=k[0],q=k[1],oe=k[2],ue=$a.fromValues(0,0,1),Pe=$a.fromValues(F,0,oe),et=F>=0?$a.angle(ue,Pe):Math.PI*2-$a.angle(ue,Pe),at=Math.PI*2-Math.asin(q/100),_t=Sr();_n(_t,_t,et),ar(_t,_t,at);var Nt=$a.fromValues(1,1,0);$a.transformMat4(Nt,Nt,_t),$a.normalize(Nt,Nt);var Ht=$a.fromValues(-1,1,0);$a.transformMat4(Ht,Ht,_t),$a.normalize(Ht,Ht);var nr=$a.fromValues(-1,-1,0);$a.transformMat4(nr,nr,_t),$a.normalize(nr,nr);var mr=$a.fromValues(1,-1,0);$a.transformMat4(mr,mr,_t),$a.normalize(mr,mr),P=[].concat((0,ur.Z)(Nt),(0,ur.Z)(Ht),(0,ur.Z)(nr),(0,ur.Z)(mr))}else P=[1,1,0,-1,1,0,-1,-1,0,1,-1,0];var Hr=A%4*3;return[P[Hr],P[Hr+1],P[Hr+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Jn.Attribute,descriptor:{name:"a_Size",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:1,update:function(m,y,b,A){var P=m.size,k=P===void 0?5:P;return Array.isArray(k)?[k[0]*a.meter2coord]:[k*a.meter2coord]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:Jn.Attribute,descriptor:{name:"a_Shape",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:1,update:function(m,y,b,A){var P=m.shape,k=P===void 0?2:P,F=a.layer.getLayerConfig().shape2d,q=F.indexOf(k);return[q]}}})}}]),r}(bs);function AC(e){var i=wC();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function wC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var TC=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main(){
      float opacity = styleMappingMat[0][0];
      float size = styleMappingMat[1][0];
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }

      gl_FragColor.a = gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,MC=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  styleMappingMat[1][0] = a_Size;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,PC=function(e){(0,pn.Z)(r,e);var i=AC(r);function r(){var n;(0,lt.Z)(this,r);for(var a=arguments.length,s=new Array(a),h=0;h<a;h++)s[h]=arguments[h];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,xe.Z)(n),"texture",void 0),n}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity;return{u_opacity:s||1,u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]}}},{key:"initModels",value:function(){var a=this;return this.initIconFontGlyphs(),this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",function(){a.updateTexture(),a.layer.render()}),[this.layer.buildLayerModel({moduleName:"pointiconImage",vertexShader:MC,fragmentShader:TC,triangulation:py,primitive:ee.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Jn.Attribute,descriptor:{name:"a_Size",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:1,update:function(h,m,y,b){var A=h.size;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Jn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:2,update:function(h,m,y,b){var A=a.fontService.mapping,P=h.shape,k=a.fontService.getGlyph(P),F=A[k],q=F.x,oe=F.y;return[q,oe]}}})}},{key:"updateTexture",value:function(){var a=this.rendererService.createTexture2D,s=this.fontService.canvas;this.texture=a({data:s,mag:ee.LINEAR,min:ee.LINEAR,width:s.width,height:s.height})}},{key:"initIconFontGlyphs",value:function(){var a=this,s=this.layer.getLayerConfig(),h=s.fontWeight,m=h===void 0?"normal":h,y=s.fontFamily,b=y===void 0?"sans-serif":y,A=this.layer.getEncodedData(),P=[];A.forEach(function(k){var F=k.shape,q=F===void 0?"":F;q=q.toString();var oe=a.fontService.getGlyph(q);P.indexOf(oe)===-1&&P.push(oe)}),this.fontService.setFontOptions({characterSet:P,fontWeight:m,fontFamily:b,fontSize:48})}}]),r}(bs);function IC(e){var i=OC();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function OC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var RC=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main(){
      float opacity = styleMappingMat[0][0];
      float size = styleMappingMat[1][0];
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }

      gl_FragColor.a = gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,LC=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  styleMappingMat[1][0] = a_Size;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,Ty=function(e){(0,pn.Z)(r,e);var i=IC(r);function r(){var n;(0,lt.Z)(this,r);for(var a=arguments.length,s=new Array(a),h=0;h<a;h++)s[h]=arguments[h];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,xe.Z)(n),"texture",void 0),(0,I.Z)((0,xe.Z)(n),"updateTexture",function(){var m=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layer.renderLayers();return}n.texture=m({data:n.iconService.getCanvas(),mag:ee.LINEAR,min:ee.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,h=a.offsets,m=h===void 0?[0,0]:h;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s,offsets:m})){this.judgeStyleAttributes({opacity:s,offsets:m});var y=this.layer.getEncodedData(),b=this.calDataFrame(this.cellLength,y,this.cellProperties),A=b.data,P=b.width,k=b.height;this.rowCount=k,this.dataTexture=this.cellLength>0&&A.length>0?this.createTexture2D({flipY:!0,data:A,format:ee.LUMINANCE,type:ee.FLOAT,width:P,height:k}):this.createTexture2D({flipY:!0,data:[1],format:ee.LUMINANCE,type:ee.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:za()(s)?s:1,u_offsets:this.isOffsetStatic(m)?m:[0,0]}}},{key:"initModels",value:function(){return this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,h=s===void 0?!1:s,m=a.maskInside,y=m===void 0?!0:m;return[this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:LC,fragmentShader:RC,triangulation:py,primitive:ee.POINTS,depth:{enable:!1},blend:this.getBlend(),stencil:Ot(h,y)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Jn.Attribute,descriptor:{name:"a_Size",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:1,update:function(h,m,y,b){var A=h.size,P=A===void 0?5:A;return Array.isArray(P)?[P[0]]:[P]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Jn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:2,update:function(h,m,y,b){var A=a.iconService.getIconMap(),P=h.shape,k=A[P]||{x:0,y:0},F=k.x,q=k.y;return[F,q]}}})}}]),r}(bs);function kC(e){var i=DC();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function DC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var FC=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  float opacity = styleMappingMat[0][0];

  gl_FragColor = v_color;
  // gl_FragColor.a =gl_FragColor.a * u_opacity;
  gl_FragColor.a =gl_FragColor.a * opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,BC=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function NC(e){var i=e.coordinates;return{vertices:(0,ur.Z)(i),indices:[0],size:i.length}}var My=function(e){(0,pn.Z)(r,e);var i=kC(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,h=s===void 0?1:s,m=a.offsets,y=m===void 0?[0,0]:m;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:h,offsets:y})){this.judgeStyleAttributes({opacity:h,offsets:y});var b=this.layer.getEncodedData(),A=this.calDataFrame(this.cellLength,b,this.cellProperties),P=A.data,k=A.width,F=A.height;this.rowCount=F,this.dataTexture=this.cellLength>0&&P.length>0?this.createTexture2D({flipY:!0,data:P,format:ee.LUMINANCE,type:ee.FLOAT,width:k,height:F}):this.createTexture2D({flipY:!0,data:[1],format:ee.LUMINANCE,type:ee.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:za()(h)?h:1,u_offsets:this.isOffsetStatic(y)?y:[0,0]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,h=s===void 0?!1:s,m=a.maskInside,y=m===void 0?!0:m;return[this.layer.buildLayerModel({moduleName:"normalpoint",vertexShader:BC,fragmentShader:FC,triangulation:NC,depth:{enable:!1},primitive:ee.POINTS,blend:this.getBlend(),stencil:Ot(h,y)})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Jn.Attribute,descriptor:{name:"a_Size",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:1,update:function(s,h,m,y){var b=s.size,A=b===void 0?1:b;return Array.isArray(A)?[A[0]]:[A]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:vc.additive}}}]),r}(bs);function zC(e){var i=UC();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function UC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ZC=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_additive;

uniform float u_stroke_opacity : 1;

uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
varying float v_blur;
varying float v_innerRadius;

#pragma include "picking"
void main() {
  vec2 center = vec2(0.5);

  float opacity = styleMappingMat[0][0];
  // Tip: \u7247\u5143\u5230\u4E2D\u5FC3\u70B9\u7684\u8DDD\u79BB 0 - 1
  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;
  // Tip: \u7247\u5143\u7684\u526A\u5207\u6210\u5706\u5F62
  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);


  if(v_innerRadius < 0.99) {
    // \u5F53\u5B58\u5728 stroke \u4E14 stroke > 0.01
    float blurWidth = (1.0 - v_blur)/2.0;
    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);
    if(fragmengTocenter > v_innerRadius + blurWidth) {
      gl_FragColor = stroke;
    } else if(fragmengTocenter > v_innerRadius - blurWidth){
      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);
      gl_FragColor = mix(v_color, stroke, mixR);
    } else {
      gl_FragColor = v_color;
    }
  } else {
    // \u5F53\u4E0D\u5B58\u5728 stroke \u6216 stroke <= 0.01
    gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);

  

  
  
  if(u_additive > 0.0) {
    gl_FragColor *= circleClipOpacity;
  } else {
    gl_FragColor.a *= circleClipOpacity;
  }

}
`,jC=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_stroke_width;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143
varying float v_blur;
varying float v_innerRadius;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;
  v_blur = 1.0 - max(2.0/a_Size, 0.05);
  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function VC(e){var i=e.coordinates;return{vertices:(0,ur.Z)(i),indices:[0],size:i.length}}var GC=function(e){(0,pn.Z)(r,e);var i=zC(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,h=s===void 0?1:s,m=a.offsets,y=m===void 0?[0,0]:m,b=a.blend,A=a.strokeOpacity,P=A===void 0?1:A,k=a.strokeWidth,F=k===void 0?0:k,q=a.stroke,oe=q===void 0?"#fff":q;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:h,offsets:y})){this.judgeStyleAttributes({opacity:h,offsets:y});var ue=this.layer.getEncodedData(),Pe=this.calDataFrame(this.cellLength,ue,this.cellProperties),et=Pe.data,at=Pe.width,_t=Pe.height;this.rowCount=_t,this.dataTexture=this.cellLength>0&&et.length>0?this.createTexture2D({flipY:!0,data:et,format:ee.LUMINANCE,type:ee.FLOAT,width:at,height:_t}):this.createTexture2D({flipY:!0,data:[1],format:ee.LUMINANCE,type:ee.FLOAT,width:1,height:1})}return{u_additive:b==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:za()(h)?h:1,u_offsets:this.isOffsetStatic(y)?y:[0,0],u_stroke_opacity:za()(P)?P:1,u_stroke_width:za()(F)?F:0,u_stroke_color:this.getStrokeColor(oe)}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,h=s===void 0?!1:s,m=a.maskInside,y=m===void 0?!0:m;return[this.layer.buildLayerModel({moduleName:"simplepoint",vertexShader:jC,fragmentShader:ZC,triangulation:VC,depth:{enable:!1},primitive:ee.POINTS,blend:this.getBlend(),stencil:Ot(h,y)})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Jn.Attribute,descriptor:{name:"a_Size",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:1,update:function(s,h,m,y){var b=s.size,A=b===void 0?1:b;return Array.isArray(A)?[A[0]]:[A]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:vc.additive}}}]),r}(bs);function HC(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=WC(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(b){throw b},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,h=!1,m;return{s:function(){r=r.call(e)},n:function(){var b=r.next();return s=b.done,b},e:function(b){h=!0,m=b},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(h)throw m}}}}function WC(e,i){if(!!e){if(typeof e=="string")return Py(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Py(e,i)}}function Py(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var XC=function(){function e(i,r,n){(0,lt.Z)(this,e),(0,I.Z)(this,"boxCells",[]),(0,I.Z)(this,"xCellCount",void 0),(0,I.Z)(this,"yCellCount",void 0),(0,I.Z)(this,"boxKeys",void 0),(0,I.Z)(this,"bboxes",void 0),(0,I.Z)(this,"width",void 0),(0,I.Z)(this,"height",void 0),(0,I.Z)(this,"xScale",void 0),(0,I.Z)(this,"yScale",void 0),(0,I.Z)(this,"boxUid",void 0);var a=this.boxCells;this.xCellCount=Math.ceil(i/n),this.yCellCount=Math.ceil(r/n);for(var s=0;s<this.xCellCount*this.yCellCount;s++)a.push([]);this.boxKeys=[],this.bboxes=[],this.width=i,this.height=r,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/r,this.boxUid=0}return(0,It.Z)(e,[{key:"insert",value:function(r,n,a,s,h){this.forEachCell(n,a,s,h,this.insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(n),this.bboxes.push(a),this.bboxes.push(s),this.bboxes.push(h)}},{key:"query",value:function(r,n,a,s,h){return this.queryHitTest(r,n,a,s,!1,h)}},{key:"hitTest",value:function(r,n,a,s,h){return this.queryHitTest(r,n,a,s,!0,h)}},{key:"insertBoxCell",value:function(r,n,a,s,h,m){this.boxCells[h].push(m)}},{key:"queryHitTest",value:function(r,n,a,s,h,m){if(a<0||r>this.width||s<0||n>this.height)return h?!1:[];var y=[];if(r<=0&&n<=0&&this.width<=a&&this.height<=s){if(h)return!0;for(var b=0;b<this.boxKeys.length;b++)y.push({key:this.boxKeys[b],x1:this.bboxes[b*4],y1:this.bboxes[b*4+1],x2:this.bboxes[b*4+2],y2:this.bboxes[b*4+3]});return m?y.filter(m):y}var A={hitTest:h,seenUids:{box:{},circle:{}}};return this.forEachCell(r,n,a,s,this.queryCell,y,A,m),h?y.length>0:y}},{key:"queryCell",value:function(r,n,a,s,h,m,y,b){var A=y.seenUids,P=this.boxCells[h];if(P!==null){var k=this.bboxes,F=HC(P),q;try{for(F.s();!(q=F.n()).done;){var oe=q.value;if(!A.box[oe]){A.box[oe]=!0;var ue=oe*4;if(r<=k[ue+2]&&n<=k[ue+3]&&a>=k[ue+0]&&s>=k[ue+1]&&(!b||b(this.boxKeys[oe]))){if(y.hitTest)return m.push(!0),!0;m.push({key:this.boxKeys[oe],x1:k[ue],y1:k[ue+1],x2:k[ue+2],y2:k[ue+3]})}}}}catch(Pe){F.e(Pe)}finally{F.f()}}return!1}},{key:"forEachCell",value:function(r,n,a,s,h,m,y,b){for(var A=this.convertToXCellCoord(r),P=this.convertToYCellCoord(n),k=this.convertToXCellCoord(a),F=this.convertToYCellCoord(s),q=A;q<=k;q++)for(var oe=P;oe<=F;oe++){var ue=this.xCellCount*oe+q;if(h.call(this,r,n,a,s,ue,m,y,b))return}}},{key:"convertToXCellCoord",value:function(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}},{key:"convertToYCellCoord",value:function(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}}]),e}(),YC=XC,qC=function(){function e(i,r){(0,lt.Z)(this,e),(0,I.Z)(this,"width",void 0),(0,I.Z)(this,"height",void 0),(0,I.Z)(this,"grid",void 0),(0,I.Z)(this,"viewportPadding",100),(0,I.Z)(this,"screenRightBoundary",void 0),(0,I.Z)(this,"screenBottomBoundary",void 0),(0,I.Z)(this,"gridRightBoundary",void 0),(0,I.Z)(this,"gridBottomBoundary",void 0),this.width=i,this.height=r,this.viewportPadding=Math.max(i,r),this.grid=new YC(i+this.viewportPadding,r+this.viewportPadding,25),this.screenRightBoundary=i+this.viewportPadding,this.screenBottomBoundary=r+this.viewportPadding,this.gridRightBoundary=i+2*this.viewportPadding,this.gridBottomBoundary=r+2*this.viewportPadding}return(0,It.Z)(e,[{key:"placeCollisionBox",value:function(r){var n=r.x1+r.anchorPointX+this.viewportPadding,a=r.y1+r.anchorPointY+this.viewportPadding,s=r.x2+r.anchorPointX+this.viewportPadding,h=r.y2+r.anchorPointY+this.viewportPadding;return!this.isInsideGrid(n,a,s,h)||this.grid.hitTest(n,a,s,h)?{box:[]}:{box:[n,a,s,h]}}},{key:"insertCollisionBox",value:function(r,n){var a={featureIndex:n};this.grid.insert(a,r[0],r[1],r[2],r[3])}},{key:"project",value:function(r,n,a){var s=ks(n,a,0,1),h=ha(),m=Er.apply(Y,(0,ur.Z)(r));return p(h,s,m),{x:(h[0]/h[3]+1)/2*this.width+this.viewportPadding,y:(-h[1]/h[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(r,n,a,s){return a>=0&&r<this.gridRightBoundary&&s>=0&&n<this.gridBottomBoundary}}]),e}();function Iy(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=KC(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(b){throw b},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,h=!1,m;return{s:function(){r=r.call(e)},n:function(){var b=r.next();return s=b.done,b},e:function(b){h=!0,m=b},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(h)throw m}}}}function KC(e,i){if(!!e){if(typeof e=="string")return Oy(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Oy(e,i)}}function Oy(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function Ry(e){var i=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0;break;default:i=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0;break;default:r=.5}return{horizontalAlign:i,verticalAlign:r}}function Ly(e,i,r,n,a){if(!!a){var s=e[n],h=s.glyph;if(h)for(var m=i[h].advance*s.scale,y=(e[n].x+m)*a,b=r;b<=n;b++)e[b].x-=y}}function ky(e,i,r,n,a,s,h){var m=(i-r)*a,y=(-n*h+.5)*s,b=Iy(e),A;try{for(b.s();!(A=b.n()).done;){var P=A.value;P.x+=m,P.y+=y}}catch(k){b.e(k)}finally{b.f()}}function $C(e,i,r,n,a,s,h){var m=-8,y=0,b=m,A=0,P=e.positionedGlyphs,k=s==="right"?1:s==="left"?0:.5,F=P.length;r.forEach(function(et){if(et.split("").forEach(function(_t){var Nt=i[_t],Ht=0;Nt&&(P.push({glyph:_t,x:y,y:b+Ht,vertical:!1,scale:1,metrics:Nt}),y+=Nt.advance+h)}),P.length!==F){var at=y-h;A=Math.max(at,A),Ly(P,i,F,P.length-1,k)}y=0,b-=n+5});var q=Ry(a),oe=q.horizontalAlign,ue=q.verticalAlign;ky(P,k,oe,ue,A,n,r.length);var Pe=b-m;e.top+=-ue*Pe,e.bottom=e.top-Pe,e.left+=-oe*A,e.right=e.left+A}function JC(e,i,r,n,a,s,h){var m=-8,y=0,b=m,A=0,P=e.positionedGlyphs,k=s==="right"?1:s==="left"?0:.5,F=P.length;r.forEach(function(et){var at=i[et],_t=0;if(at&&(P.push({glyph:et,x:y,y:b+_t,vertical:!1,scale:1,metrics:at}),y+=at.advance+h),P.length!==F){var Nt=y-h;A=Math.max(Nt,A),Ly(P,i,F,P.length-1,k)}y=0,b-=n+5});var q=Ry(a),oe=q.horizontalAlign,ue=q.verticalAlign;ky(P,k,oe,ue,A,n,r.length);var Pe=b-m;e.top+=-ue*Pe,e.bottom=e.top-Pe,e.left+=-oe*A,e.right=e.left+A}function QC(e,i,r,n,a,s){var h=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],m=arguments.length>7?arguments[7]:void 0,y=e.split(`
`),b=[],A={positionedGlyphs:b,top:h[1],bottom:h[1],left:h[0],right:h[0],lineCount:y.length,text:e};return m?JC(A,i,y,r,n,a,s):$C(A,i,y,r,n,a,s),b.length?A:!1}function eA(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],r=arguments.length>2?arguments[2]:void 0,n=e.positionedGlyphs,a=n===void 0?[]:n,s=[],h=Iy(a),m;try{for(h.s();!(m=h.n()).done;){var y=m.value,b=y.metrics,A=4,P=b.advance*y.scale/2,k=r?[y.x+P,y.y]:[0,0],F=r?[0,0]:[y.x+P+i[0],y.y+i[1]],q=(0-A)*y.scale-P+F[0],oe=(0-A)*y.scale+F[1],ue=q+b.width*y.scale,Pe=oe+b.height*y.scale,et={x:q,y:oe},at={x:ue,y:oe},_t={x:q,y:Pe},Nt={x:ue,y:Pe};s.push({tl:et,tr:at,bl:_t,br:Nt,tex:b,glyphOffset:k})}}catch(Ht){h.e(Ht)}finally{h.f()}return s}function tA(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=rA(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(b){throw b},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,h=!1,m;return{s:function(){r=r.call(e)},n:function(){var b=r.next();return s=b.done,b},e:function(b){h=!0,m=b},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(h)throw m}}}}function rA(e,i){if(!!e){if(typeof e=="string")return Dy(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Dy(e,i)}}function Dy(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function nA(e){var i=iA();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function iA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Fy=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  // get style data mapping
  float opacity = styleMappingMat[0][0];
  float strokeWidth = styleMappingMat[0][2];
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,By=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz, 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function Ny(e){var i=this,r=e.id,n=[],a=[];if(!i.glyphInfoMap||!i.glyphInfoMap[r])return{vertices:[],indices:[],size:7};var s=i.glyphInfoMap[r].centroid,h=s.length===2?[s[0],s[1],0]:s;return i.glyphInfoMap[r].glyphQuads.forEach(function(m,y){n.push.apply(n,(0,ur.Z)(h).concat([m.tex.x,m.tex.y+m.tex.height,m.tl.x,m.tl.y],(0,ur.Z)(h),[m.tex.x+m.tex.width,m.tex.y+m.tex.height,m.tr.x,m.tr.y],(0,ur.Z)(h),[m.tex.x+m.tex.width,m.tex.y,m.br.x,m.br.y],(0,ur.Z)(h),[m.tex.x,m.tex.y,m.bl.x,m.bl.y])),a.push(0+y*4,1+y*4,2+y*4,2+y*4,3+y*4,0+y*4)}),{vertices:n,indices:a,size:7}}var zy=function(e){(0,pn.Z)(r,e);var i=nA(r);function r(){var n;(0,lt.Z)(this,r);for(var a=arguments.length,s=new Array(a),h=0;h<a;h++)s[h]=arguments[h];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,xe.Z)(n),"glyphInfo",void 0),(0,I.Z)((0,xe.Z)(n),"glyphInfoMap",{}),(0,I.Z)((0,xe.Z)(n),"texture",void 0),(0,I.Z)((0,xe.Z)(n),"currentZoom",-1),(0,I.Z)((0,xe.Z)(n),"extent",void 0),(0,I.Z)((0,xe.Z)(n),"textureHeight",0),(0,I.Z)((0,xe.Z)(n),"textCount",0),(0,I.Z)((0,xe.Z)(n),"preTextStyle",{}),(0,I.Z)((0,xe.Z)(n),"buildModels",function(){var m=n.layer.getLayerConfig(),y=m.mask,b=y===void 0?!1:y,A=m.maskInside,P=A===void 0?!0:A;return n.initGlyph(),n.updateTexture(),n.filterGlyphs(),n.reBuildModel(),[n.layer.buildLayerModel({moduleName:"pointText",vertexShader:By,fragmentShader:Fy,triangulation:Ny.bind((0,xe.Z)(n)),depth:{enable:!1},blend:n.getBlend(),stencil:Ot(b,P)})]}),n}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,h=s===void 0?1:s,m=a.stroke,y=m===void 0?"#fff":m,b=a.strokeWidth,A=b===void 0?0:b,P=a.textAnchor,k=P===void 0?"center":P,F=a.textAllowOverlap,q=F===void 0?!1:F,oe=a.halo,ue=oe===void 0?.5:oe,Pe=a.gamma,et=Pe===void 0?2:Pe,at=this.fontService,_t=at.canvas,Nt=at.mapping;if(Object.keys(Nt).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(Nt).length),this.preTextStyle={textAnchor:k,textAllowOverlap:q},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:h,strokeWidth:A,stroke:y})){this.judgeStyleAttributes({opacity:h,strokeWidth:A,stroke:y});var Ht=this.layer.getEncodedData(),nr=this.calDataFrame(this.cellLength,Ht,this.cellProperties),mr=nr.data,Hr=nr.width,fn=nr.height;this.rowCount=fn,this.dataTexture=this.cellLength>0&&mr.length>0?this.createTexture2D({flipY:!0,data:mr,format:ee.LUMINANCE,type:ee.FLOAT,width:Hr,height:fn}):this.createTexture2D({flipY:!0,data:[1],format:ee.LUMINANCE,type:ee.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:za()(h)?h:1,u_stroke_width:za()(A)?A:0,u_stroke_color:this.getStrokeColor(y),u_sdf_map:this.texture,u_halo_blur:ue,u_gamma_scale:et,u_sdf_map_size:[_t.width,_t.height]}}},{key:"initModels",value:function(){this.layer.on("remapping",this.buildModels),this.extent=this.textExtent();var a=this.layer.getLayerConfig(),s=a.textAnchor,h=s===void 0?"center":s,m=a.textAllowOverlap,y=m===void 0?!0:m;return this.preTextStyle={textAnchor:h,textAllowOverlap:y},this.buildModels()}},{key:"needUpdate",value:function(){var a=this.layer.getLayerConfig(),s=a.textAllowOverlap,h=s===void 0?!1:s,m=this.mapService.getZoom(),y=this.mapService.getBounds(),b=c(this.extent,y);return!h&&(Math.abs(this.currentZoom-m)>1||!b)||h!==this.preTextStyle.textAllowOverlap?(this.reBuildModel(),!0):!1}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy(),this.layer.off("remapping",this.buildModels)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:Jn.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:1,update:function(s,h,m,y){var b=s.rotate,A=b===void 0?0:b;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:Jn.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:ee.STATIC_DRAW,data:[],type:ee.FLOAT},size:2,update:function(s,h,m,y){return[m[5],m[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Jn.Attribute,descriptor:{name:"a_Size",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:1,update:function(s,h,m,y){var b=s.size,A=b===void 0?12:b;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:Jn.Attribute,descriptor:{name:"a_tex",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:2,update:function(s,h,m,y){return[m[3],m[4]]}}})}},{key:"textExtent",value:function(){var a=this.mapService.getBounds();return f(a,.5)}},{key:"initTextFont",value:function(){var a=this.layer.getLayerConfig(),s=a.fontWeight,h=s===void 0?"400":s,m=a.fontFamily,y=m===void 0?"sans-serif":m,b=this.layer.getEncodedData(),A=[];b.forEach(function(P){var k=P.shape,F=k===void 0?"":k;F=F.toString();var q=tA(F),oe;try{for(q.s();!(oe=q.n()).done;){var ue=oe.value;A.indexOf(ue)===-1&&A.push(ue)}}catch(Pe){q.e(Pe)}finally{q.f()}}),this.fontService.setFontOptions({characterSet:A,fontWeight:h,fontFamily:y,iconfont:!1})}},{key:"initIconFontTex",value:function(){var a=this.layer.getLayerConfig(),s=a.fontWeight,h=s===void 0?"400":s,m=a.fontFamily,y=m===void 0?"sans-serif":m,b=this.layer.getEncodedData(),A=[];b.forEach(function(P){var k=P.shape,F=k===void 0?"":k;F="".concat(F),A.indexOf(F)===-1&&A.push(F)}),this.fontService.setFontOptions({characterSet:A,fontWeight:h,fontFamily:y,iconfont:!0})}},{key:"generateGlyphLayout",value:function(a){var s=this,h=this.fontService.mapping,m=this.layer.getLayerConfig(),y=m.spacing,b=y===void 0?2:y,A=m.textAnchor,P=A===void 0?"center":A,k=this.layer.getEncodedData();this.glyphInfo=k.map(function(F){var q=F.shape,oe=q===void 0?"":q,ue=F.id,Pe=F.size,et=Pe===void 0?1:Pe,at=F.textOffset,_t=at===void 0?[0,0]:at,Nt=QC(oe.toString(),h,et,P,"left",b,_t,a),Ht=eA(Nt,_t,!1);return F.shaping=Nt,F.glyphQuads=Ht,F.centroid=Tp(F.coordinates),F.originCentroid=F.version==="GAODE2.x"?Tp(F.originCoordinates):F.originCentroid=F.centroid,s.glyphInfoMap[ue]={shaping:Nt,glyphQuads:Ht,centroid:Tp(F.coordinates)},F})}},{key:"filterGlyphs",value:function(){var a=this,s=this.layer.getLayerConfig(),h=s.padding,m=h===void 0?[4,4]:h,y=s.textAllowOverlap,b=y===void 0?!1:y;if(!b){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var A=this.rendererService.getViewportSize(),P=A.width,k=A.height,F=new qC(P,k),q=this.glyphInfo.filter(function(oe){var ue=oe.shaping,Pe=oe.id,et=Pe===void 0?0:Pe,at=oe.version==="GAODE2.x"?oe.originCentroid:oe.centroid,_t=oe.size,Nt=_t/24,Ht=a.mapService.lngLatToContainer(at),nr=F.placeCollisionBox({x1:ue.left*Nt-m[0],x2:ue.right*Nt+m[0],y1:ue.top*Nt-m[1],y2:ue.bottom*Nt+m[1],anchorPointX:Ht.x,anchorPointY:Ht.y}),mr=nr.box;return mr&&mr.length?(F.insertCollisionBox(mr,et),!0):!1});q.forEach(function(oe){a.glyphInfoMap[oe.id]=oe})}}},{key:"initGlyph",value:function(){var a=this.layer.getLayerConfig(),s=a.iconfont,h=s===void 0?!1:s;h?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(h)}},{key:"updateTexture",value:function(){var a=this.rendererService.createTexture2D,s=this.fontService.canvas;this.textureHeight=s.height,this.texture&&this.texture.destroy(),this.texture=a({data:s,mag:ee.LINEAR,min:ee.LINEAR,width:s.width,height:s.height})}},{key:"reBuildModel",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,h=s===void 0?!1:s,m=a.maskInside,y=m===void 0?!0:m;this.filterGlyphs(),this.layer.models=[this.layer.buildLayerModel({moduleName:"pointText",vertexShader:By,fragmentShader:Fy,triangulation:Ny.bind(this),depth:{enable:!1},blend:this.getBlend(),stencil:Ot(h,y)})]}}]),r}(bs),aA={fill:wy,image:Ty,normal:My,simplePoint:GC,extrude:Ay,text:zy,icon:PC},oA=aA;function sA(e){var i=uA();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function uA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var lA=function(e){(0,pn.Z)(r,e);var i=sA(r);function r(){var n;(0,lt.Z)(this,r);for(var a=arguments.length,s=new Array(a),h=0;h<a;h++)s[h]=arguments[h];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,xe.Z)(n),"type","PointLayer"),n}return(0,It.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new oA[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={normal:{blend:"additive"},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},icon:{},text:{blend:"normal"}};return s[a]}},{key:"getModelType",value:function(){var a=this.getEncodedData(),s=this.getLayerConfig(),h=s.shape2d,m=s.shape3d,y=this.iconService.getIconMap(),b=a.find(function(P){return P.hasOwnProperty("shape")});if(b){var A=b.shape;return A==="dot"?"normal":A==="simple"?"simplePoint":(h==null?void 0:h.indexOf(A))!==-1?"fill":(m==null?void 0:m.indexOf(A))!==-1?"extrude":y.hasOwnProperty(A)?"image":this.fontService.getGlyph(A)!==""?"icon":"text"}else return"normal"}}]),r}(wp);function cA(e){var i=fA();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function fA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var hA=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,pA=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"
varying float v_lightWeight;

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColorWithLight(gl_FragColor, v_lightWeight);
}
`,dA=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

varying float v_lightWeight;

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      project_pos.z *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  v_lightWeight = lightWeight;
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,vA=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      project_pos.z *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,mA=function(e){(0,pn.Z)(r,e);var i=cA(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,h=s===void 0?1:s,m=a.heightfixed,y=m===void 0?!1:m;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:h})){this.judgeStyleAttributes({opacity:h});var b=this.layer.getEncodedData(),A=this.calDataFrame(this.cellLength,b,this.cellProperties),P=A.data,k=A.width,F=A.height;this.rowCount=F,this.dataTexture=this.cellLength>0&&P.length>0?this.createTexture2D({flipY:!0,data:P,format:ee.LUMINANCE,type:ee.FLOAT,width:k,height:F}):this.createTexture2D({flipY:!0,data:[1],format:ee.LUMINANCE,type:ee.FLOAT,width:1,height:1})}return{u_heightfixed:Number(y),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:za()(h)?h:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.pickLight,h=s===void 0?!1:s,m=a.mask,y=m===void 0?!1:m,b=a.maskInside,A=b===void 0?!0:b;return[this.layer.buildLayerModel({moduleName:"polygonExtrude",vertexShader:h?dA:vA,fragmentShader:h?pA:hA,triangulation:vy,stencil:Ot(y,A)})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:Jn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:ee.STATIC_DRAW,data:[],type:ee.FLOAT},size:3,update:function(s,h,m,y,b){return b}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Jn.Attribute,descriptor:{name:"a_Size",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:1,update:function(s,h,m,y){var b=s.size,A=b===void 0?10:b;return Array.isArray(A)?[A[0]]:[A]}}})}}]),r}(bs);function gA(e){var i=yA();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function yA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _A=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,xA=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
uniform float u_opacitylinear: 0.0;
uniform float u_dir: 1.0;
varying vec3 v_linear;
varying vec2 v_pos;


void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,bA=`attribute vec4 a_Color;
attribute vec3 a_Position;



uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

uniform float u_opacitylinear: 0.0;

attribute vec3 a_linear;
varying vec3 v_linear;
varying vec2 v_pos;

void main() {
  if(u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}`,EA=`attribute vec4 a_Color;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,SA=function(e){(0,pn.Z)(r,e);var i=gA(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,h=s===void 0?1:s,m=a.opacityLinear,y=m===void 0?{enable:!1,dir:"in"}:m;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:h})){this.judgeStyleAttributes({opacity:h});var b=this.layer.getEncodedData(),A=this.calDataFrame(this.cellLength,b,this.cellProperties),P=A.data,k=A.width,F=A.height;this.rowCount=F,this.dataTexture=this.cellLength>0&&P.length>0?this.createTexture2D({flipY:!0,data:P,format:ee.LUMINANCE,type:ee.FLOAT,width:k,height:F}):this.createTexture2D({flipY:!0,data:[1],format:ee.LUMINANCE,type:ee.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:za()(h)?h:1,u_opacitylinear:Number(y.enable),u_dir:y.dir==="in"?1:0}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.opacityLinear,h=s===void 0?{enable:!1,dir:"in"}:s,m=a.mask,y=m===void 0?!1:m,b=a.maskInside,A=b===void 0?!0:b;return[this.layer.buildLayerModel({moduleName:"polygon",vertexShader:h.enable?bA:EA,fragmentShader:h.enable?xA:_A,triangulation:h.enable?PE:ME,blend:this.getBlend(),depth:{enable:!1},stencil:Ot(y,A)})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getLayerConfig(),s=a.opacityLinear,h=s===void 0?{enable:!1,dir:"in"}:s;h.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:Jn.Attribute,descriptor:{name:"a_linear",buffer:{usage:ee.STATIC_DRAW,data:[],type:ee.FLOAT},size:3,update:function(y,b,A,P,k){return[A[3],A[4],A[5]]}}})}}]),r}(bs),CA={fill:SA,line:Cy,extrude:mA,text:zy,point_fill:wy,point_image:Ty,point_normal:My,point_extrude:Ay},AA=CA;function wA(e){var i=TA();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function TA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Uy=function(e){(0,pn.Z)(r,e);var i=wA(r);function r(){var n;(0,lt.Z)(this,r);for(var a=arguments.length,s=new Array(a),h=0;h<a;h++)s[h]=arguments[h];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,xe.Z)(n),"type","PolygonLayer"),n}return(0,It.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new AA[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var a,s=this.styleAttributeService.getLayerStyleAttribute("shape"),h=s==null||(a=s.scale)===null||a===void 0?void 0:a.field;return h==="fill"?"fill":h==="extrude"?"extrude":h==="line"?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var a=this.getEncodedData(),s=this.getLayerConfig(),h=s.shape2d,m=s.shape3d,y=this.iconService.getIconMap(),b=a.find(function(P){return P.hasOwnProperty("shape")});if(b){var A=b.shape;return A==="dot"?"point_normal":(h==null?void 0:h.indexOf(A))!==-1?"point_fill":(m==null?void 0:m.indexOf(A))!==-1?"point_extrude":y.hasOwnProperty(A)?"point_image":"text"}else return"fill"}}]),r}(wp);function MA(e){var i=PA();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function PA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var IA=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;

void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue)
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }


}
`,OA=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,Zy=function(e){(0,pn.Z)(r,e);var i=MA(r);function r(){var n;(0,lt.Z)(this,r);for(var a=arguments.length,s=new Array(a),h=0;h<a;h++)s[h]=arguments[h];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,xe.Z)(n),"texture",void 0),(0,I.Z)((0,xe.Z)(n),"colorTexture",void 0),n}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,h=s===void 0?1:s,m=a.clampLow,y=m===void 0?!0:m,b=a.clampHigh,A=b===void 0?!0:b,P=a.noDataValue,k=P===void 0?-9999999:P,F=a.domain,q=F===void 0?[0,1]:F;return this.updateColorTexure(),{u_opacity:h||1,u_texture:this.texture,u_domain:q,u_clampLow:y,u_clampHigh:typeof A!="undefined"?A:y,u_noDataValue:k,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,h=s===void 0?!1:s,m=a.maskInside,y=m===void 0?!0:m,b=this.layer.getSource(),A=this.rendererService.createTexture2D,P=b.data.dataArray[0];this.texture=A({data:P.data,width:P.width,height:P.height,format:ee.LUMINANCE,type:ee.FLOAT});var k=this.layer.getLayerConfig(),F=k.rampColors,q=rt(F);return this.colorTexture=A({data:q.data,width:q.width,height:q.height,flipY:!1}),[this.layer.buildLayerModel({moduleName:"RasterImageData",vertexShader:OA,fragmentShader:IA,triangulation:yy,primitive:ee.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:Ot(h,y)})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Jn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:2,update:function(s,h,m,y){return[m[3],m[4]]}}})}},{key:"updateColorTexure",value:function(){var a=this.rendererService.createTexture2D,s=this.layer.getLayerConfig(),h=s.rampColors,m=rt(h);this.colorTexture=a({data:m.data,width:m.width,height:m.height,flipY:!1})}}]),r}(bs),RA={raster:Zy,raster3d:Zy},LA=RA;function kA(e){var i=DA();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function DA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var FA=function(e){(0,pn.Z)(r,e);var i=kA(r);function r(){var n;(0,lt.Z)(this,r);for(var a=arguments.length,s=new Array(a),h=0;h<a;h++)s[h]=arguments[h];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,xe.Z)(n),"type","RasterLayer"),n}return(0,It.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new LA[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={raster:{},raster3d:{}};return s[a]}},{key:"getModelType",value:function(){return"raster"}}]),r}(wp),jy,Vy,Gy,Hy,Wy,iv,Xy,Yy,qy;function Ky(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function BA(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Ky(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ky(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var NA=(jy=(0,Lr.b2)(),Vy=(0,Lr.f3)($t.IGlobalConfigService),Gy=(0,Lr.f3)($t.IMapService),Hy=(0,Lr.f3)($t.IFontService),jy(Wy=(iv=function(){function e(){(0,lt.Z)(this,e),Vn(this,"configService",Xy,this),Vn(this,"mapService",Yy,this),Vn(this,"fontService",qy,this)}return(0,It.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("DataMappingPlugin",function(){a.generateMaping(r,{styleAttributeService:s})}),r.hooks.beforeRenderData.tap("DataMappingPlugin",function(){return r.dataState.dataMappingNeedUpdate=!1,a.generateMaping(r,{styleAttributeService:s}),!0}),r.hooks.beforeRender.tap("DataMappingPlugin",function(){if(!r.layerModelNeedUpdate){var h=r.getBottomColor(),m=s.getLayerStyleAttributes()||[],y=s.getLayerStyleAttribute("filter"),b=r.getSource().data.dataArray,A=m.filter(function(k){return k.needRemapping}),P=b;y!=null&&y.needRemapping&&y!==null&&y!==void 0&&y.scale&&(P=b.filter(function(k){return a.applyAttributeMapping(y,k,h)[0]})),A.length&&(y!=null&&y.needRemapping?(r.setEncodedData(a.mapping(m,P,void 0,h)),y.needRemapping=!1):r.setEncodedData(a.mapping(A,P,r.getEncodedData(),h)),r.emit("remapping",null))}})}},{key:"generateMaping",value:function(r,n){var a=this,s=n.styleAttributeService,h=r.getBottomColor(),m=s.getLayerStyleAttributes()||[],y=s.getLayerStyleAttribute("filter"),b=r.getSource().data.dataArray,A=b;y!=null&&y.scale&&(A=b.filter(function(P){return a.applyAttributeMapping(y,P,h)[0]})),r.setEncodedData(this.mapping(m,A,void 0,h))}},{key:"mapping",value:function(r,n,a,s){var h=this,m=n.map(function(y,b){var A=a?a[b]:{},P=BA({id:y._id,coordinates:y.coordinates},A);return r.filter(function(k){return k.scale!==void 0}).forEach(function(k){var F=h.applyAttributeMapping(k,y,s);k.needRemapping=!1,k.name==="color"&&(F=F.map(function(q){return Be(q)})),P[k.name]=Array.isArray(F)&&F.length===1?F[0]:F,k.name==="shape"&&(P.shape=h.fontService.getIconFontKey(P[k.name]))}),P});return m.length>0&&this.mapService.version==="GAODE2.x"&&(typeof m[0].coordinates[0]=="number"?m.filter(function(y){return!y.originCoordinates}).map(function(y){y.version="GAODE2.x",y.originCoordinates=bo()(y.coordinates),y.coordinates=h.mapService.lngLatToCoord(y.coordinates)}):m.filter(function(y){return!y.originCoordinates}).map(function(y){y.version="GAODE2.x",y.originCoordinates=bo()(y.coordinates),y.coordinates=h.mapService.lngLatToCoords(y.coordinates)})),m}},{key:"applyAttributeMapping",value:function(r,n,a){var s;if(!r.scale)return[];var h=(r==null||(s=r.scale)===null||s===void 0?void 0:s.scalers)||[],m=[];h.forEach(function(b){var A,P=b.field;(n.hasOwnProperty(P)||((A=r.scale)===null||A===void 0?void 0:A.type)==="variable")&&m.push(n[P])});var y=r.mapping?r.mapping(m):[];return r.name==="color"&&!Re(y[0])?[a]:y}}]),e}(),Xy=wn(iv.prototype,"configService",[Vy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yy=wn(iv.prototype,"mapService",[Gy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qy=wn(iv.prototype,"fontService",[Hy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iv))||Wy),$y,Jy,zA=($y=(0,Lr.b2)(),$y(Jy=function(){function e(){(0,lt.Z)(this,e),(0,I.Z)(this,"mapService",void 0)}return(0,It.Z)(e,[{key:"apply",value:function(r){var n=this;this.mapService=r.getContainer().get($t.IMapService),r.hooks.init.tap("DataSourcePlugin",function(){var a=r.getSource();if(!a){var s=r.sourceOption||{data:Ah,options:Vp},h=s.data,m=s.options;r.setSource(new Md(h,m))}n.updateClusterData(r)}),r.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var a=n.updateClusterData(r),s=r.dataState.dataSourceNeedUpdate;return r.dataState.dataSourceNeedUpdate=!1,a||s})}},{key:"updateClusterData",value:function(r){var n=r.getSource(),a=n.cluster,s=n.clusterOptions,h=s.zoom,m=h===void 0?0:h,y=s.maxZoom,b=y===void 0?16:y,A=this.mapService.getZoom()-1,P=r.dataState.dataSourceNeedUpdate;return a&&(P||Math.abs(r.clusterZoom-A)>=1)?(m!==Math.floor(A)&&n.updateClusterData(Math.floor(A)),r.clusterZoom=A,!0):!1}}]),e}())||Jy);function Nm(e,i){return e<i?-1:e>i?1:e>=i?0:NaN}function Qy(e){return e.length===1&&(e=UA(e)),{left:function(i,r,n,a){for(n==null&&(n=0),a==null&&(a=i.length);n<a;){var s=n+a>>>1;e(i[s],r)<0?n=s+1:a=s}return n},right:function(i,r,n,a){for(n==null&&(n=0),a==null&&(a=i.length);n<a;){var s=n+a>>>1;e(i[s],r)>0?a=s:n=s+1}return n}}}function UA(e){return function(i,r){return Nm(e(i),r)}}var e_=Qy(Nm),ZA=e_.right,W5=e_.left,Wv=ZA;function jA(e,i){var r=e.length,n=-1,a,s,h;if(i==null){for(;++n<r;)if((a=e[n])!=null&&a>=a)for(s=h=a;++n<r;)(a=e[n])!=null&&(s>a&&(s=a),h<a&&(h=a))}else for(;++n<r;)if((a=i(e[n],n,e))!=null&&a>=a)for(s=h=a;++n<r;)(a=i(e[n],n,e))!=null&&(s>a&&(s=a),h<a&&(h=a));return[s,h]}var t_=Array.prototype,X5=t_.slice,Y5=t_.map,zm=Math.sqrt(50),Um=Math.sqrt(10),Zm=Math.sqrt(2);function r_(e,i,r){var n,a=-1,s,h,m;if(i=+i,e=+e,r=+r,e===i&&r>0)return[e];if((n=i<e)&&(s=e,e=i,i=s),(m=Xv(e,i,r))===0||!isFinite(m))return[];if(m>0)for(e=Math.ceil(e/m),i=Math.floor(i/m),h=new Array(s=Math.ceil(i-e+1));++a<s;)h[a]=(e+a)*m;else for(e=Math.floor(e*m),i=Math.ceil(i*m),h=new Array(s=Math.ceil(e-i+1));++a<s;)h[a]=(e-a)/m;return n&&h.reverse(),h}function Xv(e,i,r){var n=(i-e)/Math.max(0,r),a=Math.floor(Math.log(n)/Math.LN10),s=n/Math.pow(10,a);return a>=0?(s>=zm?10:s>=Um?5:s>=Zm?2:1)*Math.pow(10,a):-Math.pow(10,-a)/(s>=zm?10:s>=Um?5:s>=Zm?2:1)}function jm(e,i,r){var n=Math.abs(i-e)/Math.max(0,r),a=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),s=n/a;return s>=zm?a*=10:s>=Um?a*=5:s>=Zm&&(a*=2),i<e?-a:a}function q5(){var e=identity,i=extent,r=sturges;function n(a){var s,h=a.length,m,y=new Array(h);for(s=0;s<h;++s)y[s]=e(a[s],s,a);var b=i(y),A=b[0],P=b[1],k=r(y,A,P);Array.isArray(k)||(k=tickStep(A,P,k),k=range(Math.ceil(A/k)*k,P,k));for(var F=k.length;k[0]<=A;)k.shift(),--F;for(;k[F-1]>P;)k.pop(),--F;var q=new Array(F+1),oe;for(s=0;s<=F;++s)oe=q[s]=[],oe.x0=s>0?k[s-1]:A,oe.x1=s<F?k[s]:P;for(s=0;s<h;++s)m=y[s],A<=m&&m<=P&&q[bisect(k,m,0,F)].push(a[s]);return q}return n.value=function(a){return arguments.length?(e=typeof a=="function"?a:constant(a),n):e},n.domain=function(a){return arguments.length?(i=typeof a=="function"?a:constant([a[0],a[1]]),n):i},n.thresholds=function(a){return arguments.length?(r=typeof a=="function"?a:Array.isArray(a)?constant(slice.call(a)):constant(a),n):r},n}function K5(e,i,r){return e=map.call(e,number).sort(ascending),Math.ceil((r-i)/(2*(quantile(e,.75)-quantile(e,.25))*Math.pow(e.length,-1/3)))}function VA(e){return e===null?NaN:+e}function GA(e,i,r){if(r==null&&(r=VA),!!(n=e.length)){if((i=+i)<=0||n<2)return+r(e[0],0,e);if(i>=1)return+r(e[n-1],n-1,e);var n,a=(n-1)*i,s=Math.floor(a),h=+r(e[s],s,e),m=+r(e[s+1],s+1,e);return h+(m-h)*(a-s)}}var yc="$";function Yv(){}Yv.prototype=n_.prototype={constructor:Yv,has:function(e){return yc+e in this},get:function(e){return this[yc+e]},set:function(e,i){return this[yc+e]=i,this},remove:function(e){var i=yc+e;return i in this&&delete this[i]},clear:function(){for(var e in this)e[0]===yc&&delete this[e]},keys:function(){var e=[];for(var i in this)i[0]===yc&&e.push(i.slice(1));return e},values:function(){var e=[];for(var i in this)i[0]===yc&&e.push(this[i]);return e},entries:function(){var e=[];for(var i in this)i[0]===yc&&e.push({key:i.slice(1),value:this[i]});return e},size:function(){var e=0;for(var i in this)i[0]===yc&&++e;return e},empty:function(){for(var e in this)if(e[0]===yc)return!1;return!0},each:function(e){for(var i in this)i[0]===yc&&e(this[i],i.slice(1),this)}};function n_(e,i){var r=new Yv;if(e instanceof Yv)e.each(function(m,y){r.set(y,m)});else if(Array.isArray(e)){var n=-1,a=e.length,s;if(i==null)for(;++n<a;)r.set(n,e[n]);else for(;++n<a;)r.set(i(s=e[n],n,e),s)}else if(e)for(var h in e)r.set(h,e[h]);return r}var Vm=n_;function $5(){var e=[],i=[],r,n,a;function s(m,y,b,A){if(y>=e.length)return r!=null&&m.sort(r),n!=null?n(m):m;for(var P=-1,k=m.length,F=e[y++],q,oe,ue=map(),Pe,et=b();++P<k;)(Pe=ue.get(q=F(oe=m[P])+""))?Pe.push(oe):ue.set(q,[oe]);return ue.each(function(at,_t){A(et,_t,s(at,y,b,A))}),et}function h(m,y){if(++y>e.length)return m;var b,A=i[y-1];return n!=null&&y>=e.length?b=m.entries():(b=[],m.each(function(P,k){b.push({key:k,values:h(P,y)})})),A!=null?b.sort(function(P,k){return A(P.key,k.key)}):b}return a={object:function(m){return s(m,0,HA,WA)},map:function(m){return s(m,0,i_,a_)},entries:function(m){return h(s(m,0,i_,a_),0)},key:function(m){return e.push(m),a},sortKeys:function(m){return i[e.length-1]=m,a},sortValues:function(m){return r=m,a},rollup:function(m){return n=m,a}}}function HA(){return{}}function WA(e,i,r){e[i]=r}function i_(){return map()}function a_(e,i,r){e.set(i,r)}function qv(){}var Op=Vm.prototype;qv.prototype=XA.prototype={constructor:qv,has:Op.has,add:function(e){return e+="",this[yc+e]=e,this},remove:Op.remove,clear:Op.clear,values:Op.keys,size:Op.size,empty:Op.empty,each:Op.each};function XA(e,i){var r=new qv;if(e instanceof qv)e.each(function(s){r.add(s)});else if(e){var n=-1,a=e.length;if(i==null)for(;++n<a;)r.add(e[n]);else for(;++n<a;)r.add(i(e[n],n,e))}return r}var J5=null,o_=Array.prototype,Kv=o_.map,Rp=o_.slice;function Hh(e,i){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(i).domain(e);break}return this}function Q5(e,i){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(i).domain(e);break}return this}var s_={name:"implicit"};function $v(){var e=Vm(),i=[],r=[],n=s_;function a(s){var h=s+"",m=e.get(h);if(!m){if(n!==s_)return n;e.set(h,m=i.push(s))}return r[(m-1)%r.length]}return a.domain=function(s){if(!arguments.length)return i.slice();i=[],e=Vm();for(var h=-1,m=s.length,y,b;++h<m;)e.has(b=(y=s[h])+"")||e.set(b,i.push(y));return a},a.range=function(s){return arguments.length?(r=Rp.call(s),a):r.slice()},a.unknown=function(s){return arguments.length?(n=s,a):n},a.copy=function(){return $v(i,r).unknown(n)},Hh.apply(a,arguments),a}function u_(){var e=ordinal().unknown(void 0),i=e.domain,r=e.range,n=[0,1],a,s,h=!1,m=0,y=0,b=.5;delete e.unknown;function A(){var P=i().length,k=n[1]<n[0],F=n[k-0],q=n[1-k];a=(q-F)/Math.max(1,P-m+y*2),h&&(a=Math.floor(a)),F+=(q-F-a*(P-m))*b,s=a*(1-m),h&&(F=Math.round(F),s=Math.round(s));var oe=sequence(P).map(function(ue){return F+a*ue});return r(k?oe.reverse():oe)}return e.domain=function(P){return arguments.length?(i(P),A()):i()},e.range=function(P){return arguments.length?(n=[+P[0],+P[1]],A()):n.slice()},e.rangeRound=function(P){return n=[+P[0],+P[1]],h=!0,A()},e.bandwidth=function(){return s},e.step=function(){return a},e.round=function(P){return arguments.length?(h=!!P,A()):h},e.padding=function(P){return arguments.length?(m=Math.min(1,y=+P),A()):m},e.paddingInner=function(P){return arguments.length?(m=Math.min(1,P),A()):m},e.paddingOuter=function(P){return arguments.length?(y=+P,A()):y},e.align=function(P){return arguments.length?(b=Math.max(0,Math.min(1,P)),A()):b},e.copy=function(){return u_(i(),n).round(h).paddingInner(m).paddingOuter(y).align(b)},initRange.apply(A(),arguments)}function l_(e){var i=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return l_(i())},e}function e3(){return l_(u_.apply(null,arguments).paddingInner(1))}var YA=R(26257),qA=R(73626);function KA(e,i){return e=+e,i=+i,function(r){return Math.round(e*(1-r)+i*r)}}function $A(e){return function(){return e}}function Gm(e){return+e}var c_=[0,1];function _c(e){return e}function Hm(e,i){return(i-=e=+e)?function(r){return(r-e)/i}:$A(isNaN(i)?NaN:.5)}function f_(e){var i=e[0],r=e[e.length-1],n;return i>r&&(n=i,i=r,r=n),function(a){return Math.max(i,Math.min(r,a))}}function JA(e,i,r){var n=e[0],a=e[1],s=i[0],h=i[1];return a<n?(n=Hm(a,n),s=r(h,s)):(n=Hm(n,a),s=r(s,h)),function(m){return s(n(m))}}function QA(e,i,r){var n=Math.min(e.length,i.length)-1,a=new Array(n),s=new Array(n),h=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),i=i.slice().reverse());++h<n;)a[h]=Hm(e[h],e[h+1]),s[h]=r(i[h],i[h+1]);return function(m){var y=Wv(e,m,1,n)-1;return s[y](a[y](m))}}function Jv(e,i){return i.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function Wm(){var e=c_,i=c_,r=YA.Z,n,a,s,h=_c,m,y,b;function A(){return m=Math.min(e.length,i.length)>2?QA:JA,y=b=null,P}function P(k){return isNaN(k=+k)?s:(y||(y=m(e.map(n),i,r)))(n(h(k)))}return P.invert=function(k){return h(a((b||(b=m(i,e.map(n),qA.Z)))(k)))},P.domain=function(k){return arguments.length?(e=Kv.call(k,Gm),h===_c||(h=f_(e)),A()):e.slice()},P.range=function(k){return arguments.length?(i=Rp.call(k),A()):i.slice()},P.rangeRound=function(k){return i=Rp.call(k),r=KA,A()},P.clamp=function(k){return arguments.length?(h=k?f_(e):_c,P):h!==_c},P.interpolate=function(k){return arguments.length?(r=k,A()):r},P.unknown=function(k){return arguments.length?(s=k,P):s},function(k,F){return n=k,a=F,A()}}function h_(e,i){return Wm()(e,i)}var ew=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Qv(e){if(!(i=ew.exec(e)))throw new Error("invalid format: "+e);var i;return new Xm({fill:i[1],align:i[2],sign:i[3],symbol:i[4],zero:i[5],width:i[6],comma:i[7],precision:i[8]&&i[8].slice(1),trim:i[9],type:i[10]})}Qv.prototype=Xm.prototype;function Xm(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}Xm.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function tw(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function em(e,i){if((r=(e=i?e.toExponential(i-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function gd(e){return e=em(Math.abs(e)),e?e[1]:NaN}function rw(e,i){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(gd(i)/3)))*3-gd(Math.abs(e)))}function nw(e,i){return function(r,n){for(var a=r.length,s=[],h=0,m=e[0],y=0;a>0&&m>0&&(y+m+1>n&&(m=Math.max(1,n-y)),s.push(r.substring(a-=m,a+m)),!((y+=m+1)>n));)m=e[h=(h+1)%e.length];return s.reverse().join(i)}}function iw(e){return function(i){return i.replace(/[0-9]/g,function(r){return e[+r]})}}function aw(e){e:for(var i=e.length,r=1,n=-1,a;r<i;++r)switch(e[r]){case".":n=a=r;break;case"0":n===0&&(n=r),a=r;break;default:if(!+e[r])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(a+1):e}var p_;function ow(e,i){var r=em(e,i);if(!r)return e+"";var n=r[0],a=r[1],s=a-(p_=Math.max(-8,Math.min(8,Math.floor(a/3)))*3)+1,h=n.length;return s===h?n:s>h?n+new Array(s-h+1).join("0"):s>0?n.slice(0,s)+"."+n.slice(s):"0."+new Array(1-s).join("0")+em(e,Math.max(0,i+s-1))[0]}function d_(e,i){var r=em(e,i);if(!r)return e+"";var n=r[0],a=r[1];return a<0?"0."+new Array(-a).join("0")+n:n.length>a+1?n.slice(0,a+1)+"."+n.slice(a+1):n+new Array(a-n.length+2).join("0")}var v_={"%":function(e,i){return(e*100).toFixed(i)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:tw,e:function(e,i){return e.toExponential(i)},f:function(e,i){return e.toFixed(i)},g:function(e,i){return e.toPrecision(i)},o:function(e){return Math.round(e).toString(8)},p:function(e,i){return d_(e*100,i)},r:d_,s:ow,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function m_(e){return e}var g_=Array.prototype.map,y_=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function sw(e){var i=e.grouping===void 0||e.thousands===void 0?m_:nw(g_.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",a=e.decimal===void 0?".":e.decimal+"",s=e.numerals===void 0?m_:iw(g_.call(e.numerals,String)),h=e.percent===void 0?"%":e.percent+"",m=e.minus===void 0?"-":e.minus+"",y=e.nan===void 0?"NaN":e.nan+"";function b(P){P=Qv(P);var k=P.fill,F=P.align,q=P.sign,oe=P.symbol,ue=P.zero,Pe=P.width,et=P.comma,at=P.precision,_t=P.trim,Nt=P.type;Nt==="n"?(et=!0,Nt="g"):v_[Nt]||(at===void 0&&(at=12),_t=!0,Nt="g"),(ue||k==="0"&&F==="=")&&(ue=!0,k="0",F="=");var Ht=oe==="$"?r:oe==="#"&&/[boxX]/.test(Nt)?"0"+Nt.toLowerCase():"",nr=oe==="$"?n:/[%p]/.test(Nt)?h:"",mr=v_[Nt],Hr=/[defgprs%]/.test(Nt);at=at===void 0?6:/[gprs]/.test(Nt)?Math.max(1,Math.min(21,at)):Math.max(0,Math.min(20,at));function fn(Or){var Tn=Ht,zn=nr,gi,io,rs;if(Nt==="c")zn=mr(Or)+zn,Or="";else{Or=+Or;var Tu=Or<0||1/Or<0;if(Or=isNaN(Or)?y:mr(Math.abs(Or),at),_t&&(Or=aw(Or)),Tu&&+Or==0&&q!=="+"&&(Tu=!1),Tn=(Tu?q==="("?q:m:q==="-"||q==="("?"":q)+Tn,zn=(Nt==="s"?y_[8+p_/3]:"")+zn+(Tu&&q==="("?")":""),Hr){for(gi=-1,io=Or.length;++gi<io;)if(rs=Or.charCodeAt(gi),48>rs||rs>57){zn=(rs===46?a+Or.slice(gi+1):Or.slice(gi))+zn,Or=Or.slice(0,gi);break}}}et&&!ue&&(Or=i(Or,Infinity));var fl=Tn.length+Or.length+zn.length,Zu=fl<Pe?new Array(Pe-fl+1).join(k):"";switch(et&&ue&&(Or=i(Zu+Or,Zu.length?Pe-zn.length:Infinity),Zu=""),F){case"<":Or=Tn+Or+zn+Zu;break;case"=":Or=Tn+Zu+Or+zn;break;case"^":Or=Zu.slice(0,fl=Zu.length>>1)+Tn+Or+zn+Zu.slice(fl);break;default:Or=Zu+Tn+Or+zn;break}return s(Or)}return fn.toString=function(){return P+""},fn}function A(P,k){var F=b((P=Qv(P),P.type="f",P)),q=Math.max(-8,Math.min(8,Math.floor(gd(k)/3)))*3,oe=Math.pow(10,-q),ue=y_[8+q/3];return function(Pe){return F(oe*Pe)+ue}}return{format:b,formatPrefix:A}}var tm,Ym,__;uw({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function uw(e){return tm=sw(e),Ym=tm.format,__=tm.formatPrefix,tm}function lw(e,i){return e=Math.abs(e),i=Math.abs(i)-e,Math.max(0,gd(i)-gd(e))+1}function cw(e){return Math.max(0,-gd(Math.abs(e)))}function fw(e,i,r,n){var a=jm(e,i,r),s;switch(n=Qv(n==null?",f":n),n.type){case"s":{var h=Math.max(Math.abs(e),Math.abs(i));return n.precision==null&&!isNaN(s=rw(a,h))&&(n.precision=s),__(n,h)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(s=lw(a,Math.max(Math.abs(e),Math.abs(i))))&&(n.precision=s-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(s=cw(a))&&(n.precision=s-(n.type==="%")*2);break}}return Ym(n)}function rm(e){var i=e.domain;return e.ticks=function(r){var n=i();return r_(n[0],n[n.length-1],r==null?10:r)},e.tickFormat=function(r,n){var a=i();return fw(a[0],a[a.length-1],r==null?10:r,n)},e.nice=function(r){r==null&&(r=10);var n=i(),a=0,s=n.length-1,h=n[a],m=n[s],y;return m<h&&(y=h,h=m,m=y,y=a,a=s,s=y),y=Xv(h,m,r),y>0?(h=Math.floor(h/y)*y,m=Math.ceil(m/y)*y,y=Xv(h,m,r)):y<0&&(h=Math.ceil(h*y)/y,m=Math.floor(m*y)/y,y=Xv(h,m,r)),y>0?(n[a]=Math.floor(h/y)*y,n[s]=Math.ceil(m/y)*y,i(n)):y<0&&(n[a]=Math.ceil(h*y)/y,n[s]=Math.floor(m*y)/y,i(n)),e},e}function x_(){var e=h_(_c,_c);return e.copy=function(){return Jv(e,x_())},Hh.apply(e,arguments),rm(e)}function b_(e){var i;function r(n){return isNaN(n=+n)?i:n}return r.invert=r,r.domain=r.range=function(n){return arguments.length?(e=Kv.call(n,Gm),r):e.slice()},r.unknown=function(n){return arguments.length?(i=n,r):i},r.copy=function(){return b_(e).unknown(i)},e=arguments.length?Kv.call(e,Gm):[0,1],rm(r)}function E_(e,i){e=e.slice();var r=0,n=e.length-1,a=e[r],s=e[n],h;return s<a&&(h=r,r=n,n=h,h=a,a=s,s=h),e[r]=i.floor(a),e[n]=i.ceil(s),e}function S_(e){return Math.log(e)}function C_(e){return Math.exp(e)}function hw(e){return-Math.log(-e)}function pw(e){return-Math.exp(-e)}function dw(e){return isFinite(e)?+("1e"+e):e<0?0:e}function vw(e){return e===10?dw:e===Math.E?Math.exp:function(i){return Math.pow(e,i)}}function mw(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(i){return Math.log(i)/e})}function A_(e){return function(i){return-e(-i)}}function gw(e){var i=e(S_,C_),r=i.domain,n=10,a,s;function h(){return a=mw(n),s=vw(n),r()[0]<0?(a=A_(a),s=A_(s),e(hw,pw)):e(S_,C_),i}return i.base=function(m){return arguments.length?(n=+m,h()):n},i.domain=function(m){return arguments.length?(r(m),h()):r()},i.ticks=function(m){var y=r(),b=y[0],A=y[y.length-1],P;(P=A<b)&&(k=b,b=A,A=k);var k=a(b),F=a(A),q,oe,ue,Pe=m==null?10:+m,et=[];if(!(n%1)&&F-k<Pe){if(k=Math.round(k)-1,F=Math.round(F)+1,b>0){for(;k<F;++k)for(oe=1,q=s(k);oe<n;++oe)if(ue=q*oe,!(ue<b)){if(ue>A)break;et.push(ue)}}else for(;k<F;++k)for(oe=n-1,q=s(k);oe>=1;--oe)if(ue=q*oe,!(ue<b)){if(ue>A)break;et.push(ue)}}else et=r_(k,F,Math.min(F-k,Pe)).map(s);return P?et.reverse():et},i.tickFormat=function(m,y){if(y==null&&(y=n===10?".0e":","),typeof y!="function"&&(y=Ym(y)),m===Infinity)return y;m==null&&(m=10);var b=Math.max(1,n*m/i.ticks().length);return function(A){var P=A/s(Math.round(a(A)));return P*n<n-.5&&(P*=n),P<=b?y(A):""}},i.nice=function(){return r(E_(r(),{floor:function(m){return s(Math.floor(a(m)))},ceil:function(m){return s(Math.ceil(a(m)))}}))},i}function w_(){var e=gw(Wm()).domain([1,10]);return e.copy=function(){return Jv(e,w_()).base(e.base())},Hh.apply(e,arguments),e}function T_(e){return function(i){return Math.sign(i)*Math.log1p(Math.abs(i/e))}}function M_(e){return function(i){return Math.sign(i)*Math.expm1(Math.abs(i))*e}}function yw(e){var i=1,r=e(T_(i),M_(i));return r.constant=function(n){return arguments.length?e(T_(i=+n),M_(i)):i},linearish(r)}function _w(){var e=yw(transformer());return e.copy=function(){return copy(e,_w()).constant(e.constant())},initRange.apply(e,arguments)}function P_(e){return function(i){return i<0?-Math.pow(-i,e):Math.pow(i,e)}}function xw(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function bw(e){return e<0?-e*e:e*e}function Ew(e){var i=e(_c,_c),r=1;function n(){return r===1?e(_c,_c):r===.5?e(xw,bw):e(P_(r),P_(1/r))}return i.exponent=function(a){return arguments.length?(r=+a,n()):r},rm(i)}function qm(){var e=Ew(Wm());return e.copy=function(){return Jv(e,qm()).exponent(e.exponent())},Hh.apply(e,arguments),e}function t3(){return qm.apply(null,arguments).exponent(.5)}function I_(){var e=[],i=[],r=[],n;function a(){var h=0,m=Math.max(1,i.length);for(r=new Array(m-1);++h<m;)r[h-1]=GA(e,h/m);return s}function s(h){return isNaN(h=+h)?n:i[Wv(r,h)]}return s.invertExtent=function(h){var m=i.indexOf(h);return m<0?[NaN,NaN]:[m>0?r[m-1]:e[0],m<r.length?r[m]:e[e.length-1]]},s.domain=function(h){if(!arguments.length)return e.slice();e=[];for(var m=0,y=h.length,b;m<y;++m)b=h[m],b!=null&&!isNaN(b=+b)&&e.push(b);return e.sort(Nm),a()},s.range=function(h){return arguments.length?(i=Rp.call(h),a()):i.slice()},s.unknown=function(h){return arguments.length?(n=h,s):n},s.quantiles=function(){return r.slice()},s.copy=function(){return I_().domain(e).range(i).unknown(n)},Hh.apply(s,arguments)}function O_(){var e=0,i=1,r=1,n=[.5],a=[0,1],s;function h(y){return y<=y?a[Wv(n,y,0,r)]:s}function m(){var y=-1;for(n=new Array(r);++y<r;)n[y]=((y+1)*i-(y-r)*e)/(r+1);return h}return h.domain=function(y){return arguments.length?(e=+y[0],i=+y[1],m()):[e,i]},h.range=function(y){return arguments.length?(r=(a=Rp.call(y)).length-1,m()):a.slice()},h.invertExtent=function(y){var b=a.indexOf(y);return b<0?[NaN,NaN]:b<1?[e,n[0]]:b>=r?[n[r-1],i]:[n[b-1],n[b]]},h.unknown=function(y){return arguments.length&&(s=y),h},h.thresholds=function(){return n.slice()},h.copy=function(){return O_().domain([e,i]).range(a).unknown(s)},Hh.apply(rm(h),arguments)}function R_(){var e=[.5],i=[0,1],r,n=1;function a(s){return s<=s?i[Wv(e,s,0,n)]:r}return a.domain=function(s){return arguments.length?(e=Rp.call(s),n=Math.min(e.length,i.length-1),a):e.slice()},a.range=function(s){return arguments.length?(i=Rp.call(s),n=Math.min(e.length,i.length-1),a):i.slice()},a.invertExtent=function(s){var h=i.indexOf(s);return[e[h-1],e[h]]},a.unknown=function(s){return arguments.length?(r=s,a):r},a.copy=function(){return R_().domain(e).range(i).unknown(r)},Hh.apply(a,arguments)}var Km=new Date,$m=new Date;function cl(e,i,r,n){function a(s){return e(s=arguments.length===0?new Date:new Date(+s)),s}return a.floor=function(s){return e(s=new Date(+s)),s},a.ceil=function(s){return e(s=new Date(s-1)),i(s,1),e(s),s},a.round=function(s){var h=a(s),m=a.ceil(s);return s-h<m-s?h:m},a.offset=function(s,h){return i(s=new Date(+s),h==null?1:Math.floor(h)),s},a.range=function(s,h,m){var y=[],b;if(s=a.ceil(s),m=m==null?1:Math.floor(m),!(s<h)||!(m>0))return y;do y.push(b=new Date(+s)),i(s,m),e(s);while(b<s&&s<h);return y},a.filter=function(s){return cl(function(h){if(h>=h)for(;e(h),!s(h);)h.setTime(h-1)},function(h,m){if(h>=h)if(m<0)for(;++m<=0;)for(;i(h,-1),!s(h););else for(;--m>=0;)for(;i(h,1),!s(h););})},r&&(a.count=function(s,h){return Km.setTime(+s),$m.setTime(+h),e(Km),e($m),Math.floor(r(Km,$m))},a.every=function(s){return s=Math.floor(s),!isFinite(s)||!(s>0)?null:s>1?a.filter(n?function(h){return n(h)%s==0}:function(h){return a.count(0,h)%s==0}):a}),a}var Jm=cl(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,i){e.setFullYear(e.getFullYear()+i)},function(e,i){return i.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});Jm.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:cl(function(i){i.setFullYear(Math.floor(i.getFullYear()/e)*e),i.setMonth(0,1),i.setHours(0,0,0,0)},function(i,r){i.setFullYear(i.getFullYear()+r*e)})};var yd=Jm,r3=Jm.range,L_=cl(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,i){e.setMonth(e.getMonth()+i)},function(e,i){return i.getMonth()-e.getMonth()+(i.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),Sw=L_,n3=L_.range,nm=1e3,av=6e4,k_=36e5,D_=864e5,F_=6048e5;function Lp(e){return cl(function(i){i.setDate(i.getDate()-(i.getDay()+7-e)%7),i.setHours(0,0,0,0)},function(i,r){i.setDate(i.getDate()+r*7)},function(i,r){return(r-i-(r.getTimezoneOffset()-i.getTimezoneOffset())*av)/F_})}var Qm=Lp(0),im=Lp(1),Cw=Lp(2),Aw=Lp(3),_d=Lp(4),ww=Lp(5),Tw=Lp(6),i3=Qm.range,a3=im.range,o3=Cw.range,s3=Aw.range,u3=_d.range,l3=ww.range,c3=Tw.range,B_=cl(function(e){e.setHours(0,0,0,0)},function(e,i){e.setDate(e.getDate()+i)},function(e,i){return(i-e-(i.getTimezoneOffset()-e.getTimezoneOffset())*av)/D_},function(e){return e.getDate()-1}),e0=B_,f3=B_.range,N_=cl(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*nm-e.getMinutes()*av)},function(e,i){e.setTime(+e+i*k_)},function(e,i){return(i-e)/k_},function(e){return e.getHours()}),Mw=N_,h3=N_.range,z_=cl(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*nm)},function(e,i){e.setTime(+e+i*av)},function(e,i){return(i-e)/av},function(e){return e.getMinutes()}),Pw=z_,p3=z_.range,U_=cl(function(e){e.setTime(e-e.getMilliseconds())},function(e,i){e.setTime(+e+i*nm)},function(e,i){return(i-e)/nm},function(e){return e.getUTCSeconds()}),Iw=U_,d3=U_.range,am=cl(function(){},function(e,i){e.setTime(+e+i)},function(e,i){return i-e});am.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?cl(function(i){i.setTime(Math.floor(i/e)*e)},function(i,r){i.setTime(+i+r*e)},function(i,r){return(r-i)/e}):am};var Ow=am,v3=am.range;function kp(e){return cl(function(i){i.setUTCDate(i.getUTCDate()-(i.getUTCDay()+7-e)%7),i.setUTCHours(0,0,0,0)},function(i,r){i.setUTCDate(i.getUTCDate()+r*7)},function(i,r){return(r-i)/F_})}var Z_=kp(0),om=kp(1),Rw=kp(2),Lw=kp(3),xd=kp(4),kw=kp(5),Dw=kp(6),m3=Z_.range,g3=om.range,y3=Rw.range,_3=Lw.range,x3=xd.range,b3=kw.range,E3=Dw.range,j_=cl(function(e){e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCDate(e.getUTCDate()+i)},function(e,i){return(i-e)/D_},function(e){return e.getUTCDate()-1}),V_=j_,S3=j_.range,t0=cl(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCFullYear(e.getUTCFullYear()+i)},function(e,i){return i.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});t0.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:cl(function(i){i.setUTCFullYear(Math.floor(i.getUTCFullYear()/e)*e),i.setUTCMonth(0,1),i.setUTCHours(0,0,0,0)},function(i,r){i.setUTCFullYear(i.getUTCFullYear()+r*e)})};var ov=t0,C3=t0.range;function r0(e){if(0<=e.y&&e.y<100){var i=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return i.setFullYear(e.y),i}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function n0(e){if(0<=e.y&&e.y<100){var i=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return i.setUTCFullYear(e.y),i}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function sv(e,i,r){return{y:e,m:i,d:r,H:0,M:0,S:0,L:0}}function Fw(e){var i=e.dateTime,r=e.date,n=e.time,a=e.periods,s=e.days,h=e.shortDays,m=e.months,y=e.shortMonths,b=uv(a),A=lv(a),P=uv(s),k=lv(s),F=uv(h),q=lv(h),oe=uv(m),ue=lv(m),Pe=uv(y),et=lv(y),at={a:Tu,A:fl,b:Zu,B:Cd,c:null,d:q_,e:q_,f:aT,g:vT,G:gT,H:rT,I:nT,j:iT,L:K_,m:oT,M:sT,p:f5,q:h5,Q:r1,s:n1,S:uT,u:lT,U:cT,V:fT,w:hT,W:pT,x:null,X:null,y:dT,Y:mT,Z:yT,"%":t1},_t={a:p5,A:d5,b:v5,B:m5,c:null,d:J_,e:J_,f:ET,g:RT,G:kT,H:_T,I:xT,j:bT,L:Q_,m:ST,M:CT,p:g5,q:y5,Q:r1,s:n1,S:AT,u:wT,U:TT,V:MT,w:PT,W:IT,x:null,X:null,y:OT,Y:LT,Z:DT,"%":t1},Nt={a:fn,A:Or,b:Tn,B:zn,c:gi,d:X_,e:X_,f:Jw,g:W_,G:H_,H:Y_,I:Y_,j:Yw,L:$w,m:Xw,M:qw,p:Hr,q:Ww,Q:eT,s:tT,S:Kw,u:Zw,U:jw,V:Vw,w:Uw,W:Gw,x:io,X:rs,y:W_,Y:H_,Z:Hw,"%":Qw};at.x=Ht(r,at),at.X=Ht(n,at),at.c=Ht(i,at),_t.x=Ht(r,_t),_t.X=Ht(n,_t),_t.c=Ht(i,_t);function Ht(ui,Ua){return function(ao){var xn=[],wl=-1,Yo=0,Gl=ui.length,Hl,Bp,Gx;for(ao instanceof Date||(ao=new Date(+ao));++wl<Gl;)ui.charCodeAt(wl)===37&&(xn.push(ui.slice(Yo,wl)),(Bp=G_[Hl=ui.charAt(++wl)])!=null?Hl=ui.charAt(++wl):Bp=Hl==="e"?" ":"0",(Gx=Ua[Hl])&&(Hl=Gx(ao,Bp)),xn.push(Hl),Yo=wl+1);return xn.push(ui.slice(Yo,wl)),xn.join("")}}function nr(ui,Ua){return function(ao){var xn=sv(1900,void 0,1),wl=mr(xn,ui,ao+="",0),Yo,Gl;if(wl!=ao.length)return null;if("Q"in xn)return new Date(xn.Q);if("s"in xn)return new Date(xn.s*1e3+("L"in xn?xn.L:0));if(Ua&&!("Z"in xn)&&(xn.Z=0),"p"in xn&&(xn.H=xn.H%12+xn.p*12),xn.m===void 0&&(xn.m="q"in xn?xn.q:0),"V"in xn){if(xn.V<1||xn.V>53)return null;"w"in xn||(xn.w=1),"Z"in xn?(Yo=n0(sv(xn.y,0,1)),Gl=Yo.getUTCDay(),Yo=Gl>4||Gl===0?om.ceil(Yo):om(Yo),Yo=V_.offset(Yo,(xn.V-1)*7),xn.y=Yo.getUTCFullYear(),xn.m=Yo.getUTCMonth(),xn.d=Yo.getUTCDate()+(xn.w+6)%7):(Yo=r0(sv(xn.y,0,1)),Gl=Yo.getDay(),Yo=Gl>4||Gl===0?im.ceil(Yo):im(Yo),Yo=e0.offset(Yo,(xn.V-1)*7),xn.y=Yo.getFullYear(),xn.m=Yo.getMonth(),xn.d=Yo.getDate()+(xn.w+6)%7)}else("W"in xn||"U"in xn)&&("w"in xn||(xn.w="u"in xn?xn.u%7:"W"in xn?1:0),Gl="Z"in xn?n0(sv(xn.y,0,1)).getUTCDay():r0(sv(xn.y,0,1)).getDay(),xn.m=0,xn.d="W"in xn?(xn.w+6)%7+xn.W*7-(Gl+5)%7:xn.w+xn.U*7-(Gl+6)%7);return"Z"in xn?(xn.H+=xn.Z/100|0,xn.M+=xn.Z%100,n0(xn)):r0(xn)}}function mr(ui,Ua,ao,xn){for(var wl=0,Yo=Ua.length,Gl=ao.length,Hl,Bp;wl<Yo;){if(xn>=Gl)return-1;if(Hl=Ua.charCodeAt(wl++),Hl===37){if(Hl=Ua.charAt(wl++),Bp=Nt[Hl in G_?Ua.charAt(wl++):Hl],!Bp||(xn=Bp(ui,ao,xn))<0)return-1}else if(Hl!=ao.charCodeAt(xn++))return-1}return xn}function Hr(ui,Ua,ao){var xn=b.exec(Ua.slice(ao));return xn?(ui.p=A[xn[0].toLowerCase()],ao+xn[0].length):-1}function fn(ui,Ua,ao){var xn=F.exec(Ua.slice(ao));return xn?(ui.w=q[xn[0].toLowerCase()],ao+xn[0].length):-1}function Or(ui,Ua,ao){var xn=P.exec(Ua.slice(ao));return xn?(ui.w=k[xn[0].toLowerCase()],ao+xn[0].length):-1}function Tn(ui,Ua,ao){var xn=Pe.exec(Ua.slice(ao));return xn?(ui.m=et[xn[0].toLowerCase()],ao+xn[0].length):-1}function zn(ui,Ua,ao){var xn=oe.exec(Ua.slice(ao));return xn?(ui.m=ue[xn[0].toLowerCase()],ao+xn[0].length):-1}function gi(ui,Ua,ao){return mr(ui,i,Ua,ao)}function io(ui,Ua,ao){return mr(ui,r,Ua,ao)}function rs(ui,Ua,ao){return mr(ui,n,Ua,ao)}function Tu(ui){return h[ui.getDay()]}function fl(ui){return s[ui.getDay()]}function Zu(ui){return y[ui.getMonth()]}function Cd(ui){return m[ui.getMonth()]}function f5(ui){return a[+(ui.getHours()>=12)]}function h5(ui){return 1+~~(ui.getMonth()/3)}function p5(ui){return h[ui.getUTCDay()]}function d5(ui){return s[ui.getUTCDay()]}function v5(ui){return y[ui.getUTCMonth()]}function m5(ui){return m[ui.getUTCMonth()]}function g5(ui){return a[+(ui.getUTCHours()>=12)]}function y5(ui){return 1+~~(ui.getUTCMonth()/3)}return{format:function(ui){var Ua=Ht(ui+="",at);return Ua.toString=function(){return ui},Ua},parse:function(ui){var Ua=nr(ui+="",!1);return Ua.toString=function(){return ui},Ua},utcFormat:function(ui){var Ua=Ht(ui+="",_t);return Ua.toString=function(){return ui},Ua},utcParse:function(ui){var Ua=nr(ui+="",!0);return Ua.toString=function(){return ui},Ua}}}var G_={"-":"",_:" ","0":"0"},du=/^\s*\d+/,Bw=/^%/,Nw=/[\\^$*+?|[\]().{}]/g;function no(e,i,r){var n=e<0?"-":"",a=(n?-e:e)+"",s=a.length;return n+(s<r?new Array(r-s+1).join(i)+a:a)}function zw(e){return e.replace(Nw,"\\$&")}function uv(e){return new RegExp("^(?:"+e.map(zw).join("|")+")","i")}function lv(e){for(var i={},r=-1,n=e.length;++r<n;)i[e[r].toLowerCase()]=r;return i}function Uw(e,i,r){var n=du.exec(i.slice(r,r+1));return n?(e.w=+n[0],r+n[0].length):-1}function Zw(e,i,r){var n=du.exec(i.slice(r,r+1));return n?(e.u=+n[0],r+n[0].length):-1}function jw(e,i,r){var n=du.exec(i.slice(r,r+2));return n?(e.U=+n[0],r+n[0].length):-1}function Vw(e,i,r){var n=du.exec(i.slice(r,r+2));return n?(e.V=+n[0],r+n[0].length):-1}function Gw(e,i,r){var n=du.exec(i.slice(r,r+2));return n?(e.W=+n[0],r+n[0].length):-1}function H_(e,i,r){var n=du.exec(i.slice(r,r+4));return n?(e.y=+n[0],r+n[0].length):-1}function W_(e,i,r){var n=du.exec(i.slice(r,r+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function Hw(e,i,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(i.slice(r,r+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function Ww(e,i,r){var n=du.exec(i.slice(r,r+1));return n?(e.q=n[0]*3-3,r+n[0].length):-1}function Xw(e,i,r){var n=du.exec(i.slice(r,r+2));return n?(e.m=n[0]-1,r+n[0].length):-1}function X_(e,i,r){var n=du.exec(i.slice(r,r+2));return n?(e.d=+n[0],r+n[0].length):-1}function Yw(e,i,r){var n=du.exec(i.slice(r,r+3));return n?(e.m=0,e.d=+n[0],r+n[0].length):-1}function Y_(e,i,r){var n=du.exec(i.slice(r,r+2));return n?(e.H=+n[0],r+n[0].length):-1}function qw(e,i,r){var n=du.exec(i.slice(r,r+2));return n?(e.M=+n[0],r+n[0].length):-1}function Kw(e,i,r){var n=du.exec(i.slice(r,r+2));return n?(e.S=+n[0],r+n[0].length):-1}function $w(e,i,r){var n=du.exec(i.slice(r,r+3));return n?(e.L=+n[0],r+n[0].length):-1}function Jw(e,i,r){var n=du.exec(i.slice(r,r+6));return n?(e.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function Qw(e,i,r){var n=Bw.exec(i.slice(r,r+1));return n?r+n[0].length:-1}function eT(e,i,r){var n=du.exec(i.slice(r));return n?(e.Q=+n[0],r+n[0].length):-1}function tT(e,i,r){var n=du.exec(i.slice(r));return n?(e.s=+n[0],r+n[0].length):-1}function q_(e,i){return no(e.getDate(),i,2)}function rT(e,i){return no(e.getHours(),i,2)}function nT(e,i){return no(e.getHours()%12||12,i,2)}function iT(e,i){return no(1+e0.count(yd(e),e),i,3)}function K_(e,i){return no(e.getMilliseconds(),i,3)}function aT(e,i){return K_(e,i)+"000"}function oT(e,i){return no(e.getMonth()+1,i,2)}function sT(e,i){return no(e.getMinutes(),i,2)}function uT(e,i){return no(e.getSeconds(),i,2)}function lT(e){var i=e.getDay();return i===0?7:i}function cT(e,i){return no(Qm.count(yd(e)-1,e),i,2)}function $_(e){var i=e.getDay();return i>=4||i===0?_d(e):_d.ceil(e)}function fT(e,i){return e=$_(e),no(_d.count(yd(e),e)+(yd(e).getDay()===4),i,2)}function hT(e){return e.getDay()}function pT(e,i){return no(im.count(yd(e)-1,e),i,2)}function dT(e,i){return no(e.getFullYear()%100,i,2)}function vT(e,i){return e=$_(e),no(e.getFullYear()%100,i,2)}function mT(e,i){return no(e.getFullYear()%1e4,i,4)}function gT(e,i){var r=e.getDay();return e=r>=4||r===0?_d(e):_d.ceil(e),no(e.getFullYear()%1e4,i,4)}function yT(e){var i=e.getTimezoneOffset();return(i>0?"-":(i*=-1,"+"))+no(i/60|0,"0",2)+no(i%60,"0",2)}function J_(e,i){return no(e.getUTCDate(),i,2)}function _T(e,i){return no(e.getUTCHours(),i,2)}function xT(e,i){return no(e.getUTCHours()%12||12,i,2)}function bT(e,i){return no(1+V_.count(ov(e),e),i,3)}function Q_(e,i){return no(e.getUTCMilliseconds(),i,3)}function ET(e,i){return Q_(e,i)+"000"}function ST(e,i){return no(e.getUTCMonth()+1,i,2)}function CT(e,i){return no(e.getUTCMinutes(),i,2)}function AT(e,i){return no(e.getUTCSeconds(),i,2)}function wT(e){var i=e.getUTCDay();return i===0?7:i}function TT(e,i){return no(Z_.count(ov(e)-1,e),i,2)}function e1(e){var i=e.getUTCDay();return i>=4||i===0?xd(e):xd.ceil(e)}function MT(e,i){return e=e1(e),no(xd.count(ov(e),e)+(ov(e).getUTCDay()===4),i,2)}function PT(e){return e.getUTCDay()}function IT(e,i){return no(om.count(ov(e)-1,e),i,2)}function OT(e,i){return no(e.getUTCFullYear()%100,i,2)}function RT(e,i){return e=e1(e),no(e.getUTCFullYear()%100,i,2)}function LT(e,i){return no(e.getUTCFullYear()%1e4,i,4)}function kT(e,i){var r=e.getUTCDay();return e=r>=4||r===0?xd(e):xd.ceil(e),no(e.getUTCFullYear()%1e4,i,4)}function DT(){return"+0000"}function t1(){return"%"}function r1(e){return+e}function n1(e){return Math.floor(+e/1e3)}var bd,i1,FT,BT,NT;zT({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function zT(e){return bd=Fw(e),i1=bd.format,FT=bd.parse,BT=bd.utcFormat,NT=bd.utcParse,bd}var cv=1e3,fv=cv*60,hv=fv*60,pv=hv*24,UT=pv*7,a1=pv*30,i0=pv*365;function ZT(e){return new Date(e)}function jT(e){return e instanceof Date?+e:+new Date(+e)}function o1(e,i,r,n,a,s,h,m,y){var b=h_(_c,_c),A=b.invert,P=b.domain,k=y(".%L"),F=y(":%S"),q=y("%I:%M"),oe=y("%I %p"),ue=y("%a %d"),Pe=y("%b %d"),et=y("%B"),at=y("%Y"),_t=[[h,1,cv],[h,5,5*cv],[h,15,15*cv],[h,30,30*cv],[s,1,fv],[s,5,5*fv],[s,15,15*fv],[s,30,30*fv],[a,1,hv],[a,3,3*hv],[a,6,6*hv],[a,12,12*hv],[n,1,pv],[n,2,2*pv],[r,1,UT],[i,1,a1],[i,3,3*a1],[e,1,i0]];function Nt(nr){return(h(nr)<nr?k:s(nr)<nr?F:a(nr)<nr?q:n(nr)<nr?oe:i(nr)<nr?r(nr)<nr?ue:Pe:e(nr)<nr?et:at)(nr)}function Ht(nr,mr,Hr,fn){if(nr==null&&(nr=10),typeof nr=="number"){var Or=Math.abs(Hr-mr)/nr,Tn=Qy(function(zn){return zn[2]}).right(_t,Or);Tn===_t.length?(fn=jm(mr/i0,Hr/i0,nr),nr=e):Tn?(Tn=_t[Or/_t[Tn-1][2]<_t[Tn][2]/Or?Tn-1:Tn],fn=Tn[1],nr=Tn[0]):(fn=Math.max(jm(mr,Hr,nr),1),nr=m)}return fn==null?nr:nr.every(fn)}return b.invert=function(nr){return new Date(A(nr))},b.domain=function(nr){return arguments.length?P(Kv.call(nr,jT)):P().map(ZT)},b.ticks=function(nr,mr){var Hr=P(),fn=Hr[0],Or=Hr[Hr.length-1],Tn=Or<fn,zn;return Tn&&(zn=fn,fn=Or,Or=zn),zn=Ht(nr,fn,Or,mr),zn=zn?zn.range(fn,Or+1):[],Tn?zn.reverse():zn},b.tickFormat=function(nr,mr){return mr==null?Nt:y(mr)},b.nice=function(nr,mr){var Hr=P();return(nr=Ht(nr,Hr[0],Hr[Hr.length-1],mr))?P(E_(Hr,nr)):b},b.copy=function(){return Jv(b,o1(e,i,r,n,a,s,h,m,y))},b}function VT(){return Hh.apply(o1(yd,Sw,Qm,e0,Mw,Pw,Iw,Ow,i1).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function A3(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function sm(){var e=0,i=1,r,n,a,s,h=identity,m=!1,y;function b(A){return isNaN(A=+A)?y:h(a===0?.5:(A=(s(A)-r)*a,m?Math.max(0,Math.min(1,A)):A))}return b.domain=function(A){return arguments.length?(r=s(e=+A[0]),n=s(i=+A[1]),a=r===n?0:1/(n-r),b):[e,i]},b.clamp=function(A){return arguments.length?(m=!!A,b):m},b.interpolator=function(A){return arguments.length?(h=A,b):h},b.unknown=function(A){return arguments.length?(y=A,b):y},function(A){return s=A,r=A(e),n=A(i),a=r===n?0:1/(n-r),b}}function um(e,i){return i.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function GT(){var e=linearish(sm()(identity));return e.copy=function(){return um(e,GT())},initInterpolator.apply(e,arguments)}function HT(){var e=loggish(sm()).domain([1,10]);return e.copy=function(){return um(e,HT()).base(e.base())},initInterpolator.apply(e,arguments)}function WT(){var e=symlogish(sm());return e.copy=function(){return um(e,WT()).constant(e.constant())},initInterpolator.apply(e,arguments)}function s1(){var e=powish(sm());return e.copy=function(){return um(e,s1()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function w3(){return s1.apply(null,arguments).exponent(.5)}function XT(){var e=[],i=identity;function r(n){if(!isNaN(n=+n))return i((bisect(e,n)-1)/(e.length-1))}return r.domain=function(n){if(!arguments.length)return e.slice();e=[];for(var a=0,s=n.length,h;a<s;++a)h=n[a],h!=null&&!isNaN(h=+h)&&e.push(h);return e.sort(ascending),r},r.interpolator=function(n){return arguments.length?(i=n,r):i},r.copy=function(){return XT(i).domain(e)},initInterpolator.apply(r,arguments)}function lm(){var e=0,i=.5,r=1,n,a,s,h,m,y=identity,b,A=!1,P;function k(F){return isNaN(F=+F)?P:(F=.5+((F=+b(F))-a)*(F<a?h:m),y(A?Math.max(0,Math.min(1,F)):F))}return k.domain=function(F){return arguments.length?(n=b(e=+F[0]),a=b(i=+F[1]),s=b(r=+F[2]),h=n===a?0:.5/(a-n),m=a===s?0:.5/(s-a),k):[e,i,r]},k.clamp=function(F){return arguments.length?(A=!!F,k):A},k.interpolator=function(F){return arguments.length?(y=F,k):y},k.unknown=function(F){return arguments.length?(P=F,k):P},function(F){return b=F,n=F(e),a=F(i),s=F(r),h=n===a?0:.5/(a-n),m=a===s?0:.5/(s-a),k}}function YT(){var e=linearish(lm()(identity));return e.copy=function(){return copy(e,YT())},initInterpolator.apply(e,arguments)}function qT(){var e=loggish(lm()).domain([.1,1,10]);return e.copy=function(){return copy(e,qT()).base(e.base())},initInterpolator.apply(e,arguments)}function KT(){var e=symlogish(lm());return e.copy=function(){return copy(e,KT()).constant(e.constant())},initInterpolator.apply(e,arguments)}function u1(){var e=powish(lm());return e.copy=function(){return copy(e,u1()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function T3(){return u1.apply(null,arguments).exponent(.5)}var jc,l1,c1,f1,a0,h1,$T=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,JT=(jc={},(0,I.Z)(jc,iu.LINEAR,x_),(0,I.Z)(jc,iu.POWER,qm),(0,I.Z)(jc,iu.LOG,w_),(0,I.Z)(jc,iu.IDENTITY,b_),(0,I.Z)(jc,iu.TIME,VT),(0,I.Z)(jc,iu.QUANTILE,I_),(0,I.Z)(jc,iu.QUANTIZE,O_),(0,I.Z)(jc,iu.THRESHOLD,R_),(0,I.Z)(jc,iu.CAT,$v),jc),QT=(l1=(0,Lr.b2)(),c1=(0,Lr.f3)($t.IGlobalConfigService),l1(f1=(a0=function(){function e(){(0,lt.Z)(this,e),Vn(this,"configService",h1,this),(0,I.Z)(this,"scaleCache",{}),(0,I.Z)(this,"scaleOptions",{})}return(0,It.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("FeatureScalePlugin",function(){a.scaleOptions=r.getScaleOptions();var h=s.getLayerStyleAttributes(),m=r.getSource().data.dataArray;m.length!==0&&a.caculateScalesForAttributes(h||[],m)}),r.hooks.beforeRenderData.tap("FeatureScalePlugin",function(){a.scaleOptions=r.getScaleOptions();var h=s.getLayerStyleAttributes(),m=r.getSource().data.dataArray;return a.caculateScalesForAttributes(h||[],m),r.layerModelNeedUpdate=!0,!0}),r.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!r.layerModelNeedUpdate){a.scaleOptions=r.getScaleOptions();var h=s.getLayerStyleAttributes();if(h){var m=r.getSource().data.dataArray;if(m.length===0)return;var y=h.filter(function(b){return b.needRescale});y.length&&a.caculateScalesForAttributes(y,m)}}})}},{key:"isNumber",value:function(r){return!isNaN(parseFloat(r))&&isFinite(r)}},{key:"caculateScalesForAttributes",value:function(r,n){var a=this;this.scaleCache={},r.forEach(function(s){if(s.scale){var h=s.scale,m=s.name;h.names=a.parseFields(s.scale.field||[]);var y=[];h.names.forEach(function(b){y.push(a.getOrCreateScale(b,s,n))}),y.some(function(b){return b.type===zh.VARIABLE})?(h.type=zh.VARIABLE,y.forEach(function(b){if(!h.callback){var A;if(h.values&&h.values!=="text"){var P;if(((P=b.option)===null||P===void 0?void 0:P.type)==="linear"&&h.values.length>2){var k=b.scale.ticks(h.values.length);m==="color"&&b.scale.domain(k)}b.scale.range(h.values)}else((A=b.option)===null||A===void 0?void 0:A.type)==="cat"&&b.scale.range(b.option.domain)}})):(h.type=zh.CONSTANT,h.defaultValues=y.map(function(b,A){return b.scale(h.names[A])})),h.scalers=y.map(function(b){return{field:b.field,func:b.scale,option:b.option}}),s.needRescale=!1}})}},{key:"getOrCreateScale",value:function(r,n,a){var s,h=[r,n.name].join("_"),m=(s=n.scale)===null||s===void 0?void 0:s.values,y=this.createScale(r,n.name,m,a);return y}},{key:"parseFields",value:function(r){return Array.isArray(r)?r:Rn()(r)?r.split("*"):[r]}},{key:"createScale",value:function(r,n,a,s){var h,m,y=this.scaleOptions[n]&&((h=this.scaleOptions[n])===null||h===void 0?void 0:h.field)===r?this.scaleOptions[n]:this.scaleOptions[r],b={field:r,scale:void 0,type:zh.VARIABLE,option:y};if(!s||!s.length)return y&&y.type?b.scale=this.createDefaultScale(y):(b.scale=$v([r]),b.type=zh.CONSTANT),b;var A=(m=s.find(function(F){return!Nu()(F[r])}))===null||m===void 0?void 0:m[r];if(this.isNumber(r)||Nu()(A)&&!y)b.scale=$v([r]),b.type=zh.CONSTANT;else{var P=y&&y.type||this.getDefaultType(A);a==="text"&&(P=iu.CAT);var k=this.createDefaultScaleConfig(P,r,s);Object.assign(k,y),b.scale=this.createDefaultScale(k),b.option=k}return b}},{key:"getDefaultType",value:function(r){var n=iu.LINEAR;return typeof r=="string"&&(n=$T.test(r)?iu.TIME:iu.CAT),n}},{key:"createDefaultScaleConfig",value:function(r,n,a){var s={type:r},h=(a==null?void 0:a.map(function(m){return m[n]}))||[];return r!==iu.CAT&&r!==iu.QUANTILE?s.domain=jA(h):r===iu.CAT?s.domain=rh()(h):r===iu.QUANTILE&&(s.domain=h),s}},{key:"createDefaultScale",value:function(r){var n=r.type,a=r.domain,s=JT[n]();return a&&s.domain(a),s}}]),e}(),h1=wn(a0.prototype,"configService",[c1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a0))||f1),p1,d1,v1,m1,cm,g1,y1;function _1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function eM(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?_1(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var tM=(p1=(0,Lr.b2)(),d1=(0,Lr.f3)($t.ICameraService),v1=(0,Lr.f3)($t.IRendererService),p1(m1=(cm=function(){function e(){(0,lt.Z)(this,e),Vn(this,"cameraService",g1,this),Vn(this,"rendererService",y1,this)}return(0,It.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){r.models.forEach(function(n){n.addUniforms(eM({},r.layerModel.getAnimateUniforms()))})})}}]),e}(),g1=wn(cm.prototype,"cameraService",[d1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y1=wn(cm.prototype,"rendererService",[v1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cm))||m1),x1,b1,rM=(x1=(0,Lr.b2)(),x1(b1=function(){function e(){(0,lt.Z)(this,e)}return(0,It.Z)(e,[{key:"apply",value:function(r){r.hooks.init.tap("LayerModelPlugin",function(){r.prepareBuildModel(),r.buildModels(),r.styleNeedUpdate=!1}),r.hooks.beforeRenderData.tap("DataSourcePlugin",function(){return r.prepareBuildModel(),r.clearModels(),r.buildModels(),r.layerModelNeedUpdate=!1,!1})}}]),e}())||b1),E1,S1,nM=(E1=(0,Lr.b2)(),E1(S1=function(){function e(){(0,lt.Z)(this,e)}return(0,It.Z)(e,[{key:"apply",value:function(r){r.hooks.afterInit.tap("LayerStylePlugin",function(){r.updateLayerConfig({});var n=r.getLayerConfig(),a=n.autoFit,s=n.fitBoundsOptions;a&&setTimeout(function(){r.fitBounds(s)},100)})}}]),e}())||S1),C1,A1,iM=["type"];function w1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function dv(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?w1(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):w1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var T1={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},aM={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},oM={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},sM={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5},M3=null;function uM(e){var i={u_DirectionalLights:new Array(3).fill(dv({},oM)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(dv({},sM)),u_NumOfSpotLights:0};return(!e||!e.length)&&(e=[aM]),e.forEach(function(r,n){var a=r.type,s=a===void 0?"directional":a,h=(0,pc.Z)(r,iM),m=T1[s].lights,y=T1[s].num,b=i[y];i[m][b]=dv(dv({},i[m][b]),h),i[y]++}),i}var lM=(C1=(0,Lr.b2)(),C1(A1=function(){function e(){(0,lt.Z)(this,e)}return(0,It.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LightingPlugin",function(){var n=r.getLayerConfig(),a=n.enableLighting;a&&r.models.forEach(function(s){return s.addUniforms(dv({},uM()))})})}}]),e}())||A1),M1,P1,fm={NONE:0,ENCODE:1,HIGHLIGHT:2},cM=(M1=(0,Lr.b2)(),M1(P1=function(){function e(){(0,lt.Z)(this,e)}return(0,It.Z)(e,[{key:"apply",value:function(r,n){var a=n.rendererService,s=n.styleAttributeService;r.hooks.init.tap("PixelPickingPlugin",function(){var h=!0;s.registerStyleAttribute({name:"pickingColor",type:Jn.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:ee.FLOAT},size:3,update:function(y,b){var A=y.id;return h?Ve(A):[0,0,0]}}})}),r.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var h=r.getLayerConfig(),m=h.enablePicking;m&&r.isVisible()&&r.models.forEach(function(y){return y.addUniforms({u_PickingStage:fm.ENCODE})})}),r.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var h=r.getLayerConfig(),m=h.enablePicking;m&&r.isVisible()&&r.models.forEach(function(y){return y.addUniforms({u_PickingStage:fm.HIGHLIGHT})})}),r.hooks.beforeHighlight.tap("PixelPickingPlugin",function(h){var m=r.getLayerConfig(),y=m.highlightColor,b=m.activeMix,A=b===void 0?0:b,P=m.enableSelect,k=typeof y=="string"?Be(y):y||[1,0,0,1],F=r.getLayerConfig(),q=F.selectColor,oe=typeof q=="string"?Be(q):q||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:Ae(new Uint8Array(h))});var ue=r.getCurrentSelectedId();r.models.forEach(function(Pe){return Pe.addUniforms({u_PickingStage:fm.HIGHLIGHT,u_PickingColor:h,u_HighlightColor:k.map(function(et){return et*255}),u_activeMix:A,u_CurrentSelectedId:ue?Ve(r.getCurrentSelectedId()):[0,0,0],u_SelectColor:oe.map(function(et){return et*255}),u_EnableSelect:+(P||!1)})})}),r.hooks.beforeSelect.tap("PixelPickingPlugin",function(h){var m=r.getLayerConfig(),y=m.selectColor,b=m.selectMix,A=b===void 0?0:b,P=typeof y=="string"?Be(y):y||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:Ae(new Uint8Array(h))}),r.models.forEach(function(k){return k.addUniforms({u_PickingStage:fm.HIGHLIGHT,u_PickingColor:h,u_HighlightColor:P.map(function(F){return F*255}),u_activeMix:A,u_CurrentSelectedId:h,u_SelectColor:P.map(function(F){return F*255}),u_EnableSelect:1})})})}}]),e}())||P1),I1,O1,fM=(I1=(0,Lr.b2)(),I1(O1=function(){function e(){(0,lt.Z)(this,e)}return(0,It.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("RegisterStyleAttributePlugin",function(){a.registerBuiltinAttributes(s)})}},{key:"registerBuiltinAttributes",value:function(r){r.registerStyleAttribute({name:"position",type:Jn.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:ee.FLOAT},size:3,update:function(a,s,h){return h.length===2?[h[0],h[1],0]:[h[0],h[1],h[2]]}}}),r.registerStyleAttribute({name:"filter",type:Jn.Attribute,descriptor:{name:"filter",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:1,update:function(a,s){var h=a.filter;return h?[1]:[0]}}}),r.registerStyleAttribute({name:"color",type:Jn.Attribute,descriptor:{name:"a_Color",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:4,update:function(a,s){var h=a.color;return!h||!h.length?[1,1,1,1]:h}}}),r.registerStyleAttribute({name:"vertexId",type:Jn.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:ee.DYNAMIC_DRAW,data:[],type:ee.FLOAT},size:1,update:function(a,s,h,m){return[s]}}})}}]),e}())||O1),R1,L1,k1,D1,F1,B1,Ed,N1,z1,U1,Z1,hM=(R1=(0,Lr.b2)(),L1=(0,Lr.f3)($t.ICameraService),k1=(0,Lr.f3)($t.ICoordinateSystemService),D1=(0,Lr.f3)($t.IRendererService),F1=(0,Lr.f3)($t.IMapService),R1(B1=(Ed=function(){function e(){(0,lt.Z)(this,e),Vn(this,"cameraService",N1,this),Vn(this,"coordinateSystemService",z1,this),Vn(this,"rendererService",U1,this),Vn(this,"mapService",Z1,this)}return(0,It.Z)(e,[{key:"apply",value:function(r){var n=this,a=this.mapService.version,s=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],h=[0,0];r.hooks.beforeRender.tap("ShaderUniformPlugin",function(){n.coordinateSystemService.refresh(),a==="GAODE2.x"&&(s=n.mapService.map.customCoords.getMVPMatrix(),h=n.mapService.getCustomCoordCenter());var m=n.rendererService.getViewportSize(),y=m.width,b=m.height;r.models.forEach(function(A){var P;A.addUniforms((P={},(0,I.Z)(P,Sp.ProjectionMatrix,n.cameraService.getProjectionMatrix()),(0,I.Z)(P,Sp.ViewMatrix,n.cameraService.getViewMatrix()),(0,I.Z)(P,Sp.ViewProjectionMatrix,n.cameraService.getViewProjectionMatrix()),(0,I.Z)(P,Sp.Zoom,n.cameraService.getZoom()),(0,I.Z)(P,Sp.ZoomScale,n.cameraService.getZoomScale()),(0,I.Z)(P,Sp.FocalDistance,n.cameraService.getFocalDistance()),(0,I.Z)(P,Sp.CameraPosition,n.cameraService.getCameraPosition()),(0,I.Z)(P,or.CoordinateSystem,n.coordinateSystemService.getCoordinateSystem()),(0,I.Z)(P,or.ViewportCenter,n.coordinateSystemService.getViewportCenter()),(0,I.Z)(P,or.ViewportCenterProjection,n.coordinateSystemService.getViewportCenterProjection()),(0,I.Z)(P,or.PixelsPerDegree,n.coordinateSystemService.getPixelsPerDegree()),(0,I.Z)(P,or.PixelsPerDegree2,n.coordinateSystemService.getPixelsPerDegree2()),(0,I.Z)(P,or.PixelsPerMeter,n.coordinateSystemService.getPixelsPerMeter()),(0,I.Z)(P,or.Mvp,s),(0,I.Z)(P,"u_SceneCenterMKT",h),(0,I.Z)(P,"u_ViewportSize",[y,b]),(0,I.Z)(P,"u_ModelMatrix",n.cameraService.getModelMatrix()),(0,I.Z)(P,"u_DevicePixelRatio",ba.devicePixelRatio),(0,I.Z)(P,"u_PickingBuffer",r.getLayerConfig().pickingBuffer||0),(0,I.Z)(P,"u_shaderPick",Number(r.getShaderPickStat())),P))})})}}]),e}(),N1=wn(Ed.prototype,"cameraService",[L1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z1=wn(Ed.prototype,"coordinateSystemService",[k1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),U1=wn(Ed.prototype,"rendererService",[D1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Z1=wn(Ed.prototype,"mapService",[F1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ed))||B1),j1,V1,pM=(j1=(0,Lr.b2)(),j1(V1=function(){function e(){(0,lt.Z)(this,e)}return(0,It.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("UpdateModelPlugin",function(){r.layerModel&&r.layerModel.needUpdate()})}}]),e}())||V1),G1,H1,dM=(G1=(0,Lr.b2)(),G1(H1=function(){function e(){(0,lt.Z)(this,e)}return(0,It.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("UpdateStyleAttributePlugin",function(){a.initStyleAttribute(r,{styleAttributeService:s})}),r.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){r.layerModelNeedUpdate||a.updateStyleAtrribute(r,{styleAttributeService:s})})}},{key:"updateStyleAtrribute",value:function(r,n){var a=n.styleAttributeService,s=a.getLayerStyleAttributes()||[],h=a.getLayerStyleAttribute("filter"),m=a.getLayerStyleAttribute("shape");if(h&&h.needRegenerateVertices){r.layerModelNeedUpdate=!0,s.forEach(function(y){return y.needRegenerateVertices=!1});return}s.filter(function(y){return y.needRegenerateVertices}).forEach(function(y){a.updateAttributeByFeatureRange(y.name,r.getEncodedData(),y.featureRange.startIndex,y.featureRange.endIndex),y.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(r,n){var a=n.styleAttributeService,s=a.getLayerStyleAttributes()||[];s.filter(function(h){return h.needRegenerateVertices}).forEach(function(h){a.updateAttributeByFeatureRange(h.name,r.getEncodedData(),h.featureRange.startIndex,h.featureRange.endIndex),h.needRegenerateVertices=!1})}}]),e}())||H1);Vl.bind($t.ILayerPlugin).to(zA).inRequestScope(),Vl.bind($t.ILayerPlugin).to(fM).inRequestScope(),Vl.bind($t.ILayerPlugin).to(QT).inRequestScope(),Vl.bind($t.ILayerPlugin).to(NA).inRequestScope(),Vl.bind($t.ILayerPlugin).to(nM).inRequestScope(),Vl.bind($t.ILayerPlugin).to(dM).inRequestScope(),Vl.bind($t.ILayerPlugin).to(pM).inRequestScope(),Vl.bind($t.ILayerPlugin).to(aE).inRequestScope(),Vl.bind($t.ILayerPlugin).to(hM).inRequestScope(),Vl.bind($t.ILayerPlugin).to(tM).inRequestScope(),Vl.bind($t.ILayerPlugin).to(lM).inRequestScope(),Vl.bind($t.ILayerPlugin).to(cM).inRequestScope(),Vl.bind($t.ILayerPlugin).to(rM).inRequestScope();var P3="2.7.10";function W1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function I3(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?W1(Object(r),!0).forEach(function(n){vM(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):W1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function vM(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function O3(e,i){return _M(e)||yM(e,i)||gM(e,i)||mM()}function mM(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function gM(e,i){if(!!e){if(typeof e=="string")return X1(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return X1(e,i)}}function X1(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function yM(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,h,m;try{for(r=r.call(e);!(a=(h=r.next()).done)&&(n.push(h.value),!(i&&n.length===i));a=!0);}catch(y){s=!0,m=y}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw m}}return n}}function _M(e){if(Array.isArray(e))return e}var R3=null,L3=null,Y1,o0,q1;function K1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function $1(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?K1(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):K1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var xM=(Y1=Im($t.IGlobalConfigService),o0=function(){function e(i){(0,lt.Z)(this,e),Vn(this,"configService",q1,this),(0,I.Z)(this,"config",void 0),this.config=i}return(0,It.Z)(e,[{key:"setContainer",value:function(r,n,a,s){r.bind($t.MapConfig).toConstantValue($1($1({},this.config),{},{id:n,canvas:a,hasBaseMap:s})),r.bind($t.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}(),q1=wn(o0.prototype,"configService",[Y1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),o0),bM=R(6158),vv=R.n(bM);function mv(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function hm(e,i){var r=p([],i,e);return $p(r,r,1/r[3]),r}function k3(e,i){var r=e%i;return r<0?i+r:r}function D3(e,i,r){return r*i+(1-r)*e}function Dp(e,i){if(!e)throw new Error(i||"viewport-mercator-project: assertion failed.")}var Vc=Math.PI,J1=Vc/4,sh=Vc/180,Q1=180/Vc,s0=512,u0=4003e4,EM=1.5;function ex(e){return Math.pow(2,e)}function SM(e){return Math.log2(e)}function pm(e,i){var r=(0,ne.Z)(e,2),n=r[0],a=r[1];Dp(Number.isFinite(n)&&Number.isFinite(i)),Dp(Number.isFinite(a)&&a>=-90&&a<=90,"invalid latitude"),i*=s0;var s=n*sh,h=a*sh,m=i*(s+Vc)/(2*Vc),y=i*(Vc-Math.log(Math.tan(J1+h*.5)))/(2*Vc);return[m,y]}function l0(e,i){var r=(0,ne.Z)(e,2),n=r[0],a=r[1];i*=s0;var s=n/i*(2*Vc)-Vc,h=2*(Math.atan(Math.exp(Vc-a/i*(2*Vc)))-J1);return[s*Q1,h*Q1]}function F3(e){var i=e.latitude;assert(Number.isFinite(i));var r=Math.cos(i*sh);return SM(u0*r)-9}function tx(e){var i=e.latitude,r=e.longitude,n=e.zoom,a=e.scale,s=e.highPrecision,h=s===void 0?!1:s;a=a!==void 0?a:ex(n),Dp(Number.isFinite(i)&&Number.isFinite(r)&&Number.isFinite(a));var m={},y=s0*a,b=Math.cos(i*sh),A=y/360,P=A/b,k=y/u0/b;if(m.pixelsPerMeter=[k,-k,k],m.metersPerPixel=[1/k,-1/k,1/k],m.pixelsPerDegree=[A,-P,k],m.degreesPerPixel=[1/A,-1/P,1/k],h){var F=sh*Math.tan(i*sh)/b,q=A*F/2,oe=y/u0*F,ue=oe/P*k;m.pixelsPerDegree2=[0,-q,oe],m.pixelsPerMeter2=[ue,0,ue]}return m}function B3(e,i){var r=_slicedToArray(e,3),n=r[0],a=r[1],s=r[2],h=_slicedToArray(i,3),m=h[0],y=h[1],b=h[2],A=1,P=tx({longitude:n,latitude:a,scale:A,highPrecision:!0}),k=P.pixelsPerMeter,F=P.pixelsPerMeter2,q=pm(e,A);q[0]+=m*(k[0]+F[0]*y),q[1]+=y*(k[1]+F[1]*y);var oe=l0(q,A),ue=(s||0)+(b||0);return Number.isFinite(s)||Number.isFinite(b)?[oe[0],oe[1],ue]:oe}function CM(e){var i=e.height,r=e.pitch,n=e.bearing,a=e.altitude,s=e.center,h=s===void 0?null:s,m=e.flipY,y=m===void 0?!1:m,b=mv();return Vr(b,b,[0,0,-a]),On(b,b,[1,1,1/i]),ar(b,b,-r*sh),Gr(b,b,n*sh),y&&On(b,b,[1,-1,1]),h&&Vr(b,b,$a.negate([],h)),b}function AM(e){var i=e.width,r=e.height,n=e.altitude,a=n===void 0?EM:n,s=e.pitch,h=s===void 0?0:s,m=e.nearZMultiplier,y=m===void 0?1:m,b=e.farZMultiplier,A=b===void 0?1:b,P=h*sh,k=Math.atan(.5/a),F=Math.sin(k)*a/Math.sin(Math.PI/2-P-k),q=Math.cos(Math.PI/2-P)*F+a;return{fov:2*Math.atan(r/2/a),aspect:i/r,focalDistance:a,near:y,far:q*A}}function wM(e){var i=e.width,r=e.height,n=e.pitch,a=e.altitude,s=e.nearZMultiplier,h=e.farZMultiplier,m=AM({width:i,height:r,altitude:a,pitch:n,nearZMultiplier:s,farZMultiplier:h}),y=m.fov,b=m.aspect,A=m.near,P=m.far,k=Eo([],y,b,A,P);return k}function TM(e,i){var r=(0,ne.Z)(e,3),n=r[0],a=r[1],s=r[2],h=s===void 0?0:s;return Dp(Number.isFinite(n)&&Number.isFinite(a)&&Number.isFinite(h)),hm(i,[n,a,h,1])}function rx(e,i){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=(0,ne.Z)(e,3),a=n[0],s=n[1],h=n[2];if(Dp(Number.isFinite(a)&&Number.isFinite(s),"invalid pixel coordinate"),Number.isFinite(h)){var m=hm(i,[a,s,h,1]);return m}var y=hm(i,[a,s,0,1]),b=hm(i,[a,s,1,1]),A=y[2],P=b[2],k=A===P?0:((r||0)-A)/(P-A);return xi.t7([],y,b,k)}var nx=mv(),MM=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=i.width,n=i.height,a=i.viewMatrix,s=a===void 0?nx:a,h=i.projectionMatrix,m=h===void 0?nx:h;(0,lt.Z)(this,e),this.width=r||1,this.height=n||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=s,this.projectionMatrix=m;var y=mv();Ar(y,y,this.projectionMatrix),Ar(y,y,this.viewMatrix),this.viewProjectionMatrix=y;var b=mv();On(b,b,[this.width/2,-this.height/2,1]),Vr(b,b,[1,-1,0]),Ar(b,b,this.viewProjectionMatrix);var A=br(mv(),b);if(!A)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=b,this.pixelUnprojectionMatrix=A,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,It.Z)(e,[{key:"equals",value:function(r){return r instanceof e?r.width===this.width&&r.height===this.height&&Bt(r.projectionMatrix,this.projectionMatrix)&&Bt(r.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=n.topLeft,s=a===void 0?!0:a,h=this.projectPosition(r),m=TM(h,this.pixelProjectionMatrix),y=(0,ne.Z)(m,2),b=y[0],A=y[1],P=s?A:this.height-A;return r.length===2?[b,P]:[b,P,m[2]]}},{key:"unproject",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=n.topLeft,s=a===void 0?!0:a,h=n.targetZ,m=(0,ne.Z)(r,3),y=m[0],b=m[1],A=m[2],P=s?b:this.height-b,k=h&&h*this.pixelsPerMeter,F=rx([y,P,A],this.pixelUnprojectionMatrix,k),q=this.unprojectPosition(F),oe=(0,ne.Z)(q,3),ue=oe[0],Pe=oe[1],et=oe[2];return Number.isFinite(A)?[ue,Pe,et]:Number.isFinite(h)?[ue,Pe,h]:[ue,Pe]}},{key:"projectPosition",value:function(r){var n=this.projectFlat(r),a=(0,ne.Z)(n,2),s=a[0],h=a[1],m=(r[2]||0)*this.pixelsPerMeter;return[s,h,m]}},{key:"unprojectPosition",value:function(r){var n=this.unprojectFlat(r),a=(0,ne.Z)(n,2),s=a[0],h=a[1],m=(r[2]||0)/this.pixelsPerMeter;return[s,h,m]}},{key:"projectFlat",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}},{key:"unprojectFlat",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}}]),e}();function PM(e){var i=e.width,r=e.height,n=e.bounds,a=e.minExtent,s=a===void 0?0:a,h=e.maxZoom,m=h===void 0?24:h,y=e.padding,b=y===void 0?0:y,A=e.offset,P=A===void 0?[0,0]:A,k=(0,ne.Z)(n,2),F=(0,ne.Z)(k[0],2),q=F[0],oe=F[1],ue=(0,ne.Z)(k[1],2),Pe=ue[0],et=ue[1];if(Number.isFinite(b)){var at=b;b={top:at,bottom:at,left:at,right:at}}else Dp(Number.isFinite(b.top)&&Number.isFinite(b.bottom)&&Number.isFinite(b.left)&&Number.isFinite(b.right));var _t=new ix({width:i,height:r,longitude:0,latitude:0,zoom:0}),Nt=_t.project([q,et]),Ht=_t.project([Pe,oe]),nr=[Math.max(Math.abs(Ht[0]-Nt[0]),s),Math.max(Math.abs(Ht[1]-Nt[1]),s)],mr=[i-b.left-b.right-Math.abs(P[0])*2,r-b.top-b.bottom-Math.abs(P[1])*2];Dp(mr[0]>0&&mr[1]>0);var Hr=mr[0]/nr[0],fn=mr[1]/nr[1],Or=(b.right-b.left)/2/Hr,Tn=(b.bottom-b.top)/2/fn,zn=[(Ht[0]+Nt[0])/2+Or,(Ht[1]+Nt[1])/2+Tn],gi=_t.unproject(zn),io=_t.zoom+Math.log2(Math.abs(Math.min(Hr,fn)));return{longitude:gi[0],latitude:gi[1],zoom:Math.min(io,m)}}var ix=function(e){(0,pn.Z)(i,e);function i(){var r,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=n.width,s=n.height,h=n.latitude,m=h===void 0?0:h,y=n.longitude,b=y===void 0?0:y,A=n.zoom,P=A===void 0?0:A,k=n.pitch,F=k===void 0?0:k,q=n.bearing,oe=q===void 0?0:q,ue=n.altitude,Pe=ue===void 0?1.5:ue,et=n.nearZMultiplier,at=n.farZMultiplier;(0,lt.Z)(this,i),a=a||1,s=s||1;var _t=ex(P);Pe=Math.max(.75,Pe);var Nt=pm([b,m],_t);Nt[2]=0;var Ht=wM({width:a,height:s,pitch:F,bearing:oe,altitude:Pe,nearZMultiplier:et||1/s,farZMultiplier:at||1.01}),nr=CM({height:s,center:Nt,pitch:F,bearing:oe,altitude:Pe,flipY:!0});return r=(0,cn.Z)(this,(0,Yt.Z)(i).call(this,{width:a,height:s,viewMatrix:nr,projectionMatrix:Ht})),r.latitude=m,r.longitude=b,r.zoom=P,r.pitch=F,r.bearing=oe,r.altitude=Pe,r.scale=_t,r.center=Nt,r.pixelsPerMeter=tx((0,xe.Z)((0,xe.Z)(r))).pixelsPerMeter[2],Object.freeze((0,xe.Z)((0,xe.Z)(r))),r}return(0,It.Z)(i,[{key:"projectFlat",value:function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return pm(n,a)}},{key:"unprojectFlat",value:function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return l0(n,a)}},{key:"getMapCenterByLngLatPosition",value:function(n){var a=n.lngLat,s=n.pos,h=rx(s,this.pixelUnprojectionMatrix),m=pm(a,this.scale),y=xi.IH([],m,xi.tk([],h)),b=xi.IH([],this.center,y);return l0(b,this.scale)}},{key:"getLocationAtPoint",value:function(n){var a=n.lngLat,s=n.pos;return this.getMapCenterByLngLatPosition({lngLat:a,pos:s})}},{key:"fitBounds",value:function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=this.width,h=this.height,m=PM(Object.assign({width:s,height:h,bounds:n},a)),y=m.longitude,b=m.latitude,A=m.zoom;return new i({width:s,height:h,longitude:y,latitude:b,zoom:A})}}]),i}(MM),IM=function(){function e(){(0,lt.Z)(this,e),(0,I.Z)(this,"viewport",void 0)}return(0,It.Z)(e,[{key:"syncWithMapCamera",value:function(r){var n=r.center,a=r.zoom,s=r.pitch,h=r.bearing,m=r.viewportHeight,y=r.viewportWidth;this.viewport=new ix({width:y,height:m,longitude:n&&n[0],latitude:n&&n[1],zoom:a,pitch:s,bearing:h})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}}]),e}(),ax={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},OM=["id","attributionControl","style","token","rotation","mapInstance"],ox,sx,ux,lx,cx,fx,Sd,hx,px,dx,vx;function mx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function RM(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?mx(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):mx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function LM(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var a=i.head||i.getElementsByTagName("head")[0];if(!a){a=i.createElement("head");var s=i.body||i.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):i.documentElement.appendChild(a)}var h=i.createElement("style");return h.type="text/css",h.styleSheet?h.styleSheet.cssText=e:h.appendChild(i.createTextNode(e)),a.appendChild(h),h}}LM(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=vv();var gx={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},kM=0,DM=12,yx="pk.eyJ1IjoibHp4dWUiLCJhIjoiY2tvaWZuM2s4MWZuYjJ1dHI5ZGduYTlrdiJ9.DQCfMRbZzx0VSwecQ69McA",FM=(ox=(0,Lr.b2)(),sx=(0,Lr.f3)($t.MapConfig),ux=(0,Lr.f3)($t.IGlobalConfigService),lx=(0,Lr.f3)($t.ICoordinateSystemService),cx=(0,Lr.f3)($t.IEventEmitter),ox(fx=(Sd=function(){function e(){var i=this;(0,lt.Z)(this,e),(0,I.Z)(this,"version",Ip.MAPBOX),(0,I.Z)(this,"map",void 0),(0,I.Z)(this,"dragging",!1),(0,I.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),Vn(this,"config",hx,this),Vn(this,"configService",px,this),Vn(this,"coordinateSystemService",dx,this),Vn(this,"eventEmitter",vx,this),(0,I.Z)(this,"viewport",void 0),(0,I.Z)(this,"markerContainer",void 0),(0,I.Z)(this,"cameraChangedCallback",void 0),(0,I.Z)(this,"$mapContainer",void 0),(0,I.Z)(this,"handleCameraChanged",function(){var r=i.map.getCenter().wrap(),n=r.lat,a=r.lng;i.emit("mapchange"),i.viewport.syncWithMapCamera({bearing:i.map.getBearing(),center:[a,n],viewportHeight:i.map.transform.height,pitch:i.map.getPitch(),viewportWidth:i.map.transform.width,zoom:i.map.getZoom(),cameraHeight:0});var s=i.config.offsetZoom,h=s===void 0?DM:s;i.viewport.getZoom()>h?i.coordinateSystemService.setCoordinateSystem(Zt.LNGLAT_OFFSET):i.coordinateSystemService.setCoordinateSystem(Zt.LNGLAT),i.cameraChangedCallback(i.viewport)})}return(0,It.Z)(e,[{key:"setBgColor",value:function(r){this.bgColor=r}},{key:"addMarkerContainer",value:function(){var r=this.map.getCanvasContainer();this.markerContainer=ma("div","l7-marker-container",r),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(r,n){g2.indexOf(r)!==-1?this.eventEmitter.on(r,n):this.map.on(gx[r]||r,n)}},{key:"off",value:function(r,n){this.map.off(gx[r]||r,n)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var r=this.map.transform;return[r.width,r.height]}},{key:"getType",value:function(){return"mapbox"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(r){return this.map.setZoom(r)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(r){this.map.setCenter(r)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(r){this.map.setBearing(r)}},{key:"zoomIn",value:function(r,n){this.map.zoomIn(r,n)}},{key:"zoomOut",value:function(r,n){this.map.zoomOut(r,n)}},{key:"setPitch",value:function(r){return this.map.setPitch(r)}},{key:"panTo",value:function(r){this.map.panTo(r)}},{key:"panBy",value:function(r,n){this.panTo([r,n])}},{key:"fitBounds",value:function(r,n){this.map.fitBounds(r,n)}},{key:"setMaxZoom",value:function(r){this.map.setMaxZoom(r)}},{key:"setMinZoom",value:function(r){this.map.setMinZoom(r)}},{key:"setMapStatus",value:function(r){r.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),r.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),r.dragEnable===!1&&this.map.dragPan.disable(),r.dragEnable===!0&&this.map.dragPan.enable(),r.rotateEnable===!1&&this.map.dragRotate.disable(),r.rotateEnable===!0&&this.map.dragRotate.enable(),r.keyboardEnable===!1&&this.map.keyboard.disable(),r.keyboardEnable===!0&&this.map.keyboard.enable(),r.zoomEnable===!1&&this.map.scrollZoom.disable(),r.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(r,n){this.map.flyTo({zoom:r,center:n})}},{key:"setMapStyle",value:function(r){this.map.setStyle(this.getMapStyle(r))}},{key:"pixelToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToPixel",value:function(r){return this.map.project(r)}},{key:"containerToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToContainer",value:function(r){return this.map.project(r)}},{key:"lngLatToCoord",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},a=this.lngLatToMercator(r,0),s=a.x,h=a.y;return[s-n.x,h-n.y]}},{key:"lngLatToMercator",value:function(r,n){var a=window.mapboxgl.MercatorCoordinate.fromLngLat(r,n),s=a.x,h=s===void 0?0:s,m=a.y,y=m===void 0?0:m,b=a.z,A=b===void 0?0:b;return{x:h,y,z:A}}},{key:"getModelMatrix",value:function(r,n,a){var s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],h=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},m=window.mapboxgl.MercatorCoordinate.fromLngLat(r,n),y=m.meterInMercatorCoordinateUnits(),b=Sr();return Vr(b,b,$a.fromValues(m.x-h.x,m.y-h.y,m.z||0-h.z)),On(b,b,$a.fromValues(y*s[0],-y*s[1],y*s[2])),ar(b,b,a[0]),_n(b,b,a[1]),Gr(b,b,a[2]),b}},{key:"init",value:function(){var i=(0,Ea.Z)(Mi().mark(function n(){var a=this,s,h,m,y,b,A,P,k,F,q,oe,ue,Pe;return Mi().wrap(function(at){for(;;)switch(at.prev=at.next){case 0:s=this.config,h=s.id,m=h===void 0?"map":h,y=s.attributionControl,b=y===void 0?!1:y,A=s.style,P=A===void 0?"light":A,k=s.token,F=k===void 0?yx:k,q=s.rotation,oe=q===void 0?0:q,ue=s.mapInstance,Pe=(0,pc.Z)(s,OM),this.viewport=new IM,!ue&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),F===yx&&P!=="blank"&&!window.mapboxgl.accessToken&&!ue&&console.warn(this.configService.getSceneWarninfo("MapToken")),!ue&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=F),ue?(this.map=ue,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(m),this.map=new window.mapboxgl.Map(RM({container:this.$mapContainer,style:this.getMapStyle(P),attributionControl:b,bearing:oe},Pe))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.map.on("dragstart",function(){return a.dragging=!0,""}),this.map.on("dragend",function(){return a.dragging=!1,""}),this.handleCameraChanged();case 11:case"end":return at.stop()}},n,this)}));function r(){return i.apply(this,arguments)}return r}()},{key:"destroy",value:function(){var r,n;(r=this.$mapContainer)===null||r===void 0||(n=r.parentNode)===null||n===void 0||n.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(r){for(var n,a=arguments.length,s=new Array(a>1?a-1:0),h=1;h<a;h++)s[h-1]=arguments[h];(n=this.eventEmitter).emit.apply(n,[r].concat(s))}},{key:"once",value:function(r){for(var n,a=arguments.length,s=new Array(a>1?a-1:0),h=1;h<a;h++)s[h-1]=arguments[h];(n=this.eventEmitter).once.apply(n,[r].concat(s))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(r,n){var a=new(vv()).LngLat(r[0],r[1]),s=new(vv()).LngLat(n[0],n[1]),h=a.distanceTo(s),m=vv().MercatorCoordinate.fromLngLat({lng:r[0],lat:r[1]}),y=vv().MercatorCoordinate.fromLngLat({lng:n[0],lat:n[1]}),b=m.x,A=m.y,P=y.x,k=y.y,F=Math.sqrt(Math.pow(b-P,2)+Math.pow(A-k,2))*4194304*2;return F/h}},{key:"exportMap",value:function(r){var n=this.map.getCanvas(),a=r==="jpg"?n==null?void 0:n.toDataURL("image/jpeg"):n==null?void 0:n.toDataURL("image/png");return a}},{key:"onCameraChanged",value:function(r){this.cameraChangedCallback=r}},{key:"creatAmapContainer",value:function(r){var n=r;typeof r=="string"&&(n=document.getElementById(r));var a=document.createElement("div");return a.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,a.id="l7_mapbox_div"+kM++,n.appendChild(a),a}},{key:"getMapStyle",value:function(r){return typeof r!="string"?r:ax[r]?ax[r]:r}}]),e}(),hx=wn(Sd.prototype,"config",[sx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),px=wn(Sd.prototype,"configService",[ux],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dx=wn(Sd.prototype,"coordinateSystemService",[lx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vx=wn(Sd.prototype,"eventEmitter",[cx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sd))||fx);function BM(e){var i=NM();return function(){var n=(0,Yt.Z)(e),a;if(i){var s=(0,Yt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,cn.Z)(this,a)}}function NM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function zM(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var a=i.head||i.getElementsByTagName("head")[0];if(!a){a=i.createElement("head");var s=i.body||i.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):i.documentElement.appendChild(a)}var h=i.createElement("style");return h.type="text/css",h.styleSheet?h.styleSheet.cssText=e:h.appendChild(i.createTextNode(e)),a.appendChild(h),h}}zM(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var UM=function(e){(0,pn.Z)(r,e);var i=BM(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"getServiceConstructor",value:function(){return FM}}]),r}(xM);function _x(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function xx(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?_x(Object(r),!0).forEach(function(n){ZM(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_x(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function ZM(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function jM(e,i){return WM(e)||HM(e,i)||GM(e,i)||VM()}function VM(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function GM(e,i){if(!!e){if(typeof e=="string")return bx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return bx(e,i)}}function bx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function HM(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,h,m;try{for(r=r.call(e);!(a=(h=r.next()).done)&&(n.push(h.value),!(i&&n.length===i));a=!0);}catch(y){s=!0,m=y}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw m}}return n}}function WM(e){if(Array.isArray(e))return e}var XM=Ce.memo(function(e){var i=e.style,r=e.className,n=e.map,a=e.option,s=e.onSceneLoaded,h=(0,Ce.createRef)(),m=(0,Ce.useState)(),y=jM(m,2),b=y[0],A=y[1];return(0,Ce.useEffect)(function(){var P=new nE(xx(xx({id:h.current},a),{},{map:new UM(n)}));return P.on("loaded",function(){A(P),s&&s(P)}),function(){P.destroy()}},[]),(0,Ce.useEffect)(function(){b&&n.style&&b.setMapStyle(n.style)},[JSON.stringify(n.style)]),(0,Ce.useEffect)(function(){b&&n.zoom&&b.setZoom(n.zoom)},[n.zoom]),(0,Ce.useEffect)(function(){b&&n.center&&b.setCenter(n.center)},[JSON.stringify(n.center)]),(0,Ce.useEffect)(function(){b&&n.pitch!==void 0&&b.setPitch(n.pitch||0)},[n.pitch]),(0,Ce.useEffect)(function(){b&&n.rotation&&b.setRotation(n.rotation)},[n.rotation]),Ce.createElement(Cr.Provider,{value:b},(0,Ce.createElement)("div",{ref:h,style:i,className:r},b&&e.children))}),YM=XM;function Ex(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function N3(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Ex(Object(r),!0).forEach(function(n){qM(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ex(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function qM(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function z3(e,i){return QM(e)||JM(e,i)||$M(e,i)||KM()}function KM(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function $M(e,i){if(!!e){if(typeof e=="string")return Sx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Sx(e,i)}}function Sx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function JM(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,h,m;try{for(r=r.call(e);!(a=(h=r.next()).done)&&(n.push(h.value),!(i&&n.length===i));a=!0);}catch(y){s=!0,m=y}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw m}}return n}}function QM(e){if(Array.isArray(e))return e}var U3=null,Z3=null;function Cx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function j3(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Cx(Object(r),!0).forEach(function(n){eP(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Cx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function eP(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function V3(e,i){return iP(e)||nP(e,i)||rP(e,i)||tP()}function tP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function rP(e,i){if(!!e){if(typeof e=="string")return Ax(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ax(e,i)}}function Ax(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function nP(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,h,m;try{for(r=r.call(e);!(a=(h=r.next()).done)&&(n.push(h.value),!(i&&n.length===i));a=!0);}catch(y){s=!0,m=y}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw m}}return n}}function iP(e){if(Array.isArray(e))return e}var G3=null,H3=null;function W3(e,i){return uP(e)||sP(e,i)||oP(e,i)||aP()}function aP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function oP(e,i){if(!!e){if(typeof e=="string")return Tx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Tx(e,i)}}function Tx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function sP(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,h,m;try{for(r=r.call(e);!(a=(h=r.next()).done)&&(n.push(h.value),!(i&&n.length===i));a=!0);}catch(y){s=!0,m=y}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw m}}return n}}function uP(e){if(Array.isArray(e))return e}var X3=null,Y3=null;function Mx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function q3(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Mx(Object(r),!0).forEach(function(n){lP(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Mx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function lP(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function K3(e,i){if(e==null)return{};var r=cP(e,i),n,a;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],!(i.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}function cP(e,i){if(e==null)return{};var r={},n=Object.keys(e),a,s;for(s=0;s<n.length;s++)a=n[s],!(i.indexOf(a)>=0)&&(r[a]=e[a]);return r}var $3=null,Px=R(73935);function Ix(e,i){return dP(e)||pP(e,i)||hP(e,i)||fP()}function fP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function hP(e,i){if(!!e){if(typeof e=="string")return Ox(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ox(e,i)}}function Ox(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function pP(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,h,m;try{for(r=r.call(e);!(a=(h=r.next()).done)&&(n.push(h.value),!(i&&n.length===i));a=!0);}catch(y){s=!0,m=y}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw m}}return n}}function dP(e){if(Array.isArray(e))return e}var Rx=Ce.useEffect,Lx=Ce.useState,vP=/\B([A-Z])/g,mP=function(i){return i.replace(vP,"-$1").toLowerCase()};function J3(e){var i=e.className,r=e.style,n=e.children,a=e.position,s=Lx(),h=Ix(s,2),m=h[0],y=h[1],b=useSceneValue(),A=Lx(function(){return document.createElement("div")}),P=Ix(A,1),k=P[0];return Rx(function(){var F=new Control({position:a});return F.onAdd=function(){if(i&&(k.className=i),r){var q=Object.keys(r).map(function(oe){return"".concat(mP(oe),":").concat(r[oe])}).join(";");k.style.cssText=q}return k},F.onRemove=function(){},y(F),b.addControl(F),function(){b.removeControl(F)}},[]),Rx(function(){m&&m.setPosition(a||"bottomleft")},[a]),createPortal(n,k)}var kx=(0,Ce.createContext)({});function Q3(){return useContext(kx)}var Mf=R(96486),eI=Ce.useEffect,gP=Ce.memo(function(i){var r=i.layer,n=i.active;return r.active(n.option),null},Mf.isEqual),tI=Ce.useEffect,yP=Ce.memo(function(i){var r=i.layer,n=i.animate;return r.animate(n),null},Mf.isEqual),rI=Ce.useEffect,_P=Ce.memo(function(i){var r=i.layer,n=i.color;return n.field?r.color(n.field,n.values):r.color(n.values),null},Mf.isEqual),xP=Ce.memo(function(i){var r=i.layer,n=i.filter;return n.field&&r.filter(n.field,n.values),null},Mf.isEqual),bP=Ce.memo(function(i){var r=i.layer,n=i.scale;return r.scale(n.values),null},Mf.isEqual),nI=Ce.useEffect,EP=Ce.memo(function(i){var r=i.layer,n=i.select;return r.select(n.option),null},Mf.isEqual),SP=Ce.memo(function(i){var r=i.layer,n=i.shape;return n.field?r.shape(n.field,n.values):r.shape(n.values),null},Mf.isEqual),CP=Ce.memo(function(i){var r=i.layer,n=i.size;return n.field?r.size(n.field,n.values):r.size(n.values),null},Mf.isEqual),AP=["data"];function wP(e,i){if(e==null)return{};var r=TP(e,i),n,a;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],!(i.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}function TP(e,i){if(e==null)return{};var r={},n=Object.keys(e),a,s;for(s=0;s<n.length;s++)a=n[s],!(i.indexOf(a)>=0)&&(r[a]=e[a]);return r}var MP=Ce.memo(function(i){var r=i.layer,n=i.source,a=n.data,s=wP(n,AP);return r.inited?r.setData(a,s):r.source(a,s),s.autoFit&&r.fitBounds(s&&s.fitBoundsOptions),null},Mf.isEqual),iI=Ce.useEffect,PP=Ce.memo(function(i){var r=i.layer,n=i.style;return r.style(n),null},Mf.isEqual);function IP(e,i){return kP(e)||LP(e,i)||RP(e,i)||OP()}function OP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function RP(e,i){if(!!e){if(typeof e=="string")return Dx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Dx(e,i)}}function Dx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function LP(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,h,m;try{for(r=r.call(e);!(a=(h=r.next()).done)&&(n.push(h.value),!(i&&n.length===i));a=!0);}catch(y){s=!0,m=y}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw m}}return n}}function kP(e){if(Array.isArray(e))return e}var gv=Ce.useEffect,DP=Ce.useState;function Fx(e,i){var r=i.source,n=i.color,a=i.shape,s=i.style,h=i.size,m=i.scale,y=i.active,b=i.select,A=i.filter,P=i.animate,k=i.options,F=i.onLayerLoaded,q=Yn(),oe=DP(function(){var et;switch(e){case"polygonLayer":et=new Uy(k);break;case"lineLayer":et=new mC(k);break;case"pointLayer":et=new lA(k);break;case"heatmapLayer":et=new gS(k);break;case"rasterLayer":et=new FA(k);break;case"imageLayer":et=new TS(k);break;case"citybuildingLayer":et=new jE(k);break;default:et=new Uy(k)}return et.on("inited",function(){F&&F(et,q)}),et}),ue=IP(oe,1),Pe=ue[0];return gv(function(){return q.addLayer(Pe),function(){q.removeLayer(Pe)}},[]),gv(function(){Pe.inited&&k&&Pe.updateLayerConfig(k)},[k==null?void 0:k.minZoom,k==null?void 0:k.maxZoom,k==null?void 0:k.visible]),gv(function(){Pe.inited&&(k==null?void 0:k.zIndex)&&Pe.setIndex(k.zIndex)},[k==null?void 0:k.zIndex]),gv(function(){Pe.inited&&(k==null?void 0:k.blend)&&Pe.setBlend(k.blend)},[k==null?void 0:k.blend]),gv(function(){q.render()}),Ce.createElement(kx.Provider,{value:Pe},Ce.createElement(MP,{layer:Pe,source:r}),m&&Ce.createElement(bP,{layer:Pe,scale:m}),n&&Ce.createElement(_P,{layer:Pe,color:n}),h&&Ce.createElement(CP,{layer:Pe,size:h}),a&&Ce.createElement(SP,{layer:Pe,shape:a}),s&&Ce.createElement(PP,{layer:Pe,style:s}),y&&Ce.createElement(gP,{layer:Pe,active:y}),b&&Ce.createElement(EP,{layer:Pe,select:b}),A&&Ce.createElement(xP,{layer:Pe,filter:A}),P&&Ce.createElement(yP,{layer:Pe,animate:P}),i.children)}var aI=null,oI=null,Bx=Ce.memo(function(i){return Fx("pointLayer",i)}),FP=Ce.memo(function(i){return Fx("heatmapLayer",i)}),sI=null,uI=null,lI=null,cI=Ce.useEffect,fI=null,hI=null;function dm(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?dm=function(r){return typeof r}:dm=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},dm(e)}function Nx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function vm(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Nx(Object(r),!0).forEach(function(n){BP(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Nx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function BP(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function NP(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function zx(e,i){for(var r=0;r<i.length;r++){var n=i[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function zP(e,i,r){return i&&zx(e.prototype,i),r&&zx(e,r),e}function UP(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),i&&c0(e,i)}function c0(e,i){return c0=Object.setPrototypeOf||function(n,a){return n.__proto__=a,n},c0(e,i)}function ZP(e){var i=GP();return function(){var n=mm(e),a;if(i){var s=mm(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return jP(this,a)}}function jP(e,i){if(i&&(dm(i)==="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return VP(e)}function VP(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function GP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function mm(e){return mm=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},mm(e)}var pI=function(e){UP(r,e);var i=ZP(r);function r(n){var a;return NP(this,r),a=i.call(this,n),a.el=void 0,a.scene=void 0,a.popup=void 0,a.el=document.createElement("div"),a}return zP(r,[{key:"componentDidMount",value:function(){var a,s=this.props,h=s.lnglat,m=s.children,y=s.option,b=s.lngLat,A=new Ig(vm(vm({},y),{},{stopPropagation:(a=this.props.option)===null||a===void 0?void 0:a.stopPropagation}));h&&A.setLnglat(h),b&&A.setLnglat(b),m&&A.setDOMContent(this.el),this.popup=A,this.scene.addPopup(A)}},{key:"componentDidUpdate",value:function(a){var s,h,m,y,b,A,P=Array.isArray(a.lnglat)?a.lnglat:[a==null||(s=a.lnglat)===null||s===void 0?void 0:s.lng,a==null||(h=a.lnglat)===null||h===void 0?void 0:h.lat],k=Array.isArray(this.props.lnglat)?this.props.lnglat:[(m=this.props)===null||m===void 0||(y=m.lnglat)===null||y===void 0?void 0:y.lng,(b=this.props)===null||b===void 0||(A=b.lnglat)===null||A===void 0?void 0:A.lat],F=P.toString()!==k.toString();if(F){var q;this.popup.remove(),this.popup=new Ig(vm(vm({},this.props.option),{},{stopPropagation:(q=this.props.option)===null||q===void 0?void 0:q.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setDOMContent(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var a=this;return Ce.createElement(Cr.Consumer,{},function(s){return s&&(a.scene=s),(0,Px.createPortal)(a.props.children,a.el)})}}]),r}(Ce.PureComponent);function gm(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?gm=function(r){return typeof r}:gm=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},gm(e)}function HP(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function Ux(e,i){for(var r=0;r<i.length;r++){var n=i[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function WP(e,i,r){return i&&Ux(e.prototype,i),r&&Ux(e,r),e}function XP(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),i&&f0(e,i)}function f0(e,i){return f0=Object.setPrototypeOf||function(n,a){return n.__proto__=a,n},f0(e,i)}function YP(e){var i=$P();return function(){var n=ym(e),a;if(i){var s=ym(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return qP(this,a)}}function qP(e,i){if(i&&(gm(i)==="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return KP(e)}function KP(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function $P(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function ym(e){return ym=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},ym(e)}var dI=function(e){XP(r,e);var i=YP(r);function r(n){var a;return HP(this,r),a=i.call(this,n),a.el=void 0,a.scene=void 0,a.marker=void 0,a.el=document.createElement("div"),a}return WP(r,[{key:"componentDidMount",value:function(){var a=this.props,s=a.lnglat,h=a.children,m=a.option,y=a.onMarkerLoaded,b=new Ag(m);s&&b.setLnglat(s),h&&b.setElement(this.el),this.marker=b,y&&y(b),this.scene.addMarker(b)}},{key:"componentDidUpdate",value:function(a){var s,h=(a==null?void 0:a.lnglat.toString())!==((s=this.props)===null||s===void 0?void 0:s.lnglat.toString());h&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var a=this;return Ce.createElement(Cr.Consumer,{},function(s){return s&&(a.scene=s),(0,Px.createPortal)(a.props.children,a.el)})}}]),r}(Ce.PureComponent),vI=Ce.useEffect,mI=null,gI=null,yI=Ce.useEffect,_I=null,JP=R(83832),di=R(85893),QP=["#eff3ff","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],e5=function(e){(0,wt.Z)(r,e);var i=(0,gt.Z)(r);function r(){var n;(0,Ye.Z)(this,r);for(var a=arguments.length,s=new Array(a),h=0;h<a;h++)s[h]=arguments[h];return n=i.call.apply(i,[this].concat(s)),n.state={data:null,grid:null,loading:!1},n}return(0,De.Z)(r,[{key:"componentDidMount",value:function(){var n=(0,Te.Z)(Jt().mark(function s(){var h,m,y,b;return Jt().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return P.next=2,Promise.all([fetch("https://gw.alipayobjects.com/os/bmw-prod/c5dba875-b6ea-4e88-b778-66a862906c93.json").then(function(k){return k.json()}),fetch("https://gw.alipayobjects.com/os/bmw-prod/8990e8b4-c58e-419b-afb9-8ea3daff2dd1.json").then(function(k){return k.json()})]);case 2:h=P.sent,m=(0,Wr.Z)(h,2),y=m[0],b=m[1],this.setState({data:y,grid:b,loading:!0});case 7:case"end":return P.stop()}},s,this)}));function a(){return n.apply(this,arguments)}return a}()},{key:"render",value:function(){var a=this.state,s=a.data,h=a.grid,m=a.loading;return m===!1?(0,di.jsx)(JP.Z,{}):(0,di.jsxs)(YM,{map:{center:[110.19382669582967,50.258134],pitch:0,style:"blank",zoom:1},style:{position:"relative",width:"100%",height:"452px"},children:[h&&(0,di.jsx)(FP,{source:{data:h,transforms:[{type:"hexagon",size:8e5,field:"capacity",method:"sum"}]},color:{values:"#ddd"},shape:{values:"hexagon"},style:{coverage:.7,opacity:.8}},"1"),s&&[(0,di.jsx)(Bx,{options:{autoFit:!0},source:{data:s},scale:{values:{color:{field:"cum_conf",type:"quantile"},size:{field:"cum_conf",type:"log"}}},color:{field:"cum_conf",values:QP},shape:{values:"circle"},active:{option:{color:"#0c2c84"}},size:{field:"cum_conf",values:[0,30]},style:{opacity:.8}},"2"),(0,di.jsx)(Bx,{source:{data:s},color:{values:"#fff"},shape:{field:"Short_Name_ZH",values:"text"},filter:{field:"cum_conf",values:function(b){return b>2e3}},size:{values:12},style:{opacity:1,strokeOpacity:1,strokeWidth:0}},"5")]]})}}]),r}(Ce.Component),Zx=R(86582),t5=R(93343),r5=R(70499),Fp=R.n(r5);function n5(e){return e*1<10?"0".concat(e):e}function jx(){for(var e=[],i=0;i<24;i+=1)e.push({x:"".concat(n5(i),":00"),y:Math.floor(Math.random()*200)+i*50});return e}var i5=function(e){(0,wt.Z)(r,e);var i=(0,gt.Z)(r);function r(){var n;(0,Ye.Z)(this,r);for(var a=arguments.length,s=new Array(a),h=0;h<a;h++)s[h]=arguments[h];return n=i.call.apply(i,[this].concat(s)),n.state={activeData:jx()},n.timer=void 0,n.requestRef=void 0,n.loopData=function(){n.requestRef=requestAnimationFrame(function(){n.timer=window.setTimeout(function(){n.setState({activeData:jx()},function(){n.loopData()})},1e3)})},n}return(0,De.Z)(r,[{key:"componentDidMount",value:function(){this.loopData()}},{key:"componentWillUnmount",value:function(){clearTimeout(this.timer),this.requestRef&&cancelAnimationFrame(this.requestRef)}},{key:"render",value:function(){var a=this.state.activeData,s=a===void 0?[]:a;return(0,di.jsxs)("div",{className:Fp().activeChart,children:[(0,di.jsx)(re.Z,{title:"\u76EE\u6807\u8BC4\u4F30",value:"\u6709\u671B\u8FBE\u5230\u9884\u671F"}),(0,di.jsx)("div",{style:{marginTop:32},children:(0,di.jsx)(t5.Z,{autoFit:!0,data:s.map(function(h){return h.y}),height:84})}),s&&(0,di.jsxs)("div",{children:[(0,di.jsxs)("div",{className:Fp().activeChartGrid,children:[(0,di.jsxs)("p",{children:[(0,Zx.Z)(s).sort()[s.length-1].y+200," \u4EBF\u5143"]}),(0,di.jsxs)("p",{children:[(0,Zx.Z)(s).sort()[Math.floor(s.length/2)].y," \u4EBF\u5143"]})]}),(0,di.jsx)("div",{className:Fp().dashedLine,children:(0,di.jsx)("div",{className:Fp().line})}),(0,di.jsx)("div",{className:Fp().dashedLine,children:(0,di.jsx)("div",{className:Fp().line})})]}),s&&(0,di.jsxs)("div",{className:Fp().activeChartLegend,children:[(0,di.jsx)("span",{children:"00:00"}),(0,di.jsx)("span",{children:s[Math.floor(s.length/2)].x}),(0,di.jsx)("span",{children:s[s.length-1].x})]})]})}}]),r}(Ce.Component);function a5(){return h0.apply(this,arguments)}function h0(){return h0=(0,Te.Z)(Jt().mark(function e(){return Jt().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,Ge.WY)("/api/tags"));case 1:case"end":return r.stop()}},e)})),h0.apply(this,arguments)}var o5=R(19134),Vx=R.n(o5),s5=re.Z.Countdown,u5=Date.now()+1e3*60*60*24*2+1e3*30,l5=function(){var i=(0,Ge.QT)(a5),r=i.loading,n=i.data,a=(n==null?void 0:n.list)||[];return(0,di.jsx)(kt.Z,{children:(0,di.jsxs)(di.Fragment,{children:[(0,di.jsxs)(B.Z,{gutter:24,children:[(0,di.jsx)(ie.Z,{xl:18,lg:24,md:24,sm:24,xs:24,style:{marginBottom:24},children:(0,di.jsxs)(v.Z,{title:"\u6D3B\u52A8\u5B9E\u65F6\u4EA4\u6613\u60C5\u51B5",bordered:!1,children:[(0,di.jsxs)(B.Z,{children:[(0,di.jsx)(ie.Z,{md:6,sm:12,xs:24,children:(0,di.jsx)(re.Z,{title:"\u4ECA\u65E5\u4EA4\u6613\u603B\u989D",suffix:"\u5143",value:Pr()(124543233).format("0,0")})}),(0,di.jsx)(ie.Z,{md:6,sm:12,xs:24,children:(0,di.jsx)(re.Z,{title:"\u9500\u552E\u76EE\u6807\u5B8C\u6210\u7387",value:"92%"})}),(0,di.jsx)(ie.Z,{md:6,sm:12,xs:24,children:(0,di.jsx)(s5,{title:"\u6D3B\u52A8\u5269\u4F59\u65F6\u95F4",value:u5,format:"HH:mm:ss:SSS"})}),(0,di.jsx)(ie.Z,{md:6,sm:12,xs:24,children:(0,di.jsx)(re.Z,{title:"\u6BCF\u79D2\u4EA4\u6613\u603B\u989D",suffix:"\u5143",value:Pr()(234).format("0,0")})})]}),(0,di.jsx)("div",{className:Vx().mapChart,children:(0,di.jsx)(e5,{})})]})}),(0,di.jsxs)(ie.Z,{xl:6,lg:24,md:24,sm:24,xs:24,children:[(0,di.jsx)(v.Z,{title:"\u6D3B\u52A8\u60C5\u51B5\u9884\u6D4B",style:{marginBottom:24},bordered:!1,children:(0,di.jsx)(i5,{})}),(0,di.jsx)(v.Z,{title:"\u5238\u6838\u6548\u7387",style:{marginBottom:24},bodyStyle:{textAlign:"center"},bordered:!1,children:(0,di.jsx)(ct,{height:180,autoFit:!0,percent:.87,range:{ticks:[0,1/4,2/4,3/4,1]},axis:{label:{formatter:function(h){return Number(h)*100}}},statistic:{content:{content:"\u4F18",style:{color:"#30bf78"}}}})})]})]}),(0,di.jsxs)(B.Z,{gutter:24,children:[(0,di.jsx)(ie.Z,{xl:12,lg:24,sm:24,xs:24,style:{marginBottom:24},children:(0,di.jsx)(v.Z,{title:"\u5404\u54C1\u7C7B\u5360\u6BD4",bordered:!1,className:Vx().pieCard,children:(0,di.jsxs)(B.Z,{style:{padding:"16px 0"},children:[(0,di.jsx)(ie.Z,{span:8,children:(0,di.jsx)($e.Z,{autoFit:!0,height:128,percent:.28})}),(0,di.jsx)(ie.Z,{span:8,children:(0,di.jsx)($e.Z,{color:"#5DDECF",autoFit:!0,height:128,percent:.22})}),(0,di.jsx)(ie.Z,{span:8,children:(0,di.jsx)($e.Z,{color:"#2FC25B",autoFit:!0,height:128,percent:.32})})]})})}),(0,di.jsx)(ie.Z,{xl:6,lg:12,sm:24,xs:24,style:{marginBottom:24},children:(0,di.jsx)(v.Z,{title:"\u70ED\u95E8\u641C\u7D22",loading:r,bordered:!1,bodyStyle:{overflow:"hidden"},children:(0,di.jsx)(Kt,{data:a,autoFit:!0,wordField:"name",weightField:"value",colorField:"name",height:162,wordStyle:{fontSize:[10,20]}})})}),(0,di.jsx)(ie.Z,{xl:6,lg:12,sm:24,xs:24,style:{marginBottom:24},children:(0,di.jsx)(v.Z,{title:"\u8D44\u6E90\u5269\u4F59",bodyStyle:{textAlign:"center",fontSize:0},bordered:!1,children:(0,di.jsx)(dt,{height:161,percent:.35,autoFit:!0,outline:{border:2,distance:4},padding:[0,0,0,0],statistic:{content:{style:{fontSize:"16px"}}}})})})]})]})})},c5=l5},9187:function(Ze){"use strict";Ze.exports=H,Ze.exports.default=H;function H(Te,Ye,De){De=De||2;var wt=Ye&&Ye.length,gt=wt?Ye[0]*De:Te.length,Ut=R(Te,0,gt,De,!0),Jt=[];if(!Ut||Ut.next===Ut.prev)return Jt;var Cr,Yn,hn,qi,jn,Xn,vi;if(wt&&(Ut=ie(Te,Ye,Ut,De)),Te.length>80*De){Cr=hn=Te[0],Yn=qi=Te[1];for(var qn=De;qn<gt;qn+=De)jn=Te[qn],Xn=Te[qn+1],jn<Cr&&(Cr=jn),Xn<Yn&&(Yn=Xn),jn>hn&&(hn=jn),Xn>qi&&(qi=Xn);vi=Math.max(hn-Cr,qi-Yn),vi=vi!==0?1/vi:0}return J(Ut,Jt,De,Cr,Yn,vi),Jt}function R(Te,Ye,De,wt,gt){var Ut,Jt;if(gt===Wr(Te,Ye,De,wt)>0)for(Ut=Ye;Ut<De;Ut+=wt)Jt=kt(Ut,Te[Ut],Te[Ut+1],Jt);else for(Ut=De-wt;Ut>=Ye;Ut-=wt)Jt=kt(Ut,Te[Ut],Te[Ut+1],Jt);return Jt&&ct(Jt,Jt.next)&&(yr(Jt),Jt=Jt.next),Jt}function Y(Te,Ye){if(!Te)return Te;Ye||(Ye=Te);var De=Te,wt;do if(wt=!1,!De.steiner&&(ct(De,De.next)||ot(De.prev,De,De.next)===0)){if(yr(De),De=Ye=De.prev,De===De.next)break;wt=!0}else De=De.next;while(wt||De!==Ye);return Ye}function J(Te,Ye,De,wt,gt,Ut,Jt){if(!!Te){!Jt&&Ut&&tt(Te,wt,gt,Ut);for(var Cr=Te,Yn,hn;Te.prev!==Te.next;){if(Yn=Te.prev,hn=Te.next,Ut?te(Te,wt,gt,Ut):v(Te)){Ye.push(Yn.i/De),Ye.push(Te.i/De),Ye.push(hn.i/De),yr(Te),Te=hn.next,Cr=hn.next;continue}if(Te=hn,Te===Cr){Jt?Jt===1?(Te=B(Y(Te),Ye,De),J(Te,Ye,De,wt,gt,Ut,2)):Jt===2&&Q(Te,Ye,De,wt,gt,Ut):J(Y(Te),Ye,De,wt,gt,Ut,1);break}}}}function v(Te){var Ye=Te.prev,De=Te,wt=Te.next;if(ot(Ye,De,wt)>=0)return!1;for(var gt=Te.next.next;gt!==Te.prev;){if(qt(Ye.x,Ye.y,De.x,De.y,wt.x,wt.y,gt.x,gt.y)&&ot(gt.prev,gt,gt.next)>=0)return!1;gt=gt.next}return!0}function te(Te,Ye,De,wt){var gt=Te.prev,Ut=Te,Jt=Te.next;if(ot(gt,Ut,Jt)>=0)return!1;for(var Cr=gt.x<Ut.x?gt.x<Jt.x?gt.x:Jt.x:Ut.x<Jt.x?Ut.x:Jt.x,Yn=gt.y<Ut.y?gt.y<Jt.y?gt.y:Jt.y:Ut.y<Jt.y?Ut.y:Jt.y,hn=gt.x>Ut.x?gt.x>Jt.x?gt.x:Jt.x:Ut.x>Jt.x?Ut.x:Jt.x,qi=gt.y>Ut.y?gt.y>Jt.y?gt.y:Jt.y:Ut.y>Jt.y?Ut.y:Jt.y,jn=ir(Cr,Yn,Ye,De,wt),Xn=ir(hn,qi,Ye,De,wt),vi=Te.prevZ,qn=Te.nextZ;vi&&vi.z>=jn&&qn&&qn.z<=Xn;){if(vi!==Te.prev&&vi!==Te.next&&qt(gt.x,gt.y,Ut.x,Ut.y,Jt.x,Jt.y,vi.x,vi.y)&&ot(vi.prev,vi,vi.next)>=0||(vi=vi.prevZ,qn!==Te.prev&&qn!==Te.next&&qt(gt.x,gt.y,Ut.x,Ut.y,Jt.x,Jt.y,qn.x,qn.y)&&ot(qn.prev,qn,qn.next)>=0))return!1;qn=qn.nextZ}for(;vi&&vi.z>=jn;){if(vi!==Te.prev&&vi!==Te.next&&qt(gt.x,gt.y,Ut.x,Ut.y,Jt.x,Jt.y,vi.x,vi.y)&&ot(vi.prev,vi,vi.next)>=0)return!1;vi=vi.prevZ}for(;qn&&qn.z<=Xn;){if(qn!==Te.prev&&qn!==Te.next&&qt(gt.x,gt.y,Ut.x,Ut.y,Jt.x,Jt.y,qn.x,qn.y)&&ot(qn.prev,qn,qn.next)>=0)return!1;qn=qn.nextZ}return!0}function B(Te,Ye,De){var wt=Te;do{var gt=wt.prev,Ut=wt.next.next;!ct(gt,Ut)&&Qt(gt,wt,wt.next,Ut)&&qe(gt,Ut)&&qe(Ut,gt)&&(Ye.push(gt.i/De),Ye.push(wt.i/De),Ye.push(Ut.i/De),yr(wt),yr(wt.next),wt=Te=Ut),wt=wt.next}while(wt!==Te);return Y(wt)}function Q(Te,Ye,De,wt,gt,Ut){var Jt=Te;do{for(var Cr=Jt.next.next;Cr!==Jt.prev;){if(Jt.i!==Cr.i&&At(Jt,Cr)){var Yn=$e(Jt,Cr);Jt=Y(Jt,Jt.next),Yn=Y(Yn,Yn.next),J(Jt,Ye,De,wt,gt,Ut),J(Yn,Ye,De,wt,gt,Ut);return}Cr=Cr.next}Jt=Jt.next}while(Jt!==Te)}function ie(Te,Ye,De,wt){var gt=[],Ut,Jt,Cr,Yn,hn;for(Ut=0,Jt=Ye.length;Ut<Jt;Ut++)Cr=Ye[Ut]*wt,Yn=Ut<Jt-1?Ye[Ut+1]*wt:Te.length,hn=R(Te,Cr,Yn,wt,!1),hn===hn.next&&(hn.steiner=!0),gt.push(bt(hn));for(gt.sort(Ee),Ut=0;Ut<gt.length;Ut++)De=re(gt[Ut],De),De=Y(De,De.next);return De}function Ee(Te,Ye){return Te.x-Ye.x}function re(Te,Ye){var De=Ge(Te,Ye);if(!De)return Ye;var wt=$e(De,Te),gt=Y(De,De.next);return Y(wt,wt.next),Ye===De?gt:Ye}function Ge(Te,Ye){var De=Ye,wt=Te.x,gt=Te.y,Ut=-Infinity,Jt;do{if(gt<=De.y&&gt>=De.next.y&&De.next.y!==De.y){var Cr=De.x+(gt-De.y)*(De.next.x-De.x)/(De.next.y-De.y);if(Cr<=wt&&Cr>Ut){if(Ut=Cr,Cr===wt){if(gt===De.y)return De;if(gt===De.next.y)return De.next}Jt=De.x<De.next.x?De:De.next}}De=De.next}while(De!==Ye);if(!Jt)return null;if(wt===Ut)return Jt;var Yn=Jt,hn=Jt.x,qi=Jt.y,jn=Infinity,Xn;De=Jt;do wt>=De.x&&De.x>=hn&&wt!==De.x&&qt(gt<qi?wt:Ut,gt,hn,qi,gt<qi?Ut:wt,gt,De.x,De.y)&&(Xn=Math.abs(gt-De.y)/(wt-De.x),qe(De,Te)&&(Xn<jn||Xn===jn&&(De.x>Jt.x||De.x===Jt.x&&Ce(Jt,De)))&&(Jt=De,jn=Xn)),De=De.next;while(De!==Yn);return Jt}function Ce(Te,Ye){return ot(Te.prev,Te,Ye.prev)<0&&ot(Ye.next,Te,Te.next)<0}function tt(Te,Ye,De,wt){var gt=Te;do gt.z===null&&(gt.z=ir(gt.x,gt.y,Ye,De,wt)),gt.prevZ=gt.prev,gt.nextZ=gt.next,gt=gt.next;while(gt!==Te);gt.prevZ.nextZ=null,gt.prevZ=null,Mt(gt)}function Mt(Te){var Ye,De,wt,gt,Ut,Jt,Cr,Yn,hn=1;do{for(De=Te,Te=null,Ut=null,Jt=0;De;){for(Jt++,wt=De,Cr=0,Ye=0;Ye<hn&&(Cr++,wt=wt.nextZ,!!wt);Ye++);for(Yn=hn;Cr>0||Yn>0&&wt;)Cr!==0&&(Yn===0||!wt||De.z<=wt.z)?(gt=De,De=De.nextZ,Cr--):(gt=wt,wt=wt.nextZ,Yn--),Ut?Ut.nextZ=gt:Te=gt,gt.prevZ=Ut,Ut=gt;De=wt}Ut.nextZ=null,hn*=2}while(Jt>1);return Te}function ir(Te,Ye,De,wt,gt){return Te=32767*(Te-De)*gt,Ye=32767*(Ye-wt)*gt,Te=(Te|Te<<8)&16711935,Te=(Te|Te<<4)&252645135,Te=(Te|Te<<2)&858993459,Te=(Te|Te<<1)&1431655765,Ye=(Ye|Ye<<8)&16711935,Ye=(Ye|Ye<<4)&252645135,Ye=(Ye|Ye<<2)&858993459,Ye=(Ye|Ye<<1)&1431655765,Te|Ye<<1}function bt(Te){var Ye=Te,De=Te;do(Ye.x<De.x||Ye.x===De.x&&Ye.y<De.y)&&(De=Ye),Ye=Ye.next;while(Ye!==Te);return De}function qt(Te,Ye,De,wt,gt,Ut,Jt,Cr){return(gt-Jt)*(Ye-Cr)-(Te-Jt)*(Ut-Cr)>=0&&(Te-Jt)*(wt-Cr)-(De-Jt)*(Ye-Cr)>=0&&(De-Jt)*(Ut-Cr)-(gt-Jt)*(wt-Cr)>=0}function At(Te,Ye){return Te.next.i!==Ye.i&&Te.prev.i!==Ye.i&&!vt(Te,Ye)&&(qe(Te,Ye)&&qe(Ye,Te)&&dt(Te,Ye)&&(ot(Te.prev,Te,Ye.prev)||ot(Te,Ye.prev,Ye))||ct(Te,Ye)&&ot(Te.prev,Te,Te.next)>0&&ot(Ye.prev,Ye,Ye.next)>0)}function ot(Te,Ye,De){return(Ye.y-Te.y)*(De.x-Ye.x)-(Ye.x-Te.x)*(De.y-Ye.y)}function ct(Te,Ye){return Te.x===Ye.x&&Te.y===Ye.y}function Qt(Te,Ye,De,wt){var gt=Kt(ot(Te,Ye,De)),Ut=Kt(ot(Te,Ye,wt)),Jt=Kt(ot(De,wt,Te)),Cr=Kt(ot(De,wt,Ye));return!!(gt!==Ut&&Jt!==Cr||gt===0&&X(Te,De,Ye)||Ut===0&&X(Te,wt,Ye)||Jt===0&&X(De,Te,wt)||Cr===0&&X(De,Ye,wt))}function X(Te,Ye,De){return Ye.x<=Math.max(Te.x,De.x)&&Ye.x>=Math.min(Te.x,De.x)&&Ye.y<=Math.max(Te.y,De.y)&&Ye.y>=Math.min(Te.y,De.y)}function Kt(Te){return Te>0?1:Te<0?-1:0}function vt(Te,Ye){var De=Te;do{if(De.i!==Te.i&&De.next.i!==Te.i&&De.i!==Ye.i&&De.next.i!==Ye.i&&Qt(De,De.next,Te,Ye))return!0;De=De.next}while(De!==Te);return!1}function qe(Te,Ye){return ot(Te.prev,Te,Te.next)<0?ot(Te,Ye,Te.next)>=0&&ot(Te,Te.prev,Ye)>=0:ot(Te,Ye,Te.prev)<0||ot(Te,Te.next,Ye)<0}function dt(Te,Ye){var De=Te,wt=!1,gt=(Te.x+Ye.x)/2,Ut=(Te.y+Ye.y)/2;do De.y>Ut!=De.next.y>Ut&&De.next.y!==De.y&&gt<(De.next.x-De.x)*(Ut-De.y)/(De.next.y-De.y)+De.x&&(wt=!wt),De=De.next;while(De!==Te);return wt}function $e(Te,Ye){var De=new Pr(Te.i,Te.x,Te.y),wt=new Pr(Ye.i,Ye.x,Ye.y),gt=Te.next,Ut=Ye.prev;return Te.next=Ye,Ye.prev=Te,De.next=gt,gt.prev=De,wt.next=De,De.prev=wt,Ut.next=wt,wt.prev=Ut,wt}function kt(Te,Ye,De,wt){var gt=new Pr(Te,Ye,De);return wt?(gt.next=wt.next,gt.prev=wt,wt.next.prev=gt,wt.next=gt):(gt.prev=gt,gt.next=gt),gt}function yr(Te){Te.next.prev=Te.prev,Te.prev.next=Te.next,Te.prevZ&&(Te.prevZ.nextZ=Te.nextZ),Te.nextZ&&(Te.nextZ.prevZ=Te.prevZ)}function Pr(Te,Ye,De){this.i=Te,this.x=Ye,this.y=De,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}H.deviation=function(Te,Ye,De,wt){var gt=Ye&&Ye.length,Ut=gt?Ye[0]*De:Te.length,Jt=Math.abs(Wr(Te,0,Ut,De));if(gt)for(var Cr=0,Yn=Ye.length;Cr<Yn;Cr++){var hn=Ye[Cr]*De,qi=Cr<Yn-1?Ye[Cr+1]*De:Te.length;Jt-=Math.abs(Wr(Te,hn,qi,De))}var jn=0;for(Cr=0;Cr<wt.length;Cr+=3){var Xn=wt[Cr]*De,vi=wt[Cr+1]*De,qn=wt[Cr+2]*De;jn+=Math.abs((Te[Xn]-Te[qn])*(Te[vi+1]-Te[Xn+1])-(Te[Xn]-Te[vi])*(Te[qn+1]-Te[Xn+1]))}return Jt===0&&jn===0?0:Math.abs((jn-Jt)/Jt)};function Wr(Te,Ye,De,wt){for(var gt=0,Ut=Ye,Jt=De-wt;Ut<De;Ut+=wt)gt+=(Te[Jt]-Te[Ut])*(Te[Ut+1]+Te[Jt+1]),Jt=Ut;return gt}H.flatten=function(Te){for(var Ye=Te[0][0].length,De={vertices:[],holes:[],dimensions:Ye},wt=0,gt=0;gt<Te.length;gt++){for(var Ut=0;Ut<Te[gt].length;Ut++)for(var Jt=0;Jt<Ye;Jt++)De.vertices.push(Te[gt][Ut][Jt]);gt>0&&(wt+=Te[gt-1].length,De.holes.push(wt))}return De}},67709:function(Ze){function H(Y){var J=Y.target||Y.srcElement;J.__resizeRAF__&&cancelAnimationFrame(J.__resizeRAF__),J.__resizeRAF__=requestAnimationFrame(function(){var v=J.__resizeTrigger__,te=v&&v.__resizeListeners__;te&&te.forEach(function(B){B.call(v,Y)})})}var R=function(J,v){var te=this,B=te.document,Q,ie=B.attachEvent;typeof navigator!="undefined"&&(Q=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function Ee(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",H)}if(!J.__resizeListeners__)if(J.__resizeListeners__=[],ie)J.__resizeTrigger__=J,J.attachEvent("onresize",H);else{getComputedStyle(J).position==="static"&&(J.style.position="relative");var re=J.__resizeTrigger__=B.createElement("object");re.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),re.setAttribute("class","resize-sensor"),re.setAttribute("tabindex","-1"),re.setAttribute("title",""),re.__resizeElement__=J,re.onload=Ee,re.type="text/html",Q&&J.appendChild(re),re.data="about:blank",Q||J.appendChild(re)}J.__resizeListeners__.push(v)};Ze.exports=typeof window=="undefined"?R:R.bind(window),Ze.exports.unbind=function(Y,J){var v=document.attachEvent,te=Y.__resizeListeners__||[];if(J){var B=te.indexOf(J);B!==-1&&te.splice(B,1)}else te=Y.__resizeListeners__=[];if(!te.length){if(v)Y.detachEvent("onresize",H);else if(Y.__resizeTrigger__){var Q=Y.__resizeTrigger__.contentDocument,ie=Q&&Q.defaultView;ie&&(ie.removeEventListener("resize",H),delete ie.__resizeTrigger__),Y.__resizeTrigger__=!Y.removeChild(Y.__resizeTrigger__)}delete Y.__resizeListeners__}}},26729:function(Ze){"use strict";var H=Object.prototype.hasOwnProperty,R="~";function Y(){}Object.create&&(Y.prototype=Object.create(null),new Y().__proto__||(R=!1));function J(Q,ie,Ee){this.fn=Q,this.context=ie,this.once=Ee||!1}function v(Q,ie,Ee,re,Ge){if(typeof Ee!="function")throw new TypeError("The listener must be a function");var Ce=new J(Ee,re||Q,Ge),tt=R?R+ie:ie;return Q._events[tt]?Q._events[tt].fn?Q._events[tt]=[Q._events[tt],Ce]:Q._events[tt].push(Ce):(Q._events[tt]=Ce,Q._eventsCount++),Q}function te(Q,ie){--Q._eventsCount==0?Q._events=new Y:delete Q._events[ie]}function B(){this._events=new Y,this._eventsCount=0}B.prototype.eventNames=function(){var ie=[],Ee,re;if(this._eventsCount===0)return ie;for(re in Ee=this._events)H.call(Ee,re)&&ie.push(R?re.slice(1):re);return Object.getOwnPropertySymbols?ie.concat(Object.getOwnPropertySymbols(Ee)):ie},B.prototype.listeners=function(ie){var Ee=R?R+ie:ie,re=this._events[Ee];if(!re)return[];if(re.fn)return[re.fn];for(var Ge=0,Ce=re.length,tt=new Array(Ce);Ge<Ce;Ge++)tt[Ge]=re[Ge].fn;return tt},B.prototype.listenerCount=function(ie){var Ee=R?R+ie:ie,re=this._events[Ee];return re?re.fn?1:re.length:0},B.prototype.emit=function(ie,Ee,re,Ge,Ce,tt){var Mt=R?R+ie:ie;if(!this._events[Mt])return!1;var ir=this._events[Mt],bt=arguments.length,qt,At;if(ir.fn){switch(ir.once&&this.removeListener(ie,ir.fn,void 0,!0),bt){case 1:return ir.fn.call(ir.context),!0;case 2:return ir.fn.call(ir.context,Ee),!0;case 3:return ir.fn.call(ir.context,Ee,re),!0;case 4:return ir.fn.call(ir.context,Ee,re,Ge),!0;case 5:return ir.fn.call(ir.context,Ee,re,Ge,Ce),!0;case 6:return ir.fn.call(ir.context,Ee,re,Ge,Ce,tt),!0}for(At=1,qt=new Array(bt-1);At<bt;At++)qt[At-1]=arguments[At];ir.fn.apply(ir.context,qt)}else{var ot=ir.length,ct;for(At=0;At<ot;At++)switch(ir[At].once&&this.removeListener(ie,ir[At].fn,void 0,!0),bt){case 1:ir[At].fn.call(ir[At].context);break;case 2:ir[At].fn.call(ir[At].context,Ee);break;case 3:ir[At].fn.call(ir[At].context,Ee,re);break;case 4:ir[At].fn.call(ir[At].context,Ee,re,Ge);break;default:if(!qt)for(ct=1,qt=new Array(bt-1);ct<bt;ct++)qt[ct-1]=arguments[ct];ir[At].fn.apply(ir[At].context,qt)}}return!0},B.prototype.on=function(ie,Ee,re){return v(this,ie,Ee,re,!1)},B.prototype.once=function(ie,Ee,re){return v(this,ie,Ee,re,!0)},B.prototype.removeListener=function(ie,Ee,re,Ge){var Ce=R?R+ie:ie;if(!this._events[Ce])return this;if(!Ee)return te(this,Ce),this;var tt=this._events[Ce];if(tt.fn)tt.fn===Ee&&(!Ge||tt.once)&&(!re||tt.context===re)&&te(this,Ce);else{for(var Mt=0,ir=[],bt=tt.length;Mt<bt;Mt++)(tt[Mt].fn!==Ee||Ge&&!tt[Mt].once||re&&tt[Mt].context!==re)&&ir.push(tt[Mt]);ir.length?this._events[Ce]=ir.length===1?ir[0]:ir:te(this,Ce)}return this},B.prototype.removeAllListeners=function(ie){var Ee;return ie?(Ee=R?R+ie:ie,this._events[Ee]&&te(this,Ee)):(this._events=new Y,this._eventsCount=0),this},B.prototype.off=B.prototype.removeListener,B.prototype.addListener=B.prototype.on,B.prefixed=R,B.EventEmitter=B,Ze.exports=B},7375:function(Ze,H){"use strict";Object.defineProperty(H,"__esModule",{value:!0});var R=Symbol.for("INJECTION");function Y(Q,ie,Ee,re){function Ge(){return re&&!Reflect.hasMetadata(R,this,ie)&&Reflect.defineMetadata(R,Ee(),this,ie),Reflect.hasMetadata(R,this,ie)?Reflect.getMetadata(R,this,ie):Ee()}function Ce(tt){Reflect.defineMetadata(R,tt,this,ie)}Object.defineProperty(Q,ie,{configurable:!0,enumerable:!0,get:Ge,set:Ce})}function J(Q,ie){return function(Ee){return function(re,Ge){var Ce=function(){return Q.get(Ee)};Y(re,Ge,Ce,ie)}}}H.makePropertyInjectDecorator=J;function v(Q,ie){return function(Ee,re){return function(Ge,Ce){var tt=function(){return Q.getNamed(Ee,re)};Y(Ge,Ce,tt,ie)}}}H.makePropertyInjectNamedDecorator=v;function te(Q,ie){return function(Ee,re,Ge){return function(Ce,tt){var Mt=function(){return Q.getTagged(Ee,re,Ge)};Y(Ce,tt,Mt,ie)}}}H.makePropertyInjectTaggedDecorator=te;function B(Q,ie){return function(Ee){return function(re,Ge){var Ce=function(){return Q.getAll(Ee)};Y(re,Ge,Ce,ie)}}}H.makePropertyMultiInjectDecorator=B},84879:function(Ze,H,R){"use strict";var Y;Y={value:!0};var J=R(7375);function v(te,B){B===void 0&&(B=!0);var Q=J.makePropertyInjectDecorator(te,B),ie=J.makePropertyInjectNamedDecorator(te,B),Ee=J.makePropertyInjectTaggedDecorator(te,B),re=J.makePropertyMultiInjectDecorator(te,B);return{lazyInject:Q,lazyInjectNamed:ie,lazyInjectTagged:Ee,lazyMultiInject:re}}H.Z=v},99934:function(Ze,H,R){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.tagProperty=H.tagParameter=H.decorate=void 0;var Y=R(16674),J=R(6867);function v(re,Ge,Ce,tt){var Mt=J.TAGGED;B(Mt,re,Ge,tt,Ce)}H.tagParameter=v;function te(re,Ge,Ce){var tt=J.TAGGED_PROP;B(tt,re.constructor,Ge,Ce)}H.tagProperty=te;function B(re,Ge,Ce,tt,Mt){var ir={},bt=typeof Mt=="number",qt=Mt!==void 0&&bt?Mt.toString():Ce;if(bt&&Ce!==void 0)throw new Error(Y.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(re,Ge)&&(ir=Reflect.getMetadata(re,Ge));var At=ir[qt];if(!Array.isArray(At))At=[];else for(var ot=0,ct=At;ot<ct.length;ot++){var Qt=ct[ot];if(Qt.key===tt.key)throw new Error(Y.DUPLICATED_METADATA+" "+Qt.key.toString())}At.push(tt),ir[qt]=At,Reflect.defineMetadata(re,ir,Ge)}function Q(re,Ge){Reflect.decorate(re,Ge)}function ie(re,Ge){return function(Ce,tt){Ge(Ce,tt,re)}}function Ee(re,Ge,Ce){typeof Ce=="number"?Q([ie(Ce,re)],Ge):typeof Ce=="string"?Reflect.decorate([re],Ge,Ce):Q([re],Ge)}H.decorate=Ee},5744:function(Ze,H,R){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.inject=H.LazyServiceIdentifer=void 0;var Y=R(16674),J=R(6867),v=R(47738),te=R(99934),B=function(){function ie(Ee){this._cb=Ee}return ie.prototype.unwrap=function(){return this._cb()},ie}();H.LazyServiceIdentifer=B;function Q(ie){return function(Ee,re,Ge){if(ie===void 0)throw new Error(Y.UNDEFINED_INJECT_ANNOTATION(Ee.name));var Ce=new v.Metadata(J.INJECT_TAG,ie);typeof Ge=="number"?te.tagParameter(Ee,re,Ge,Ce):te.tagProperty(Ee,re,Ce)}}H.inject=Q},64315:function(Ze,H,R){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.injectable=void 0;var Y=R(16674),J=R(6867);function v(){return function(te){if(Reflect.hasOwnMetadata(J.PARAM_TYPES,te))throw new Error(Y.DUPLICATED_INJECTABLE_DECORATOR);var B=Reflect.getMetadata(J.DESIGN_PARAM_TYPES,te)||[];return Reflect.defineMetadata(J.PARAM_TYPES,B,te),te}}H.injectable=v},71693:function(Ze,H,R){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.multiInject=void 0;var Y=R(6867),J=R(47738),v=R(99934);function te(B){return function(Q,ie,Ee){var re=new J.Metadata(Y.MULTI_INJECT_TAG,B);typeof Ee=="number"?v.tagParameter(Q,ie,Ee,re):v.tagProperty(Q,ie,re)}}H.multiInject=te},38085:function(Ze,H,R){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.named=void 0;var Y=R(6867),J=R(47738),v=R(99934);function te(B){return function(Q,ie,Ee){var re=new J.Metadata(Y.NAMED_TAG,B);typeof Ee=="number"?v.tagParameter(Q,ie,Ee,re):v.tagProperty(Q,ie,re)}}H.named=te},6515:function(Ze,H,R){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.optional=void 0;var Y=R(6867),J=R(47738),v=R(99934);function te(){return function(B,Q,ie){var Ee=new J.Metadata(Y.OPTIONAL_TAG,!0);typeof ie=="number"?v.tagParameter(B,Q,ie,Ee):v.tagProperty(B,Q,Ee)}}H.optional=te},7014:function(Ze,H,R){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.postConstruct=void 0;var Y=R(16674),J=R(6867),v=R(47738);function te(){return function(B,Q,ie){var Ee=new v.Metadata(J.POST_CONSTRUCT,Q);if(Reflect.hasOwnMetadata(J.POST_CONSTRUCT,B.constructor))throw new Error(Y.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(J.POST_CONSTRUCT,Ee,B.constructor)}}H.postConstruct=te},32052:function(Ze,H,R){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.tagged=void 0;var Y=R(47738),J=R(99934);function v(te,B){return function(Q,ie,Ee){var re=new Y.Metadata(te,B);typeof Ee=="number"?J.tagParameter(Q,ie,Ee,re):J.tagProperty(Q,ie,re)}}H.tagged=v},55638:function(Ze,H,R){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.targetName=void 0;var Y=R(6867),J=R(47738),v=R(99934);function te(B){return function(Q,ie,Ee){var re=new J.Metadata(Y.NAME_TAG,B);v.tagParameter(Q,ie,Ee,re)}}H.targetName=te},86757:function(Ze,H,R){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.unmanaged=void 0;var Y=R(6867),J=R(47738),v=R(99934);function te(){return function(B,Q,ie){var Ee=new J.Metadata(Y.UNMANAGED_TAG,!0);v.tagParameter(B,Q,ie,Ee)}}H.unmanaged=te},44290:function(Ze,H,R){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.Binding=void 0;var Y=R(28421),J=R(37791),v=function(){function te(B,Q){this.id=J.id(),this.activated=!1,this.serviceIdentifier=B,this.scope=Q,this.type=Y.BindingTypeEnum.Invalid,this.constraint=function(ie){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return te.prototype.clone=function(){var B=new te(this.serviceIdentifier,this.scope);return B.activated=B.scope===Y.BindingScopeEnum.Singleton?this.activated:!1,B.implementationType=this.implementationType,B.dynamicValue=this.dynamicValue,B.scope=this.scope,B.type=this.type,B.factory=this.factory,B.provider=this.provider,B.constraint=this.constraint,B.onActivation=this.onActivation,B.cache=this.cache,B},te}();H.Binding=v},23184:function(Ze,H){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.BindingCount=void 0;var R={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};H.BindingCount=R},16674:function(Ze,H){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.STACK_OVERFLOW=H.CIRCULAR_DEPENDENCY_IN_FACTORY=H.POST_CONSTRUCT_ERROR=H.MULTIPLE_POST_CONSTRUCT_METHODS=H.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=H.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=H.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=H.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=H.ARGUMENTS_LENGTH_MISMATCH=H.INVALID_DECORATOR_OPERATION=H.INVALID_TO_SELF_VALUE=H.INVALID_FUNCTION_BINDING=H.INVALID_MIDDLEWARE_RETURN=H.NO_MORE_SNAPSHOTS_AVAILABLE=H.INVALID_BINDING_TYPE=H.NOT_IMPLEMENTED=H.CIRCULAR_DEPENDENCY=H.UNDEFINED_INJECT_ANNOTATION=H.MISSING_INJECT_ANNOTATION=H.MISSING_INJECTABLE_ANNOTATION=H.NOT_REGISTERED=H.CANNOT_UNBIND=H.AMBIGUOUS_MATCH=H.KEY_NOT_FOUND=H.NULL_ARGUMENT=H.DUPLICATED_METADATA=H.DUPLICATED_INJECTABLE_DECORATOR=void 0,H.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",H.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",H.NULL_ARGUMENT="NULL argument",H.KEY_NOT_FOUND="Key Not Found",H.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",H.CANNOT_UNBIND="Could not unbind serviceIdentifier:",H.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",H.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",H.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var R=function(te){return"@inject called with undefined this could mean that the class "+te+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};H.UNDEFINED_INJECT_ANNOTATION=R,H.CIRCULAR_DEPENDENCY="Circular dependency found:",H.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",H.INVALID_BINDING_TYPE="Invalid binding type:",H.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",H.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",H.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",H.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",H.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var Y=function(){for(var te=[],B=0;B<arguments.length;B++)te[B]=arguments[B];return"The number of constructor arguments in the derived class "+(te[0]+" must be >= than the number of constructor arguments of its base class.")};H.ARGUMENTS_LENGTH_MISMATCH=Y,H.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",H.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",H.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",H.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",H.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var J=function(){for(var te=[],B=0;B<arguments.length;B++)te[B]=arguments[B];return"@postConstruct error in class "+te[0]+": "+te[1]};H.POST_CONSTRUCT_ERROR=J;var v=function(){for(var te=[],B=0;B<arguments.length;B++)te[B]=arguments[B];return"It looks like there is a circular dependency "+("in one of the '"+te[0]+"' bindings. Please investigate bindings with")+("service identifier '"+te[1]+"'.")};H.CIRCULAR_DEPENDENCY_IN_FACTORY=v,H.STACK_OVERFLOW="Maximum call stack size exceeded"},28421:function(Ze,H){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.TargetTypeEnum=H.BindingTypeEnum=H.BindingScopeEnum=void 0;var R={Request:"Request",Singleton:"Singleton",Transient:"Transient"};H.BindingScopeEnum=R;var Y={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};H.BindingTypeEnum=Y;var J={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};H.TargetTypeEnum=J},6867:function(Ze,H){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.NON_CUSTOM_TAG_KEYS=H.POST_CONSTRUCT=H.DESIGN_PARAM_TYPES=H.PARAM_TYPES=H.TAGGED_PROP=H.TAGGED=H.MULTI_INJECT_TAG=H.INJECT_TAG=H.OPTIONAL_TAG=H.UNMANAGED_TAG=H.NAME_TAG=H.NAMED_TAG=void 0,H.NAMED_TAG="named",H.NAME_TAG="name",H.UNMANAGED_TAG="unmanaged",H.OPTIONAL_TAG="optional",H.INJECT_TAG="inject",H.MULTI_INJECT_TAG="multi_inject",H.TAGGED="inversify:tagged",H.TAGGED_PROP="inversify:tagged_props",H.PARAM_TYPES="inversify:paramtypes",H.DESIGN_PARAM_TYPES="design:paramtypes",H.POST_CONSTRUCT="post_construct";function R(){return[H.INJECT_TAG,H.MULTI_INJECT_TAG,H.NAME_TAG,H.UNMANAGED_TAG,H.NAMED_TAG,H.OPTIONAL_TAG]}H.NON_CUSTOM_TAG_KEYS=R()},51389:function(Ze,H,R){"use strict";var Y=this&&this.__awaiter||function(At,ot,ct,Qt){function X(Kt){return Kt instanceof ct?Kt:new ct(function(vt){vt(Kt)})}return new(ct||(ct=Promise))(function(Kt,vt){function qe(kt){try{$e(Qt.next(kt))}catch(yr){vt(yr)}}function dt(kt){try{$e(Qt.throw(kt))}catch(yr){vt(yr)}}function $e(kt){kt.done?Kt(kt.value):X(kt.value).then(qe,dt)}$e((Qt=Qt.apply(At,ot||[])).next())})},J=this&&this.__generator||function(At,ot){var ct={label:0,sent:function(){if(Kt[0]&1)throw Kt[1];return Kt[1]},trys:[],ops:[]},Qt,X,Kt,vt;return vt={next:qe(0),throw:qe(1),return:qe(2)},typeof Symbol=="function"&&(vt[Symbol.iterator]=function(){return this}),vt;function qe($e){return function(kt){return dt([$e,kt])}}function dt($e){if(Qt)throw new TypeError("Generator is already executing.");for(;ct;)try{if(Qt=1,X&&(Kt=$e[0]&2?X.return:$e[0]?X.throw||((Kt=X.return)&&Kt.call(X),0):X.next)&&!(Kt=Kt.call(X,$e[1])).done)return Kt;switch(X=0,Kt&&($e=[$e[0]&2,Kt.value]),$e[0]){case 0:case 1:Kt=$e;break;case 4:return ct.label++,{value:$e[1],done:!1};case 5:ct.label++,X=$e[1],$e=[0];continue;case 7:$e=ct.ops.pop(),ct.trys.pop();continue;default:if(Kt=ct.trys,!(Kt=Kt.length>0&&Kt[Kt.length-1])&&($e[0]===6||$e[0]===2)){ct=0;continue}if($e[0]===3&&(!Kt||$e[1]>Kt[0]&&$e[1]<Kt[3])){ct.label=$e[1];break}if($e[0]===6&&ct.label<Kt[1]){ct.label=Kt[1],Kt=$e;break}if(Kt&&ct.label<Kt[2]){ct.label=Kt[2],ct.ops.push($e);break}Kt[2]&&ct.ops.pop(),ct.trys.pop();continue}$e=ot.call(At,ct)}catch(kt){$e=[6,kt],X=0}finally{Qt=Kt=0}if($e[0]&5)throw $e[1];return{value:$e[0]?$e[1]:void 0,done:!0}}},v=this&&this.__spreadArray||function(At,ot){for(var ct=0,Qt=ot.length,X=At.length;ct<Qt;ct++,X++)At[X]=ot[ct];return At};Object.defineProperty(H,"__esModule",{value:!0}),H.Container=void 0;var te=R(44290),B=R(16674),Q=R(28421),ie=R(6867),Ee=R(51377),re=R(86311),Ge=R(31927),Ce=R(15451),tt=R(37791),Mt=R(55800),ir=R(85700),bt=R(80175),qt=function(){function At(ot){this._appliedMiddleware=[];var ct=ot||{};if(typeof ct!="object")throw new Error(""+B.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(ct.defaultScope===void 0)ct.defaultScope=Q.BindingScopeEnum.Transient;else if(ct.defaultScope!==Q.BindingScopeEnum.Singleton&&ct.defaultScope!==Q.BindingScopeEnum.Transient&&ct.defaultScope!==Q.BindingScopeEnum.Request)throw new Error(""+B.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(ct.autoBindInjectable===void 0)ct.autoBindInjectable=!1;else if(typeof ct.autoBindInjectable!="boolean")throw new Error(""+B.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(ct.skipBaseClassChecks===void 0)ct.skipBaseClassChecks=!1;else if(typeof ct.skipBaseClassChecks!="boolean")throw new Error(""+B.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:ct.autoBindInjectable,defaultScope:ct.defaultScope,skipBaseClassChecks:ct.skipBaseClassChecks},this.id=tt.id(),this._bindingDictionary=new bt.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new Ee.MetadataReader}return At.merge=function(ot,ct){for(var Qt=[],X=2;X<arguments.length;X++)Qt[X-2]=arguments[X];var Kt=new At,vt=v([ot,ct],Qt).map(function($e){return re.getBindingDictionary($e)}),qe=re.getBindingDictionary(Kt);function dt($e,kt){$e.traverse(function(yr,Pr){Pr.forEach(function(Wr){kt.add(Wr.serviceIdentifier,Wr.clone())})})}return vt.forEach(function($e){dt($e,qe)}),Kt},At.prototype.load=function(){for(var ot=[],ct=0;ct<arguments.length;ct++)ot[ct]=arguments[ct];for(var Qt=this._getContainerModuleHelpersFactory(),X=0,Kt=ot;X<Kt.length;X++){var vt=Kt[X],qe=Qt(vt.id);vt.registry(qe.bindFunction,qe.unbindFunction,qe.isboundFunction,qe.rebindFunction)}},At.prototype.loadAsync=function(){for(var ot=[],ct=0;ct<arguments.length;ct++)ot[ct]=arguments[ct];return Y(this,void 0,void 0,function(){var Qt,X,Kt,vt,qe;return J(this,function(dt){switch(dt.label){case 0:Qt=this._getContainerModuleHelpersFactory(),X=0,Kt=ot,dt.label=1;case 1:return X<Kt.length?(vt=Kt[X],qe=Qt(vt.id),[4,vt.registry(qe.bindFunction,qe.unbindFunction,qe.isboundFunction,qe.rebindFunction)]):[3,4];case 2:dt.sent(),dt.label=3;case 3:return X++,[3,1];case 4:return[2]}})})},At.prototype.unload=function(){for(var ot=this,ct=[],Qt=0;Qt<arguments.length;Qt++)ct[Qt]=arguments[Qt];var X=function(Kt){return function(vt){return vt.moduleId===Kt}};ct.forEach(function(Kt){var vt=X(Kt.id);ot._bindingDictionary.removeByCondition(vt)})},At.prototype.bind=function(ot){var ct=this.options.defaultScope||Q.BindingScopeEnum.Transient,Qt=new te.Binding(ot,ct);return this._bindingDictionary.add(ot,Qt),new Ce.BindingToSyntax(Qt)},At.prototype.rebind=function(ot){return this.unbind(ot),this.bind(ot)},At.prototype.unbind=function(ot){try{this._bindingDictionary.remove(ot)}catch(ct){throw new Error(B.CANNOT_UNBIND+" "+Mt.getServiceIdentifierAsString(ot))}},At.prototype.unbindAll=function(){this._bindingDictionary=new bt.Lookup},At.prototype.isBound=function(ot){var ct=this._bindingDictionary.hasKey(ot);return!ct&&this.parent&&(ct=this.parent.isBound(ot)),ct},At.prototype.isBoundNamed=function(ot,ct){return this.isBoundTagged(ot,ie.NAMED_TAG,ct)},At.prototype.isBoundTagged=function(ot,ct,Qt){var X=!1;if(this._bindingDictionary.hasKey(ot)){var Kt=this._bindingDictionary.get(ot),vt=re.createMockRequest(this,ot,ct,Qt);X=Kt.some(function(qe){return qe.constraint(vt)})}return!X&&this.parent&&(X=this.parent.isBoundTagged(ot,ct,Qt)),X},At.prototype.snapshot=function(){this._snapshots.push(ir.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},At.prototype.restore=function(){var ot=this._snapshots.pop();if(ot===void 0)throw new Error(B.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=ot.bindings,this._middleware=ot.middleware},At.prototype.createChild=function(ot){var ct=new At(ot||this.options);return ct.parent=this,ct},At.prototype.applyMiddleware=function(){for(var ot=[],ct=0;ct<arguments.length;ct++)ot[ct]=arguments[ct];this._appliedMiddleware=this._appliedMiddleware.concat(ot);var Qt=this._middleware?this._middleware:this._planAndResolve();this._middleware=ot.reduce(function(X,Kt){return Kt(X)},Qt)},At.prototype.applyCustomMetadataReader=function(ot){this._metadataReader=ot},At.prototype.get=function(ot){return this._get(!1,!1,Q.TargetTypeEnum.Variable,ot)},At.prototype.getTagged=function(ot,ct,Qt){return this._get(!1,!1,Q.TargetTypeEnum.Variable,ot,ct,Qt)},At.prototype.getNamed=function(ot,ct){return this.getTagged(ot,ie.NAMED_TAG,ct)},At.prototype.getAll=function(ot){return this._get(!0,!0,Q.TargetTypeEnum.Variable,ot)},At.prototype.getAllTagged=function(ot,ct,Qt){return this._get(!1,!0,Q.TargetTypeEnum.Variable,ot,ct,Qt)},At.prototype.getAllNamed=function(ot,ct){return this.getAllTagged(ot,ie.NAMED_TAG,ct)},At.prototype.resolve=function(ot){var ct=this.createChild();return ct.bind(ot).toSelf(),this._appliedMiddleware.forEach(function(Qt){ct.applyMiddleware(Qt)}),ct.get(ot)},At.prototype._getContainerModuleHelpersFactory=function(){var ot=this,ct=function(qe,dt){qe._binding.moduleId=dt},Qt=function(qe){return function(dt){var $e=ot.bind.bind(ot),kt=$e(dt);return ct(kt,qe),kt}},X=function(qe){return function(dt){var $e=ot.unbind.bind(ot);$e(dt)}},Kt=function(qe){return function(dt){var $e=ot.isBound.bind(ot);return $e(dt)}},vt=function(qe){return function(dt){var $e=ot.rebind.bind(ot),kt=$e(dt);return ct(kt,qe),kt}};return function(qe){return{bindFunction:Qt(qe),isboundFunction:Kt(qe),rebindFunction:vt(qe),unbindFunction:X(qe)}}},At.prototype._get=function(ot,ct,Qt,X,Kt,vt){var qe=null,dt={avoidConstraints:ot,contextInterceptor:function($e){return $e},isMultiInject:ct,key:Kt,serviceIdentifier:X,targetType:Qt,value:vt};if(this._middleware){if(qe=this._middleware(dt),qe==null)throw new Error(B.INVALID_MIDDLEWARE_RETURN)}else qe=this._planAndResolve()(dt);return qe},At.prototype._planAndResolve=function(){var ot=this;return function(ct){var Qt=re.plan(ot._metadataReader,ot,ct.isMultiInject,ct.targetType,ct.serviceIdentifier,ct.key,ct.value,ct.avoidConstraints);Qt=ct.contextInterceptor(Qt);var X=Ge.resolve(Qt);return X}},At}();H.Container=qt},33244:function(Ze,H,R){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.AsyncContainerModule=H.ContainerModule=void 0;var Y=R(37791),J=function(){function te(B){this.id=Y.id(),this.registry=B}return te}();H.ContainerModule=J;var v=function(){function te(B){this.id=Y.id(),this.registry=B}return te}();H.AsyncContainerModule=v},85700:function(Ze,H){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.ContainerSnapshot=void 0;var R=function(){function Y(){}return Y.of=function(J,v){var te=new Y;return te.bindings=J,te.middleware=v,te},Y}();H.ContainerSnapshot=R},80175:function(Ze,H,R){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.Lookup=void 0;var Y=R(16674),J=function(){function v(){this._map=new Map}return v.prototype.getMap=function(){return this._map},v.prototype.add=function(te,B){if(te==null)throw new Error(Y.NULL_ARGUMENT);if(B==null)throw new Error(Y.NULL_ARGUMENT);var Q=this._map.get(te);Q!==void 0?(Q.push(B),this._map.set(te,Q)):this._map.set(te,[B])},v.prototype.get=function(te){if(te==null)throw new Error(Y.NULL_ARGUMENT);var B=this._map.get(te);if(B!==void 0)return B;throw new Error(Y.KEY_NOT_FOUND)},v.prototype.remove=function(te){if(te==null)throw new Error(Y.NULL_ARGUMENT);if(!this._map.delete(te))throw new Error(Y.KEY_NOT_FOUND)},v.prototype.removeByCondition=function(te){var B=this;this._map.forEach(function(Q,ie){var Ee=Q.filter(function(re){return!te(re)});Ee.length>0?B._map.set(ie,Ee):B._map.delete(ie)})},v.prototype.hasKey=function(te){if(te==null)throw new Error(Y.NULL_ARGUMENT);return this._map.has(te)},v.prototype.clone=function(){var te=new v;return this._map.forEach(function(B,Q){B.forEach(function(ie){return te.add(Q,ie.clone())})}),te},v.prototype.traverse=function(te){this._map.forEach(function(B,Q){te(Q,B)})},v}();H.Lookup=J},86700:function(Ze,H,R){"use strict";var Y;Y={value:!0},Y=Y=Y=Y=Y=Y=H.GW=Y=Y=H.zY=Y=Y=Y=Y=Y=H.f3=Y=Y=H.b2=Y=Y=Y=Y=Y=H.W2=Y=void 0;var J=R(6867);Y=J;var v=R(51389);Object.defineProperty(H,"W2",{enumerable:!0,get:function(){return v.Container}});var te=R(28421);Y={enumerable:!0,get:function(){return te.BindingScopeEnum}},Y={enumerable:!0,get:function(){return te.BindingTypeEnum}},Y={enumerable:!0,get:function(){return te.TargetTypeEnum}};var B=R(33244);Y={enumerable:!0,get:function(){return B.AsyncContainerModule}},Y={enumerable:!0,get:function(){return B.ContainerModule}};var Q=R(64315);Object.defineProperty(H,"b2",{enumerable:!0,get:function(){return Q.injectable}});var ie=R(32052);Y={enumerable:!0,get:function(){return ie.tagged}};var Ee=R(38085);Y={enumerable:!0,get:function(){return Ee.named}};var re=R(5744);Object.defineProperty(H,"f3",{enumerable:!0,get:function(){return re.inject}}),Y={enumerable:!0,get:function(){return re.LazyServiceIdentifer}};var Ge=R(6515);Y={enumerable:!0,get:function(){return Ge.optional}};var Ce=R(86757);Y={enumerable:!0,get:function(){return Ce.unmanaged}};var tt=R(71693);Y={enumerable:!0,get:function(){return tt.multiInject}};var Mt=R(55638);Y={enumerable:!0,get:function(){return Mt.targetName}};var ir=R(7014);Object.defineProperty(H,"zY",{enumerable:!0,get:function(){return ir.postConstruct}});var bt=R(51377);Y={enumerable:!0,get:function(){return bt.MetadataReader}};var qt=R(37791);Y={enumerable:!0,get:function(){return qt.id}};var At=R(99934);Object.defineProperty(H,"GW",{enumerable:!0,get:function(){return At.decorate}});var ot=R(80758);Y={enumerable:!0,get:function(){return ot.traverseAncerstors}},Y={enumerable:!0,get:function(){return ot.taggedConstraint}},Y={enumerable:!0,get:function(){return ot.namedConstraint}},Y={enumerable:!0,get:function(){return ot.typeConstraint}};var ct=R(55800);Y={enumerable:!0,get:function(){return ct.getServiceIdentifierAsString}};var Qt=R(70600);Y={enumerable:!0,get:function(){return Qt.multiBindToService}}},95228:function(Ze,H,R){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.Context=void 0;var Y=R(37791),J=function(){function v(te){this.id=Y.id(),this.container=te}return v.prototype.addPlan=function(te){this.plan=te},v.prototype.setCurrentRequest=function(te){this.currentRequest=te},v}();H.Context=J},47738:function(Ze,H,R){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.Metadata=void 0;var Y=R(6867),J=function(){function v(te,B){this.key=te,this.value=B}return v.prototype.toString=function(){return this.key===Y.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},v}();H.Metadata=J},51377:function(Ze,H,R){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.MetadataReader=void 0;var Y=R(6867),J=function(){function v(){}return v.prototype.getConstructorMetadata=function(te){var B=Reflect.getMetadata(Y.PARAM_TYPES,te),Q=Reflect.getMetadata(Y.TAGGED,te);return{compilerGeneratedMetadata:B,userGeneratedMetadata:Q||{}}},v.prototype.getPropertiesMetadata=function(te){var B=Reflect.getMetadata(Y.TAGGED_PROP,te)||[];return B},v}();H.MetadataReader=J},55314:function(Ze,H){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.Plan=void 0;var R=function(){function Y(J,v){this.parentContext=J,this.rootRequest=v}return Y}();H.Plan=R},86311:function(Ze,H,R){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.getBindingDictionary=H.createMockRequest=H.plan=void 0;var Y=R(23184),J=R(16674),v=R(28421),te=R(6867),B=R(85265),Q=R(55800),ie=R(95228),Ee=R(47738),re=R(55314),Ge=R(6e3),Ce=R(6748),tt=R(18924);function Mt(X){return X._bindingDictionary}H.getBindingDictionary=Mt;function ir(X,Kt,vt,qe,dt,$e){var kt=X?te.MULTI_INJECT_TAG:te.INJECT_TAG,yr=new Ee.Metadata(kt,vt),Pr=new tt.Target(Kt,qe,vt,yr);if(dt!==void 0){var Wr=new Ee.Metadata(dt,$e);Pr.metadata.push(Wr)}return Pr}function bt(X,Kt,vt,qe,dt){var $e=ot(vt.container,dt.serviceIdentifier),kt=[];return $e.length===Y.BindingCount.NoBindingsAvailable&&vt.container.options.autoBindInjectable&&typeof dt.serviceIdentifier=="function"&&X.getConstructorMetadata(dt.serviceIdentifier).compilerGeneratedMetadata&&(vt.container.bind(dt.serviceIdentifier).toSelf(),$e=ot(vt.container,dt.serviceIdentifier)),Kt?kt=$e:kt=$e.filter(function(yr){var Pr=new Ce.Request(yr.serviceIdentifier,vt,qe,yr,dt);return yr.constraint(Pr)}),qt(dt.serviceIdentifier,kt,dt,vt.container),kt}function qt(X,Kt,vt,qe){switch(Kt.length){case Y.BindingCount.NoBindingsAvailable:if(vt.isOptional())return Kt;var dt=Q.getServiceIdentifierAsString(X),$e=J.NOT_REGISTERED;throw $e+=Q.listMetadataForTarget(dt,vt),$e+=Q.listRegisteredBindingsForServiceIdentifier(qe,dt,ot),new Error($e);case Y.BindingCount.OnlyOneBindingAvailable:if(!vt.isArray())return Kt;case Y.BindingCount.MultipleBindingsAvailable:default:if(vt.isArray())return Kt;var dt=Q.getServiceIdentifierAsString(X),$e=J.AMBIGUOUS_MATCH+" "+dt;throw $e+=Q.listRegisteredBindingsForServiceIdentifier(qe,dt,ot),new Error($e)}}function At(X,Kt,vt,qe,dt,$e){var kt,yr;if(dt===null){kt=bt(X,Kt,qe,null,$e),yr=new Ce.Request(vt,qe,null,kt,$e);var Pr=new re.Plan(qe,yr);qe.addPlan(Pr)}else kt=bt(X,Kt,qe,dt,$e),yr=dt.addChildRequest($e.serviceIdentifier,kt,$e);kt.forEach(function(Wr){var Te=null;if($e.isArray())Te=yr.addChildRequest(Wr.serviceIdentifier,Wr,$e);else{if(Wr.cache)return;Te=yr}if(Wr.type===v.BindingTypeEnum.Instance&&Wr.implementationType!==null){var Ye=Ge.getDependencies(X,Wr.implementationType);if(!qe.container.options.skipBaseClassChecks){var De=Ge.getBaseClassDependencyCount(X,Wr.implementationType);if(Ye.length<De){var wt=J.ARGUMENTS_LENGTH_MISMATCH(Ge.getFunctionName(Wr.implementationType));throw new Error(wt)}}Ye.forEach(function(gt){At(X,!1,gt.serviceIdentifier,qe,Te,gt)})}})}function ot(X,Kt){var vt=[],qe=Mt(X);return qe.hasKey(Kt)?vt=qe.get(Kt):X.parent!==null&&(vt=ot(X.parent,Kt)),vt}function ct(X,Kt,vt,qe,dt,$e,kt,yr){yr===void 0&&(yr=!1);var Pr=new ie.Context(Kt),Wr=ir(vt,qe,dt,"",$e,kt);try{return At(X,yr,dt,Pr,null,Wr),Pr}catch(Te){throw B.isStackOverflowExeption(Te)&&Pr.plan&&Q.circularDependencyToException(Pr.plan.rootRequest),Te}}H.plan=ct;function Qt(X,Kt,vt,qe){var dt=new tt.Target(v.TargetTypeEnum.Variable,"",Kt,new Ee.Metadata(vt,qe)),$e=new ie.Context(X),kt=new Ce.Request(Kt,$e,null,[],dt);return kt}H.createMockRequest=Qt},88460:function(Ze,H){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.QueryableString=void 0;var R=function(){function Y(J){this.str=J}return Y.prototype.startsWith=function(J){return this.str.indexOf(J)===0},Y.prototype.endsWith=function(J){var v="",te=J.split("").reverse().join("");return v=this.str.split("").reverse().join(""),this.startsWith.call({str:v},te)},Y.prototype.contains=function(J){return this.str.indexOf(J)!==-1},Y.prototype.equals=function(J){return this.str===J},Y.prototype.value=function(){return this.str},Y}();H.QueryableString=R},6e3:function(Ze,H,R){"use strict";var Y=this&&this.__spreadArray||function(bt,qt){for(var At=0,ot=qt.length,ct=bt.length;At<ot;At++,ct++)bt[ct]=qt[At];return bt};Object.defineProperty(H,"__esModule",{value:!0}),H.getFunctionName=H.getBaseClassDependencyCount=H.getDependencies=void 0;var J=R(5744),v=R(16674),te=R(28421),B=R(6867),Q=R(55800);Object.defineProperty(H,"getFunctionName",{enumerable:!0,get:function(){return Q.getFunctionName}});var ie=R(18924);function Ee(bt,qt){var At=Q.getFunctionName(qt),ot=re(bt,At,qt,!1);return ot}H.getDependencies=Ee;function re(bt,qt,At,ot){var ct=bt.getConstructorMetadata(At),Qt=ct.compilerGeneratedMetadata;if(Qt===void 0){var X=v.MISSING_INJECTABLE_ANNOTATION+" "+qt+".";throw new Error(X)}var Kt=ct.userGeneratedMetadata,vt=Object.keys(Kt),qe=At.length===0&&vt.length>0,dt=vt.length>At.length,$e=qe||dt?vt.length:At.length,kt=Ce(ot,qt,Qt,Kt,$e),yr=tt(bt,At),Pr=Y(Y([],kt),yr);return Pr}function Ge(bt,qt,At,ot,ct){var Qt=ct[bt.toString()]||[],X=ir(Qt),Kt=X.unmanaged!==!0,vt=ot[bt],qe=X.inject||X.multiInject;if(vt=qe||vt,vt instanceof J.LazyServiceIdentifer&&(vt=vt.unwrap()),Kt){var dt=vt===Object,$e=vt===Function,kt=vt===void 0,yr=dt||$e||kt;if(!qt&&yr){var Pr=v.MISSING_INJECT_ANNOTATION+" argument "+bt+" in class "+At+".";throw new Error(Pr)}var Wr=new ie.Target(te.TargetTypeEnum.ConstructorArgument,X.targetName,vt);return Wr.metadata=Qt,Wr}return null}function Ce(bt,qt,At,ot,ct){for(var Qt=[],X=0;X<ct;X++){var Kt=X,vt=Ge(Kt,bt,qt,At,ot);vt!==null&&Qt.push(vt)}return Qt}function tt(bt,qt){for(var At=bt.getPropertiesMetadata(qt),ot=[],ct=Object.keys(At),Qt=0,X=ct;Qt<X.length;Qt++){var Kt=X[Qt],vt=At[Kt],qe=ir(At[Kt]),dt=qe.targetName||Kt,$e=qe.inject||qe.multiInject,kt=new ie.Target(te.TargetTypeEnum.ClassProperty,dt,$e);kt.metadata=vt,ot.push(kt)}var yr=Object.getPrototypeOf(qt.prototype).constructor;if(yr!==Object){var Pr=tt(bt,yr);ot=Y(Y([],ot),Pr)}return ot}function Mt(bt,qt){var At=Object.getPrototypeOf(qt.prototype).constructor;if(At!==Object){var ot=Q.getFunctionName(At),ct=re(bt,ot,At,!0),Qt=ct.map(function(vt){return vt.metadata.filter(function(qe){return qe.key===B.UNMANAGED_TAG})}),X=[].concat.apply([],Qt).length,Kt=ct.length-X;return Kt>0?Kt:Mt(bt,At)}else return 0}H.getBaseClassDependencyCount=Mt;function ir(bt){var qt={};return bt.forEach(function(At){qt[At.key.toString()]=At.value}),{inject:qt[B.INJECT_TAG],multiInject:qt[B.MULTI_INJECT_TAG],targetName:qt[B.NAME_TAG],unmanaged:qt[B.UNMANAGED_TAG]}}},6748:function(Ze,H,R){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.Request=void 0;var Y=R(37791),J=function(){function v(te,B,Q,ie,Ee){this.id=Y.id(),this.serviceIdentifier=te,this.parentContext=B,this.parentRequest=Q,this.target=Ee,this.childRequests=[],this.bindings=Array.isArray(ie)?ie:[ie],this.requestScope=Q===null?new Map:null}return v.prototype.addChildRequest=function(te,B,Q){var ie=new v(te,this.parentContext,this,B,Q);return this.childRequests.push(ie),ie},v}();H.Request=J},18924:function(Ze,H,R){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.Target=void 0;var Y=R(6867),J=R(37791),v=R(47738),te=R(88460),B=function(){function Q(ie,Ee,re,Ge){this.id=J.id(),this.type=ie,this.serviceIdentifier=re,this.name=new te.QueryableString(Ee||""),this.metadata=new Array;var Ce=null;typeof Ge=="string"?Ce=new v.Metadata(Y.NAMED_TAG,Ge):Ge instanceof v.Metadata&&(Ce=Ge),Ce!==null&&this.metadata.push(Ce)}return Q.prototype.hasTag=function(ie){for(var Ee=0,re=this.metadata;Ee<re.length;Ee++){var Ge=re[Ee];if(Ge.key===ie)return!0}return!1},Q.prototype.isArray=function(){return this.hasTag(Y.MULTI_INJECT_TAG)},Q.prototype.matchesArray=function(ie){return this.matchesTag(Y.MULTI_INJECT_TAG)(ie)},Q.prototype.isNamed=function(){return this.hasTag(Y.NAMED_TAG)},Q.prototype.isTagged=function(){return this.metadata.some(function(ie){return Y.NON_CUSTOM_TAG_KEYS.every(function(Ee){return ie.key!==Ee})})},Q.prototype.isOptional=function(){return this.matchesTag(Y.OPTIONAL_TAG)(!0)},Q.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(ie){return ie.key===Y.NAMED_TAG})[0]:null},Q.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(ie){return Y.NON_CUSTOM_TAG_KEYS.every(function(Ee){return ie.key!==Ee})}):null},Q.prototype.matchesNamedTag=function(ie){return this.matchesTag(Y.NAMED_TAG)(ie)},Q.prototype.matchesTag=function(ie){var Ee=this;return function(re){for(var Ge=0,Ce=Ee.metadata;Ge<Ce.length;Ge++){var tt=Ce[Ge];if(tt.key===ie&&tt.value===re)return!0}return!1}},Q}();H.Target=B},52279:function(Ze,H,R){"use strict";var Y=this&&this.__spreadArray||function(re,Ge){for(var Ce=0,tt=Ge.length,Mt=re.length;Ce<tt;Ce++,Mt++)re[Mt]=Ge[Ce];return re};Object.defineProperty(H,"__esModule",{value:!0}),H.resolveInstance=void 0;var J=R(16674),v=R(28421),te=R(6867);function B(re,Ge,Ce){var tt=Ge.filter(function(ir){return ir.target!==null&&ir.target.type===v.TargetTypeEnum.ClassProperty}),Mt=tt.map(Ce);return tt.forEach(function(ir,bt){var qt="";qt=ir.target.name.value();var At=Mt[bt];re[qt]=At}),re}function Q(re,Ge){return new(re.bind.apply(re,Y([void 0],Ge)))}function ie(re,Ge){if(Reflect.hasMetadata(te.POST_CONSTRUCT,re)){var Ce=Reflect.getMetadata(te.POST_CONSTRUCT,re);try{Ge[Ce.value]()}catch(tt){throw new Error(J.POST_CONSTRUCT_ERROR(re.name,tt.message))}}}function Ee(re,Ge,Ce){var tt=null;if(Ge.length>0){var Mt=Ge.filter(function(bt){return bt.target!==null&&bt.target.type===v.TargetTypeEnum.ConstructorArgument}),ir=Mt.map(Ce);tt=Q(re,ir),tt=B(tt,Ge,Ce)}else tt=new re;return ie(re,tt),tt}H.resolveInstance=Ee},31927:function(Ze,H,R){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.resolve=void 0;var Y=R(16674),J=R(28421),v=R(85265),te=R(55800),B=R(52279),Q=function(re,Ge,Ce){try{return Ce()}catch(tt){throw v.isStackOverflowExeption(tt)?new Error(Y.CIRCULAR_DEPENDENCY_IN_FACTORY(re,Ge.toString())):tt}},ie=function(re){return function(Ge){Ge.parentContext.setCurrentRequest(Ge);var Ce=Ge.bindings,tt=Ge.childRequests,Mt=Ge.target&&Ge.target.isArray(),ir=!Ge.parentRequest||!Ge.parentRequest.target||!Ge.target||!Ge.parentRequest.target.matchesArray(Ge.target.serviceIdentifier);if(Mt&&ir)return tt.map(function(Qt){var X=ie(re);return X(Qt)});var bt=null;if(Ge.target.isOptional()&&Ce.length===0)return;var qt=Ce[0],At=qt.scope===J.BindingScopeEnum.Singleton,ot=qt.scope===J.BindingScopeEnum.Request;if(At&&qt.activated)return qt.cache;if(ot&&re!==null&&re.has(qt.id))return re.get(qt.id);if(qt.type===J.BindingTypeEnum.ConstantValue)bt=qt.cache,qt.activated=!0;else if(qt.type===J.BindingTypeEnum.Function)bt=qt.cache,qt.activated=!0;else if(qt.type===J.BindingTypeEnum.Constructor)bt=qt.implementationType;else if(qt.type===J.BindingTypeEnum.DynamicValue&&qt.dynamicValue!==null)bt=Q("toDynamicValue",qt.serviceIdentifier,function(){return qt.dynamicValue(Ge.parentContext)});else if(qt.type===J.BindingTypeEnum.Factory&&qt.factory!==null)bt=Q("toFactory",qt.serviceIdentifier,function(){return qt.factory(Ge.parentContext)});else if(qt.type===J.BindingTypeEnum.Provider&&qt.provider!==null)bt=Q("toProvider",qt.serviceIdentifier,function(){return qt.provider(Ge.parentContext)});else if(qt.type===J.BindingTypeEnum.Instance&&qt.implementationType!==null)bt=B.resolveInstance(qt.implementationType,tt,ie(re));else{var ct=te.getServiceIdentifierAsString(Ge.serviceIdentifier);throw new Error(Y.INVALID_BINDING_TYPE+" "+ct)}return typeof qt.onActivation=="function"&&(bt=qt.onActivation(Ge.parentContext,bt)),At&&(qt.cache=bt,qt.activated=!0),ot&&re!==null&&!re.has(qt.id)&&re.set(qt.id,bt),bt}};function Ee(re){var Ge=ie(re.plan.rootRequest.requestScope);return Ge(re.plan.rootRequest)}H.resolve=Ee},83366:function(Ze,H,R){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.BindingInSyntax=void 0;var Y=R(28421),J=R(71325),v=function(){function te(B){this._binding=B}return te.prototype.inRequestScope=function(){return this._binding.scope=Y.BindingScopeEnum.Request,new J.BindingWhenOnSyntax(this._binding)},te.prototype.inSingletonScope=function(){return this._binding.scope=Y.BindingScopeEnum.Singleton,new J.BindingWhenOnSyntax(this._binding)},te.prototype.inTransientScope=function(){return this._binding.scope=Y.BindingScopeEnum.Transient,new J.BindingWhenOnSyntax(this._binding)},te}();H.BindingInSyntax=v},74889:function(Ze,H,R){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.BindingInWhenOnSyntax=void 0;var Y=R(83366),J=R(51811),v=R(98370),te=function(){function B(Q){this._binding=Q,this._bindingWhenSyntax=new v.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new J.BindingOnSyntax(this._binding),this._bindingInSyntax=new Y.BindingInSyntax(Q)}return B.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},B.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},B.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},B.prototype.when=function(Q){return this._bindingWhenSyntax.when(Q)},B.prototype.whenTargetNamed=function(Q){return this._bindingWhenSyntax.whenTargetNamed(Q)},B.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},B.prototype.whenTargetTagged=function(Q,ie){return this._bindingWhenSyntax.whenTargetTagged(Q,ie)},B.prototype.whenInjectedInto=function(Q){return this._bindingWhenSyntax.whenInjectedInto(Q)},B.prototype.whenParentNamed=function(Q){return this._bindingWhenSyntax.whenParentNamed(Q)},B.prototype.whenParentTagged=function(Q,ie){return this._bindingWhenSyntax.whenParentTagged(Q,ie)},B.prototype.whenAnyAncestorIs=function(Q){return this._bindingWhenSyntax.whenAnyAncestorIs(Q)},B.prototype.whenNoAncestorIs=function(Q){return this._bindingWhenSyntax.whenNoAncestorIs(Q)},B.prototype.whenAnyAncestorNamed=function(Q){return this._bindingWhenSyntax.whenAnyAncestorNamed(Q)},B.prototype.whenAnyAncestorTagged=function(Q,ie){return this._bindingWhenSyntax.whenAnyAncestorTagged(Q,ie)},B.prototype.whenNoAncestorNamed=function(Q){return this._bindingWhenSyntax.whenNoAncestorNamed(Q)},B.prototype.whenNoAncestorTagged=function(Q,ie){return this._bindingWhenSyntax.whenNoAncestorTagged(Q,ie)},B.prototype.whenAnyAncestorMatches=function(Q){return this._bindingWhenSyntax.whenAnyAncestorMatches(Q)},B.prototype.whenNoAncestorMatches=function(Q){return this._bindingWhenSyntax.whenNoAncestorMatches(Q)},B.prototype.onActivation=function(Q){return this._bindingOnSyntax.onActivation(Q)},B}();H.BindingInWhenOnSyntax=te},51811:function(Ze,H,R){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.BindingOnSyntax=void 0;var Y=R(98370),J=function(){function v(te){this._binding=te}return v.prototype.onActivation=function(te){return this._binding.onActivation=te,new Y.BindingWhenSyntax(this._binding)},v}();H.BindingOnSyntax=J},15451:function(Ze,H,R){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.BindingToSyntax=void 0;var Y=R(16674),J=R(28421),v=R(74889),te=R(71325),B=function(){function Q(ie){this._binding=ie}return Q.prototype.to=function(ie){return this._binding.type=J.BindingTypeEnum.Instance,this._binding.implementationType=ie,new v.BindingInWhenOnSyntax(this._binding)},Q.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+Y.INVALID_TO_SELF_VALUE);var ie=this._binding.serviceIdentifier;return this.to(ie)},Q.prototype.toConstantValue=function(ie){return this._binding.type=J.BindingTypeEnum.ConstantValue,this._binding.cache=ie,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=J.BindingScopeEnum.Singleton,new te.BindingWhenOnSyntax(this._binding)},Q.prototype.toDynamicValue=function(ie){return this._binding.type=J.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=ie,this._binding.implementationType=null,new v.BindingInWhenOnSyntax(this._binding)},Q.prototype.toConstructor=function(ie){return this._binding.type=J.BindingTypeEnum.Constructor,this._binding.implementationType=ie,this._binding.scope=J.BindingScopeEnum.Singleton,new te.BindingWhenOnSyntax(this._binding)},Q.prototype.toFactory=function(ie){return this._binding.type=J.BindingTypeEnum.Factory,this._binding.factory=ie,this._binding.scope=J.BindingScopeEnum.Singleton,new te.BindingWhenOnSyntax(this._binding)},Q.prototype.toFunction=function(ie){if(typeof ie!="function")throw new Error(Y.INVALID_FUNCTION_BINDING);var Ee=this.toConstantValue(ie);return this._binding.type=J.BindingTypeEnum.Function,this._binding.scope=J.BindingScopeEnum.Singleton,Ee},Q.prototype.toAutoFactory=function(ie){return this._binding.type=J.BindingTypeEnum.Factory,this._binding.factory=function(Ee){var re=function(){return Ee.container.get(ie)};return re},this._binding.scope=J.BindingScopeEnum.Singleton,new te.BindingWhenOnSyntax(this._binding)},Q.prototype.toProvider=function(ie){return this._binding.type=J.BindingTypeEnum.Provider,this._binding.provider=ie,this._binding.scope=J.BindingScopeEnum.Singleton,new te.BindingWhenOnSyntax(this._binding)},Q.prototype.toService=function(ie){this.toDynamicValue(function(Ee){return Ee.container.get(ie)})},Q}();H.BindingToSyntax=B},71325:function(Ze,H,R){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.BindingWhenOnSyntax=void 0;var Y=R(51811),J=R(98370),v=function(){function te(B){this._binding=B,this._bindingWhenSyntax=new J.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new Y.BindingOnSyntax(this._binding)}return te.prototype.when=function(B){return this._bindingWhenSyntax.when(B)},te.prototype.whenTargetNamed=function(B){return this._bindingWhenSyntax.whenTargetNamed(B)},te.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},te.prototype.whenTargetTagged=function(B,Q){return this._bindingWhenSyntax.whenTargetTagged(B,Q)},te.prototype.whenInjectedInto=function(B){return this._bindingWhenSyntax.whenInjectedInto(B)},te.prototype.whenParentNamed=function(B){return this._bindingWhenSyntax.whenParentNamed(B)},te.prototype.whenParentTagged=function(B,Q){return this._bindingWhenSyntax.whenParentTagged(B,Q)},te.prototype.whenAnyAncestorIs=function(B){return this._bindingWhenSyntax.whenAnyAncestorIs(B)},te.prototype.whenNoAncestorIs=function(B){return this._bindingWhenSyntax.whenNoAncestorIs(B)},te.prototype.whenAnyAncestorNamed=function(B){return this._bindingWhenSyntax.whenAnyAncestorNamed(B)},te.prototype.whenAnyAncestorTagged=function(B,Q){return this._bindingWhenSyntax.whenAnyAncestorTagged(B,Q)},te.prototype.whenNoAncestorNamed=function(B){return this._bindingWhenSyntax.whenNoAncestorNamed(B)},te.prototype.whenNoAncestorTagged=function(B,Q){return this._bindingWhenSyntax.whenNoAncestorTagged(B,Q)},te.prototype.whenAnyAncestorMatches=function(B){return this._bindingWhenSyntax.whenAnyAncestorMatches(B)},te.prototype.whenNoAncestorMatches=function(B){return this._bindingWhenSyntax.whenNoAncestorMatches(B)},te.prototype.onActivation=function(B){return this._bindingOnSyntax.onActivation(B)},te}();H.BindingWhenOnSyntax=v},98370:function(Ze,H,R){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.BindingWhenSyntax=void 0;var Y=R(51811),J=R(80758),v=function(){function te(B){this._binding=B}return te.prototype.when=function(B){return this._binding.constraint=B,new Y.BindingOnSyntax(this._binding)},te.prototype.whenTargetNamed=function(B){return this._binding.constraint=J.namedConstraint(B),new Y.BindingOnSyntax(this._binding)},te.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(B){var Q=B.target!==null&&!B.target.isNamed()&&!B.target.isTagged();return Q},new Y.BindingOnSyntax(this._binding)},te.prototype.whenTargetTagged=function(B,Q){return this._binding.constraint=J.taggedConstraint(B)(Q),new Y.BindingOnSyntax(this._binding)},te.prototype.whenInjectedInto=function(B){return this._binding.constraint=function(Q){return J.typeConstraint(B)(Q.parentRequest)},new Y.BindingOnSyntax(this._binding)},te.prototype.whenParentNamed=function(B){return this._binding.constraint=function(Q){return J.namedConstraint(B)(Q.parentRequest)},new Y.BindingOnSyntax(this._binding)},te.prototype.whenParentTagged=function(B,Q){return this._binding.constraint=function(ie){return J.taggedConstraint(B)(Q)(ie.parentRequest)},new Y.BindingOnSyntax(this._binding)},te.prototype.whenAnyAncestorIs=function(B){return this._binding.constraint=function(Q){return J.traverseAncerstors(Q,J.typeConstraint(B))},new Y.BindingOnSyntax(this._binding)},te.prototype.whenNoAncestorIs=function(B){return this._binding.constraint=function(Q){return!J.traverseAncerstors(Q,J.typeConstraint(B))},new Y.BindingOnSyntax(this._binding)},te.prototype.whenAnyAncestorNamed=function(B){return this._binding.constraint=function(Q){return J.traverseAncerstors(Q,J.namedConstraint(B))},new Y.BindingOnSyntax(this._binding)},te.prototype.whenNoAncestorNamed=function(B){return this._binding.constraint=function(Q){return!J.traverseAncerstors(Q,J.namedConstraint(B))},new Y.BindingOnSyntax(this._binding)},te.prototype.whenAnyAncestorTagged=function(B,Q){return this._binding.constraint=function(ie){return J.traverseAncerstors(ie,J.taggedConstraint(B)(Q))},new Y.BindingOnSyntax(this._binding)},te.prototype.whenNoAncestorTagged=function(B,Q){return this._binding.constraint=function(ie){return!J.traverseAncerstors(ie,J.taggedConstraint(B)(Q))},new Y.BindingOnSyntax(this._binding)},te.prototype.whenAnyAncestorMatches=function(B){return this._binding.constraint=function(Q){return J.traverseAncerstors(Q,B)},new Y.BindingOnSyntax(this._binding)},te.prototype.whenNoAncestorMatches=function(B){return this._binding.constraint=function(Q){return!J.traverseAncerstors(Q,B)},new Y.BindingOnSyntax(this._binding)},te}();H.BindingWhenSyntax=v},80758:function(Ze,H,R){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.typeConstraint=H.namedConstraint=H.taggedConstraint=H.traverseAncerstors=void 0;var Y=R(6867),J=R(47738),v=function(ie,Ee){var re=ie.parentRequest;return re!==null?Ee(re)?!0:v(re,Ee):!1};H.traverseAncerstors=v;var te=function(ie){return function(Ee){var re=function(Ge){return Ge!==null&&Ge.target!==null&&Ge.target.matchesTag(ie)(Ee)};return re.metaData=new J.Metadata(ie,Ee),re}};H.taggedConstraint=te;var B=te(Y.NAMED_TAG);H.namedConstraint=B;var Q=function(ie){return function(Ee){var re=null;if(Ee!==null)if(re=Ee.bindings[0],typeof ie=="string"){var Ge=re.serviceIdentifier;return Ge===ie}else{var Ce=Ee.bindings[0].implementationType;return ie===Ce}return!1}};H.typeConstraint=Q},70600:function(Ze,H){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.multiBindToService=void 0;var R=function(Y){return function(J){return function(){for(var v=[],te=0;te<arguments.length;te++)v[te]=arguments[te];return v.forEach(function(B){return Y.bind(B).toService(J)})}}};H.multiBindToService=R},85265:function(Ze,H,R){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.isStackOverflowExeption=void 0;var Y=R(16674);function J(v){return v instanceof RangeError||v.message===Y.STACK_OVERFLOW}H.isStackOverflowExeption=J},37791:function(Ze,H){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.id=void 0;var R=0;function Y(){return R++}H.id=Y},55800:function(Ze,H,R){"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.circularDependencyToException=H.listMetadataForTarget=H.listRegisteredBindingsForServiceIdentifier=H.getServiceIdentifierAsString=H.getFunctionName=void 0;var Y=R(16674);function J(re){if(typeof re=="function"){var Ge=re;return Ge.name}else{if(typeof re=="symbol")return re.toString();var Ge=re;return Ge}}H.getServiceIdentifierAsString=J;function v(re,Ge,Ce){var tt="",Mt=Ce(re,Ge);return Mt.length!==0&&(tt=`
Registered bindings:`,Mt.forEach(function(ir){var bt="Object";ir.implementationType!==null&&(bt=Ee(ir.implementationType)),tt=tt+`
 `+bt,ir.constraint.metaData&&(tt=tt+" - "+ir.constraint.metaData)})),tt}H.listRegisteredBindingsForServiceIdentifier=v;function te(re,Ge){return re.parentRequest===null?!1:re.parentRequest.serviceIdentifier===Ge?!0:te(re.parentRequest,Ge)}function B(re){function Ge(tt,Mt){Mt===void 0&&(Mt=[]);var ir=J(tt.serviceIdentifier);return Mt.push(ir),tt.parentRequest!==null?Ge(tt.parentRequest,Mt):Mt}var Ce=Ge(re);return Ce.reverse().join(" --> ")}function Q(re){re.childRequests.forEach(function(Ge){if(te(Ge,Ge.serviceIdentifier)){var Ce=B(Ge);throw new Error(Y.CIRCULAR_DEPENDENCY+" "+Ce)}else Q(Ge)})}H.circularDependencyToException=Q;function ie(re,Ge){if(Ge.isTagged()||Ge.isNamed()){var Ce="",tt=Ge.getNamedTag(),Mt=Ge.getCustomTags();return tt!==null&&(Ce+=tt.toString()+`
`),Mt!==null&&Mt.forEach(function(ir){Ce+=ir.toString()+`
`})," "+re+`
 `+re+" - "+Ce}else return" "+re}H.listMetadataForTarget=ie;function Ee(re){if(re.name)return re.name;var Ge=re.toString(),Ce=Ge.match(/^function\s*([^\s(]+)/);return Ce?Ce[1]:"Anonymous function: "+Ge}H.getFunctionName=Ee},31745:function(Ze){"use strict";Ze.exports=R,Ze.exports.default=R;var H=1e20;function R(B,Q,ie,Ee,re,Ge){this.fontSize=B||24,this.buffer=Q===void 0?3:Q,this.cutoff=Ee||.25,this.fontFamily=re||"sans-serif",this.fontWeight=Ge||"normal",this.radius=ie||8;var Ce=this.size=this.fontSize+this.buffer*2,tt=Ce+this.buffer*2,Mt=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";Mt?this.canvas=my.createOffscreenCanvas(Ce,Ce,"2d"):(this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=Ce),this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(tt*tt),this.gridInner=new Float64Array(tt*tt),this.f=new Float64Array(tt),this.z=new Float64Array(tt+1),this.v=new Uint16Array(tt),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,Mt?this.middle=Math.round(Ce/2*1):this.middle=Math.round(Ce/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Y(B,Q,ie,Ee,re,Ge,Ce){Ge.fill(H,0,Q*ie),Ce.fill(0,0,Q*ie);for(var tt=(Q-Ee)/2,Mt=0;Mt<re;Mt++)for(var ir=0;ir<Ee;ir++){var bt=(Mt+tt)*Q+ir+tt,qt=B.data[4*(Mt*Ee+ir)+3]/255;if(qt===1)Ge[bt]=0,Ce[bt]=H;else if(qt===0)Ge[bt]=H,Ce[bt]=0;else{var At=Math.max(0,.5-qt),ot=Math.max(0,qt-.5);Ge[bt]=At*At,Ce[bt]=ot*ot}}}function J(B,Q,ie,Ee,re,Ge,Ce){for(var tt=0;tt<Q*ie;tt++){var Mt=Math.sqrt(Ee[tt])-Math.sqrt(re[tt]);B[tt]=Math.round(255-255*(Mt/Ge+Ce))}}R.prototype._draw=function(B,Q){var ie=this.ctx.measureText(B),Ee=ie.width,re=2*this.buffer,Ge,Ce,tt,Mt,ir,bt,qt,At;Q&&this.useMetrics?(ir=Math.floor(ie.actualBoundingBoxAscent),At=this.buffer+Math.ceil(ie.actualBoundingBoxAscent),bt=this.buffer,qt=this.buffer,Ce=Math.min(this.size,Math.ceil(ie.actualBoundingBoxRight-ie.actualBoundingBoxLeft)),Mt=Math.min(this.size-bt,Math.ceil(ie.actualBoundingBoxAscent+ie.actualBoundingBoxDescent)),Ge=Ce+re,tt=Mt+re,this.ctx.textBaseline="alphabetic"):(Ge=Ce=this.size,tt=Mt=this.size,ir=19*this.fontSize/24,bt=qt=0,At=this.middle,this.ctx.textBaseline="middle");var ot;Ce&&Mt&&(this.ctx.clearRect(qt,bt,Ce,Mt),this.ctx.fillText(B,this.buffer,At),ot=this.ctx.getImageData(qt,bt,Ce,Mt));var ct=new Uint8ClampedArray(Ge*tt);return Y(ot,Ge,tt,Ce,Mt,this.gridOuter,this.gridInner),v(this.gridOuter,Ge,tt,this.f,this.v,this.z),v(this.gridInner,Ge,tt,this.f,this.v,this.z),J(ct,Ge,tt,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:ct,metrics:{width:Ce,height:Mt,sdfWidth:Ge,sdfHeight:tt,top:ir,left:0,advance:Ee}}},R.prototype.draw=function(B){return this._draw(B,!1).data},R.prototype.drawWithMetrics=function(B){return this._draw(B,!0)};function v(B,Q,ie,Ee,re,Ge){for(var Ce=0;Ce<Q;Ce++)te(B,Ce,Q,ie,Ee,re,Ge);for(var tt=0;tt<ie;tt++)te(B,tt*Q,1,Q,Ee,re,Ge)}function te(B,Q,ie,Ee,re,Ge,Ce){var tt,Mt,ir,bt;for(Ge[0]=0,Ce[0]=-H,Ce[1]=H,tt=0;tt<Ee;tt++)re[tt]=B[Q+tt*ie];for(tt=1,Mt=0,ir=0;tt<Ee;tt++){do bt=Ge[Mt],ir=(re[tt]-re[bt]+tt*tt-bt*bt)/(tt-bt)/2;while(ir<=Ce[Mt]&&--Mt>-1);Mt++,Ge[Mt]=tt,Ce[Mt]=ir,Ce[Mt+1]=H}for(tt=0,Mt=0;tt<Ee;tt++){for(;Ce[Mt+1]<tt;)Mt++;bt=Ge[Mt],B[Q+tt*ie]=re[bt]+(tt-bt)*(tt-bt)}}},18857:function(Ze,H,R){"use strict";R.r(H),R.d(H,{Function:function(){return uu},Interpreter:function(){return xo},default:function(){return Wu},evaluate:function(){return Hu},vm:function(){return Y}});var Y={};R.r(Y),R.d(Y,{Script:function(){return Tl},compileFunction:function(){return bc},createContext:function(){return Wl},runInContext:function(){return Gu},runInNewContext:function(){return Ec}});var J={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},v="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",te={5:v,"5module":v+" export import",6:v+" const class extends export import super"},B=/^in(stanceof)?$/,Q="\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC",ie="\u200C\u200D\xB7\u0300-\u036F\u0387\u0483-\u0487\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u0669\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u06F0-\u06F9\u0711\u0730-\u074A\u07A6-\u07B0\u07C0-\u07C9\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0966-\u096F\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09E6-\u09EF\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A66-\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AE6-\u0AEF\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B66-\u0B6F\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0BE6-\u0BEF\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0CE6-\u0CEF\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D66-\u0D6F\u0D81-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0E50-\u0E59\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0ED0-\u0ED9\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1040-\u1049\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F-\u109D\u135D-\u135F\u1369-\u1371\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u18A9\u1920-\u192B\u1930-\u193B\u1946-\u194F\u19D0-\u19DA\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B04\u1B34-\u1B44\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BB0-\u1BB9\u1BE6-\u1BF3\u1C24-\u1C37\u1C40-\u1C49\u1C50-\u1C59\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u203F\u2040\u2054\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA620-\uA629\uA66F\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA82C\uA880\uA881\uA8B4-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F1\uA8FF-\uA909\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9D0-\uA9D9\uA9E5\uA9F0-\uA9F9\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA50-\uAA59\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uABF0-\uABF9\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFF10-\uFF19\uFF3F",Ee=new RegExp("["+Q+"]"),re=new RegExp("["+Q+ie+"]");Q=ie=null;var Ge=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],Ce=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function tt(_,w){for(var N=65536,O=0;O<w.length;O+=2){if(N+=w[O],N>_)return!1;if(N+=w[O+1],N>=_)return!0}}function Mt(_,w){return _<65?_===36:_<91?!0:_<97?_===95:_<123?!0:_<=65535?_>=170&&Ee.test(String.fromCharCode(_)):w===!1?!1:tt(_,Ge)}function ir(_,w){return _<48?_===36:_<58?!0:_<65?!1:_<91?!0:_<97?_===95:_<123?!0:_<=65535?_>=170&&re.test(String.fromCharCode(_)):w===!1?!1:tt(_,Ge)||tt(_,Ce)}var bt=function(w,N){N===void 0&&(N={}),this.label=w,this.keyword=N.keyword,this.beforeExpr=!!N.beforeExpr,this.startsExpr=!!N.startsExpr,this.isLoop=!!N.isLoop,this.isAssign=!!N.isAssign,this.prefix=!!N.prefix,this.postfix=!!N.postfix,this.binop=N.binop||null,this.updateContext=null};function qt(_,w){return new bt(_,{beforeExpr:!0,binop:w})}var At={beforeExpr:!0},ot={startsExpr:!0},ct={};function Qt(_,w){return w===void 0&&(w={}),w.keyword=_,ct[_]=new bt(_,w)}var X={num:new bt("num",ot),regexp:new bt("regexp",ot),string:new bt("string",ot),name:new bt("name",ot),eof:new bt("eof"),bracketL:new bt("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new bt("]"),braceL:new bt("{",{beforeExpr:!0,startsExpr:!0}),braceR:new bt("}"),parenL:new bt("(",{beforeExpr:!0,startsExpr:!0}),parenR:new bt(")"),comma:new bt(",",At),semi:new bt(";",At),colon:new bt(":",At),dot:new bt("."),question:new bt("?",At),questionDot:new bt("?."),arrow:new bt("=>",At),template:new bt("template"),invalidTemplate:new bt("invalidTemplate"),ellipsis:new bt("...",At),backQuote:new bt("`",ot),dollarBraceL:new bt("${",{beforeExpr:!0,startsExpr:!0}),eq:new bt("=",{beforeExpr:!0,isAssign:!0}),assign:new bt("_=",{beforeExpr:!0,isAssign:!0}),incDec:new bt("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new bt("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:qt("||",1),logicalAND:qt("&&",2),bitwiseOR:qt("|",3),bitwiseXOR:qt("^",4),bitwiseAND:qt("&",5),equality:qt("==/!=/===/!==",6),relational:qt("</>/<=/>=",7),bitShift:qt("<</>>/>>>",8),plusMin:new bt("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:qt("%",10),star:qt("*",10),slash:qt("/",10),starstar:new bt("**",{beforeExpr:!0}),coalesce:qt("??",1),_break:Qt("break"),_case:Qt("case",At),_catch:Qt("catch"),_continue:Qt("continue"),_debugger:Qt("debugger"),_default:Qt("default",At),_do:Qt("do",{isLoop:!0,beforeExpr:!0}),_else:Qt("else",At),_finally:Qt("finally"),_for:Qt("for",{isLoop:!0}),_function:Qt("function",ot),_if:Qt("if"),_return:Qt("return",At),_switch:Qt("switch"),_throw:Qt("throw",At),_try:Qt("try"),_var:Qt("var"),_const:Qt("const"),_while:Qt("while",{isLoop:!0}),_with:Qt("with"),_new:Qt("new",{beforeExpr:!0,startsExpr:!0}),_this:Qt("this",ot),_super:Qt("super",ot),_class:Qt("class",ot),_extends:Qt("extends",At),_export:Qt("export"),_import:Qt("import",ot),_null:Qt("null",ot),_true:Qt("true",ot),_false:Qt("false",ot),_in:Qt("in",{beforeExpr:!0,binop:7}),_instanceof:Qt("instanceof",{beforeExpr:!0,binop:7}),_typeof:Qt("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:Qt("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:Qt("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},Kt=/\r\n?|\n|\u2028|\u2029/,vt=new RegExp(Kt.source,"g");function qe(_,w){return _===10||_===13||!w&&(_===8232||_===8233)}var dt=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,$e=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,kt=Object.prototype,yr=kt.hasOwnProperty,Pr=kt.toString;function Wr(_,w){return yr.call(_,w)}var Te=Array.isArray||function(_){return Pr.call(_)==="[object Array]"};function Ye(_){return new RegExp("^(?:"+_.replace(/ /g,"|")+")$")}var De=function(w,N){this.line=w,this.column=N};De.prototype.offset=function(w){return new De(this.line,this.column+w)};var wt=function(w,N,O){this.start=N,this.end=O,w.sourceFile!==null&&(this.source=w.sourceFile)};function gt(_,w){for(var N=1,O=0;;){vt.lastIndex=O;var K=vt.exec(_);if(K&&K.index<w)++N,O=K.index+K[0].length;else return new De(N,w-O)}}var Ut={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function Jt(_){var w={};for(var N in Ut)w[N]=_&&Wr(_,N)?_[N]:Ut[N];if(w.ecmaVersion>=2015&&(w.ecmaVersion-=2009),w.allowReserved==null&&(w.allowReserved=w.ecmaVersion<5),Te(w.onToken)){var O=w.onToken;w.onToken=function(K){return O.push(K)}}return Te(w.onComment)&&(w.onComment=Cr(w,w.onComment)),w}function Cr(_,w){return function(N,O,K,_e,Xe,ft){var mt={type:N?"Block":"Line",value:O,start:K,end:_e};_.locations&&(mt.loc=new wt(this,Xe,ft)),_.ranges&&(mt.range=[K,_e]),w.push(mt)}}var Yn=1,hn=2,qi=Yn|hn,jn=4,Xn=8,vi=16,qn=32,li=64,aa=128;function Di(_,w){return hn|(_?jn:0)|(w?Xn:0)}var Ai=0,Vi=1,la=2,wi=3,Sa=4,Mn=5,Si=function(w,N,O){this.options=w=Jt(w),this.sourceFile=w.sourceFile,this.keywords=Ye(te[w.ecmaVersion>=6?6:w.sourceType==="module"?"5module":5]);var K="";if(w.allowReserved!==!0){for(var _e=w.ecmaVersion;!(K=J[_e]);_e--);w.sourceType==="module"&&(K+=" await")}this.reservedWords=Ye(K);var Xe=(K?K+" ":"")+J.strict;this.reservedWordsStrict=Ye(Xe),this.reservedWordsStrictBind=Ye(Xe+" "+J.strictBind),this.input=String(N),this.containsEsc=!1,O?(this.pos=O,this.lineStart=this.input.lastIndexOf(`
`,O-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(Kt).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=X.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=w.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},this.pos===0&&w.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(Yn),this.regexpState=null},ji={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};Si.prototype.parse=function(){var w=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(w)},ji.inFunction.get=function(){return(this.currentVarScope().flags&hn)>0},ji.inGenerator.get=function(){return(this.currentVarScope().flags&Xn)>0},ji.inAsync.get=function(){return(this.currentVarScope().flags&jn)>0},ji.allowSuper.get=function(){return(this.currentThisScope().flags&li)>0},ji.allowDirectSuper.get=function(){return(this.currentThisScope().flags&aa)>0},ji.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},Si.prototype.inNonArrowFunction=function(){return(this.currentThisScope().flags&hn)>0},Si.extend=function(){for(var w=[],N=arguments.length;N--;)w[N]=arguments[N];for(var O=this,K=0;K<w.length;K++)O=w[K](O);return O},Si.parse=function(w,N){return new this(N,w).parse()},Si.parseExpressionAt=function(w,N,O){var K=new this(O,w,N);return K.nextToken(),K.parseExpression()},Si.tokenizer=function(w,N){return new this(N,w)},Object.defineProperties(Si.prototype,ji);var Ki=Si.prototype,Wa=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;Ki.strictDirective=function(_){for(;;){$e.lastIndex=_,_+=$e.exec(this.input)[0].length;var w=Wa.exec(this.input.slice(_));if(!w)return!1;if((w[1]||w[2])==="use strict"){$e.lastIndex=_+w[0].length;var N=$e.exec(this.input),O=N.index+N[0].length,K=this.input.charAt(O);return K===";"||K==="}"||Kt.test(N[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(K)||K==="!"&&this.input.charAt(O+1)==="=")}_+=w[0].length,$e.lastIndex=_,_+=$e.exec(this.input)[0].length,this.input[_]===";"&&_++}},Ki.eat=function(_){return this.type===_?(this.next(),!0):!1},Ki.isContextual=function(_){return this.type===X.name&&this.value===_&&!this.containsEsc},Ki.eatContextual=function(_){return this.isContextual(_)?(this.next(),!0):!1},Ki.expectContextual=function(_){this.eatContextual(_)||this.unexpected()},Ki.canInsertSemicolon=function(){return this.type===X.eof||this.type===X.braceR||Kt.test(this.input.slice(this.lastTokEnd,this.start))},Ki.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},Ki.semicolon=function(){!this.eat(X.semi)&&!this.insertSemicolon()&&this.unexpected()},Ki.afterTrailingComma=function(_,w){if(this.type===_)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),w||this.next(),!0},Ki.expect=function(_){this.eat(_)||this.unexpected()},Ki.unexpected=function(_){this.raise(_!=null?_:this.start,"Unexpected token")};function ve(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}Ki.checkPatternErrors=function(_,w){if(!!_){_.trailingComma>-1&&this.raiseRecoverable(_.trailingComma,"Comma is not permitted after the rest element");var N=w?_.parenthesizedAssign:_.parenthesizedBind;N>-1&&this.raiseRecoverable(N,"Parenthesized pattern")}},Ki.checkExpressionErrors=function(_,w){if(!_)return!1;var N=_.shorthandAssign,O=_.doubleProto;if(!w)return N>=0||O>=0;N>=0&&this.raise(N,"Shorthand property assignments are valid only in destructuring patterns"),O>=0&&this.raiseRecoverable(O,"Redefinition of __proto__ property")},Ki.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},Ki.isSimpleAssignTarget=function(_){return _.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(_.expression):_.type==="Identifier"||_.type==="MemberExpression"};var Fn=Si.prototype;Fn.parseTopLevel=function(_){var w={};for(_.body||(_.body=[]);this.type!==X.eof;){var N=this.parseStatement(null,!0,w);_.body.push(N)}if(this.inModule)for(var O=0,K=Object.keys(this.undefinedExports);O<K.length;O+=1){var _e=K[O];this.raiseRecoverable(this.undefinedExports[_e].start,"Export '"+_e+"' is not defined")}return this.adaptDirectivePrologue(_.body),this.next(),_.sourceType=this.options.sourceType,this.finishNode(_,"Program")};var Xa={kind:"loop"},fs={kind:"switch"};Fn.isLet=function(_){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;$e.lastIndex=this.pos;var w=$e.exec(this.input),N=this.pos+w[0].length,O=this.input.charCodeAt(N);if(O===91)return!0;if(_)return!1;if(O===123)return!0;if(Mt(O,!0)){for(var K=N+1;ir(this.input.charCodeAt(K),!0);)++K;var _e=this.input.slice(N,K);if(!B.test(_e))return!0}return!1},Fn.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;$e.lastIndex=this.pos;var _=$e.exec(this.input),w=this.pos+_[0].length;return!Kt.test(this.input.slice(this.pos,w))&&this.input.slice(w,w+8)==="function"&&(w+8===this.input.length||!ir(this.input.charAt(w+8)))},Fn.parseStatement=function(_,w,N){var O=this.type,K=this.startNode(),_e;switch(this.isLet(_)&&(O=X._var,_e="let"),O){case X._break:case X._continue:return this.parseBreakContinueStatement(K,O.keyword);case X._debugger:return this.parseDebuggerStatement(K);case X._do:return this.parseDoStatement(K);case X._for:return this.parseForStatement(K);case X._function:return _&&(this.strict||_!=="if"&&_!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(K,!1,!_);case X._class:return _&&this.unexpected(),this.parseClass(K,!0);case X._if:return this.parseIfStatement(K);case X._return:return this.parseReturnStatement(K);case X._switch:return this.parseSwitchStatement(K);case X._throw:return this.parseThrowStatement(K);case X._try:return this.parseTryStatement(K);case X._const:case X._var:return _e=_e||this.value,_&&_e!=="var"&&this.unexpected(),this.parseVarStatement(K,_e);case X._while:return this.parseWhileStatement(K);case X._with:return this.parseWithStatement(K);case X.braceL:return this.parseBlock(!0,K);case X.semi:return this.parseEmptyStatement(K);case X._export:case X._import:if(this.options.ecmaVersion>10&&O===X._import){$e.lastIndex=this.pos;var Xe=$e.exec(this.input),ft=this.pos+Xe[0].length,mt=this.input.charCodeAt(ft);if(mt===40||mt===46)return this.parseExpressionStatement(K,this.parseExpression())}return this.options.allowImportExportEverywhere||(w||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),O===X._import?this.parseImport(K):this.parseExport(K,N);default:if(this.isAsyncFunction())return _&&this.unexpected(),this.next(),this.parseFunctionStatement(K,!0,!_);var cr=this.value,xr=this.parseExpression();return O===X.name&&xr.type==="Identifier"&&this.eat(X.colon)?this.parseLabeledStatement(K,cr,xr,_):this.parseExpressionStatement(K,xr)}},Fn.parseBreakContinueStatement=function(_,w){var N=w==="break";this.next(),this.eat(X.semi)||this.insertSemicolon()?_.label=null:this.type!==X.name?this.unexpected():(_.label=this.parseIdent(),this.semicolon());for(var O=0;O<this.labels.length;++O){var K=this.labels[O];if((_.label==null||K.name===_.label.name)&&(K.kind!=null&&(N||K.kind==="loop")||_.label&&N))break}return O===this.labels.length&&this.raise(_.start,"Unsyntactic "+w),this.finishNode(_,N?"BreakStatement":"ContinueStatement")},Fn.parseDebuggerStatement=function(_){return this.next(),this.semicolon(),this.finishNode(_,"DebuggerStatement")},Fn.parseDoStatement=function(_){return this.next(),this.labels.push(Xa),_.body=this.parseStatement("do"),this.labels.pop(),this.expect(X._while),_.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(X.semi):this.semicolon(),this.finishNode(_,"DoWhileStatement")},Fn.parseForStatement=function(_){this.next();var w=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(Xa),this.enterScope(0),this.expect(X.parenL),this.type===X.semi)return w>-1&&this.unexpected(w),this.parseFor(_,null);var N=this.isLet();if(this.type===X._var||this.type===X._const||N){var O=this.startNode(),K=N?"let":this.value;return this.next(),this.parseVar(O,!0,K),this.finishNode(O,"VariableDeclaration"),(this.type===X._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&O.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===X._in?w>-1&&this.unexpected(w):_.await=w>-1),this.parseForIn(_,O)):(w>-1&&this.unexpected(w),this.parseFor(_,O))}var _e=new ve,Xe=this.parseExpression(!0,_e);return this.type===X._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===X._in?w>-1&&this.unexpected(w):_.await=w>-1),this.toAssignable(Xe,!1,_e),this.checkLVal(Xe),this.parseForIn(_,Xe)):(this.checkExpressionErrors(_e,!0),w>-1&&this.unexpected(w),this.parseFor(_,Xe))},Fn.parseFunctionStatement=function(_,w,N){return this.next(),this.parseFunction(_,sr|(N?0:Tr),!1,w)},Fn.parseIfStatement=function(_){return this.next(),_.test=this.parseParenExpression(),_.consequent=this.parseStatement("if"),_.alternate=this.eat(X._else)?this.parseStatement("if"):null,this.finishNode(_,"IfStatement")},Fn.parseReturnStatement=function(_){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(X.semi)||this.insertSemicolon()?_.argument=null:(_.argument=this.parseExpression(),this.semicolon()),this.finishNode(_,"ReturnStatement")},Fn.parseSwitchStatement=function(_){this.next(),_.discriminant=this.parseParenExpression(),_.cases=[],this.expect(X.braceL),this.labels.push(fs),this.enterScope(0);for(var w,N=!1;this.type!==X.braceR;)if(this.type===X._case||this.type===X._default){var O=this.type===X._case;w&&this.finishNode(w,"SwitchCase"),_.cases.push(w=this.startNode()),w.consequent=[],this.next(),O?w.test=this.parseExpression():(N&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),N=!0,w.test=null),this.expect(X.colon)}else w||this.unexpected(),w.consequent.push(this.parseStatement(null));return this.exitScope(),w&&this.finishNode(w,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(_,"SwitchStatement")},Fn.parseThrowStatement=function(_){return this.next(),Kt.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),_.argument=this.parseExpression(),this.semicolon(),this.finishNode(_,"ThrowStatement")};var jt=[];Fn.parseTryStatement=function(_){if(this.next(),_.block=this.parseBlock(),_.handler=null,this.type===X._catch){var w=this.startNode();if(this.next(),this.eat(X.parenL)){w.param=this.parseBindingAtom();var N=w.param.type==="Identifier";this.enterScope(N?qn:0),this.checkLVal(w.param,N?Sa:la),this.expect(X.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),w.param=null,this.enterScope(0);w.body=this.parseBlock(!1),this.exitScope(),_.handler=this.finishNode(w,"CatchClause")}return _.finalizer=this.eat(X._finally)?this.parseBlock():null,!_.handler&&!_.finalizer&&this.raise(_.start,"Missing catch or finally clause"),this.finishNode(_,"TryStatement")},Fn.parseVarStatement=function(_,w){return this.next(),this.parseVar(_,!1,w),this.semicolon(),this.finishNode(_,"VariableDeclaration")},Fn.parseWhileStatement=function(_){return this.next(),_.test=this.parseParenExpression(),this.labels.push(Xa),_.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(_,"WhileStatement")},Fn.parseWithStatement=function(_){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),_.object=this.parseParenExpression(),_.body=this.parseStatement("with"),this.finishNode(_,"WithStatement")},Fn.parseEmptyStatement=function(_){return this.next(),this.finishNode(_,"EmptyStatement")},Fn.parseLabeledStatement=function(_,w,N,O){for(var K=0,_e=this.labels;K<_e.length;K+=1){var Xe=_e[K];Xe.name===w&&this.raise(N.start,"Label '"+w+"' is already declared")}for(var ft=this.type.isLoop?"loop":this.type===X._switch?"switch":null,mt=this.labels.length-1;mt>=0;mt--){var cr=this.labels[mt];if(cr.statementStart===_.start)cr.statementStart=this.start,cr.kind=ft;else break}return this.labels.push({name:w,kind:ft,statementStart:this.start}),_.body=this.parseStatement(O?O.indexOf("label")===-1?O+"label":O:"label"),this.labels.pop(),_.label=N,this.finishNode(_,"LabeledStatement")},Fn.parseExpressionStatement=function(_,w){return _.expression=w,this.semicolon(),this.finishNode(_,"ExpressionStatement")},Fn.parseBlock=function(_,w,N){for(_===void 0&&(_=!0),w===void 0&&(w=this.startNode()),w.body=[],this.expect(X.braceL),_&&this.enterScope(0);this.type!==X.braceR;){var O=this.parseStatement(null);w.body.push(O)}return N&&(this.strict=!1),this.next(),_&&this.exitScope(),this.finishNode(w,"BlockStatement")},Fn.parseFor=function(_,w){return _.init=w,this.expect(X.semi),_.test=this.type===X.semi?null:this.parseExpression(),this.expect(X.semi),_.update=this.type===X.parenR?null:this.parseExpression(),this.expect(X.parenR),_.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(_,"ForStatement")},Fn.parseForIn=function(_,w){var N=this.type===X._in;return this.next(),w.type==="VariableDeclaration"&&w.declarations[0].init!=null&&(!N||this.options.ecmaVersion<8||this.strict||w.kind!=="var"||w.declarations[0].id.type!=="Identifier")?this.raise(w.start,(N?"for-in":"for-of")+" loop variable declaration may not have an initializer"):w.type==="AssignmentPattern"&&this.raise(w.start,"Invalid left-hand side in for-loop"),_.left=w,_.right=N?this.parseExpression():this.parseMaybeAssign(),this.expect(X.parenR),_.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(_,N?"ForInStatement":"ForOfStatement")},Fn.parseVar=function(_,w,N){for(_.declarations=[],_.kind=N;;){var O=this.startNode();if(this.parseVarId(O,N),this.eat(X.eq)?O.init=this.parseMaybeAssign(w):N==="const"&&!(this.type===X._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():O.id.type!=="Identifier"&&!(w&&(this.type===X._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):O.init=null,_.declarations.push(this.finishNode(O,"VariableDeclarator")),!this.eat(X.comma))break}return _},Fn.parseVarId=function(_,w){_.id=this.parseBindingAtom(),this.checkLVal(_.id,w==="var"?Vi:la,!1)};var sr=1,Tr=2,I=4;Fn.parseFunction=function(_,w,N,O){this.initFunction(_),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!O)&&(this.type===X.star&&w&Tr&&this.unexpected(),_.generator=this.eat(X.star)),this.options.ecmaVersion>=8&&(_.async=!!O),w&sr&&(_.id=w&I&&this.type!==X.name?null:this.parseIdent(),_.id&&!(w&Tr)&&this.checkLVal(_.id,this.strict||_.generator||_.async?this.treatFunctionsAsVar?Vi:la:wi));var K=this.yieldPos,_e=this.awaitPos,Xe=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(Di(_.async,_.generator)),w&sr||(_.id=this.type===X.name?this.parseIdent():null),this.parseFunctionParams(_),this.parseFunctionBody(_,N,!1),this.yieldPos=K,this.awaitPos=_e,this.awaitIdentPos=Xe,this.finishNode(_,w&sr?"FunctionDeclaration":"FunctionExpression")},Fn.parseFunctionParams=function(_){this.expect(X.parenL),_.params=this.parseBindingList(X.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},Fn.parseClass=function(_,w){this.next();var N=this.strict;this.strict=!0,this.parseClassId(_,w),this.parseClassSuper(_);var O=this.startNode(),K=!1;for(O.body=[],this.expect(X.braceL);this.type!==X.braceR;){var _e=this.parseClassElement(_.superClass!==null);_e&&(O.body.push(_e),_e.type==="MethodDefinition"&&_e.kind==="constructor"&&(K&&this.raise(_e.start,"Duplicate constructor in the same class"),K=!0))}return this.strict=N,this.next(),_.body=this.finishNode(O,"ClassBody"),this.finishNode(_,w?"ClassDeclaration":"ClassExpression")},Fn.parseClassElement=function(_){var w=this;if(this.eat(X.semi))return null;var N=this.startNode(),O=function(mt,cr){cr===void 0&&(cr=!1);var xr=w.start,Pn=w.startLoc;return w.eatContextual(mt)?w.type!==X.parenL&&(!cr||!w.canInsertSemicolon())?!0:(N.key&&w.unexpected(),N.computed=!1,N.key=w.startNodeAt(xr,Pn),N.key.name=mt,w.finishNode(N.key,"Identifier"),!1):!1};N.kind="method",N.static=O("static");var K=this.eat(X.star),_e=!1;K||(this.options.ecmaVersion>=8&&O("async",!0)?(_e=!0,K=this.options.ecmaVersion>=9&&this.eat(X.star)):O("get")?N.kind="get":O("set")&&(N.kind="set")),N.key||this.parsePropertyName(N);var Xe=N.key,ft=!1;return!N.computed&&!N.static&&(Xe.type==="Identifier"&&Xe.name==="constructor"||Xe.type==="Literal"&&Xe.value==="constructor")?(N.kind!=="method"&&this.raise(Xe.start,"Constructor can't have get/set modifier"),K&&this.raise(Xe.start,"Constructor can't be a generator"),_e&&this.raise(Xe.start,"Constructor can't be an async method"),N.kind="constructor",ft=_):N.static&&Xe.type==="Identifier"&&Xe.name==="prototype"&&this.raise(Xe.start,"Classes may not have a static property named prototype"),this.parseClassMethod(N,K,_e,ft),N.kind==="get"&&N.value.params.length!==0&&this.raiseRecoverable(N.value.start,"getter should have no params"),N.kind==="set"&&N.value.params.length!==1&&this.raiseRecoverable(N.value.start,"setter should have exactly one param"),N.kind==="set"&&N.value.params[0].type==="RestElement"&&this.raiseRecoverable(N.value.params[0].start,"Setter cannot use rest params"),N},Fn.parseClassMethod=function(_,w,N,O){return _.value=this.parseMethod(w,N,O),this.finishNode(_,"MethodDefinition")},Fn.parseClassId=function(_,w){this.type===X.name?(_.id=this.parseIdent(),w&&this.checkLVal(_.id,la,!1)):(w===!0&&this.unexpected(),_.id=null)},Fn.parseClassSuper=function(_){_.superClass=this.eat(X._extends)?this.parseExprSubscripts():null},Fn.parseExport=function(_,w){if(this.next(),this.eat(X.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(_.exported=this.parseIdent(!0),this.checkExport(w,_.exported.name,this.lastTokStart)):_.exported=null),this.expectContextual("from"),this.type!==X.string&&this.unexpected(),_.source=this.parseExprAtom(),this.semicolon(),this.finishNode(_,"ExportAllDeclaration");if(this.eat(X._default)){this.checkExport(w,"default",this.lastTokStart);var N;if(this.type===X._function||(N=this.isAsyncFunction())){var O=this.startNode();this.next(),N&&this.next(),_.declaration=this.parseFunction(O,sr|I,!1,N)}else if(this.type===X._class){var K=this.startNode();_.declaration=this.parseClass(K,"nullableID")}else _.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(_,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())_.declaration=this.parseStatement(null),_.declaration.type==="VariableDeclaration"?this.checkVariableExport(w,_.declaration.declarations):this.checkExport(w,_.declaration.id.name,_.declaration.id.start),_.specifiers=[],_.source=null;else{if(_.declaration=null,_.specifiers=this.parseExportSpecifiers(w),this.eatContextual("from"))this.type!==X.string&&this.unexpected(),_.source=this.parseExprAtom();else{for(var _e=0,Xe=_.specifiers;_e<Xe.length;_e+=1){var ft=Xe[_e];this.checkUnreserved(ft.local),this.checkLocalExport(ft.local)}_.source=null}this.semicolon()}return this.finishNode(_,"ExportNamedDeclaration")},Fn.checkExport=function(_,w,N){!_||(Wr(_,w)&&this.raiseRecoverable(N,"Duplicate export '"+w+"'"),_[w]=!0)},Fn.checkPatternExport=function(_,w){var N=w.type;if(N==="Identifier")this.checkExport(_,w.name,w.start);else if(N==="ObjectPattern")for(var O=0,K=w.properties;O<K.length;O+=1){var _e=K[O];this.checkPatternExport(_,_e)}else if(N==="ArrayPattern")for(var Xe=0,ft=w.elements;Xe<ft.length;Xe+=1){var mt=ft[Xe];mt&&this.checkPatternExport(_,mt)}else N==="Property"?this.checkPatternExport(_,w.value):N==="AssignmentPattern"?this.checkPatternExport(_,w.left):N==="RestElement"?this.checkPatternExport(_,w.argument):N==="ParenthesizedExpression"&&this.checkPatternExport(_,w.expression)},Fn.checkVariableExport=function(_,w){if(!!_)for(var N=0,O=w;N<O.length;N+=1){var K=O[N];this.checkPatternExport(_,K.id)}},Fn.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()},Fn.parseExportSpecifiers=function(_){var w=[],N=!0;for(this.expect(X.braceL);!this.eat(X.braceR);){if(N)N=!1;else if(this.expect(X.comma),this.afterTrailingComma(X.braceR))break;var O=this.startNode();O.local=this.parseIdent(!0),O.exported=this.eatContextual("as")?this.parseIdent(!0):O.local,this.checkExport(_,O.exported.name,O.exported.start),w.push(this.finishNode(O,"ExportSpecifier"))}return w},Fn.parseImport=function(_){return this.next(),this.type===X.string?(_.specifiers=jt,_.source=this.parseExprAtom()):(_.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),_.source=this.type===X.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(_,"ImportDeclaration")},Fn.parseImportSpecifiers=function(){var _=[],w=!0;if(this.type===X.name){var N=this.startNode();if(N.local=this.parseIdent(),this.checkLVal(N.local,la),_.push(this.finishNode(N,"ImportDefaultSpecifier")),!this.eat(X.comma))return _}if(this.type===X.star){var O=this.startNode();return this.next(),this.expectContextual("as"),O.local=this.parseIdent(),this.checkLVal(O.local,la),_.push(this.finishNode(O,"ImportNamespaceSpecifier")),_}for(this.expect(X.braceL);!this.eat(X.braceR);){if(w)w=!1;else if(this.expect(X.comma),this.afterTrailingComma(X.braceR))break;var K=this.startNode();K.imported=this.parseIdent(!0),this.eatContextual("as")?K.local=this.parseIdent():(this.checkUnreserved(K.imported),K.local=K.imported),this.checkLVal(K.local,la),_.push(this.finishNode(K,"ImportSpecifier"))}return _},Fn.adaptDirectivePrologue=function(_){for(var w=0;w<_.length&&this.isDirectiveCandidate(_[w]);++w)_[w].directive=_[w].expression.raw.slice(1,-1)},Fn.isDirectiveCandidate=function(_){return _.type==="ExpressionStatement"&&_.expression.type==="Literal"&&typeof _.expression.value=="string"&&(this.input[_.start]==='"'||this.input[_.start]==="'")};var ur=Si.prototype;ur.toAssignable=function(_,w,N){if(this.options.ecmaVersion>=6&&_)switch(_.type){case"Identifier":this.inAsync&&_.name==="await"&&this.raise(_.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":_.type="ObjectPattern",N&&this.checkPatternErrors(N,!0);for(var O=0,K=_.properties;O<K.length;O+=1){var _e=K[O];this.toAssignable(_e,w),_e.type==="RestElement"&&(_e.argument.type==="ArrayPattern"||_e.argument.type==="ObjectPattern")&&this.raise(_e.argument.start,"Unexpected token")}break;case"Property":_.kind!=="init"&&this.raise(_.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(_.value,w);break;case"ArrayExpression":_.type="ArrayPattern",N&&this.checkPatternErrors(N,!0),this.toAssignableList(_.elements,w);break;case"SpreadElement":_.type="RestElement",this.toAssignable(_.argument,w),_.argument.type==="AssignmentPattern"&&this.raise(_.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":_.operator!=="="&&this.raise(_.left.end,"Only '=' operator can be used for specifying default value."),_.type="AssignmentPattern",delete _.operator,this.toAssignable(_.left,w);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(_.expression,w,N);break;case"ChainExpression":this.raiseRecoverable(_.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!w)break;default:this.raise(_.start,"Assigning to rvalue")}else N&&this.checkPatternErrors(N,!0);return _},ur.toAssignableList=function(_,w){for(var N=_.length,O=0;O<N;O++){var K=_[O];K&&this.toAssignable(K,w)}if(N){var _e=_[N-1];this.options.ecmaVersion===6&&w&&_e&&_e.type==="RestElement"&&_e.argument.type!=="Identifier"&&this.unexpected(_e.argument.start)}return _},ur.parseSpread=function(_){var w=this.startNode();return this.next(),w.argument=this.parseMaybeAssign(!1,_),this.finishNode(w,"SpreadElement")},ur.parseRestBinding=function(){var _=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==X.name&&this.unexpected(),_.argument=this.parseBindingAtom(),this.finishNode(_,"RestElement")},ur.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case X.bracketL:var _=this.startNode();return this.next(),_.elements=this.parseBindingList(X.bracketR,!0,!0),this.finishNode(_,"ArrayPattern");case X.braceL:return this.parseObj(!0)}return this.parseIdent()},ur.parseBindingList=function(_,w,N){for(var O=[],K=!0;!this.eat(_);)if(K?K=!1:this.expect(X.comma),w&&this.type===X.comma)O.push(null);else{if(N&&this.afterTrailingComma(_))break;if(this.type===X.ellipsis){var _e=this.parseRestBinding();this.parseBindingListItem(_e),O.push(_e),this.type===X.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(_);break}else{var Xe=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(Xe),O.push(Xe)}}return O},ur.parseBindingListItem=function(_){return _},ur.parseMaybeDefault=function(_,w,N){if(N=N||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(X.eq))return N;var O=this.startNodeAt(_,w);return O.left=N,O.right=this.parseMaybeAssign(),this.finishNode(O,"AssignmentPattern")},ur.checkLVal=function(_,w,N){switch(w===void 0&&(w=Ai),_.type){case"Identifier":w===la&&_.name==="let"&&this.raiseRecoverable(_.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(_.name)&&this.raiseRecoverable(_.start,(w?"Binding ":"Assigning to ")+_.name+" in strict mode"),N&&(Wr(N,_.name)&&this.raiseRecoverable(_.start,"Argument name clash"),N[_.name]=!0),w!==Ai&&w!==Mn&&this.declareName(_.name,w,_.start);break;case"ChainExpression":this.raiseRecoverable(_.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":w&&this.raiseRecoverable(_.start,"Binding member expression");break;case"ObjectPattern":for(var O=0,K=_.properties;O<K.length;O+=1){var _e=K[O];this.checkLVal(_e,w,N)}break;case"Property":this.checkLVal(_.value,w,N);break;case"ArrayPattern":for(var Xe=0,ft=_.elements;Xe<ft.length;Xe+=1){var mt=ft[Xe];mt&&this.checkLVal(mt,w,N)}break;case"AssignmentPattern":this.checkLVal(_.left,w,N);break;case"RestElement":this.checkLVal(_.argument,w,N);break;case"ParenthesizedExpression":this.checkLVal(_.expression,w,N);break;default:this.raise(_.start,(w?"Binding":"Assigning to")+" rvalue")}};var Ln=Si.prototype;Ln.checkPropClash=function(_,w,N){if(!(this.options.ecmaVersion>=9&&_.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(_.computed||_.method||_.shorthand))){var O=_.key,K;switch(O.type){case"Identifier":K=O.name;break;case"Literal":K=String(O.value);break;default:return}var _e=_.kind;if(this.options.ecmaVersion>=6){K==="__proto__"&&_e==="init"&&(w.proto&&(N?N.doubleProto<0&&(N.doubleProto=O.start):this.raiseRecoverable(O.start,"Redefinition of __proto__ property")),w.proto=!0);return}K="$"+K;var Xe=w[K];if(Xe){var ft;_e==="init"?ft=this.strict&&Xe.init||Xe.get||Xe.set:ft=Xe.init||Xe[_e],ft&&this.raiseRecoverable(O.start,"Redefinition of property")}else Xe=w[K]={init:!1,get:!1,set:!1};Xe[_e]=!0}},Ln.parseExpression=function(_,w){var N=this.start,O=this.startLoc,K=this.parseMaybeAssign(_,w);if(this.type===X.comma){var _e=this.startNodeAt(N,O);for(_e.expressions=[K];this.eat(X.comma);)_e.expressions.push(this.parseMaybeAssign(_,w));return this.finishNode(_e,"SequenceExpression")}return K},Ln.parseMaybeAssign=function(_,w,N){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(_);this.exprAllowed=!1}var O=!1,K=-1,_e=-1;w?(K=w.parenthesizedAssign,_e=w.trailingComma,w.parenthesizedAssign=w.trailingComma=-1):(w=new ve,O=!0);var Xe=this.start,ft=this.startLoc;(this.type===X.parenL||this.type===X.name)&&(this.potentialArrowAt=this.start);var mt=this.parseMaybeConditional(_,w);if(N&&(mt=N.call(this,mt,Xe,ft)),this.type.isAssign){var cr=this.startNodeAt(Xe,ft);return cr.operator=this.value,cr.left=this.type===X.eq?this.toAssignable(mt,!1,w):mt,O||(w.parenthesizedAssign=w.trailingComma=w.doubleProto=-1),w.shorthandAssign>=cr.left.start&&(w.shorthandAssign=-1),this.checkLVal(mt),this.next(),cr.right=this.parseMaybeAssign(_),this.finishNode(cr,"AssignmentExpression")}else O&&this.checkExpressionErrors(w,!0);return K>-1&&(w.parenthesizedAssign=K),_e>-1&&(w.trailingComma=_e),mt},Ln.parseMaybeConditional=function(_,w){var N=this.start,O=this.startLoc,K=this.parseExprOps(_,w);if(this.checkExpressionErrors(w))return K;if(this.eat(X.question)){var _e=this.startNodeAt(N,O);return _e.test=K,_e.consequent=this.parseMaybeAssign(),this.expect(X.colon),_e.alternate=this.parseMaybeAssign(_),this.finishNode(_e,"ConditionalExpression")}return K},Ln.parseExprOps=function(_,w){var N=this.start,O=this.startLoc,K=this.parseMaybeUnary(w,!1);return this.checkExpressionErrors(w)||K.start===N&&K.type==="ArrowFunctionExpression"?K:this.parseExprOp(K,N,O,-1,_)},Ln.parseExprOp=function(_,w,N,O,K){var _e=this.type.binop;if(_e!=null&&(!K||this.type!==X._in)&&_e>O){var Xe=this.type===X.logicalOR||this.type===X.logicalAND,ft=this.type===X.coalesce;ft&&(_e=X.logicalAND.binop);var mt=this.value;this.next();var cr=this.start,xr=this.startLoc,Pn=this.parseExprOp(this.parseMaybeUnary(null,!1),cr,xr,_e,K),fi=this.buildBinary(w,N,_,Pn,mt,Xe||ft);return(Xe&&this.type===X.coalesce||ft&&(this.type===X.logicalOR||this.type===X.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(fi,w,N,O,K)}return _},Ln.buildBinary=function(_,w,N,O,K,_e){var Xe=this.startNodeAt(_,w);return Xe.left=N,Xe.operator=K,Xe.right=O,this.finishNode(Xe,_e?"LogicalExpression":"BinaryExpression")},Ln.parseMaybeUnary=function(_,w){var N=this.start,O=this.startLoc,K;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))K=this.parseAwait(),w=!0;else if(this.type.prefix){var _e=this.startNode(),Xe=this.type===X.incDec;_e.operator=this.value,_e.prefix=!0,this.next(),_e.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(_,!0),Xe?this.checkLVal(_e.argument):this.strict&&_e.operator==="delete"&&_e.argument.type==="Identifier"?this.raiseRecoverable(_e.start,"Deleting local variable in strict mode"):w=!0,K=this.finishNode(_e,Xe?"UpdateExpression":"UnaryExpression")}else{if(K=this.parseExprSubscripts(_),this.checkExpressionErrors(_))return K;for(;this.type.postfix&&!this.canInsertSemicolon();){var ft=this.startNodeAt(N,O);ft.operator=this.value,ft.prefix=!1,ft.argument=K,this.checkLVal(K),this.next(),K=this.finishNode(ft,"UpdateExpression")}}return!w&&this.eat(X.starstar)?this.buildBinary(N,O,K,this.parseMaybeUnary(null,!1),"**",!1):K},Ln.parseExprSubscripts=function(_){var w=this.start,N=this.startLoc,O=this.parseExprAtom(_);if(O.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return O;var K=this.parseSubscripts(O,w,N);return _&&K.type==="MemberExpression"&&(_.parenthesizedAssign>=K.start&&(_.parenthesizedAssign=-1),_.parenthesizedBind>=K.start&&(_.parenthesizedBind=-1)),K},Ln.parseSubscripts=function(_,w,N,O){for(var K=this.options.ecmaVersion>=8&&_.type==="Identifier"&&_.name==="async"&&this.lastTokEnd===_.end&&!this.canInsertSemicolon()&&_.end-_.start==5&&this.potentialArrowAt===_.start,_e=!1;;){var Xe=this.parseSubscript(_,w,N,O,K,_e);if(Xe.optional&&(_e=!0),Xe===_||Xe.type==="ArrowFunctionExpression"){if(_e){var ft=this.startNodeAt(w,N);ft.expression=Xe,Xe=this.finishNode(ft,"ChainExpression")}return Xe}_=Xe}},Ln.parseSubscript=function(_,w,N,O,K,_e){var Xe=this.options.ecmaVersion>=11,ft=Xe&&this.eat(X.questionDot);O&&ft&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var mt=this.eat(X.bracketL);if(mt||ft&&this.type!==X.parenL&&this.type!==X.backQuote||this.eat(X.dot)){var cr=this.startNodeAt(w,N);cr.object=_,cr.property=mt?this.parseExpression():this.parseIdent(this.options.allowReserved!=="never"),cr.computed=!!mt,mt&&this.expect(X.bracketR),Xe&&(cr.optional=ft),_=this.finishNode(cr,"MemberExpression")}else if(!O&&this.eat(X.parenL)){var xr=new ve,Pn=this.yieldPos,fi=this.awaitPos,Qn=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var Yi=this.parseExprList(X.parenR,this.options.ecmaVersion>=8,!1,xr);if(K&&!ft&&!this.canInsertSemicolon()&&this.eat(X.arrow))return this.checkPatternErrors(xr,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=Pn,this.awaitPos=fi,this.awaitIdentPos=Qn,this.parseArrowExpression(this.startNodeAt(w,N),Yi,!0);this.checkExpressionErrors(xr,!0),this.yieldPos=Pn||this.yieldPos,this.awaitPos=fi||this.awaitPos,this.awaitIdentPos=Qn||this.awaitIdentPos;var da=this.startNodeAt(w,N);da.callee=_,da.arguments=Yi,Xe&&(da.optional=ft),_=this.finishNode(da,"CallExpression")}else if(this.type===X.backQuote){(ft||_e)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var Ra=this.startNodeAt(w,N);Ra.tag=_,Ra.quasi=this.parseTemplate({isTagged:!0}),_=this.finishNode(Ra,"TaggedTemplateExpression")}return _},Ln.parseExprAtom=function(_){this.type===X.slash&&this.readRegexp();var w,N=this.potentialArrowAt===this.start;switch(this.type){case X._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),w=this.startNode(),this.next(),this.type===X.parenL&&!this.allowDirectSuper&&this.raise(w.start,"super() call outside constructor of a subclass"),this.type!==X.dot&&this.type!==X.bracketL&&this.type!==X.parenL&&this.unexpected(),this.finishNode(w,"Super");case X._this:return w=this.startNode(),this.next(),this.finishNode(w,"ThisExpression");case X.name:var O=this.start,K=this.startLoc,_e=this.containsEsc,Xe=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!_e&&Xe.name==="async"&&!this.canInsertSemicolon()&&this.eat(X._function))return this.parseFunction(this.startNodeAt(O,K),0,!1,!0);if(N&&!this.canInsertSemicolon()){if(this.eat(X.arrow))return this.parseArrowExpression(this.startNodeAt(O,K),[Xe],!1);if(this.options.ecmaVersion>=8&&Xe.name==="async"&&this.type===X.name&&!_e)return Xe=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(X.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(O,K),[Xe],!0)}return Xe;case X.regexp:var ft=this.value;return w=this.parseLiteral(ft.value),w.regex={pattern:ft.pattern,flags:ft.flags},w;case X.num:case X.string:return this.parseLiteral(this.value);case X._null:case X._true:case X._false:return w=this.startNode(),w.value=this.type===X._null?null:this.type===X._true,w.raw=this.type.keyword,this.next(),this.finishNode(w,"Literal");case X.parenL:var mt=this.start,cr=this.parseParenAndDistinguishExpression(N);return _&&(_.parenthesizedAssign<0&&!this.isSimpleAssignTarget(cr)&&(_.parenthesizedAssign=mt),_.parenthesizedBind<0&&(_.parenthesizedBind=mt)),cr;case X.bracketL:return w=this.startNode(),this.next(),w.elements=this.parseExprList(X.bracketR,!0,!0,_),this.finishNode(w,"ArrayExpression");case X.braceL:return this.parseObj(!1,_);case X._function:return w=this.startNode(),this.next(),this.parseFunction(w,0);case X._class:return this.parseClass(this.startNode(),!1);case X._new:return this.parseNew();case X.backQuote:return this.parseTemplate();case X._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},Ln.parseExprImport=function(){var _=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var w=this.parseIdent(!0);switch(this.type){case X.parenL:return this.parseDynamicImport(_);case X.dot:return _.meta=w,this.parseImportMeta(_);default:this.unexpected()}},Ln.parseDynamicImport=function(_){if(this.next(),_.source=this.parseMaybeAssign(),!this.eat(X.parenR)){var w=this.start;this.eat(X.comma)&&this.eat(X.parenR)?this.raiseRecoverable(w,"Trailing comma is not allowed in import()"):this.unexpected(w)}return this.finishNode(_,"ImportExpression")},Ln.parseImportMeta=function(_){this.next();var w=this.containsEsc;return _.property=this.parseIdent(!0),_.property.name!=="meta"&&this.raiseRecoverable(_.property.start,"The only valid meta property for import is 'import.meta'"),w&&this.raiseRecoverable(_.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&this.raiseRecoverable(_.start,"Cannot use 'import.meta' outside a module"),this.finishNode(_,"MetaProperty")},Ln.parseLiteral=function(_){var w=this.startNode();return w.value=_,w.raw=this.input.slice(this.start,this.end),w.raw.charCodeAt(w.raw.length-1)===110&&(w.bigint=w.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(w,"Literal")},Ln.parseParenExpression=function(){this.expect(X.parenL);var _=this.parseExpression();return this.expect(X.parenR),_},Ln.parseParenAndDistinguishExpression=function(_){var w=this.start,N=this.startLoc,O,K=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var _e=this.start,Xe=this.startLoc,ft=[],mt=!0,cr=!1,xr=new ve,Pn=this.yieldPos,fi=this.awaitPos,Qn;for(this.yieldPos=0,this.awaitPos=0;this.type!==X.parenR;)if(mt?mt=!1:this.expect(X.comma),K&&this.afterTrailingComma(X.parenR,!0)){cr=!0;break}else if(this.type===X.ellipsis){Qn=this.start,ft.push(this.parseParenItem(this.parseRestBinding())),this.type===X.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}else ft.push(this.parseMaybeAssign(!1,xr,this.parseParenItem));var Yi=this.start,da=this.startLoc;if(this.expect(X.parenR),_&&!this.canInsertSemicolon()&&this.eat(X.arrow))return this.checkPatternErrors(xr,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=Pn,this.awaitPos=fi,this.parseParenArrowList(w,N,ft);(!ft.length||cr)&&this.unexpected(this.lastTokStart),Qn&&this.unexpected(Qn),this.checkExpressionErrors(xr,!0),this.yieldPos=Pn||this.yieldPos,this.awaitPos=fi||this.awaitPos,ft.length>1?(O=this.startNodeAt(_e,Xe),O.expressions=ft,this.finishNodeAt(O,"SequenceExpression",Yi,da)):O=ft[0]}else O=this.parseParenExpression();if(this.options.preserveParens){var Ra=this.startNodeAt(w,N);return Ra.expression=O,this.finishNode(Ra,"ParenthesizedExpression")}else return O},Ln.parseParenItem=function(_){return _},Ln.parseParenArrowList=function(_,w,N){return this.parseArrowExpression(this.startNodeAt(_,w),N)};var ci=[];Ln.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var _=this.startNode(),w=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(X.dot)){_.meta=w;var N=this.containsEsc;return _.property=this.parseIdent(!0),_.property.name!=="target"&&this.raiseRecoverable(_.property.start,"The only valid meta property for new is 'new.target'"),N&&this.raiseRecoverable(_.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction()||this.raiseRecoverable(_.start,"'new.target' can only be used in functions"),this.finishNode(_,"MetaProperty")}var O=this.start,K=this.startLoc,_e=this.type===X._import;return _.callee=this.parseSubscripts(this.parseExprAtom(),O,K,!0),_e&&_.callee.type==="ImportExpression"&&this.raise(O,"Cannot use new with import()"),this.eat(X.parenL)?_.arguments=this.parseExprList(X.parenR,this.options.ecmaVersion>=8,!1):_.arguments=ci,this.finishNode(_,"NewExpression")},Ln.parseTemplateElement=function(_){var w=_.isTagged,N=this.startNode();return this.type===X.invalidTemplate?(w||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),N.value={raw:this.value,cooked:null}):N.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),N.tail=this.type===X.backQuote,this.finishNode(N,"TemplateElement")},Ln.parseTemplate=function(_){_===void 0&&(_={});var w=_.isTagged;w===void 0&&(w=!1);var N=this.startNode();this.next(),N.expressions=[];var O=this.parseTemplateElement({isTagged:w});for(N.quasis=[O];!O.tail;)this.type===X.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(X.dollarBraceL),N.expressions.push(this.parseExpression()),this.expect(X.braceR),N.quasis.push(O=this.parseTemplateElement({isTagged:w}));return this.next(),this.finishNode(N,"TemplateLiteral")},Ln.isAsyncProp=function(_){return!_.computed&&_.key.type==="Identifier"&&_.key.name==="async"&&(this.type===X.name||this.type===X.num||this.type===X.string||this.type===X.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===X.star)&&!Kt.test(this.input.slice(this.lastTokEnd,this.start))},Ln.parseObj=function(_,w){var N=this.startNode(),O=!0,K={};for(N.properties=[],this.next();!this.eat(X.braceR);){if(O)O=!1;else if(this.expect(X.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(X.braceR))break;var _e=this.parseProperty(_,w);_||this.checkPropClash(_e,K,w),N.properties.push(_e)}return this.finishNode(N,_?"ObjectPattern":"ObjectExpression")},Ln.parseProperty=function(_,w){var N=this.startNode(),O,K,_e,Xe;if(this.options.ecmaVersion>=9&&this.eat(X.ellipsis))return _?(N.argument=this.parseIdent(!1),this.type===X.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(N,"RestElement")):(this.type===X.parenL&&w&&(w.parenthesizedAssign<0&&(w.parenthesizedAssign=this.start),w.parenthesizedBind<0&&(w.parenthesizedBind=this.start)),N.argument=this.parseMaybeAssign(!1,w),this.type===X.comma&&w&&w.trailingComma<0&&(w.trailingComma=this.start),this.finishNode(N,"SpreadElement"));this.options.ecmaVersion>=6&&(N.method=!1,N.shorthand=!1,(_||w)&&(_e=this.start,Xe=this.startLoc),_||(O=this.eat(X.star)));var ft=this.containsEsc;return this.parsePropertyName(N),!_&&!ft&&this.options.ecmaVersion>=8&&!O&&this.isAsyncProp(N)?(K=!0,O=this.options.ecmaVersion>=9&&this.eat(X.star),this.parsePropertyName(N,w)):K=!1,this.parsePropertyValue(N,_,O,K,_e,Xe,w,ft),this.finishNode(N,"Property")},Ln.parsePropertyValue=function(_,w,N,O,K,_e,Xe,ft){if((N||O)&&this.type===X.colon&&this.unexpected(),this.eat(X.colon))_.value=w?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,Xe),_.kind="init";else if(this.options.ecmaVersion>=6&&this.type===X.parenL)w&&this.unexpected(),_.kind="init",_.method=!0,_.value=this.parseMethod(N,O);else if(!w&&!ft&&this.options.ecmaVersion>=5&&!_.computed&&_.key.type==="Identifier"&&(_.key.name==="get"||_.key.name==="set")&&this.type!==X.comma&&this.type!==X.braceR&&this.type!==X.eq){(N||O)&&this.unexpected(),_.kind=_.key.name,this.parsePropertyName(_),_.value=this.parseMethod(!1);var mt=_.kind==="get"?0:1;if(_.value.params.length!==mt){var cr=_.value.start;_.kind==="get"?this.raiseRecoverable(cr,"getter should have no params"):this.raiseRecoverable(cr,"setter should have exactly one param")}else _.kind==="set"&&_.value.params[0].type==="RestElement"&&this.raiseRecoverable(_.value.params[0].start,"Setter cannot use rest params")}else this.options.ecmaVersion>=6&&!_.computed&&_.key.type==="Identifier"?((N||O)&&this.unexpected(),this.checkUnreserved(_.key),_.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=K),_.kind="init",w?_.value=this.parseMaybeDefault(K,_e,_.key):this.type===X.eq&&Xe?(Xe.shorthandAssign<0&&(Xe.shorthandAssign=this.start),_.value=this.parseMaybeDefault(K,_e,_.key)):_.value=_.key,_.shorthand=!0):this.unexpected()},Ln.parsePropertyName=function(_){if(this.options.ecmaVersion>=6){if(this.eat(X.bracketL))return _.computed=!0,_.key=this.parseMaybeAssign(),this.expect(X.bracketR),_.key;_.computed=!1}return _.key=this.type===X.num||this.type===X.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")},Ln.initFunction=function(_){_.id=null,this.options.ecmaVersion>=6&&(_.generator=_.expression=!1),this.options.ecmaVersion>=8&&(_.async=!1)},Ln.parseMethod=function(_,w,N){var O=this.startNode(),K=this.yieldPos,_e=this.awaitPos,Xe=this.awaitIdentPos;return this.initFunction(O),this.options.ecmaVersion>=6&&(O.generator=_),this.options.ecmaVersion>=8&&(O.async=!!w),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(Di(w,O.generator)|li|(N?aa:0)),this.expect(X.parenL),O.params=this.parseBindingList(X.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(O,!1,!0),this.yieldPos=K,this.awaitPos=_e,this.awaitIdentPos=Xe,this.finishNode(O,"FunctionExpression")},Ln.parseArrowExpression=function(_,w,N){var O=this.yieldPos,K=this.awaitPos,_e=this.awaitIdentPos;return this.enterScope(Di(N,!1)|vi),this.initFunction(_),this.options.ecmaVersion>=8&&(_.async=!!N),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,_.params=this.toAssignableList(w,!0),this.parseFunctionBody(_,!0,!1),this.yieldPos=O,this.awaitPos=K,this.awaitIdentPos=_e,this.finishNode(_,"ArrowFunctionExpression")},Ln.parseFunctionBody=function(_,w,N){var O=w&&this.type!==X.braceL,K=this.strict,_e=!1;if(O)_.body=this.parseMaybeAssign(),_.expression=!0,this.checkParams(_,!1);else{var Xe=this.options.ecmaVersion>=7&&!this.isSimpleParamList(_.params);(!K||Xe)&&(_e=this.strictDirective(this.end),_e&&Xe&&this.raiseRecoverable(_.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var ft=this.labels;this.labels=[],_e&&(this.strict=!0),this.checkParams(_,!K&&!_e&&!w&&!N&&this.isSimpleParamList(_.params)),this.strict&&_.id&&this.checkLVal(_.id,Mn),_.body=this.parseBlock(!1,void 0,_e&&!K),_.expression=!1,this.adaptDirectivePrologue(_.body.body),this.labels=ft}this.exitScope()},Ln.isSimpleParamList=function(_){for(var w=0,N=_;w<N.length;w+=1){var O=N[w];if(O.type!=="Identifier")return!1}return!0},Ln.checkParams=function(_,w){for(var N={},O=0,K=_.params;O<K.length;O+=1){var _e=K[O];this.checkLVal(_e,Vi,w?null:N)}},Ln.parseExprList=function(_,w,N,O){for(var K=[],_e=!0;!this.eat(_);){if(_e)_e=!1;else if(this.expect(X.comma),w&&this.afterTrailingComma(_))break;var Xe=void 0;N&&this.type===X.comma?Xe=null:this.type===X.ellipsis?(Xe=this.parseSpread(O),O&&this.type===X.comma&&O.trailingComma<0&&(O.trailingComma=this.start)):Xe=this.parseMaybeAssign(!1,O),K.push(Xe)}return K},Ln.checkUnreserved=function(_){var w=_.start,N=_.end,O=_.name;if(this.inGenerator&&O==="yield"&&this.raiseRecoverable(w,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&O==="await"&&this.raiseRecoverable(w,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(O)&&this.raise(w,"Unexpected keyword '"+O+"'"),!(this.options.ecmaVersion<6&&this.input.slice(w,N).indexOf("\\")!==-1)){var K=this.strict?this.reservedWordsStrict:this.reservedWords;K.test(O)&&(!this.inAsync&&O==="await"&&this.raiseRecoverable(w,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(w,"The keyword '"+O+"' is reserved"))}},Ln.parseIdent=function(_,w){var N=this.startNode();return this.type===X.name?N.name=this.value:this.type.keyword?(N.name=this.type.keyword,(N.name==="class"||N.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop()):this.unexpected(),this.next(!!_),this.finishNode(N,"Identifier"),_||(this.checkUnreserved(N),N.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=N.start)),N},Ln.parseYield=function(_){this.yieldPos||(this.yieldPos=this.start);var w=this.startNode();return this.next(),this.type===X.semi||this.canInsertSemicolon()||this.type!==X.star&&!this.type.startsExpr?(w.delegate=!1,w.argument=null):(w.delegate=this.eat(X.star),w.argument=this.parseMaybeAssign(_)),this.finishNode(w,"YieldExpression")},Ln.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var _=this.startNode();return this.next(),_.argument=this.parseMaybeUnary(null,!1),this.finishNode(_,"AwaitExpression")};var Gn=Si.prototype;Gn.raise=function(_,w){var N=gt(this.input,_);w+=" ("+N.line+":"+N.column+")";var O=new SyntaxError(w);throw O.pos=_,O.loc=N,O.raisedAt=this.pos,O},Gn.raiseRecoverable=Gn.raise,Gn.curPosition=function(){if(this.options.locations)return new De(this.curLine,this.pos-this.lineStart)};var rn=Si.prototype,Pi=function(w){this.flags=w,this.var=[],this.lexical=[],this.functions=[]};rn.enterScope=function(_){this.scopeStack.push(new Pi(_))},rn.exitScope=function(){this.scopeStack.pop()},rn.treatFunctionsAsVarInScope=function(_){return _.flags&hn||!this.inModule&&_.flags&Yn},rn.declareName=function(_,w,N){var O=!1;if(w===la){var K=this.currentScope();O=K.lexical.indexOf(_)>-1||K.functions.indexOf(_)>-1||K.var.indexOf(_)>-1,K.lexical.push(_),this.inModule&&K.flags&Yn&&delete this.undefinedExports[_]}else if(w===Sa){var _e=this.currentScope();_e.lexical.push(_)}else if(w===wi){var Xe=this.currentScope();this.treatFunctionsAsVar?O=Xe.lexical.indexOf(_)>-1:O=Xe.lexical.indexOf(_)>-1||Xe.var.indexOf(_)>-1,Xe.functions.push(_)}else for(var ft=this.scopeStack.length-1;ft>=0;--ft){var mt=this.scopeStack[ft];if(mt.lexical.indexOf(_)>-1&&!(mt.flags&qn&&mt.lexical[0]===_)||!this.treatFunctionsAsVarInScope(mt)&&mt.functions.indexOf(_)>-1){O=!0;break}if(mt.var.push(_),this.inModule&&mt.flags&Yn&&delete this.undefinedExports[_],mt.flags&qi)break}O&&this.raiseRecoverable(N,"Identifier '"+_+"' has already been declared")},rn.checkLocalExport=function(_){this.scopeStack[0].lexical.indexOf(_.name)===-1&&this.scopeStack[0].var.indexOf(_.name)===-1&&(this.undefinedExports[_.name]=_)},rn.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},rn.currentVarScope=function(){for(var _=this.scopeStack.length-1;;_--){var w=this.scopeStack[_];if(w.flags&qi)return w}},rn.currentThisScope=function(){for(var _=this.scopeStack.length-1;;_--){var w=this.scopeStack[_];if(w.flags&qi&&!(w.flags&vi))return w}};var Ii=function(w,N,O){this.type="",this.start=N,this.end=0,w.options.locations&&(this.loc=new wt(w,O)),w.options.directSourceFile&&(this.sourceFile=w.options.directSourceFile),w.options.ranges&&(this.range=[N,0])},Ja=Si.prototype;Ja.startNode=function(){return new Ii(this,this.start,this.startLoc)},Ja.startNodeAt=function(_,w){return new Ii(this,_,w)};function hs(_,w,N,O){return _.type=w,_.end=N,this.options.locations&&(_.loc.end=O),this.options.ranges&&(_.range[1]=N),_}Ja.finishNode=function(_,w){return hs.call(this,_,w,this.lastTokEnd,this.lastTokEndLoc)},Ja.finishNodeAt=function(_,w,N,O){return hs.call(this,_,w,N,O)};var _a=function(w,N,O,K,_e){this.token=w,this.isExpr=!!N,this.preserveSpace=!!O,this.override=K,this.generator=!!_e},Da={b_stat:new _a("{",!1),b_expr:new _a("{",!0),b_tmpl:new _a("${",!1),p_stat:new _a("(",!1),p_expr:new _a("(",!0),q_tmpl:new _a("`",!0,!0,function(_){return _.tryReadTemplateToken()}),f_stat:new _a("function",!1),f_expr:new _a("function",!0),f_expr_gen:new _a("function",!0,!1,null,!0),f_gen:new _a("function",!1,!1,null,!0)},Ta=Si.prototype;Ta.initialContext=function(){return[Da.b_stat]},Ta.braceIsBlock=function(_){var w=this.curContext();return w===Da.f_expr||w===Da.f_stat?!0:_===X.colon&&(w===Da.b_stat||w===Da.b_expr)?!w.isExpr:_===X._return||_===X.name&&this.exprAllowed?Kt.test(this.input.slice(this.lastTokEnd,this.start)):_===X._else||_===X.semi||_===X.eof||_===X.parenR||_===X.arrow?!0:_===X.braceL?w===Da.b_stat:_===X._var||_===X._const||_===X.name?!1:!this.exprAllowed},Ta.inGeneratorContext=function(){for(var _=this.context.length-1;_>=1;_--){var w=this.context[_];if(w.token==="function")return w.generator}return!1},Ta.updateContext=function(_){var w,N=this.type;N.keyword&&_===X.dot?this.exprAllowed=!1:(w=N.updateContext)?w.call(this,_):this.exprAllowed=N.beforeExpr},X.parenR.updateContext=X.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var _=this.context.pop();_===Da.b_stat&&this.curContext().token==="function"&&(_=this.context.pop()),this.exprAllowed=!_.isExpr},X.braceL.updateContext=function(_){this.context.push(this.braceIsBlock(_)?Da.b_stat:Da.b_expr),this.exprAllowed=!0},X.dollarBraceL.updateContext=function(){this.context.push(Da.b_tmpl),this.exprAllowed=!0},X.parenL.updateContext=function(_){var w=_===X._if||_===X._for||_===X._with||_===X._while;this.context.push(w?Da.p_stat:Da.p_expr),this.exprAllowed=!0},X.incDec.updateContext=function(){},X._function.updateContext=X._class.updateContext=function(_){_.beforeExpr&&_!==X.semi&&_!==X._else&&!(_===X._return&&Kt.test(this.input.slice(this.lastTokEnd,this.start)))&&!((_===X.colon||_===X.braceL)&&this.curContext()===Da.b_stat)?this.context.push(Da.f_expr):this.context.push(Da.f_stat),this.exprAllowed=!1},X.backQuote.updateContext=function(){this.curContext()===Da.q_tmpl?this.context.pop():this.context.push(Da.q_tmpl),this.exprAllowed=!1},X.star.updateContext=function(_){if(_===X._function){var w=this.context.length-1;this.context[w]===Da.f_expr?this.context[w]=Da.f_expr_gen:this.context[w]=Da.f_gen}this.exprAllowed=!0},X.name.updateContext=function(_){var w=!1;this.options.ecmaVersion>=6&&_!==X.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(w=!0),this.exprAllowed=w};var V="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",$=V+" Extended_Pictographic",se=$,ge={9:V,10:$,11:se},Oe="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",We="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",nt=We+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",pe=nt+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",Fe={9:We,10:nt,11:pe},yt={};function dr(_){var w=yt[_]={binary:Ye(ge[_]+" "+Oe),nonBinary:{General_Category:Ye(Oe),Script:Ye(Fe[_])}};w.nonBinary.Script_Extensions=w.nonBinary.Script,w.nonBinary.gc=w.nonBinary.General_Category,w.nonBinary.sc=w.nonBinary.Script,w.nonBinary.scx=w.nonBinary.Script_Extensions}dr(9),dr(10),dr(11);var Dt=Si.prototype,zt=function(w){this.parser=w,this.validFlags="gim"+(w.options.ecmaVersion>=6?"uy":"")+(w.options.ecmaVersion>=9?"s":""),this.unicodeProperties=yt[w.options.ecmaVersion>=11?11:w.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};zt.prototype.reset=function(w,N,O){var K=O.indexOf("u")!==-1;this.start=w|0,this.source=N+"",this.flags=O,this.switchU=K&&this.parser.options.ecmaVersion>=6,this.switchN=K&&this.parser.options.ecmaVersion>=9},zt.prototype.raise=function(w){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+w)},zt.prototype.at=function(w,N){N===void 0&&(N=!1);var O=this.source,K=O.length;if(w>=K)return-1;var _e=O.charCodeAt(w);if(!(N||this.switchU)||_e<=55295||_e>=57344||w+1>=K)return _e;var Xe=O.charCodeAt(w+1);return Xe>=56320&&Xe<=57343?(_e<<10)+Xe-56613888:_e},zt.prototype.nextIndex=function(w,N){N===void 0&&(N=!1);var O=this.source,K=O.length;if(w>=K)return K;var _e=O.charCodeAt(w),Xe;return!(N||this.switchU)||_e<=55295||_e>=57344||w+1>=K||(Xe=O.charCodeAt(w+1))<56320||Xe>57343?w+1:w+2},zt.prototype.current=function(w){return w===void 0&&(w=!1),this.at(this.pos,w)},zt.prototype.lookahead=function(w){return w===void 0&&(w=!1),this.at(this.nextIndex(this.pos,w),w)},zt.prototype.advance=function(w){w===void 0&&(w=!1),this.pos=this.nextIndex(this.pos,w)},zt.prototype.eat=function(w,N){return N===void 0&&(N=!1),this.current(N)===w?(this.advance(N),!0):!1};function gr(_){return _<=65535?String.fromCharCode(_):(_-=65536,String.fromCharCode((_>>10)+55296,(_&1023)+56320))}Dt.validateRegExpFlags=function(_){for(var w=_.validFlags,N=_.flags,O=0;O<N.length;O++){var K=N.charAt(O);w.indexOf(K)===-1&&this.raise(_.start,"Invalid regular expression flag"),N.indexOf(K,O+1)>-1&&this.raise(_.start,"Duplicate regular expression flag")}},Dt.validateRegExpPattern=function(_){this.regexp_pattern(_),!_.switchN&&this.options.ecmaVersion>=9&&_.groupNames.length>0&&(_.switchN=!0,this.regexp_pattern(_))},Dt.regexp_pattern=function(_){_.pos=0,_.lastIntValue=0,_.lastStringValue="",_.lastAssertionIsQuantifiable=!1,_.numCapturingParens=0,_.maxBackReference=0,_.groupNames.length=0,_.backReferenceNames.length=0,this.regexp_disjunction(_),_.pos!==_.source.length&&(_.eat(41)&&_.raise("Unmatched ')'"),(_.eat(93)||_.eat(125))&&_.raise("Lone quantifier brackets")),_.maxBackReference>_.numCapturingParens&&_.raise("Invalid escape");for(var w=0,N=_.backReferenceNames;w<N.length;w+=1){var O=N[w];_.groupNames.indexOf(O)===-1&&_.raise("Invalid named capture referenced")}},Dt.regexp_disjunction=function(_){for(this.regexp_alternative(_);_.eat(124);)this.regexp_alternative(_);this.regexp_eatQuantifier(_,!0)&&_.raise("Nothing to repeat"),_.eat(123)&&_.raise("Lone quantifier brackets")},Dt.regexp_alternative=function(_){for(;_.pos<_.source.length&&this.regexp_eatTerm(_););},Dt.regexp_eatTerm=function(_){return this.regexp_eatAssertion(_)?(_.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(_)&&_.switchU&&_.raise("Invalid quantifier"),!0):(_.switchU?this.regexp_eatAtom(_):this.regexp_eatExtendedAtom(_))?(this.regexp_eatQuantifier(_),!0):!1},Dt.regexp_eatAssertion=function(_){var w=_.pos;if(_.lastAssertionIsQuantifiable=!1,_.eat(94)||_.eat(36))return!0;if(_.eat(92)){if(_.eat(66)||_.eat(98))return!0;_.pos=w}if(_.eat(40)&&_.eat(63)){var N=!1;if(this.options.ecmaVersion>=9&&(N=_.eat(60)),_.eat(61)||_.eat(33))return this.regexp_disjunction(_),_.eat(41)||_.raise("Unterminated group"),_.lastAssertionIsQuantifiable=!N,!0}return _.pos=w,!1},Dt.regexp_eatQuantifier=function(_,w){return w===void 0&&(w=!1),this.regexp_eatQuantifierPrefix(_,w)?(_.eat(63),!0):!1},Dt.regexp_eatQuantifierPrefix=function(_,w){return _.eat(42)||_.eat(43)||_.eat(63)||this.regexp_eatBracedQuantifier(_,w)},Dt.regexp_eatBracedQuantifier=function(_,w){var N=_.pos;if(_.eat(123)){var O=0,K=-1;if(this.regexp_eatDecimalDigits(_)&&(O=_.lastIntValue,_.eat(44)&&this.regexp_eatDecimalDigits(_)&&(K=_.lastIntValue),_.eat(125)))return K!==-1&&K<O&&!w&&_.raise("numbers out of order in {} quantifier"),!0;_.switchU&&!w&&_.raise("Incomplete quantifier"),_.pos=N}return!1},Dt.regexp_eatAtom=function(_){return this.regexp_eatPatternCharacters(_)||_.eat(46)||this.regexp_eatReverseSolidusAtomEscape(_)||this.regexp_eatCharacterClass(_)||this.regexp_eatUncapturingGroup(_)||this.regexp_eatCapturingGroup(_)},Dt.regexp_eatReverseSolidusAtomEscape=function(_){var w=_.pos;if(_.eat(92)){if(this.regexp_eatAtomEscape(_))return!0;_.pos=w}return!1},Dt.regexp_eatUncapturingGroup=function(_){var w=_.pos;if(_.eat(40)){if(_.eat(63)&&_.eat(58)){if(this.regexp_disjunction(_),_.eat(41))return!0;_.raise("Unterminated group")}_.pos=w}return!1},Dt.regexp_eatCapturingGroup=function(_){if(_.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(_):_.current()===63&&_.raise("Invalid group"),this.regexp_disjunction(_),_.eat(41))return _.numCapturingParens+=1,!0;_.raise("Unterminated group")}return!1},Dt.regexp_eatExtendedAtom=function(_){return _.eat(46)||this.regexp_eatReverseSolidusAtomEscape(_)||this.regexp_eatCharacterClass(_)||this.regexp_eatUncapturingGroup(_)||this.regexp_eatCapturingGroup(_)||this.regexp_eatInvalidBracedQuantifier(_)||this.regexp_eatExtendedPatternCharacter(_)},Dt.regexp_eatInvalidBracedQuantifier=function(_){return this.regexp_eatBracedQuantifier(_,!0)&&_.raise("Nothing to repeat"),!1},Dt.regexp_eatSyntaxCharacter=function(_){var w=_.current();return En(w)?(_.lastIntValue=w,_.advance(),!0):!1};function En(_){return _===36||_>=40&&_<=43||_===46||_===63||_>=91&&_<=94||_>=123&&_<=125}Dt.regexp_eatPatternCharacters=function(_){for(var w=_.pos,N=0;(N=_.current())!==-1&&!En(N);)_.advance();return _.pos!==w},Dt.regexp_eatExtendedPatternCharacter=function(_){var w=_.current();return w!==-1&&w!==36&&!(w>=40&&w<=43)&&w!==46&&w!==63&&w!==91&&w!==94&&w!==124?(_.advance(),!0):!1},Dt.regexp_groupSpecifier=function(_){if(_.eat(63)){if(this.regexp_eatGroupName(_)){_.groupNames.indexOf(_.lastStringValue)!==-1&&_.raise("Duplicate capture group name"),_.groupNames.push(_.lastStringValue);return}_.raise("Invalid group")}},Dt.regexp_eatGroupName=function(_){if(_.lastStringValue="",_.eat(60)){if(this.regexp_eatRegExpIdentifierName(_)&&_.eat(62))return!0;_.raise("Invalid capture group name")}return!1},Dt.regexp_eatRegExpIdentifierName=function(_){if(_.lastStringValue="",this.regexp_eatRegExpIdentifierStart(_)){for(_.lastStringValue+=gr(_.lastIntValue);this.regexp_eatRegExpIdentifierPart(_);)_.lastStringValue+=gr(_.lastIntValue);return!0}return!1},Dt.regexp_eatRegExpIdentifierStart=function(_){var w=_.pos,N=this.options.ecmaVersion>=11,O=_.current(N);return _.advance(N),O===92&&this.regexp_eatRegExpUnicodeEscapeSequence(_,N)&&(O=_.lastIntValue),un(O)?(_.lastIntValue=O,!0):(_.pos=w,!1)};function un(_){return Mt(_,!0)||_===36||_===95}Dt.regexp_eatRegExpIdentifierPart=function(_){var w=_.pos,N=this.options.ecmaVersion>=11,O=_.current(N);return _.advance(N),O===92&&this.regexp_eatRegExpUnicodeEscapeSequence(_,N)&&(O=_.lastIntValue),Tt(O)?(_.lastIntValue=O,!0):(_.pos=w,!1)};function Tt(_){return ir(_,!0)||_===36||_===95||_===8204||_===8205}Dt.regexp_eatAtomEscape=function(_){return this.regexp_eatBackReference(_)||this.regexp_eatCharacterClassEscape(_)||this.regexp_eatCharacterEscape(_)||_.switchN&&this.regexp_eatKGroupName(_)?!0:(_.switchU&&(_.current()===99&&_.raise("Invalid unicode escape"),_.raise("Invalid escape")),!1)},Dt.regexp_eatBackReference=function(_){var w=_.pos;if(this.regexp_eatDecimalEscape(_)){var N=_.lastIntValue;if(_.switchU)return N>_.maxBackReference&&(_.maxBackReference=N),!0;if(N<=_.numCapturingParens)return!0;_.pos=w}return!1},Dt.regexp_eatKGroupName=function(_){if(_.eat(107)){if(this.regexp_eatGroupName(_))return _.backReferenceNames.push(_.lastStringValue),!0;_.raise("Invalid named reference")}return!1},Dt.regexp_eatCharacterEscape=function(_){return this.regexp_eatControlEscape(_)||this.regexp_eatCControlLetter(_)||this.regexp_eatZero(_)||this.regexp_eatHexEscapeSequence(_)||this.regexp_eatRegExpUnicodeEscapeSequence(_,!1)||!_.switchU&&this.regexp_eatLegacyOctalEscapeSequence(_)||this.regexp_eatIdentityEscape(_)},Dt.regexp_eatCControlLetter=function(_){var w=_.pos;if(_.eat(99)){if(this.regexp_eatControlLetter(_))return!0;_.pos=w}return!1},Dt.regexp_eatZero=function(_){return _.current()===48&&!Ti(_.lookahead())?(_.lastIntValue=0,_.advance(),!0):!1},Dt.regexp_eatControlEscape=function(_){var w=_.current();return w===116?(_.lastIntValue=9,_.advance(),!0):w===110?(_.lastIntValue=10,_.advance(),!0):w===118?(_.lastIntValue=11,_.advance(),!0):w===102?(_.lastIntValue=12,_.advance(),!0):w===114?(_.lastIntValue=13,_.advance(),!0):!1},Dt.regexp_eatControlLetter=function(_){var w=_.current();return nn(w)?(_.lastIntValue=w%32,_.advance(),!0):!1};function nn(_){return _>=65&&_<=90||_>=97&&_<=122}Dt.regexp_eatRegExpUnicodeEscapeSequence=function(_,w){w===void 0&&(w=!1);var N=_.pos,O=w||_.switchU;if(_.eat(117)){if(this.regexp_eatFixedHexDigits(_,4)){var K=_.lastIntValue;if(O&&K>=55296&&K<=56319){var _e=_.pos;if(_.eat(92)&&_.eat(117)&&this.regexp_eatFixedHexDigits(_,4)){var Xe=_.lastIntValue;if(Xe>=56320&&Xe<=57343)return _.lastIntValue=(K-55296)*1024+(Xe-56320)+65536,!0}_.pos=_e,_.lastIntValue=K}return!0}if(O&&_.eat(123)&&this.regexp_eatHexDigits(_)&&_.eat(125)&&Zr(_.lastIntValue))return!0;O&&_.raise("Invalid unicode escape"),_.pos=N}return!1};function Zr(_){return _>=0&&_<=1114111}Dt.regexp_eatIdentityEscape=function(_){if(_.switchU)return this.regexp_eatSyntaxCharacter(_)?!0:_.eat(47)?(_.lastIntValue=47,!0):!1;var w=_.current();return w!==99&&(!_.switchN||w!==107)?(_.lastIntValue=w,_.advance(),!0):!1},Dt.regexp_eatDecimalEscape=function(_){_.lastIntValue=0;var w=_.current();if(w>=49&&w<=57){do _.lastIntValue=10*_.lastIntValue+(w-48),_.advance();while((w=_.current())>=48&&w<=57);return!0}return!1},Dt.regexp_eatCharacterClassEscape=function(_){var w=_.current();if(Yr(w))return _.lastIntValue=-1,_.advance(),!0;if(_.switchU&&this.options.ecmaVersion>=9&&(w===80||w===112)){if(_.lastIntValue=-1,_.advance(),_.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(_)&&_.eat(125))return!0;_.raise("Invalid property name")}return!1};function Yr(_){return _===100||_===68||_===115||_===83||_===119||_===87}Dt.regexp_eatUnicodePropertyValueExpression=function(_){var w=_.pos;if(this.regexp_eatUnicodePropertyName(_)&&_.eat(61)){var N=_.lastStringValue;if(this.regexp_eatUnicodePropertyValue(_)){var O=_.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(_,N,O),!0}}if(_.pos=w,this.regexp_eatLoneUnicodePropertyNameOrValue(_)){var K=_.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(_,K),!0}return!1},Dt.regexp_validateUnicodePropertyNameAndValue=function(_,w,N){Wr(_.unicodeProperties.nonBinary,w)||_.raise("Invalid property name"),_.unicodeProperties.nonBinary[w].test(N)||_.raise("Invalid property value")},Dt.regexp_validateUnicodePropertyNameOrValue=function(_,w){_.unicodeProperties.binary.test(w)||_.raise("Invalid property name")},Dt.regexp_eatUnicodePropertyName=function(_){var w=0;for(_.lastStringValue="";oi(w=_.current());)_.lastStringValue+=gr(w),_.advance();return _.lastStringValue!==""};function oi(_){return nn(_)||_===95}Dt.regexp_eatUnicodePropertyValue=function(_){var w=0;for(_.lastStringValue="";Qr(w=_.current());)_.lastStringValue+=gr(w),_.advance();return _.lastStringValue!==""};function Qr(_){return oi(_)||Ti(_)}Dt.regexp_eatLoneUnicodePropertyNameOrValue=function(_){return this.regexp_eatUnicodePropertyValue(_)},Dt.regexp_eatCharacterClass=function(_){if(_.eat(91)){if(_.eat(94),this.regexp_classRanges(_),_.eat(93))return!0;_.raise("Unterminated character class")}return!1},Dt.regexp_classRanges=function(_){for(;this.regexp_eatClassAtom(_);){var w=_.lastIntValue;if(_.eat(45)&&this.regexp_eatClassAtom(_)){var N=_.lastIntValue;_.switchU&&(w===-1||N===-1)&&_.raise("Invalid character class"),w!==-1&&N!==-1&&w>N&&_.raise("Range out of order in character class")}}},Dt.regexp_eatClassAtom=function(_){var w=_.pos;if(_.eat(92)){if(this.regexp_eatClassEscape(_))return!0;if(_.switchU){var N=_.current();(N===99||Oi(N))&&_.raise("Invalid class escape"),_.raise("Invalid escape")}_.pos=w}var O=_.current();return O!==93?(_.lastIntValue=O,_.advance(),!0):!1},Dt.regexp_eatClassEscape=function(_){var w=_.pos;if(_.eat(98))return _.lastIntValue=8,!0;if(_.switchU&&_.eat(45))return _.lastIntValue=45,!0;if(!_.switchU&&_.eat(99)){if(this.regexp_eatClassControlLetter(_))return!0;_.pos=w}return this.regexp_eatCharacterClassEscape(_)||this.regexp_eatCharacterEscape(_)},Dt.regexp_eatClassControlLetter=function(_){var w=_.current();return Ti(w)||w===95?(_.lastIntValue=w%32,_.advance(),!0):!1},Dt.regexp_eatHexEscapeSequence=function(_){var w=_.pos;if(_.eat(120)){if(this.regexp_eatFixedHexDigits(_,2))return!0;_.switchU&&_.raise("Invalid escape"),_.pos=w}return!1},Dt.regexp_eatDecimalDigits=function(_){var w=_.pos,N=0;for(_.lastIntValue=0;Ti(N=_.current());)_.lastIntValue=10*_.lastIntValue+(N-48),_.advance();return _.pos!==w};function Ti(_){return _>=48&&_<=57}Dt.regexp_eatHexDigits=function(_){var w=_.pos,N=0;for(_.lastIntValue=0;ea(N=_.current());)_.lastIntValue=16*_.lastIntValue+bi(N),_.advance();return _.pos!==w};function ea(_){return _>=48&&_<=57||_>=65&&_<=70||_>=97&&_<=102}function bi(_){return _>=65&&_<=70?10+(_-65):_>=97&&_<=102?10+(_-97):_-48}Dt.regexp_eatLegacyOctalEscapeSequence=function(_){if(this.regexp_eatOctalDigit(_)){var w=_.lastIntValue;if(this.regexp_eatOctalDigit(_)){var N=_.lastIntValue;w<=3&&this.regexp_eatOctalDigit(_)?_.lastIntValue=w*64+N*8+_.lastIntValue:_.lastIntValue=w*8+N}else _.lastIntValue=w;return!0}return!1},Dt.regexp_eatOctalDigit=function(_){var w=_.current();return Oi(w)?(_.lastIntValue=w-48,_.advance(),!0):(_.lastIntValue=0,!1)};function Oi(_){return _>=48&&_<=55}Dt.regexp_eatFixedHexDigits=function(_,w){var N=_.pos;_.lastIntValue=0;for(var O=0;O<w;++O){var K=_.current();if(!ea(K))return _.pos=N,!1;_.lastIntValue=16*_.lastIntValue+bi(K),_.advance()}return!0};var Ci=function(w){this.type=w.type,this.value=w.value,this.start=w.start,this.end=w.end,w.options.locations&&(this.loc=new wt(w,w.startLoc,w.endLoc)),w.options.ranges&&(this.range=[w.start,w.end])},ti=Si.prototype;ti.next=function(_){!_&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new Ci(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},ti.getToken=function(){return this.next(),new Ci(this)},typeof Symbol!="undefined"&&(ti[Symbol.iterator]=function(){var _=this;return{next:function(){var w=_.getToken();return{done:w.type===X.eof,value:w}}}}),ti.curContext=function(){return this.context[this.context.length-1]},ti.nextToken=function(){var _=this.curContext();if((!_||!_.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(X.eof);if(_.override)return _.override(this);this.readToken(this.fullCharCodeAtPos())},ti.readToken=function(_){return Mt(_,this.options.ecmaVersion>=6)||_===92?this.readWord():this.getTokenFromCode(_)},ti.fullCharCodeAtPos=function(){var _=this.input.charCodeAt(this.pos);if(_<=55295||_>=57344)return _;var w=this.input.charCodeAt(this.pos+1);return(_<<10)+w-56613888},ti.skipBlockComment=function(){var _=this.options.onComment&&this.curPosition(),w=this.pos,N=this.input.indexOf("*/",this.pos+=2);if(N===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=N+2,this.options.locations){vt.lastIndex=w;for(var O;(O=vt.exec(this.input))&&O.index<this.pos;)++this.curLine,this.lineStart=O.index+O[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(w+2,N),w,this.pos,_,this.curPosition())},ti.skipLineComment=function(_){for(var w=this.pos,N=this.options.onComment&&this.curPosition(),O=this.input.charCodeAt(this.pos+=_);this.pos<this.input.length&&!qe(O);)O=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(w+_,this.pos),w,this.pos,N,this.curPosition())},ti.skipSpace=function(){e:for(;this.pos<this.input.length;){var _=this.input.charCodeAt(this.pos);switch(_){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(_>8&&_<14||_>=5760&&dt.test(String.fromCharCode(_)))++this.pos;else break e}}},ti.finishToken=function(_,w){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var N=this.type;this.type=_,this.value=w,this.updateContext(N)},ti.readToken_dot=function(){var _=this.input.charCodeAt(this.pos+1);if(_>=48&&_<=57)return this.readNumber(!0);var w=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&_===46&&w===46?(this.pos+=3,this.finishToken(X.ellipsis)):(++this.pos,this.finishToken(X.dot))},ti.readToken_slash=function(){var _=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):_===61?this.finishOp(X.assign,2):this.finishOp(X.slash,1)},ti.readToken_mult_modulo_exp=function(_){var w=this.input.charCodeAt(this.pos+1),N=1,O=_===42?X.star:X.modulo;return this.options.ecmaVersion>=7&&_===42&&w===42&&(++N,O=X.starstar,w=this.input.charCodeAt(this.pos+2)),w===61?this.finishOp(X.assign,N+1):this.finishOp(O,N)},ti.readToken_pipe_amp=function(_){var w=this.input.charCodeAt(this.pos+1);if(w===_){if(this.options.ecmaVersion>=12){var N=this.input.charCodeAt(this.pos+2);if(N===61)return this.finishOp(X.assign,3)}return this.finishOp(_===124?X.logicalOR:X.logicalAND,2)}return w===61?this.finishOp(X.assign,2):this.finishOp(_===124?X.bitwiseOR:X.bitwiseAND,1)},ti.readToken_caret=function(){var _=this.input.charCodeAt(this.pos+1);return _===61?this.finishOp(X.assign,2):this.finishOp(X.bitwiseXOR,1)},ti.readToken_plus_min=function(_){var w=this.input.charCodeAt(this.pos+1);return w===_?w===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||Kt.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(X.incDec,2):w===61?this.finishOp(X.assign,2):this.finishOp(X.plusMin,1)},ti.readToken_lt_gt=function(_){var w=this.input.charCodeAt(this.pos+1),N=1;return w===_?(N=_===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+N)===61?this.finishOp(X.assign,N+1):this.finishOp(X.bitShift,N)):w===33&&_===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(w===61&&(N=2),this.finishOp(X.relational,N))},ti.readToken_eq_excl=function(_){var w=this.input.charCodeAt(this.pos+1);return w===61?this.finishOp(X.equality,this.input.charCodeAt(this.pos+2)===61?3:2):_===61&&w===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(X.arrow)):this.finishOp(_===61?X.eq:X.prefix,1)},ti.readToken_question=function(){var _=this.options.ecmaVersion;if(_>=11){var w=this.input.charCodeAt(this.pos+1);if(w===46){var N=this.input.charCodeAt(this.pos+2);if(N<48||N>57)return this.finishOp(X.questionDot,2)}if(w===63){if(_>=12){var O=this.input.charCodeAt(this.pos+2);if(O===61)return this.finishOp(X.assign,3)}return this.finishOp(X.coalesce,2)}}return this.finishOp(X.question,1)},ti.getTokenFromCode=function(_){switch(_){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(X.parenL);case 41:return++this.pos,this.finishToken(X.parenR);case 59:return++this.pos,this.finishToken(X.semi);case 44:return++this.pos,this.finishToken(X.comma);case 91:return++this.pos,this.finishToken(X.bracketL);case 93:return++this.pos,this.finishToken(X.bracketR);case 123:return++this.pos,this.finishToken(X.braceL);case 125:return++this.pos,this.finishToken(X.braceR);case 58:return++this.pos,this.finishToken(X.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(X.backQuote);case 48:var w=this.input.charCodeAt(this.pos+1);if(w===120||w===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(w===111||w===79)return this.readRadixNumber(8);if(w===98||w===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(_);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(_);case 124:case 38:return this.readToken_pipe_amp(_);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(_);case 60:case 62:return this.readToken_lt_gt(_);case 61:case 33:return this.readToken_eq_excl(_);case 63:return this.readToken_question();case 126:return this.finishOp(X.prefix,1)}this.raise(this.pos,"Unexpected character '"+oa(_)+"'")},ti.finishOp=function(_,w){var N=this.input.slice(this.pos,this.pos+w);return this.pos+=w,this.finishToken(_,N)},ti.readRegexp=function(){for(var _,w,N=this.pos;;){this.pos>=this.input.length&&this.raise(N,"Unterminated regular expression");var O=this.input.charAt(this.pos);if(Kt.test(O)&&this.raise(N,"Unterminated regular expression"),_)_=!1;else{if(O==="[")w=!0;else if(O==="]"&&w)w=!1;else if(O==="/"&&!w)break;_=O==="\\"}++this.pos}var K=this.input.slice(N,this.pos);++this.pos;var _e=this.pos,Xe=this.readWord1();this.containsEsc&&this.unexpected(_e);var ft=this.regexpState||(this.regexpState=new zt(this));ft.reset(N,K,Xe),this.validateRegExpFlags(ft),this.validateRegExpPattern(ft);var mt=null;try{mt=new RegExp(K,Xe)}catch(cr){}return this.finishToken(X.regexp,{pattern:K,flags:Xe,value:mt})},ti.readInt=function(_,w,N){for(var O=this.options.ecmaVersion>=12&&w===void 0,K=N&&this.input.charCodeAt(this.pos)===48,_e=this.pos,Xe=0,ft=0,mt=0,cr=w==null?Infinity:w;mt<cr;++mt,++this.pos){var xr=this.input.charCodeAt(this.pos),Pn=void 0;if(O&&xr===95){K&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),ft===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),mt===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),ft=xr;continue}if(xr>=97?Pn=xr-97+10:xr>=65?Pn=xr-65+10:xr>=48&&xr<=57?Pn=xr-48:Pn=Infinity,Pn>=_)break;ft=xr,Xe=Xe*_+Pn}return O&&ft===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===_e||w!=null&&this.pos-_e!==w?null:Xe};function Xi(_,w){return w?parseInt(_,8):parseFloat(_.replace(/_/g,""))}function Fa(_){return typeof BigInt!="function"?null:BigInt(_.replace(/_/g,""))}ti.readRadixNumber=function(_){var w=this.pos;this.pos+=2;var N=this.readInt(_);return N==null&&this.raise(this.start+2,"Expected number in radix "+_),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(N=Fa(this.input.slice(w,this.pos)),++this.pos):Mt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(X.num,N)},ti.readNumber=function(_){var w=this.pos;!_&&this.readInt(10,void 0,!0)===null&&this.raise(w,"Invalid number");var N=this.pos-w>=2&&this.input.charCodeAt(w)===48;N&&this.strict&&this.raise(w,"Invalid number");var O=this.input.charCodeAt(this.pos);if(!N&&!_&&this.options.ecmaVersion>=11&&O===110){var K=Fa(this.input.slice(w,this.pos));return++this.pos,Mt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(X.num,K)}N&&/[89]/.test(this.input.slice(w,this.pos))&&(N=!1),O===46&&!N&&(++this.pos,this.readInt(10),O=this.input.charCodeAt(this.pos)),(O===69||O===101)&&!N&&(O=this.input.charCodeAt(++this.pos),(O===43||O===45)&&++this.pos,this.readInt(10)===null&&this.raise(w,"Invalid number")),Mt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var _e=Xi(this.input.slice(w,this.pos),N);return this.finishToken(X.num,_e)},ti.readCodePoint=function(){var _=this.input.charCodeAt(this.pos),w;if(_===123){this.options.ecmaVersion<6&&this.unexpected();var N=++this.pos;w=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,w>1114111&&this.invalidStringToken(N,"Code point out of bounds")}else w=this.readHexChar(4);return w};function oa(_){return _<=65535?String.fromCharCode(_):(_-=65536,String.fromCharCode((_>>10)+55296,(_&1023)+56320))}ti.readString=function(_){for(var w="",N=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var O=this.input.charCodeAt(this.pos);if(O===_)break;O===92?(w+=this.input.slice(N,this.pos),w+=this.readEscapedChar(!1),N=this.pos):(qe(O,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return w+=this.input.slice(N,this.pos++),this.finishToken(X.string,w)};var Ri={};ti.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(_){if(_===Ri)this.readInvalidTemplateToken();else throw _}this.inTemplateElement=!1},ti.invalidStringToken=function(_,w){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw Ri;this.raise(_,w)},ti.readTmplToken=function(){for(var _="",w=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var N=this.input.charCodeAt(this.pos);if(N===96||N===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===X.template||this.type===X.invalidTemplate)?N===36?(this.pos+=2,this.finishToken(X.dollarBraceL)):(++this.pos,this.finishToken(X.backQuote)):(_+=this.input.slice(w,this.pos),this.finishToken(X.template,_));if(N===92)_+=this.input.slice(w,this.pos),_+=this.readEscapedChar(!0),w=this.pos;else if(qe(N)){switch(_+=this.input.slice(w,this.pos),++this.pos,N){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:_+=`
`;break;default:_+=String.fromCharCode(N);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),w=this.pos}else++this.pos}},ti.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(X.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},ti.readEscapedChar=function(_){var w=this.input.charCodeAt(++this.pos);switch(++this.pos,w){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return oa(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(_){var N=this.pos-1;return this.invalidStringToken(N,"Invalid escape sequence in template string"),null}default:if(w>=48&&w<=55){var O=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],K=parseInt(O,8);return K>255&&(O=O.slice(0,-1),K=parseInt(O,8)),this.pos+=O.length-1,w=this.input.charCodeAt(this.pos),(O!=="0"||w===56||w===57)&&(this.strict||_)&&this.invalidStringToken(this.pos-1-O.length,_?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(K)}return qe(w)?"":String.fromCharCode(w)}},ti.readHexChar=function(_){var w=this.pos,N=this.readInt(16,_);return N===null&&this.invalidStringToken(w,"Bad character escape sequence"),N},ti.readWord1=function(){this.containsEsc=!1;for(var _="",w=!0,N=this.pos,O=this.options.ecmaVersion>=6;this.pos<this.input.length;){var K=this.fullCharCodeAtPos();if(ir(K,O))this.pos+=K<=65535?1:2;else if(K===92){this.containsEsc=!0,_+=this.input.slice(N,this.pos);var _e=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var Xe=this.readCodePoint();(w?Mt:ir)(Xe,O)||this.invalidStringToken(_e,"Invalid Unicode escape"),_+=oa(Xe),N=this.pos}else break;w=!1}return _+this.input.slice(N,this.pos)},ti.readWord=function(){var _=this.readWord1(),w=X.name;return this.keywords.test(_)&&(w=ct[_]),this.finishToken(w,_)};var Gi="7.4.1";Si.acorn={Parser:Si,version:Gi,defaultOptions:Ut,Position:De,SourceLocation:wt,getLineInfo:gt,Node:Ii,TokenType:bt,tokTypes:X,keywordTypes:ct,TokContext:_a,tokContexts:Da,isIdentifierChar:ir,isIdentifierStart:Mt,Token:Ci,isNewLine:qe,lineBreak:Kt,lineBreakG:vt,nonASCIIwhitespace:dt};function Za(_,w){return Si.parse(_,w)}function au(_,w,N){return Si.parseExpressionAt(_,w,N)}function Ma(_,w){return Si.tokenizer(_,w)}function Pa(_,w){_.prototype=Object.create(w.prototype),_.prototype.constructor=_,_.__proto__=w}function Es(_){var w=typeof Map=="function"?new Map:void 0;return Es=function(O){if(O===null||!ju(O))return O;if(typeof O!="function")throw new TypeError("Super expression must either be null or a function");if(typeof w!="undefined"){if(w.has(O))return w.get(O);w.set(O,K)}function K(){return ra(O,arguments,ja(this).constructor)}return K.prototype=Object.create(O.prototype,{constructor:{value:K,enumerable:!1,writable:!0,configurable:!0}}),yo(K,O)},Es(_)}function ps(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(_){return!1}}function ra(_,w,N){return ps()?ra=Reflect.construct:ra=function(K,_e,Xe){var ft=[null];ft.push.apply(ft,_e);var mt=Function.bind.apply(K,ft),cr=new mt;return Xe&&yo(cr,Xe.prototype),cr},ra.apply(null,arguments)}function ju(_){return Function.toString.call(_).indexOf("[native code]")!==-1}function yo(_,w){return yo=Object.setPrototypeOf||function(O,K){return O.__proto__=K,O},yo(_,w)}function ja(_){return ja=Object.setPrototypeOf?Object.getPrototypeOf:function(N){return N.__proto__||Object.getPrototypeOf(N)},ja(_)}var oo=function(_){Pa(w,_);function w(){return _.apply(this,arguments)||this}return w}(Es(Error)),$i=function(_){Pa(w,_);function w(){return _.apply(this,arguments)||this}return w}(Es(SyntaxError)),qo=function(_){Pa(w,_);function w(){return _.apply(this,arguments)||this}return w}(Es(ReferenceError)),Ko=function(_){Pa(w,_);function w(){return _.apply(this,arguments)||this}return w}(Es(TypeError)),Vu=function(_){Pa(w,_);function w(){return _.apply(this,arguments)||this}return w}(oo),Co=function(_){Pa(w,_);function w(){return _.apply(this,arguments)||this}return w}($i),$o=function(_){Pa(w,_);function w(){return _.apply(this,arguments)||this}return w}(qo),xa={UnknownError:[3001,"%0",Vu],ExecutionTimeOutError:[3002,"Script execution timed out after %0ms",Vu],NodeTypeSyntaxError:[1001,"Unknown node type: %0",$o],BinaryOperatorSyntaxError:[1002,"Unknown binary operator: %0",$o],LogicalOperatorSyntaxError:[1003,"Unknown logical operator: %0",$o],UnaryOperatorSyntaxError:[1004,"Unknown unary operator: %0",$o],UpdateOperatorSyntaxError:[1005,"Unknown update operator: %0",$o],ObjectStructureSyntaxError:[1006,"Unknown object structure: %0",$o],AssignmentExpressionSyntaxError:[1007,"Unknown assignment expression: %0",$o],VariableTypeSyntaxError:[1008,"Unknown variable type: %0",$o],ParamTypeSyntaxError:[1009,"Unknown param type: %0",$o],AssignmentTypeSyntaxError:[1010,"Unknown assignment type: %0",$o],FunctionUndefinedReferenceError:[2001,"%0 is not a function",qo],VariableUndefinedReferenceError:[2002,"%0 is not defined",qo],IsNotConstructor:[2003,"%0 is not a constructor",Ko]};function _o(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(_){return!1}}function Jo(_,w,N){return _o()?Jo=Reflect.construct:Jo=function(K,_e,Xe){var ft=[null];ft.push.apply(ft,_e);var mt=Function.bind.apply(K,ft),cr=new mt;return Xe&&so(cr,Xe.prototype),cr},Jo.apply(null,arguments)}function so(_,w){return so=Object.setPrototypeOf||function(O,K){return O.__proto__=K,O},so(_,w)}var ou="0.0.3";function xc(_,w){Object.defineProperty(_,"name",{value:w,writable:!1,enumerable:!1,configurable:!0})}var Ds=Object.prototype.hasOwnProperty,ne=Symbol("Break"),be=Symbol("Continue"),Qe=Symbol("DefaultCase"),Rt=Symbol("EmptyStatementReturn"),kr=Symbol("WithScopeName"),lt=Symbol("SuperScopeName"),It=Symbol("RootScopeName"),uo=Symbol("GlobalScopeName");function Ji(_){return typeof _=="function"}var Ya=function(){function _(N){this.interpreter=N}var w=_.prototype;return w.generator=function(){var O=this.interpreter;function K(){return this.getCurrentScope()}function _e(){return this.getGlobalScope()}function Xe(){return this.getCurrentContext()}return{getOptions:O.getOptions.bind(O),getCurrentScope:K.bind(O),getGlobalScope:_e.bind(O),getCurrentContext:Xe.bind(O),getExecStartTime:O.getExecStartTime.bind(O)}},_}();function Qo(_,w,N){if(N===void 0&&(N=!0),!(_ instanceof Ya))throw new Error("Illegal call");if(typeof w!="string")return w;if(!!w){var O=_.generator(),K=O.getOptions(),_e={timeout:K.timeout,_initEnv:function(){N||this.setCurrentContext(O.getCurrentContext()),this.execStartTime=O.getExecStartTime(),this.execEndTime=this.execStartTime}},Xe=N?O.getGlobalScope():O.getCurrentScope(),ft=new xo(Xe,_e);return ft.evaluate(w)}}Object.defineProperty(Qo,"__IS_EVAL_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});function pn(_){if(!(_ instanceof Ya))throw new Error("Illegal call");for(var w=_.generator(),N=arguments.length,O=new Array(N>1?N-1:0),K=1;K<N;K++)O[K-1]=arguments[K];var _e=O.pop(),Xe=new xo(w.getGlobalScope(),w.getOptions()),ft=`
		    (function anonymous(`+O.join(",")+`){
		        `+_e+`
		    });
		    `;return Xe.evaluate(ft)}Object.defineProperty(pn,"__IS_FUNCTION_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});var cn=function(w){this.value=w},Yt=function(w){this.value=w},Zo=function(w){this.value=w},xe=function(w,N,O){N===void 0&&(N=null),this.name=O,this.parent=N,this.data=w,this.labelStack=[]};function Ks(){}function su(_,w){return _===void 0&&(_=null),new xe(Object.create(null),_,w)}function ds(_){return Object.create(_)}var sa={NaN:NaN,Infinity:Infinity,undefined:void 0,Object,Array,String,Boolean,Number,Date,RegExp,Error,URIError,TypeError,RangeError,SyntaxError,ReferenceError,Float32Array,Float64Array,Uint32Array,Math,parseInt,parseFloat,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,escape,unescape,eval:Qo,Function:pn};typeof JSON!="undefined"&&(sa.JSON=JSON),typeof Promise!="undefined"&&(sa.Promise=Promise),typeof Set!="undefined"&&(sa.Set=Set),typeof Map!="undefined"&&(sa.Map=Map),typeof Symbol!="undefined"&&(sa.Symbol=Symbol),typeof Proxy!="undefined"&&(sa.Proxy=Proxy),typeof WeakMap!="undefined"&&(sa.WeakMap=WeakMap),typeof WeakSet!="undefined"&&(sa.WeakSet=WeakSet),typeof Reflect!="undefined"&&(sa.Reflect=Reflect);var xo=function(){function _(N,O){N===void 0&&(N=_.global),O===void 0&&(O={}),this.sourceList=[],this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.isVarDeclMode=!1,this.lastExecNode=null,this.isRunning=!1,this.options={ecmaVersion:O.ecmaVersion||_.ecmaVersion,timeout:O.timeout||0,rootContext:O.rootContext,globalContextInFunction:O.globalContextInFunction===void 0?_.globalContextInFunction:O.globalContextInFunction,_initEnv:O._initEnv},this.context=N||Object.create(null),this.callStack=[],this.initEnvironment(this.context)}var w=_.prototype;return w.initEnvironment=function(O){var K;if(O instanceof xe)K=O;else{var _e=null,Xe=this.createSuperScope(O);this.options.rootContext&&(_e=new xe(ds(this.options.rootContext),Xe,It)),K=new xe(O,_e||Xe,uo)}this.globalScope=K,this.currentScope=this.globalScope,this.globalContext=K.data,this.currentContext=K.data,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.execStartTime=Date.now(),this.execEndTime=this.execStartTime;var ft=this.options._initEnv;ft&&ft.call(this)},w.getExecStartTime=function(){return this.execStartTime},w.getExecutionTime=function(){return this.execEndTime-this.execStartTime},w.setExecTimeout=function(O){O===void 0&&(O=0),this.options.timeout=O},w.getOptions=function(){return this.options},w.getGlobalScope=function(){return this.globalScope},w.getCurrentScope=function(){return this.currentScope},w.getCurrentContext=function(){return this.currentContext},w.isInterruptThrow=function(O){return O instanceof Vu||O instanceof $o||O instanceof Co},w.createSuperScope=function(O){var K=Object.assign({},sa),_e=Object.keys(K);return _e.forEach(function(Xe){Xe in O&&delete K[Xe]}),new xe(K,null,lt)},w.setCurrentContext=function(O){this.currentContext=O},w.setCurrentScope=function(O){this.currentScope=O},w.evaluate=function(O){O===void 0&&(O="");var K;if(!!O)return K=Za(O,{ranges:!0,locations:!0,ecmaVersion:this.options.ecmaVersion||_.ecmaVersion}),this.evaluateNode(K,O)},w.appendCode=function(O){return this.evaluate(O)},w.evaluateNode=function(O,K){var _e=this;K===void 0&&(K=""),this.value=void 0,this.source=K,this.sourceList.push(K),this.isRunning=!0,this.execStartTime=Date.now(),this.execEndTime=this.execStartTime,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var Xe=this.getCurrentScope(),ft=this.getCurrentContext(),mt=Xe.labelStack.concat([]),cr=this.callStack.concat([]),xr=function(){_e.setCurrentScope(Xe),_e.setCurrentContext(ft),Xe.labelStack=mt,_e.callStack=cr};try{var Pn=this.createClosure(O);this.addDeclarationsToScope(this.collectDeclVars,this.collectDeclFuncs,this.getCurrentScope()),Pn()}catch(fi){throw fi}finally{xr(),this.execEndTime=Date.now()}return this.isRunning=!1,this.getValue()},w.createErrorMessage=function(O,K,_e){var Xe=O[1].replace("%0",String(K));return _e!==null&&(Xe+=this.getNodePosition(_e||this.lastExecNode)),Xe},w.createError=function(O,K){return new K(O)},w.createThrowError=function(O,K){return this.createError(O,K)},w.createInternalThrowError=function(O,K,_e){return this.createError(this.createErrorMessage(O,K,_e),O[2])},w.checkTimeout=function(){if(!this.isRunning)return!1;var O=this.options.timeout||0,K=Date.now();return K-this.execStartTime>O},w.getNodePosition=function(O){if(O){var K="";return O.loc?" ["+O.loc.start.line+":"+O.loc.start.column+"]"+K:""}return""},w.createClosure=function(O){var K=this,_e;switch(O.type){case"BinaryExpression":_e=this.binaryExpressionHandler(O);break;case"LogicalExpression":_e=this.logicalExpressionHandler(O);break;case"UnaryExpression":_e=this.unaryExpressionHandler(O);break;case"UpdateExpression":_e=this.updateExpressionHandler(O);break;case"ObjectExpression":_e=this.objectExpressionHandler(O);break;case"ArrayExpression":_e=this.arrayExpressionHandler(O);break;case"CallExpression":_e=this.callExpressionHandler(O);break;case"NewExpression":_e=this.newExpressionHandler(O);break;case"MemberExpression":_e=this.memberExpressionHandler(O);break;case"ThisExpression":_e=this.thisExpressionHandler(O);break;case"SequenceExpression":_e=this.sequenceExpressionHandler(O);break;case"Literal":_e=this.literalHandler(O);break;case"Identifier":_e=this.identifierHandler(O);break;case"AssignmentExpression":_e=this.assignmentExpressionHandler(O);break;case"FunctionDeclaration":_e=this.functionDeclarationHandler(O);break;case"VariableDeclaration":_e=this.variableDeclarationHandler(O);break;case"BlockStatement":case"Program":_e=this.programHandler(O);break;case"ExpressionStatement":_e=this.expressionStatementHandler(O);break;case"EmptyStatement":_e=this.emptyStatementHandler(O);break;case"ReturnStatement":_e=this.returnStatementHandler(O);break;case"FunctionExpression":_e=this.functionExpressionHandler(O);break;case"IfStatement":_e=this.ifStatementHandler(O);break;case"ConditionalExpression":_e=this.conditionalExpressionHandler(O);break;case"ForStatement":_e=this.forStatementHandler(O);break;case"WhileStatement":_e=this.whileStatementHandler(O);break;case"DoWhileStatement":_e=this.doWhileStatementHandler(O);break;case"ForInStatement":_e=this.forInStatementHandler(O);break;case"WithStatement":_e=this.withStatementHandler(O);break;case"ThrowStatement":_e=this.throwStatementHandler(O);break;case"TryStatement":_e=this.tryStatementHandler(O);break;case"ContinueStatement":_e=this.continueStatementHandler(O);break;case"BreakStatement":_e=this.breakStatementHandler(O);break;case"SwitchStatement":_e=this.switchStatementHandler(O);break;case"LabeledStatement":_e=this.labeledStatementHandler(O);break;case"DebuggerStatement":_e=this.debuggerStatementHandler(O);break;default:throw this.createInternalThrowError(xa.NodeTypeSyntaxError,O.type,O)}return function(){var Xe=K.options.timeout;if(Xe&&Xe>0&&K.checkTimeout())throw K.createInternalThrowError(xa.ExecutionTimeOutError,Xe,null);return K.lastExecNode=O,_e.apply(void 0,arguments)}},w.binaryExpressionHandler=function(O){var K=this,_e=this.createClosure(O.left),Xe=this.createClosure(O.right);return function(){var ft=_e(),mt=Xe();switch(O.operator){case"==":return ft==mt;case"!=":return ft!=mt;case"===":return ft===mt;case"!==":return ft!==mt;case"<":return ft<mt;case"<=":return ft<=mt;case">":return ft>mt;case">=":return ft>=mt;case"<<":return ft<<mt;case">>":return ft>>mt;case">>>":return ft>>>mt;case"+":return ft+mt;case"-":return ft-mt;case"*":return ft*mt;case"**":return Math.pow(ft,mt);case"/":return ft/mt;case"%":return ft%mt;case"|":return ft|mt;case"^":return ft^mt;case"&":return ft&mt;case"in":return ft in mt;case"instanceof":return ft instanceof mt;default:throw K.createInternalThrowError(xa.BinaryOperatorSyntaxError,O.operator,O)}}},w.logicalExpressionHandler=function(O){var K=this,_e=this.createClosure(O.left),Xe=this.createClosure(O.right);return function(){switch(O.operator){case"||":return _e()||Xe();case"&&":return _e()&&Xe();default:throw K.createInternalThrowError(xa.LogicalOperatorSyntaxError,O.operator,O)}}},w.unaryExpressionHandler=function(O){var K=this;switch(O.operator){case"delete":var _e=this.createObjectGetter(O.argument),Xe=this.createNameGetter(O.argument);return function(){var xr=_e(),Pn=Xe();return delete xr[Pn]};default:var ft;if(O.operator==="typeof"&&O.argument.type==="Identifier"){var mt=this.createObjectGetter(O.argument),cr=this.createNameGetter(O.argument);ft=function(){return mt()[cr()]}}else ft=this.createClosure(O.argument);return function(){var xr=ft();switch(O.operator){case"-":return-xr;case"+":return+xr;case"!":return!xr;case"~":return~xr;case"void":return;case"typeof":return typeof xr;default:throw K.createInternalThrowError(xa.UnaryOperatorSyntaxError,O.operator,O)}}}},w.updateExpressionHandler=function(O){var K=this,_e=this.createObjectGetter(O.argument),Xe=this.createNameGetter(O.argument);return function(){var ft=_e(),mt=Xe();switch(K.assertVariable(ft,mt,O),O.operator){case"++":return O.prefix?++ft[mt]:ft[mt]++;case"--":return O.prefix?--ft[mt]:ft[mt]--;default:throw K.createInternalThrowError(xa.UpdateOperatorSyntaxError,O.operator,O)}}},w.objectExpressionHandler=function(O){var K=this,_e=[];function Xe(mt){return mt.type==="Identifier"?mt.name:mt.type==="Literal"?mt.value:this.throwError(xa.ObjectStructureSyntaxError,mt.type,mt)}var ft=Object.create(null);return O.properties.forEach(function(mt){var cr=mt.kind,xr=Xe(mt.key);(!ft[xr]||cr==="init")&&(ft[xr]={}),ft[xr][cr]=K.createClosure(mt.value),_e.push({key:xr,property:mt})}),function(){for(var mt={},cr=_e.length,xr=0;xr<cr;xr++){var Pn=_e[xr],fi=Pn.key,Qn=ft[fi],Yi=Qn.init?Qn.init():void 0,da=Qn.get?Qn.get():function(){},Ra=Qn.set?Qn.set():function(hl){};if("set"in Qn||"get"in Qn){var Hi={configurable:!0,enumerable:!0,get:da,set:Ra};Object.defineProperty(mt,fi,Hi)}else{var Lo=Pn.property,Ss=Lo.kind;Lo.key.type==="Identifier"&&Lo.value.type==="FunctionExpression"&&Ss==="init"&&!Lo.value.id&&xc(Yi,Lo.key.name),mt[fi]=Yi}}return mt}},w.arrayExpressionHandler=function(O){var K=this,_e=O.elements.map(function(Xe){return Xe&&K.createClosure(Xe)});return function(){for(var Xe=_e.length,ft=Array(Xe),mt=0;mt<Xe;mt++){var cr=_e[mt];cr&&(ft[mt]=cr())}return ft}},w.safeObjectGet=function(O,K,_e){return O[K]},w.createCallFunctionGetter=function(O){var K=this;switch(O.type){case"MemberExpression":var _e=this.createClosure(O.object),Xe=this.createMemberKeyGetter(O),ft=this.source;return function(){var cr=_e(),xr=Xe(),Pn=K.safeObjectGet(cr,xr,O);if(!Pn||!Ji(Pn)){var fi=ft.slice(O.start,O.end);throw K.createInternalThrowError(xa.FunctionUndefinedReferenceError,fi,O)}return Pn.__IS_EVAL_FUNC?function(Qn){return Pn(new Ya(K),Qn,!0)}:Pn.__IS_FUNCTION_FUNC?function(){for(var Qn=arguments.length,Yi=new Array(Qn),da=0;da<Qn;da++)Yi[da]=arguments[da];return Pn.apply(void 0,[new Ya(K)].concat(Yi))}:Pn.bind(cr)};default:var mt=this.createClosure(O);return function(){var cr="";O.type==="Identifier"&&(cr=O.name);var xr=mt();if(!xr||!Ji(xr))throw K.createInternalThrowError(xa.FunctionUndefinedReferenceError,cr,O);if(O.type==="Identifier"&&xr.__IS_EVAL_FUNC&&cr==="eval")return function(Qn){var Yi=K.getScopeFromName(cr,K.getCurrentScope()),da=Yi.name===lt||Yi.name===uo||Yi.name===It;return xr(new Ya(K),Qn,!da)};if(xr.__IS_EVAL_FUNC)return function(Qn){return xr(new Ya(K),Qn,!0)};if(xr.__IS_FUNCTION_FUNC)return function(){for(var Qn=arguments.length,Yi=new Array(Qn),da=0;da<Qn;da++)Yi[da]=arguments[da];return xr.apply(void 0,[new Ya(K)].concat(Yi))};var Pn=K.options.globalContextInFunction;if(O.type==="Identifier"){var fi=K.getIdentifierScope(O);fi.name===kr&&(Pn=fi.data)}return xr.bind(Pn)}}},w.callExpressionHandler=function(O){var K=this,_e=this.createCallFunctionGetter(O.callee),Xe=O.arguments.map(function(ft){return K.createClosure(ft)});return function(){return _e().apply(void 0,Xe.map(function(ft){return ft()}))}},w.functionExpressionHandler=function(O){var K=this,_e=this,Xe=this.source,ft=this.collectDeclVars,mt=this.collectDeclFuncs;this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var cr=O.id?O.id.name:"",xr=O.params.length,Pn=O.params.map(function(da){return K.createParamNameGetter(da)}),fi=this.createClosure(O.body),Qn=this.collectDeclVars,Yi=this.collectDeclFuncs;return this.collectDeclVars=ft,this.collectDeclFuncs=mt,function(){var da=_e.getCurrentScope(),Ra=function Hi(){for(var Lo=arguments.length,Ss=new Array(Lo),hl=0;hl<Lo;hl++)Ss[hl]=arguments[hl];_e.callStack.push(""+cr);var Gc=_e.getCurrentScope(),Xu=su(da,"FunctionScope("+cr+")");_e.setCurrentScope(Xu),_e.addDeclarationsToScope(Qn,Yi,Xu),cr&&(Xu.data[cr]=Hi),Xu.data.arguments=arguments,Pn.forEach(function(vu,Ao){Xu.data[vu()]=Ss[Ao]});var Sc=_e.getCurrentContext();_e.setCurrentContext(this);var Mu=fi();if(_e.setCurrentContext(Sc),_e.setCurrentScope(Gc),_e.callStack.pop(),Mu instanceof cn)return Mu.value};return xc(Ra,cr),Object.defineProperty(Ra,"length",{value:xr,writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(Ra,"toString",{value:function(){return Xe.slice(O.start,O.end)},writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(Ra,"valueOf",{value:function(){return Xe.slice(O.start,O.end)},writable:!0,configurable:!0,enumerable:!1}),Ra}},w.newExpressionHandler=function(O){var K=this,_e=this.source,Xe=this.createClosure(O.callee),ft=O.arguments.map(function(mt){return K.createClosure(mt)});return function(){var mt=Xe();if(!Ji(mt)||mt.__IS_EVAL_FUNC){var cr=O.callee,xr=_e.slice(cr.start,cr.end);throw K.createInternalThrowError(xa.IsNotConstructor,xr,O)}return mt.__IS_FUNCTION_FUNC?mt.apply(void 0,[new Ya(K)].concat(ft.map(function(Pn){return Pn()}))):Jo(mt,ft.map(function(Pn){return Pn()}))}},w.memberExpressionHandler=function(O){var K=this.createClosure(O.object),_e=this.createMemberKeyGetter(O);return function(){var Xe=K(),ft=_e();return Xe[ft]}},w.thisExpressionHandler=function(O){var K=this;return function(){return K.getCurrentContext()}},w.sequenceExpressionHandler=function(O){var K=this,_e=O.expressions.map(function(Xe){return K.createClosure(Xe)});return function(){for(var Xe,ft=_e.length,mt=0;mt<ft;mt++){var cr=_e[mt];Xe=cr()}return Xe}},w.literalHandler=function(O){return function(){return O.regex?new RegExp(O.regex.pattern,O.regex.flags):O.value}},w.identifierHandler=function(O){var K=this;return function(){var _e=K.getCurrentScope(),Xe=K.getScopeDataFromName(O.name,_e);return K.assertVariable(Xe,O.name,O),Xe[O.name]}},w.getIdentifierScope=function(O){var K=this.getCurrentScope(),_e=this.getScopeFromName(O.name,K);return _e},w.assignmentExpressionHandler=function(O){var K=this;O.left.type==="Identifier"&&O.right.type==="FunctionExpression"&&!O.right.id&&(O.right.id={type:"Identifier",name:O.left.name});var _e=this.createObjectGetter(O.left),Xe=this.createNameGetter(O.left),ft=this.createClosure(O.right);return function(){var mt=_e(),cr=Xe(),xr=ft();switch(O.operator!=="="&&K.assertVariable(mt,cr,O),O.operator){case"=":return mt[cr]=xr;case"+=":return mt[cr]+=xr;case"-=":return mt[cr]-=xr;case"*=":return mt[cr]*=xr;case"**=":return mt[cr]=Math.pow(mt[cr],xr);case"/=":return mt[cr]/=xr;case"%=":return mt[cr]%=xr;case"<<=":return mt[cr]<<=xr;case">>=":return mt[cr]>>=xr;case">>>=":return mt[cr]>>>=xr;case"&=":return mt[cr]&=xr;case"^=":return mt[cr]^=xr;case"|=":return mt[cr]|=xr;default:throw K.createInternalThrowError(xa.AssignmentExpressionSyntaxError,O.type,O)}}},w.functionDeclarationHandler=function(O){if(O.id){var K=this.functionExpressionHandler(O);Object.defineProperty(K,"isFunctionDeclareClosure",{value:!0,writable:!1,configurable:!1,enumerable:!1}),this.funcDeclaration(O.id.name,K)}return function(){return Rt}},w.getVariableName=function(O){if(O.type==="Identifier")return O.name;throw this.createInternalThrowError(xa.VariableTypeSyntaxError,O.type,O)},w.variableDeclarationHandler=function(O){for(var K=this,_e,Xe=[],ft=0;ft<O.declarations.length;ft++){var mt=O.declarations[ft];this.varDeclaration(this.getVariableName(mt.id)),mt.init&&Xe.push({type:"AssignmentExpression",operator:"=",left:mt.id,right:mt.init})}return Xe.length&&(_e=this.createClosure({type:"BlockStatement",body:Xe})),function(){if(_e){var cr=K.isVarDeclMode;K.isVarDeclMode=!0,_e(),K.isVarDeclMode=cr}return Rt}},w.assertVariable=function(O,K,_e){if(O===this.globalScope.data&&!(K in O))throw this.createInternalThrowError(xa.VariableUndefinedReferenceError,K,_e)},w.programHandler=function(O){var K=this,_e=O.body.map(function(Xe){return K.createClosure(Xe)});return function(){for(var Xe=Rt,ft=0;ft<_e.length;ft++){var mt=_e[ft],cr=K.setValue(mt());if(cr!==Rt&&(Xe=cr,Xe instanceof cn||Xe instanceof Yt||Xe instanceof Zo||Xe===ne||Xe===be))break}return Xe}},w.expressionStatementHandler=function(O){return this.createClosure(O.expression)},w.emptyStatementHandler=function(O){return function(){return Rt}},w.returnStatementHandler=function(O){var K=O.argument?this.createClosure(O.argument):Ks;return function(){return new cn(K())}},w.ifStatementHandler=function(O){var K=this.createClosure(O.test),_e=this.createClosure(O.consequent),Xe=O.alternate?this.createClosure(O.alternate):function(){return Rt};return function(){return K()?_e():Xe()}},w.conditionalExpressionHandler=function(O){return this.ifStatementHandler(O)},w.forStatementHandler=function(O){var K=this,_e=Ks,Xe=O.test?this.createClosure(O.test):function(){return!0},ft=Ks,mt=this.createClosure(O.body);return O.type==="ForStatement"&&(_e=O.init?this.createClosure(O.init):_e,ft=O.update?this.createClosure(O.update):Ks),function(cr){var xr,Pn=Rt,fi=O.type==="DoWhileStatement";for(cr&&cr.type==="LabeledStatement"&&(xr=cr.label.name),_e();fi||Xe();ft()){fi=!1;var Qn=K.setValue(mt());if(!(Qn===Rt||Qn===be)){if(Qn===ne)break;if(Pn=Qn,Pn instanceof Zo&&Pn.value===xr){Pn=Rt;continue}if(Pn instanceof cn||Pn instanceof Yt||Pn instanceof Zo)break}}return Pn}},w.whileStatementHandler=function(O){return this.forStatementHandler(O)},w.doWhileStatementHandler=function(O){return this.forStatementHandler(O)},w.forInStatementHandler=function(O){var K=this,_e=O.left,Xe=this.createClosure(O.right),ft=this.createClosure(O.body);return O.left.type==="VariableDeclaration"&&(this.createClosure(O.left)(),_e=O.left.declarations[0].id),function(mt){var cr,xr=Rt,Pn;mt&&mt.type==="LabeledStatement"&&(cr=mt.label.name);var fi=Xe();for(Pn in fi){K.assignmentExpressionHandler({type:"AssignmentExpression",operator:"=",left:_e,right:{type:"Literal",value:Pn}})();var Qn=K.setValue(ft());if(!(Qn===Rt||Qn===be)){if(Qn===ne)break;if(xr=Qn,xr instanceof Zo&&xr.value===cr){xr=Rt;continue}if(xr instanceof cn||xr instanceof Yt||xr instanceof Zo)break}}return xr}},w.withStatementHandler=function(O){var K=this,_e=this.createClosure(O.object),Xe=this.createClosure(O.body);return function(){var ft=_e(),mt=K.getCurrentScope(),cr=new xe(ft,mt,kr);K.setCurrentScope(cr);var xr=K.setValue(Xe());return K.setCurrentScope(mt),xr}},w.throwStatementHandler=function(O){var K=this,_e=this.createClosure(O.argument);return function(){throw K.setValue(void 0),_e()}},w.tryStatementHandler=function(O){var K=this,_e=this.createClosure(O.block),Xe=O.handler?this.catchClauseHandler(O.handler):null,ft=O.finalizer?this.createClosure(O.finalizer):null;return function(){var mt=K.getCurrentScope(),cr=K.getCurrentContext(),xr=mt.labelStack.concat([]),Pn=K.callStack.concat([]),fi=Rt,Qn,Yi,da=function(){K.setCurrentScope(mt),K.setCurrentContext(cr),mt.labelStack=xr,K.callStack=Pn};try{fi=K.setValue(_e()),fi instanceof cn&&(Qn=fi)}catch(Ra){if(da(),K.isInterruptThrow(Ra))throw Ra;if(Xe)try{fi=K.setValue(Xe(Ra)),fi instanceof cn&&(Qn=fi)}catch(Hi){if(da(),K.isInterruptThrow(Hi))throw Hi;Yi=Hi}}if(ft)try{fi=ft(),fi instanceof cn&&(Qn=fi)}catch(Ra){if(da(),K.isInterruptThrow(Ra))throw Ra;Yi=Ra}if(Yi)throw Yi;return Qn||fi}},w.catchClauseHandler=function(O){var K=this,_e=this.createParamNameGetter(O.param),Xe=this.createClosure(O.body);return function(ft){var mt,cr=K.getCurrentScope(),xr=cr.data,Pn=_e(),fi=Ds.call(xr,Pn),Qn=xr[Pn];return xr[Pn]=ft,mt=Xe(),fi?xr[Pn]=Qn:delete xr[Pn],mt}},w.continueStatementHandler=function(O){return function(){return O.label?new Zo(O.label.name):be}},w.breakStatementHandler=function(O){return function(){return O.label?new Yt(O.label.name):ne}},w.switchStatementHandler=function(O){var K=this,_e=this.createClosure(O.discriminant),Xe=O.cases.map(function(ft){return K.switchCaseHandler(ft)});return function(){for(var ft=_e(),mt=!1,cr,xr,Pn,fi=0;fi<Xe.length;fi++){var Qn=Xe[fi](),Yi=Qn.testClosure();if(Yi===Qe){Pn=Qn;continue}if(mt||Yi===ft){if(mt=!0,xr=K.setValue(Qn.bodyClosure()),xr===Rt)continue;if(xr===ne||(cr=xr,cr instanceof cn||cr instanceof Yt||cr instanceof Zo||cr===be))break}}if(!mt&&Pn){xr=K.setValue(Pn.bodyClosure());var da=xr===Rt||xr===ne||xr===be;da||(cr=xr)}return cr}},w.switchCaseHandler=function(O){var K=O.test?this.createClosure(O.test):function(){return Qe},_e=this.createClosure({type:"BlockStatement",body:O.consequent});return function(){return{testClosure:K,bodyClosure:_e}}},w.labeledStatementHandler=function(O){var K=this,_e=O.label.name,Xe=this.createClosure(O.body);return function(){var ft,mt=K.getCurrentScope();return mt.labelStack.push(_e),ft=Xe(O),ft instanceof Yt&&ft.value===_e&&(ft=Rt),mt.labelStack.pop(),ft}},w.debuggerStatementHandler=function(O){return function(){debugger;return Rt}},w.createParamNameGetter=function(O){if(O.type==="Identifier")return function(){return O.name};throw this.createInternalThrowError(xa.ParamTypeSyntaxError,O.type,O)},w.createObjectKeyGetter=function(O){var K;return O.type==="Identifier"?K=function(){return O.name}:K=this.createClosure(O),function(){return K()}},w.createMemberKeyGetter=function(O){return O.computed?this.createClosure(O.property):this.createObjectKeyGetter(O.property)},w.createObjectGetter=function(O){var K=this;switch(O.type){case"Identifier":return function(){return K.getScopeDataFromName(O.name,K.getCurrentScope())};case"MemberExpression":return this.createClosure(O.object);default:throw this.createInternalThrowError(xa.AssignmentTypeSyntaxError,O.type,O)}},w.createNameGetter=function(O){switch(O.type){case"Identifier":return function(){return O.name};case"MemberExpression":return this.createMemberKeyGetter(O);default:throw this.createInternalThrowError(xa.AssignmentTypeSyntaxError,O.type,O)}},w.varDeclaration=function(O){var K=this.collectDeclVars;K[O]=void 0},w.funcDeclaration=function(O,K){var _e=this.collectDeclFuncs;_e[O]=K},w.addDeclarationsToScope=function(O,K,_e){var Xe=_e.data;for(var ft in K){var mt=K[ft];Xe[ft]=mt&&mt()}for(var cr in O)cr in Xe||(Xe[cr]=void 0)},w.getScopeValue=function(O,K){var _e=this.getScopeFromName(O,K);return _e.data[O]},w.getScopeDataFromName=function(O,K){return this.getScopeFromName(O,K).data},w.getScopeFromName=function(O,K){var _e=K;do if(O in _e.data)return _e;while(_e=_e.parent);return this.globalScope},w.setValue=function(O){var K=this.callStack.length;return this.isVarDeclMode||K||O===Rt||O===ne||O===be||O instanceof Yt||O instanceof Zo||(this.value=O instanceof cn?O.value:O),O},w.getValue=function(){return this.value},_}();xo.version=ou,xo.eval=Qo,xo.Function=pn,xo.ecmaVersion=5,xo.globalContextInFunction=void 0,xo.global=Object.create(null);function Wl(_){return _===void 0&&(_=Object.create(null)),_}function bc(_,w,N){w===void 0&&(w=[]),N===void 0&&(N={});var O=N.parsingContext,K=N.timeout===void 0?0:N.timeout,_e=`
    (function anonymous(`+w.join(",")+`){
         `+_+`
    });
    `,Xe=new xo(O,{ecmaVersion:N.ecmaVersion,timeout:K,rootContext:N.rootContext,globalContextInFunction:N.globalContextInFunction});return Xe.evaluate(_e)}function Gu(_,w,N){var O=new xo(w,N);return O.evaluate(_)}var Ec=Gu,Tl=function(){function _(N){this._code=N}var w=_.prototype;return w.runInContext=function(O){return Gu(this._code,O)},w.runInNewContext=function(O){return Gu(this._code,O)},_}(),Hu=function(_,w,N){return Gu(_,w,N)};function uu(){for(var _=arguments.length,w=new Array(_),N=0;N<_;N++)w[N]=arguments[N];var O=w.pop();return bc(O||"",w)}var Wu=Hu},20396:function(Ze,H,R){var Y;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(J,v,te,B){"use strict";var Q=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",ie=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),Ee=Q||ie,re=["","webkit","Moz","MS","ms","o"],Ge=Ee?"":v.createElement("div"),Ce="function",tt=Math.round,Mt=Math.abs,ir=Date.now;function bt(ne,be,Qe){return setTimeout(vt(ne,Qe),be)}function qt(ne,be,Qe){return Array.isArray(ne)?(At(ne,Qe[be],Qe),!0):!1}function At(ne,be,Qe){var Rt;if(!!ne)if(ne.forEach)ne.forEach(be,Qe);else if(ne.length!==B)for(Rt=0;Rt<ne.length;)be.call(Qe,ne[Rt],Rt,ne),Rt++;else for(Rt in ne)ne.hasOwnProperty(Rt)&&be.call(Qe,ne[Rt],Rt,ne)}function ot(ne,be,Qe){var Rt="DEPRECATED METHOD: "+be+`
`+Qe+` AT 
`;return function(){var kr=new Error("get-stack-trace"),lt=kr&&kr.stack?kr.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",It=J.console&&(J.console.warn||J.console.log);return It&&It.call(J.console,Rt,lt),ne.apply(this,arguments)}}var ct;typeof Object.assign!="function"?ct=function(be){if(be===B||be===null)throw new TypeError("Cannot convert undefined or null to object");for(var Qe=Object(be),Rt=1;Rt<arguments.length;Rt++){var kr=arguments[Rt];if(kr!==B&&kr!==null)for(var lt in kr)kr.hasOwnProperty(lt)&&(Qe[lt]=kr[lt])}return Qe}:ct=Object.assign;var Qt=ot(function(be,Qe,Rt){for(var kr=Object.keys(Qe),lt=0;lt<kr.length;)(!Rt||Rt&&be[kr[lt]]===B)&&(be[kr[lt]]=Qe[kr[lt]]),lt++;return be},"extend","Use `assign`."),X=ot(function(be,Qe){return Qt(be,Qe,!0)},"merge","Use `assign`.");function Kt(ne,be,Qe){var Rt=be.prototype,kr;kr=ne.prototype=Object.create(Rt),kr.constructor=ne,kr._super=Rt,Qe&&ct(kr,Qe)}function vt(ne,be){return function(){return ne.apply(be,arguments)}}function qe(ne,be){return typeof ne==Ce?ne.apply(be&&be[0]||B,be):ne}function dt(ne,be){return ne===B?be:ne}function $e(ne,be,Qe){At(Wr(be),function(Rt){ne.addEventListener(Rt,Qe,!1)})}function kt(ne,be,Qe){At(Wr(be),function(Rt){ne.removeEventListener(Rt,Qe,!1)})}function yr(ne,be){for(;ne;){if(ne==be)return!0;ne=ne.parentNode}return!1}function Pr(ne,be){return ne.indexOf(be)>-1}function Wr(ne){return ne.trim().split(/\s+/g)}function Te(ne,be,Qe){if(ne.indexOf&&!Qe)return ne.indexOf(be);for(var Rt=0;Rt<ne.length;){if(Qe&&ne[Rt][Qe]==be||!Qe&&ne[Rt]===be)return Rt;Rt++}return-1}function Ye(ne){return Array.prototype.slice.call(ne,0)}function De(ne,be,Qe){for(var Rt=[],kr=[],lt=0;lt<ne.length;){var It=be?ne[lt][be]:ne[lt];Te(kr,It)<0&&Rt.push(ne[lt]),kr[lt]=It,lt++}return Qe&&(be?Rt=Rt.sort(function(Ji,Ya){return Ji[be]>Ya[be]}):Rt=Rt.sort()),Rt}function wt(ne,be){for(var Qe,Rt,kr=be[0].toUpperCase()+be.slice(1),lt=0;lt<re.length;){if(Qe=re[lt],Rt=Qe?Qe+kr:be,Rt in ne)return Rt;lt++}return B}var gt=1;function Ut(){return gt++}function Jt(ne){var be=ne.ownerDocument||ne;return be.defaultView||be.parentWindow||J}var Cr=/mobile|tablet|ip(ad|hone|od)|android/i,Yn="ontouchstart"in J,hn=wt(J,"PointerEvent")!==B,qi=Yn&&Cr.test(navigator.userAgent),jn="touch",Xn="pen",vi="mouse",qn="kinect",li=25,aa=1,Di=2,Ai=4,Vi=8,la=1,wi=2,Sa=4,Mn=8,Si=16,ji=wi|Sa,Ki=Mn|Si,Wa=ji|Ki,ve=["x","y"],Fn=["clientX","clientY"];function Xa(ne,be){var Qe=this;this.manager=ne,this.callback=be,this.element=ne.element,this.target=ne.options.inputTarget,this.domHandler=function(Rt){qe(ne.options.enable,[ne])&&Qe.handler(Rt)},this.init()}Xa.prototype={handler:function(){},init:function(){this.evEl&&$e(this.element,this.evEl,this.domHandler),this.evTarget&&$e(this.target,this.evTarget,this.domHandler),this.evWin&&$e(Jt(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&kt(this.element,this.evEl,this.domHandler),this.evTarget&&kt(this.target,this.evTarget,this.domHandler),this.evWin&&kt(Jt(this.element),this.evWin,this.domHandler)}};function fs(ne){var be,Qe=ne.options.inputClass;return Qe?be=Qe:hn?be=Oe:qi?be=zt:Yn?be=Tt:be=Ta,new be(ne,jt)}function jt(ne,be,Qe){var Rt=Qe.pointers.length,kr=Qe.changedPointers.length,lt=be&aa&&Rt-kr==0,It=be&(Ai|Vi)&&Rt-kr==0;Qe.isFirst=!!lt,Qe.isFinal=!!It,lt&&(ne.session={}),Qe.eventType=be,sr(ne,Qe),ne.emit("hammer.input",Qe),ne.recognize(Qe),ne.session.prevInput=Qe}function sr(ne,be){var Qe=ne.session,Rt=be.pointers,kr=Rt.length;Qe.firstInput||(Qe.firstInput=ur(be)),kr>1&&!Qe.firstMultiple?Qe.firstMultiple=ur(be):kr===1&&(Qe.firstMultiple=!1);var lt=Qe.firstInput,It=Qe.firstMultiple,uo=It?It.center:lt.center,Ji=be.center=Ln(Rt);be.timeStamp=ir(),be.deltaTime=be.timeStamp-lt.timeStamp,be.angle=Pi(uo,Ji),be.distance=rn(uo,Ji),Tr(Qe,be),be.offsetDirection=Gn(be.deltaX,be.deltaY);var Ya=ci(be.deltaTime,be.deltaX,be.deltaY);be.overallVelocityX=Ya.x,be.overallVelocityY=Ya.y,be.overallVelocity=Mt(Ya.x)>Mt(Ya.y)?Ya.x:Ya.y,be.scale=It?Ja(It.pointers,Rt):1,be.rotation=It?Ii(It.pointers,Rt):0,be.maxPointers=Qe.prevInput?be.pointers.length>Qe.prevInput.maxPointers?be.pointers.length:Qe.prevInput.maxPointers:be.pointers.length,I(Qe,be);var Qo=ne.element;yr(be.srcEvent.target,Qo)&&(Qo=be.srcEvent.target),be.target=Qo}function Tr(ne,be){var Qe=be.center,Rt=ne.offsetDelta||{},kr=ne.prevDelta||{},lt=ne.prevInput||{};(be.eventType===aa||lt.eventType===Ai)&&(kr=ne.prevDelta={x:lt.deltaX||0,y:lt.deltaY||0},Rt=ne.offsetDelta={x:Qe.x,y:Qe.y}),be.deltaX=kr.x+(Qe.x-Rt.x),be.deltaY=kr.y+(Qe.y-Rt.y)}function I(ne,be){var Qe=ne.lastInterval||be,Rt=be.timeStamp-Qe.timeStamp,kr,lt,It,uo;if(be.eventType!=Vi&&(Rt>li||Qe.velocity===B)){var Ji=be.deltaX-Qe.deltaX,Ya=be.deltaY-Qe.deltaY,Qo=ci(Rt,Ji,Ya);lt=Qo.x,It=Qo.y,kr=Mt(Qo.x)>Mt(Qo.y)?Qo.x:Qo.y,uo=Gn(Ji,Ya),ne.lastInterval=be}else kr=Qe.velocity,lt=Qe.velocityX,It=Qe.velocityY,uo=Qe.direction;be.velocity=kr,be.velocityX=lt,be.velocityY=It,be.direction=uo}function ur(ne){for(var be=[],Qe=0;Qe<ne.pointers.length;)be[Qe]={clientX:tt(ne.pointers[Qe].clientX),clientY:tt(ne.pointers[Qe].clientY)},Qe++;return{timeStamp:ir(),pointers:be,center:Ln(be),deltaX:ne.deltaX,deltaY:ne.deltaY}}function Ln(ne){var be=ne.length;if(be===1)return{x:tt(ne[0].clientX),y:tt(ne[0].clientY)};for(var Qe=0,Rt=0,kr=0;kr<be;)Qe+=ne[kr].clientX,Rt+=ne[kr].clientY,kr++;return{x:tt(Qe/be),y:tt(Rt/be)}}function ci(ne,be,Qe){return{x:be/ne||0,y:Qe/ne||0}}function Gn(ne,be){return ne===be?la:Mt(ne)>=Mt(be)?ne<0?wi:Sa:be<0?Mn:Si}function rn(ne,be,Qe){Qe||(Qe=ve);var Rt=be[Qe[0]]-ne[Qe[0]],kr=be[Qe[1]]-ne[Qe[1]];return Math.sqrt(Rt*Rt+kr*kr)}function Pi(ne,be,Qe){Qe||(Qe=ve);var Rt=be[Qe[0]]-ne[Qe[0]],kr=be[Qe[1]]-ne[Qe[1]];return Math.atan2(kr,Rt)*180/Math.PI}function Ii(ne,be){return Pi(be[1],be[0],Fn)+Pi(ne[1],ne[0],Fn)}function Ja(ne,be){return rn(be[0],be[1],Fn)/rn(ne[0],ne[1],Fn)}var hs={mousedown:aa,mousemove:Di,mouseup:Ai},_a="mousedown",Da="mousemove mouseup";function Ta(){this.evEl=_a,this.evWin=Da,this.pressed=!1,Xa.apply(this,arguments)}Kt(Ta,Xa,{handler:function(be){var Qe=hs[be.type];Qe&aa&&be.button===0&&(this.pressed=!0),Qe&Di&&be.which!==1&&(Qe=Ai),!!this.pressed&&(Qe&Ai&&(this.pressed=!1),this.callback(this.manager,Qe,{pointers:[be],changedPointers:[be],pointerType:vi,srcEvent:be}))}});var V={pointerdown:aa,pointermove:Di,pointerup:Ai,pointercancel:Vi,pointerout:Vi},$={2:jn,3:Xn,4:vi,5:qn},se="pointerdown",ge="pointermove pointerup pointercancel";!Ee&&J.MSPointerEvent&&!J.PointerEvent&&(se="MSPointerDown",ge="MSPointerMove MSPointerUp MSPointerCancel");function Oe(){this.evEl=se,this.evWin=ge,Xa.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}Kt(Oe,Xa,{handler:function(be){var Qe=this.store,Rt=!1,kr=be.type.toLowerCase().replace("ms",""),lt=V[kr],It=$[be.pointerType]||be.pointerType,uo=It==jn,Ji=Te(Qe,be.pointerId,"pointerId");lt&aa&&(be.button===0||uo)?Ji<0&&(Qe.push(be),Ji=Qe.length-1):lt&(Ai|Vi)&&(Rt=!0),!(Ji<0)&&(Qe[Ji]=be,this.callback(this.manager,lt,{pointers:Qe,changedPointers:[be],pointerType:It,srcEvent:be}),Rt&&Qe.splice(Ji,1))}});var We={touchstart:aa,touchmove:Di,touchend:Ai,touchcancel:Vi},nt="touchstart",pe="touchstart touchmove touchend touchcancel";function Fe(){this.evTarget=nt,this.evWin=pe,this.started=!1,Xa.apply(this,arguments)}Kt(Fe,Xa,{handler:function(be){var Qe=We[be.type];if(Qe===aa&&(this.started=!0),!!this.started){var Rt=yt.call(this,be,Qe);Qe&(Ai|Vi)&&Rt[0].length-Rt[1].length==0&&(this.started=!1),this.callback(this.manager,Qe,{pointers:Rt[0],changedPointers:Rt[1],pointerType:jn,srcEvent:be})}}});function yt(ne,be){var Qe=Ye(ne.touches),Rt=Ye(ne.changedTouches);return be&(Ai|Vi)&&(Qe=De(Qe.concat(Rt),"identifier",!0)),[Qe,Rt]}var dr={touchstart:aa,touchmove:Di,touchend:Ai,touchcancel:Vi},Dt="touchstart touchmove touchend touchcancel";function zt(){this.evTarget=Dt,this.targetIds={},Xa.apply(this,arguments)}Kt(zt,Xa,{handler:function(be){var Qe=dr[be.type],Rt=gr.call(this,be,Qe);!Rt||this.callback(this.manager,Qe,{pointers:Rt[0],changedPointers:Rt[1],pointerType:jn,srcEvent:be})}});function gr(ne,be){var Qe=Ye(ne.touches),Rt=this.targetIds;if(be&(aa|Di)&&Qe.length===1)return Rt[Qe[0].identifier]=!0,[Qe,Qe];var kr,lt,It=Ye(ne.changedTouches),uo=[],Ji=this.target;if(lt=Qe.filter(function(Ya){return yr(Ya.target,Ji)}),be===aa)for(kr=0;kr<lt.length;)Rt[lt[kr].identifier]=!0,kr++;for(kr=0;kr<It.length;)Rt[It[kr].identifier]&&uo.push(It[kr]),be&(Ai|Vi)&&delete Rt[It[kr].identifier],kr++;if(!!uo.length)return[De(lt.concat(uo),"identifier",!0),uo]}var En=2500,un=25;function Tt(){Xa.apply(this,arguments);var ne=vt(this.handler,this);this.touch=new zt(this.manager,ne),this.mouse=new Ta(this.manager,ne),this.primaryTouch=null,this.lastTouches=[]}Kt(Tt,Xa,{handler:function(be,Qe,Rt){var kr=Rt.pointerType==jn,lt=Rt.pointerType==vi;if(!(lt&&Rt.sourceCapabilities&&Rt.sourceCapabilities.firesTouchEvents)){if(kr)nn.call(this,Qe,Rt);else if(lt&&Yr.call(this,Rt))return;this.callback(be,Qe,Rt)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function nn(ne,be){ne&aa?(this.primaryTouch=be.changedPointers[0].identifier,Zr.call(this,be)):ne&(Ai|Vi)&&Zr.call(this,be)}function Zr(ne){var be=ne.changedPointers[0];if(be.identifier===this.primaryTouch){var Qe={x:be.clientX,y:be.clientY};this.lastTouches.push(Qe);var Rt=this.lastTouches,kr=function(){var lt=Rt.indexOf(Qe);lt>-1&&Rt.splice(lt,1)};setTimeout(kr,En)}}function Yr(ne){for(var be=ne.srcEvent.clientX,Qe=ne.srcEvent.clientY,Rt=0;Rt<this.lastTouches.length;Rt++){var kr=this.lastTouches[Rt],lt=Math.abs(be-kr.x),It=Math.abs(Qe-kr.y);if(lt<=un&&It<=un)return!0}return!1}var oi=Ee?B:wt(Ge.style,"touchAction"),Qr=oi!==B,Ti="compute",ea="auto",bi="manipulation",Oi="none",Ci="pan-x",ti="pan-y",Xi=Ri();function Fa(ne,be){this.manager=ne,this.set(be)}Fa.prototype={set:function(ne){ne==Ti&&(ne=this.compute()),Qr&&this.manager.element.style&&Xi[ne]&&(this.manager.element.style[oi]=ne),this.actions=ne.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var ne=[];return At(this.manager.recognizers,function(be){qe(be.options.enable,[be])&&(ne=ne.concat(be.getTouchAction()))}),oa(ne.join(" "))},preventDefaults:function(ne){var be=ne.srcEvent,Qe=ne.offsetDirection;if(this.manager.session.prevented){be.preventDefault();return}var Rt=this.actions,kr=Pr(Rt,Oi)&&!Xi[Oi],lt=Pr(Rt,ti)&&!Xi[ti],It=Pr(Rt,Ci)&&!Xi[Ci];if(kr){var uo=ne.pointers.length===1,Ji=ne.distance<2,Ya=ne.deltaTime<250;if(uo&&Ji&&Ya)return}if(!(It&&lt)&&(kr||lt&&Qe&ji||It&&Qe&Ki))return this.preventSrc(be)},preventSrc:function(ne){this.manager.session.prevented=!0,ne.preventDefault()}};function oa(ne){if(Pr(ne,Oi))return Oi;var be=Pr(ne,Ci),Qe=Pr(ne,ti);return be&&Qe?Oi:be||Qe?be?Ci:ti:Pr(ne,bi)?bi:ea}function Ri(){if(!Qr)return!1;var ne={};if(Ee)return ne;var be=J.CSS&&J.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(Qe){ne[Qe]=be?J.CSS.supports("touch-action",Qe):!0}),ne}var Gi=1,Za=2,au=4,Ma=8,Pa=Ma,Es=16,ps=32;function ra(ne){this.options=ct({},this.defaults,ne||{}),this.id=Ut(),this.manager=null,this.options.enable=dt(this.options.enable,!0),this.state=Gi,this.simultaneous={},this.requireFail=[]}ra.prototype={defaults:{},set:function(ne){return ct(this.options,ne),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(ne){if(qt(ne,"recognizeWith",this))return this;var be=this.simultaneous;return ne=ja(ne,this),be[ne.id]||(be[ne.id]=ne,ne.recognizeWith(this)),this},dropRecognizeWith:function(ne){return qt(ne,"dropRecognizeWith",this)?this:(ne=ja(ne,this),delete this.simultaneous[ne.id],this)},requireFailure:function(ne){if(qt(ne,"requireFailure",this))return this;var be=this.requireFail;return ne=ja(ne,this),Te(be,ne)===-1&&(be.push(ne),ne.requireFailure(this)),this},dropRequireFailure:function(ne){if(qt(ne,"dropRequireFailure",this))return this;ne=ja(ne,this);var be=Te(this.requireFail,ne);return be>-1&&this.requireFail.splice(be,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(ne){return!!this.simultaneous[ne.id]},emit:function(ne){var be=this,Qe=this.state;function Rt(kr){be.manager.emit(kr,ne)}Qe<Ma&&Rt(be.options.event+ju(Qe)),Rt(be.options.event),ne.additionalEvent&&Rt(ne.additionalEvent),Qe>=Ma&&Rt(be.options.event+ju(Qe))},tryEmit:function(ne){if(this.canEmit())return this.emit(ne);this.state=ps},canEmit:function(){for(var ne=0;ne<this.requireFail.length;){if(!(this.requireFail[ne].state&(ps|Gi)))return!1;ne++}return!0},recognize:function(ne){var be=ct({},ne);if(!qe(this.options.enable,[this,be])){this.reset(),this.state=ps;return}this.state&(Pa|Es|ps)&&(this.state=Gi),this.state=this.process(be),this.state&(Za|au|Ma|Es)&&this.tryEmit(be)},process:function(ne){},getTouchAction:function(){},reset:function(){}};function ju(ne){return ne&Es?"cancel":ne&Ma?"end":ne&au?"move":ne&Za?"start":""}function yo(ne){return ne==Si?"down":ne==Mn?"up":ne==wi?"left":ne==Sa?"right":""}function ja(ne,be){var Qe=be.manager;return Qe?Qe.get(ne):ne}function oo(){ra.apply(this,arguments)}Kt(oo,ra,{defaults:{pointers:1},attrTest:function(ne){var be=this.options.pointers;return be===0||ne.pointers.length===be},process:function(ne){var be=this.state,Qe=ne.eventType,Rt=be&(Za|au),kr=this.attrTest(ne);return Rt&&(Qe&Vi||!kr)?be|Es:Rt||kr?Qe&Ai?be|Ma:be&Za?be|au:Za:ps}});function $i(){oo.apply(this,arguments),this.pX=null,this.pY=null}Kt($i,oo,{defaults:{event:"pan",threshold:10,pointers:1,direction:Wa},getTouchAction:function(){var ne=this.options.direction,be=[];return ne&ji&&be.push(ti),ne&Ki&&be.push(Ci),be},directionTest:function(ne){var be=this.options,Qe=!0,Rt=ne.distance,kr=ne.direction,lt=ne.deltaX,It=ne.deltaY;return kr&be.direction||(be.direction&ji?(kr=lt===0?la:lt<0?wi:Sa,Qe=lt!=this.pX,Rt=Math.abs(ne.deltaX)):(kr=It===0?la:It<0?Mn:Si,Qe=It!=this.pY,Rt=Math.abs(ne.deltaY))),ne.direction=kr,Qe&&Rt>be.threshold&&kr&be.direction},attrTest:function(ne){return oo.prototype.attrTest.call(this,ne)&&(this.state&Za||!(this.state&Za)&&this.directionTest(ne))},emit:function(ne){this.pX=ne.deltaX,this.pY=ne.deltaY;var be=yo(ne.direction);be&&(ne.additionalEvent=this.options.event+be),this._super.emit.call(this,ne)}});function qo(){oo.apply(this,arguments)}Kt(qo,oo,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Oi]},attrTest:function(ne){return this._super.attrTest.call(this,ne)&&(Math.abs(ne.scale-1)>this.options.threshold||this.state&Za)},emit:function(ne){if(ne.scale!==1){var be=ne.scale<1?"in":"out";ne.additionalEvent=this.options.event+be}this._super.emit.call(this,ne)}});function Ko(){ra.apply(this,arguments),this._timer=null,this._input=null}Kt(Ko,ra,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[ea]},process:function(ne){var be=this.options,Qe=ne.pointers.length===be.pointers,Rt=ne.distance<be.threshold,kr=ne.deltaTime>be.time;if(this._input=ne,!Rt||!Qe||ne.eventType&(Ai|Vi)&&!kr)this.reset();else if(ne.eventType&aa)this.reset(),this._timer=bt(function(){this.state=Pa,this.tryEmit()},be.time,this);else if(ne.eventType&Ai)return Pa;return ps},reset:function(){clearTimeout(this._timer)},emit:function(ne){this.state===Pa&&(ne&&ne.eventType&Ai?this.manager.emit(this.options.event+"up",ne):(this._input.timeStamp=ir(),this.manager.emit(this.options.event,this._input)))}});function Vu(){oo.apply(this,arguments)}Kt(Vu,oo,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Oi]},attrTest:function(ne){return this._super.attrTest.call(this,ne)&&(Math.abs(ne.rotation)>this.options.threshold||this.state&Za)}});function Co(){oo.apply(this,arguments)}Kt(Co,oo,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:ji|Ki,pointers:1},getTouchAction:function(){return $i.prototype.getTouchAction.call(this)},attrTest:function(ne){var be=this.options.direction,Qe;return be&(ji|Ki)?Qe=ne.overallVelocity:be&ji?Qe=ne.overallVelocityX:be&Ki&&(Qe=ne.overallVelocityY),this._super.attrTest.call(this,ne)&&be&ne.offsetDirection&&ne.distance>this.options.threshold&&ne.maxPointers==this.options.pointers&&Mt(Qe)>this.options.velocity&&ne.eventType&Ai},emit:function(ne){var be=yo(ne.offsetDirection);be&&this.manager.emit(this.options.event+be,ne),this.manager.emit(this.options.event,ne)}});function $o(){ra.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}Kt($o,ra,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[bi]},process:function(ne){var be=this.options,Qe=ne.pointers.length===be.pointers,Rt=ne.distance<be.threshold,kr=ne.deltaTime<be.time;if(this.reset(),ne.eventType&aa&&this.count===0)return this.failTimeout();if(Rt&&kr&&Qe){if(ne.eventType!=Ai)return this.failTimeout();var lt=this.pTime?ne.timeStamp-this.pTime<be.interval:!0,It=!this.pCenter||rn(this.pCenter,ne.center)<be.posThreshold;this.pTime=ne.timeStamp,this.pCenter=ne.center,!It||!lt?this.count=1:this.count+=1,this._input=ne;var uo=this.count%be.taps;if(uo===0)return this.hasRequireFailures()?(this._timer=bt(function(){this.state=Pa,this.tryEmit()},be.interval,this),Za):Pa}return ps},failTimeout:function(){return this._timer=bt(function(){this.state=ps},this.options.interval,this),ps},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Pa&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function xa(ne,be){return be=be||{},be.recognizers=dt(be.recognizers,xa.defaults.preset),new so(ne,be)}xa.VERSION="2.0.7",xa.defaults={domEvents:!1,touchAction:Ti,enable:!0,inputTarget:null,inputClass:null,preset:[[Vu,{enable:!1}],[qo,{enable:!1},["rotate"]],[Co,{direction:ji}],[$i,{direction:ji},["swipe"]],[$o],[$o,{event:"doubletap",taps:2},["tap"]],[Ko]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var _o=1,Jo=2;function so(ne,be){this.options=ct({},xa.defaults,be||{}),this.options.inputTarget=this.options.inputTarget||ne,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=ne,this.input=fs(this),this.touchAction=new Fa(this,this.options.touchAction),ou(this,!0),At(this.options.recognizers,function(Qe){var Rt=this.add(new Qe[0](Qe[1]));Qe[2]&&Rt.recognizeWith(Qe[2]),Qe[3]&&Rt.requireFailure(Qe[3])},this)}so.prototype={set:function(ne){return ct(this.options,ne),ne.touchAction&&this.touchAction.update(),ne.inputTarget&&(this.input.destroy(),this.input.target=ne.inputTarget,this.input.init()),this},stop:function(ne){this.session.stopped=ne?Jo:_o},recognize:function(ne){var be=this.session;if(!be.stopped){this.touchAction.preventDefaults(ne);var Qe,Rt=this.recognizers,kr=be.curRecognizer;(!kr||kr&&kr.state&Pa)&&(kr=be.curRecognizer=null);for(var lt=0;lt<Rt.length;)Qe=Rt[lt],be.stopped!==Jo&&(!kr||Qe==kr||Qe.canRecognizeWith(kr))?Qe.recognize(ne):Qe.reset(),!kr&&Qe.state&(Za|au|Ma)&&(kr=be.curRecognizer=Qe),lt++}},get:function(ne){if(ne instanceof ra)return ne;for(var be=this.recognizers,Qe=0;Qe<be.length;Qe++)if(be[Qe].options.event==ne)return be[Qe];return null},add:function(ne){if(qt(ne,"add",this))return this;var be=this.get(ne.options.event);return be&&this.remove(be),this.recognizers.push(ne),ne.manager=this,this.touchAction.update(),ne},remove:function(ne){if(qt(ne,"remove",this))return this;if(ne=this.get(ne),ne){var be=this.recognizers,Qe=Te(be,ne);Qe!==-1&&(be.splice(Qe,1),this.touchAction.update())}return this},on:function(ne,be){if(ne!==B&&be!==B){var Qe=this.handlers;return At(Wr(ne),function(Rt){Qe[Rt]=Qe[Rt]||[],Qe[Rt].push(be)}),this}},off:function(ne,be){if(ne!==B){var Qe=this.handlers;return At(Wr(ne),function(Rt){be?Qe[Rt]&&Qe[Rt].splice(Te(Qe[Rt],be),1):delete Qe[Rt]}),this}},emit:function(ne,be){this.options.domEvents&&xc(ne,be);var Qe=this.handlers[ne]&&this.handlers[ne].slice();if(!(!Qe||!Qe.length)){be.type=ne,be.preventDefault=function(){be.srcEvent.preventDefault()};for(var Rt=0;Rt<Qe.length;)Qe[Rt](be),Rt++}},destroy:function(){this.element&&ou(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function ou(ne,be){var Qe=ne.element;if(!!Qe.style){var Rt;At(ne.options.cssProps,function(kr,lt){Rt=wt(Qe.style,lt),be?(ne.oldCssProps[Rt]=Qe.style[Rt],Qe.style[Rt]=kr):Qe.style[Rt]=ne.oldCssProps[Rt]||""}),be||(ne.oldCssProps={})}}function xc(ne,be){if(!Ee){var Qe=v.createEvent("Event");Qe.initEvent(ne,!0,!0),Qe.gesture=be,be.target.dispatchEvent(Qe)}}if(!Ee){ct(xa,{INPUT_START:aa,INPUT_MOVE:Di,INPUT_END:Ai,INPUT_CANCEL:Vi,STATE_POSSIBLE:Gi,STATE_BEGAN:Za,STATE_CHANGED:au,STATE_ENDED:Ma,STATE_RECOGNIZED:Pa,STATE_CANCELLED:Es,STATE_FAILED:ps,DIRECTION_NONE:la,DIRECTION_LEFT:wi,DIRECTION_RIGHT:Sa,DIRECTION_UP:Mn,DIRECTION_DOWN:Si,DIRECTION_HORIZONTAL:ji,DIRECTION_VERTICAL:Ki,DIRECTION_ALL:Wa,Manager:so,Input:Xa,TouchAction:Fa,TouchInput:zt,MouseInput:Ta,PointerEventInput:Oe,TouchMouseInput:Tt,SingleTouchInput:Fe,Recognizer:ra,AttrRecognizer:oo,Tap:$o,Pan:$i,Swipe:Co,Pinch:qo,Rotate:Vu,Press:Ko,on:$e,off:kt,each:At,merge:X,extend:Qt,assign:ct,inherit:Kt,bindFn:vt,prefixed:wt});var Ds=typeof window!="undefined"?window:typeof self!="undefined"?self:{};Ds.Hammer=xa,Y=function(){return xa}.call(H,R,H,Ze),Y!==B&&(Ze.exports=Y)}})(typeof window!="undefined"?window:{console:null,MSPointerEvent:null,PointerEvent:null,CSS:null},document,"Hammer")},88307:function(Ze,H,R){(function(Y,J){Ze.exports=J(R(18857))})(this,function(Y){"use strict";var J=function(z){return z instanceof Uint8Array||z instanceof Uint16Array||z instanceof Uint32Array||z instanceof Int8Array||z instanceof Int16Array||z instanceof Int32Array||z instanceof Float32Array||z instanceof Float64Array||z instanceof Uint8ClampedArray},v=function(z,me){for(var ze=Object.keys(me),Ft=0;Ft<ze.length;++Ft)z[ze[Ft]]=me[ze[Ft]];return z},te=`
`;function B(z){return typeof atob!="undefined"?atob(z):"base64:"+z}function Q(z){var me=new Error("(regl) "+z);throw console.error(me),me}function ie(z,me){z||Q(me)}function Ee(z){return z?": "+z:""}function re(z,me,ze){z in me||Q("unknown parameter ("+z+")"+Ee(ze)+". possible values: "+Object.keys(me).join())}function Ge(z,me){J(z)||Q("invalid parameter type"+Ee(me)+". must be a typed array")}function Ce(z,me){switch(me){case"number":return typeof z=="number";case"object":return typeof z=="object";case"string":return typeof z=="string";case"boolean":return typeof z=="boolean";case"function":return typeof z=="function";case"undefined":return typeof z=="undefined";case"symbol":return typeof z=="symbol"}}function tt(z,me,ze){Ce(z,me)||Q("invalid parameter type"+Ee(ze)+". expected "+me+", got "+typeof z)}function Mt(z,me){z>=0&&(z|0)===z||Q("invalid parameter type, ("+z+")"+Ee(me)+". must be a nonnegative integer")}function ir(z,me,ze){me.indexOf(z)<0&&Q("invalid value"+Ee(ze)+". must be one of: "+me)}var bt=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function qt(z){Object.keys(z).forEach(function(me){bt.indexOf(me)<0&&Q('invalid regl constructor argument "'+me+'". must be one of '+bt)})}function At(z,me){for(z=z+"";z.length<me;)z=" "+z;return z}function ot(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function ct(z,me){this.number=z,this.line=me,this.errors=[]}function Qt(z,me,ze){this.file=z,this.line=me,this.message=ze}function X(){var z=new Error,me=(z.stack||z).toString(),ze=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(me);if(ze)return ze[1];var Ft=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(me);return Ft?Ft[1]:"unknown"}function Kt(){var z=new Error,me=(z.stack||z).toString(),ze=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(me);if(ze)return ze[1];var Ft=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(me);return Ft?Ft[1]:"unknown"}function vt(z,me){var ze=z.split(`
`),Ft=1,lr=0,Lt={unknown:new ot,0:new ot};Lt.unknown.name=Lt[0].name=me||X(),Lt.unknown.lines.push(new ct(0,""));for(var er=0;er<ze.length;++er){var fr=ze[er],_r=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(fr);if(_r)switch(_r[1]){case"line":var rr=/(\d+)(\s+\d+)?/.exec(_r[2]);rr&&(Ft=rr[1]|0,rr[2]&&(lr=rr[2]|0,lr in Lt||(Lt[lr]=new ot)));break;case"define":var Sr=/SHADER_NAME(_B64)?\s+(.*)$/.exec(_r[2]);Sr&&(Lt[lr].name=Sr[1]?B(Sr[2]):Sr[2]);break}Lt[lr].lines.push(new ct(Ft++,fr))}return Object.keys(Lt).forEach(function(Rr){var jr=Lt[Rr];jr.lines.forEach(function(Er){jr.index[Er.number]=Er})}),Lt}function qe(z){var me=[];return z.split(`
`).forEach(function(ze){if(!(ze.length<5)){var Ft=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(ze);Ft?me.push(new Qt(Ft[1]|0,Ft[2]|0,Ft[3].trim())):ze.length>0&&me.push(new Qt("unknown",0,ze))}}),me}function dt(z,me){me.forEach(function(ze){var Ft=z[ze.file];if(Ft){var lr=Ft.index[ze.line];if(lr){lr.errors.push(ze),Ft.hasErrors=!0;return}}z.unknown.hasErrors=!0,z.unknown.lines[0].errors.push(ze)})}function $e(z,me,ze,Ft,lr){if(!z.getShaderParameter(me,z.COMPILE_STATUS)){var Lt=z.getShaderInfoLog(me),er=Ft===z.FRAGMENT_SHADER?"fragment":"vertex";De(ze,"string",er+" shader source must be a string",lr);var fr=vt(ze,lr),_r=qe(Lt);dt(fr,_r),Object.keys(fr).forEach(function(rr){var Sr=fr[rr];if(!Sr.hasErrors)return;var Rr=[""],jr=[""];function Er(Mr,ut){Rr.push(Mr),jr.push(ut||"")}Er("file number "+rr+": "+Sr.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),Sr.lines.forEach(function(Mr){if(Mr.errors.length>0){Er(At(Mr.number,4)+"|  ","background-color:yellow; font-weight:bold"),Er(Mr.line+te,"color:red; background-color:yellow; font-weight:bold");var ut=0;Mr.errors.forEach(function(Xt){var br=Xt.message,zr=/^\s*'(.*)'\s*:\s*(.*)$/.exec(br);if(zr){var hr=zr[1];switch(br=zr[2],hr){case"assign":hr="=";break}ut=Math.max(Mr.line.indexOf(hr,ut),0)}else ut=0;Er(At("| ",6)),Er(At("^^^",ut+3)+te,"font-weight:bold"),Er(At("| ",6)),Er(br+te,"font-weight:bold")}),Er(At("| ",6)+te)}else Er(At(Mr.number,4)+"|  "),Er(Mr.line+te,"color:red")}),typeof document!="undefined"&&!window.chrome?(jr[0]=Rr.join("%c"),console.log.apply(console,jr)):console.log(Rr.join(""))}),ie.raise("Error compiling "+er+" shader, "+fr[0].name)}}function kt(z,me,ze,Ft,lr){if(!z.getProgramParameter(me,z.LINK_STATUS)){var Lt=z.getProgramInfoLog(me),er=vt(ze,lr),fr=vt(Ft,lr),_r='Error linking program with vertex shader, "'+fr[0].name+'", and fragment shader "'+er[0].name+'"';typeof document!="undefined"?console.log("%c"+_r+te+"%c"+Lt,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(_r+te+Lt),ie.raise(_r)}}function yr(z){z._commandRef=X()}function Pr(z,me,ze,Ft){yr(z);function lr(_r){return _r?Ft.id(_r):0}z._fragId=lr(z.static.frag),z._vertId=lr(z.static.vert);function Lt(_r,rr){Object.keys(rr).forEach(function(Sr){_r[Ft.id(Sr)]=!0})}var er=z._uniformSet={};Lt(er,me.static),Lt(er,me.dynamic);var fr=z._attributeSet={};Lt(fr,ze.static),Lt(fr,ze.dynamic),z._hasCount="count"in z.static||"count"in z.dynamic||"elements"in z.static||"elements"in z.dynamic}function Wr(z,me){var ze=Kt();Q(z+" in command "+(me||X())+(ze==="unknown"?"":" called from "+ze))}function Te(z,me,ze){z||Wr(me,ze||X())}function Ye(z,me,ze,Ft){z in me||Wr("unknown parameter ("+z+")"+Ee(ze)+". possible values: "+Object.keys(me).join(),Ft||X())}function De(z,me,ze,Ft){Ce(z,me)||Wr("invalid parameter type"+Ee(ze)+". expected "+me+", got "+typeof z,Ft||X())}function wt(z){z()}function gt(z,me,ze){z.texture?ir(z.texture._texture.internalformat,me,"unsupported texture format for attachment"):ir(z.renderbuffer._renderbuffer.format,ze,"unsupported renderbuffer format for attachment")}var Ut=33071,Jt=9728,Cr=9984,Yn=9985,hn=9986,qi=9987,jn=5120,Xn=5121,vi=5122,qn=5123,li=5124,aa=5125,Di=5126,Ai=32819,Vi=32820,la=33635,wi=34042,Sa=36193,Mn={};Mn[jn]=Mn[Xn]=1,Mn[vi]=Mn[qn]=Mn[Sa]=Mn[la]=Mn[Ai]=Mn[Vi]=2,Mn[li]=Mn[aa]=Mn[Di]=Mn[wi]=4;function Si(z,me){return z===Vi||z===Ai||z===la?2:z===wi?4:Mn[z]*me}function ji(z){return!(z&z-1)&&!!z}function Ki(z,me,ze){var Ft,lr=me.width,Lt=me.height,er=me.channels;ie(lr>0&&lr<=ze.maxTextureSize&&Lt>0&&Lt<=ze.maxTextureSize,"invalid texture shape"),(z.wrapS!==Ut||z.wrapT!==Ut)&&ie(ji(lr)&&ji(Lt),"incompatible wrap mode for texture, both width and height must be power of 2"),me.mipmask===1?lr!==1&&Lt!==1&&ie(z.minFilter!==Cr&&z.minFilter!==hn&&z.minFilter!==Yn&&z.minFilter!==qi,"min filter requires mipmap"):(ie(ji(lr)&&ji(Lt),"texture must be a square power of 2 to support mipmapping"),ie(me.mipmask===(lr<<1)-1,"missing or incomplete mipmap data")),me.type===Di&&(ze.extensions.indexOf("oes_texture_float_linear")<0&&ie(z.minFilter===Jt&&z.magFilter===Jt,"filter not supported, must enable oes_texture_float_linear"),ie(!z.genMipmaps,"mipmap generation not supported with float textures"));var fr=me.images;for(Ft=0;Ft<16;++Ft)if(fr[Ft]){var _r=lr>>Ft,rr=Lt>>Ft;ie(me.mipmask&1<<Ft,"missing mipmap data");var Sr=fr[Ft];if(ie(Sr.width===_r&&Sr.height===rr,"invalid shape for mip images"),ie(Sr.format===me.format&&Sr.internalformat===me.internalformat&&Sr.type===me.type,"incompatible type for mip image"),!Sr.compressed)if(Sr.data){var Rr=Math.ceil(Si(Sr.type,er)*_r/Sr.unpackAlignment)*Sr.unpackAlignment;ie(Sr.data.byteLength===Rr*rr,"invalid data for image, buffer size is inconsistent with image format")}else Sr.element||Sr.copy}else z.genMipmaps||ie((me.mipmask&1<<Ft)==0,"extra mipmap data");me.compressed&&ie(!z.genMipmaps,"mipmap generation for compressed images not supported")}function Wa(z,me,ze,Ft){var lr=z.width,Lt=z.height,er=z.channels;ie(lr>0&&lr<=Ft.maxTextureSize&&Lt>0&&Lt<=Ft.maxTextureSize,"invalid texture shape"),ie(lr===Lt,"cube map must be square"),ie(me.wrapS===Ut&&me.wrapT===Ut,"wrap mode not supported by cube map");for(var fr=0;fr<ze.length;++fr){var _r=ze[fr];ie(_r.width===lr&&_r.height===Lt,"inconsistent cube map face shape"),me.genMipmaps&&(ie(!_r.compressed,"can not generate mipmap for compressed textures"),ie(_r.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var rr=_r.images,Sr=0;Sr<16;++Sr){var Rr=rr[Sr];if(Rr){var jr=lr>>Sr,Er=Lt>>Sr;ie(_r.mipmask&1<<Sr,"missing mipmap data"),ie(Rr.width===jr&&Rr.height===Er,"invalid shape for mip images"),ie(Rr.format===z.format&&Rr.internalformat===z.internalformat&&Rr.type===z.type,"incompatible type for mip image"),Rr.compressed||(Rr.data?ie(Rr.data.byteLength===jr*Er*Math.max(Si(Rr.type,er),Rr.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):Rr.element||Rr.copy)}}}}var ve=v(ie,{optional:wt,raise:Q,commandRaise:Wr,command:Te,parameter:re,commandParameter:Ye,constructor:qt,type:tt,commandType:De,isTypedArray:Ge,nni:Mt,oneOf:ir,shaderError:$e,linkError:kt,callSite:Kt,saveCommandRef:yr,saveDrawInfo:Pr,framebufferFormat:gt,guessCommand:X,texture2D:Ki,textureCube:Wa}),Fn=0,Xa=0,fs=5,jt=6;function sr(z,me){this.id=Fn++,this.type=z,this.data=me}function Tr(z){return z.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function I(z){if(z.length===0)return[];var me=z.charAt(0),ze=z.charAt(z.length-1);if(z.length>1&&me===ze&&(me==='"'||me==="'"))return['"'+Tr(z.substr(1,z.length-2))+'"'];var Ft=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(z);if(Ft)return I(z.substr(0,Ft.index)).concat(I(Ft[1])).concat(I(z.substr(Ft.index+Ft[0].length)));var lr=z.split(".");if(lr.length===1)return['"'+Tr(z)+'"'];for(var Lt=[],er=0;er<lr.length;++er)Lt=Lt.concat(I(lr[er]));return Lt}function ur(z){return"["+I(z).join("][")+"]"}function Ln(z,me){return new sr(z,ur(me+""))}function ci(z){return typeof z=="function"&&!z._reglType||z instanceof sr}function Gn(z,me){if(typeof z=="function")return new sr(Xa,z);if(typeof z=="number"||typeof z=="boolean")return new sr(fs,z);if(Array.isArray(z))return new sr(jt,z.map(function(ze,Ft){return Gn(ze,me+"["+Ft+"]")}));if(z instanceof sr)return z;ve(!1,"invalid option type in uniform "+me)}var rn={DynamicVariable:sr,define:Ln,isDynamic:ci,unbox:Gn,accessor:ur},Pi={next:typeof requestAnimationFrame=="function"?function(z){return requestAnimationFrame(z)}:function(z){return setTimeout(z,16)},cancel:typeof cancelAnimationFrame=="function"?function(z){return cancelAnimationFrame(z)}:clearTimeout},Ii=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",Ja=Ii?function(){return+new Date}:typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function hs(){var z={"":0},me=[""];return{id:function(ze){var Ft=z[ze];return Ft||(Ft=z[ze]=me.length,me.push(ze),Ft)},str:function(ze){return me[ze]}}}function _a(z,me,ze){var Ft=document.createElement("canvas");v(Ft.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),z.appendChild(Ft),z===document.body&&(Ft.style.position="absolute",v(z.style,{margin:0,padding:0}));function lr(){var fr=window.innerWidth,_r=window.innerHeight;if(z!==document.body){var rr=Ft.getBoundingClientRect();fr=rr.right-rr.left,_r=rr.bottom-rr.top}Ft.width=ze*fr,Ft.height=ze*_r}var Lt;z!==document.body&&typeof ResizeObserver=="function"?(Lt=new ResizeObserver(function(){setTimeout(lr)}),Lt.observe(z)):window.addEventListener("resize",lr,!1);function er(){Lt?Lt.disconnect():window.removeEventListener("resize",lr),z.removeChild(Ft)}return lr(),{canvas:Ft,onDestroy:er}}function Da(z,me){function ze(Ft){try{return z.getContext(Ft,me)}catch(lr){return null}}return ze("webgl")||ze("experimental-webgl")||ze("webgl-experimental")}function Ta(z){return typeof z.nodeName=="string"&&typeof z.appendChild=="function"&&typeof z.getBoundingClientRect=="function"}function V(z){return typeof z.drawArrays=="function"||typeof z.drawElements=="function"}function $(z){return typeof z=="string"?z.split():(ve(Array.isArray(z),"invalid extension array"),z)}function se(z){return typeof z=="string"?(ve(typeof document!="undefined","not supported outside of DOM"),document.querySelector(z)):z}function ge(z){var me=z||{},ze,Ft,lr,Lt,er={},fr=[],_r=[],rr=typeof window=="undefined"?1:window.devicePixelRatio,Sr=!1,Rr=function(Mr){Mr&&ve.raise(Mr)},jr=function(){};if(typeof me=="string"?(ve(typeof document!="undefined","selector queries only supported in DOM environments"),ze=document.querySelector(me),ve(ze,"invalid query string for element")):typeof me=="object"?Ta(me)?ze=me:V(me)?(Lt=me,lr=Lt.canvas):(ve.constructor(me),"gl"in me?Lt=me.gl:"canvas"in me?lr=se(me.canvas):"container"in me&&(Ft=se(me.container)),"attributes"in me&&(er=me.attributes,ve.type(er,"object","invalid context attributes")),"extensions"in me&&(fr=$(me.extensions)),"optionalExtensions"in me&&(_r=$(me.optionalExtensions)),"onDone"in me&&(ve.type(me.onDone,"function","invalid or missing onDone callback"),Rr=me.onDone),"profile"in me&&(Sr=!!me.profile),"pixelRatio"in me&&(rr=+me.pixelRatio,ve(rr>0,"invalid pixel ratio"))):ve.raise("invalid arguments to regl"),ze&&(ze.nodeName.toLowerCase()==="canvas"?lr=ze:Ft=ze),!Lt){if(!lr){ve(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var Er=_a(Ft||document.body,Rr,rr);if(!Er)return null;lr=Er.canvas,jr=Er.onDestroy}er.premultipliedAlpha===void 0&&(er.premultipliedAlpha=!0),Lt=Da(lr,er)}return Lt?{gl:Lt,canvas:lr,container:Ft,extensions:fr,optionalExtensions:_r,pixelRatio:rr,profile:Sr,onDone:Rr,onDestroy:jr}:(jr(),Rr("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Oe(z,me){var ze={};function Ft(fr){ve.type(fr,"string","extension name must be string");var _r=fr.toLowerCase(),rr;try{rr=ze[_r]=lr(fr)}catch(Sr){}return!!rr}function lr(fr){return z.getExtension(fr)?z.getExtension(fr):z.getExtension(fr.toLowerCase())?z.getExtension(fr.toLowerCase()):null}for(var Lt=0;Lt<me.extensions.length;++Lt){var er=me.extensions[Lt];if(!Ft(er))return me.onDestroy(),me.onDone('"'+er+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return me.optionalExtensions.forEach(Ft),{extensions:ze,restore:function(){Object.keys(ze).forEach(function(fr){if(ze[fr]&&!Ft(fr))throw new Error("(regl): error restoring extension "+fr)})}}}function We(z,me){for(var ze=Array(z),Ft=0;Ft<z;++Ft)ze[Ft]=me(Ft);return ze}var nt=5120,pe=5121,Fe=5122,yt=5123,dr=5124,Dt=5125,zt=5126;function gr(z){for(var me=16;me<=1<<28;me*=16)if(z<=me)return me;return 0}function En(z){var me,ze;return me=(z>65535)<<4,z>>>=me,ze=(z>255)<<3,z>>>=ze,me|=ze,ze=(z>15)<<2,z>>>=ze,me|=ze,ze=(z>3)<<1,z>>>=ze,me|=ze,me|z>>1}function un(){var z=We(8,function(){return[]});function me(Lt){var er=gr(Lt),fr=z[En(er)>>2];return fr.length>0?fr.pop():new ArrayBuffer(er)}function ze(Lt){z[En(Lt.byteLength)>>2].push(Lt)}function Ft(Lt,er){var fr=null;switch(Lt){case nt:fr=new Int8Array(me(er),0,er);break;case pe:fr=new Uint8Array(me(er),0,er);break;case Fe:fr=new Int16Array(me(2*er),0,er);break;case yt:fr=new Uint16Array(me(2*er),0,er);break;case dr:fr=new Int32Array(me(4*er),0,er);break;case Dt:fr=new Uint32Array(me(4*er),0,er);break;case zt:fr=new Float32Array(me(4*er),0,er);break;default:return null}return fr.length!==er?fr.subarray(0,er):fr}function lr(Lt){ze(Lt.buffer)}return{alloc:me,free:ze,allocType:Ft,freeType:lr}}var Tt=un();Tt.zero=un();var nn=3408,Zr=3410,Yr=3411,oi=3412,Qr=3413,Ti=3414,ea=3415,bi=33901,Oi=33902,Ci=3379,ti=3386,Xi=34921,Fa=36347,oa=36348,Ri=35661,Gi=35660,Za=34930,au=36349,Ma=34076,Pa=34024,Es=7936,ps=7937,ra=7938,ju=35724,yo=34047,ja=36063,oo=34852,$i=3553,qo=34067,Ko=34069,Vu=33984,Co=6408,$o=5126,xa=5121,_o=36160,Jo=36053,so=36064,ou=16384,xc=function(z,me){var ze=1;me.ext_texture_filter_anisotropic&&(ze=z.getParameter(yo));var Ft=1,lr=1;me.webgl_draw_buffers&&(Ft=z.getParameter(oo),lr=z.getParameter(ja));var Lt=!!me.oes_texture_float;if(Lt){var er=z.createTexture();z.bindTexture($i,er),z.texImage2D($i,0,Co,1,1,0,Co,$o,null);var fr=z.createFramebuffer();if(z.bindFramebuffer(_o,fr),z.framebufferTexture2D(_o,so,$i,er,0),z.bindTexture($i,null),z.checkFramebufferStatus(_o)!==Jo)Lt=!1;else{z.viewport(0,0,1,1),z.clearColor(1,0,0,1),z.clear(ou);var _r=Tt.allocType($o,4);z.readPixels(0,0,1,1,Co,$o,_r),z.getError()?Lt=!1:(z.deleteFramebuffer(fr),z.deleteTexture(er),Lt=_r[0]===1),Tt.freeType(_r)}}var rr=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),Sr=!0;if(!rr){var Rr=z.createTexture(),jr=Tt.allocType(xa,36);z.activeTexture(Vu),z.bindTexture(qo,Rr),z.texImage2D(Ko,0,Co,3,3,0,Co,xa,jr),Tt.freeType(jr),z.bindTexture(qo,null),z.deleteTexture(Rr),Sr=!z.getError()}return{colorBits:[z.getParameter(Zr),z.getParameter(Yr),z.getParameter(oi),z.getParameter(Qr)],depthBits:z.getParameter(Ti),stencilBits:z.getParameter(ea),subpixelBits:z.getParameter(nn),extensions:Object.keys(me).filter(function(Er){return!!me[Er]}),maxAnisotropic:ze,maxDrawbuffers:Ft,maxColorAttachments:lr,pointSizeDims:z.getParameter(bi),lineWidthDims:z.getParameter(Oi),maxViewportDims:z.getParameter(ti),maxCombinedTextureUnits:z.getParameter(Ri),maxCubeMapSize:z.getParameter(Ma),maxRenderbufferSize:z.getParameter(Pa),maxTextureUnits:z.getParameter(Za),maxTextureSize:z.getParameter(Ci),maxAttributes:z.getParameter(Xi),maxVertexUniforms:z.getParameter(Fa),maxVertexTextureUnits:z.getParameter(Gi),maxVaryingVectors:z.getParameter(oa),maxFragmentUniforms:z.getParameter(au),glsl:z.getParameter(ju),renderer:z.getParameter(ps),vendor:z.getParameter(Es),version:z.getParameter(ra),readFloat:Lt,npotTextureCube:Sr}};function Ds(z){return!!z&&typeof z=="object"&&Array.isArray(z.shape)&&Array.isArray(z.stride)&&typeof z.offset=="number"&&z.shape.length===z.stride.length&&(Array.isArray(z.data)||J(z.data))}var ne=function(z){return Object.keys(z).map(function(me){return z[me]})},be={shape:uo,flatten:It};function Qe(z,me,ze){for(var Ft=0;Ft<me;++Ft)ze[Ft]=z[Ft]}function Rt(z,me,ze,Ft){for(var lr=0,Lt=0;Lt<me;++Lt)for(var er=z[Lt],fr=0;fr<ze;++fr)Ft[lr++]=er[fr]}function kr(z,me,ze,Ft,lr,Lt){for(var er=Lt,fr=0;fr<me;++fr)for(var _r=z[fr],rr=0;rr<ze;++rr)for(var Sr=_r[rr],Rr=0;Rr<Ft;++Rr)lr[er++]=Sr[Rr]}function lt(z,me,ze,Ft,lr){for(var Lt=1,er=ze+1;er<me.length;++er)Lt*=me[er];var fr=me[ze];if(me.length-ze==4){var _r=me[ze+1],rr=me[ze+2],Sr=me[ze+3];for(er=0;er<fr;++er)kr(z[er],_r,rr,Sr,Ft,lr),lr+=Lt}else for(er=0;er<fr;++er)lt(z[er],me,ze+1,Ft,lr),lr+=Lt}function It(z,me,ze,Ft){var lr=1;if(me.length)for(var Lt=0;Lt<me.length;++Lt)lr*=me[Lt];else lr=0;var er=Ft||Tt.allocType(ze,lr);switch(me.length){case 0:break;case 1:Qe(z,me[0],er);break;case 2:Rt(z,me[0],me[1],er);break;case 3:kr(z,me[0],me[1],me[2],er,0);break;default:lt(z,me,0,er,0)}return er}function uo(z){for(var me=[],ze=z;ze.length;ze=ze[0])me.push(ze.length);return me}var Ji={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Ya=5120,Qo=5122,pn=5124,cn=5121,Yt=5123,Zo=5125,xe=5126,Ks=5126,su={int8:Ya,int16:Qo,int32:pn,uint8:cn,uint16:Yt,uint32:Zo,float:xe,float32:Ks},ds=35048,sa=35040,xo={dynamic:ds,stream:sa,static:35044},Wl=be.flatten,bc=be.shape,Gu=35044,Ec=35040,Tl=5121,Hu=5126,uu=[];uu[5120]=1,uu[5122]=2,uu[5124]=4,uu[5121]=1,uu[5123]=2,uu[5125]=4,uu[5126]=4;function Wu(z){return Ji[Object.prototype.toString.call(z)]|0}function _(z,me){for(var ze=0;ze<me.length;++ze)z[ze]=me[ze]}function w(z,me,ze,Ft,lr,Lt,er){for(var fr=0,_r=0;_r<ze;++_r)for(var rr=0;rr<Ft;++rr)z[fr++]=me[lr*_r+Lt*rr+er]}function N(z,me,ze,Ft){var lr=0,Lt={};function er(ut){this.id=lr++,this.buffer=z.createBuffer(),this.type=ut,this.usage=Gu,this.byteLength=0,this.dimension=1,this.dtype=Tl,this.persistentData=null,ze.profile&&(this.stats={size:0})}er.prototype.bind=function(){z.bindBuffer(this.type,this.buffer)},er.prototype.destroy=function(){jr(this)};var fr=[];function _r(ut,Xt){var br=fr.pop();return br||(br=new er(ut)),br.bind(),Rr(br,Xt,Ec,0,1,!1),br}function rr(ut){fr.push(ut)}function Sr(ut,Xt,br){ut.byteLength=Xt.byteLength,z.bufferData(ut.type,Xt,br)}function Rr(ut,Xt,br,zr,hr,Ar){var Vr;if(ut.usage=br,Array.isArray(Xt)){if(ut.dtype=zr||Hu,Xt.length>0){var On;if(Array.isArray(Xt[0])){Vr=bc(Xt);for(var tr=1,ar=1;ar<Vr.length;++ar)tr*=Vr[ar];ut.dimension=tr,On=Wl(Xt,Vr,ut.dtype),Sr(ut,On,br),Ar?ut.persistentData=On:Tt.freeType(On)}else if(typeof Xt[0]=="number"){ut.dimension=hr;var _n=Tt.allocType(ut.dtype,Xt.length);_(_n,Xt),Sr(ut,_n,br),Ar?ut.persistentData=_n:Tt.freeType(_n)}else J(Xt[0])?(ut.dimension=Xt[0].length,ut.dtype=zr||Wu(Xt[0])||Hu,On=Wl(Xt,[Xt.length,Xt[0].length],ut.dtype),Sr(ut,On,br),Ar?ut.persistentData=On:Tt.freeType(On)):ve.raise("invalid buffer data")}}else if(J(Xt))ut.dtype=zr||Wu(Xt),ut.dimension=hr,Sr(ut,Xt,br),Ar&&(ut.persistentData=new Uint8Array(new Uint8Array(Xt.buffer)));else if(Ds(Xt)){Vr=Xt.shape;var Gr=Xt.stride,wr=Xt.offset,$r=0,Jr=0,yi=0,ai=0;Vr.length===1?($r=Vr[0],Jr=1,yi=Gr[0],ai=0):Vr.length===2?($r=Vr[0],Jr=Vr[1],yi=Gr[0],ai=Gr[1]):ve.raise("invalid shape"),ut.dtype=zr||Wu(Xt.data)||Hu,ut.dimension=Jr;var qr=Tt.allocType(ut.dtype,$r*Jr);w(qr,Xt.data,$r,Jr,yi,ai,wr),Sr(ut,qr,br),Ar?ut.persistentData=qr:Tt.freeType(qr)}else Xt instanceof ArrayBuffer?(ut.dtype=Tl,ut.dimension=hr,Sr(ut,Xt,br),Ar&&(ut.persistentData=new Uint8Array(new Uint8Array(Xt)))):ve.raise("invalid buffer data")}function jr(ut){me.bufferCount--,Ft(ut);var Xt=ut.buffer;ve(Xt,"buffer must not be deleted already"),z.deleteBuffer(Xt),ut.buffer=null,delete Lt[ut.id]}function Er(ut,Xt,br,zr){me.bufferCount++;var hr=new er(Xt);Lt[hr.id]=hr;function Ar(tr){var ar=Gu,_n=null,Gr=0,wr=0,$r=1;return Array.isArray(tr)||J(tr)||Ds(tr)||tr instanceof ArrayBuffer?_n=tr:typeof tr=="number"?Gr=tr|0:tr&&(ve.type(tr,"object","buffer arguments must be an object, a number or an array"),"data"in tr&&(ve(_n===null||Array.isArray(_n)||J(_n)||Ds(_n),"invalid data for buffer"),_n=tr.data),"usage"in tr&&(ve.parameter(tr.usage,xo,"invalid buffer usage"),ar=xo[tr.usage]),"type"in tr&&(ve.parameter(tr.type,su,"invalid buffer type"),wr=su[tr.type]),"dimension"in tr&&(ve.type(tr.dimension,"number","invalid dimension"),$r=tr.dimension|0),"length"in tr&&(ve.nni(Gr,"buffer length must be a nonnegative integer"),Gr=tr.length|0)),hr.bind(),_n?Rr(hr,_n,ar,wr,$r,zr):(Gr&&z.bufferData(hr.type,Gr,ar),hr.dtype=wr||Tl,hr.usage=ar,hr.dimension=$r,hr.byteLength=Gr),ze.profile&&(hr.stats.size=hr.byteLength*uu[hr.dtype]),Ar}function Vr(tr,ar){ve(ar+tr.byteLength<=hr.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+tr.byteLength+" starting from offset "+ar+" to a buffer of size "+hr.byteLength),z.bufferSubData(hr.type,ar,tr)}function On(tr,ar){var _n=(ar||0)|0,Gr;if(hr.bind(),J(tr)||tr instanceof ArrayBuffer)Vr(tr,_n);else if(Array.isArray(tr)){if(tr.length>0)if(typeof tr[0]=="number"){var wr=Tt.allocType(hr.dtype,tr.length);_(wr,tr),Vr(wr,_n),Tt.freeType(wr)}else if(Array.isArray(tr[0])||J(tr[0])){Gr=bc(tr);var $r=Wl(tr,Gr,hr.dtype);Vr($r,_n),Tt.freeType($r)}else ve.raise("invalid buffer data")}else if(Ds(tr)){Gr=tr.shape;var Jr=tr.stride,yi=0,ai=0,qr=0,en=0;Gr.length===1?(yi=Gr[0],ai=1,qr=Jr[0],en=0):Gr.length===2?(yi=Gr[0],ai=Gr[1],qr=Jr[0],en=Jr[1]):ve.raise("invalid shape");var $n=Array.isArray(tr.data)?hr.dtype:Wu(tr.data),pi=Tt.allocType($n,yi*ai);w(pi,tr.data,yi,ai,qr,en,tr.offset),Vr(pi,_n),Tt.freeType(pi)}else ve.raise("invalid data for buffer subdata");return Ar}return br||Ar(ut),Ar._reglType="buffer",Ar._buffer=hr,Ar.subdata=On,ze.profile&&(Ar.stats=hr.stats),Ar.destroy=function(){jr(hr)},Ar}function Mr(){ne(Lt).forEach(function(ut){ut.buffer=z.createBuffer(),z.bindBuffer(ut.type,ut.buffer),z.bufferData(ut.type,ut.persistentData||ut.byteLength,ut.usage)})}return ze.profile&&(me.getTotalBufferSize=function(){var ut=0;return Object.keys(Lt).forEach(function(Xt){ut+=Lt[Xt].stats.size}),ut}),{create:Er,createStream:_r,destroyStream:rr,clear:function(){ne(Lt).forEach(jr),fr.forEach(jr)},getBuffer:function(ut){return ut&&ut._buffer instanceof er?ut._buffer:null},restore:Mr,_initBuffer:Rr}}var O=0,K=0,_e=1,Xe=1,ft=4,mt=4,cr={points:O,point:K,lines:_e,line:Xe,triangles:ft,triangle:mt,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},xr=0,Pn=1,fi=4,Qn=5120,Yi=5121,da=5122,Ra=5123,Hi=5124,Lo=5125,Ss=34963,hl=35040,Gc=35044;function Xu(z,me,ze,Ft){var lr={},Lt=0,er={uint8:Yi,uint16:Ra};me.oes_element_index_uint&&(er.uint32=Lo);function fr(Mr){this.id=Lt++,lr[this.id]=this,this.buffer=Mr,this.primType=fi,this.vertCount=0,this.type=0}fr.prototype.bind=function(){this.buffer.bind()};var _r=[];function rr(Mr){var ut=_r.pop();return ut||(ut=new fr(ze.create(null,Ss,!0,!1)._buffer)),Rr(ut,Mr,hl,-1,-1,0,0),ut}function Sr(Mr){_r.push(Mr)}function Rr(Mr,ut,Xt,br,zr,hr,Ar){Mr.buffer.bind();var Vr;if(ut){var On=Ar;!Ar&&(!J(ut)||Ds(ut)&&!J(ut.data))&&(On=me.oes_element_index_uint?Lo:Ra),ze._initBuffer(Mr.buffer,ut,Xt,On,3)}else z.bufferData(Ss,hr,Xt),Mr.buffer.dtype=Vr||Yi,Mr.buffer.usage=Xt,Mr.buffer.dimension=3,Mr.buffer.byteLength=hr;if(Vr=Ar,!Ar){switch(Mr.buffer.dtype){case Yi:case Qn:Vr=Yi;break;case Ra:case da:Vr=Ra;break;case Lo:case Hi:Vr=Lo;break;default:ve.raise("unsupported type for element array")}Mr.buffer.dtype=Vr}Mr.type=Vr,ve(Vr!==Lo||!!me.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var tr=zr;tr<0&&(tr=Mr.buffer.byteLength,Vr===Ra?tr>>=1:Vr===Lo&&(tr>>=2)),Mr.vertCount=tr;var ar=br;if(br<0){ar=fi;var _n=Mr.buffer.dimension;_n===1&&(ar=xr),_n===2&&(ar=Pn),_n===3&&(ar=fi)}Mr.primType=ar}function jr(Mr){Ft.elementsCount--,ve(Mr.buffer!==null,"must not double destroy elements"),delete lr[Mr.id],Mr.buffer.destroy(),Mr.buffer=null}function Er(Mr,ut){var Xt=ze.create(null,Ss,!0),br=new fr(Xt._buffer);Ft.elementsCount++;function zr(hr){if(!hr)Xt(),br.primType=fi,br.vertCount=0,br.type=Yi;else if(typeof hr=="number")Xt(hr),br.primType=fi,br.vertCount=hr|0,br.type=Yi;else{var Ar=null,Vr=Gc,On=-1,tr=-1,ar=0,_n=0;Array.isArray(hr)||J(hr)||Ds(hr)?Ar=hr:(ve.type(hr,"object","invalid arguments for elements"),"data"in hr&&(Ar=hr.data,ve(Array.isArray(Ar)||J(Ar)||Ds(Ar),"invalid data for element buffer")),"usage"in hr&&(ve.parameter(hr.usage,xo,"invalid element buffer usage"),Vr=xo[hr.usage]),"primitive"in hr&&(ve.parameter(hr.primitive,cr,"invalid element buffer primitive"),On=cr[hr.primitive]),"count"in hr&&(ve(typeof hr.count=="number"&&hr.count>=0,"invalid vertex count for elements"),tr=hr.count|0),"type"in hr&&(ve.parameter(hr.type,er,"invalid buffer type"),_n=er[hr.type]),"length"in hr?ar=hr.length|0:(ar=tr,_n===Ra||_n===da?ar*=2:(_n===Lo||_n===Hi)&&(ar*=4))),Rr(br,Ar,Vr,On,tr,ar,_n)}return zr}return zr(Mr),zr._reglType="elements",zr._elements=br,zr.subdata=function(hr,Ar){return Xt.subdata(hr,Ar),zr},zr.destroy=function(){jr(br)},zr}return{create:Er,createStream:rr,destroyStream:Sr,getElements:function(Mr){return typeof Mr=="function"&&Mr._elements instanceof fr?Mr._elements:null},clear:function(){ne(lr).forEach(jr)}}}var Sc=new Float32Array(1),Mu=new Uint32Array(Sc.buffer),vu=5123;function Ao(z){for(var me=Tt.allocType(vu,z.length),ze=0;ze<z.length;++ze)if(isNaN(z[ze]))me[ze]=65535;else if(z[ze]===Infinity)me[ze]=31744;else if(z[ze]===-Infinity)me[ze]=64512;else{Sc[0]=z[ze];var Ft=Mu[0],lr=Ft>>>31<<15,Lt=(Ft<<1>>>24)-127,er=Ft>>13&(1<<10)-1;if(Lt<-24)me[ze]=lr;else if(Lt<-14){var fr=-14-Lt;me[ze]=lr+(er+(1<<10)>>fr)}else Lt>15?me[ze]=lr+31744:me[ze]=lr+(Lt+15<<10)+er}return me}function va(z){return Array.isArray(z)||J(z)}var uh=function(z){return!(z&z-1)&&!!z},lh=34467,ho=3553,Pf=34067,mu=34069,Fs=6408,Cc=6406,pl=6407,Ca=6409,Ml=6410,Xl=32854,ns=32855,If=36194,ch=32819,fh=32820,Hc=33635,dl=34042,jo=6402,Pu=34041,Yu=35904,Vo=35906,Pl=36193,qu=33776,$s=33777,Wc=33778,Xc=33779,Yc=35986,Ku=35987,Yl=34798,Ac=35840,qc=35841,wc=35842,hh=35843,Tc=36196,vl=5121,Kc=5123,$c=5125,Iu=5126,Jc=10242,Of=10243,ph=10497,Il=33071,Wh=33648,is=10240,qa=10241,ql=9728,Ol=9729,lu=9984,Fi=9985,Ba=9986,Bs=9987,Qc=33170,ml=4352,ef=4353,Xh=4354,Yh=34046,Mc=3317,Kl=37440,$u=37441,ko=37443,$l=37444,Jl=33984,Qa=[lu,Ba,Fi,Bs],yn=[0,Ca,Ml,pl,Fs],lo={};lo[Ca]=lo[Cc]=lo[jo]=1,lo[Pu]=lo[Ml]=2,lo[pl]=lo[Yu]=3,lo[Fs]=lo[Vo]=4;function Ju(z){return"[object "+z+"]"}var Qu=Ju("HTMLCanvasElement"),gu=Ju("OffscreenCanvas"),Ns=Ju("CanvasRenderingContext2D"),Rf=Ju("ImageBitmap"),Kr=Ju("HTMLImageElement"),tf=Ju("HTMLVideoElement"),Lf=Object.keys(Ji).concat([Qu,gu,Ns,Rf,Kr,tf]),Ou=[];Ou[vl]=1,Ou[Iu]=4,Ou[Pl]=2,Ou[Kc]=2,Ou[$c]=4;var Ga=[];Ga[Xl]=2,Ga[ns]=2,Ga[If]=2,Ga[Pu]=4,Ga[qu]=.5,Ga[$s]=.5,Ga[Wc]=1,Ga[Xc]=1,Ga[Yc]=.5,Ga[Ku]=1,Ga[Yl]=1,Ga[Ac]=.5,Ga[qc]=.25,Ga[wc]=.5,Ga[hh]=.25,Ga[Tc]=.5;function zs(z){return Array.isArray(z)&&(z.length===0||typeof z[0]=="number")}function rf(z){if(!Array.isArray(z))return!1;var me=z.length;return!(me===0||!va(z[0]))}function Ru(z){return Object.prototype.toString.call(z)}function Ms(z){return Ru(z)===Qu}function wo(z){return Ru(z)===gu}function dh(z){return Ru(z)===Ns}function ba(z){return Ru(z)===Rf}function kf(z){return Ru(z)===Kr}function vh(z){return Ru(z)===tf}function Js(z){var me=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";return!!(me&&z&&z.getContext)}function Ps(z){var me=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";return!!(me&&z&&"src"in z&&"crossOrigin"in z)}function Li(z){if(!z)return!1;if(Js(z)||Ps(z))return!0;var me=Ru(z);return Lf.indexOf(me)>=0?!0:zs(z)||rf(z)||Ds(z)}function yu(z){return Ji[Object.prototype.toString.call(z)]|0}function ma(z,me){var ze=me.length;switch(z.type){case vl:case Kc:case $c:case Iu:var Ft=Tt.allocType(z.type,ze);Ft.set(me),z.data=Ft;break;case Pl:z.data=Ao(me);break;default:ve.raise("unsupported texture type, must specify a typed array")}}function po(z,me){return Tt.allocType(z.type===Pl?Iu:z.type,me)}function Us(z,me){z.type===Pl?(z.data=Ao(me),Tt.freeType(me)):z.data=me}function cu(z,me,ze,Ft,lr,Lt){for(var er=z.width,fr=z.height,_r=z.channels,rr=er*fr*_r,Sr=po(z,rr),Rr=0,jr=0;jr<fr;++jr)for(var Er=0;Er<er;++Er)for(var Mr=0;Mr<_r;++Mr)Sr[Rr++]=me[ze*Er+Ft*jr+lr*Mr+Lt];Us(z,Sr)}function Zs(z,me,ze,Ft,lr,Lt){var er;if(typeof Ga[z]!="undefined"?er=Ga[z]:er=lo[z]*Ou[me],Lt&&(er*=6),lr){for(var fr=0,_r=ze;_r>=1;)fr+=er*_r*_r,_r/=2;return fr}else return er*ze*Ft}function vs(z,me,ze,Ft,lr,Lt,er){var fr={"don't care":ml,"dont care":ml,nice:Xh,fast:ef},_r={repeat:ph,clamp:Il,mirror:Wh},rr={nearest:ql,linear:Ol},Sr=v({mipmap:Bs,"nearest mipmap nearest":lu,"linear mipmap nearest":Fi,"nearest mipmap linear":Ba,"linear mipmap linear":Bs},rr),Rr={none:0,browser:$l},jr={uint8:vl,rgba4:ch,rgb565:Hc,"rgb5 a1":fh},Er={alpha:Cc,luminance:Ca,"luminance alpha":Ml,rgb:pl,rgba:Fs,rgba4:Xl,"rgb5 a1":ns,rgb565:If},Mr={};me.ext_srgb&&(Er.srgb=Yu,Er.srgba=Vo),me.oes_texture_float&&(jr.float32=jr.float=Iu),me.oes_texture_half_float&&(jr.float16=jr["half float"]=Pl),me.webgl_depth_texture&&(v(Er,{depth:jo,"depth stencil":Pu}),v(jr,{uint16:Kc,uint32:$c,"depth stencil":dl})),me.webgl_compressed_texture_s3tc&&v(Mr,{"rgb s3tc dxt1":qu,"rgba s3tc dxt1":$s,"rgba s3tc dxt3":Wc,"rgba s3tc dxt5":Xc}),me.webgl_compressed_texture_atc&&v(Mr,{"rgb atc":Yc,"rgba atc explicit alpha":Ku,"rgba atc interpolated alpha":Yl}),me.webgl_compressed_texture_pvrtc&&v(Mr,{"rgb pvrtc 4bppv1":Ac,"rgb pvrtc 2bppv1":qc,"rgba pvrtc 4bppv1":wc,"rgba pvrtc 2bppv1":hh}),me.webgl_compressed_texture_etc1&&(Mr["rgb etc1"]=Tc);var ut=Array.prototype.slice.call(z.getParameter(lh)||new Uint32Array(0));Object.keys(Mr).forEach(function(Me){var Bt=Mr[Me];ut.indexOf(Bt)>=0&&(Er[Me]=Bt)});var Xt=Object.keys(Er);ze.textureFormats=Xt;var br=[];Object.keys(Er).forEach(function(Me){var Bt=Er[Me];br[Bt]=Me});var zr=[];Object.keys(jr).forEach(function(Me){var Bt=jr[Me];zr[Bt]=Me});var hr=[];Object.keys(rr).forEach(function(Me){var Bt=rr[Me];hr[Bt]=Me});var Ar=[];Object.keys(Sr).forEach(function(Me){var Bt=Sr[Me];Ar[Bt]=Me});var Vr=[];Object.keys(_r).forEach(function(Me){var Bt=_r[Me];Vr[Bt]=Me});var On=Xt.reduce(function(Me,Bt){var Ct=Er[Bt];return Ct===Ca||Ct===Cc||Ct===Ca||Ct===Ml||Ct===jo||Ct===Pu||me.ext_srgb&&(Ct===Yu||Ct===Vo)?Me[Ct]=Ct:Ct===ns||Bt.indexOf("rgba")>=0?Me[Ct]=Fs:Me[Ct]=pl,Me},{});function tr(){this.internalformat=Fs,this.format=Fs,this.type=vl,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=$l,this.width=0,this.height=0,this.channels=0}function ar(Me,Bt){Me.internalformat=Bt.internalformat,Me.format=Bt.format,Me.type=Bt.type,Me.compressed=Bt.compressed,Me.premultiplyAlpha=Bt.premultiplyAlpha,Me.flipY=Bt.flipY,Me.unpackAlignment=Bt.unpackAlignment,Me.colorSpace=Bt.colorSpace,Me.width=Bt.width,Me.height=Bt.height,Me.channels=Bt.channels}function _n(Me,Bt){if(!(typeof Bt!="object"||!Bt)){if("premultiplyAlpha"in Bt&&(ve.type(Bt.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),Me.premultiplyAlpha=Bt.premultiplyAlpha),"flipY"in Bt&&(ve.type(Bt.flipY,"boolean","invalid texture flip"),Me.flipY=Bt.flipY),"alignment"in Bt&&(ve.oneOf(Bt.alignment,[1,2,4,8],"invalid texture unpack alignment"),Me.unpackAlignment=Bt.alignment),"colorSpace"in Bt&&(ve.parameter(Bt.colorSpace,Rr,"invalid colorSpace"),Me.colorSpace=Rr[Bt.colorSpace]),"type"in Bt){var Ct=Bt.type;ve(me.oes_texture_float||!(Ct==="float"||Ct==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),ve(me.oes_texture_half_float||!(Ct==="half float"||Ct==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),ve(me.webgl_depth_texture||!(Ct==="uint16"||Ct==="uint32"||Ct==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),ve.parameter(Ct,jr,"invalid texture type"),Me.type=jr[Ct]}var dn=Me.width,Zi=Me.height,Se=Me.channels,ce=!1;"shape"in Bt?(ve(Array.isArray(Bt.shape)&&Bt.shape.length>=2,"shape must be an array"),dn=Bt.shape[0],Zi=Bt.shape[1],Bt.shape.length===3&&(Se=Bt.shape[2],ve(Se>0&&Se<=4,"invalid number of channels"),ce=!0),ve(dn>=0&&dn<=ze.maxTextureSize,"invalid width"),ve(Zi>=0&&Zi<=ze.maxTextureSize,"invalid height")):("radius"in Bt&&(dn=Zi=Bt.radius,ve(dn>=0&&dn<=ze.maxTextureSize,"invalid radius")),"width"in Bt&&(dn=Bt.width,ve(dn>=0&&dn<=ze.maxTextureSize,"invalid width")),"height"in Bt&&(Zi=Bt.height,ve(Zi>=0&&Zi<=ze.maxTextureSize,"invalid height")),"channels"in Bt&&(Se=Bt.channels,ve(Se>0&&Se<=4,"invalid number of channels"),ce=!0)),Me.width=dn|0,Me.height=Zi|0,Me.channels=Se|0;var He=!1;if("format"in Bt){var ht=Bt.format;ve(me.webgl_depth_texture||!(ht==="depth"||ht==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),ve.parameter(ht,Er,"invalid texture format");var Pt=Me.internalformat=Er[ht];Me.format=On[Pt],ht in jr&&("type"in Bt||(Me.type=jr[ht])),ht in Mr&&(Me.compressed=!0),He=!0}!ce&&He?Me.channels=lo[Me.format]:ce&&!He?Me.channels!==yn[Me.format]&&(Me.format=Me.internalformat=yn[Me.channels]):He&&ce&&ve(Me.channels===lo[Me.format],"number of channels inconsistent with specified format")}}function Gr(Me){z.pixelStorei(Kl,Me.flipY),z.pixelStorei($u,Me.premultiplyAlpha),z.pixelStorei(ko,Me.colorSpace),z.pixelStorei(Mc,Me.unpackAlignment)}function wr(){tr.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function $r(Me,Bt){var Ct=null;if(Li(Bt)?Ct=Bt:Bt&&(ve.type(Bt,"object","invalid pixel data type"),_n(Me,Bt),"x"in Bt&&(Me.xOffset=Bt.x|0),"y"in Bt&&(Me.yOffset=Bt.y|0),Li(Bt.data)&&(Ct=Bt.data)),ve(!Me.compressed||Ct instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),Bt.copy){ve(!Ct,"can not specify copy and data field for the same texture");var dn=lr.viewportWidth,Zi=lr.viewportHeight;Me.width=Me.width||dn-Me.xOffset,Me.height=Me.height||Zi-Me.yOffset,Me.needsCopy=!0,ve(Me.xOffset>=0&&Me.xOffset<dn&&Me.yOffset>=0&&Me.yOffset<Zi&&Me.width>0&&Me.width<=dn&&Me.height>0&&Me.height<=Zi,"copy texture read out of bounds")}else if(!Ct)Me.width=Me.width||1,Me.height=Me.height||1,Me.channels=Me.channels||4;else if(J(Ct))Me.channels=Me.channels||4,Me.data=Ct,!("type"in Bt)&&Me.type===vl&&(Me.type=yu(Ct));else if(zs(Ct))Me.channels=Me.channels||4,ma(Me,Ct),Me.alignment=1,Me.needsFree=!0;else if(Ds(Ct)){var Se=Ct.data;!Array.isArray(Se)&&Me.type===vl&&(Me.type=yu(Se));var ce=Ct.shape,He=Ct.stride,ht,Pt,Je,Ne,it,ye;ce.length===3?(Je=ce[2],ye=He[2]):(ve(ce.length===2,"invalid ndarray pixel data, must be 2 or 3D"),Je=1,ye=1),ht=ce[0],Pt=ce[1],Ne=He[0],it=He[1],Me.alignment=1,Me.width=ht,Me.height=Pt,Me.channels=Je,Me.format=Me.internalformat=yn[Je],Me.needsFree=!0,cu(Me,Se,Ne,it,ye,Ct.offset)}else if(Js(Ct)||Ms(Ct)||wo(Ct)||dh(Ct))Js(Ct)||Ms(Ct)||wo(Ct)?Me.element=Ct:Me.element=Ct.canvas,Me.width=Me.element.width,Me.height=Me.element.height,Me.channels=4;else if(ba(Ct))Me.element=Ct,Me.width=Ct.width,Me.height=Ct.height,Me.channels=4;else if(kf(Ct))Me.element=Ct,Me.width=Ct.naturalWidth,Me.height=Ct.naturalHeight,Me.channels=4;else if(Ps(Ct))Me.element=Ct,Me.width=Ct.width,Me.height=Ct.height,Me.channels=4;else if(vh(Ct))Me.element=Ct,Me.width=Ct.videoWidth,Me.height=Ct.videoHeight,Me.channels=4;else if(rf(Ct)){var je=Me.width||Ct[0].length,we=Me.height||Ct.length,pt=Me.channels;va(Ct[0][0])?pt=pt||Ct[0][0].length:pt=pt||1;for(var Et=be.shape(Ct),pr=1,Ur=0;Ur<Et.length;++Ur)pr*=Et[Ur];var Nr=po(Me,pr);be.flatten(Ct,Et,"",Nr),Us(Me,Nr),Me.alignment=1,Me.width=je,Me.height=we,Me.channels=pt,Me.format=Me.internalformat=yn[pt],Me.needsFree=!0}Me.type===Iu?ve(ze.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):Me.type===Pl&&ve(ze.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function Jr(Me,Bt,Ct){var dn=Me.element,Zi=Me.data,Se=Me.internalformat,ce=Me.format,He=Me.type,ht=Me.width,Pt=Me.height;Gr(Me),dn?z.texImage2D(Bt,Ct,ce,ce,He,dn):Me.compressed?z.compressedTexImage2D(Bt,Ct,Se,ht,Pt,0,Zi):Me.needsCopy?(Ft(),z.copyTexImage2D(Bt,Ct,ce,Me.xOffset,Me.yOffset,ht,Pt,0)):z.texImage2D(Bt,Ct,ce,ht,Pt,0,ce,He,Zi||null)}function yi(Me,Bt,Ct,dn,Zi){var Se=Me.element,ce=Me.data,He=Me.internalformat,ht=Me.format,Pt=Me.type,Je=Me.width,Ne=Me.height;Gr(Me),Se?z.texSubImage2D(Bt,Zi,Ct,dn,ht,Pt,Se):Me.compressed?z.compressedTexSubImage2D(Bt,Zi,Ct,dn,He,Je,Ne,ce):Me.needsCopy?(Ft(),z.copyTexSubImage2D(Bt,Zi,Ct,dn,Me.xOffset,Me.yOffset,Je,Ne)):z.texSubImage2D(Bt,Zi,Ct,dn,Je,Ne,ht,Pt,ce)}var ai=[];function qr(){return ai.pop()||new wr}function en(Me){Me.needsFree&&Tt.freeType(Me.data),wr.call(Me),ai.push(Me)}function $n(){tr.call(this),this.genMipmaps=!1,this.mipmapHint=ml,this.mipmask=0,this.images=Array(16)}function pi(Me,Bt,Ct){var dn=Me.images[0]=qr();Me.mipmask=1,dn.width=Me.width=Bt,dn.height=Me.height=Ct,dn.channels=Me.channels=4}function Ni(Me,Bt){var Ct=null;if(Li(Bt))Ct=Me.images[0]=qr(),ar(Ct,Me),$r(Ct,Bt),Me.mipmask=1;else if(_n(Me,Bt),Array.isArray(Bt.mipmap))for(var dn=Bt.mipmap,Zi=0;Zi<dn.length;++Zi)Ct=Me.images[Zi]=qr(),ar(Ct,Me),Ct.width>>=Zi,Ct.height>>=Zi,$r(Ct,dn[Zi]),Me.mipmask|=1<<Zi;else Ct=Me.images[0]=qr(),ar(Ct,Me),$r(Ct,Bt),Me.mipmask=1;ar(Me,Me.images[0]),Me.compressed&&(Me.internalformat===qu||Me.internalformat===$s||Me.internalformat===Wc||Me.internalformat===Xc)&&ve(Me.width%4==0&&Me.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function co(Me,Bt){for(var Ct=Me.images,dn=0;dn<Ct.length;++dn){if(!Ct[dn])return;Jr(Ct[dn],Bt,dn)}}var mo=[];function zi(){var Me=mo.pop()||new $n;tr.call(Me),Me.mipmask=0;for(var Bt=0;Bt<16;++Bt)Me.images[Bt]=null;return Me}function os(Me){for(var Bt=Me.images,Ct=0;Ct<Bt.length;++Ct)Bt[Ct]&&en(Bt[Ct]),Bt[Ct]=null;mo.push(Me)}function Ka(){this.minFilter=ql,this.magFilter=ql,this.wrapS=Il,this.wrapT=Il,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=ml}function Ho(Me,Bt){if("min"in Bt){var Ct=Bt.min;ve.parameter(Ct,Sr),Me.minFilter=Sr[Ct],Qa.indexOf(Me.minFilter)>=0&&!("faces"in Bt)&&(Me.genMipmaps=!0)}if("mag"in Bt){var dn=Bt.mag;ve.parameter(dn,rr),Me.magFilter=rr[dn]}var Zi=Me.wrapS,Se=Me.wrapT;if("wrap"in Bt){var ce=Bt.wrap;typeof ce=="string"?(ve.parameter(ce,_r),Zi=Se=_r[ce]):Array.isArray(ce)&&(ve.parameter(ce[0],_r),ve.parameter(ce[1],_r),Zi=_r[ce[0]],Se=_r[ce[1]])}else{if("wrapS"in Bt){var He=Bt.wrapS;ve.parameter(He,_r),Zi=_r[He]}if("wrapT"in Bt){var ht=Bt.wrapT;ve.parameter(ht,_r),Se=_r[ht]}}if(Me.wrapS=Zi,Me.wrapT=Se,"anisotropic"in Bt){var Pt=Bt.anisotropic;ve(typeof Pt=="number"&&Pt>=1&&Pt<=ze.maxAnisotropic,"aniso samples must be between 1 and "),Me.anisotropic=Bt.anisotropic}if("mipmap"in Bt){var Je=!1;switch(typeof Bt.mipmap){case"string":ve.parameter(Bt.mipmap,fr,"invalid mipmap hint"),Me.mipmapHint=fr[Bt.mipmap],Me.genMipmaps=!0,Je=!0;break;case"boolean":Je=Me.genMipmaps=Bt.mipmap;break;case"object":ve(Array.isArray(Bt.mipmap),"invalid mipmap type"),Me.genMipmaps=!1,Je=!0;break;default:ve.raise("invalid mipmap type")}Je&&!("min"in Bt)&&(Me.minFilter=lu)}}function Eo(Me,Bt){z.texParameteri(Bt,qa,Me.minFilter),z.texParameteri(Bt,is,Me.magFilter),z.texParameteri(Bt,Jc,Me.wrapS),z.texParameteri(Bt,Of,Me.wrapT),me.ext_texture_filter_anisotropic&&z.texParameteri(Bt,Yh,Me.anisotropic),Me.genMipmaps&&(z.hint(Qc,Me.mipmapHint),z.generateMipmap(Bt))}var ts=0,Wo={},ss=ze.maxTextureUnits,go=Array(ss).map(function(){return null});function _i(Me){tr.call(this),this.mipmask=0,this.internalformat=Fs,this.id=ts++,this.refCount=1,this.target=Me,this.texture=z.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new Ka,er.profile&&(this.stats={size:0})}function Xo(Me){z.activeTexture(Jl),z.bindTexture(Me.target,Me.texture)}function na(){var Me=go[0];Me?z.bindTexture(Me.target,Me.texture):z.bindTexture(ho,null)}function us(Me){var Bt=Me.texture;ve(Bt,"must not double destroy texture");var Ct=Me.unit,dn=Me.target;Ct>=0&&(z.activeTexture(Jl+Ct),z.bindTexture(dn,null),go[Ct]=null),z.deleteTexture(Bt),Me.texture=null,Me.params=null,Me.pixels=null,Me.refCount=0,delete Wo[Me.id],Lt.textureCount--}v(_i.prototype,{bind:function(){var Me=this;Me.bindCount+=1;var Bt=Me.unit;if(Bt<0){for(var Ct=0;Ct<ss;++Ct){var dn=go[Ct];if(dn){if(dn.bindCount>0)continue;dn.unit=-1}go[Ct]=Me,Bt=Ct;break}Bt>=ss&&ve.raise("insufficient number of texture units"),er.profile&&Lt.maxTextureUnits<Bt+1&&(Lt.maxTextureUnits=Bt+1),Me.unit=Bt,z.activeTexture(Jl+Bt),z.bindTexture(Me.target,Me.texture)}return Bt},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&us(this)}});function ni(Me,Bt){var Ct=new _i(ho);Wo[Ct.id]=Ct,Lt.textureCount++;function dn(ce,He){var ht=Ct.texInfo;Ka.call(ht);var Pt=zi();return typeof ce=="number"?typeof He=="number"?pi(Pt,ce|0,He|0):pi(Pt,ce|0,ce|0):ce?(ve.type(ce,"object","invalid arguments to regl.texture"),Ho(ht,ce),Ni(Pt,ce)):pi(Pt,1,1),ht.genMipmaps&&(Pt.mipmask=(Pt.width<<1)-1),Ct.mipmask=Pt.mipmask,ar(Ct,Pt),ve.texture2D(ht,Pt,ze),Ct.internalformat=Pt.internalformat,dn.width=Pt.width,dn.height=Pt.height,Xo(Ct),co(Pt,ho),Eo(ht,ho),na(),os(Pt),er.profile&&(Ct.stats.size=Zs(Ct.internalformat,Ct.type,Pt.width,Pt.height,ht.genMipmaps,!1)),dn.format=br[Ct.internalformat],dn.type=zr[Ct.type],dn.mag=hr[ht.magFilter],dn.min=Ar[ht.minFilter],dn.wrapS=Vr[ht.wrapS],dn.wrapT=Vr[ht.wrapT],dn}function Zi(ce,He,ht,Pt){ve(!!ce,"must specify image data");var Je=He|0,Ne=ht|0,it=Pt|0,ye=qr();return ar(ye,Ct),ye.width=0,ye.height=0,$r(ye,ce),ye.width=ye.width||(Ct.width>>it)-Je,ye.height=ye.height||(Ct.height>>it)-Ne,ve(Ct.type===ye.type&&Ct.format===ye.format&&Ct.internalformat===ye.internalformat,"incompatible format for texture.subimage"),ve(Je>=0&&Ne>=0&&Je+ye.width<=Ct.width&&Ne+ye.height<=Ct.height,"texture.subimage write out of bounds"),ve(Ct.mipmask&1<<it,"missing mipmap data"),ve(ye.data||ye.element||ye.needsCopy,"missing image data"),Xo(Ct),yi(ye,ho,Je,Ne,it),na(),en(ye),dn}function Se(ce,He){var ht=ce|0,Pt=He|0||ht;if(ht===Ct.width&&Pt===Ct.height)return dn;dn.width=Ct.width=ht,dn.height=Ct.height=Pt,Xo(Ct);for(var Je=0;Ct.mipmask>>Je;++Je){var Ne=ht>>Je,it=Pt>>Je;if(!Ne||!it)break;z.texImage2D(ho,Je,Ct.format,Ne,it,0,Ct.format,Ct.type,null)}return na(),er.profile&&(Ct.stats.size=Zs(Ct.internalformat,Ct.type,ht,Pt,!1,!1)),dn}return dn(Me,Bt),dn.subimage=Zi,dn.resize=Se,dn._reglType="texture2d",dn._texture=Ct,er.profile&&(dn.stats=Ct.stats),dn.destroy=function(){Ct.decRef()},dn}function Ui(Me,Bt,Ct,dn,Zi,Se){var ce=new _i(Pf);Wo[ce.id]=ce,Lt.cubeCount++;var He=new Array(6);function ht(Ne,it,ye,je,we,pt){var Et,pr=ce.texInfo;for(Ka.call(pr),Et=0;Et<6;++Et)He[Et]=zi();if(typeof Ne=="number"||!Ne){var Ur=Ne|0||1;for(Et=0;Et<6;++Et)pi(He[Et],Ur,Ur)}else if(typeof Ne=="object")if(it)Ni(He[0],Ne),Ni(He[1],it),Ni(He[2],ye),Ni(He[3],je),Ni(He[4],we),Ni(He[5],pt);else if(Ho(pr,Ne),_n(ce,Ne),"faces"in Ne){var Nr=Ne.faces;for(ve(Array.isArray(Nr)&&Nr.length===6,"cube faces must be a length 6 array"),Et=0;Et<6;++Et)ve(typeof Nr[Et]=="object"&&!!Nr[Et],"invalid input for cube map face"),ar(He[Et],ce),Ni(He[Et],Nr[Et])}else for(Et=0;Et<6;++Et)Ni(He[Et],Ne);else ve.raise("invalid arguments to cube map");for(ar(ce,He[0]),ve.optional(function(){ze.npotTextureCube||ve(uh(ce.width)&&uh(ce.height),"your browser does not support non power or two texture dimensions")}),pr.genMipmaps?ce.mipmask=(He[0].width<<1)-1:ce.mipmask=He[0].mipmask,ve.textureCube(ce,pr,He,ze),ce.internalformat=He[0].internalformat,ht.width=He[0].width,ht.height=He[0].height,Xo(ce),Et=0;Et<6;++Et)co(He[Et],mu+Et);for(Eo(pr,Pf),na(),er.profile&&(ce.stats.size=Zs(ce.internalformat,ce.type,ht.width,ht.height,pr.genMipmaps,!0)),ht.format=br[ce.internalformat],ht.type=zr[ce.type],ht.mag=hr[pr.magFilter],ht.min=Ar[pr.minFilter],ht.wrapS=Vr[pr.wrapS],ht.wrapT=Vr[pr.wrapT],Et=0;Et<6;++Et)os(He[Et]);return ht}function Pt(Ne,it,ye,je,we){ve(!!it,"must specify image data"),ve(typeof Ne=="number"&&Ne===(Ne|0)&&Ne>=0&&Ne<6,"invalid face");var pt=ye|0,Et=je|0,pr=we|0,Ur=qr();return ar(Ur,ce),Ur.width=0,Ur.height=0,$r(Ur,it),Ur.width=Ur.width||(ce.width>>pr)-pt,Ur.height=Ur.height||(ce.height>>pr)-Et,ve(ce.type===Ur.type&&ce.format===Ur.format&&ce.internalformat===Ur.internalformat,"incompatible format for texture.subimage"),ve(pt>=0&&Et>=0&&pt+Ur.width<=ce.width&&Et+Ur.height<=ce.height,"texture.subimage write out of bounds"),ve(ce.mipmask&1<<pr,"missing mipmap data"),ve(Ur.data||Ur.element||Ur.needsCopy,"missing image data"),Xo(ce),yi(Ur,mu+Ne,pt,Et,pr),na(),en(Ur),ht}function Je(Ne){var it=Ne|0;if(it!==ce.width){ht.width=ce.width=it,ht.height=ce.height=it,Xo(ce);for(var ye=0;ye<6;++ye)for(var je=0;ce.mipmask>>je;++je)z.texImage2D(mu+ye,je,ce.format,it>>je,it>>je,0,ce.format,ce.type,null);return na(),er.profile&&(ce.stats.size=Zs(ce.internalformat,ce.type,ht.width,ht.height,!1,!0)),ht}}return ht(Me,Bt,Ct,dn,Zi,Se),ht.subimage=Pt,ht.resize=Je,ht._reglType="textureCube",ht._texture=ce,er.profile&&(ht.stats=ce.stats),ht.destroy=function(){ce.decRef()},ht}function fa(){for(var Me=0;Me<ss;++Me)z.activeTexture(Jl+Me),z.bindTexture(ho,null),go[Me]=null;ne(Wo).forEach(us),Lt.cubeCount=0,Lt.textureCount=0}er.profile&&(Lt.getTotalTextureSize=function(){var Me=0;return Object.keys(Wo).forEach(function(Bt){Me+=Wo[Bt].stats.size}),Me});function Po(){for(var Me=0;Me<ss;++Me){var Bt=go[Me];Bt&&(Bt.bindCount=0,Bt.unit=-1,go[Me]=null)}ne(Wo).forEach(function(Ct){Ct.texture=z.createTexture(),z.bindTexture(Ct.target,Ct.texture);for(var dn=0;dn<32;++dn)if((Ct.mipmask&1<<dn)!=0)if(Ct.target===ho)z.texImage2D(ho,dn,Ct.internalformat,Ct.width>>dn,Ct.height>>dn,0,Ct.internalformat,Ct.type,null);else for(var Zi=0;Zi<6;++Zi)z.texImage2D(mu+Zi,dn,Ct.internalformat,Ct.width>>dn,Ct.height>>dn,0,Ct.internalformat,Ct.type,null);Eo(Ct.texInfo,Ct.target)})}function Sl(){for(var Me=0;Me<ss;++Me){var Bt=go[Me];Bt&&(Bt.bindCount=0,Bt.unit=-1,go[Me]=null),z.activeTexture(Jl+Me),z.bindTexture(ho,null),z.bindTexture(Pf,null)}}return{create2D:ni,createCube:Ui,clear:fa,getTexture:function(Me){return null},restore:Po,refresh:Sl}}var js=36161,In=32854,An=32855,Ql=36194,ms=33189,_u=36168,es=34041,Aa=35907,Pc=34836,Ic=34842,ga=34843,Ia=[];Ia[In]=2,Ia[An]=2,Ia[Ql]=2,Ia[ms]=2,Ia[_u]=1,Ia[es]=4,Ia[Aa]=4,Ia[Pc]=16,Ia[Ic]=8,Ia[ga]=6;function Oc(z,me,ze){return Ia[z]*me*ze}var Rl=function(z,me,ze,Ft,lr){var Lt={rgba4:In,rgb565:Ql,"rgb5 a1":An,depth:ms,stencil:_u,"depth stencil":es};me.ext_srgb&&(Lt.srgba=Aa),me.ext_color_buffer_half_float&&(Lt.rgba16f=Ic,Lt.rgb16f=ga),me.webgl_color_buffer_float&&(Lt.rgba32f=Pc);var er=[];Object.keys(Lt).forEach(function(Er){var Mr=Lt[Er];er[Mr]=Er});var fr=0,_r={};function rr(Er){this.id=fr++,this.refCount=1,this.renderbuffer=Er,this.format=In,this.width=0,this.height=0,lr.profile&&(this.stats={size:0})}rr.prototype.decRef=function(){--this.refCount<=0&&Sr(this)};function Sr(Er){var Mr=Er.renderbuffer;ve(Mr,"must not double destroy renderbuffer"),z.bindRenderbuffer(js,null),z.deleteRenderbuffer(Mr),Er.renderbuffer=null,Er.refCount=0,delete _r[Er.id],Ft.renderbufferCount--}function Rr(Er,Mr){var ut=new rr(z.createRenderbuffer());_r[ut.id]=ut,Ft.renderbufferCount++;function Xt(zr,hr){var Ar=0,Vr=0,On=In;if(typeof zr=="object"&&zr){var tr=zr;if("shape"in tr){var ar=tr.shape;ve(Array.isArray(ar)&&ar.length>=2,"invalid renderbuffer shape"),Ar=ar[0]|0,Vr=ar[1]|0}else"radius"in tr&&(Ar=Vr=tr.radius|0),"width"in tr&&(Ar=tr.width|0),"height"in tr&&(Vr=tr.height|0);"format"in tr&&(ve.parameter(tr.format,Lt,"invalid renderbuffer format"),On=Lt[tr.format])}else typeof zr=="number"?(Ar=zr|0,typeof hr=="number"?Vr=hr|0:Vr=Ar):zr?ve.raise("invalid arguments to renderbuffer constructor"):Ar=Vr=1;if(ve(Ar>0&&Vr>0&&Ar<=ze.maxRenderbufferSize&&Vr<=ze.maxRenderbufferSize,"invalid renderbuffer size"),!(Ar===ut.width&&Vr===ut.height&&On===ut.format))return Xt.width=ut.width=Ar,Xt.height=ut.height=Vr,ut.format=On,z.bindRenderbuffer(js,ut.renderbuffer),z.renderbufferStorage(js,On,Ar,Vr),ve(z.getError()===0,"invalid render buffer format"),lr.profile&&(ut.stats.size=Oc(ut.format,ut.width,ut.height)),Xt.format=er[ut.format],Xt}function br(zr,hr){var Ar=zr|0,Vr=hr|0||Ar;return Ar===ut.width&&Vr===ut.height||(ve(Ar>0&&Vr>0&&Ar<=ze.maxRenderbufferSize&&Vr<=ze.maxRenderbufferSize,"invalid renderbuffer size"),Xt.width=ut.width=Ar,Xt.height=ut.height=Vr,z.bindRenderbuffer(js,ut.renderbuffer),z.renderbufferStorage(js,ut.format,Ar,Vr),ve(z.getError()===0,"invalid render buffer format"),lr.profile&&(ut.stats.size=Oc(ut.format,ut.width,ut.height))),Xt}return Xt(Er,Mr),Xt.resize=br,Xt._reglType="renderbuffer",Xt._renderbuffer=ut,lr.profile&&(Xt.stats=ut.stats),Xt.destroy=function(){ut.decRef()},Xt}lr.profile&&(Ft.getTotalRenderbufferSize=function(){var Er=0;return Object.keys(_r).forEach(function(Mr){Er+=_r[Mr].stats.size}),Er});function jr(){ne(_r).forEach(function(Er){Er.renderbuffer=z.createRenderbuffer(),z.bindRenderbuffer(js,Er.renderbuffer),z.renderbufferStorage(js,Er.format,Er.width,Er.height)}),z.bindRenderbuffer(js,null)}return{create:Rr,clear:function(){ne(_r).forEach(Sr)},restore:jr}},xu=36160,Qs=36161,Do=3553,gl=34069,bu=36064,nf=36096,Ll=36128,kl=33306,Dl=36053,ec=36054,yl=36055,mh=36057,el=36061,Lu=36193,Df=5121,_l=5126,eu=6407,af=6408,Vs=6402,gh=[eu,af],tc=[];tc[af]=4,tc[eu]=3;var l=[];l[Df]=1,l[_l]=4,l[Lu]=2;var f=32854,c=32855,d=36194,E=33189,C=36168,T=34041,L=35907,Z=34836,W=34842,fe=34843,he=[f,c,d,L,W,fe,Z],de={};de[Dl]="complete",de[ec]="incomplete attachment",de[mh]="incomplete dimensions",de[yl]="incomplete, missing attachment",de[el]="unsupported";function Le(z,me,ze,Ft,lr,Lt){var er={cur:null,next:null,dirty:!1,setFBO:null},fr=["rgba"],_r=["rgba4","rgb565","rgb5 a1"];me.ext_srgb&&_r.push("srgba"),me.ext_color_buffer_half_float&&_r.push("rgba16f","rgb16f"),me.webgl_color_buffer_float&&_r.push("rgba32f");var rr=["uint8"];me.oes_texture_half_float&&rr.push("half float","float16"),me.oes_texture_float&&rr.push("float","float32");function Sr(wr,$r,Jr){this.target=wr,this.texture=$r,this.renderbuffer=Jr;var yi=0,ai=0;$r?(yi=$r.width,ai=$r.height):Jr&&(yi=Jr.width,ai=Jr.height),this.width=yi,this.height=ai}function Rr(wr){wr&&(wr.texture&&wr.texture._texture.decRef(),wr.renderbuffer&&wr.renderbuffer._renderbuffer.decRef())}function jr(wr,$r,Jr){if(!!wr)if(wr.texture){var yi=wr.texture._texture,ai=Math.max(1,yi.width),qr=Math.max(1,yi.height);ve(ai===$r&&qr===Jr,"inconsistent width/height for supplied texture"),yi.refCount+=1}else{var en=wr.renderbuffer._renderbuffer;ve(en.width===$r&&en.height===Jr,"inconsistent width/height for renderbuffer"),en.refCount+=1}}function Er(wr,$r){$r&&($r.texture?z.framebufferTexture2D(xu,wr,$r.target,$r.texture._texture.texture,0):z.framebufferRenderbuffer(xu,wr,Qs,$r.renderbuffer._renderbuffer.renderbuffer))}function Mr(wr){var $r=Do,Jr=null,yi=null,ai=wr;typeof wr=="object"&&(ai=wr.data,"target"in wr&&($r=wr.target|0)),ve.type(ai,"function","invalid attachment data");var qr=ai._reglType;return qr==="texture2d"?(Jr=ai,ve($r===Do)):qr==="textureCube"?(Jr=ai,ve($r>=gl&&$r<gl+6,"invalid cube map target")):qr==="renderbuffer"?(yi=ai,$r=Qs):ve.raise("invalid regl object for attachment"),new Sr($r,Jr,yi)}function ut(wr,$r,Jr,yi,ai){if(Jr){var qr=Ft.create2D({width:wr,height:$r,format:yi,type:ai});return qr._texture.refCount=0,new Sr(Do,qr,null)}else{var en=lr.create({width:wr,height:$r,format:yi});return en._renderbuffer.refCount=0,new Sr(Qs,null,en)}}function Xt(wr){return wr&&(wr.texture||wr.renderbuffer)}function br(wr,$r,Jr){wr&&(wr.texture?wr.texture.resize($r,Jr):wr.renderbuffer&&wr.renderbuffer.resize($r,Jr),wr.width=$r,wr.height=Jr)}var zr=0,hr={};function Ar(){this.id=zr++,hr[this.id]=this,this.framebuffer=z.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function Vr(wr){wr.colorAttachments.forEach(Rr),Rr(wr.depthAttachment),Rr(wr.stencilAttachment),Rr(wr.depthStencilAttachment)}function On(wr){var $r=wr.framebuffer;ve($r,"must not double destroy framebuffer"),z.deleteFramebuffer($r),wr.framebuffer=null,Lt.framebufferCount--,delete hr[wr.id]}function tr(wr){var $r;z.bindFramebuffer(xu,wr.framebuffer);var Jr=wr.colorAttachments;for($r=0;$r<Jr.length;++$r)Er(bu+$r,Jr[$r]);for($r=Jr.length;$r<ze.maxColorAttachments;++$r)z.framebufferTexture2D(xu,bu+$r,Do,null,0);z.framebufferTexture2D(xu,kl,Do,null,0),z.framebufferTexture2D(xu,nf,Do,null,0),z.framebufferTexture2D(xu,Ll,Do,null,0),Er(nf,wr.depthAttachment),Er(Ll,wr.stencilAttachment),Er(kl,wr.depthStencilAttachment);var yi=z.checkFramebufferStatus(xu);!z.isContextLost()&&yi!==Dl&&ve.raise("framebuffer configuration not supported, status = "+de[yi]),z.bindFramebuffer(xu,er.next?er.next.framebuffer:null),er.cur=er.next,z.getError()}function ar(wr,$r){var Jr=new Ar;Lt.framebufferCount++;function yi(qr,en){var $n;ve(er.next!==Jr,"can not update framebuffer which is currently in use");var pi=0,Ni=0,co=!0,mo=!0,zi=null,os=!0,Ka="rgba",Ho="uint8",Eo=1,ts=null,Wo=null,ss=null,go=!1;if(typeof qr=="number")pi=qr|0,Ni=en|0||pi;else if(!qr)pi=Ni=1;else{ve.type(qr,"object","invalid arguments for framebuffer");var _i=qr;if("shape"in _i){var Xo=_i.shape;ve(Array.isArray(Xo)&&Xo.length>=2,"invalid shape for framebuffer"),pi=Xo[0],Ni=Xo[1]}else"radius"in _i&&(pi=Ni=_i.radius),"width"in _i&&(pi=_i.width),"height"in _i&&(Ni=_i.height);("color"in _i||"colors"in _i)&&(zi=_i.color||_i.colors,Array.isArray(zi)&&ve(zi.length===1||me.webgl_draw_buffers,"multiple render targets not supported")),zi||("colorCount"in _i&&(Eo=_i.colorCount|0,ve(Eo>0,"invalid color buffer count")),"colorTexture"in _i&&(os=!!_i.colorTexture,Ka="rgba4"),"colorType"in _i&&(Ho=_i.colorType,os?(ve(me.oes_texture_float||!(Ho==="float"||Ho==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),ve(me.oes_texture_half_float||!(Ho==="half float"||Ho==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):Ho==="half float"||Ho==="float16"?(ve(me.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),Ka="rgba16f"):(Ho==="float"||Ho==="float32")&&(ve(me.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),Ka="rgba32f"),ve.oneOf(Ho,rr,"invalid color type")),"colorFormat"in _i&&(Ka=_i.colorFormat,fr.indexOf(Ka)>=0?os=!0:_r.indexOf(Ka)>=0?os=!1:ve.optional(function(){os?ve.oneOf(_i.colorFormat,fr,"invalid color format for texture"):ve.oneOf(_i.colorFormat,_r,"invalid color format for renderbuffer")}))),("depthTexture"in _i||"depthStencilTexture"in _i)&&(go=!!(_i.depthTexture||_i.depthStencilTexture),ve(!go||me.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in _i&&(typeof _i.depth=="boolean"?co=_i.depth:(ts=_i.depth,mo=!1)),"stencil"in _i&&(typeof _i.stencil=="boolean"?mo=_i.stencil:(Wo=_i.stencil,co=!1)),"depthStencil"in _i&&(typeof _i.depthStencil=="boolean"?co=mo=_i.depthStencil:(ss=_i.depthStencil,co=!1,mo=!1))}var na=null,us=null,ni=null,Ui=null;if(Array.isArray(zi))na=zi.map(Mr);else if(zi)na=[Mr(zi)];else for(na=new Array(Eo),$n=0;$n<Eo;++$n)na[$n]=ut(pi,Ni,os,Ka,Ho);ve(me.webgl_draw_buffers||na.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),ve(na.length<=ze.maxColorAttachments,"too many color attachments, not supported"),pi=pi||na[0].width,Ni=Ni||na[0].height,ts?us=Mr(ts):co&&!mo&&(us=ut(pi,Ni,go,"depth","uint32")),Wo?ni=Mr(Wo):mo&&!co&&(ni=ut(pi,Ni,!1,"stencil","uint8")),ss?Ui=Mr(ss):!ts&&!Wo&&mo&&co&&(Ui=ut(pi,Ni,go,"depth stencil","depth stencil")),ve(!!ts+!!Wo+!!ss<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var fa=null;for($n=0;$n<na.length;++$n)if(jr(na[$n],pi,Ni),ve(!na[$n]||na[$n].texture&&gh.indexOf(na[$n].texture._texture.format)>=0||na[$n].renderbuffer&&he.indexOf(na[$n].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+$n+" is invalid"),na[$n]&&na[$n].texture){var Po=tc[na[$n].texture._texture.format]*l[na[$n].texture._texture.type];fa===null?fa=Po:ve(fa===Po,"all color attachments much have the same number of bits per pixel.")}return jr(us,pi,Ni),ve(!us||us.texture&&us.texture._texture.format===Vs||us.renderbuffer&&us.renderbuffer._renderbuffer.format===E,"invalid depth attachment for framebuffer object"),jr(ni,pi,Ni),ve(!ni||ni.renderbuffer&&ni.renderbuffer._renderbuffer.format===C,"invalid stencil attachment for framebuffer object"),jr(Ui,pi,Ni),ve(!Ui||Ui.texture&&Ui.texture._texture.format===T||Ui.renderbuffer&&Ui.renderbuffer._renderbuffer.format===T,"invalid depth-stencil attachment for framebuffer object"),Vr(Jr),Jr.width=pi,Jr.height=Ni,Jr.colorAttachments=na,Jr.depthAttachment=us,Jr.stencilAttachment=ni,Jr.depthStencilAttachment=Ui,yi.color=na.map(Xt),yi.depth=Xt(us),yi.stencil=Xt(ni),yi.depthStencil=Xt(Ui),yi.width=Jr.width,yi.height=Jr.height,tr(Jr),yi}function ai(qr,en){ve(er.next!==Jr,"can not resize a framebuffer which is currently in use");var $n=Math.max(qr|0,1),pi=Math.max(en|0||$n,1);if($n===Jr.width&&pi===Jr.height)return yi;for(var Ni=Jr.colorAttachments,co=0;co<Ni.length;++co)br(Ni[co],$n,pi);return br(Jr.depthAttachment,$n,pi),br(Jr.stencilAttachment,$n,pi),br(Jr.depthStencilAttachment,$n,pi),Jr.width=yi.width=$n,Jr.height=yi.height=pi,tr(Jr),yi}return yi(wr,$r),v(yi,{resize:ai,_reglType:"framebuffer",_framebuffer:Jr,destroy:function(){On(Jr),Vr(Jr)},use:function(qr){er.setFBO({framebuffer:yi},qr)}})}function _n(wr){var $r=Array(6);function Jr(ai){var qr;ve($r.indexOf(er.next)<0,"can not update framebuffer which is currently in use");var en={color:null},$n=0,pi=null,Ni="rgba",co="uint8",mo=1;if(typeof ai=="number")$n=ai|0;else if(!ai)$n=1;else{ve.type(ai,"object","invalid arguments for framebuffer");var zi=ai;if("shape"in zi){var os=zi.shape;ve(Array.isArray(os)&&os.length>=2,"invalid shape for framebuffer"),ve(os[0]===os[1],"cube framebuffer must be square"),$n=os[0]}else"radius"in zi&&($n=zi.radius|0),"width"in zi?($n=zi.width|0,"height"in zi&&ve(zi.height===$n,"must be square")):"height"in zi&&($n=zi.height|0);("color"in zi||"colors"in zi)&&(pi=zi.color||zi.colors,Array.isArray(pi)&&ve(pi.length===1||me.webgl_draw_buffers,"multiple render targets not supported")),pi||("colorCount"in zi&&(mo=zi.colorCount|0,ve(mo>0,"invalid color buffer count")),"colorType"in zi&&(ve.oneOf(zi.colorType,rr,"invalid color type"),co=zi.colorType),"colorFormat"in zi&&(Ni=zi.colorFormat,ve.oneOf(zi.colorFormat,fr,"invalid color format for texture"))),"depth"in zi&&(en.depth=zi.depth),"stencil"in zi&&(en.stencil=zi.stencil),"depthStencil"in zi&&(en.depthStencil=zi.depthStencil)}var Ka;if(pi)if(Array.isArray(pi))for(Ka=[],qr=0;qr<pi.length;++qr)Ka[qr]=pi[qr];else Ka=[pi];else{Ka=Array(mo);var Ho={radius:$n,format:Ni,type:co};for(qr=0;qr<mo;++qr)Ka[qr]=Ft.createCube(Ho)}for(en.color=Array(Ka.length),qr=0;qr<Ka.length;++qr){var Eo=Ka[qr];ve(typeof Eo=="function"&&Eo._reglType==="textureCube","invalid cube map"),$n=$n||Eo.width,ve(Eo.width===$n&&Eo.height===$n,"invalid cube map shape"),en.color[qr]={target:gl,data:Ka[qr]}}for(qr=0;qr<6;++qr){for(var ts=0;ts<Ka.length;++ts)en.color[ts].target=gl+qr;qr>0&&(en.depth=$r[0].depth,en.stencil=$r[0].stencil,en.depthStencil=$r[0].depthStencil),$r[qr]?$r[qr](en):$r[qr]=ar(en)}return v(Jr,{width:$n,height:$n,color:Ka})}function yi(ai){var qr,en=ai|0;if(ve(en>0&&en<=ze.maxCubeMapSize,"invalid radius for cube fbo"),en===Jr.width)return Jr;var $n=Jr.color;for(qr=0;qr<$n.length;++qr)$n[qr].resize(en);for(qr=0;qr<6;++qr)$r[qr].resize(en);return Jr.width=Jr.height=en,Jr}return Jr(wr),v(Jr,{faces:$r,resize:yi,_reglType:"framebufferCube",destroy:function(){$r.forEach(function(ai){ai.destroy()})}})}function Gr(){er.cur=null,er.next=null,er.dirty=!0,ne(hr).forEach(function(wr){wr.framebuffer=z.createFramebuffer(),tr(wr)})}return v(er,{getFramebuffer:function(wr){if(typeof wr=="function"&&wr._reglType==="framebuffer"){var $r=wr._framebuffer;if($r instanceof Ar)return $r}return null},create:ar,createCube:_n,clear:function(){ne(hr).forEach(On)},restore:Gr})}var Re=5126,Be=34962,Ae=34963,Ve=["attributes","elements","offset","count","primitive","instances"];function rt(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Re,this.offset=0,this.stride=0,this.divisor=0}function xt(z,me,ze,Ft,lr,Lt,er){for(var fr=ze.maxAttributes,_r=new Array(fr),rr=0;rr<fr;++rr)_r[rr]=new rt;var Sr=0,Rr={},jr={Record:rt,scope:{},state:_r,currentVAO:null,targetVAO:null,restore:Mr()?Vr:function(){},createVAO:On,getVAO:Xt,destroyBuffer:Er,setVAO:Mr()?br:zr,clear:Mr()?hr:function(){}};function Er(tr){for(var ar=0;ar<_r.length;++ar){var _n=_r[ar];_n.buffer===tr&&(z.disableVertexAttribArray(ar),_n.buffer=null)}}function Mr(){return me.oes_vertex_array_object}function ut(){return me.angle_instanced_arrays}function Xt(tr){return typeof tr=="function"&&tr._vao?tr._vao:null}function br(tr){if(tr!==jr.currentVAO){var ar=Mr();tr?ar.bindVertexArrayOES(tr.vao):ar.bindVertexArrayOES(null),jr.currentVAO=tr}}function zr(tr){if(tr!==jr.currentVAO){if(tr)tr.bindAttrs();else{for(var ar=ut(),_n=0;_n<_r.length;++_n){var Gr=_r[_n];Gr.buffer?(z.enableVertexAttribArray(_n),Gr.buffer.bind(),z.vertexAttribPointer(_n,Gr.size,Gr.type,Gr.normalized,Gr.stride,Gr.offfset),ar&&Gr.divisor&&ar.vertexAttribDivisorANGLE(_n,Gr.divisor)):(z.disableVertexAttribArray(_n),z.vertexAttrib4f(_n,Gr.x,Gr.y,Gr.z,Gr.w))}er.elements?z.bindBuffer(Ae,er.elements.buffer.buffer):z.bindBuffer(Ae,null)}jr.currentVAO=tr}}function hr(){ne(Rr).forEach(function(tr){tr.destroy()})}function Ar(){this.id=++Sr,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var tr=Mr();tr?this.vao=tr.createVertexArrayOES():this.vao=null,Rr[this.id]=this,this.buffers=[]}Ar.prototype.bindAttrs=function(){for(var tr=ut(),ar=this.attributes,_n=0;_n<ar.length;++_n){var Gr=ar[_n];Gr.buffer?(z.enableVertexAttribArray(_n),z.bindBuffer(Be,Gr.buffer.buffer),z.vertexAttribPointer(_n,Gr.size,Gr.type,Gr.normalized,Gr.stride,Gr.offset),tr&&Gr.divisor&&tr.vertexAttribDivisorANGLE(_n,Gr.divisor)):(z.disableVertexAttribArray(_n),z.vertexAttrib4f(_n,Gr.x,Gr.y,Gr.z,Gr.w))}for(var wr=ar.length;wr<fr;++wr)z.disableVertexAttribArray(wr);var $r=Lt.getElements(this.elements);$r?z.bindBuffer(Ae,$r.buffer.buffer):z.bindBuffer(Ae,null)},Ar.prototype.refresh=function(){var tr=Mr();tr&&(tr.bindVertexArrayOES(this.vao),this.bindAttrs(),jr.currentVAO=null,tr.bindVertexArrayOES(null))},Ar.prototype.destroy=function(){if(this.vao){var tr=Mr();this===jr.currentVAO&&(jr.currentVAO=null,tr.bindVertexArrayOES(null)),tr.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),Rr[this.id]&&(delete Rr[this.id],Ft.vaoCount-=1)};function Vr(){var tr=Mr();tr&&ne(Rr).forEach(function(ar){ar.refresh()})}function On(tr){var ar=new Ar;Ft.vaoCount+=1;function _n(Gr){var wr;if(Array.isArray(Gr))wr=Gr,ar.elements&&ar.ownsElements&&ar.elements.destroy(),ar.elements=null,ar.ownsElements=!1,ar.offset=0,ar.count=0,ar.instances=-1,ar.primitive=4;else{if(ve(typeof Gr=="object","invalid arguments for create vao"),ve("attributes"in Gr,"must specify attributes for vao"),Gr.elements){var $r=Gr.elements;ar.ownsElements?typeof $r=="function"&&$r._reglType==="elements"?(ar.elements.destroy(),ar.ownsElements=!1):(ar.elements($r),ar.ownsElements=!1):Lt.getElements(Gr.elements)?(ar.elements=Gr.elements,ar.ownsElements=!1):(ar.elements=Lt.create(Gr.elements),ar.ownsElements=!0)}else ar.elements=null,ar.ownsElements=!1;wr=Gr.attributes,ar.offset=0,ar.count=-1,ar.instances=-1,ar.primitive=4,ar.elements&&(ar.count=ar.elements._elements.vertCount,ar.primitive=ar.elements._elements.primType),"offset"in Gr&&(ar.offset=Gr.offset|0),"count"in Gr&&(ar.count=Gr.count|0),"instances"in Gr&&(ar.instances=Gr.instances|0),"primitive"in Gr&&(ve(Gr.primitive in cr,"bad primitive type: "+Gr.primitive),ar.primitive=cr[Gr.primitive]),ve.optional(()=>{for(var co=Object.keys(Gr),mo=0;mo<co.length;++mo)ve(Ve.indexOf(co[mo])>=0,'invalid option for vao: "'+co[mo]+'" valid options are '+Ve)}),ve(Array.isArray(wr),"attributes must be an array")}ve(wr.length<fr,"too many attributes"),ve(wr.length>0,"must specify at least one attribute");var Jr={},yi=ar.attributes;yi.length=wr.length;for(var ai=0;ai<wr.length;++ai){var qr=wr[ai],en=yi[ai]=new rt,$n=qr.data||qr;if(Array.isArray($n)||J($n)||Ds($n)){var pi;ar.buffers[ai]&&(pi=ar.buffers[ai],J($n)&&pi._buffer.byteLength>=$n.byteLength?pi.subdata($n):(pi.destroy(),ar.buffers[ai]=null)),ar.buffers[ai]||(pi=ar.buffers[ai]=lr.create(qr,Be,!1,!0)),en.buffer=lr.getBuffer(pi),en.size=en.buffer.dimension|0,en.normalized=!1,en.type=en.buffer.dtype,en.offset=0,en.stride=0,en.divisor=0,en.state=1,Jr[ai]=1}else lr.getBuffer(qr)?(en.buffer=lr.getBuffer(qr),en.size=en.buffer.dimension|0,en.normalized=!1,en.type=en.buffer.dtype,en.offset=0,en.stride=0,en.divisor=0,en.state=1):lr.getBuffer(qr.buffer)?(en.buffer=lr.getBuffer(qr.buffer),en.size=(+qr.size||en.buffer.dimension)|0,en.normalized=!!qr.normalized||!1,"type"in qr?(ve.parameter(qr.type,su,"invalid buffer type"),en.type=su[qr.type]):en.type=en.buffer.dtype,en.offset=(qr.offset||0)|0,en.stride=(qr.stride||0)|0,en.divisor=(qr.divisor||0)|0,en.state=1,ve(en.size>=1&&en.size<=4,"size must be between 1 and 4"),ve(en.offset>=0,"invalid offset"),ve(en.stride>=0&&en.stride<=255,"stride must be between 0 and 255"),ve(en.divisor>=0,"divisor must be positive"),ve(!en.divisor||!!me.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in qr?(ve(ai>0,"first attribute must not be a constant"),en.x=+qr.x||0,en.y=+qr.y||0,en.z=+qr.z||0,en.w=+qr.w||0,en.state=2):ve(!1,"invalid attribute spec for location "+ai)}for(var Ni=0;Ni<ar.buffers.length;++Ni)!Jr[Ni]&&ar.buffers[Ni]&&(ar.buffers[Ni].destroy(),ar.buffers[Ni]=null);return ar.refresh(),_n}return _n.destroy=function(){for(var Gr=0;Gr<ar.buffers.length;++Gr)ar.buffers[Gr]&&ar.buffers[Gr].destroy();ar.buffers.length=0,ar.ownsElements&&(ar.elements.destroy(),ar.elements=null,ar.ownsElements=!1),ar.destroy()},_n._vao=ar,_n._reglType="vao",_n(tr)}return jr}var Wt=35632,Vt=35633,Ot=35718,vr=35721;function Br(z,me,ze,Ft){var lr={},Lt={};function er(ut,Xt,br,zr){this.name=ut,this.id=Xt,this.location=br,this.info=zr}function fr(ut,Xt){for(var br=0;br<ut.length;++br)if(ut[br].id===Xt.id){ut[br].location=Xt.location;return}ut.push(Xt)}function _r(ut,Xt,br){var zr=ut===Wt?lr:Lt,hr=zr[Xt];if(!hr){var Ar=me.str(Xt);hr=z.createShader(ut),z.shaderSource(hr,Ar),z.compileShader(hr),ve.shaderError(z,hr,Ar,ut,br),zr[Xt]=hr}return hr}var rr={},Sr=[],Rr=0;function jr(ut,Xt){this.id=Rr++,this.fragId=ut,this.vertId=Xt,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,Ft.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function Er(ut,Xt,br){var zr,hr,Ar=_r(Wt,ut.fragId),Vr=_r(Vt,ut.vertId),On=ut.program=z.createProgram();if(z.attachShader(On,Ar),z.attachShader(On,Vr),br)for(zr=0;zr<br.length;++zr){var tr=br[zr];z.bindAttribLocation(On,tr[0],tr[1])}z.linkProgram(On),ve.linkError(z,On,me.str(ut.fragId),me.str(ut.vertId),Xt);var ar=z.getProgramParameter(On,Ot);Ft.profile&&(ut.stats.uniformsCount=ar);var _n=ut.uniforms;for(zr=0;zr<ar;++zr)if(hr=z.getActiveUniform(On,zr),hr)if(hr.size>1)for(var Gr=0;Gr<hr.size;++Gr){var wr=hr.name.replace("[0]","["+Gr+"]");fr(_n,new er(wr,me.id(wr),z.getUniformLocation(On,wr),hr))}else fr(_n,new er(hr.name,me.id(hr.name),z.getUniformLocation(On,hr.name),hr));var $r=z.getProgramParameter(On,vr);Ft.profile&&(ut.stats.attributesCount=$r);var Jr=ut.attributes;for(zr=0;zr<$r;++zr)hr=z.getActiveAttrib(On,zr),hr&&fr(Jr,new er(hr.name,me.id(hr.name),z.getAttribLocation(On,hr.name),hr))}Ft.profile&&(ze.getMaxUniformsCount=function(){var ut=0;return Sr.forEach(function(Xt){Xt.stats.uniformsCount>ut&&(ut=Xt.stats.uniformsCount)}),ut},ze.getMaxAttributesCount=function(){var ut=0;return Sr.forEach(function(Xt){Xt.stats.attributesCount>ut&&(ut=Xt.stats.attributesCount)}),ut});function Mr(){lr={},Lt={};for(var ut=0;ut<Sr.length;++ut)Er(Sr[ut],null,Sr[ut].attributes.map(function(Xt){return[Xt.location,Xt.name]}))}return{clear:function(){var ut=z.deleteShader.bind(z);ne(lr).forEach(ut),lr={},ne(Lt).forEach(ut),Lt={},Sr.forEach(function(Xt){z.deleteProgram(Xt.program)}),Sr.length=0,rr={},ze.shaderCount=0},program:function(ut,Xt,br,zr){ve.command(ut>=0,"missing vertex shader",br),ve.command(Xt>=0,"missing fragment shader",br);var hr=rr[Xt];hr||(hr=rr[Xt]={});var Ar=hr[ut];if(Ar&&(Ar.refCount++,!zr))return Ar;var Vr=new jr(Xt,ut);return ze.shaderCount++,Er(Vr,br,zr),Ar||(hr[ut]=Vr),Sr.push(Vr),v(Vr,{destroy:function(){if(Vr.refCount--,Vr.refCount<=0){z.deleteProgram(Vr.program);var On=Sr.indexOf(Vr);Sr.splice(On,1),ze.shaderCount--}hr[Vr.vertId].refCount<=0&&(z.deleteShader(Lt[Vr.vertId]),delete Lt[Vr.vertId],delete rr[Vr.fragId][Vr.vertId]),Object.keys(rr[Vr.fragId]).length||(z.deleteShader(lr[Vr.fragId]),delete lr[Vr.fragId],delete rr[Vr.fragId])}})},restore:Mr,shader:_r,frag:-1,vert:-1}}var Dr=6408,an=5121,Bn=3333,kn=5126;function Nn(z,me,ze,Ft,lr,Lt,er){function fr(Sr){var Rr;me.next===null?(ve(lr.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),Rr=an):(ve(me.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),Rr=me.next.colorAttachments[0].texture._texture.type,ve.optional(function(){Lt.oes_texture_float?(ve(Rr===an||Rr===kn,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),Rr===kn&&ve(er.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):ve(Rr===an,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var jr=0,Er=0,Mr=Ft.framebufferWidth,ut=Ft.framebufferHeight,Xt=null;J(Sr)?Xt=Sr:Sr&&(ve.type(Sr,"object","invalid arguments to regl.read()"),jr=Sr.x|0,Er=Sr.y|0,ve(jr>=0&&jr<Ft.framebufferWidth,"invalid x offset for regl.read"),ve(Er>=0&&Er<Ft.framebufferHeight,"invalid y offset for regl.read"),Mr=(Sr.width||Ft.framebufferWidth-jr)|0,ut=(Sr.height||Ft.framebufferHeight-Er)|0,Xt=Sr.data||null),Xt&&(Rr===an?ve(Xt instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):Rr===kn&&ve(Xt instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),ve(Mr>0&&Mr+jr<=Ft.framebufferWidth,"invalid width for read pixels"),ve(ut>0&&ut+Er<=Ft.framebufferHeight,"invalid height for read pixels"),ze();var br=Mr*ut*4;return Xt||(Rr===an?Xt=new Uint8Array(br):Rr===kn&&(Xt=Xt||new Float32Array(br))),ve.isTypedArray(Xt,"data buffer for regl.read() must be a typedarray"),ve(Xt.byteLength>=br,"data buffer for regl.read() too small"),z.pixelStorei(Bn,4),z.readPixels(jr,Er,Mr,ut,Dr,Rr,Xt),Xt}function _r(Sr){var Rr;return me.setFBO({framebuffer:Sr.framebuffer},function(){Rr=fr(Sr)}),Rr}function rr(Sr){return!Sr||!("framebuffer"in Sr)?fr(Sr):_r(Sr)}return rr}function Bi(z){return Array.prototype.slice.call(z)}function on(z){return Bi(z).join("")}function si(){var z=0,me=[],ze=[];function Ft(Rr){for(var jr=0;jr<ze.length;++jr)if(ze[jr]===Rr)return me[jr];var Er="g"+z++;return me.push(Er),ze.push(Rr),Er}function lr(){var Rr=[];function jr(){Rr.push.apply(Rr,Bi(arguments))}var Er=[];function Mr(){var ut="v"+z++;return Er.push(ut),arguments.length>0&&(Rr.push(ut,"="),Rr.push.apply(Rr,Bi(arguments)),Rr.push(";")),ut}return v(jr,{def:Mr,toString:function(){return on([Er.length>0?"var "+Er.join(",")+";":"",on(Rr)])}})}function Lt(){var Rr=lr(),jr=lr(),Er=Rr.toString,Mr=jr.toString;function ut(Xt,br){jr(Xt,br,"=",Rr.def(Xt,br),";")}return v(function(){Rr.apply(Rr,Bi(arguments))},{def:Rr.def,entry:Rr,exit:jr,save:ut,set:function(Xt,br,zr){ut(Xt,br),Rr(Xt,br,"=",zr,";")},toString:function(){return Er()+Mr()}})}function er(){var Rr=on(arguments),jr=Lt(),Er=Lt(),Mr=jr.toString,ut=Er.toString;return v(jr,{then:function(){return jr.apply(jr,Bi(arguments)),this},else:function(){return Er.apply(Er,Bi(arguments)),this},toString:function(){var Xt=ut();return Xt&&(Xt="else{"+Xt+"}"),on(["if(",Rr,"){",Mr(),"}",Xt])}})}var fr=lr(),_r={};function rr(Rr,jr){var Er=[];function Mr(){var hr="a"+Er.length;return Er.push(hr),hr}jr=jr||0;for(var ut=0;ut<jr;++ut)Mr();var Xt=Lt(),br=Xt.toString,zr=_r[Rr]=v(Xt,{arg:Mr,toString:function(){return on(["function(",Er.join(),"){",br(),"}"])}});return zr}function Sr(){var Rr=['"use strict";',fr,"return {"];Object.keys(_r).forEach(function(ut){Rr.push('"',ut,'":',_r[ut].toString(),",")}),Rr.push("}");var jr=on(Rr).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),Er=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",Mr=Er?Y.Function.apply(null,me.concat(jr)):Function.apply(null,me.concat(jr));return Mr.apply(null,ze)}return{global:fr,link:Ft,block:lr,proc:rr,scope:Lt,cond:er,compile:Sr}}var hi="xyzw".split(""),ri=5121,Hn=1,mi=2,Rn=0,Wn=1,Ha=2,eo=3,bo=4,To=5,to=6,vo="dither",Is="blend.enable",gs="blend.color",Va="blend.equation",ca="blend.func",Os="depth.enable",Gs="depth.func",Eu="depth.range",rc="depth.mask",tl="colorMask",nc="cull.enable",Rc="cull.face",tu="frontFace",ys="lineWidth",ku="polygonOffset.enable",Fo="polygonOffset.offset",rl="sample.alpha",Hs="sample.enable",Su="sample.coverage",Qi="stencil.enable",Rs="stencil.mask",as="stencil.func",fu="stencil.opFront",xl="stencil.opBack",ic="scissor.enable",Lc="scissor.box",Ls="viewport",Fl="profile",hu="framebuffer",nl="vert",Ws="frag",pu="elements",Go="primitive",kc="count",Ff="offset",yh="instances",Bf="vao",qh="Width",Nf="Height",Cs=hu+qh,of=hu+Nf,_h=Ls+qh,Kh=Ls+Nf,bl="drawingBuffer",Dc=bl+qh,$h=bl+Nf,Ad=[ca,Va,as,fu,xl,Su,Ls,Lc,Fo],sf=34962,Jh=34963,Np=35632,wd=35633,zp=3553,Qh=34067,Up=2884,Fc=3042,Td=3024,Bo=2960,xh=2929,Zp=3089,bh=32823,zf=32926,Uf=32928,Zf=5126,Bc=35664,ac=35665,uf=35666,jf=5124,Eh=35667,oc=35668,Sh=35669,El=35670,Ch=35671,lf=35672,cf=35673,ru=35674,ff=35675,hf=35676,Vf=35678,Gf=35680,Hf=4,il=1028,Nc=1029,jp=2304,Ah=2305,Vp=32775,Md=32776,yv=519,Lr=7680,Gp=0,$t=1,pf=32774,al=513,ep=36160,Hp=36064,ol={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},df=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],sc={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Du={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Wp={frag:Np,vert:wd},tp={cw:jp,ccw:Ah};function Wf(z){return Array.isArray(z)||J(z)||Ds(z)}function wh(z){return z.sort(function(me,ze){return me===Ls?-1:ze===Ls?1:me<ze?-1:1})}function ya(z,me,ze,Ft){this.thisDep=z,this.contextDep=me,this.propDep=ze,this.append=Ft}function Bl(z){return z&&!(z.thisDep||z.contextDep||z.propDep)}function Mo(z){return new ya(!1,!1,!1,z)}function nu(z,me){var ze=z.type;if(ze===Rn){var Ft=z.data.length;return new ya(!0,Ft>=1,Ft>=2,me)}else if(ze===bo){var lr=z.data;return new ya(lr.thisDep,lr.contextDep,lr.propDep,me)}else{if(ze===To)return new ya(!1,!1,!1,me);if(ze===to){for(var Lt=!1,er=!1,fr=!1,_r=0;_r<z.data.length;++_r){var rr=z.data[_r];if(rr.type===Wn)fr=!0;else if(rr.type===Ha)er=!0;else if(rr.type===eo)Lt=!0;else if(rr.type===Rn){Lt=!0;var Sr=rr.data;Sr>=1&&(er=!0),Sr>=2&&(fr=!0)}else rr.type===bo&&(Lt=Lt||rr.data.thisDep,er=er||rr.data.contextDep,fr=fr||rr.data.propDep)}return new ya(Lt,er,fr,me)}else return new ya(ze===eo,ze===Ha,ze===Wn,me)}}var rp=new ya(!1,!1,!1,function(){});function np(z,me,ze,Ft,lr,Lt,er,fr,_r,rr,Sr,Rr,jr,Er,Mr){var ut=rr.Record,Xt={add:32774,subtract:32778,"reverse subtract":32779};ze.ext_blend_minmax&&(Xt.min=Vp,Xt.max=Md);var br=ze.angle_instanced_arrays,zr=ze.webgl_draw_buffers,hr=ze.oes_vertex_array_object,Ar={dirty:!0,profile:Mr.profile},Vr={},On=[],tr={},ar={};function _n(Se){return Se.replace(".","_")}function Gr(Se,ce,He){var ht=_n(Se);On.push(Se),Vr[ht]=Ar[ht]=!!He,tr[ht]=ce}function wr(Se,ce,He){var ht=_n(Se);On.push(Se),Array.isArray(He)?(Ar[ht]=He.slice(),Vr[ht]=He.slice()):Ar[ht]=Vr[ht]=He,ar[ht]=ce}Gr(vo,Td),Gr(Is,Fc),wr(gs,"blendColor",[0,0,0,0]),wr(Va,"blendEquationSeparate",[pf,pf]),wr(ca,"blendFuncSeparate",[$t,Gp,$t,Gp]),Gr(Os,xh,!0),wr(Gs,"depthFunc",al),wr(Eu,"depthRange",[0,1]),wr(rc,"depthMask",!0),wr(tl,tl,[!0,!0,!0,!0]),Gr(nc,Up),wr(Rc,"cullFace",Nc),wr(tu,tu,Ah),wr(ys,ys,1),Gr(ku,bh),wr(Fo,"polygonOffset",[0,0]),Gr(rl,zf),Gr(Hs,Uf),wr(Su,"sampleCoverage",[1,!1]),Gr(Qi,Bo),wr(Rs,"stencilMask",-1),wr(as,"stencilFunc",[yv,0,-1]),wr(fu,"stencilOpSeparate",[il,Lr,Lr,Lr]),wr(xl,"stencilOpSeparate",[Nc,Lr,Lr,Lr]),Gr(ic,Zp),wr(Lc,"scissor",[0,0,z.drawingBufferWidth,z.drawingBufferHeight]),wr(Ls,Ls,[0,0,z.drawingBufferWidth,z.drawingBufferHeight]);var $r={gl:z,context:jr,strings:me,next:Vr,current:Ar,draw:Rr,elements:Lt,buffer:lr,shader:Sr,attributes:rr.state,vao:rr,uniforms:_r,framebuffer:fr,extensions:ze,timer:Er,isBufferArgs:Wf},Jr={primTypes:cr,compareFuncs:sc,blendFuncs:ol,blendEquations:Xt,stencilOps:Du,glTypes:su,orientationType:tp};ve.optional(function(){$r.isArrayLike=va}),zr&&(Jr.backBuffer=[Nc],Jr.drawBuffer=We(Ft.maxDrawbuffers,function(Se){return Se===0?[0]:We(Se,function(ce){return Hp+ce})}));var yi=0;function ai(){var Se=si(),ce=Se.link,He=Se.global;Se.id=yi++,Se.batchId="0";var ht=ce($r),Pt=Se.shared={props:"a0"};Object.keys($r).forEach(function(je){Pt[je]=He.def(ht,".",je)}),ve.optional(function(){Se.CHECK=ce(ve),Se.commandStr=ve.guessCommand(),Se.command=ce(Se.commandStr),Se.assert=function(je,we,pt){je("if(!(",we,"))",this.CHECK,".commandRaise(",ce(pt),",",this.command,");")},Jr.invalidBlendCombinations=df});var Je=Se.next={},Ne=Se.current={};Object.keys(ar).forEach(function(je){Array.isArray(Ar[je])&&(Je[je]=He.def(Pt.next,".",je),Ne[je]=He.def(Pt.current,".",je))});var it=Se.constants={};Object.keys(Jr).forEach(function(je){it[je]=He.def(JSON.stringify(Jr[je]))}),Se.invoke=function(je,we){switch(we.type){case Rn:var pt=["this",Pt.context,Pt.props,Se.batchId];return je.def(ce(we.data),".call(",pt.slice(0,Math.max(we.data.length+1,4)),")");case Wn:return je.def(Pt.props,we.data);case Ha:return je.def(Pt.context,we.data);case eo:return je.def("this",we.data);case bo:return we.data.append(Se,je),we.data.ref;case To:return we.data.toString();case to:return we.data.map(function(Et){return Se.invoke(je,Et)})}},Se.attribCache={};var ye={};return Se.scopeAttrib=function(je){var we=me.id(je);if(we in ye)return ye[we];var pt=rr.scope[we];pt||(pt=rr.scope[we]=new ut);var Et=ye[we]=ce(pt);return Et},Se}function qr(Se){var ce=Se.static,He=Se.dynamic,ht;if(Fl in ce){var Pt=!!ce[Fl];ht=Mo(function(Ne,it){return Pt}),ht.enable=Pt}else if(Fl in He){var Je=He[Fl];ht=nu(Je,function(Ne,it){return Ne.invoke(it,Je)})}return ht}function en(Se,ce){var He=Se.static,ht=Se.dynamic;if(hu in He){var Pt=He[hu];return Pt?(Pt=fr.getFramebuffer(Pt),ve.command(Pt,"invalid framebuffer object"),Mo(function(Ne,it){var ye=Ne.link(Pt),je=Ne.shared;it.set(je.framebuffer,".next",ye);var we=je.context;return it.set(we,"."+Cs,ye+".width"),it.set(we,"."+of,ye+".height"),ye})):Mo(function(Ne,it){var ye=Ne.shared;it.set(ye.framebuffer,".next","null");var je=ye.context;return it.set(je,"."+Cs,je+"."+Dc),it.set(je,"."+of,je+"."+$h),"null"})}else if(hu in ht){var Je=ht[hu];return nu(Je,function(Ne,it){var ye=Ne.invoke(it,Je),je=Ne.shared,we=je.framebuffer,pt=it.def(we,".getFramebuffer(",ye,")");ve.optional(function(){Ne.assert(it,"!"+ye+"||"+pt,"invalid framebuffer object")}),it.set(we,".next",pt);var Et=je.context;return it.set(Et,"."+Cs,pt+"?"+pt+".width:"+Et+"."+Dc),it.set(Et,"."+of,pt+"?"+pt+".height:"+Et+"."+$h),pt})}else return null}function $n(Se,ce,He){var ht=Se.static,Pt=Se.dynamic;function Je(ye){if(ye in ht){var je=ht[ye];ve.commandType(je,"object","invalid "+ye,He.commandStr);var we=!0,pt=je.x|0,Et=je.y|0,pr,Ur;return"width"in je?(pr=je.width|0,ve.command(pr>=0,"invalid "+ye,He.commandStr)):we=!1,"height"in je?(Ur=je.height|0,ve.command(Ur>=0,"invalid "+ye,He.commandStr)):we=!1,new ya(!we&&ce&&ce.thisDep,!we&&ce&&ce.contextDep,!we&&ce&&ce.propDep,function(Fr,Sn){var sn=Fr.shared.context,bn=pr;"width"in je||(bn=Sn.def(sn,".",Cs,"-",pt));var vn=Ur;return"height"in je||(vn=Sn.def(sn,".",of,"-",Et)),[pt,Et,bn,vn]})}else if(ye in Pt){var Nr=Pt[ye],tn=nu(Nr,function(Fr,Sn){var sn=Fr.invoke(Sn,Nr);ve.optional(function(){Fr.assert(Sn,sn+"&&typeof "+sn+'==="object"',"invalid "+ye)});var bn=Fr.shared.context,vn=Sn.def(sn,".x|0"),mn=Sn.def(sn,".y|0"),Kn=Sn.def('"width" in ',sn,"?",sn,".width|0:","(",bn,".",Cs,"-",vn,")"),wa=Sn.def('"height" in ',sn,"?",sn,".height|0:","(",bn,".",of,"-",mn,")");return ve.optional(function(){Fr.assert(Sn,Kn+">=0&&"+wa+">=0","invalid "+ye)}),[vn,mn,Kn,wa]});return ce&&(tn.thisDep=tn.thisDep||ce.thisDep,tn.contextDep=tn.contextDep||ce.contextDep,tn.propDep=tn.propDep||ce.propDep),tn}else return ce?new ya(ce.thisDep,ce.contextDep,ce.propDep,function(Fr,Sn){var sn=Fr.shared.context;return[0,0,Sn.def(sn,".",Cs),Sn.def(sn,".",of)]}):null}var Ne=Je(Ls);if(Ne){var it=Ne;Ne=new ya(Ne.thisDep,Ne.contextDep,Ne.propDep,function(ye,je){var we=it.append(ye,je),pt=ye.shared.context;return je.set(pt,"."+_h,we[2]),je.set(pt,"."+Kh,we[3]),we})}return{viewport:Ne,scissor_box:Je(Lc)}}function pi(Se,ce){var He=Se.static,ht=typeof He[Ws]=="string"&&typeof He[nl]=="string";if(ht){if(Object.keys(ce.dynamic).length>0)return null;var Pt=ce.static,Je=Object.keys(Pt);if(Je.length>0&&typeof Pt[Je[0]]=="number"){for(var Ne=[],it=0;it<Je.length;++it)ve(typeof Pt[Je[it]]=="number","must specify all vertex attribute locations when using vaos"),Ne.push([Pt[Je[it]]|0,Je[it]]);return Ne}}return null}function Ni(Se,ce,He){var ht=Se.static,Pt=Se.dynamic;function Je(we){if(we in ht){var pt=me.id(ht[we]);ve.optional(function(){Sr.shader(Wp[we],pt,ve.guessCommand())});var Et=Mo(function(){return pt});return Et.id=pt,Et}else if(we in Pt){var pr=Pt[we];return nu(pr,function(Ur,Nr){var tn=Ur.invoke(Nr,pr),Fr=Nr.def(Ur.shared.strings,".id(",tn,")");return ve.optional(function(){Nr(Ur.shared.shader,".shader(",Wp[we],",",Fr,",",Ur.command,");")}),Fr})}return null}var Ne=Je(Ws),it=Je(nl),ye=null,je;return Bl(Ne)&&Bl(it)?(ye=Sr.program(it.id,Ne.id,null,He),je=Mo(function(we,pt){return we.link(ye)})):je=new ya(Ne&&Ne.thisDep||it&&it.thisDep,Ne&&Ne.contextDep||it&&it.contextDep,Ne&&Ne.propDep||it&&it.propDep,function(we,pt){var Et=we.shared.shader,pr;Ne?pr=Ne.append(we,pt):pr=pt.def(Et,".",Ws);var Ur;it?Ur=it.append(we,pt):Ur=pt.def(Et,".",nl);var Nr=Et+".program("+Ur+","+pr;return ve.optional(function(){Nr+=","+we.command}),pt.def(Nr+")")}),{frag:Ne,vert:it,progVar:je,program:ye}}function co(Se,ce){var He=Se.static,ht=Se.dynamic,Pt={},Je=!1;function Ne(){if(Bf in He){var Sn=He[Bf];return Sn!==null&&rr.getVAO(Sn)===null&&(Sn=rr.createVAO(Sn)),Je=!0,Pt.vao=Sn,Mo(function(bn){var vn=rr.getVAO(Sn);return vn?bn.link(vn):"null"})}else if(Bf in ht){Je=!0;var sn=ht[Bf];return nu(sn,function(bn,vn){var mn=bn.invoke(vn,sn);return vn.def(bn.shared.vao+".getVAO("+mn+")")})}return null}var it=Ne(),ye=!1;function je(){if(pu in He){var Sn=He[pu];if(Pt.elements=Sn,Wf(Sn)){var sn=Pt.elements=Lt.create(Sn,!0);Sn=Lt.getElements(sn),ye=!0}else Sn&&(Sn=Lt.getElements(Sn),ye=!0,ve.command(Sn,"invalid elements",ce.commandStr));var bn=Mo(function(mn,Kn){if(Sn){var wa=mn.link(Sn);return mn.ELEMENTS=wa,wa}return mn.ELEMENTS=null,null});return bn.value=Sn,bn}else if(pu in ht){ye=!0;var vn=ht[pu];return nu(vn,function(mn,Kn){var wa=mn.shared,Vn=wa.isBufferArgs,wn=wa.elements,ha=mn.invoke(Kn,vn),Nl=Kn.def("null"),ks=Kn.def(Vn,"(",ha,")"),Cl=mn.cond(ks).then(Nl,"=",wn,".createStream(",ha,");").else(Nl,"=",wn,".getElements(",ha,");");return ve.optional(function(){mn.assert(Cl.else,"!"+ha+"||"+Nl,"invalid elements")}),Kn.entry(Cl),Kn.exit(mn.cond(ks).then(wn,".destroyStream(",Nl,");")),mn.ELEMENTS=Nl,Nl})}else if(Je)return new ya(it.thisDep,it.contextDep,it.propDep,function(mn,Kn){return Kn.def(mn.shared.vao+".currentVAO?"+mn.shared.elements+".getElements("+mn.shared.vao+".currentVAO.elements):null")});return null}var we=je();function pt(){if(Go in He){var Sn=He[Go];return Pt.primitive=Sn,ve.commandParameter(Sn,cr,"invalid primitve",ce.commandStr),Mo(function(bn,vn){return cr[Sn]})}else if(Go in ht){var sn=ht[Go];return nu(sn,function(bn,vn){var mn=bn.constants.primTypes,Kn=bn.invoke(vn,sn);return ve.optional(function(){bn.assert(vn,Kn+" in "+mn,"invalid primitive, must be one of "+Object.keys(cr))}),vn.def(mn,"[",Kn,"]")})}else{if(ye)return Bl(we)?we.value?Mo(function(bn,vn){return vn.def(bn.ELEMENTS,".primType")}):Mo(function(){return Hf}):new ya(we.thisDep,we.contextDep,we.propDep,function(bn,vn){var mn=bn.ELEMENTS;return vn.def(mn,"?",mn,".primType:",Hf)});if(Je)return new ya(it.thisDep,it.contextDep,it.propDep,function(bn,vn){return vn.def(bn.shared.vao+".currentVAO?"+bn.shared.vao+".currentVAO.primitive:"+Hf)})}return null}function Et(Sn,sn){if(Sn in He){var bn=He[Sn]|0;return sn?Pt.offset=bn:Pt.instances=bn,ve.command(!sn||bn>=0,"invalid "+Sn,ce.commandStr),Mo(function(mn,Kn){return sn&&(mn.OFFSET=bn),bn})}else if(Sn in ht){var vn=ht[Sn];return nu(vn,function(mn,Kn){var wa=mn.invoke(Kn,vn);return sn&&(mn.OFFSET=wa,ve.optional(function(){mn.assert(Kn,wa+">=0","invalid "+Sn)})),wa})}else if(sn){if(ye)return Mo(function(mn,Kn){return mn.OFFSET=0,0});if(Je)return new ya(it.thisDep,it.contextDep,it.propDep,function(mn,Kn){return Kn.def(mn.shared.vao+".currentVAO?"+mn.shared.vao+".currentVAO.offset:0")})}else if(Je)return new ya(it.thisDep,it.contextDep,it.propDep,function(mn,Kn){return Kn.def(mn.shared.vao+".currentVAO?"+mn.shared.vao+".currentVAO.instances:-1")});return null}var pr=Et(Ff,!0);function Ur(){if(kc in He){var Sn=He[kc]|0;return Pt.count=Sn,ve.command(typeof Sn=="number"&&Sn>=0,"invalid vertex count",ce.commandStr),Mo(function(){return Sn})}else if(kc in ht){var sn=ht[kc];return nu(sn,function(Kn,wa){var Vn=Kn.invoke(wa,sn);return ve.optional(function(){Kn.assert(wa,"typeof "+Vn+'==="number"&&'+Vn+">=0&&"+Vn+"===("+Vn+"|0)","invalid vertex count")}),Vn})}else if(ye)if(Bl(we)){if(we)return pr?new ya(pr.thisDep,pr.contextDep,pr.propDep,function(Kn,wa){var Vn=wa.def(Kn.ELEMENTS,".vertCount-",Kn.OFFSET);return ve.optional(function(){Kn.assert(wa,Vn+">=0","invalid vertex offset/element buffer too small")}),Vn}):Mo(function(Kn,wa){return wa.def(Kn.ELEMENTS,".vertCount")});var bn=Mo(function(){return-1});return ve.optional(function(){bn.MISSING=!0}),bn}else{var vn=new ya(we.thisDep||pr.thisDep,we.contextDep||pr.contextDep,we.propDep||pr.propDep,function(Kn,wa){var Vn=Kn.ELEMENTS;return Kn.OFFSET?wa.def(Vn,"?",Vn,".vertCount-",Kn.OFFSET,":-1"):wa.def(Vn,"?",Vn,".vertCount:-1")});return ve.optional(function(){vn.DYNAMIC=!0}),vn}else if(Je){var mn=new ya(it.thisDep,it.contextDep,it.propDep,function(Kn,wa){return wa.def(Kn.shared.vao,".currentVAO?",Kn.shared.vao,".currentVAO.count:-1")});return mn}return null}var Nr=pt(),tn=Ur(),Fr=Et(yh,!1);return{elements:we,primitive:Nr,count:tn,instances:Fr,offset:pr,vao:it,vaoActive:Je,elementsActive:ye,static:Pt}}function mo(Se,ce){var He=Se.static,ht=Se.dynamic,Pt={};return On.forEach(function(Je){var Ne=_n(Je);function it(ye,je){if(Je in He){var we=ye(He[Je]);Pt[Ne]=Mo(function(){return we})}else if(Je in ht){var pt=ht[Je];Pt[Ne]=nu(pt,function(Et,pr){return je(Et,pr,Et.invoke(pr,pt))})}}switch(Je){case nc:case Is:case vo:case Qi:case Os:case ic:case ku:case rl:case Hs:case rc:return it(function(ye){return ve.commandType(ye,"boolean",Je,ce.commandStr),ye},function(ye,je,we){return ve.optional(function(){ye.assert(je,"typeof "+we+'==="boolean"',"invalid flag "+Je,ye.commandStr)}),we});case Gs:return it(function(ye){return ve.commandParameter(ye,sc,"invalid "+Je,ce.commandStr),sc[ye]},function(ye,je,we){var pt=ye.constants.compareFuncs;return ve.optional(function(){ye.assert(je,we+" in "+pt,"invalid "+Je+", must be one of "+Object.keys(sc))}),je.def(pt,"[",we,"]")});case Eu:return it(function(ye){return ve.command(va(ye)&&ye.length===2&&typeof ye[0]=="number"&&typeof ye[1]=="number"&&ye[0]<=ye[1],"depth range is 2d array",ce.commandStr),ye},function(ye,je,we){ve.optional(function(){ye.assert(je,ye.shared.isArrayLike+"("+we+")&&"+we+".length===2&&typeof "+we+'[0]==="number"&&typeof '+we+'[1]==="number"&&'+we+"[0]<="+we+"[1]","depth range must be a 2d array")});var pt=je.def("+",we,"[0]"),Et=je.def("+",we,"[1]");return[pt,Et]});case ca:return it(function(ye){ve.commandType(ye,"object","blend.func",ce.commandStr);var je="srcRGB"in ye?ye.srcRGB:ye.src,we="srcAlpha"in ye?ye.srcAlpha:ye.src,pt="dstRGB"in ye?ye.dstRGB:ye.dst,Et="dstAlpha"in ye?ye.dstAlpha:ye.dst;return ve.commandParameter(je,ol,Ne+".srcRGB",ce.commandStr),ve.commandParameter(we,ol,Ne+".srcAlpha",ce.commandStr),ve.commandParameter(pt,ol,Ne+".dstRGB",ce.commandStr),ve.commandParameter(Et,ol,Ne+".dstAlpha",ce.commandStr),ve.command(df.indexOf(je+", "+pt)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+je+", "+pt+")",ce.commandStr),[ol[je],ol[pt],ol[we],ol[Et]]},function(ye,je,we){var pt=ye.constants.blendFuncs;ve.optional(function(){ye.assert(je,we+"&&typeof "+we+'==="object"',"invalid blend func, must be an object")});function Et(sn,bn){var vn=je.def('"',sn,bn,'" in ',we,"?",we,".",sn,bn,":",we,".",sn);return ve.optional(function(){ye.assert(je,vn+" in "+pt,"invalid "+Je+"."+sn+bn+", must be one of "+Object.keys(ol))}),vn}var pr=Et("src","RGB"),Ur=Et("dst","RGB");ve.optional(function(){var sn=ye.constants.invalidBlendCombinations;ye.assert(je,sn+".indexOf("+pr+'+", "+'+Ur+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var Nr=je.def(pt,"[",pr,"]"),tn=je.def(pt,"[",Et("src","Alpha"),"]"),Fr=je.def(pt,"[",Ur,"]"),Sn=je.def(pt,"[",Et("dst","Alpha"),"]");return[Nr,Fr,tn,Sn]});case Va:return it(function(ye){if(typeof ye=="string")return ve.commandParameter(ye,Xt,"invalid "+Je,ce.commandStr),[Xt[ye],Xt[ye]];if(typeof ye=="object")return ve.commandParameter(ye.rgb,Xt,Je+".rgb",ce.commandStr),ve.commandParameter(ye.alpha,Xt,Je+".alpha",ce.commandStr),[Xt[ye.rgb],Xt[ye.alpha]];ve.commandRaise("invalid blend.equation",ce.commandStr)},function(ye,je,we){var pt=ye.constants.blendEquations,Et=je.def(),pr=je.def(),Ur=ye.cond("typeof ",we,'==="string"');return ve.optional(function(){function Nr(tn,Fr,Sn){ye.assert(tn,Sn+" in "+pt,"invalid "+Fr+", must be one of "+Object.keys(Xt))}Nr(Ur.then,Je,we),ye.assert(Ur.else,we+"&&typeof "+we+'==="object"',"invalid "+Je),Nr(Ur.else,Je+".rgb",we+".rgb"),Nr(Ur.else,Je+".alpha",we+".alpha")}),Ur.then(Et,"=",pr,"=",pt,"[",we,"];"),Ur.else(Et,"=",pt,"[",we,".rgb];",pr,"=",pt,"[",we,".alpha];"),je(Ur),[Et,pr]});case gs:return it(function(ye){return ve.command(va(ye)&&ye.length===4,"blend.color must be a 4d array",ce.commandStr),We(4,function(je){return+ye[je]})},function(ye,je,we){return ve.optional(function(){ye.assert(je,ye.shared.isArrayLike+"("+we+")&&"+we+".length===4","blend.color must be a 4d array")}),We(4,function(pt){return je.def("+",we,"[",pt,"]")})});case Rs:return it(function(ye){return ve.commandType(ye,"number",Ne,ce.commandStr),ye|0},function(ye,je,we){return ve.optional(function(){ye.assert(je,"typeof "+we+'==="number"',"invalid stencil.mask")}),je.def(we,"|0")});case as:return it(function(ye){ve.commandType(ye,"object",Ne,ce.commandStr);var je=ye.cmp||"keep",we=ye.ref||0,pt="mask"in ye?ye.mask:-1;return ve.commandParameter(je,sc,Je+".cmp",ce.commandStr),ve.commandType(we,"number",Je+".ref",ce.commandStr),ve.commandType(pt,"number",Je+".mask",ce.commandStr),[sc[je],we,pt]},function(ye,je,we){var pt=ye.constants.compareFuncs;ve.optional(function(){function Nr(){ye.assert(je,Array.prototype.join.call(arguments,""),"invalid stencil.func")}Nr(we+"&&typeof ",we,'==="object"'),Nr('!("cmp" in ',we,")||(",we,".cmp in ",pt,")")});var Et=je.def('"cmp" in ',we,"?",pt,"[",we,".cmp]",":",Lr),pr=je.def(we,".ref|0"),Ur=je.def('"mask" in ',we,"?",we,".mask|0:-1");return[Et,pr,Ur]});case fu:case xl:return it(function(ye){ve.commandType(ye,"object",Ne,ce.commandStr);var je=ye.fail||"keep",we=ye.zfail||"keep",pt=ye.zpass||"keep";return ve.commandParameter(je,Du,Je+".fail",ce.commandStr),ve.commandParameter(we,Du,Je+".zfail",ce.commandStr),ve.commandParameter(pt,Du,Je+".zpass",ce.commandStr),[Je===xl?Nc:il,Du[je],Du[we],Du[pt]]},function(ye,je,we){var pt=ye.constants.stencilOps;ve.optional(function(){ye.assert(je,we+"&&typeof "+we+'==="object"',"invalid "+Je)});function Et(pr){return ve.optional(function(){ye.assert(je,'!("'+pr+'" in '+we+")||("+we+"."+pr+" in "+pt+")","invalid "+Je+"."+pr+", must be one of "+Object.keys(Du))}),je.def('"',pr,'" in ',we,"?",pt,"[",we,".",pr,"]:",Lr)}return[Je===xl?Nc:il,Et("fail"),Et("zfail"),Et("zpass")]});case Fo:return it(function(ye){ve.commandType(ye,"object",Ne,ce.commandStr);var je=ye.factor|0,we=ye.units|0;return ve.commandType(je,"number",Ne+".factor",ce.commandStr),ve.commandType(we,"number",Ne+".units",ce.commandStr),[je,we]},function(ye,je,we){ve.optional(function(){ye.assert(je,we+"&&typeof "+we+'==="object"',"invalid "+Je)});var pt=je.def(we,".factor|0"),Et=je.def(we,".units|0");return[pt,Et]});case Rc:return it(function(ye){var je=0;return ye==="front"?je=il:ye==="back"&&(je=Nc),ve.command(!!je,Ne,ce.commandStr),je},function(ye,je,we){return ve.optional(function(){ye.assert(je,we+'==="front"||'+we+'==="back"',"invalid cull.face")}),je.def(we,'==="front"?',il,":",Nc)});case ys:return it(function(ye){return ve.command(typeof ye=="number"&&ye>=Ft.lineWidthDims[0]&&ye<=Ft.lineWidthDims[1],"invalid line width, must be a positive number between "+Ft.lineWidthDims[0]+" and "+Ft.lineWidthDims[1],ce.commandStr),ye},function(ye,je,we){return ve.optional(function(){ye.assert(je,"typeof "+we+'==="number"&&'+we+">="+Ft.lineWidthDims[0]+"&&"+we+"<="+Ft.lineWidthDims[1],"invalid line width")}),we});case tu:return it(function(ye){return ve.commandParameter(ye,tp,Ne,ce.commandStr),tp[ye]},function(ye,je,we){return ve.optional(function(){ye.assert(je,we+'==="cw"||'+we+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),je.def(we+'==="cw"?'+jp+":"+Ah)});case tl:return it(function(ye){return ve.command(va(ye)&&ye.length===4,"color.mask must be length 4 array",ce.commandStr),ye.map(function(je){return!!je})},function(ye,je,we){return ve.optional(function(){ye.assert(je,ye.shared.isArrayLike+"("+we+")&&"+we+".length===4","invalid color.mask")}),We(4,function(pt){return"!!"+we+"["+pt+"]"})});case Su:return it(function(ye){ve.command(typeof ye=="object"&&ye,Ne,ce.commandStr);var je="value"in ye?ye.value:1,we=!!ye.invert;return ve.command(typeof je=="number"&&je>=0&&je<=1,"sample.coverage.value must be a number between 0 and 1",ce.commandStr),[je,we]},function(ye,je,we){ve.optional(function(){ye.assert(je,we+"&&typeof "+we+'==="object"',"invalid sample.coverage")});var pt=je.def('"value" in ',we,"?+",we,".value:1"),Et=je.def("!!",we,".invert");return[pt,Et]})}}),Pt}function zi(Se,ce){var He=Se.static,ht=Se.dynamic,Pt={};return Object.keys(He).forEach(function(Je){var Ne=He[Je],it;if(typeof Ne=="number"||typeof Ne=="boolean")it=Mo(function(){return Ne});else if(typeof Ne=="function"){var ye=Ne._reglType;ye==="texture2d"||ye==="textureCube"?it=Mo(function(je){return je.link(Ne)}):ye==="framebuffer"||ye==="framebufferCube"?(ve.command(Ne.color.length>0,'missing color attachment for framebuffer sent to uniform "'+Je+'"',ce.commandStr),it=Mo(function(je){return je.link(Ne.color[0])})):ve.commandRaise('invalid data for uniform "'+Je+'"',ce.commandStr)}else va(Ne)?it=Mo(function(je){var we=je.global.def("[",We(Ne.length,function(pt){return ve.command(typeof Ne[pt]=="number"||typeof Ne[pt]=="boolean","invalid uniform "+Je,je.commandStr),Ne[pt]}),"]");return we}):ve.commandRaise('invalid or missing data for uniform "'+Je+'"',ce.commandStr);it.value=Ne,Pt[Je]=it}),Object.keys(ht).forEach(function(Je){var Ne=ht[Je];Pt[Je]=nu(Ne,function(it,ye){return it.invoke(ye,Ne)})}),Pt}function os(Se,ce){var He=Se.static,ht=Se.dynamic,Pt={};return Object.keys(He).forEach(function(Je){var Ne=He[Je],it=me.id(Je),ye=new ut;if(Wf(Ne))ye.state=Hn,ye.buffer=lr.getBuffer(lr.create(Ne,sf,!1,!0)),ye.type=0;else{var je=lr.getBuffer(Ne);if(je)ye.state=Hn,ye.buffer=je,ye.type=0;else if(ve.command(typeof Ne=="object"&&Ne,"invalid data for attribute "+Je,ce.commandStr),"constant"in Ne){var we=Ne.constant;ye.buffer="null",ye.state=mi,typeof we=="number"?ye.x=we:(ve.command(va(we)&&we.length>0&&we.length<=4,"invalid constant for attribute "+Je,ce.commandStr),hi.forEach(function(Fr,Sn){Sn<we.length&&(ye[Fr]=we[Sn])}))}else{Wf(Ne.buffer)?je=lr.getBuffer(lr.create(Ne.buffer,sf,!1,!0)):je=lr.getBuffer(Ne.buffer),ve.command(!!je,'missing buffer for attribute "'+Je+'"',ce.commandStr);var pt=Ne.offset|0;ve.command(pt>=0,'invalid offset for attribute "'+Je+'"',ce.commandStr);var Et=Ne.stride|0;ve.command(Et>=0&&Et<256,'invalid stride for attribute "'+Je+'", must be integer betweeen [0, 255]',ce.commandStr);var pr=Ne.size|0;ve.command(!("size"in Ne)||pr>0&&pr<=4,'invalid size for attribute "'+Je+'", must be 1,2,3,4',ce.commandStr);var Ur=!!Ne.normalized,Nr=0;"type"in Ne&&(ve.commandParameter(Ne.type,su,"invalid type for attribute "+Je,ce.commandStr),Nr=su[Ne.type]);var tn=Ne.divisor|0;ve.optional(function(){"divisor"in Ne&&(ve.command(tn===0||br,'cannot specify divisor for attribute "'+Je+'", instancing not supported',ce.commandStr),ve.command(tn>=0,'invalid divisor for attribute "'+Je+'"',ce.commandStr));var Fr=ce.commandStr,Sn=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(Ne).forEach(function(sn){ve.command(Sn.indexOf(sn)>=0,'unknown parameter "'+sn+'" for attribute pointer "'+Je+'" (valid parameters are '+Sn+")",Fr)})}),ye.buffer=je,ye.state=Hn,ye.size=pr,ye.normalized=Ur,ye.type=Nr||je.dtype,ye.offset=pt,ye.stride=Et,ye.divisor=tn}}Pt[Je]=Mo(function(Fr,Sn){var sn=Fr.attribCache;if(it in sn)return sn[it];var bn={isStream:!1};return Object.keys(ye).forEach(function(vn){bn[vn]=ye[vn]}),ye.buffer&&(bn.buffer=Fr.link(ye.buffer),bn.type=bn.type||bn.buffer+".dtype"),sn[it]=bn,bn})}),Object.keys(ht).forEach(function(Je){var Ne=ht[Je];function it(ye,je){var we=ye.invoke(je,Ne),pt=ye.shared,Et=ye.constants,pr=pt.isBufferArgs,Ur=pt.buffer;ve.optional(function(){ye.assert(je,we+"&&(typeof "+we+'==="object"||typeof '+we+'==="function")&&('+pr+"("+we+")||"+Ur+".getBuffer("+we+")||"+Ur+".getBuffer("+we+".buffer)||"+pr+"("+we+'.buffer)||("constant" in '+we+"&&(typeof "+we+'.constant==="number"||'+pt.isArrayLike+"("+we+".constant))))",'invalid dynamic attribute "'+Je+'"')});var Nr={isStream:je.def(!1)},tn=new ut;tn.state=Hn,Object.keys(tn).forEach(function(bn){Nr[bn]=je.def(""+tn[bn])});var Fr=Nr.buffer,Sn=Nr.type;je("if(",pr,"(",we,")){",Nr.isStream,"=true;",Fr,"=",Ur,".createStream(",sf,",",we,");",Sn,"=",Fr,".dtype;","}else{",Fr,"=",Ur,".getBuffer(",we,");","if(",Fr,"){",Sn,"=",Fr,".dtype;",'}else if("constant" in ',we,"){",Nr.state,"=",mi,";","if(typeof "+we+'.constant === "number"){',Nr[hi[0]],"=",we,".constant;",hi.slice(1).map(function(bn){return Nr[bn]}).join("="),"=0;","}else{",hi.map(function(bn,vn){return Nr[bn]+"="+we+".constant.length>"+vn+"?"+we+".constant["+vn+"]:0;"}).join(""),"}}else{","if(",pr,"(",we,".buffer)){",Fr,"=",Ur,".createStream(",sf,",",we,".buffer);","}else{",Fr,"=",Ur,".getBuffer(",we,".buffer);","}",Sn,'="type" in ',we,"?",Et.glTypes,"[",we,".type]:",Fr,".dtype;",Nr.normalized,"=!!",we,".normalized;");function sn(bn){je(Nr[bn],"=",we,".",bn,"|0;")}return sn("size"),sn("offset"),sn("stride"),sn("divisor"),je("}}"),je.exit("if(",Nr.isStream,"){",Ur,".destroyStream(",Fr,");","}"),Nr}Pt[Je]=nu(Ne,it)}),Pt}function Ka(Se){var ce=Se.static,He=Se.dynamic,ht={};return Object.keys(ce).forEach(function(Pt){var Je=ce[Pt];ht[Pt]=Mo(function(Ne,it){return typeof Je=="number"||typeof Je=="boolean"?""+Je:Ne.link(Je)})}),Object.keys(He).forEach(function(Pt){var Je=He[Pt];ht[Pt]=nu(Je,function(Ne,it){return Ne.invoke(it,Je)})}),ht}function Ho(Se,ce,He,ht,Pt){var Je=Se.static,Ne=Se.dynamic;ve.optional(function(){var sn=[hu,nl,Ws,pu,Go,Ff,kc,yh,Fl,Bf].concat(On);function bn(vn){Object.keys(vn).forEach(function(mn){ve.command(sn.indexOf(mn)>=0,'unknown parameter "'+mn+'"',Pt.commandStr)})}bn(Je),bn(Ne)});var it=pi(Se,ce),ye=en(Se,Pt),je=$n(Se,ye,Pt),we=co(Se,Pt),pt=mo(Se,Pt),Et=Ni(Se,Pt,it);function pr(sn){var bn=je[sn];bn&&(pt[sn]=bn)}pr(Ls),pr(_n(Lc));var Ur=Object.keys(pt).length>0,Nr={framebuffer:ye,draw:we,shader:Et,state:pt,dirty:Ur,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(Nr.profile=qr(Se,Pt),Nr.uniforms=zi(He,Pt),Nr.drawVAO=Nr.scopeVAO=we.vao,!Nr.drawVAO&&Et.program&&!it&&ze.angle_instanced_arrays&&we.static.elements){var tn=!0,Fr=Et.program.attributes.map(function(sn){var bn=ce.static[sn];return tn=tn&&!!bn,bn});if(tn&&Fr.length>0){var Sn=rr.getVAO(rr.createVAO({attributes:Fr,elements:we.static.elements}));Nr.drawVAO=new ya(null,null,null,function(sn,bn){return sn.link(Sn)}),Nr.useVAO=!0}}return it?Nr.useVAO=!0:Nr.attributes=os(ce,Pt),Nr.context=Ka(ht,Pt),Nr}function Eo(Se,ce,He){var ht=Se.shared,Pt=ht.context,Je=Se.scope();Object.keys(He).forEach(function(Ne){ce.save(Pt,"."+Ne);var it=He[Ne],ye=it.append(Se,ce);Array.isArray(ye)?Je(Pt,".",Ne,"=[",ye.join(),"];"):Je(Pt,".",Ne,"=",ye,";")}),ce(Je)}function ts(Se,ce,He,ht){var Pt=Se.shared,Je=Pt.gl,Ne=Pt.framebuffer,it;zr&&(it=ce.def(Pt.extensions,".webgl_draw_buffers"));var ye=Se.constants,je=ye.drawBuffer,we=ye.backBuffer,pt;He?pt=He.append(Se,ce):pt=ce.def(Ne,".next"),ht||ce("if(",pt,"!==",Ne,".cur){"),ce("if(",pt,"){",Je,".bindFramebuffer(",ep,",",pt,".framebuffer);"),zr&&ce(it,".drawBuffersWEBGL(",je,"[",pt,".colorAttachments.length]);"),ce("}else{",Je,".bindFramebuffer(",ep,",null);"),zr&&ce(it,".drawBuffersWEBGL(",we,");"),ce("}",Ne,".cur=",pt,";"),ht||ce("}")}function Wo(Se,ce,He){var ht=Se.shared,Pt=ht.gl,Je=Se.current,Ne=Se.next,it=ht.current,ye=ht.next,je=Se.cond(it,".dirty");On.forEach(function(we){var pt=_n(we);if(!(pt in He.state)){var Et,pr;if(pt in Ne){Et=Ne[pt],pr=Je[pt];var Ur=We(Ar[pt].length,function(tn){return je.def(Et,"[",tn,"]")});je(Se.cond(Ur.map(function(tn,Fr){return tn+"!=="+pr+"["+Fr+"]"}).join("||")).then(Pt,".",ar[pt],"(",Ur,");",Ur.map(function(tn,Fr){return pr+"["+Fr+"]="+tn}).join(";"),";"))}else{Et=je.def(ye,".",pt);var Nr=Se.cond(Et,"!==",it,".",pt);je(Nr),pt in tr?Nr(Se.cond(Et).then(Pt,".enable(",tr[pt],");").else(Pt,".disable(",tr[pt],");"),it,".",pt,"=",Et,";"):Nr(Pt,".",ar[pt],"(",Et,");",it,".",pt,"=",Et,";")}}}),Object.keys(He.state).length===0&&je(it,".dirty=false;"),ce(je)}function ss(Se,ce,He,ht){var Pt=Se.shared,Je=Se.current,Ne=Pt.current,it=Pt.gl;wh(Object.keys(He)).forEach(function(ye){var je=He[ye];if(!(ht&&!ht(je))){var we=je.append(Se,ce);if(tr[ye]){var pt=tr[ye];Bl(je)?we?ce(it,".enable(",pt,");"):ce(it,".disable(",pt,");"):ce(Se.cond(we).then(it,".enable(",pt,");").else(it,".disable(",pt,");")),ce(Ne,".",ye,"=",we,";")}else if(va(we)){var Et=Je[ye];ce(it,".",ar[ye],"(",we,");",we.map(function(pr,Ur){return Et+"["+Ur+"]="+pr}).join(";"),";")}else ce(it,".",ar[ye],"(",we,");",Ne,".",ye,"=",we,";")}})}function go(Se,ce){br&&(Se.instancing=ce.def(Se.shared.extensions,".angle_instanced_arrays"))}function _i(Se,ce,He,ht,Pt){var Je=Se.shared,Ne=Se.stats,it=Je.current,ye=Je.timer,je=He.profile;function we(){var sn=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";return sn||typeof performance=="undefined"?"Date.now()":"performance.now()"}var pt,Et;function pr(sn){pt=ce.def(),sn(pt,"=",we(),";"),typeof Pt=="string"?sn(Ne,".count+=",Pt,";"):sn(Ne,".count++;"),Er&&(ht?(Et=ce.def(),sn(Et,"=",ye,".getNumPendingQueries();")):sn(ye,".beginQuery(",Ne,");"))}function Ur(sn){sn(Ne,".cpuTime+=",we(),"-",pt,";"),Er&&(ht?sn(ye,".pushScopeStats(",Et,",",ye,".getNumPendingQueries(),",Ne,");"):sn(ye,".endQuery();"))}function Nr(sn){var bn=ce.def(it,".profile");ce(it,".profile=",sn,";"),ce.exit(it,".profile=",bn,";")}var tn;if(je){if(Bl(je)){je.enable?(pr(ce),Ur(ce.exit),Nr("true")):Nr("false");return}tn=je.append(Se,ce),Nr(tn)}else tn=ce.def(it,".profile");var Fr=Se.block();pr(Fr),ce("if(",tn,"){",Fr,"}");var Sn=Se.block();Ur(Sn),ce.exit("if(",tn,"){",Sn,"}")}function Xo(Se,ce,He,ht,Pt){var Je=Se.shared;function Ne(ye){switch(ye){case Bc:case Eh:case Ch:return 2;case ac:case oc:case lf:return 3;case uf:case Sh:case cf:return 4;default:return 1}}function it(ye,je,we){var pt=Je.gl,Et=ce.def(ye,".location"),pr=ce.def(Je.attributes,"[",Et,"]"),Ur=we.state,Nr=we.buffer,tn=[we.x,we.y,we.z,we.w],Fr=["buffer","normalized","offset","stride"];function Sn(){ce("if(!",pr,".buffer){",pt,".enableVertexAttribArray(",Et,");}");var bn=we.type,vn;if(we.size?vn=ce.def(we.size,"||",je):vn=je,ce("if(",pr,".type!==",bn,"||",pr,".size!==",vn,"||",Fr.map(function(Kn){return pr+"."+Kn+"!=="+we[Kn]}).join("||"),"){",pt,".bindBuffer(",sf,",",Nr,".buffer);",pt,".vertexAttribPointer(",[Et,vn,bn,we.normalized,we.stride,we.offset],");",pr,".type=",bn,";",pr,".size=",vn,";",Fr.map(function(Kn){return pr+"."+Kn+"="+we[Kn]+";"}).join(""),"}"),br){var mn=we.divisor;ce("if(",pr,".divisor!==",mn,"){",Se.instancing,".vertexAttribDivisorANGLE(",[Et,mn],");",pr,".divisor=",mn,";}")}}function sn(){ce("if(",pr,".buffer){",pt,".disableVertexAttribArray(",Et,");",pr,".buffer=null;","}if(",hi.map(function(bn,vn){return pr+"."+bn+"!=="+tn[vn]}).join("||"),"){",pt,".vertexAttrib4f(",Et,",",tn,");",hi.map(function(bn,vn){return pr+"."+bn+"="+tn[vn]+";"}).join(""),"}")}Ur===Hn?Sn():Ur===mi?sn():(ce("if(",Ur,"===",Hn,"){"),Sn(),ce("}else{"),sn(),ce("}"))}ht.forEach(function(ye){var je=ye.name,we=He.attributes[je],pt;if(we){if(!Pt(we))return;pt=we.append(Se,ce)}else{if(!Pt(rp))return;var Et=Se.scopeAttrib(je);ve.optional(function(){Se.assert(ce,Et+".state","missing attribute "+je)}),pt={},Object.keys(new ut).forEach(function(pr){pt[pr]=ce.def(Et,".",pr)})}it(Se.link(ye),Ne(ye.info.type),pt)})}function na(Se,ce,He,ht,Pt,Je){for(var Ne=Se.shared,it=Ne.gl,ye,je=0;je<ht.length;++je){var we=ht[je],pt=we.name,Et=we.info.type,pr=He.uniforms[pt],Ur=Se.link(we),Nr=Ur+".location",tn;if(pr){if(!Pt(pr))continue;if(Bl(pr)){var Fr=pr.value;if(ve.command(Fr!==null&&typeof Fr!="undefined",'missing uniform "'+pt+'"',Se.commandStr),Et===Vf||Et===Gf){ve.command(typeof Fr=="function"&&(Et===Vf&&(Fr._reglType==="texture2d"||Fr._reglType==="framebuffer")||Et===Gf&&(Fr._reglType==="textureCube"||Fr._reglType==="framebufferCube")),"invalid texture for uniform "+pt,Se.commandStr);var Sn=Se.link(Fr._texture||Fr.color[0]._texture);ce(it,".uniform1i(",Nr,",",Sn+".bind());"),ce.exit(Sn,".unbind();")}else if(Et===ru||Et===ff||Et===hf){ve.optional(function(){ve.command(va(Fr),"invalid matrix for uniform "+pt,Se.commandStr),ve.command(Et===ru&&Fr.length===4||Et===ff&&Fr.length===9||Et===hf&&Fr.length===16,"invalid length for matrix uniform "+pt,Se.commandStr)});var sn=Se.global.def("new Float32Array(["+Array.prototype.slice.call(Fr)+"])"),bn=2;Et===ff?bn=3:Et===hf&&(bn=4),ce(it,".uniformMatrix",bn,"fv(",Nr,",false,",sn,");")}else{switch(Et){case Zf:ve.commandType(Fr,"number","uniform "+pt,Se.commandStr),ye="1f";break;case Bc:ve.command(va(Fr)&&Fr.length===2,"uniform "+pt,Se.commandStr),ye="2f";break;case ac:ve.command(va(Fr)&&Fr.length===3,"uniform "+pt,Se.commandStr),ye="3f";break;case uf:ve.command(va(Fr)&&Fr.length===4,"uniform "+pt,Se.commandStr),ye="4f";break;case El:ve.commandType(Fr,"boolean","uniform "+pt,Se.commandStr),ye="1i";break;case jf:ve.commandType(Fr,"number","uniform "+pt,Se.commandStr),ye="1i";break;case Ch:ve.command(va(Fr)&&Fr.length===2,"uniform "+pt,Se.commandStr),ye="2i";break;case Eh:ve.command(va(Fr)&&Fr.length===2,"uniform "+pt,Se.commandStr),ye="2i";break;case lf:ve.command(va(Fr)&&Fr.length===3,"uniform "+pt,Se.commandStr),ye="3i";break;case oc:ve.command(va(Fr)&&Fr.length===3,"uniform "+pt,Se.commandStr),ye="3i";break;case cf:ve.command(va(Fr)&&Fr.length===4,"uniform "+pt,Se.commandStr),ye="4i";break;case Sh:ve.command(va(Fr)&&Fr.length===4,"uniform "+pt,Se.commandStr),ye="4i";break}ce(it,".uniform",ye,"(",Nr,",",va(Fr)?Array.prototype.slice.call(Fr):Fr,");")}continue}else tn=pr.append(Se,ce)}else{if(!Pt(rp))continue;tn=ce.def(Ne.uniforms,"[",me.id(pt),"]")}Et===Vf?(ve(!Array.isArray(tn),"must specify a scalar prop for textures"),ce("if(",tn,"&&",tn,'._reglType==="framebuffer"){',tn,"=",tn,".color[0];","}")):Et===Gf&&(ve(!Array.isArray(tn),"must specify a scalar prop for cube maps"),ce("if(",tn,"&&",tn,'._reglType==="framebufferCube"){',tn,"=",tn,".color[0];","}")),ve.optional(function(){function ks(Bu,zc){Se.assert(ce,Bu,'bad data or missing for uniform "'+pt+'".  '+zc)}function Cl(Bu){ve(!Array.isArray(tn),"must not specify an array type for uniform"),ks("typeof "+tn+'==="'+Bu+'"',"invalid type, expected "+Bu)}function Fu(Bu,zc){Array.isArray(tn)?ve(tn.length===Bu,"must have length "+Bu):ks(Ne.isArrayLike+"("+tn+")&&"+tn+".length==="+Bu,"invalid vector, should have length "+Bu,Se.commandStr)}function qp(Bu){ve(!Array.isArray(tn),"must not specify a value type"),ks("typeof "+tn+'==="function"&&'+tn+'._reglType==="texture'+(Bu===zp?"2d":"Cube")+'"',"invalid texture type",Se.commandStr)}switch(Et){case jf:Cl("number");break;case Eh:Fu(2,"number");break;case oc:Fu(3,"number");break;case Sh:Fu(4,"number");break;case Zf:Cl("number");break;case Bc:Fu(2,"number");break;case ac:Fu(3,"number");break;case uf:Fu(4,"number");break;case El:Cl("boolean");break;case Ch:Fu(2,"boolean");break;case lf:Fu(3,"boolean");break;case cf:Fu(4,"boolean");break;case ru:Fu(4,"number");break;case ff:Fu(9,"number");break;case hf:Fu(16,"number");break;case Vf:qp(zp);break;case Gf:qp(Qh);break}});var vn=1;switch(Et){case Vf:case Gf:var mn=ce.def(tn,"._texture");ce(it,".uniform1i(",Nr,",",mn,".bind());"),ce.exit(mn,".unbind();");continue;case jf:case El:ye="1i";break;case Eh:case Ch:ye="2i",vn=2;break;case oc:case lf:ye="3i",vn=3;break;case Sh:case cf:ye="4i",vn=4;break;case Zf:ye="1f";break;case Bc:ye="2f",vn=2;break;case ac:ye="3f",vn=3;break;case uf:ye="4f",vn=4;break;case ru:ye="Matrix2fv";break;case ff:ye="Matrix3fv";break;case hf:ye="Matrix4fv";break}if(ye.charAt(0)==="M"){ce(it,".uniform",ye,"(",Nr,",");var Kn=Math.pow(Et-ru+2,2),wa=Se.global.def("new Float32Array(",Kn,")");Array.isArray(tn)?ce("false,(",We(Kn,function(ks){return wa+"["+ks+"]="+tn[ks]}),",",wa,")"):ce("false,(Array.isArray(",tn,")||",tn," instanceof Float32Array)?",tn,":(",We(Kn,function(ks){return wa+"["+ks+"]="+tn+"["+ks+"]"}),",",wa,")"),ce(");")}else if(vn>1){for(var Vn=[],wn=[],ha=0;ha<vn;++ha)Array.isArray(tn)?wn.push(tn[ha]):wn.push(ce.def(tn+"["+ha+"]")),Je&&Vn.push(ce.def());Je&&ce("if(!",Se.batchId,"||",Vn.map(function(ks,Cl){return ks+"!=="+wn[Cl]}).join("||"),"){",Vn.map(function(ks,Cl){return ks+"="+wn[Cl]+";"}).join("")),ce(it,".uniform",ye,"(",Nr,",",wn.join(","),");"),Je&&ce("}")}else{if(ve(!Array.isArray(tn),"uniform value must not be an array"),Je){var Nl=ce.def();ce("if(!",Se.batchId,"||",Nl,"!==",tn,"){",Nl,"=",tn,";")}ce(it,".uniform",ye,"(",Nr,",",tn,");"),Je&&ce("}")}}}function us(Se,ce,He,ht){var Pt=Se.shared,Je=Pt.gl,Ne=Pt.draw,it=ht.draw;function ye(){var vn=it.elements,mn,Kn=ce;return vn?((vn.contextDep&&ht.contextDynamic||vn.propDep)&&(Kn=He),mn=vn.append(Se,Kn),it.elementsActive&&Kn("if("+mn+")"+Je+".bindBuffer("+Jh+","+mn+".buffer.buffer);")):(mn=Kn.def(),Kn(mn,"=",Ne,".",pu,";","if(",mn,"){",Je,".bindBuffer(",Jh,",",mn,".buffer.buffer);}","else if(",Pt.vao,".currentVAO){",mn,"=",Se.shared.elements+".getElements("+Pt.vao,".currentVAO.elements);",hr?"":"if("+mn+")"+Je+".bindBuffer("+Jh+","+mn+".buffer.buffer);","}")),mn}function je(){var vn=it.count,mn,Kn=ce;return vn?((vn.contextDep&&ht.contextDynamic||vn.propDep)&&(Kn=He),mn=vn.append(Se,Kn),ve.optional(function(){vn.MISSING&&Se.assert(ce,"false","missing vertex count"),vn.DYNAMIC&&Se.assert(Kn,mn+">=0","missing vertex count")})):(mn=Kn.def(Ne,".",kc),ve.optional(function(){Se.assert(Kn,mn+">=0","missing vertex count")})),mn}var we=ye();function pt(vn){var mn=it[vn];return mn?mn.contextDep&&ht.contextDynamic||mn.propDep?mn.append(Se,He):mn.append(Se,ce):ce.def(Ne,".",vn)}var Et=pt(Go),pr=pt(Ff),Ur=je();if(typeof Ur=="number"){if(Ur===0)return}else He("if(",Ur,"){"),He.exit("}");var Nr,tn;br&&(Nr=pt(yh),tn=Se.instancing);var Fr=we+".type",Sn=it.elements&&Bl(it.elements)&&!it.vaoActive;function sn(){function vn(){He(tn,".drawElementsInstancedANGLE(",[Et,Ur,Fr,pr+"<<(("+Fr+"-"+ri+")>>1)",Nr],");")}function mn(){He(tn,".drawArraysInstancedANGLE(",[Et,pr,Ur,Nr],");")}we&&we!=="null"?Sn?vn():(He("if(",we,"){"),vn(),He("}else{"),mn(),He("}")):mn()}function bn(){function vn(){He(Je+".drawElements("+[Et,Ur,Fr,pr+"<<(("+Fr+"-"+ri+")>>1)"]+");")}function mn(){He(Je+".drawArrays("+[Et,pr,Ur]+");")}we&&we!=="null"?Sn?vn():(He("if(",we,"){"),vn(),He("}else{"),mn(),He("}")):mn()}br&&(typeof Nr!="number"||Nr>=0)?typeof Nr=="string"?(He("if(",Nr,">0){"),sn(),He("}else if(",Nr,"<0){"),bn(),He("}")):sn():bn()}function ni(Se,ce,He,ht,Pt){var Je=ai(),Ne=Je.proc("body",Pt);return ve.optional(function(){Je.commandStr=ce.commandStr,Je.command=Je.link(ce.commandStr)}),br&&(Je.instancing=Ne.def(Je.shared.extensions,".angle_instanced_arrays")),Se(Je,Ne,He,ht),Je.compile().body}function Ui(Se,ce,He,ht){go(Se,ce),He.useVAO?He.drawVAO?ce(Se.shared.vao,".setVAO(",He.drawVAO.append(Se,ce),");"):ce(Se.shared.vao,".setVAO(",Se.shared.vao,".targetVAO);"):(ce(Se.shared.vao,".setVAO(null);"),Xo(Se,ce,He,ht.attributes,function(){return!0})),na(Se,ce,He,ht.uniforms,function(){return!0},!1),us(Se,ce,ce,He)}function fa(Se,ce){var He=Se.proc("draw",1);go(Se,He),Eo(Se,He,ce.context),ts(Se,He,ce.framebuffer),Wo(Se,He,ce),ss(Se,He,ce.state),_i(Se,He,ce,!1,!0);var ht=ce.shader.progVar.append(Se,He);if(He(Se.shared.gl,".useProgram(",ht,".program);"),ce.shader.program)Ui(Se,He,ce,ce.shader.program);else{He(Se.shared.vao,".setVAO(null);");var Pt=Se.global.def("{}"),Je=He.def(ht,".id"),Ne=He.def(Pt,"[",Je,"]");He(Se.cond(Ne).then(Ne,".call(this,a0);").else(Ne,"=",Pt,"[",Je,"]=",Se.link(function(it){return ni(Ui,Se,ce,it,1)}),"(",ht,");",Ne,".call(this,a0);"))}Object.keys(ce.state).length>0&&He(Se.shared.current,".dirty=true;"),Se.shared.vao&&He(Se.shared.vao,".setVAO(null);")}function Po(Se,ce,He,ht){Se.batchId="a1",go(Se,ce);function Pt(){return!0}Xo(Se,ce,He,ht.attributes,Pt),na(Se,ce,He,ht.uniforms,Pt,!1),us(Se,ce,ce,He)}function Sl(Se,ce,He,ht){go(Se,ce);var Pt=He.contextDep,Je=ce.def(),Ne="a0",it="a1",ye=ce.def();Se.shared.props=ye,Se.batchId=Je;var je=Se.scope(),we=Se.scope();ce(je.entry,"for(",Je,"=0;",Je,"<",it,";++",Je,"){",ye,"=",Ne,"[",Je,"];",we,"}",je.exit);function pt(Fr){return Fr.contextDep&&Pt||Fr.propDep}function Et(Fr){return!pt(Fr)}if(He.needsContext&&Eo(Se,we,He.context),He.needsFramebuffer&&ts(Se,we,He.framebuffer),ss(Se,we,He.state,pt),He.profile&&pt(He.profile)&&_i(Se,we,He,!1,!0),ht)He.useVAO?He.drawVAO?pt(He.drawVAO)?we(Se.shared.vao,".setVAO(",He.drawVAO.append(Se,we),");"):je(Se.shared.vao,".setVAO(",He.drawVAO.append(Se,je),");"):je(Se.shared.vao,".setVAO(",Se.shared.vao,".targetVAO);"):(je(Se.shared.vao,".setVAO(null);"),Xo(Se,je,He,ht.attributes,Et),Xo(Se,we,He,ht.attributes,pt)),na(Se,je,He,ht.uniforms,Et,!1),na(Se,we,He,ht.uniforms,pt,!0),us(Se,je,we,He);else{var pr=Se.global.def("{}"),Ur=He.shader.progVar.append(Se,we),Nr=we.def(Ur,".id"),tn=we.def(pr,"[",Nr,"]");we(Se.shared.gl,".useProgram(",Ur,".program);","if(!",tn,"){",tn,"=",pr,"[",Nr,"]=",Se.link(function(Fr){return ni(Po,Se,He,Fr,2)}),"(",Ur,");}",tn,".call(this,a0[",Je,"],",Je,");")}}function Me(Se,ce){var He=Se.proc("batch",2);Se.batchId="0",go(Se,He);var ht=!1,Pt=!0;Object.keys(ce.context).forEach(function(pr){ht=ht||ce.context[pr].propDep}),ht||(Eo(Se,He,ce.context),Pt=!1);var Je=ce.framebuffer,Ne=!1;Je?(Je.propDep?ht=Ne=!0:Je.contextDep&&ht&&(Ne=!0),Ne||ts(Se,He,Je)):ts(Se,He,null),ce.state.viewport&&ce.state.viewport.propDep&&(ht=!0);function it(pr){return pr.contextDep&&ht||pr.propDep}Wo(Se,He,ce),ss(Se,He,ce.state,function(pr){return!it(pr)}),(!ce.profile||!it(ce.profile))&&_i(Se,He,ce,!1,"a1"),ce.contextDep=ht,ce.needsContext=Pt,ce.needsFramebuffer=Ne;var ye=ce.shader.progVar;if(ye.contextDep&&ht||ye.propDep)Sl(Se,He,ce,null);else{var je=ye.append(Se,He);if(He(Se.shared.gl,".useProgram(",je,".program);"),ce.shader.program)Sl(Se,He,ce,ce.shader.program);else{He(Se.shared.vao,".setVAO(null);");var we=Se.global.def("{}"),pt=He.def(je,".id"),Et=He.def(we,"[",pt,"]");He(Se.cond(Et).then(Et,".call(this,a0,a1);").else(Et,"=",we,"[",pt,"]=",Se.link(function(pr){return ni(Sl,Se,ce,pr,2)}),"(",je,");",Et,".call(this,a0,a1);"))}}Object.keys(ce.state).length>0&&He(Se.shared.current,".dirty=true;"),Se.shared.vao&&He(Se.shared.vao,".setVAO(null);")}function Bt(Se,ce){var He=Se.proc("scope",3);Se.batchId="a2";var ht=Se.shared,Pt=ht.current;Eo(Se,He,ce.context),ce.framebuffer&&ce.framebuffer.append(Se,He),wh(Object.keys(ce.state)).forEach(function(Ne){var it=ce.state[Ne],ye=it.append(Se,He);va(ye)?ye.forEach(function(je,we){He.set(Se.next[Ne],"["+we+"]",je)}):He.set(ht.next,"."+Ne,ye)}),_i(Se,He,ce,!0,!0),[pu,Ff,kc,yh,Go].forEach(function(Ne){var it=ce.draw[Ne];!it||He.set(ht.draw,"."+Ne,""+it.append(Se,He))}),Object.keys(ce.uniforms).forEach(function(Ne){var it=ce.uniforms[Ne].append(Se,He);Array.isArray(it)&&(it="["+it.join()+"]"),He.set(ht.uniforms,"["+me.id(Ne)+"]",it)}),Object.keys(ce.attributes).forEach(function(Ne){var it=ce.attributes[Ne].append(Se,He),ye=Se.scopeAttrib(Ne);Object.keys(new ut).forEach(function(je){He.set(ye,"."+je,it[je])})}),ce.scopeVAO&&He.set(ht.vao,".targetVAO",ce.scopeVAO.append(Se,He));function Je(Ne){var it=ce.shader[Ne];it&&He.set(ht.shader,"."+Ne,it.append(Se,He))}Je(nl),Je(Ws),Object.keys(ce.state).length>0&&(He(Pt,".dirty=true;"),He.exit(Pt,".dirty=true;")),He("a1(",Se.shared.context,",a0,",Se.batchId,");")}function Ct(Se){if(!(typeof Se!="object"||va(Se))){for(var ce=Object.keys(Se),He=0;He<ce.length;++He)if(rn.isDynamic(Se[ce[He]]))return!0;return!1}}function dn(Se,ce,He){var ht=ce.static[He];if(!ht||!Ct(ht))return;var Pt=Se.global,Je=Object.keys(ht),Ne=!1,it=!1,ye=!1,je=Se.global.def("{}");Je.forEach(function(pt){var Et=ht[pt];if(rn.isDynamic(Et)){typeof Et=="function"&&(Et=ht[pt]=rn.unbox(Et));var pr=nu(Et,null);Ne=Ne||pr.thisDep,ye=ye||pr.propDep,it=it||pr.contextDep}else{switch(Pt(je,".",pt,"="),typeof Et){case"number":Pt(Et);break;case"string":Pt('"',Et,'"');break;case"object":Array.isArray(Et)&&Pt("[",Et.join(),"]");break;default:Pt(Se.link(Et));break}Pt(";")}});function we(pt,Et){Je.forEach(function(pr){var Ur=ht[pr];if(!!rn.isDynamic(Ur)){var Nr=pt.invoke(Et,Ur);Et(je,".",pr,"=",Nr,";")}})}ce.dynamic[He]=new rn.DynamicVariable(bo,{thisDep:Ne,contextDep:it,propDep:ye,ref:je,append:we}),delete ce.static[He]}function Zi(Se,ce,He,ht,Pt){var Je=ai();Je.stats=Je.link(Pt),Object.keys(ce.static).forEach(function(it){dn(Je,ce,it)}),Ad.forEach(function(it){dn(Je,Se,it)});var Ne=Ho(Se,ce,He,ht,Je);return fa(Je,Ne),Bt(Je,Ne),Me(Je,Ne),v(Je.compile(),{destroy:function(){Ne.shader.program.destroy()}})}return{next:Vr,current:Ar,procs:function(){var Se=ai(),ce=Se.proc("poll"),He=Se.proc("refresh"),ht=Se.block();ce(ht),He(ht);var Pt=Se.shared,Je=Pt.gl,Ne=Pt.next,it=Pt.current;ht(it,".dirty=false;"),ts(Se,ce),ts(Se,He,null,!0);var ye;br&&(ye=Se.link(br)),ze.oes_vertex_array_object&&He(Se.link(ze.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var je=0;je<Ft.maxAttributes;++je){var we=He.def(Pt.attributes,"[",je,"]"),pt=Se.cond(we,".buffer");pt.then(Je,".enableVertexAttribArray(",je,");",Je,".bindBuffer(",sf,",",we,".buffer.buffer);",Je,".vertexAttribPointer(",je,",",we,".size,",we,".type,",we,".normalized,",we,".stride,",we,".offset);").else(Je,".disableVertexAttribArray(",je,");",Je,".vertexAttrib4f(",je,",",we,".x,",we,".y,",we,".z,",we,".w);",we,".buffer=null;"),He(pt),br&&He(ye,".vertexAttribDivisorANGLE(",je,",",we,".divisor);")}return He(Se.shared.vao,".currentVAO=null;",Se.shared.vao,".setVAO(",Se.shared.vao,".targetVAO);"),Object.keys(tr).forEach(function(Et){var pr=tr[Et],Ur=ht.def(Ne,".",Et),Nr=Se.block();Nr("if(",Ur,"){",Je,".enable(",pr,")}else{",Je,".disable(",pr,")}",it,".",Et,"=",Ur,";"),He(Nr),ce("if(",Ur,"!==",it,".",Et,"){",Nr,"}")}),Object.keys(ar).forEach(function(Et){var pr=ar[Et],Ur=Ar[Et],Nr,tn,Fr=Se.block();if(Fr(Je,".",pr,"("),va(Ur)){var Sn=Ur.length;Nr=Se.global.def(Ne,".",Et),tn=Se.global.def(it,".",Et),Fr(We(Sn,function(sn){return Nr+"["+sn+"]"}),");",We(Sn,function(sn){return tn+"["+sn+"]="+Nr+"["+sn+"];"}).join("")),ce("if(",We(Sn,function(sn){return Nr+"["+sn+"]!=="+tn+"["+sn+"]"}).join("||"),"){",Fr,"}")}else Nr=ht.def(Ne,".",Et),tn=ht.def(it,".",Et),Fr(Nr,");",it,".",Et,"=",Nr,";"),ce("if(",Nr,"!==",tn,"){",Fr,"}");He(Fr)}),Se.compile()}(),compile:Zi}}function ip(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Pd=34918,Id=34919,ap=35007,Od=function(z,me){if(!me.ext_disjoint_timer_query)return null;var ze=[];function Ft(){return ze.pop()||me.ext_disjoint_timer_query.createQueryEXT()}function lr(br){ze.push(br)}var Lt=[];function er(br){var zr=Ft();me.ext_disjoint_timer_query.beginQueryEXT(ap,zr),Lt.push(zr),Er(Lt.length-1,Lt.length,br)}function fr(){me.ext_disjoint_timer_query.endQueryEXT(ap)}function _r(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var rr=[];function Sr(){return rr.pop()||new _r}function Rr(br){rr.push(br)}var jr=[];function Er(br,zr,hr){var Ar=Sr();Ar.startQueryIndex=br,Ar.endQueryIndex=zr,Ar.sum=0,Ar.stats=hr,jr.push(Ar)}var Mr=[],ut=[];function Xt(){var br,zr,hr=Lt.length;if(hr!==0){ut.length=Math.max(ut.length,hr+1),Mr.length=Math.max(Mr.length,hr+1),Mr[0]=0,ut[0]=0;var Ar=0;for(br=0,zr=0;zr<Lt.length;++zr){var Vr=Lt[zr];me.ext_disjoint_timer_query.getQueryObjectEXT(Vr,Id)?(Ar+=me.ext_disjoint_timer_query.getQueryObjectEXT(Vr,Pd),lr(Vr)):Lt[br++]=Vr,Mr[zr+1]=Ar,ut[zr+1]=br}for(Lt.length=br,br=0,zr=0;zr<jr.length;++zr){var On=jr[zr],tr=On.startQueryIndex,ar=On.endQueryIndex;On.sum+=Mr[ar]-Mr[tr];var _n=ut[tr],Gr=ut[ar];Gr===_n?(On.stats.gpuTime+=On.sum/1e6,Rr(On)):(On.startQueryIndex=_n,On.endQueryIndex=Gr,jr[br++]=On)}jr.length=br}}return{beginQuery:er,endQuery:fr,pushScopeStats:Er,update:Xt,getNumPendingQueries:function(){return Lt.length},clear:function(){ze.push.apply(ze,Lt);for(var br=0;br<ze.length;br++)me.ext_disjoint_timer_query.deleteQueryEXT(ze[br]);Lt.length=0,ze.length=0},restore:function(){Lt.length=0,ze.length=0}}},Rd=16384,Xf=256,Xp=1024,op=34962,Yf="webglcontextlost",La="webglcontextrestored",sp=1,uc=2,vf=3;function Th(z,me){for(var ze=0;ze<z.length;++ze)if(z[ze]===me)return ze;return-1}function Yp(z){var me=ge(z);if(!me)return null;var ze=me.gl,Ft=ze.getContextAttributes(),lr=ze.isContextLost(),Lt=Oe(ze,me);if(!Lt)return null;var er=hs(),fr=ip(),_r=Lt.extensions,rr=Od(ze,_r),Sr=Ja(),Rr=ze.drawingBufferWidth,jr=ze.drawingBufferHeight,Er={tick:0,time:0,viewportWidth:Rr,viewportHeight:jr,framebufferWidth:Rr,framebufferHeight:jr,drawingBufferWidth:Rr,drawingBufferHeight:jr,pixelRatio:me.pixelRatio},Mr={},ut={elements:null,primitive:4,count:-1,offset:0,instances:-1},Xt=xc(ze,_r),br=N(ze,fr,me,Ar),zr=Xu(ze,_r,br,fr),hr=xt(ze,_r,Xt,fr,br,zr,ut);function Ar(ni){return hr.destroyBuffer(ni)}var Vr=Br(ze,er,fr,me),On=vs(ze,_r,Xt,function(){_n.procs.poll()},Er,fr,me),tr=Rl(ze,_r,Xt,fr,me),ar=Le(ze,_r,Xt,On,tr,fr),_n=np(ze,er,_r,Xt,br,zr,On,ar,Mr,hr,Vr,ut,Er,rr,me),Gr=Nn(ze,ar,_n.procs.poll,Er,Ft,_r,Xt),wr=_n.next,$r=ze.canvas,Jr=[],yi=[],ai=[],qr=[me.onDestroy],en=null;function $n(){if(Jr.length===0){rr&&rr.update(),en=null;return}en=Pi.next($n),go();for(var ni=Jr.length-1;ni>=0;--ni){var Ui=Jr[ni];Ui&&Ui(Er,null,0)}ze.flush(),rr&&rr.update()}function pi(){!en&&Jr.length>0&&(en=Pi.next($n))}function Ni(){en&&(Pi.cancel($n),en=null)}function co(ni){ni.preventDefault(),lr=!0,Ni(),yi.forEach(function(Ui){Ui()})}function mo(ni){ze.getError(),lr=!1,Lt.restore(),Vr.restore(),br.restore(),On.restore(),tr.restore(),ar.restore(),hr.restore(),rr&&rr.restore(),_n.procs.refresh(),pi(),ai.forEach(function(Ui){Ui()})}var zi=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";!zi&&$r&&($r.addEventListener(Yf,co,!1),$r.addEventListener(La,mo,!1));function os(){Jr.length=0,Ni(),!zi&&$r&&($r.removeEventListener(Yf,co),$r.removeEventListener(La,mo)),Vr.clear(),ar.clear(),tr.clear(),hr.clear(),On.clear(),zr.clear(),br.clear(),rr&&rr.clear(),qr.forEach(function(ni){ni()})}function Ka(ni){ve(!!ni,"invalid args to regl({...})"),ve.type(ni,"object","invalid args to regl({...})");function Ui(Je){var Ne=v({},Je);delete Ne.uniforms,delete Ne.attributes,delete Ne.context,delete Ne.vao,"stencil"in Ne&&Ne.stencil.op&&(Ne.stencil.opBack=Ne.stencil.opFront=Ne.stencil.op,delete Ne.stencil.op);function it(ye){if(ye in Ne){var je=Ne[ye];delete Ne[ye],Object.keys(je).forEach(function(we){Ne[ye+"."+we]=je[we]})}}return it("blend"),it("depth"),it("cull"),it("stencil"),it("polygonOffset"),it("scissor"),it("sample"),"vao"in Je&&(Ne.vao=Je.vao),Ne}function fa(Je,Ne){var it={},ye={};return Object.keys(Je).forEach(function(je){var we=Je[je];if(rn.isDynamic(we)){ye[je]=rn.unbox(we,je);return}else if(Ne&&Array.isArray(we)){for(var pt=0;pt<we.length;++pt)if(rn.isDynamic(we[pt])){ye[je]=rn.unbox(we,je);return}}it[je]=we}),{dynamic:ye,static:it}}var Po=fa(ni.context||{},!0),Sl=fa(ni.uniforms||{},!0),Me=fa(ni.attributes||{},!1),Bt=fa(Ui(ni),!1),Ct={gpuTime:0,cpuTime:0,count:0},dn=_n.compile(Bt,Me,Sl,Po,Ct),Zi=dn.draw,Se=dn.batch,ce=dn.scope,He=[];function ht(Je){for(;He.length<Je;)He.push(null);return He}function Pt(Je,Ne){var it;if(lr&&ve.raise("context lost"),typeof Je=="function")return ce.call(this,null,Je,0);if(typeof Ne=="function")if(typeof Je=="number")for(it=0;it<Je;++it)ce.call(this,null,Ne,it);else if(Array.isArray(Je))for(it=0;it<Je.length;++it)ce.call(this,Je[it],Ne,it);else return ce.call(this,Je,Ne,0);else if(typeof Je=="number"){if(Je>0)return Se.call(this,ht(Je|0),Je|0)}else if(Array.isArray(Je)){if(Je.length)return Se.call(this,Je,Je.length)}else return Zi.call(this,Je)}return v(Pt,{stats:Ct,destroy:function(){dn.destroy()}})}var Ho=ar.setFBO=Ka({framebuffer:rn.define.call(null,sp,"framebuffer")});function Eo(ni,Ui){var fa=0;_n.procs.poll();var Po=Ui.color;Po&&(ze.clearColor(+Po[0]||0,+Po[1]||0,+Po[2]||0,+Po[3]||0),fa|=Rd),"depth"in Ui&&(ze.clearDepth(+Ui.depth),fa|=Xf),"stencil"in Ui&&(ze.clearStencil(Ui.stencil|0),fa|=Xp),ve(!!fa,"called regl.clear with no buffer specified"),ze.clear(fa)}function ts(ni){if(ve(typeof ni=="object"&&ni,"regl.clear() takes an object as input"),"framebuffer"in ni)if(ni.framebuffer&&ni.framebuffer_reglType==="framebufferCube")for(var Ui=0;Ui<6;++Ui)Ho(v({framebuffer:ni.framebuffer.faces[Ui]},ni),Eo);else Ho(ni,Eo);else Eo(null,ni)}function Wo(ni){ve.type(ni,"function","regl.frame() callback must be a function"),Jr.push(ni);function Ui(){var fa=Th(Jr,ni);ve(fa>=0,"cannot cancel a frame twice");function Po(){var Sl=Th(Jr,Po);Jr[Sl]=Jr[Jr.length-1],Jr.length-=1,Jr.length<=0&&Ni()}Jr[fa]=Po}return pi(),{cancel:Ui}}function ss(){var ni=wr.viewport,Ui=wr.scissor_box;ni[0]=ni[1]=Ui[0]=Ui[1]=0,Er.viewportWidth=Er.framebufferWidth=Er.drawingBufferWidth=ni[2]=Ui[2]=ze.drawingBufferWidth,Er.viewportHeight=Er.framebufferHeight=Er.drawingBufferHeight=ni[3]=Ui[3]=ze.drawingBufferHeight}function go(){Er.tick+=1,Er.time=Xo(),ss(),_n.procs.poll()}function _i(){On.refresh(),ss(),_n.procs.refresh(),rr&&rr.update()}function Xo(){return(Ja()-Sr)/1e3}_i();function na(ni,Ui){ve.type(Ui,"function","listener callback must be a function");var fa;switch(ni){case"frame":return Wo(Ui);case"lost":fa=yi;break;case"restore":fa=ai;break;case"destroy":fa=qr;break;default:ve.raise("invalid event, must be one of frame,lost,restore,destroy")}return fa.push(Ui),{cancel:function(){for(var Po=0;Po<fa.length;++Po)if(fa[Po]===Ui){fa[Po]=fa[fa.length-1],fa.pop();return}}}}var us=v(Ka,{clear:ts,prop:rn.define.bind(null,sp),context:rn.define.bind(null,uc),this:rn.define.bind(null,vf),draw:Ka({}),buffer:function(ni){return br.create(ni,op,!1,!1)},elements:function(ni){return zr.create(ni,!1)},texture:On.create2D,cube:On.createCube,renderbuffer:tr.create,framebuffer:ar.create,framebufferCube:ar.createCube,vao:hr.createVAO,attributes:Ft,frame:Wo,on:na,limits:Xt,hasExtension:function(ni){return Xt.extensions.indexOf(ni.toLowerCase())>=0},read:Gr,destroy:os,_gl:ze,_refresh:_i,poll:function(){go(),rr&&rr.update()},now:Xo,stats:fr});return me.onDone(null,us),us}return Yp})},58380:function(Ze){function H(R,Y,J){switch(J.length){case 0:return R.call(Y);case 1:return R.call(Y,J[0]);case 2:return R.call(Y,J[0],J[1]);case 3:return R.call(Y,J[0],J[1],J[2])}return R.apply(Y,J)}Ze.exports=H},77412:function(Ze){function H(R,Y){for(var J=-1,v=R==null?0:R.length;++J<v&&Y(R[J],J,R)!==!1;);return R}Ze.exports=H},47443:function(Ze,H,R){var Y=R(42118);function J(v,te){var B=v==null?0:v.length;return!!B&&Y(v,te,0)>-1}Ze.exports=J},1196:function(Ze){function H(R,Y,J){for(var v=-1,te=R==null?0:R.length;++v<te;)if(J(Y,R[v]))return!0;return!1}Ze.exports=H},29932:function(Ze){function H(R,Y){for(var J=-1,v=R==null?0:R.length,te=Array(v);++J<v;)te[J]=Y(R[J],J,R);return te}Ze.exports=H},62663:function(Ze){function H(R,Y,J,v){var te=-1,B=R==null?0:R.length;for(v&&B&&(J=R[++te]);++te<B;)J=Y(J,R[te],te,R);return J}Ze.exports=H},49029:function(Ze){var H=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function R(Y){return Y.match(H)||[]}Ze.exports=R},86556:function(Ze,H,R){var Y=R(89465),J=R(77813);function v(te,B,Q){(Q!==void 0&&!J(te[B],Q)||Q===void 0&&!(B in te))&&Y(te,B,Q)}Ze.exports=v},34865:function(Ze,H,R){var Y=R(89465),J=R(77813),v=Object.prototype,te=v.hasOwnProperty;function B(Q,ie,Ee){var re=Q[ie];(!(te.call(Q,ie)&&J(re,Ee))||Ee===void 0&&!(ie in Q))&&Y(Q,ie,Ee)}Ze.exports=B},44037:function(Ze,H,R){var Y=R(98363),J=R(3674);function v(te,B){return te&&Y(B,J(B),te)}Ze.exports=v},63886:function(Ze,H,R){var Y=R(98363),J=R(81704);function v(te,B){return te&&Y(B,J(B),te)}Ze.exports=v},89465:function(Ze,H,R){var Y=R(38777);function J(v,te,B){te=="__proto__"&&Y?Y(v,te,{configurable:!0,enumerable:!0,value:B,writable:!0}):v[te]=B}Ze.exports=J},29750:function(Ze){function H(R,Y,J){return R===R&&(J!==void 0&&(R=R<=J?R:J),Y!==void 0&&(R=R>=Y?R:Y)),R}Ze.exports=H},85990:function(Ze,H,R){var Y=R(46384),J=R(77412),v=R(34865),te=R(44037),B=R(63886),Q=R(64626),ie=R(278),Ee=R(18805),re=R(1911),Ge=R(58234),Ce=R(46904),tt=R(64160),Mt=R(43824),ir=R(29148),bt=R(38517),qt=R(1469),At=R(44144),ot=R(56688),ct=R(13218),Qt=R(72928),X=R(3674),Kt=R(81704),vt=1,qe=2,dt=4,$e="[object Arguments]",kt="[object Array]",yr="[object Boolean]",Pr="[object Date]",Wr="[object Error]",Te="[object Function]",Ye="[object GeneratorFunction]",De="[object Map]",wt="[object Number]",gt="[object Object]",Ut="[object RegExp]",Jt="[object Set]",Cr="[object String]",Yn="[object Symbol]",hn="[object WeakMap]",qi="[object ArrayBuffer]",jn="[object DataView]",Xn="[object Float32Array]",vi="[object Float64Array]",qn="[object Int8Array]",li="[object Int16Array]",aa="[object Int32Array]",Di="[object Uint8Array]",Ai="[object Uint8ClampedArray]",Vi="[object Uint16Array]",la="[object Uint32Array]",wi={};wi[$e]=wi[kt]=wi[qi]=wi[jn]=wi[yr]=wi[Pr]=wi[Xn]=wi[vi]=wi[qn]=wi[li]=wi[aa]=wi[De]=wi[wt]=wi[gt]=wi[Ut]=wi[Jt]=wi[Cr]=wi[Yn]=wi[Di]=wi[Ai]=wi[Vi]=wi[la]=!0,wi[Wr]=wi[Te]=wi[hn]=!1;function Sa(Mn,Si,ji,Ki,Wa,ve){var Fn,Xa=Si&vt,fs=Si&qe,jt=Si&dt;if(ji&&(Fn=Wa?ji(Mn,Ki,Wa,ve):ji(Mn)),Fn!==void 0)return Fn;if(!ct(Mn))return Mn;var sr=qt(Mn);if(sr){if(Fn=Mt(Mn),!Xa)return ie(Mn,Fn)}else{var Tr=tt(Mn),I=Tr==Te||Tr==Ye;if(At(Mn))return Q(Mn,Xa);if(Tr==gt||Tr==$e||I&&!Wa){if(Fn=fs||I?{}:bt(Mn),!Xa)return fs?re(Mn,B(Fn,Mn)):Ee(Mn,te(Fn,Mn))}else{if(!wi[Tr])return Wa?Mn:{};Fn=ir(Mn,Tr,Xa)}}ve||(ve=new Y);var ur=ve.get(Mn);if(ur)return ur;ve.set(Mn,Fn),Qt(Mn)?Mn.forEach(function(Gn){Fn.add(Sa(Gn,Si,ji,Gn,Mn,ve))}):ot(Mn)&&Mn.forEach(function(Gn,rn){Fn.set(rn,Sa(Gn,Si,ji,rn,Mn,ve))});var Ln=jt?fs?Ce:Ge:fs?Kt:X,ci=sr?void 0:Ln(Mn);return J(ci||Mn,function(Gn,rn){ci&&(rn=Gn,Gn=Mn[rn]),v(Fn,rn,Sa(Gn,Si,ji,rn,Mn,ve))}),Fn}Ze.exports=Sa},3118:function(Ze,H,R){var Y=R(13218),J=Object.create,v=function(){function te(){}return function(B){if(!Y(B))return{};if(J)return J(B);te.prototype=B;var Q=new te;return te.prototype=void 0,Q}}();Ze.exports=v},41848:function(Ze){function H(R,Y,J,v){for(var te=R.length,B=J+(v?1:-1);v?B--:++B<te;)if(Y(R[B],B,R))return B;return-1}Ze.exports=H},28483:function(Ze,H,R){var Y=R(25063),J=Y();Ze.exports=J},42118:function(Ze,H,R){var Y=R(41848),J=R(62722),v=R(42351);function te(B,Q,ie){return Q===Q?v(B,Q,ie):Y(B,J,ie)}Ze.exports=te},25588:function(Ze,H,R){var Y=R(64160),J=R(37005),v="[object Map]";function te(B){return J(B)&&Y(B)==v}Ze.exports=te},62722:function(Ze){function H(R){return R!==R}Ze.exports=H},29221:function(Ze,H,R){var Y=R(64160),J=R(37005),v="[object Set]";function te(B){return J(B)&&Y(B)==v}Ze.exports=te},10313:function(Ze,H,R){var Y=R(13218),J=R(25726),v=R(33498),te=Object.prototype,B=te.hasOwnProperty;function Q(ie){if(!Y(ie))return v(ie);var Ee=J(ie),re=[];for(var Ge in ie)Ge=="constructor"&&(Ee||!B.call(ie,Ge))||re.push(Ge);return re}Ze.exports=Q},42980:function(Ze,H,R){var Y=R(46384),J=R(86556),v=R(28483),te=R(59783),B=R(13218),Q=R(81704),ie=R(36390);function Ee(re,Ge,Ce,tt,Mt){re!==Ge&&v(Ge,function(ir,bt){if(Mt||(Mt=new Y),B(ir))te(re,Ge,bt,Ce,Ee,tt,Mt);else{var qt=tt?tt(ie(re,bt),ir,bt+"",re,Ge,Mt):void 0;qt===void 0&&(qt=ir),J(re,bt,qt)}},Q)}Ze.exports=Ee},59783:function(Ze,H,R){var Y=R(86556),J=R(64626),v=R(77133),te=R(278),B=R(38517),Q=R(35694),ie=R(1469),Ee=R(29246),re=R(44144),Ge=R(23560),Ce=R(13218),tt=R(68630),Mt=R(36719),ir=R(36390),bt=R(59881);function qt(At,ot,ct,Qt,X,Kt,vt){var qe=ir(At,ct),dt=ir(ot,ct),$e=vt.get(dt);if($e){Y(At,ct,$e);return}var kt=Kt?Kt(qe,dt,ct+"",At,ot,vt):void 0,yr=kt===void 0;if(yr){var Pr=ie(dt),Wr=!Pr&&re(dt),Te=!Pr&&!Wr&&Mt(dt);kt=dt,Pr||Wr||Te?ie(qe)?kt=qe:Ee(qe)?kt=te(qe):Wr?(yr=!1,kt=J(dt,!0)):Te?(yr=!1,kt=v(dt,!0)):kt=[]:tt(dt)||Q(dt)?(kt=qe,Q(qe)?kt=bt(qe):(!Ce(qe)||Ge(qe))&&(kt=B(dt))):yr=!1}yr&&(vt.set(dt,kt),X(kt,dt,Qt,Kt,vt),vt.delete(dt)),Y(At,ct,kt)}Ze.exports=qt},40371:function(Ze){function H(R){return function(Y){return Y==null?void 0:Y[R]}}Ze.exports=H},18674:function(Ze){function H(R){return function(Y){return R==null?void 0:R[Y]}}Ze.exports=H},5976:function(Ze,H,R){var Y=R(6557),J=R(45357),v=R(30061);function te(B,Q){return v(J(B,Q,Y),B+"")}Ze.exports=te},56560:function(Ze,H,R){var Y=R(75703),J=R(38777),v=R(6557),te=J?function(B,Q){return J(B,"toString",{configurable:!0,enumerable:!1,value:Y(Q),writable:!0})}:v;Ze.exports=te},80531:function(Ze,H,R){var Y=R(62705),J=R(29932),v=R(1469),te=R(33448),B=1/0,Q=Y?Y.prototype:void 0,ie=Q?Q.toString:void 0;function Ee(re){if(typeof re=="string")return re;if(v(re))return J(re,Ee)+"";if(te(re))return ie?ie.call(re):"";var Ge=re+"";return Ge=="0"&&1/re==-B?"-0":Ge}Ze.exports=Ee},45652:function(Ze,H,R){var Y=R(88668),J=R(47443),v=R(1196),te=R(74757),B=R(23593),Q=R(21814),ie=200;function Ee(re,Ge,Ce){var tt=-1,Mt=J,ir=re.length,bt=!0,qt=[],At=qt;if(Ce)bt=!1,Mt=v;else if(ir>=ie){var ot=Ge?null:B(re);if(ot)return Q(ot);bt=!1,Mt=te,At=new Y}else At=Ge?[]:qt;e:for(;++tt<ir;){var ct=re[tt],Qt=Ge?Ge(ct):ct;if(ct=Ce||ct!==0?ct:0,bt&&Qt===Qt){for(var X=At.length;X--;)if(At[X]===Qt)continue e;Ge&&At.push(Qt),qt.push(ct)}else Mt(At,Qt,Ce)||(At!==qt&&At.push(Qt),qt.push(ct))}return qt}Ze.exports=Ee},74318:function(Ze,H,R){var Y=R(11149);function J(v){var te=new v.constructor(v.byteLength);return new Y(te).set(new Y(v)),te}Ze.exports=J},64626:function(Ze,H,R){Ze=R.nmd(Ze);var Y=R(55639),J=H&&!H.nodeType&&H,v=J&&!0&&Ze&&!Ze.nodeType&&Ze,te=v&&v.exports===J,B=te?Y.Buffer:void 0,Q=B?B.allocUnsafe:void 0;function ie(Ee,re){if(re)return Ee.slice();var Ge=Ee.length,Ce=Q?Q(Ge):new Ee.constructor(Ge);return Ee.copy(Ce),Ce}Ze.exports=ie},57157:function(Ze,H,R){var Y=R(74318);function J(v,te){var B=te?Y(v.buffer):v.buffer;return new v.constructor(B,v.byteOffset,v.byteLength)}Ze.exports=J},93147:function(Ze){var H=/\w*$/;function R(Y){var J=new Y.constructor(Y.source,H.exec(Y));return J.lastIndex=Y.lastIndex,J}Ze.exports=R},40419:function(Ze,H,R){var Y=R(62705),J=Y?Y.prototype:void 0,v=J?J.valueOf:void 0;function te(B){return v?Object(v.call(B)):{}}Ze.exports=te},77133:function(Ze,H,R){var Y=R(74318);function J(v,te){var B=te?Y(v.buffer):v.buffer;return new v.constructor(B,v.byteOffset,v.length)}Ze.exports=J},278:function(Ze){function H(R,Y){var J=-1,v=R.length;for(Y||(Y=Array(v));++J<v;)Y[J]=R[J];return Y}Ze.exports=H},98363:function(Ze,H,R){var Y=R(34865),J=R(89465);function v(te,B,Q,ie){var Ee=!Q;Q||(Q={});for(var re=-1,Ge=B.length;++re<Ge;){var Ce=B[re],tt=ie?ie(Q[Ce],te[Ce],Ce,Q,te):void 0;tt===void 0&&(tt=te[Ce]),Ee?J(Q,Ce,tt):Y(Q,Ce,tt)}return Q}Ze.exports=v},18805:function(Ze,H,R){var Y=R(98363),J=R(99551);function v(te,B){return Y(te,J(te),B)}Ze.exports=v},1911:function(Ze,H,R){var Y=R(98363),J=R(51442);function v(te,B){return Y(te,J(te),B)}Ze.exports=v},21463:function(Ze,H,R){var Y=R(5976),J=R(16612);function v(te){return Y(function(B,Q){var ie=-1,Ee=Q.length,re=Ee>1?Q[Ee-1]:void 0,Ge=Ee>2?Q[2]:void 0;for(re=te.length>3&&typeof re=="function"?(Ee--,re):void 0,Ge&&J(Q[0],Q[1],Ge)&&(re=Ee<3?void 0:re,Ee=1),B=Object(B);++ie<Ee;){var Ce=Q[ie];Ce&&te(B,Ce,ie,re)}return B})}Ze.exports=v},25063:function(Ze){function H(R){return function(Y,J,v){for(var te=-1,B=Object(Y),Q=v(Y),ie=Q.length;ie--;){var Ee=Q[R?ie:++te];if(J(B[Ee],Ee,B)===!1)break}return Y}}Ze.exports=H},98805:function(Ze,H,R){var Y=R(40180),J=R(62689),v=R(83140),te=R(79833);function B(Q){return function(ie){ie=te(ie);var Ee=J(ie)?v(ie):void 0,re=Ee?Ee[0]:ie.charAt(0),Ge=Ee?Y(Ee,1).join(""):ie.slice(1);return re[Q]()+Ge}}Ze.exports=B},35393:function(Ze,H,R){var Y=R(62663),J=R(53816),v=R(58748),te="['\u2019]",B=RegExp(te,"g");function Q(ie){return function(Ee){return Y(v(J(Ee).replace(B,"")),ie,"")}}Ze.exports=Q},23593:function(Ze,H,R){var Y=R(58525),J=R(50308),v=R(21814),te=1/0,B=Y&&1/v(new Y([,-0]))[1]==te?function(Q){return new Y(Q)}:J;Ze.exports=B},69389:function(Ze,H,R){var Y=R(18674),J={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},v=Y(J);Ze.exports=v},38777:function(Ze,H,R){var Y=R(10852),J=function(){try{var v=Y(Object,"defineProperty");return v({},"",{}),v}catch(te){}}();Ze.exports=J},46904:function(Ze,H,R){var Y=R(68866),J=R(51442),v=R(81704);function te(B){return Y(B,v,J)}Ze.exports=te},85924:function(Ze,H,R){var Y=R(5569),J=Y(Object.getPrototypeOf,Object);Ze.exports=J},51442:function(Ze,H,R){var Y=R(62488),J=R(85924),v=R(99551),te=R(70479),B=Object.getOwnPropertySymbols,Q=B?function(ie){for(var Ee=[];ie;)Y(Ee,v(ie)),ie=J(ie);return Ee}:te;Ze.exports=Q},93157:function(Ze){var H=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function R(Y){return H.test(Y)}Ze.exports=R},43824:function(Ze){var H=Object.prototype,R=H.hasOwnProperty;function Y(J){var v=J.length,te=new J.constructor(v);return v&&typeof J[0]=="string"&&R.call(J,"index")&&(te.index=J.index,te.input=J.input),te}Ze.exports=Y},29148:function(Ze,H,R){var Y=R(74318),J=R(57157),v=R(93147),te=R(40419),B=R(77133),Q="[object Boolean]",ie="[object Date]",Ee="[object Map]",re="[object Number]",Ge="[object RegExp]",Ce="[object Set]",tt="[object String]",Mt="[object Symbol]",ir="[object ArrayBuffer]",bt="[object DataView]",qt="[object Float32Array]",At="[object Float64Array]",ot="[object Int8Array]",ct="[object Int16Array]",Qt="[object Int32Array]",X="[object Uint8Array]",Kt="[object Uint8ClampedArray]",vt="[object Uint16Array]",qe="[object Uint32Array]";function dt($e,kt,yr){var Pr=$e.constructor;switch(kt){case ir:return Y($e);case Q:case ie:return new Pr(+$e);case bt:return J($e,yr);case qt:case At:case ot:case ct:case Qt:case X:case Kt:case vt:case qe:return B($e,yr);case Ee:return new Pr;case re:case tt:return new Pr($e);case Ge:return v($e);case Ce:return new Pr;case Mt:return te($e)}}Ze.exports=dt},38517:function(Ze,H,R){var Y=R(3118),J=R(85924),v=R(25726);function te(B){return typeof B.constructor=="function"&&!v(B)?Y(J(B)):{}}Ze.exports=te},16612:function(Ze,H,R){var Y=R(77813),J=R(98612),v=R(65776),te=R(13218);function B(Q,ie,Ee){if(!te(Ee))return!1;var re=typeof ie;return(re=="number"?J(Ee)&&v(ie,Ee.length):re=="string"&&ie in Ee)?Y(Ee[ie],Q):!1}Ze.exports=B},33498:function(Ze){function H(R){var Y=[];if(R!=null)for(var J in Object(R))Y.push(J);return Y}Ze.exports=H},45357:function(Ze,H,R){var Y=R(58380),J=Math.max;function v(te,B,Q){return B=J(B===void 0?te.length-1:B,0),function(){for(var ie=arguments,Ee=-1,re=J(ie.length-B,0),Ge=Array(re);++Ee<re;)Ge[Ee]=ie[B+Ee];Ee=-1;for(var Ce=Array(B+1);++Ee<B;)Ce[Ee]=ie[Ee];return Ce[B]=Q(Ge),Y(te,this,Ce)}}Ze.exports=v},36390:function(Ze){function H(R,Y){if(!(Y==="constructor"&&typeof R[Y]=="function")&&Y!="__proto__")return R[Y]}Ze.exports=H},30061:function(Ze,H,R){var Y=R(56560),J=R(21275),v=J(Y);Ze.exports=v},21275:function(Ze){var H=800,R=16,Y=Date.now;function J(v){var te=0,B=0;return function(){var Q=Y(),ie=R-(Q-B);if(B=Q,ie>0){if(++te>=H)return arguments[0]}else te=0;return v.apply(void 0,arguments)}}Ze.exports=J},42351:function(Ze){function H(R,Y,J){for(var v=J-1,te=R.length;++v<te;)if(R[v]===Y)return v;return-1}Ze.exports=H},2757:function(Ze){var H="\\ud800-\\udfff",R="\\u0300-\\u036f",Y="\\ufe20-\\ufe2f",J="\\u20d0-\\u20ff",v=R+Y+J,te="\\u2700-\\u27bf",B="a-z\\xdf-\\xf6\\xf8-\\xff",Q="\\xac\\xb1\\xd7\\xf7",ie="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Ee="\\u2000-\\u206f",re=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Ge="A-Z\\xc0-\\xd6\\xd8-\\xde",Ce="\\ufe0e\\ufe0f",tt=Q+ie+Ee+re,Mt="['\u2019]",ir="["+tt+"]",bt="["+v+"]",qt="\\d+",At="["+te+"]",ot="["+B+"]",ct="[^"+H+tt+qt+te+B+Ge+"]",Qt="\\ud83c[\\udffb-\\udfff]",X="(?:"+bt+"|"+Qt+")",Kt="[^"+H+"]",vt="(?:\\ud83c[\\udde6-\\uddff]){2}",qe="[\\ud800-\\udbff][\\udc00-\\udfff]",dt="["+Ge+"]",$e="\\u200d",kt="(?:"+ot+"|"+ct+")",yr="(?:"+dt+"|"+ct+")",Pr="(?:"+Mt+"(?:d|ll|m|re|s|t|ve))?",Wr="(?:"+Mt+"(?:D|LL|M|RE|S|T|VE))?",Te=X+"?",Ye="["+Ce+"]?",De="(?:"+$e+"(?:"+[Kt,vt,qe].join("|")+")"+Ye+Te+")*",wt="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",gt="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Ut=Ye+Te+De,Jt="(?:"+[At,vt,qe].join("|")+")"+Ut,Cr=RegExp([dt+"?"+ot+"+"+Pr+"(?="+[ir,dt,"$"].join("|")+")",yr+"+"+Wr+"(?="+[ir,dt+kt,"$"].join("|")+")",dt+"?"+kt+"+"+Pr,dt+"+"+Wr,gt,wt,qt,Jt].join("|"),"g");function Yn(hn){return hn.match(Cr)||[]}Ze.exports=Yn},68929:function(Ze,H,R){var Y=R(48403),J=R(35393),v=J(function(te,B,Q){return B=B.toLowerCase(),te+(Q?Y(B):B)});Ze.exports=v},48403:function(Ze,H,R){var Y=R(79833),J=R(11700);function v(te){return J(Y(te).toLowerCase())}Ze.exports=v},74691:function(Ze,H,R){var Y=R(29750),J=R(14841);function v(te,B,Q){return Q===void 0&&(Q=B,B=void 0),Q!==void 0&&(Q=J(Q),Q=Q===Q?Q:0),B!==void 0&&(B=J(B),B=B===B?B:0),Y(J(te),B,Q)}Ze.exports=v},50361:function(Ze,H,R){var Y=R(85990),J=1,v=4;function te(B){return Y(B,J|v)}Ze.exports=te},75703:function(Ze){function H(R){return function(){return R}}Ze.exports=H},53816:function(Ze,H,R){var Y=R(69389),J=R(79833),v=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,te="\\u0300-\\u036f",B="\\ufe20-\\ufe2f",Q="\\u20d0-\\u20ff",ie=te+B+Q,Ee="["+ie+"]",re=RegExp(Ee,"g");function Ge(Ce){return Ce=J(Ce),Ce&&Ce.replace(v,Y).replace(re,"")}Ze.exports=Ge},6557:function(Ze){function H(R){return R}Ze.exports=H},29246:function(Ze,H,R){var Y=R(98612),J=R(37005);function v(te){return J(te)&&Y(te)}Ze.exports=v},56688:function(Ze,H,R){var Y=R(25588),J=R(7518),v=R(31167),te=v&&v.isMap,B=te?J(te):Y;Ze.exports=B},14293:function(Ze){function H(R){return R==null}Ze.exports=H},81763:function(Ze,H,R){var Y=R(44239),J=R(37005),v="[object Number]";function te(B){return typeof B=="number"||J(B)&&Y(B)==v}Ze.exports=te},68630:function(Ze,H,R){var Y=R(44239),J=R(85924),v=R(37005),te="[object Object]",B=Function.prototype,Q=Object.prototype,ie=B.toString,Ee=Q.hasOwnProperty,re=ie.call(Object);function Ge(Ce){if(!v(Ce)||Y(Ce)!=te)return!1;var tt=J(Ce);if(tt===null)return!0;var Mt=Ee.call(tt,"constructor")&&tt.constructor;return typeof Mt=="function"&&Mt instanceof Mt&&ie.call(Mt)==re}Ze.exports=Ge},72928:function(Ze,H,R){var Y=R(29221),J=R(7518),v=R(31167),te=v&&v.isSet,B=te?J(te):Y;Ze.exports=B},47037:function(Ze,H,R){var Y=R(44239),J=R(1469),v=R(37005),te="[object String]";function B(Q){return typeof Q=="string"||!J(Q)&&v(Q)&&Y(Q)==te}Ze.exports=B},81704:function(Ze,H,R){var Y=R(14636),J=R(10313),v=R(98612);function te(B){return v(B)?Y(B,!0):J(B)}Ze.exports=te},82492:function(Ze,H,R){var Y=R(42980),J=R(21463),v=J(function(te,B,Q){Y(te,B,Q)});Ze.exports=v},30236:function(Ze,H,R){var Y=R(42980),J=R(21463),v=J(function(te,B,Q,ie){Y(te,B,Q,ie)});Ze.exports=v},50308:function(Ze){function H(){}Ze.exports=H},59881:function(Ze,H,R){var Y=R(98363),J=R(81704);function v(te){return Y(te,J(te))}Ze.exports=v},79833:function(Ze,H,R){var Y=R(80531);function J(v){return v==null?"":Y(v)}Ze.exports=J},44908:function(Ze,H,R){var Y=R(45652);function J(v){return v&&v.length?Y(v):[]}Ze.exports=J},11700:function(Ze,H,R){var Y=R(98805),J=Y("toUpperCase");Ze.exports=J},58748:function(Ze,H,R){var Y=R(49029),J=R(93157),v=R(79833),te=R(2757);function B(Q,ie,Ee){return Q=v(Q),ie=Ee?void 0:ie,ie===void 0?J(Q)?te(Q):Y(Q):Q.match(ie)||[]}Ze.exports=B},6158:function(Ze){(function(H,R){Ze.exports=R()})(this,function(){"use strict";var H,R,Y;function J(v,te){if(!H)H=te;else if(!R)R=te;else{var B="var sharedChunk = {}; ("+H+")(sharedChunk); ("+R+")(sharedChunk);",Q={};H(Q),Y=te(Q),typeof window!="undefined"&&(Y.workerUrl=window.URL.createObjectURL(new Blob([B],{type:"text/javascript"})))}}return J(["exports"],function(v){"use strict";function te(t,o){return t(o={exports:{}},o.exports),o.exports}var B=Q;function Q(t,o,u,p){this.cx=3*t,this.bx=3*(u-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(p-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=p,this.p2x=u,this.p2y=p}Q.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},Q.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},Q.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},Q.prototype.solveCurveX=function(t,o){var u,p,g,x,S;for(o===void 0&&(o=1e-6),g=t,S=0;S<8;S++){if(x=this.sampleCurveX(g)-t,Math.abs(x)<o)return g;var M=this.sampleCurveDerivativeX(g);if(Math.abs(M)<1e-6)break;g-=x/M}if((g=t)<(u=0))return u;if(g>(p=1))return p;for(;u<p;){if(x=this.sampleCurveX(g),Math.abs(x-t)<o)return g;t>x?u=g:p=g,g=.5*(p-u)+u}return g},Q.prototype.solve=function(t,o){return this.sampleCurveY(this.solveCurveX(t,o))};var ie=Ee;function Ee(t,o){this.x=t,this.y=o}Ee.prototype={clone:function(){return new Ee(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,o){return this.clone()._rotateAround(t,o)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var o=t.x-this.x,u=t.y-this.y;return o*o+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,o){return Math.atan2(this.x*o-this.y*t,this.x*t+this.y*o)},_matMult:function(t){var o=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=o,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var o=Math.cos(t),u=Math.sin(t),p=u*this.x+o*this.y;return this.x=o*this.x-u*this.y,this.y=p,this},_rotateAround:function(t,o){var u=Math.cos(t),p=Math.sin(t),g=o.y+p*(this.x-o.x)+u*(this.y-o.y);return this.x=o.x+u*(this.x-o.x)-p*(this.y-o.y),this.y=g,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ee.convert=function(t){return t instanceof Ee?t:Array.isArray(t)?new Ee(t[0],t[1]):t};var re=typeof self!="undefined"?self:{},Ge=Math.pow(2,53)-1;function Ce(t,o,u,p){var g=new B(t,o,u,p);return function(x){return g.solve(x)}}var tt=Ce(.25,.1,.25,1);function Mt(t,o,u){return Math.min(u,Math.max(o,t))}function ir(t,o,u){var p=u-o,g=((t-o)%p+p)%p+o;return g===o?u:g}function bt(t){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];for(var p=0,g=o;p<g.length;p+=1){var x=g[p];for(var S in x)t[S]=x[S]}return t}var qt=1;function At(){return qt++}function ot(){return function t(o){return o?(o^16*Math.random()>>o/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function ct(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function Qt(t,o){t.forEach(function(u){o[u]&&(o[u]=o[u].bind(o))})}function X(t,o){return t.indexOf(o,t.length-o.length)!==-1}function Kt(t,o,u){var p={};for(var g in t)p[g]=o.call(u||this,t[g],g,t);return p}function vt(t,o,u){var p={};for(var g in t)o.call(u||this,t[g],g,t)&&(p[g]=t[g]);return p}function qe(t){return Array.isArray(t)?t.map(qe):typeof t=="object"&&t?Kt(t,qe):t}var dt={};function $e(t){dt[t]||(typeof console!="undefined"&&console.warn(t),dt[t]=!0)}function kt(t,o,u){return(u.y-t.y)*(o.x-t.x)>(o.y-t.y)*(u.x-t.x)}function yr(t){for(var o=0,u=0,p=t.length,g=p-1,x=void 0,S=void 0;u<p;g=u++)o+=((S=t[g]).x-(x=t[u]).x)*(x.y+S.y);return o}function Pr(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function Wr(t){var o={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(p,g,x,S){var M=x||S;return o[g]=!M||M.toLowerCase(),""}),o["max-age"]){var u=parseInt(o["max-age"],10);isNaN(u)?delete o["max-age"]:o["max-age"]=u}return o}var Te=null;function Ye(t){if(Te==null){var o=t.navigator?t.navigator.userAgent:null;Te=!!t.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return Te}function De(t){try{var o=re[t];return o.setItem("_mapbox_test_",1),o.removeItem("_mapbox_test_"),!0}catch(u){return!1}}var wt,gt,Ut,Jt,Cr=re.performance&&re.performance.now?re.performance.now.bind(re.performance):Date.now.bind(Date),Yn=re.requestAnimationFrame||re.mozRequestAnimationFrame||re.webkitRequestAnimationFrame||re.msRequestAnimationFrame,hn=re.cancelAnimationFrame||re.mozCancelAnimationFrame||re.webkitCancelAnimationFrame||re.msCancelAnimationFrame,qi={now:Cr,frame:function(t){var o=Yn(t);return{cancel:function(){return hn(o)}}},getImageData:function(t,o){o===void 0&&(o=0);var u=re.document.createElement("canvas"),p=u.getContext("2d");if(!p)throw new Error("failed to create canvas 2d context");return u.width=t.width,u.height=t.height,p.drawImage(t,0,0,t.width,t.height),p.getImageData(-o,-o,t.width+2*o,t.height+2*o)},resolveURL:function(t){return wt||(wt=re.document.createElement("a")),wt.href=t,wt.href},hardwareConcurrency:re.navigator&&re.navigator.hardwareConcurrency||4,get devicePixelRatio(){return re.devicePixelRatio},get prefersReducedMotion(){return!!re.matchMedia&&(gt==null&&(gt=re.matchMedia("(prefers-reduced-motion: reduce)")),gt.matches)}},jn={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Xn={supported:!1,testSupport:function(t){!vi&&Jt&&(qn?li(t):Ut=t)}},vi=!1,qn=!1;function li(t){var o=t.createTexture();t.bindTexture(t.TEXTURE_2D,o);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,Jt),t.isContextLost())return;Xn.supported=!0}catch(u){}t.deleteTexture(o),vi=!0}re.document&&((Jt=re.document.createElement("img")).onload=function(){Ut&&li(Ut),Ut=null,qn=!0},Jt.onerror=function(){vi=!0,Ut=null},Jt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var aa="01",Di=function(t,o){this._transformRequestFn=t,this._customAccessToken=o,this._createSkuToken()};function Ai(t){return t.indexOf("mapbox:")===0}Di.prototype._createSkuToken=function(){var t=function(){for(var o="",u=0;u<10;u++)o+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",aa,o].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt},Di.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},Di.prototype.transformRequest=function(t,o){return this._transformRequestFn&&this._transformRequestFn(t,o)||{url:t}},Di.prototype.normalizeStyleURL=function(t,o){if(!Ai(t))return t;var u=Sa(t);return u.path="/styles/v1"+u.path,this._makeAPIURL(u,this._customAccessToken||o)},Di.prototype.normalizeGlyphsURL=function(t,o){if(!Ai(t))return t;var u=Sa(t);return u.path="/fonts/v1"+u.path,this._makeAPIURL(u,this._customAccessToken||o)},Di.prototype.normalizeSourceURL=function(t,o){if(!Ai(t))return t;var u=Sa(t);return u.path="/v4/"+u.authority+".json",u.params.push("secure"),this._makeAPIURL(u,this._customAccessToken||o)},Di.prototype.normalizeSpriteURL=function(t,o,u,p){var g=Sa(t);return Ai(t)?(g.path="/styles/v1"+g.path+"/sprite"+o+u,this._makeAPIURL(g,this._customAccessToken||p)):(g.path+=""+o+u,Mn(g))},Di.prototype.normalizeTileURL=function(t,o){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!Ai(t))return t;var u=Sa(t);u.path=u.path.replace(/(\.(png|jpg)\d*)(?=$)/,(qi.devicePixelRatio>=2||o===512?"@2x":"")+(Xn.supported?".webp":"$1")),u.path=u.path.replace(/^.+\/v4\//,"/"),u.path="/v4"+u.path;var p=this._customAccessToken||function(g){for(var x=0,S=g;x<S.length;x+=1){var M=S[x].match(/^access_token=(.*)$/);if(M)return M[1]}return null}(u.params)||jn.ACCESS_TOKEN;return jn.REQUIRE_ACCESS_TOKEN&&p&&this._skuToken&&u.params.push("sku="+this._skuToken),this._makeAPIURL(u,p)},Di.prototype.canonicalizeTileURL=function(t,o){var u=Sa(t);if(!u.path.match(/(^\/v4\/)/)||!u.path.match(/\.[\w]+$/))return t;var p="mapbox://tiles/";p+=u.path.replace("/v4/","");var g=u.params;return o&&(g=g.filter(function(x){return!x.match(/^access_token=/)})),g.length&&(p+="?"+g.join("&")),p},Di.prototype.canonicalizeTileset=function(t,o){for(var u=!!o&&Ai(o),p=[],g=0,x=t.tiles||[];g<x.length;g+=1){var S=x[g];la(S)?p.push(this.canonicalizeTileURL(S,u)):p.push(S)}return p},Di.prototype._makeAPIURL=function(t,o){var u="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",p=Sa(jn.API_URL);if(t.protocol=p.protocol,t.authority=p.authority,t.protocol==="http"){var g=t.params.indexOf("secure");g>=0&&t.params.splice(g,1)}if(p.path!=="/"&&(t.path=""+p.path+t.path),!jn.REQUIRE_ACCESS_TOKEN)return Mn(t);if(!(o=o||jn.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+u);if(o[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+u);return t.params=t.params.filter(function(x){return x.indexOf("access_token")===-1}),t.params.push("access_token="+o),Mn(t)};var Vi=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function la(t){return Vi.test(t)}var wi=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Sa(t){var o=t.match(wi);if(!o)throw new Error("Unable to parse URL object");return{protocol:o[1],authority:o[2],path:o[3]||"/",params:o[4]?o[4].split("&"):[]}}function Mn(t){var o=t.params.length?"?"+t.params.join("&"):"";return t.protocol+"://"+t.authority+t.path+o}function Si(t){if(!t)return null;var o=t.split(".");if(!o||o.length!==3)return null;try{return JSON.parse(decodeURIComponent(re.atob(o[1]).split("").map(function(u){return"%"+("00"+u.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(u){return null}}var ji=function(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};ji.prototype.getStorageKey=function(t){var o,u=Si(jn.ACCESS_TOKEN);return o=u&&u.u?re.btoa(encodeURIComponent(u.u).replace(/%([0-9A-F]{2})/g,function(p,g){return String.fromCharCode(Number("0x"+g))})):jn.ACCESS_TOKEN||"",t?"mapbox.eventData."+t+":"+o:"mapbox.eventData:"+o},ji.prototype.fetchEventData=function(){var t=De("localStorage"),o=this.getStorageKey(),u=this.getStorageKey("uuid");if(t)try{var p=re.localStorage.getItem(o);p&&(this.eventData=JSON.parse(p));var g=re.localStorage.getItem(u);g&&(this.anonId=g)}catch(x){$e("Unable to read from LocalStorage")}},ji.prototype.saveEventData=function(){var t=De("localStorage"),o=this.getStorageKey(),u=this.getStorageKey("uuid");if(t)try{re.localStorage.setItem(u,this.anonId),Object.keys(this.eventData).length>=1&&re.localStorage.setItem(o,JSON.stringify(this.eventData))}catch(p){$e("Unable to write to LocalStorage")}},ji.prototype.processRequests=function(t){},ji.prototype.postEvent=function(t,o,u,p){var g=this;if(jn.EVENTS_URL){var x=Sa(jn.EVENTS_URL);x.params.push("access_token="+(p||jn.ACCESS_TOKEN||""));var S={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.2",skuId:aa,userId:this.anonId},M=o?bt(S,o):S,D={url:Mn(x),headers:{"Content-Type":"text/plain"},body:JSON.stringify([M])};this.pendingRequest=Ta(D,function(U){g.pendingRequest=null,u(U),g.saveEventData(),g.processRequests(p)})}},ji.prototype.queueRequest=function(t,o){this.queue.push(t),this.processRequests(o)};var Ki,Wa,ve=function(t){function o(){t.call(this,"map.load"),this.success={},this.skuToken=""}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.postMapLoadEvent=function(u,p,g,x){this.skuToken=g,(jn.EVENTS_URL&&x||jn.ACCESS_TOKEN&&Array.isArray(u)&&u.some(function(S){return Ai(S)||la(S)}))&&this.queueRequest({id:p,timestamp:Date.now()},x)},o.prototype.processRequests=function(u){var p=this;if(!this.pendingRequest&&this.queue.length!==0){var g=this.queue.shift(),x=g.id,S=g.timestamp;x&&this.success[x]||(this.anonId||this.fetchEventData(),ct(this.anonId)||(this.anonId=ot()),this.postEvent(S,{skuToken:this.skuToken},function(M){M||x&&(p.success[x]=!0)},u))}},o}(ji),Fn=new(function(t){function o(u){t.call(this,"appUserTurnstile"),this._customAccessToken=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.postTurnstileEvent=function(u,p){jn.EVENTS_URL&&jn.ACCESS_TOKEN&&Array.isArray(u)&&u.some(function(g){return Ai(g)||la(g)})&&this.queueRequest(Date.now(),p)},o.prototype.processRequests=function(u){var p=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var g=Si(jn.ACCESS_TOKEN),x=g?g.u:jn.ACCESS_TOKEN,S=x!==this.eventData.tokenU;ct(this.anonId)||(this.anonId=ot(),S=!0);var M=this.queue.shift();if(this.eventData.lastSuccess){var D=new Date(this.eventData.lastSuccess),U=new Date(M),j=(M-this.eventData.lastSuccess)/864e5;S=S||j>=1||j<-1||D.getDate()!==U.getDate()}else S=!0;if(!S)return this.processRequests();this.postEvent(M,{"enabled.telemetry":!1},function(G){G||(p.eventData.lastSuccess=M,p.eventData.tokenU=x)},u)}},o}(ji)),Xa=Fn.postTurnstileEvent.bind(Fn),fs=new ve,jt=fs.postMapLoadEvent.bind(fs),sr=500,Tr=50;function I(){re.caches&&!Ki&&(Ki=re.caches.open("mapbox-tiles"))}function ur(t){var o=t.indexOf("?");return o<0?t:t.slice(0,o)}var Ln,ci=1/0;function Gn(){return Ln==null&&(Ln=re.OffscreenCanvas&&new re.OffscreenCanvas(1,1).getContext("2d")&&typeof re.createImageBitmap=="function"),Ln}var rn={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(rn);var Pi=function(t){function o(u,p,g){p===401&&la(g)&&(u+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),t.call(this,u),this.status=p,this.url=g,this.name=this.constructor.name,this.message=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},o}(Error),Ii=Pr()?function(){return self.worker&&self.worker.referrer}:function(){return(re.location.protocol==="blob:"?re.parent:re).location.href},Ja,hs,_a=function(t,o){if(!(/^file:/.test(u=t.url)||/^file:/.test(Ii())&&!/^\w+:/.test(u))){if(re.fetch&&re.Request&&re.AbortController&&re.Request.prototype.hasOwnProperty("signal"))return function(p,g){var x,S=new re.AbortController,M=new re.Request(p.url,{method:p.method||"GET",body:p.body,credentials:p.credentials,headers:p.headers,referrer:Ii(),signal:S.signal}),D=!1,U=!1,j=(x=M.url).indexOf("sku=")>0&&la(x);p.type==="json"&&M.headers.set("Accept","application/json");var G=function(le,Ie,ke){if(!U){if(le&&le.message!=="SecurityError"&&$e(le),Ie&&ke)return ae(Ie);var Ke=Date.now();re.fetch(M).then(function(Ue){if(Ue.ok){var st=j?Ue.clone():null;return ae(Ue,st,Ke)}return g(new Pi(Ue.statusText,Ue.status,p.url))}).catch(function(Ue){Ue.code!==20&&g(new Error(Ue.message))})}},ae=function(le,Ie,ke){(p.type==="arrayBuffer"?le.arrayBuffer():p.type==="json"?le.json():le.text()).then(function(Ke){U||(Ie&&ke&&function(Ue,st,St){if(I(),Ki){var Gt={status:st.status,statusText:st.statusText,headers:new re.Headers};st.headers.forEach(function(or,Ir){return Gt.headers.set(Ir,or)});var Zt=Wr(st.headers.get("Cache-Control")||"");Zt["no-store"]||(Zt["max-age"]&&Gt.headers.set("Expires",new Date(St+1e3*Zt["max-age"]).toUTCString()),new Date(Gt.headers.get("Expires")).getTime()-St<42e4||function(or,Ir){if(Wa===void 0)try{new Response(new ReadableStream),Wa=!0}catch(Xr){Wa=!1}Wa?Ir(or.body):or.blob().then(Ir)}(st,function(or){var Ir=new re.Response(or,Gt);I(),Ki&&Ki.then(function(Xr){return Xr.put(ur(Ue.url),Ir)}).catch(function(Xr){return $e(Xr.message)})}))}}(M,Ie,ke),D=!0,g(null,Ke,le.headers.get("Cache-Control"),le.headers.get("Expires")))}).catch(function(Ke){U||g(new Error(Ke.message))})};return j?function(le,Ie){if(I(),!Ki)return Ie(null);var ke=ur(le.url);Ki.then(function(Ke){Ke.match(ke).then(function(Ue){var st=function(St){if(!St)return!1;var Gt=new Date(St.headers.get("Expires")||0),Zt=Wr(St.headers.get("Cache-Control")||"");return Gt>Date.now()&&!Zt["no-cache"]}(Ue);Ke.delete(ke),st&&Ke.put(ke,Ue.clone()),Ie(null,Ue,st)}).catch(Ie)}).catch(Ie)}(M,G):G(null,null),{cancel:function(){U=!0,D||S.abort()}}}(t,o);if(Pr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,o,void 0,!0)}var u;return function(p,g){var x=new re.XMLHttpRequest;for(var S in x.open(p.method||"GET",p.url,!0),p.type==="arrayBuffer"&&(x.responseType="arraybuffer"),p.headers)x.setRequestHeader(S,p.headers[S]);return p.type==="json"&&(x.responseType="text",x.setRequestHeader("Accept","application/json")),x.withCredentials=p.credentials==="include",x.onerror=function(){g(new Error(x.statusText))},x.onload=function(){if((x.status>=200&&x.status<300||x.status===0)&&x.response!==null){var M=x.response;if(p.type==="json")try{M=JSON.parse(x.response)}catch(D){return g(D)}g(null,M,x.getResponseHeader("Cache-Control"),x.getResponseHeader("Expires"))}else g(new Pi(x.statusText,x.status,p.url))},x.send(p.body),{cancel:function(){return x.abort()}}}(t,o)},Da=function(t,o){return _a(bt(t,{type:"arrayBuffer"}),o)},Ta=function(t,o){return _a(bt(t,{method:"POST"}),o)},V="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";Ja=[],hs=0;var $=function(t,o){if(Xn.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),hs>=jn.MAX_PARALLEL_IMAGE_REQUESTS){var u={requestParameters:t,callback:o,cancelled:!1,cancel:function(){this.cancelled=!0}};return Ja.push(u),u}hs++;var p=!1,g=function(){if(!p)for(p=!0,hs--;Ja.length&&hs<jn.MAX_PARALLEL_IMAGE_REQUESTS;){var S=Ja.shift();S.cancelled||(S.cancel=$(S.requestParameters,S.callback).cancel)}},x=Da(t,function(S,M,D,U){g(),S?o(S):M&&(Gn()?function(j,G){var ae=new re.Blob([new Uint8Array(j)],{type:"image/png"});re.createImageBitmap(ae).then(function(le){G(null,le)}).catch(function(le){G(new Error("Could not load image because of "+le.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(M,o):function(j,G,ae,le){var Ie=new re.Image,ke=re.URL;Ie.onload=function(){G(null,Ie),ke.revokeObjectURL(Ie.src),Ie.onload=null,re.requestAnimationFrame(function(){Ie.src=V})},Ie.onerror=function(){return G(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var Ke=new re.Blob([new Uint8Array(j)],{type:"image/png"});Ie.cacheControl=ae,Ie.expires=le,Ie.src=j.byteLength?ke.createObjectURL(Ke):V}(M,o,D,U))});return{cancel:function(){x.cancel(),g()}}};function se(t,o,u){u[t]&&u[t].indexOf(o)!==-1||(u[t]=u[t]||[],u[t].push(o))}function ge(t,o,u){if(u&&u[t]){var p=u[t].indexOf(o);p!==-1&&u[t].splice(p,1)}}var Oe=function(t,o){o===void 0&&(o={}),bt(this,o),this.type=t},We=function(t){function o(u,p){p===void 0&&(p={}),t.call(this,"error",bt({error:u},p))}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(Oe),nt=function(){};nt.prototype.on=function(t,o){return this._listeners=this._listeners||{},se(t,o,this._listeners),this},nt.prototype.off=function(t,o){return ge(t,o,this._listeners),ge(t,o,this._oneTimeListeners),this},nt.prototype.once=function(t,o){return this._oneTimeListeners=this._oneTimeListeners||{},se(t,o,this._oneTimeListeners),this},nt.prototype.fire=function(t,o){typeof t=="string"&&(t=new Oe(t,o||{}));var u=t.type;if(this.listens(u)){t.target=this;for(var p=0,g=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];p<g.length;p+=1)g[p].call(this,t);for(var x=0,S=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];x<S.length;x+=1){var M=S[x];ge(u,M,this._oneTimeListeners),M.call(this,t)}var D=this._eventedParent;D&&(bt(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),D.fire(t))}else t instanceof We&&console.error(t.error);return this},nt.prototype.listens=function(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)},nt.prototype.setEventedParent=function(t,o){return this._eventedParent=t,this._eventedParentData=o,this};var pe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},Fe=function(t,o,u,p){this.message=(t?t+": ":"")+u,p&&(this.identifier=p),o!=null&&o.__line__&&(this.line=o.__line__)};function yt(t){var o=t.value;return o?[new Fe(t.key,o,"constants have been deprecated as of v8")]:[]}function dr(t){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];for(var p=0,g=o;p<g.length;p+=1){var x=g[p];for(var S in x)t[S]=x[S]}return t}function Dt(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function zt(t){if(Array.isArray(t))return t.map(zt);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){var o={};for(var u in t)o[u]=zt(t[u]);return o}return Dt(t)}var gr=function(t){function o(u,p){t.call(this,p),this.message=p,this.key=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(Error),En=function(t,o){o===void 0&&(o=[]),this.parent=t,this.bindings={};for(var u=0,p=o;u<p.length;u+=1){var g=p[u];this.bindings[g[0]]=g[1]}};En.prototype.concat=function(t){return new En(this,t)},En.prototype.get=function(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")},En.prototype.has=function(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)};var un={kind:"null"},Tt={kind:"number"},nn={kind:"string"},Zr={kind:"boolean"},Yr={kind:"color"},oi={kind:"object"},Qr={kind:"value"},Ti={kind:"collator"},ea={kind:"formatted"},bi={kind:"resolvedImage"};function Oi(t,o){return{kind:"array",itemType:t,N:o}}function Ci(t){if(t.kind==="array"){var o=Ci(t.itemType);return typeof t.N=="number"?"array<"+o+", "+t.N+">":t.itemType.kind==="value"?"array":"array<"+o+">"}return t.kind}var ti=[un,Tt,nn,Zr,Yr,ea,oi,Oi(Qr),bi];function Xi(t,o){if(o.kind==="error")return null;if(t.kind==="array"){if(o.kind==="array"&&(o.N===0&&o.itemType.kind==="value"||!Xi(t.itemType,o.itemType))&&(typeof t.N!="number"||t.N===o.N))return null}else{if(t.kind===o.kind)return null;if(t.kind==="value"){for(var u=0,p=ti;u<p.length;u+=1)if(!Xi(p[u],o))return null}}return"Expected "+Ci(t)+" but found "+Ci(o)+" instead."}function Fa(t,o){return o.some(function(u){return u.kind===t.kind})}function oa(t,o){return o.some(function(u){return u==="null"?t===null:u==="array"?Array.isArray(t):u==="object"?t&&!Array.isArray(t)&&typeof t=="object":u===typeof t})}var Ri=te(function(t,o){var u={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function p(M){return(M=Math.round(M))<0?0:M>255?255:M}function g(M){return p(M[M.length-1]==="%"?parseFloat(M)/100*255:parseInt(M))}function x(M){return(D=M[M.length-1]==="%"?parseFloat(M)/100:parseFloat(M))<0?0:D>1?1:D;var D}function S(M,D,U){return U<0?U+=1:U>1&&(U-=1),6*U<1?M+(D-M)*U*6:2*U<1?D:3*U<2?M+(D-M)*(2/3-U)*6:M}try{o.parseCSSColor=function(M){var D,U=M.replace(/ /g,"").toLowerCase();if(U in u)return u[U].slice();if(U[0]==="#")return U.length===4?(D=parseInt(U.substr(1),16))>=0&&D<=4095?[(3840&D)>>4|(3840&D)>>8,240&D|(240&D)>>4,15&D|(15&D)<<4,1]:null:U.length===7&&(D=parseInt(U.substr(1),16))>=0&&D<=16777215?[(16711680&D)>>16,(65280&D)>>8,255&D,1]:null;var j=U.indexOf("("),G=U.indexOf(")");if(j!==-1&&G+1===U.length){var ae=U.substr(0,j),le=U.substr(j+1,G-(j+1)).split(","),Ie=1;switch(ae){case"rgba":if(le.length!==4)return null;Ie=x(le.pop());case"rgb":return le.length!==3?null:[g(le[0]),g(le[1]),g(le[2]),Ie];case"hsla":if(le.length!==4)return null;Ie=x(le.pop());case"hsl":if(le.length!==3)return null;var ke=(parseFloat(le[0])%360+360)%360/360,Ke=x(le[1]),Ue=x(le[2]),st=Ue<=.5?Ue*(Ke+1):Ue+Ke-Ue*Ke,St=2*Ue-st;return[p(255*S(St,st,ke+1/3)),p(255*S(St,st,ke)),p(255*S(St,st,ke-1/3)),Ie];default:return null}}return null}}catch(M){}}).parseCSSColor,Gi=function(t,o,u,p){p===void 0&&(p=1),this.r=t,this.g=o,this.b=u,this.a=p};Gi.parse=function(t){if(t){if(t instanceof Gi)return t;if(typeof t=="string"){var o=Ri(t);if(o)return new Gi(o[0]/255*o[3],o[1]/255*o[3],o[2]/255*o[3],o[3])}}},Gi.prototype.toString=function(){var t=this.toArray(),o=t[1],u=t[2],p=t[3];return"rgba("+Math.round(t[0])+","+Math.round(o)+","+Math.round(u)+","+p+")"},Gi.prototype.toArray=function(){var t=this.a;return t===0?[0,0,0,0]:[255*this.r/t,255*this.g/t,255*this.b/t,t]},Gi.black=new Gi(0,0,0,1),Gi.white=new Gi(1,1,1,1),Gi.transparent=new Gi(0,0,0,0),Gi.red=new Gi(1,0,0,1);var Za=function(t,o,u){this.sensitivity=t?o?"variant":"case":o?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Za.prototype.compare=function(t,o){return this.collator.compare(t,o)},Za.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var au=function(t,o,u,p,g){this.text=t,this.image=o,this.scale=u,this.fontStack=p,this.textColor=g},Ma=function(t){this.sections=t};Ma.fromString=function(t){return new Ma([new au(t,null,null,null,null)])},Ma.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(t){return t.text.length!==0||t.image&&t.image.name.length!==0})},Ma.factory=function(t){return t instanceof Ma?t:Ma.fromString(t)},Ma.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(t){return t.text}).join("")},Ma.prototype.serialize=function(){for(var t=["format"],o=0,u=this.sections;o<u.length;o+=1){var p=u[o];if(p.image)t.push(["image",p.image.name]);else{t.push(p.text);var g={};p.fontStack&&(g["text-font"]=["literal",p.fontStack.split(",")]),p.scale&&(g["font-scale"]=p.scale),p.textColor&&(g["text-color"]=["rgba"].concat(p.textColor.toArray())),t.push(g)}}return t};var Pa=function(t){this.name=t.name,this.available=t.available};function Es(t,o,u,p){return typeof t=="number"&&t>=0&&t<=255&&typeof o=="number"&&o>=0&&o<=255&&typeof u=="number"&&u>=0&&u<=255?p===void 0||typeof p=="number"&&p>=0&&p<=1?null:"Invalid rgba value ["+[t,o,u,p].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof p=="number"?[t,o,u,p]:[t,o,u]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function ps(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof Gi||t instanceof Za||t instanceof Ma||t instanceof Pa)return!0;if(Array.isArray(t)){for(var o=0,u=t;o<u.length;o+=1)if(!ps(u[o]))return!1;return!0}if(typeof t=="object"){for(var p in t)if(!ps(t[p]))return!1;return!0}return!1}function ra(t){if(t===null)return un;if(typeof t=="string")return nn;if(typeof t=="boolean")return Zr;if(typeof t=="number")return Tt;if(t instanceof Gi)return Yr;if(t instanceof Za)return Ti;if(t instanceof Ma)return ea;if(t instanceof Pa)return bi;if(Array.isArray(t)){for(var o,u=t.length,p=0,g=t;p<g.length;p+=1){var x=ra(g[p]);if(o){if(o===x)continue;o=Qr;break}o=x}return Oi(o||Qr,u)}return oi}function ju(t){var o=typeof t;return t===null?"":o==="string"||o==="number"||o==="boolean"?String(t):t instanceof Gi||t instanceof Ma||t instanceof Pa?t.toString():JSON.stringify(t)}Pa.prototype.toString=function(){return this.name},Pa.fromString=function(t){return t?new Pa({name:t,available:!1}):null},Pa.prototype.serialize=function(){return["image",this.name]};var yo=function(t,o){this.type=t,this.value=o};yo.parse=function(t,o){if(t.length!==2)return o.error("'literal' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(!ps(t[1]))return o.error("invalid value");var u=t[1],p=ra(u),g=o.expectedType;return p.kind!=="array"||p.N!==0||!g||g.kind!=="array"||typeof g.N=="number"&&g.N!==0||(p=g),new yo(p,u)},yo.prototype.evaluate=function(){return this.value},yo.prototype.eachChild=function(){},yo.prototype.outputDefined=function(){return!0},yo.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Gi?["rgba"].concat(this.value.toArray()):this.value instanceof Ma?this.value.serialize():this.value};var ja=function(t){this.name="ExpressionEvaluationError",this.message=t};ja.prototype.toJSON=function(){return this.message};var oo={string:nn,number:Tt,boolean:Zr,object:oi},$i=function(t,o){this.type=t,this.args=o};$i.parse=function(t,o){if(t.length<2)return o.error("Expected at least one argument.");var u,p=1,g=t[0];if(g==="array"){var x,S;if(t.length>2){var M=t[1];if(typeof M!="string"||!(M in oo)||M==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);x=oo[M],p++}else x=Qr;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return o.error('The length argument to "array" must be a positive integer literal',2);S=t[2],p++}u=Oi(x,S)}else u=oo[g];for(var D=[];p<t.length;p++){var U=o.parse(t[p],p,Qr);if(!U)return null;D.push(U)}return new $i(u,D)},$i.prototype.evaluate=function(t){for(var o=0;o<this.args.length;o++){var u=this.args[o].evaluate(t);if(!Xi(this.type,ra(u)))return u;if(o===this.args.length-1)throw new ja("Expected value to be of type "+Ci(this.type)+", but found "+Ci(ra(u))+" instead.")}return null},$i.prototype.eachChild=function(t){this.args.forEach(t)},$i.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},$i.prototype.serialize=function(){var t=this.type,o=[t.kind];if(t.kind==="array"){var u=t.itemType;if(u.kind==="string"||u.kind==="number"||u.kind==="boolean"){o.push(u.kind);var p=t.N;(typeof p=="number"||this.args.length>1)&&o.push(p)}}return o.concat(this.args.map(function(g){return g.serialize()}))};var qo=function(t){this.type=ea,this.sections=t};qo.parse=function(t,o){if(t.length<2)return o.error("Expected at least one argument.");var u=t[1];if(!Array.isArray(u)&&typeof u=="object")return o.error("First argument must be an image or text section.");for(var p=[],g=!1,x=1;x<=t.length-1;++x){var S=t[x];if(g&&typeof S=="object"&&!Array.isArray(S)){g=!1;var M=null;if(S["font-scale"]&&!(M=o.parse(S["font-scale"],1,Tt)))return null;var D=null;if(S["text-font"]&&!(D=o.parse(S["text-font"],1,Oi(nn))))return null;var U=null;if(S["text-color"]&&!(U=o.parse(S["text-color"],1,Yr)))return null;var j=p[p.length-1];j.scale=M,j.font=D,j.textColor=U}else{var G=o.parse(t[x],1,Qr);if(!G)return null;var ae=G.type.kind;if(ae!=="string"&&ae!=="value"&&ae!=="null"&&ae!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,p.push({content:G,scale:null,font:null,textColor:null})}}return new qo(p)},qo.prototype.evaluate=function(t){return new Ma(this.sections.map(function(o){var u=o.content.evaluate(t);return ra(u)===bi?new au("",u,null,null,null):new au(ju(u),null,o.scale?o.scale.evaluate(t):null,o.font?o.font.evaluate(t).join(","):null,o.textColor?o.textColor.evaluate(t):null)}))},qo.prototype.eachChild=function(t){for(var o=0,u=this.sections;o<u.length;o+=1){var p=u[o];t(p.content),p.scale&&t(p.scale),p.font&&t(p.font),p.textColor&&t(p.textColor)}},qo.prototype.outputDefined=function(){return!1},qo.prototype.serialize=function(){for(var t=["format"],o=0,u=this.sections;o<u.length;o+=1){var p=u[o];t.push(p.content.serialize());var g={};p.scale&&(g["font-scale"]=p.scale.serialize()),p.font&&(g["text-font"]=p.font.serialize()),p.textColor&&(g["text-color"]=p.textColor.serialize()),t.push(g)}return t};var Ko=function(t){this.type=bi,this.input=t};Ko.parse=function(t,o){if(t.length!==2)return o.error("Expected two arguments.");var u=o.parse(t[1],1,nn);return u?new Ko(u):o.error("No image name provided.")},Ko.prototype.evaluate=function(t){var o=this.input.evaluate(t),u=Pa.fromString(o);return u&&t.availableImages&&(u.available=t.availableImages.indexOf(o)>-1),u},Ko.prototype.eachChild=function(t){t(this.input)},Ko.prototype.outputDefined=function(){return!1},Ko.prototype.serialize=function(){return["image",this.input.serialize()]};var Vu={"to-boolean":Zr,"to-color":Yr,"to-number":Tt,"to-string":nn},Co=function(t,o){this.type=t,this.args=o};Co.parse=function(t,o){if(t.length<2)return o.error("Expected at least one argument.");var u=t[0];if((u==="to-boolean"||u==="to-string")&&t.length!==2)return o.error("Expected one argument.");for(var p=Vu[u],g=[],x=1;x<t.length;x++){var S=o.parse(t[x],x,Qr);if(!S)return null;g.push(S)}return new Co(p,g)},Co.prototype.evaluate=function(t){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(t));if(this.type.kind==="color"){for(var o,u,p=0,g=this.args;p<g.length;p+=1){if(u=null,(o=g[p].evaluate(t))instanceof Gi)return o;if(typeof o=="string"){var x=t.parseColor(o);if(x)return x}else if(Array.isArray(o)&&!(u=o.length<3||o.length>4?"Invalid rbga value "+JSON.stringify(o)+": expected an array containing either three or four numeric values.":Es(o[0],o[1],o[2],o[3])))return new Gi(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new ja(u||"Could not parse color from value '"+(typeof o=="string"?o:String(JSON.stringify(o)))+"'")}if(this.type.kind==="number"){for(var S=null,M=0,D=this.args;M<D.length;M+=1){if((S=D[M].evaluate(t))===null)return 0;var U=Number(S);if(!isNaN(U))return U}throw new ja("Could not convert "+JSON.stringify(S)+" to number.")}return this.type.kind==="formatted"?Ma.fromString(ju(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?Pa.fromString(ju(this.args[0].evaluate(t))):ju(this.args[0].evaluate(t))},Co.prototype.eachChild=function(t){this.args.forEach(t)},Co.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},Co.prototype.serialize=function(){if(this.type.kind==="formatted")return new qo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Ko(this.args[0]).serialize();var t=["to-"+this.type.kind];return this.eachChild(function(o){t.push(o.serialize())}),t};var $o=["Unknown","Point","LineString","Polygon"],xa=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};xa.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},xa.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?$o[this.feature.type]:this.feature.type:null},xa.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},xa.prototype.canonicalID=function(){return this.canonical},xa.prototype.properties=function(){return this.feature&&this.feature.properties||{}},xa.prototype.parseColor=function(t){var o=this._parseColorCache[t];return o||(o=this._parseColorCache[t]=Gi.parse(t)),o};var _o=function(t,o,u,p){this.name=t,this.type=o,this._evaluate=u,this.args=p};_o.prototype.evaluate=function(t){return this._evaluate(t,this.args)},_o.prototype.eachChild=function(t){this.args.forEach(t)},_o.prototype.outputDefined=function(){return!1},_o.prototype.serialize=function(){return[this.name].concat(this.args.map(function(t){return t.serialize()}))},_o.parse=function(t,o){var u,p=t[0],g=_o.definitions[p];if(!g)return o.error('Unknown expression "'+p+'". If you wanted a literal array, use ["literal", [...]].',0);for(var x=Array.isArray(g)?g[0]:g.type,S=Array.isArray(g)?[[g[1],g[2]]]:g.overloads,M=S.filter(function(Un){var gn=Un[0];return!Array.isArray(gn)||gn.length===t.length-1}),D=null,U=0,j=M;U<j.length;U+=1){var G=j[U],ae=G[0],le=G[1];D=new Ks(o.registry,o.path,null,o.scope);for(var Ie=[],ke=!1,Ke=1;Ke<t.length;Ke++){var Ue=t[Ke],st=Array.isArray(ae)?ae[Ke-1]:ae.type,St=D.parse(Ue,1+Ie.length,st);if(!St){ke=!0;break}Ie.push(St)}if(!ke)if(Array.isArray(ae)&&ae.length!==Ie.length)D.error("Expected "+ae.length+" arguments, but found "+Ie.length+" instead.");else{for(var Gt=0;Gt<Ie.length;Gt++){var Zt=Array.isArray(ae)?ae[Gt]:ae.type,or=Ie[Gt];D.concat(Gt+1).checkSubtype(Zt,or.type)}if(D.errors.length===0)return new _o(p,x,le,Ie)}}if(M.length===1)(u=o.errors).push.apply(u,D.errors);else{for(var Ir=(M.length?M:S).map(function(Un){var gn;return gn=Un[0],Array.isArray(gn)?"("+gn.map(Ci).join(", ")+")":"("+Ci(gn.type)+"...)"}).join(" | "),Xr=[],Dn=1;Dn<t.length;Dn++){var ln=o.parse(t[Dn],1+Xr.length);if(!ln)return null;Xr.push(Ci(ln.type))}o.error("Expected arguments of type "+Ir+", but found ("+Xr.join(", ")+") instead.")}return null},_o.register=function(t,o){for(var u in _o.definitions=o,o)t[u]=_o};var Jo=function(t,o,u){this.type=Ti,this.locale=u,this.caseSensitive=t,this.diacriticSensitive=o};function so(t,o){t[0]=Math.min(t[0],o[0]),t[1]=Math.min(t[1],o[1]),t[2]=Math.max(t[2],o[0]),t[3]=Math.max(t[3],o[1])}function ou(t,o){return!(t[0]<=o[0]||t[2]>=o[2]||t[1]<=o[1]||t[3]>=o[3])}function xc(t,o){var u=(180+t[0])/360,p=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,g=Math.pow(2,o.z);return[Math.round(u*g*8192),Math.round(p*g*8192)]}function Ds(t,o,u){return o[1]>t[1]!=u[1]>t[1]&&t[0]<(u[0]-o[0])*(t[1]-o[1])/(u[1]-o[1])+o[0]}function ne(t,o){for(var u,p,g,x,S,M,D,U=!1,j=0,G=o.length;j<G;j++)for(var ae=o[j],le=0,Ie=ae.length;le<Ie-1;le++){if((x=(u=t)[0]-(p=ae[le])[0])*(D=u[1]-(g=ae[le+1])[1])-(M=u[0]-g[0])*(S=u[1]-p[1])==0&&x*M<=0&&S*D<=0)return!1;Ds(t,ae[le],ae[le+1])&&(U=!U)}return U}function be(t,o){for(var u=0;u<o.length;u++)if(ne(t,o[u]))return!0;return!1}function Qe(t,o,u,p){var g=p[0]-u[0],x=p[1]-u[1],S=(t[0]-u[0])*x-g*(t[1]-u[1]),M=(o[0]-u[0])*x-g*(o[1]-u[1]);return S>0&&M<0||S<0&&M>0}function Rt(t,o,u){for(var p=0,g=u;p<g.length;p+=1)for(var x=g[p],S=0;S<x.length-1;++S)if((G=[(j=x[S+1])[0]-(U=x[S])[0],j[1]-U[1]])[0]*(ae=[(D=o)[0]-(M=t)[0],D[1]-M[1]])[1]-G[1]*ae[0]!=0&&Qe(M,D,U,j)&&Qe(U,j,M,D))return!0;var M,D,U,j,G,ae;return!1}function kr(t,o){for(var u=0;u<t.length;++u)if(!ne(t[u],o))return!1;for(var p=0;p<t.length-1;++p)if(Rt(t[p],t[p+1],o))return!1;return!0}function lt(t,o){for(var u=0;u<o.length;u++)if(kr(t,o[u]))return!0;return!1}function It(t,o,u){for(var p=[],g=0;g<t.length;g++){for(var x=[],S=0;S<t[g].length;S++){var M=xc(t[g][S],u);so(o,M),x.push(M)}p.push(x)}return p}function uo(t,o,u){for(var p=[],g=0;g<t.length;g++){var x=It(t[g],o,u);p.push(x)}return p}function Ji(t,o,u,p){if(t[0]<u[0]||t[0]>u[2]){var g=.5*p,x=t[0]-u[0]>g?-p:u[0]-t[0]>g?p:0;x===0&&(x=t[0]-u[2]>g?-p:u[2]-t[0]>g?p:0),t[0]+=x}so(o,t)}function Ya(t,o,u,p){for(var g=8192*Math.pow(2,p.z),x=[8192*p.x,8192*p.y],S=[],M=0,D=t;M<D.length;M+=1)for(var U=0,j=D[M];U<j.length;U+=1){var G=j[U],ae=[G.x+x[0],G.y+x[1]];Ji(ae,o,u,g),S.push(ae)}return S}function Qo(t,o,u,p){for(var g,x=8192*Math.pow(2,p.z),S=[8192*p.x,8192*p.y],M=[],D=0,U=t;D<U.length;D+=1){for(var j=[],G=0,ae=U[D];G<ae.length;G+=1){var le=ae[G],Ie=[le.x+S[0],le.y+S[1]];so(o,Ie),j.push(Ie)}M.push(j)}if(o[2]-o[0]<=x/2){(g=o)[0]=g[1]=1/0,g[2]=g[3]=-1/0;for(var ke=0,Ke=M;ke<Ke.length;ke+=1)for(var Ue=0,st=Ke[ke];Ue<st.length;Ue+=1)Ji(st[Ue],o,u,x)}return M}Jo.parse=function(t,o){if(t.length!==2)return o.error("Expected one argument.");var u=t[1];if(typeof u!="object"||Array.isArray(u))return o.error("Collator options argument must be an object.");var p=o.parse(u["case-sensitive"]!==void 0&&u["case-sensitive"],1,Zr);if(!p)return null;var g=o.parse(u["diacritic-sensitive"]!==void 0&&u["diacritic-sensitive"],1,Zr);if(!g)return null;var x=null;return u.locale&&!(x=o.parse(u.locale,1,nn))?null:new Jo(p,g,x)},Jo.prototype.evaluate=function(t){return new Za(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)},Jo.prototype.eachChild=function(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)},Jo.prototype.outputDefined=function(){return!1},Jo.prototype.serialize=function(){var t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]};var pn=function(t,o){this.type=Zr,this.geojson=t,this.geometries=o};function cn(t){if(t instanceof _o&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof pn)return!1;var o=!0;return t.eachChild(function(u){o&&!cn(u)&&(o=!1)}),o}function Yt(t){if(t instanceof _o&&t.name==="feature-state")return!1;var o=!0;return t.eachChild(function(u){o&&!Yt(u)&&(o=!1)}),o}function Zo(t,o){if(t instanceof _o&&o.indexOf(t.name)>=0)return!1;var u=!0;return t.eachChild(function(p){u&&!Zo(p,o)&&(u=!1)}),u}pn.parse=function(t,o){if(t.length!==2)return o.error("'within' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(ps(t[1])){var u=t[1];if(u.type==="FeatureCollection")for(var p=0;p<u.features.length;++p){var g=u.features[p].geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new pn(u,u.features[p].geometry)}else if(u.type==="Feature"){var x=u.geometry.type;if(x==="Polygon"||x==="MultiPolygon")return new pn(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new pn(u,u)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")},pn.prototype.evaluate=function(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(o,u){var p=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],x=o.canonicalID();if(u.type==="Polygon"){var S=It(u.coordinates,g,x),M=Ya(o.geometry(),p,g,x);if(!ou(p,g))return!1;for(var D=0,U=M;D<U.length;D+=1)if(!ne(U[D],S))return!1}if(u.type==="MultiPolygon"){var j=uo(u.coordinates,g,x),G=Ya(o.geometry(),p,g,x);if(!ou(p,g))return!1;for(var ae=0,le=G;ae<le.length;ae+=1)if(!be(le[ae],j))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(o,u){var p=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],x=o.canonicalID();if(u.type==="Polygon"){var S=It(u.coordinates,g,x),M=Qo(o.geometry(),p,g,x);if(!ou(p,g))return!1;for(var D=0,U=M;D<U.length;D+=1)if(!kr(U[D],S))return!1}if(u.type==="MultiPolygon"){var j=uo(u.coordinates,g,x),G=Qo(o.geometry(),p,g,x);if(!ou(p,g))return!1;for(var ae=0,le=G;ae<le.length;ae+=1)if(!lt(le[ae],j))return!1}return!0}(t,this.geometries)}return!1},pn.prototype.eachChild=function(){},pn.prototype.outputDefined=function(){return!0},pn.prototype.serialize=function(){return["within",this.geojson]};var xe=function(t,o){this.type=o.type,this.name=t,this.boundExpression=o};xe.parse=function(t,o){if(t.length!==2||typeof t[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");var u=t[1];return o.scope.has(u)?new xe(u,o.scope.get(u)):o.error('Unknown variable "'+u+'". Make sure "'+u+'" has been bound in an enclosing "let" expression before using it.',1)},xe.prototype.evaluate=function(t){return this.boundExpression.evaluate(t)},xe.prototype.eachChild=function(){},xe.prototype.outputDefined=function(){return!1},xe.prototype.serialize=function(){return["var",this.name]};var Ks=function(t,o,u,p,g){o===void 0&&(o=[]),p===void 0&&(p=new En),g===void 0&&(g=[]),this.registry=t,this.path=o,this.key=o.map(function(x){return"["+x+"]"}).join(""),this.scope=p,this.errors=g,this.expectedType=u};function su(t,o){for(var u,p=t.length-1,g=0,x=p,S=0;g<=x;)if((u=t[S=Math.floor((g+x)/2)])<=o){if(S===p||o<t[S+1])return S;g=S+1}else{if(!(u>o))throw new ja("Input is not a number.");x=S-1}return 0}Ks.prototype.parse=function(t,o,u,p,g){return g===void 0&&(g={}),o?this.concat(o,u,p)._parse(t,g):this._parse(t,g)},Ks.prototype._parse=function(t,o){function u(U,j,G){return G==="assert"?new $i(j,[U]):G==="coerce"?new Co(j,[U]):U}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var p=t[0];if(typeof p!="string")return this.error("Expression name must be a string, but found "+typeof p+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var g=this.registry[p];if(g){var x=g.parse(t,this);if(!x)return null;if(this.expectedType){var S=this.expectedType,M=x.type;if(S.kind!=="string"&&S.kind!=="number"&&S.kind!=="boolean"&&S.kind!=="object"&&S.kind!=="array"||M.kind!=="value")if(S.kind!=="color"&&S.kind!=="formatted"&&S.kind!=="resolvedImage"||M.kind!=="value"&&M.kind!=="string"){if(this.checkSubtype(S,M))return null}else x=u(x,S,o.typeAnnotation||"coerce");else x=u(x,S,o.typeAnnotation||"assert")}if(!(x instanceof yo)&&x.type.kind!=="resolvedImage"&&function U(j){if(j instanceof xe)return U(j.boundExpression);if(j instanceof _o&&j.name==="error"||j instanceof Jo||j instanceof pn)return!1;var G=j instanceof Co||j instanceof $i,ae=!0;return j.eachChild(function(le){ae=G?ae&&U(le):ae&&le instanceof yo}),!!ae&&cn(j)&&Zo(j,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(x)){var D=new xa;try{x=new yo(x.type,x.evaluate(D))}catch(U){return this.error(U.message),null}}return x}return this.error('Unknown expression "'+p+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof t+" instead.")},Ks.prototype.concat=function(t,o,u){var p=typeof t=="number"?this.path.concat(t):this.path,g=u?this.scope.concat(u):this.scope;return new Ks(this.registry,p,o||null,g,this.errors)},Ks.prototype.error=function(t){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];var p=""+this.key+o.map(function(g){return"["+g+"]"}).join("");this.errors.push(new gr(p,t))},Ks.prototype.checkSubtype=function(t,o){var u=Xi(t,o);return u&&this.error(u),u};var ds=function(t,o,u){this.type=t,this.input=o,this.labels=[],this.outputs=[];for(var p=0,g=u;p<g.length;p+=1){var x=g[p],S=x[1];this.labels.push(x[0]),this.outputs.push(S)}};function sa(t,o,u){return t*(1-u)+o*u}ds.parse=function(t,o){if(t.length-1<4)return o.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return o.error("Expected an even number of arguments.");var u=o.parse(t[1],1,Tt);if(!u)return null;var p=[],g=null;o.expectedType&&o.expectedType.kind!=="value"&&(g=o.expectedType);for(var x=1;x<t.length;x+=2){var S=x===1?-1/0:t[x],M=t[x+1],D=x,U=x+1;if(typeof S!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(p.length&&p[p.length-1][0]>=S)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',D);var j=o.parse(M,U,g);if(!j)return null;g=g||j.type,p.push([S,j])}return new ds(g,u,p)},ds.prototype.evaluate=function(t){var o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(t);var p=this.input.evaluate(t);if(p<=o[0])return u[0].evaluate(t);var g=o.length;return p>=o[g-1]?u[g-1].evaluate(t):u[su(o,p)].evaluate(t)},ds.prototype.eachChild=function(t){t(this.input);for(var o=0,u=this.outputs;o<u.length;o+=1)t(u[o])},ds.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})},ds.prototype.serialize=function(){for(var t=["step",this.input.serialize()],o=0;o<this.labels.length;o++)o>0&&t.push(this.labels[o]),t.push(this.outputs[o].serialize());return t};var xo=Object.freeze({__proto__:null,number:sa,color:function(t,o,u){return new Gi(sa(t.r,o.r,u),sa(t.g,o.g,u),sa(t.b,o.b,u),sa(t.a,o.a,u))},array:function(t,o,u){return t.map(function(p,g){return sa(p,o[g],u)})}}),Wl=6/29*3*(6/29),bc=Math.PI/180,Gu=180/Math.PI;function Ec(t){return t>.008856451679035631?Math.pow(t,1/3):t/Wl+4/29}function Tl(t){return t>6/29?t*t*t:Wl*(t-4/29)}function Hu(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function uu(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Wu(t){var o=uu(t.r),u=uu(t.g),p=uu(t.b),g=Ec((.4124564*o+.3575761*u+.1804375*p)/.95047),x=Ec((.2126729*o+.7151522*u+.072175*p)/1);return{l:116*x-16,a:500*(g-x),b:200*(x-Ec((.0193339*o+.119192*u+.9503041*p)/1.08883)),alpha:t.a}}function _(t){var o=(t.l+16)/116,u=isNaN(t.a)?o:o+t.a/500,p=isNaN(t.b)?o:o-t.b/200;return o=1*Tl(o),u=.95047*Tl(u),p=1.08883*Tl(p),new Gi(Hu(3.2404542*u-1.5371385*o-.4985314*p),Hu(-.969266*u+1.8760108*o+.041556*p),Hu(.0556434*u-.2040259*o+1.0572252*p),t.alpha)}function w(t,o,u){var p=o-t;return t+u*(p>180||p<-180?p-360*Math.round(p/360):p)}var N={forward:Wu,reverse:_,interpolate:function(t,o,u){return{l:sa(t.l,o.l,u),a:sa(t.a,o.a,u),b:sa(t.b,o.b,u),alpha:sa(t.alpha,o.alpha,u)}}},O={forward:function(t){var o=Wu(t),u=o.l,p=o.a,g=o.b,x=Math.atan2(g,p)*Gu;return{h:x<0?x+360:x,c:Math.sqrt(p*p+g*g),l:u,alpha:t.a}},reverse:function(t){var o=t.h*bc,u=t.c;return _({l:t.l,a:Math.cos(o)*u,b:Math.sin(o)*u,alpha:t.alpha})},interpolate:function(t,o,u){return{h:w(t.h,o.h,u),c:sa(t.c,o.c,u),l:sa(t.l,o.l,u),alpha:sa(t.alpha,o.alpha,u)}}},K=Object.freeze({__proto__:null,lab:N,hcl:O}),_e=function(t,o,u,p,g){this.type=t,this.operator=o,this.interpolation=u,this.input=p,this.labels=[],this.outputs=[];for(var x=0,S=g;x<S.length;x+=1){var M=S[x],D=M[1];this.labels.push(M[0]),this.outputs.push(D)}};function Xe(t,o,u,p){var g=p-u,x=t-u;return g===0?0:o===1?x/g:(Math.pow(o,x)-1)/(Math.pow(o,g)-1)}_e.interpolationFactor=function(t,o,u,p){var g=0;if(t.name==="exponential")g=Xe(o,t.base,u,p);else if(t.name==="linear")g=Xe(o,1,u,p);else if(t.name==="cubic-bezier"){var x=t.controlPoints;g=new B(x[0],x[1],x[2],x[3]).solve(Xe(o,1,u,p))}return g},_e.parse=function(t,o){var u=t[0],p=t[1],g=t[2],x=t.slice(3);if(!Array.isArray(p)||p.length===0)return o.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){var S=p[1];if(typeof S!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:S}}else{if(p[0]!=="cubic-bezier")return o.error("Unknown interpolation type "+String(p[0]),1,0);var M=p.slice(1);if(M.length!==4||M.some(function(Ke){return typeof Ke!="number"||Ke<0||Ke>1}))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:M}}if(t.length-1<4)return o.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(!(g=o.parse(g,2,Tt)))return null;var D=[],U=null;u==="interpolate-hcl"||u==="interpolate-lab"?U=Yr:o.expectedType&&o.expectedType.kind!=="value"&&(U=o.expectedType);for(var j=0;j<x.length;j+=2){var G=x[j],ae=x[j+1],le=j+3,Ie=j+4;if(typeof G!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',le);if(D.length&&D[D.length-1][0]>=G)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',le);var ke=o.parse(ae,Ie,U);if(!ke)return null;U=U||ke.type,D.push([G,ke])}return U.kind==="number"||U.kind==="color"||U.kind==="array"&&U.itemType.kind==="number"&&typeof U.N=="number"?new _e(U,u,p,g,D):o.error("Type "+Ci(U)+" is not interpolatable.")},_e.prototype.evaluate=function(t){var o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(t);var p=this.input.evaluate(t);if(p<=o[0])return u[0].evaluate(t);var g=o.length;if(p>=o[g-1])return u[g-1].evaluate(t);var x=su(o,p),S=_e.interpolationFactor(this.interpolation,p,o[x],o[x+1]),M=u[x].evaluate(t),D=u[x+1].evaluate(t);return this.operator==="interpolate"?xo[this.type.kind.toLowerCase()](M,D,S):this.operator==="interpolate-hcl"?O.reverse(O.interpolate(O.forward(M),O.forward(D),S)):N.reverse(N.interpolate(N.forward(M),N.forward(D),S))},_e.prototype.eachChild=function(t){t(this.input);for(var o=0,u=this.outputs;o<u.length;o+=1)t(u[o])},_e.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})},_e.prototype.serialize=function(){var t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var o=[this.operator,t,this.input.serialize()],u=0;u<this.labels.length;u++)o.push(this.labels[u],this.outputs[u].serialize());return o};var ft=function(t,o){this.type=t,this.args=o};ft.parse=function(t,o){if(t.length<2)return o.error("Expectected at least one argument.");var u=null,p=o.expectedType;p&&p.kind!=="value"&&(u=p);for(var g=[],x=0,S=t.slice(1);x<S.length;x+=1){var M=o.parse(S[x],1+g.length,u,void 0,{typeAnnotation:"omit"});if(!M)return null;u=u||M.type,g.push(M)}var D=p&&g.some(function(U){return Xi(p,U.type)});return new ft(D?Qr:u,g)},ft.prototype.evaluate=function(t){for(var o,u=null,p=0,g=0,x=this.args;g<x.length&&(p++,(u=x[g].evaluate(t))&&u instanceof Pa&&!u.available&&(o||(o=u.name),u=null,p===this.args.length&&(u=o)),u===null);g+=1);return u},ft.prototype.eachChild=function(t){this.args.forEach(t)},ft.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},ft.prototype.serialize=function(){var t=["coalesce"];return this.eachChild(function(o){t.push(o.serialize())}),t};var mt=function(t,o){this.type=o.type,this.bindings=[].concat(t),this.result=o};mt.prototype.evaluate=function(t){return this.result.evaluate(t)},mt.prototype.eachChild=function(t){for(var o=0,u=this.bindings;o<u.length;o+=1)t(u[o][1]);t(this.result)},mt.parse=function(t,o){if(t.length<4)return o.error("Expected at least 3 arguments, but found "+(t.length-1)+" instead.");for(var u=[],p=1;p<t.length-1;p+=2){var g=t[p];if(typeof g!="string")return o.error("Expected string, but found "+typeof g+" instead.",p);if(/[^a-zA-Z0-9_]/.test(g))return o.error("Variable names must contain only alphanumeric characters or '_'.",p);var x=o.parse(t[p+1],p+1);if(!x)return null;u.push([g,x])}var S=o.parse(t[t.length-1],t.length-1,o.expectedType,u);return S?new mt(u,S):null},mt.prototype.outputDefined=function(){return this.result.outputDefined()},mt.prototype.serialize=function(){for(var t=["let"],o=0,u=this.bindings;o<u.length;o+=1){var p=u[o];t.push(p[0],p[1].serialize())}return t.push(this.result.serialize()),t};var cr=function(t,o,u){this.type=t,this.index=o,this.input=u};cr.parse=function(t,o){if(t.length!==3)return o.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,Tt),p=o.parse(t[2],2,Oi(o.expectedType||Qr));return u&&p?new cr(p.type.itemType,u,p):null},cr.prototype.evaluate=function(t){var o=this.index.evaluate(t),u=this.input.evaluate(t);if(o<0)throw new ja("Array index out of bounds: "+o+" < 0.");if(o>=u.length)throw new ja("Array index out of bounds: "+o+" > "+(u.length-1)+".");if(o!==Math.floor(o))throw new ja("Array index must be an integer, but found "+o+" instead.");return u[o]},cr.prototype.eachChild=function(t){t(this.index),t(this.input)},cr.prototype.outputDefined=function(){return!1},cr.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var xr=function(t,o){this.type=Zr,this.needle=t,this.haystack=o};xr.parse=function(t,o){if(t.length!==3)return o.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,Qr),p=o.parse(t[2],2,Qr);return u&&p?Fa(u.type,[Zr,nn,Tt,un,Qr])?new xr(u,p):o.error("Expected first argument to be of type boolean, string, number or null, but found "+Ci(u.type)+" instead"):null},xr.prototype.evaluate=function(t){var o=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(!u)return!1;if(!oa(o,["boolean","string","number","null"]))throw new ja("Expected first argument to be of type boolean, string, number or null, but found "+Ci(ra(o))+" instead.");if(!oa(u,["string","array"]))throw new ja("Expected second argument to be of type array or string, but found "+Ci(ra(u))+" instead.");return u.indexOf(o)>=0},xr.prototype.eachChild=function(t){t(this.needle),t(this.haystack)},xr.prototype.outputDefined=function(){return!0},xr.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var Pn=function(t,o,u){this.type=Tt,this.needle=t,this.haystack=o,this.fromIndex=u};Pn.parse=function(t,o){if(t.length<=2||t.length>=5)return o.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,Qr),p=o.parse(t[2],2,Qr);if(!u||!p)return null;if(!Fa(u.type,[Zr,nn,Tt,un,Qr]))return o.error("Expected first argument to be of type boolean, string, number or null, but found "+Ci(u.type)+" instead");if(t.length===4){var g=o.parse(t[3],3,Tt);return g?new Pn(u,p,g):null}return new Pn(u,p)},Pn.prototype.evaluate=function(t){var o=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(!oa(o,["boolean","string","number","null"]))throw new ja("Expected first argument to be of type boolean, string, number or null, but found "+Ci(ra(o))+" instead.");if(!oa(u,["string","array"]))throw new ja("Expected second argument to be of type array or string, but found "+Ci(ra(u))+" instead.");if(this.fromIndex){var p=this.fromIndex.evaluate(t);return u.indexOf(o,p)}return u.indexOf(o)},Pn.prototype.eachChild=function(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)},Pn.prototype.outputDefined=function(){return!1},Pn.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var fi=function(t,o,u,p,g,x){this.inputType=t,this.type=o,this.input=u,this.cases=p,this.outputs=g,this.otherwise=x};fi.parse=function(t,o){if(t.length<5)return o.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if(t.length%2!=1)return o.error("Expected an even number of arguments.");var u,p;o.expectedType&&o.expectedType.kind!=="value"&&(p=o.expectedType);for(var g={},x=[],S=2;S<t.length-1;S+=2){var M=t[S],D=t[S+1];Array.isArray(M)||(M=[M]);var U=o.concat(S);if(M.length===0)return U.error("Expected at least one branch label.");for(var j=0,G=M;j<G.length;j+=1){var ae=G[j];if(typeof ae!="number"&&typeof ae!="string")return U.error("Branch labels must be numbers or strings.");if(typeof ae=="number"&&Math.abs(ae)>Number.MAX_SAFE_INTEGER)return U.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof ae=="number"&&Math.floor(ae)!==ae)return U.error("Numeric branch labels must be integer values.");if(u){if(U.checkSubtype(u,ra(ae)))return null}else u=ra(ae);if(g[String(ae)]!==void 0)return U.error("Branch labels must be unique.");g[String(ae)]=x.length}var le=o.parse(D,S,p);if(!le)return null;p=p||le.type,x.push(le)}var Ie=o.parse(t[1],1,Qr);if(!Ie)return null;var ke=o.parse(t[t.length-1],t.length-1,p);return ke?Ie.type.kind!=="value"&&o.concat(1).checkSubtype(u,Ie.type)?null:new fi(u,p,Ie,g,x,ke):null},fi.prototype.evaluate=function(t){var o=this.input.evaluate(t);return(ra(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(t)},fi.prototype.eachChild=function(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)},fi.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})&&this.otherwise.outputDefined()},fi.prototype.serialize=function(){for(var t=this,o=["match",this.input.serialize()],u=[],p={},g=0,x=Object.keys(this.cases).sort();g<x.length;g+=1){var S=x[g];(G=p[this.cases[S]])===void 0?(p[this.cases[S]]=u.length,u.push([this.cases[S],[S]])):u[G][1].push(S)}for(var M=function(le){return t.inputType.kind==="number"?Number(le):le},D=0,U=u;D<U.length;D+=1){var j=U[D],G=j[0],ae=j[1];o.push(ae.length===1?M(ae[0]):ae.map(M)),o.push(this.outputs[outputIndex$1].serialize())}return o.push(this.otherwise.serialize()),o};var Qn=function(t,o,u){this.type=t,this.branches=o,this.otherwise=u};Qn.parse=function(t,o){if(t.length<4)return o.error("Expected at least 3 arguments, but found only "+(t.length-1)+".");if(t.length%2!=0)return o.error("Expected an odd number of arguments.");var u;o.expectedType&&o.expectedType.kind!=="value"&&(u=o.expectedType);for(var p=[],g=1;g<t.length-1;g+=2){var x=o.parse(t[g],g,Zr);if(!x)return null;var S=o.parse(t[g+1],g+1,u);if(!S)return null;p.push([x,S]),u=u||S.type}var M=o.parse(t[t.length-1],t.length-1,u);return M?new Qn(u,p,M):null},Qn.prototype.evaluate=function(t){for(var o=0,u=this.branches;o<u.length;o+=1){var p=u[o],g=p[1];if(p[0].evaluate(t))return g.evaluate(t)}return this.otherwise.evaluate(t)},Qn.prototype.eachChild=function(t){for(var o=0,u=this.branches;o<u.length;o+=1){var p=u[o],g=p[1];t(p[0]),t(g)}t(this.otherwise)},Qn.prototype.outputDefined=function(){return this.branches.every(function(t){return t[1].outputDefined()})&&this.otherwise.outputDefined()},Qn.prototype.serialize=function(){var t=["case"];return this.eachChild(function(o){t.push(o.serialize())}),t};var Yi=function(t,o,u,p){this.type=t,this.input=o,this.beginIndex=u,this.endIndex=p};function da(t,o){return t==="=="||t==="!="?o.kind==="boolean"||o.kind==="string"||o.kind==="number"||o.kind==="null"||o.kind==="value":o.kind==="string"||o.kind==="number"||o.kind==="value"}function Ra(t,o,u,p){return p.compare(o,u)===0}function Hi(t,o,u){var p=t!=="=="&&t!=="!=";return function(){function g(x,S,M){this.type=Zr,this.lhs=x,this.rhs=S,this.collator=M,this.hasUntypedArgument=x.type.kind==="value"||S.type.kind==="value"}return g.parse=function(x,S){if(x.length!==3&&x.length!==4)return S.error("Expected two or three arguments.");var M=x[0],D=S.parse(x[1],1,Qr);if(!D)return null;if(!da(M,D.type))return S.concat(1).error('"'+M+`" comparisons are not supported for type '`+Ci(D.type)+"'.");var U=S.parse(x[2],2,Qr);if(!U)return null;if(!da(M,U.type))return S.concat(2).error('"'+M+`" comparisons are not supported for type '`+Ci(U.type)+"'.");if(D.type.kind!==U.type.kind&&D.type.kind!=="value"&&U.type.kind!=="value")return S.error("Cannot compare types '"+Ci(D.type)+"' and '"+Ci(U.type)+"'.");p&&(D.type.kind==="value"&&U.type.kind!=="value"?D=new $i(U.type,[D]):D.type.kind!=="value"&&U.type.kind==="value"&&(U=new $i(D.type,[U])));var j=null;if(x.length===4){if(D.type.kind!=="string"&&U.type.kind!=="string"&&D.type.kind!=="value"&&U.type.kind!=="value")return S.error("Cannot use collator to compare non-string types.");if(!(j=S.parse(x[3],3,Ti)))return null}return new g(D,U,j)},g.prototype.evaluate=function(x){var S=this.lhs.evaluate(x),M=this.rhs.evaluate(x);if(p&&this.hasUntypedArgument){var D=ra(S),U=ra(M);if(D.kind!==U.kind||D.kind!=="string"&&D.kind!=="number")throw new ja('Expected arguments for "'+t+'" to be (string, string) or (number, number), but found ('+D.kind+", "+U.kind+") instead.")}if(this.collator&&!p&&this.hasUntypedArgument){var j=ra(S),G=ra(M);if(j.kind!=="string"||G.kind!=="string")return o(x,S,M)}return this.collator?u(x,S,M,this.collator.evaluate(x)):o(x,S,M)},g.prototype.eachChild=function(x){x(this.lhs),x(this.rhs),this.collator&&x(this.collator)},g.prototype.outputDefined=function(){return!0},g.prototype.serialize=function(){var x=[t];return this.eachChild(function(S){x.push(S.serialize())}),x},g}()}Yi.parse=function(t,o){if(t.length<=2||t.length>=5)return o.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,Qr),p=o.parse(t[2],2,Tt);if(!u||!p)return null;if(!Fa(u.type,[Oi(Qr),nn,Qr]))return o.error("Expected first argument to be of type array or string, but found "+Ci(u.type)+" instead");if(t.length===4){var g=o.parse(t[3],3,Tt);return g?new Yi(u.type,u,p,g):null}return new Yi(u.type,u,p)},Yi.prototype.evaluate=function(t){var o=this.input.evaluate(t),u=this.beginIndex.evaluate(t);if(!oa(o,["string","array"]))throw new ja("Expected first argument to be of type array or string, but found "+Ci(ra(o))+" instead.");if(this.endIndex){var p=this.endIndex.evaluate(t);return o.slice(u,p)}return o.slice(u)},Yi.prototype.eachChild=function(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)},Yi.prototype.outputDefined=function(){return!1},Yi.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var Lo=Hi("==",function(t,o,u){return o===u},Ra),Ss=Hi("!=",function(t,o,u){return o!==u},function(t,o,u,p){return!Ra(0,o,u,p)}),hl=Hi("<",function(t,o,u){return o<u},function(t,o,u,p){return p.compare(o,u)<0}),Gc=Hi(">",function(t,o,u){return o>u},function(t,o,u,p){return p.compare(o,u)>0}),Xu=Hi("<=",function(t,o,u){return o<=u},function(t,o,u,p){return p.compare(o,u)<=0}),Sc=Hi(">=",function(t,o,u){return o>=u},function(t,o,u,p){return p.compare(o,u)>=0}),Mu=function(t,o,u,p,g){this.type=nn,this.number=t,this.locale=o,this.currency=u,this.minFractionDigits=p,this.maxFractionDigits=g};Mu.parse=function(t,o){if(t.length!==3)return o.error("Expected two arguments.");var u=o.parse(t[1],1,Tt);if(!u)return null;var p=t[2];if(typeof p!="object"||Array.isArray(p))return o.error("NumberFormat options argument must be an object.");var g=null;if(p.locale&&!(g=o.parse(p.locale,1,nn)))return null;var x=null;if(p.currency&&!(x=o.parse(p.currency,1,nn)))return null;var S=null;if(p["min-fraction-digits"]&&!(S=o.parse(p["min-fraction-digits"],1,Tt)))return null;var M=null;return p["max-fraction-digits"]&&!(M=o.parse(p["max-fraction-digits"],1,Tt))?null:new Mu(u,g,x,S,M)},Mu.prototype.evaluate=function(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))},Mu.prototype.eachChild=function(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)},Mu.prototype.outputDefined=function(){return!1},Mu.prototype.serialize=function(){var t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]};var vu=function(t){this.type=Tt,this.input=t};vu.parse=function(t,o){if(t.length!==2)return o.error("Expected 1 argument, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?o.error("Expected argument of type string or array, but found "+Ci(u.type)+" instead."):new vu(u):null},vu.prototype.evaluate=function(t){var o=this.input.evaluate(t);if(typeof o=="string"||Array.isArray(o))return o.length;throw new ja("Expected value to be of type string or array, but found "+Ci(ra(o))+" instead.")},vu.prototype.eachChild=function(t){t(this.input)},vu.prototype.outputDefined=function(){return!1},vu.prototype.serialize=function(){var t=["length"];return this.eachChild(function(o){t.push(o.serialize())}),t};var Ao={"==":Lo,"!=":Ss,">":Gc,"<":hl,">=":Sc,"<=":Xu,array:$i,at:cr,boolean:$i,case:Qn,coalesce:ft,collator:Jo,format:qo,image:Ko,in:xr,"index-of":Pn,interpolate:_e,"interpolate-hcl":_e,"interpolate-lab":_e,length:vu,let:mt,literal:yo,match:fi,number:$i,"number-format":Mu,object:$i,slice:Yi,step:ds,string:$i,"to-boolean":Co,"to-color":Co,"to-number":Co,"to-string":Co,var:xe,within:pn};function va(t,o){var u=o[0],p=o[1],g=o[2],x=o[3];u=u.evaluate(t),p=p.evaluate(t),g=g.evaluate(t);var S=x?x.evaluate(t):1,M=Es(u,p,g,S);if(M)throw new ja(M);return new Gi(u/255*S,p/255*S,g/255*S,S)}function uh(t,o){return t in o}function lh(t,o){var u=o[t];return u===void 0?null:u}function ho(t){return{type:t}}function Pf(t){return{result:"success",value:t}}function mu(t){return{result:"error",value:t}}function Fs(t){return t["property-type"]==="data-driven"||t["property-type"]==="cross-faded-data-driven"}function Cc(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function pl(t){return!!t.expression&&t.expression.interpolated}function Ca(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}function Ml(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function Xl(t){return t}function ns(t,o,u){return t!==void 0?t:o!==void 0?o:u!==void 0?u:void 0}function If(t,o,u,p,g){return ns(typeof u===g?p[u]:void 0,t.default,o.default)}function ch(t,o,u){if(Ca(u)!=="number")return ns(t.default,o.default);var p=t.stops.length;if(p===1||u<=t.stops[0][0])return t.stops[0][1];if(u>=t.stops[p-1][0])return t.stops[p-1][1];var g=su(t.stops.map(function(x){return x[0]}),u);return t.stops[g][1]}function fh(t,o,u){var p=t.base!==void 0?t.base:1;if(Ca(u)!=="number")return ns(t.default,o.default);var g=t.stops.length;if(g===1||u<=t.stops[0][0])return t.stops[0][1];if(u>=t.stops[g-1][0])return t.stops[g-1][1];var x=su(t.stops.map(function(G){return G[0]}),u),S=function(G,ae,le,Ie){var ke=Ie-le,Ke=G-le;return ke===0?0:ae===1?Ke/ke:(Math.pow(ae,Ke)-1)/(Math.pow(ae,ke)-1)}(u,p,t.stops[x][0],t.stops[x+1][0]),M=t.stops[x][1],D=t.stops[x+1][1],U=xo[o.type]||Xl;if(t.colorSpace&&t.colorSpace!=="rgb"){var j=K[t.colorSpace];U=function(G,ae){return j.reverse(j.interpolate(j.forward(G),j.forward(ae),S))}}return typeof M.evaluate=="function"?{evaluate:function(){for(var G=[],ae=arguments.length;ae--;)G[ae]=arguments[ae];var le=M.evaluate.apply(void 0,G),Ie=D.evaluate.apply(void 0,G);if(le!==void 0&&Ie!==void 0)return U(le,Ie,S)}}:U(M,D,S)}function Hc(t,o,u){return o.type==="color"?u=Gi.parse(u):o.type==="formatted"?u=Ma.fromString(u.toString()):o.type==="resolvedImage"?u=Pa.fromString(u.toString()):Ca(u)===o.type||o.type==="enum"&&o.values[u]||(u=void 0),ns(u,t.default,o.default)}_o.register(Ao,{error:[{kind:"error"},[nn],function(t,o){throw new ja(o[0].evaluate(t))}],typeof:[nn,[Qr],function(t,o){return Ci(ra(o[0].evaluate(t)))}],"to-rgba":[Oi(Tt,4),[Yr],function(t,o){return o[0].evaluate(t).toArray()}],rgb:[Yr,[Tt,Tt,Tt],va],rgba:[Yr,[Tt,Tt,Tt,Tt],va],has:{type:Zr,overloads:[[[nn],function(t,o){return uh(o[0].evaluate(t),t.properties())}],[[nn,oi],function(t,o){var u=o[1];return uh(o[0].evaluate(t),u.evaluate(t))}]]},get:{type:Qr,overloads:[[[nn],function(t,o){return lh(o[0].evaluate(t),t.properties())}],[[nn,oi],function(t,o){var u=o[1];return lh(o[0].evaluate(t),u.evaluate(t))}]]},"feature-state":[Qr,[nn],function(t,o){return lh(o[0].evaluate(t),t.featureState||{})}],properties:[oi,[],function(t){return t.properties()}],"geometry-type":[nn,[],function(t){return t.geometryType()}],id:[Qr,[],function(t){return t.id()}],zoom:[Tt,[],function(t){return t.globals.zoom}],"heatmap-density":[Tt,[],function(t){return t.globals.heatmapDensity||0}],"line-progress":[Tt,[],function(t){return t.globals.lineProgress||0}],accumulated:[Qr,[],function(t){return t.globals.accumulated===void 0?null:t.globals.accumulated}],"+":[Tt,ho(Tt),function(t,o){for(var u=0,p=0,g=o;p<g.length;p+=1)u+=g[p].evaluate(t);return u}],"*":[Tt,ho(Tt),function(t,o){for(var u=1,p=0,g=o;p<g.length;p+=1)u*=g[p].evaluate(t);return u}],"-":{type:Tt,overloads:[[[Tt,Tt],function(t,o){var u=o[1];return o[0].evaluate(t)-u.evaluate(t)}],[[Tt],function(t,o){return-o[0].evaluate(t)}]]},"/":[Tt,[Tt,Tt],function(t,o){var u=o[1];return o[0].evaluate(t)/u.evaluate(t)}],"%":[Tt,[Tt,Tt],function(t,o){var u=o[1];return o[0].evaluate(t)%u.evaluate(t)}],ln2:[Tt,[],function(){return Math.LN2}],pi:[Tt,[],function(){return Math.PI}],e:[Tt,[],function(){return Math.E}],"^":[Tt,[Tt,Tt],function(t,o){var u=o[1];return Math.pow(o[0].evaluate(t),u.evaluate(t))}],sqrt:[Tt,[Tt],function(t,o){return Math.sqrt(o[0].evaluate(t))}],log10:[Tt,[Tt],function(t,o){return Math.log(o[0].evaluate(t))/Math.LN10}],ln:[Tt,[Tt],function(t,o){return Math.log(o[0].evaluate(t))}],log2:[Tt,[Tt],function(t,o){return Math.log(o[0].evaluate(t))/Math.LN2}],sin:[Tt,[Tt],function(t,o){return Math.sin(o[0].evaluate(t))}],cos:[Tt,[Tt],function(t,o){return Math.cos(o[0].evaluate(t))}],tan:[Tt,[Tt],function(t,o){return Math.tan(o[0].evaluate(t))}],asin:[Tt,[Tt],function(t,o){return Math.asin(o[0].evaluate(t))}],acos:[Tt,[Tt],function(t,o){return Math.acos(o[0].evaluate(t))}],atan:[Tt,[Tt],function(t,o){return Math.atan(o[0].evaluate(t))}],min:[Tt,ho(Tt),function(t,o){return Math.min.apply(Math,o.map(function(u){return u.evaluate(t)}))}],max:[Tt,ho(Tt),function(t,o){return Math.max.apply(Math,o.map(function(u){return u.evaluate(t)}))}],abs:[Tt,[Tt],function(t,o){return Math.abs(o[0].evaluate(t))}],round:[Tt,[Tt],function(t,o){var u=o[0].evaluate(t);return u<0?-Math.round(-u):Math.round(u)}],floor:[Tt,[Tt],function(t,o){return Math.floor(o[0].evaluate(t))}],ceil:[Tt,[Tt],function(t,o){return Math.ceil(o[0].evaluate(t))}],"filter-==":[Zr,[nn,Qr],function(t,o){var u=o[0],p=o[1];return t.properties()[u.value]===p.value}],"filter-id-==":[Zr,[Qr],function(t,o){var u=o[0];return t.id()===u.value}],"filter-type-==":[Zr,[nn],function(t,o){var u=o[0];return t.geometryType()===u.value}],"filter-<":[Zr,[nn,Qr],function(t,o){var u=o[0],p=o[1],g=t.properties()[u.value],x=p.value;return typeof g==typeof x&&g<x}],"filter-id-<":[Zr,[Qr],function(t,o){var u=o[0],p=t.id(),g=u.value;return typeof p==typeof g&&p<g}],"filter->":[Zr,[nn,Qr],function(t,o){var u=o[0],p=o[1],g=t.properties()[u.value],x=p.value;return typeof g==typeof x&&g>x}],"filter-id->":[Zr,[Qr],function(t,o){var u=o[0],p=t.id(),g=u.value;return typeof p==typeof g&&p>g}],"filter-<=":[Zr,[nn,Qr],function(t,o){var u=o[0],p=o[1],g=t.properties()[u.value],x=p.value;return typeof g==typeof x&&g<=x}],"filter-id-<=":[Zr,[Qr],function(t,o){var u=o[0],p=t.id(),g=u.value;return typeof p==typeof g&&p<=g}],"filter->=":[Zr,[nn,Qr],function(t,o){var u=o[0],p=o[1],g=t.properties()[u.value],x=p.value;return typeof g==typeof x&&g>=x}],"filter-id->=":[Zr,[Qr],function(t,o){var u=o[0],p=t.id(),g=u.value;return typeof p==typeof g&&p>=g}],"filter-has":[Zr,[Qr],function(t,o){return o[0].value in t.properties()}],"filter-has-id":[Zr,[],function(t){return t.id()!==null&&t.id()!==void 0}],"filter-type-in":[Zr,[Oi(nn)],function(t,o){return o[0].value.indexOf(t.geometryType())>=0}],"filter-id-in":[Zr,[Oi(Qr)],function(t,o){return o[0].value.indexOf(t.id())>=0}],"filter-in-small":[Zr,[nn,Oi(Qr)],function(t,o){var u=o[0];return o[1].value.indexOf(t.properties()[u.value])>=0}],"filter-in-large":[Zr,[nn,Oi(Qr)],function(t,o){var u=o[0],p=o[1];return function(g,x,S,M){for(;S<=M;){var D=S+M>>1;if(x[D]===g)return!0;x[D]>g?M=D-1:S=D+1}return!1}(t.properties()[u.value],p.value,0,p.value.length-1)}],all:{type:Zr,overloads:[[[Zr,Zr],function(t,o){var u=o[1];return o[0].evaluate(t)&&u.evaluate(t)}],[ho(Zr),function(t,o){for(var u=0,p=o;u<p.length;u+=1)if(!p[u].evaluate(t))return!1;return!0}]]},any:{type:Zr,overloads:[[[Zr,Zr],function(t,o){var u=o[1];return o[0].evaluate(t)||u.evaluate(t)}],[ho(Zr),function(t,o){for(var u=0,p=o;u<p.length;u+=1)if(p[u].evaluate(t))return!0;return!1}]]},"!":[Zr,[Zr],function(t,o){return!o[0].evaluate(t)}],"is-supported-script":[Zr,[nn],function(t,o){var u=t.globals&&t.globals.isSupportedScript;return!u||u(o[0].evaluate(t))}],upcase:[nn,[nn],function(t,o){return o[0].evaluate(t).toUpperCase()}],downcase:[nn,[nn],function(t,o){return o[0].evaluate(t).toLowerCase()}],concat:[nn,ho(Qr),function(t,o){return o.map(function(u){return ju(u.evaluate(t))}).join("")}],"resolved-locale":[nn,[Ti],function(t,o){return o[0].evaluate(t).resolvedLocale()}]});var dl=function(t,o){this.expression=t,this._warningHistory={},this._evaluator=new xa,this._defaultValue=o?function(u){return u.type==="color"&&Ml(u.default)?new Gi(0,0,0,0):u.type==="color"?Gi.parse(u.default)||null:u.default===void 0?null:u.default}(o):null,this._enumValues=o&&o.type==="enum"?o.values:null};function jo(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in Ao}function Pu(t,o){var u=new Ks(Ao,[],o?function(g){var x={color:Yr,string:nn,number:Tt,enum:nn,boolean:Zr,formatted:ea,resolvedImage:bi};return g.type==="array"?Oi(x[g.value]||Qr,g.length):x[g.type]}(o):void 0),p=u.parse(t,void 0,void 0,void 0,o&&o.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?Pf(new dl(p,o)):mu(u.errors)}dl.prototype.evaluateWithoutErrorHandling=function(t,o,u,p,g,x){return this._evaluator.globals=t,this._evaluator.feature=o,this._evaluator.featureState=u,this._evaluator.canonical=p,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=x,this.expression.evaluate(this._evaluator)},dl.prototype.evaluate=function(t,o,u,p,g,x){this._evaluator.globals=t,this._evaluator.feature=o||null,this._evaluator.featureState=u||null,this._evaluator.canonical=p,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=x||null;try{var S=this.expression.evaluate(this._evaluator);if(S==null||typeof S=="number"&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new ja("Expected value to be one of "+Object.keys(this._enumValues).map(function(M){return JSON.stringify(M)}).join(", ")+", but found "+JSON.stringify(S)+" instead.");return S}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console!="undefined"&&console.warn(M.message)),this._defaultValue}};var Yu=function(t,o){this.kind=t,this._styleExpression=o,this.isStateDependent=t!=="constant"&&!Yt(o.expression)};Yu.prototype.evaluateWithoutErrorHandling=function(t,o,u,p,g,x){return this._styleExpression.evaluateWithoutErrorHandling(t,o,u,p,g,x)},Yu.prototype.evaluate=function(t,o,u,p,g,x){return this._styleExpression.evaluate(t,o,u,p,g,x)};var Vo=function(t,o,u,p){this.kind=t,this.zoomStops=u,this._styleExpression=o,this.isStateDependent=t!=="camera"&&!Yt(o.expression),this.interpolationType=p};function Pl(t,o){if((t=Pu(t,o)).result==="error")return t;var u=t.value.expression,p=cn(u);if(!p&&!Fs(o))return mu([new gr("","data expressions not supported")]);var g=Zo(u,["zoom"]);if(!g&&!Cc(o))return mu([new gr("","zoom expressions not supported")]);var x=function S(M){var D=null;if(M instanceof mt)D=S(M.result);else if(M instanceof ft)for(var U=0,j=M.args;U<j.length&&!(D=S(j[U]));U+=1);else(M instanceof ds||M instanceof _e)&&M.input instanceof _o&&M.input.name==="zoom"&&(D=M);return D instanceof gr||M.eachChild(function(G){var ae=S(G);ae instanceof gr?D=ae:!D&&ae?D=new gr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):D&&ae&&D!==ae&&(D=new gr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),D}(u);return x||g?x instanceof gr?mu([x]):x instanceof _e&&!pl(o)?mu([new gr("",'"interpolate" expressions cannot be used with this property')]):Pf(x?new Vo(p?"camera":"composite",t.value,x.labels,x instanceof _e?x.interpolation:void 0):new Yu(p?"constant":"source",t.value)):mu([new gr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}Vo.prototype.evaluateWithoutErrorHandling=function(t,o,u,p,g,x){return this._styleExpression.evaluateWithoutErrorHandling(t,o,u,p,g,x)},Vo.prototype.evaluate=function(t,o,u,p,g,x){return this._styleExpression.evaluate(t,o,u,p,g,x)},Vo.prototype.interpolationFactor=function(t,o,u){return this.interpolationType?_e.interpolationFactor(this.interpolationType,t,o,u):0};var qu=function(t,o){this._parameters=t,this._specification=o,dr(this,function u(p,g){var x,S,M,D=g.type==="color",U=p.stops&&typeof p.stops[0][0]=="object",j=U||!(U||p.property!==void 0),G=p.type||(pl(g)?"exponential":"interval");if(D&&((p=dr({},p)).stops&&(p.stops=p.stops.map(function(ln){return[ln[0],Gi.parse(ln[1])]})),p.default=Gi.parse(p.default?p.default:g.default)),p.colorSpace&&p.colorSpace!=="rgb"&&!K[p.colorSpace])throw new Error("Unknown color space: "+p.colorSpace);if(G==="exponential")x=fh;else if(G==="interval")x=ch;else if(G==="categorical"){x=If,S=Object.create(null);for(var ae=0,le=p.stops;ae<le.length;ae+=1){var Ie=le[ae];S[Ie[0]]=Ie[1]}M=typeof p.stops[0][0]}else{if(G!=="identity")throw new Error('Unknown function type "'+G+'"');x=Hc}if(U){for(var ke={},Ke=[],Ue=0;Ue<p.stops.length;Ue++){var st=p.stops[Ue],St=st[0].zoom;ke[St]===void 0&&(ke[St]={zoom:St,type:p.type,property:p.property,default:p.default,stops:[]},Ke.push(St)),ke[St].stops.push([st[0].value,st[1]])}for(var Gt=[],Zt=0,or=Ke;Zt<or.length;Zt+=1){var Ir=or[Zt];Gt.push([ke[Ir].zoom,u(ke[Ir],g)])}var Xr={name:"linear"};return{kind:"composite",interpolationType:Xr,interpolationFactor:_e.interpolationFactor.bind(void 0,Xr),zoomStops:Gt.map(function(ln){return ln[0]}),evaluate:function(ln,Un){var gn=ln.zoom;return fh({stops:Gt,base:p.base},g,gn).evaluate(gn,Un)}}}if(j){var Dn=G==="exponential"?{name:"exponential",base:p.base!==void 0?p.base:1}:null;return{kind:"camera",interpolationType:Dn,interpolationFactor:_e.interpolationFactor.bind(void 0,Dn),zoomStops:p.stops.map(function(ln){return ln[0]}),evaluate:function(ln){return x(p,g,ln.zoom,S,M)}}}return{kind:"source",evaluate:function(ln,Un){var gn=Un&&Un.properties?Un.properties[p.property]:void 0;return gn===void 0?ns(p.default,g.default):x(p,g,gn,S,M)}}}(this._parameters,this._specification))};function $s(t){var o=t.key,u=t.value,p=t.valueSpec||{},g=t.objectElementValidators||{},x=t.style,S=t.styleSpec,M=[],D=Ca(u);if(D!=="object")return[new Fe(o,u,"object expected, "+D+" found")];for(var U in u){var j=U.split(".")[0],G=p[j]||p["*"],ae=void 0;if(g[j])ae=g[j];else if(p[j])ae=Fi;else if(g["*"])ae=g["*"];else{if(!p["*"]){M.push(new Fe(o,u[U],'unknown property "'+U+'"'));continue}ae=Fi}M=M.concat(ae({key:(o&&o+".")+U,value:u[U],valueSpec:G,style:x,styleSpec:S,object:u,objectKey:U},u))}for(var le in p)g[le]||p[le].required&&p[le].default===void 0&&u[le]===void 0&&M.push(new Fe(o,u,'missing required property "'+le+'"'));return M}function Wc(t){var o=t.value,u=t.valueSpec,p=t.style,g=t.styleSpec,x=t.key,S=t.arrayElementValidator||Fi;if(Ca(o)!=="array")return[new Fe(x,o,"array expected, "+Ca(o)+" found")];if(u.length&&o.length!==u.length)return[new Fe(x,o,"array length "+u.length+" expected, length "+o.length+" found")];if(u["min-length"]&&o.length<u["min-length"])return[new Fe(x,o,"array length at least "+u["min-length"]+" expected, length "+o.length+" found")];var M={type:u.value,values:u.values};g.$version<7&&(M.function=u.function),Ca(u.value)==="object"&&(M=u.value);for(var D=[],U=0;U<o.length;U++)D=D.concat(S({array:o,arrayIndex:U,value:o[U],valueSpec:M,style:p,styleSpec:g,key:x+"["+U+"]"}));return D}function Xc(t){var o=t.key,u=t.value,p=t.valueSpec,g=Ca(u);return g==="number"&&u!=u&&(g="NaN"),g!=="number"?[new Fe(o,u,"number expected, "+g+" found")]:"minimum"in p&&u<p.minimum?[new Fe(o,u,u+" is less than the minimum value "+p.minimum)]:"maximum"in p&&u>p.maximum?[new Fe(o,u,u+" is greater than the maximum value "+p.maximum)]:[]}function Yc(t){var o,u,p,g=t.valueSpec,x=Dt(t.value.type),S={},M=x!=="categorical"&&t.value.property===void 0,D=!M,U=Ca(t.value.stops)==="array"&&Ca(t.value.stops[0])==="array"&&Ca(t.value.stops[0][0])==="object",j=$s({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(le){if(x==="identity")return[new Fe(le.key,le.value,'identity function may not have a "stops" property')];var Ie=[],ke=le.value;return Ie=Ie.concat(Wc({key:le.key,value:ke,valueSpec:le.valueSpec,style:le.style,styleSpec:le.styleSpec,arrayElementValidator:G})),Ca(ke)==="array"&&ke.length===0&&Ie.push(new Fe(le.key,ke,"array must have at least one stop")),Ie},default:function(le){return Fi({key:le.key,value:le.value,valueSpec:g,style:le.style,styleSpec:le.styleSpec})}}});return x==="identity"&&M&&j.push(new Fe(t.key,t.value,'missing required property "property"')),x==="identity"||t.value.stops||j.push(new Fe(t.key,t.value,'missing required property "stops"')),x==="exponential"&&t.valueSpec.expression&&!pl(t.valueSpec)&&j.push(new Fe(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(D&&!Fs(t.valueSpec)?j.push(new Fe(t.key,t.value,"property functions not supported")):M&&!Cc(t.valueSpec)&&j.push(new Fe(t.key,t.value,"zoom functions not supported"))),x!=="categorical"&&!U||t.value.property!==void 0||j.push(new Fe(t.key,t.value,'"property" property is required')),j;function G(le){var Ie=[],ke=le.value,Ke=le.key;if(Ca(ke)!=="array")return[new Fe(Ke,ke,"array expected, "+Ca(ke)+" found")];if(ke.length!==2)return[new Fe(Ke,ke,"array length 2 expected, length "+ke.length+" found")];if(U){if(Ca(ke[0])!=="object")return[new Fe(Ke,ke,"object expected, "+Ca(ke[0])+" found")];if(ke[0].zoom===void 0)return[new Fe(Ke,ke,"object stop key must have zoom")];if(ke[0].value===void 0)return[new Fe(Ke,ke,"object stop key must have value")];if(p&&p>Dt(ke[0].zoom))return[new Fe(Ke,ke[0].zoom,"stop zoom values must appear in ascending order")];Dt(ke[0].zoom)!==p&&(p=Dt(ke[0].zoom),u=void 0,S={}),Ie=Ie.concat($s({key:Ke+"[0]",value:ke[0],valueSpec:{zoom:{}},style:le.style,styleSpec:le.styleSpec,objectElementValidators:{zoom:Xc,value:ae}}))}else Ie=Ie.concat(ae({key:Ke+"[0]",value:ke[0],valueSpec:{},style:le.style,styleSpec:le.styleSpec},ke));return jo(zt(ke[1]))?Ie.concat([new Fe(Ke+"[1]",ke[1],"expressions are not allowed in function stops.")]):Ie.concat(Fi({key:Ke+"[1]",value:ke[1],valueSpec:g,style:le.style,styleSpec:le.styleSpec}))}function ae(le,Ie){var ke=Ca(le.value),Ke=Dt(le.value),Ue=le.value!==null?le.value:Ie;if(o){if(ke!==o)return[new Fe(le.key,Ue,ke+" stop domain type must match previous stop domain type "+o)]}else o=ke;if(ke!=="number"&&ke!=="string"&&ke!=="boolean")return[new Fe(le.key,Ue,"stop domain value must be a number, string, or boolean")];if(ke!=="number"&&x!=="categorical"){var st="number expected, "+ke+" found";return Fs(g)&&x===void 0&&(st+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Fe(le.key,Ue,st)]}return x!=="categorical"||ke!=="number"||isFinite(Ke)&&Math.floor(Ke)===Ke?x!=="categorical"&&ke==="number"&&u!==void 0&&Ke<u?[new Fe(le.key,Ue,"stop domain values must appear in ascending order")]:(u=Ke,x==="categorical"&&Ke in S?[new Fe(le.key,Ue,"stop domain values must be unique")]:(S[Ke]=!0,[])):[new Fe(le.key,Ue,"integer expected, found "+Ke)]}}function Ku(t){var o=(t.expressionContext==="property"?Pl:Pu)(zt(t.value),t.valueSpec);if(o.result==="error")return o.value.map(function(p){return new Fe(""+t.key+p.key,t.value,p.message)});var u=o.value.expression||o.value._styleExpression.expression;if(t.expressionContext==="property"&&t.propertyKey==="text-font"&&!u.outputDefined())return[new Fe(t.key,t.value,'Invalid data expression for "'+t.propertyKey+'". Output values must be contained as literals within the expression.')];if(t.expressionContext==="property"&&t.propertyType==="layout"&&!Yt(u))return[new Fe(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if(t.expressionContext==="filter"&&!Yt(u))return[new Fe(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&t.expressionContext.indexOf("cluster")===0){if(!Zo(u,["zoom","feature-state"]))return[new Fe(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(t.expressionContext==="cluster-initial"&&!cn(u))return[new Fe(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Yl(t){var o=t.key,u=t.value,p=t.valueSpec,g=[];return Array.isArray(p.values)?p.values.indexOf(Dt(u))===-1&&g.push(new Fe(o,u,"expected one of ["+p.values.join(", ")+"], "+JSON.stringify(u)+" found")):Object.keys(p.values).indexOf(Dt(u))===-1&&g.push(new Fe(o,u,"expected one of ["+Object.keys(p.values).join(", ")+"], "+JSON.stringify(u)+" found")),g}function Ac(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(var o=0,u=t.slice(1);o<u.length;o+=1){var p=u[o];if(!Ac(p)&&typeof p!="boolean")return!1}return!0;default:return!0}}qu.deserialize=function(t){return new qu(t._parameters,t._specification)},qu.serialize=function(t){return{_parameters:t._parameters,_specification:t._specification}};var qc={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function wc(t){if(t==null)return{filter:function(){return!0},needGeometry:!1};Ac(t)||(t=Tc(t));var o=Pu(t,qc);if(o.result==="error")throw new Error(o.value.map(function(u){return u.key+": "+u.message}).join(", "));return{filter:function(u,p,g){return o.value.evaluate(u,p,{},g)},needGeometry:function u(p){if(!Array.isArray(p))return!1;if(p[0]==="within")return!0;for(var g=1;g<p.length;g++)if(u(p[g]))return!0;return!1}(t)}}function hh(t,o){return t<o?-1:t>o?1:0}function Tc(t){if(!t)return!0;var o,u=t[0];return t.length<=1?u!=="any":u==="=="?vl(t[1],t[2],"=="):u==="!="?Iu(vl(t[1],t[2],"==")):u==="<"||u===">"||u==="<="||u===">="?vl(t[1],t[2],u):u==="any"?(o=t.slice(1),["any"].concat(o.map(Tc))):u==="all"?["all"].concat(t.slice(1).map(Tc)):u==="none"?["all"].concat(t.slice(1).map(Tc).map(Iu)):u==="in"?Kc(t[1],t.slice(2)):u==="!in"?Iu(Kc(t[1],t.slice(2))):u==="has"?$c(t[1]):u==="!has"?Iu($c(t[1])):u!=="within"||t}function vl(t,o,u){switch(t){case"$type":return["filter-type-"+u,o];case"$id":return["filter-id-"+u,o];default:return["filter-"+u,t,o]}}function Kc(t,o){if(o.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(function(u){return typeof u!=typeof o[0]})?["filter-in-large",t,["literal",o.sort(hh)]]:["filter-in-small",t,["literal",o]]}}function $c(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Iu(t){return["!",t]}function Jc(t){return Ac(zt(t.value))?Ku(dr({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function o(u){var p=u.value,g=u.key;if(Ca(p)!=="array")return[new Fe(g,p,"array expected, "+Ca(p)+" found")];var x,S=u.styleSpec,M=[];if(p.length<1)return[new Fe(g,p,"filter array must have at least 1 element")];switch(M=M.concat(Yl({key:g+"[0]",value:p[0],valueSpec:S.filter_operator,style:u.style,styleSpec:u.styleSpec})),Dt(p[0])){case"<":case"<=":case">":case">=":p.length>=2&&Dt(p[1])==="$type"&&M.push(new Fe(g,p,'"$type" cannot be use with operator "'+p[0]+'"'));case"==":case"!=":p.length!==3&&M.push(new Fe(g,p,'filter array for operator "'+p[0]+'" must have 3 elements'));case"in":case"!in":p.length>=2&&(x=Ca(p[1]))!=="string"&&M.push(new Fe(g+"[1]",p[1],"string expected, "+x+" found"));for(var D=2;D<p.length;D++)x=Ca(p[D]),Dt(p[1])==="$type"?M=M.concat(Yl({key:g+"["+D+"]",value:p[D],valueSpec:S.geometry_type,style:u.style,styleSpec:u.styleSpec})):x!=="string"&&x!=="number"&&x!=="boolean"&&M.push(new Fe(g+"["+D+"]",p[D],"string, number, or boolean expected, "+x+" found"));break;case"any":case"all":case"none":for(var U=1;U<p.length;U++)M=M.concat(o({key:g+"["+U+"]",value:p[U],style:u.style,styleSpec:u.styleSpec}));break;case"has":case"!has":x=Ca(p[1]),p.length!==2?M.push(new Fe(g,p,'filter array for "'+p[0]+'" operator must have 2 elements')):x!=="string"&&M.push(new Fe(g+"[1]",p[1],"string expected, "+x+" found"));break;case"within":x=Ca(p[1]),p.length!==2?M.push(new Fe(g,p,'filter array for "'+p[0]+'" operator must have 2 elements')):x!=="object"&&M.push(new Fe(g+"[1]",p[1],"object expected, "+x+" found"))}return M}(t)}function Of(t,o){var u=t.key,p=t.style,g=t.styleSpec,x=t.value,S=t.objectKey,M=g[o+"_"+t.layerType];if(!M)return[];var D=S.match(/^(.*)-transition$/);if(o==="paint"&&D&&M[D[1]]&&M[D[1]].transition)return Fi({key:u,value:x,valueSpec:g.transition,style:p,styleSpec:g});var U,j=t.valueSpec||M[S];if(!j)return[new Fe(u,x,'unknown property "'+S+'"')];if(Ca(x)==="string"&&Fs(j)&&!j.tokens&&(U=/^{([^}]+)}$/.exec(x)))return[new Fe(u,x,'"'+S+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(U[1])+" }`.")];var G=[];return t.layerType==="symbol"&&(S==="text-field"&&p&&!p.glyphs&&G.push(new Fe(u,x,'use of "text-field" requires a style "glyphs" property')),S==="text-font"&&Ml(zt(x))&&Dt(x.type)==="identity"&&G.push(new Fe(u,x,'"text-font" does not support identity functions'))),G.concat(Fi({key:t.key,value:x,valueSpec:j,style:p,styleSpec:g,expressionContext:"property",propertyType:o,propertyKey:S}))}function ph(t){return Of(t,"paint")}function Il(t){return Of(t,"layout")}function Wh(t){var o=[],u=t.value,p=t.key,g=t.style,x=t.styleSpec;u.type||u.ref||o.push(new Fe(p,u,'either "type" or "ref" is required'));var S,M=Dt(u.type),D=Dt(u.ref);if(u.id)for(var U=Dt(u.id),j=0;j<t.arrayIndex;j++){var G=g.layers[j];Dt(G.id)===U&&o.push(new Fe(p,u.id,'duplicate layer id "'+u.id+'", previously used at line '+G.id.__line__))}if("ref"in u)["type","source","source-layer","filter","layout"].forEach(function(Ie){Ie in u&&o.push(new Fe(p,u[Ie],'"'+Ie+'" is prohibited for ref layers'))}),g.layers.forEach(function(Ie){Dt(Ie.id)===D&&(S=Ie)}),S?S.ref?o.push(new Fe(p,u.ref,"ref cannot reference another ref layer")):M=Dt(S.type):o.push(new Fe(p,u.ref,'ref layer "'+D+'" not found'));else if(M!=="background")if(u.source){var ae=g.sources&&g.sources[u.source],le=ae&&Dt(ae.type);ae?le==="vector"&&M==="raster"?o.push(new Fe(p,u.source,'layer "'+u.id+'" requires a raster source')):le==="raster"&&M!=="raster"?o.push(new Fe(p,u.source,'layer "'+u.id+'" requires a vector source')):le!=="vector"||u["source-layer"]?le==="raster-dem"&&M!=="hillshade"?o.push(new Fe(p,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):M!=="line"||!u.paint||!u.paint["line-gradient"]||le==="geojson"&&ae.lineMetrics||o.push(new Fe(p,u,'layer "'+u.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):o.push(new Fe(p,u,'layer "'+u.id+'" must specify a "source-layer"')):o.push(new Fe(p,u.source,'source "'+u.source+'" not found'))}else o.push(new Fe(p,u,'missing required property "source"'));return o=o.concat($s({key:p,value:u,valueSpec:x.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Fi({key:p+".type",value:u.type,valueSpec:x.layer.type,style:t.style,styleSpec:t.styleSpec,object:u,objectKey:"type"})},filter:Jc,layout:function(Ie){return $s({layer:u,key:Ie.key,value:Ie.value,style:Ie.style,styleSpec:Ie.styleSpec,objectElementValidators:{"*":function(ke){return Il(dr({layerType:M},ke))}}})},paint:function(Ie){return $s({layer:u,key:Ie.key,value:Ie.value,style:Ie.style,styleSpec:Ie.styleSpec,objectElementValidators:{"*":function(ke){return ph(dr({layerType:M},ke))}}})}}}))}function is(t){var o=t.value,u=t.key,p=Ca(o);return p!=="string"?[new Fe(u,o,"string expected, "+p+" found")]:[]}var qa={promoteId:function(t){var o=t.key,u=t.value;if(Ca(u)==="string")return is({key:o,value:u});var p=[];for(var g in u)p.push.apply(p,is({key:o+"."+g,value:u[g]}));return p}};function ql(t){var o=t.value,u=t.key,p=t.styleSpec,g=t.style;if(!o.type)return[new Fe(u,o,'"type" is required')];var x,S=Dt(o.type);switch(S){case"vector":case"raster":case"raster-dem":return $s({key:u,value:o,valueSpec:p["source_"+S.replace("-","_")],style:t.style,styleSpec:p,objectElementValidators:qa});case"geojson":if(x=$s({key:u,value:o,valueSpec:p.source_geojson,style:g,styleSpec:p,objectElementValidators:qa}),o.cluster)for(var M in o.clusterProperties){var D=o.clusterProperties[M],U=D[0],j=typeof U=="string"?[U,["accumulated"],["get",M]]:U;x.push.apply(x,Ku({key:u+"."+M+".map",value:D[1],expressionContext:"cluster-map"})),x.push.apply(x,Ku({key:u+"."+M+".reduce",value:j,expressionContext:"cluster-reduce"}))}return x;case"video":return $s({key:u,value:o,valueSpec:p.source_video,style:g,styleSpec:p});case"image":return $s({key:u,value:o,valueSpec:p.source_image,style:g,styleSpec:p});case"canvas":return[new Fe(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Yl({key:u+".type",value:o.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:g,styleSpec:p})}}function Ol(t){var o=t.value,u=t.styleSpec,p=u.light,g=t.style,x=[],S=Ca(o);if(o===void 0)return x;if(S!=="object")return x.concat([new Fe("light",o,"object expected, "+S+" found")]);for(var M in o){var D=M.match(/^(.*)-transition$/);x=x.concat(D&&p[D[1]]&&p[D[1]].transition?Fi({key:M,value:o[M],valueSpec:u.transition,style:g,styleSpec:u}):p[M]?Fi({key:M,value:o[M],valueSpec:p[M],style:g,styleSpec:u}):[new Fe(M,o[M],'unknown property "'+M+'"')])}return x}var lu={"*":function(){return[]},array:Wc,boolean:function(t){var o=t.value,u=t.key,p=Ca(o);return p!=="boolean"?[new Fe(u,o,"boolean expected, "+p+" found")]:[]},number:Xc,color:function(t){var o=t.key,u=t.value,p=Ca(u);return p!=="string"?[new Fe(o,u,"color expected, "+p+" found")]:Ri(u)===null?[new Fe(o,u,'color expected, "'+u+'" found')]:[]},constants:yt,enum:Yl,filter:Jc,function:Yc,layer:Wh,object:$s,source:ql,light:Ol,string:is,formatted:function(t){return is(t).length===0?[]:Ku(t)},resolvedImage:function(t){return is(t).length===0?[]:Ku(t)}};function Fi(t){var o=t.value,u=t.valueSpec,p=t.styleSpec;return u.expression&&Ml(Dt(o))?Yc(t):u.expression&&jo(zt(o))?Ku(t):u.type&&lu[u.type]?lu[u.type](t):$s(dr({},t,{valueSpec:u.type?p[u.type]:u}))}function Ba(t){var o=t.value,u=t.key,p=is(t);return p.length||(o.indexOf("{fontstack}")===-1&&p.push(new Fe(u,o,'"glyphs" url must include a "{fontstack}" token')),o.indexOf("{range}")===-1&&p.push(new Fe(u,o,'"glyphs" url must include a "{range}" token'))),p}function Bs(t,o){o===void 0&&(o=pe);var u=[];return u=u.concat(Fi({key:"",value:t,valueSpec:o.$root,styleSpec:o,style:t,objectElementValidators:{glyphs:Ba,"*":function(){return[]}}})),t.constants&&(u=u.concat(yt({key:"constants",value:t.constants,style:t,styleSpec:o}))),Qc(u)}function Qc(t){return[].concat(t).sort(function(o,u){return o.line-u.line})}function ml(t){return function(){for(var o=[],u=arguments.length;u--;)o[u]=arguments[u];return Qc(t.apply(this,o))}}Bs.source=ml(ql),Bs.light=ml(Ol),Bs.layer=ml(Wh),Bs.filter=ml(Jc),Bs.paintProperty=ml(ph),Bs.layoutProperty=ml(Il);var ef=Bs,Xh=ef.light,Yh=ef.paintProperty,Mc=ef.layoutProperty;function Kl(t,o){var u=!1;if(o&&o.length)for(var p=0,g=o;p<g.length;p+=1)t.fire(new We(new Error(g[p].message))),u=!0;return u}var $u=ko;function ko(t,o,u){var p=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var g=new Int32Array(this.arrayBuffer);t=g[0],this.d=(o=g[1])+2*(u=g[2]);for(var x=0;x<this.d*this.d;x++){var S=g[3+x],M=g[3+x+1];p.push(S===M?null:g.subarray(S,M))}var D=g[3+p.length+1];this.keys=g.subarray(g[3+p.length],D),this.bboxes=g.subarray(D),this.insert=this._insertReadonly}else{this.d=o+2*u;for(var U=0;U<this.d*this.d;U++)p.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=t,this.padding=u,this.scale=o/t,this.uid=0;var j=u/o*t;this.min=-j,this.max=t+j}ko.prototype.insert=function(t,o,u,p,g){this._forEachCell(o,u,p,g,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(p),this.bboxes.push(g)},ko.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ko.prototype._insertCell=function(t,o,u,p,g,x){this.cells[g].push(x)},ko.prototype.query=function(t,o,u,p,g){var x=this.min,S=this.max;if(t<=x&&o<=x&&S<=u&&S<=p&&!g)return Array.prototype.slice.call(this.keys);var M=[];return this._forEachCell(t,o,u,p,this._queryCell,M,{},g),M},ko.prototype._queryCell=function(t,o,u,p,g,x,S,M){var D=this.cells[g];if(D!==null)for(var U=this.keys,j=this.bboxes,G=0;G<D.length;G++){var ae=D[G];if(S[ae]===void 0){var le=4*ae;(M?M(j[le+0],j[le+1],j[le+2],j[le+3]):t<=j[le+2]&&o<=j[le+3]&&u>=j[le+0]&&p>=j[le+1])?(S[ae]=!0,x.push(U[ae])):S[ae]=!1}}},ko.prototype._forEachCell=function(t,o,u,p,g,x,S,M){for(var D=this._convertToCellCoord(t),U=this._convertToCellCoord(o),j=this._convertToCellCoord(u),G=this._convertToCellCoord(p),ae=D;ae<=j;ae++)for(var le=U;le<=G;le++){var Ie=this.d*le+ae;if((!M||M(this._convertFromCellCoord(ae),this._convertFromCellCoord(le),this._convertFromCellCoord(ae+1),this._convertFromCellCoord(le+1)))&&g.call(this,t,o,u,p,Ie,x,S,M))return}},ko.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},ko.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},ko.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,o=3+this.cells.length+1+1,u=0,p=0;p<this.cells.length;p++)u+=this.cells[p].length;var g=new Int32Array(o+u+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;for(var x=o,S=0;S<t.length;S++){var M=t[S];g[3+S]=x,g.set(M,x),x+=M.length}return g[3+t.length]=x,g.set(this.keys,x),g[3+t.length+1]=x+=this.keys.length,g.set(this.bboxes,x),x+=this.bboxes.length,g.buffer};var $l=re.ImageData,Jl=re.ImageBitmap,Qa={};function yn(t,o,u){u===void 0&&(u={}),Object.defineProperty(o,"_classRegistryKey",{value:t,writeable:!1}),Qa[t]={klass:o,omit:u.omit||[],shallow:u.shallow||[]}}for(var lo in yn("Object",Object),$u.serialize=function(t,o){var u=t.toArrayBuffer();return o&&o.push(u),{buffer:u}},$u.deserialize=function(t){return new $u(t.buffer)},yn("Grid",$u),yn("Color",Gi),yn("Error",Error),yn("ResolvedImage",Pa),yn("StylePropertyFunction",qu),yn("StyleExpression",dl,{omit:["_evaluator"]}),yn("ZoomDependentExpression",Vo),yn("ZoomConstantExpression",Yu),yn("CompoundExpression",_o,{omit:["_evaluate"]}),Ao)Ao[lo]._classRegistryKey||yn("Expression_"+lo,Ao[lo]);function Ju(t){return t&&typeof ArrayBuffer!="undefined"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function Qu(t){return Jl&&t instanceof Jl}function gu(t,o){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(Ju(t)||Qu(t))return o&&o.push(t),t;if(ArrayBuffer.isView(t)){var u=t;return o&&o.push(u.buffer),u}if(t instanceof $l)return o&&o.push(t.data.buffer),t;if(Array.isArray(t)){for(var p=[],g=0,x=t;g<x.length;g+=1)p.push(gu(x[g],o));return p}if(typeof t=="object"){var S=t.constructor,M=S._classRegistryKey;if(!M)throw new Error("can't serialize object of unregistered class");var D=S.serialize?S.serialize(t,o):{};if(!S.serialize){for(var U in t)if(t.hasOwnProperty(U)&&!(Qa[M].omit.indexOf(U)>=0)){var j=t[U];D[U]=Qa[M].shallow.indexOf(U)>=0?j:gu(j,o)}t instanceof Error&&(D.message=t.message)}if(D.$name)throw new Error("$name property is reserved for worker serialization logic.");return M!=="Object"&&(D.$name=M),D}throw new Error("can't serialize object of type "+typeof t)}function Ns(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||Ju(t)||Qu(t)||ArrayBuffer.isView(t)||t instanceof $l)return t;if(Array.isArray(t))return t.map(Ns);if(typeof t=="object"){var o=t.$name||"Object",u=Qa[o].klass;if(!u)throw new Error("can't deserialize unregistered class "+o);if(u.deserialize)return u.deserialize(t);for(var p=Object.create(u.prototype),g=0,x=Object.keys(t);g<x.length;g+=1){var S=x[g];if(S!=="$name"){var M=t[S];p[S]=Qa[o].shallow.indexOf(S)>=0?M:Ns(M)}}return p}throw new Error("can't deserialize object of type "+typeof t)}var Rf=function(){this.first=!0};Rf.prototype.update=function(t,o){var u=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=u,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=u,!0):(this.lastFloorZoom>u?(this.lastIntegerZoom=u+1,this.lastIntegerZoomTime=o):this.lastFloorZoom<u&&(this.lastIntegerZoom=u,this.lastIntegerZoomTime=o),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=u,!0))};var Kr={"Latin-1 Supplement":function(t){return t>=128&&t<=255},Arabic:function(t){return t>=1536&&t<=1791},"Arabic Supplement":function(t){return t>=1872&&t<=1919},"Arabic Extended-A":function(t){return t>=2208&&t<=2303},"Hangul Jamo":function(t){return t>=4352&&t<=4607},"Unified Canadian Aboriginal Syllabics":function(t){return t>=5120&&t<=5759},Khmer:function(t){return t>=6016&&t<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(t){return t>=6320&&t<=6399},"General Punctuation":function(t){return t>=8192&&t<=8303},"Letterlike Symbols":function(t){return t>=8448&&t<=8527},"Number Forms":function(t){return t>=8528&&t<=8591},"Miscellaneous Technical":function(t){return t>=8960&&t<=9215},"Control Pictures":function(t){return t>=9216&&t<=9279},"Optical Character Recognition":function(t){return t>=9280&&t<=9311},"Enclosed Alphanumerics":function(t){return t>=9312&&t<=9471},"Geometric Shapes":function(t){return t>=9632&&t<=9727},"Miscellaneous Symbols":function(t){return t>=9728&&t<=9983},"Miscellaneous Symbols and Arrows":function(t){return t>=11008&&t<=11263},"CJK Radicals Supplement":function(t){return t>=11904&&t<=12031},"Kangxi Radicals":function(t){return t>=12032&&t<=12255},"Ideographic Description Characters":function(t){return t>=12272&&t<=12287},"CJK Symbols and Punctuation":function(t){return t>=12288&&t<=12351},Hiragana:function(t){return t>=12352&&t<=12447},Katakana:function(t){return t>=12448&&t<=12543},Bopomofo:function(t){return t>=12544&&t<=12591},"Hangul Compatibility Jamo":function(t){return t>=12592&&t<=12687},Kanbun:function(t){return t>=12688&&t<=12703},"Bopomofo Extended":function(t){return t>=12704&&t<=12735},"CJK Strokes":function(t){return t>=12736&&t<=12783},"Katakana Phonetic Extensions":function(t){return t>=12784&&t<=12799},"Enclosed CJK Letters and Months":function(t){return t>=12800&&t<=13055},"CJK Compatibility":function(t){return t>=13056&&t<=13311},"CJK Unified Ideographs Extension A":function(t){return t>=13312&&t<=19903},"Yijing Hexagram Symbols":function(t){return t>=19904&&t<=19967},"CJK Unified Ideographs":function(t){return t>=19968&&t<=40959},"Yi Syllables":function(t){return t>=40960&&t<=42127},"Yi Radicals":function(t){return t>=42128&&t<=42191},"Hangul Jamo Extended-A":function(t){return t>=43360&&t<=43391},"Hangul Syllables":function(t){return t>=44032&&t<=55215},"Hangul Jamo Extended-B":function(t){return t>=55216&&t<=55295},"Private Use Area":function(t){return t>=57344&&t<=63743},"CJK Compatibility Ideographs":function(t){return t>=63744&&t<=64255},"Arabic Presentation Forms-A":function(t){return t>=64336&&t<=65023},"Vertical Forms":function(t){return t>=65040&&t<=65055},"CJK Compatibility Forms":function(t){return t>=65072&&t<=65103},"Small Form Variants":function(t){return t>=65104&&t<=65135},"Arabic Presentation Forms-B":function(t){return t>=65136&&t<=65279},"Halfwidth and Fullwidth Forms":function(t){return t>=65280&&t<=65519}};function tf(t){for(var o=0,u=t;o<u.length;o+=1)if(Lf(u[o].charCodeAt(0)))return!0;return!1}function Lf(t){return!(t!==746&&t!==747&&(t<4352||!(Kr["Bopomofo Extended"](t)||Kr.Bopomofo(t)||Kr["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||Kr["CJK Compatibility Ideographs"](t)||Kr["CJK Compatibility"](t)||Kr["CJK Radicals Supplement"](t)||Kr["CJK Strokes"](t)||!(!Kr["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||Kr["CJK Unified Ideographs Extension A"](t)||Kr["CJK Unified Ideographs"](t)||Kr["Enclosed CJK Letters and Months"](t)||Kr["Hangul Compatibility Jamo"](t)||Kr["Hangul Jamo Extended-A"](t)||Kr["Hangul Jamo Extended-B"](t)||Kr["Hangul Jamo"](t)||Kr["Hangul Syllables"](t)||Kr.Hiragana(t)||Kr["Ideographic Description Characters"](t)||Kr.Kanbun(t)||Kr["Kangxi Radicals"](t)||Kr["Katakana Phonetic Extensions"](t)||Kr.Katakana(t)&&t!==12540||!(!Kr["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!Kr["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||Kr["Unified Canadian Aboriginal Syllabics"](t)||Kr["Unified Canadian Aboriginal Syllabics Extended"](t)||Kr["Vertical Forms"](t)||Kr["Yijing Hexagram Symbols"](t)||Kr["Yi Syllables"](t)||Kr["Yi Radicals"](t))))}function Ou(t){return!(Lf(t)||function(o){return!!(Kr["Latin-1 Supplement"](o)&&(o===167||o===169||o===174||o===177||o===188||o===189||o===190||o===215||o===247)||Kr["General Punctuation"](o)&&(o===8214||o===8224||o===8225||o===8240||o===8241||o===8251||o===8252||o===8258||o===8263||o===8264||o===8265||o===8273)||Kr["Letterlike Symbols"](o)||Kr["Number Forms"](o)||Kr["Miscellaneous Technical"](o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||o===9003||o>=9085&&o<=9114||o>=9150&&o<=9165||o===9167||o>=9169&&o<=9179||o>=9186&&o<=9215)||Kr["Control Pictures"](o)&&o!==9251||Kr["Optical Character Recognition"](o)||Kr["Enclosed Alphanumerics"](o)||Kr["Geometric Shapes"](o)||Kr["Miscellaneous Symbols"](o)&&!(o>=9754&&o<=9759)||Kr["Miscellaneous Symbols and Arrows"](o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||Kr["CJK Symbols and Punctuation"](o)||Kr.Katakana(o)||Kr["Private Use Area"](o)||Kr["CJK Compatibility Forms"](o)||Kr["Small Form Variants"](o)||Kr["Halfwidth and Fullwidth Forms"](o)||o===8734||o===8756||o===8757||o>=9984&&o<=10087||o>=10102&&o<=10131||o===65532||o===65533)}(t))}function Ga(t){return t>=1424&&t<=2303||Kr["Arabic Presentation Forms-A"](t)||Kr["Arabic Presentation Forms-B"](t)}function zs(t,o){return!(!o&&Ga(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||Kr.Khmer(t))}function rf(t){for(var o=0,u=t;o<u.length;o+=1)if(Ga(u[o].charCodeAt(0)))return!0;return!1}var Ru=null,Ms="unavailable",wo=null,dh=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(Ms="error"),Ru&&Ru(t)};function ba(){kf.fire(new Oe("pluginStateChange",{pluginStatus:Ms,pluginURL:wo}))}var kf=new nt,vh=function(){return Ms},Js=function(){if(Ms!=="deferred"||!wo)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ms="loading",ba(),wo&&Da({url:wo},function(t){t?dh(t):(Ms="loaded",ba())})},Ps={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Ms==="loaded"||Ps.applyArabicShaping!=null},isLoading:function(){return Ms==="loading"},setState:function(t){Ms=t.pluginStatus,wo=t.pluginURL},isParsed:function(){return Ps.applyArabicShaping!=null&&Ps.processBidirectionalText!=null&&Ps.processStyledBidirectionalText!=null},getPluginURL:function(){return wo}},Li=function(t,o){this.zoom=t,o?(this.now=o.now,this.fadeDuration=o.fadeDuration,this.zoomHistory=o.zoomHistory,this.transition=o.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Rf,this.transition={})};Li.prototype.isSupportedScript=function(t){return function(o,u){for(var p=0,g=o;p<g.length;p+=1)if(!zs(g[p].charCodeAt(0),u))return!1;return!0}(t,Ps.isLoaded())},Li.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},Li.prototype.getCrossfadeParameters=function(){var t=this.zoom,o=t-Math.floor(t),u=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:o+(1-o)*u}:{fromScale:.5,toScale:1,t:1-(1-u)*o}};var yu=function(t,o){this.property=t,this.value=o,this.expression=function(u,p){if(Ml(u))return new qu(u,p);if(jo(u)){var g=Pl(u,p);if(g.result==="error")throw new Error(g.value.map(function(S){return S.key+": "+S.message}).join(", "));return g.value}var x=u;return typeof u=="string"&&p.type==="color"&&(x=Gi.parse(u)),{kind:"constant",evaluate:function(){return x}}}(o===void 0?t.specification.default:o,t.specification)};yu.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},yu.prototype.possiblyEvaluate=function(t,o,u){return this.property.possiblyEvaluate(this,t,o,u)};var ma=function(t){this.property=t,this.value=new yu(t,void 0)};ma.prototype.transitioned=function(t,o){return new Us(this.property,this.value,o,bt({},t.transition,this.transition),t.now)},ma.prototype.untransitioned=function(){return new Us(this.property,this.value,null,{},0)};var po=function(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)};po.prototype.getValue=function(t){return qe(this._values[t].value.value)},po.prototype.setValue=function(t,o){this._values.hasOwnProperty(t)||(this._values[t]=new ma(this._values[t].property)),this._values[t].value=new yu(this._values[t].property,o===null?void 0:qe(o))},po.prototype.getTransition=function(t){return qe(this._values[t].transition)},po.prototype.setTransition=function(t,o){this._values.hasOwnProperty(t)||(this._values[t]=new ma(this._values[t].property)),this._values[t].transition=qe(o)||void 0},po.prototype.serialize=function(){for(var t={},o=0,u=Object.keys(this._values);o<u.length;o+=1){var p=u[o],g=this.getValue(p);g!==void 0&&(t[p]=g);var x=this.getTransition(p);x!==void 0&&(t[p+"-transition"]=x)}return t},po.prototype.transitioned=function(t,o){for(var u=new cu(this._properties),p=0,g=Object.keys(this._values);p<g.length;p+=1){var x=g[p];u._values[x]=this._values[x].transitioned(t,o._values[x])}return u},po.prototype.untransitioned=function(){for(var t=new cu(this._properties),o=0,u=Object.keys(this._values);o<u.length;o+=1){var p=u[o];t._values[p]=this._values[p].untransitioned()}return t};var Us=function(t,o,u,p,g){this.property=t,this.value=o,this.begin=g+p.delay||0,this.end=this.begin+p.duration||0,t.specification.transition&&(p.delay||p.duration)&&(this.prior=u)};Us.prototype.possiblyEvaluate=function(t,o,u){var p=t.now||0,g=this.value.possiblyEvaluate(t,o,u),x=this.prior;if(x){if(p>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(p<this.begin)return x.possiblyEvaluate(t,o,u);var S=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(t,o,u),g,function(M){if(M<=0)return 0;if(M>=1)return 1;var D=M*M,U=D*M;return 4*(M<.5?U:3*(M-D)+U-.75)}(S))}return g};var cu=function(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)};cu.prototype.possiblyEvaluate=function(t,o,u){for(var p=new js(this._properties),g=0,x=Object.keys(this._values);g<x.length;g+=1){var S=x[g];p._values[S]=this._values[S].possiblyEvaluate(t,o,u)}return p},cu.prototype.hasTransition=function(){for(var t=0,o=Object.keys(this._values);t<o.length;t+=1)if(this._values[o[t]].prior)return!0;return!1};var Zs=function(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)};Zs.prototype.getValue=function(t){return qe(this._values[t].value)},Zs.prototype.setValue=function(t,o){this._values[t]=new yu(this._values[t].property,o===null?void 0:qe(o))},Zs.prototype.serialize=function(){for(var t={},o=0,u=Object.keys(this._values);o<u.length;o+=1){var p=u[o],g=this.getValue(p);g!==void 0&&(t[p]=g)}return t},Zs.prototype.possiblyEvaluate=function(t,o,u){for(var p=new js(this._properties),g=0,x=Object.keys(this._values);g<x.length;g+=1){var S=x[g];p._values[S]=this._values[S].possiblyEvaluate(t,o,u)}return p};var vs=function(t,o,u){this.property=t,this.value=o,this.parameters=u};vs.prototype.isConstant=function(){return this.value.kind==="constant"},vs.prototype.constantOr=function(t){return this.value.kind==="constant"?this.value.value:t},vs.prototype.evaluate=function(t,o,u,p){return this.property.evaluate(this.value,this.parameters,t,o,u,p)};var js=function(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)};js.prototype.get=function(t){return this._values[t]};var In=function(t){this.specification=t};In.prototype.possiblyEvaluate=function(t,o){return t.expression.evaluate(o)},In.prototype.interpolate=function(t,o,u){var p=xo[this.specification.type];return p?p(t,o,u):t};var An=function(t,o){this.specification=t,this.overrides=o};An.prototype.possiblyEvaluate=function(t,o,u,p){return new vs(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(o,null,{},u,p)}:t.expression,o)},An.prototype.interpolate=function(t,o,u){if(t.value.kind!=="constant"||o.value.kind!=="constant")return t;if(t.value.value===void 0||o.value.value===void 0)return new vs(this,{kind:"constant",value:void 0},t.parameters);var p=xo[this.specification.type];return p?new vs(this,{kind:"constant",value:p(t.value.value,o.value.value,u)},t.parameters):t},An.prototype.evaluate=function(t,o,u,p,g,x){return t.kind==="constant"?t.value:t.evaluate(o,u,p,g,x)};var Ql=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.possiblyEvaluate=function(u,p,g,x){if(u.value===void 0)return new vs(this,{kind:"constant",value:void 0},p);if(u.expression.kind==="constant"){var S=u.expression.evaluate(p,null,{},g,x),M=u.property.specification.type==="resolvedImage"&&typeof S!="string"?S.name:S,D=this._calculate(M,M,M,p);return new vs(this,{kind:"constant",value:D},p)}if(u.expression.kind==="camera"){var U=this._calculate(u.expression.evaluate({zoom:p.zoom-1}),u.expression.evaluate({zoom:p.zoom}),u.expression.evaluate({zoom:p.zoom+1}),p);return new vs(this,{kind:"constant",value:U},p)}return new vs(this,u.expression,p)},o.prototype.evaluate=function(u,p,g,x,S,M){if(u.kind==="source"){var D=u.evaluate(p,g,x,S,M);return this._calculate(D,D,D,p)}return u.kind==="composite"?this._calculate(u.evaluate({zoom:Math.floor(p.zoom)-1},g,x),u.evaluate({zoom:Math.floor(p.zoom)},g,x),u.evaluate({zoom:Math.floor(p.zoom)+1},g,x),p):u.value},o.prototype._calculate=function(u,p,g,x){return x.zoom>x.zoomHistory.lastIntegerZoom?{from:u,to:p}:{from:g,to:p}},o.prototype.interpolate=function(u){return u},o}(An),ms=function(t){this.specification=t};ms.prototype.possiblyEvaluate=function(t,o,u,p){if(t.value!==void 0){if(t.expression.kind==="constant"){var g=t.expression.evaluate(o,null,{},u,p);return this._calculate(g,g,g,o)}return this._calculate(t.expression.evaluate(new Li(Math.floor(o.zoom-1),o)),t.expression.evaluate(new Li(Math.floor(o.zoom),o)),t.expression.evaluate(new Li(Math.floor(o.zoom+1),o)),o)}},ms.prototype._calculate=function(t,o,u,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:t,to:o}:{from:u,to:o}},ms.prototype.interpolate=function(t){return t};var _u=function(t){this.specification=t};_u.prototype.possiblyEvaluate=function(t,o,u,p){return!!t.expression.evaluate(o,null,{},u,p)},_u.prototype.interpolate=function(){return!1};var es=function(t){for(var o in this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],t){var u=t[o];u.specification.overridable&&this.overridableProperties.push(o);var p=this.defaultPropertyValues[o]=new yu(u,void 0),g=this.defaultTransitionablePropertyValues[o]=new ma(u);this.defaultTransitioningPropertyValues[o]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=p.possiblyEvaluate({})}};yn("DataDrivenProperty",An),yn("DataConstantProperty",In),yn("CrossFadedDataDrivenProperty",Ql),yn("CrossFadedProperty",ms),yn("ColorRampProperty",_u);var Aa=function(t){function o(u,p){if(t.call(this),this.id=u.id,this.type=u.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},u.type!=="custom"&&(this.metadata=(u=u).metadata,this.minzoom=u.minzoom,this.maxzoom=u.maxzoom,u.type!=="background"&&(this.source=u.source,this.sourceLayer=u["source-layer"],this.filter=u.filter),p.layout&&(this._unevaluatedLayout=new Zs(p.layout)),p.paint)){for(var g in this._transitionablePaint=new po(p.paint),u.paint)this.setPaintProperty(g,u.paint[g],{validate:!1});for(var x in u.layout)this.setLayoutProperty(x,u.layout[x],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new js(p.paint)}}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},o.prototype.getLayoutProperty=function(u){return u==="visibility"?this.visibility:this._unevaluatedLayout.getValue(u)},o.prototype.setLayoutProperty=function(u,p,g){g===void 0&&(g={}),p!=null&&this._validate(Mc,"layers."+this.id+".layout."+u,u,p,g)||(u!=="visibility"?this._unevaluatedLayout.setValue(u,p):this.visibility=p)},o.prototype.getPaintProperty=function(u){return X(u,"-transition")?this._transitionablePaint.getTransition(u.slice(0,-"-transition".length)):this._transitionablePaint.getValue(u)},o.prototype.setPaintProperty=function(u,p,g){if(g===void 0&&(g={}),p!=null&&this._validate(Yh,"layers."+this.id+".paint."+u,u,p,g))return!1;if(X(u,"-transition"))return this._transitionablePaint.setTransition(u.slice(0,-"-transition".length),p||void 0),!1;var x=this._transitionablePaint._values[u],S=x.property.specification["property-type"]==="cross-faded-data-driven",M=x.value.isDataDriven(),D=x.value;this._transitionablePaint.setValue(u,p),this._handleSpecialPaintPropertyUpdate(u);var U=this._transitionablePaint._values[u].value;return U.isDataDriven()||M||S||this._handleOverridablePaintPropertyUpdate(u,D,U)},o.prototype._handleSpecialPaintPropertyUpdate=function(u){},o.prototype._handleOverridablePaintPropertyUpdate=function(u,p,g){return!1},o.prototype.isHidden=function(u){return!!(this.minzoom&&u<this.minzoom)||!!(this.maxzoom&&u>=this.maxzoom)||this.visibility==="none"},o.prototype.updateTransitions=function(u){this._transitioningPaint=this._transitionablePaint.transitioned(u,this._transitioningPaint)},o.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},o.prototype.recalculate=function(u,p){u.getCrossfadeParameters&&(this._crossfadeParameters=u.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(u,void 0,p)),this.paint=this._transitioningPaint.possiblyEvaluate(u,void 0,p)},o.prototype.serialize=function(){var u={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(u.layout=u.layout||{},u.layout.visibility=this.visibility),vt(u,function(p,g){return!(p===void 0||g==="layout"&&!Object.keys(p).length||g==="paint"&&!Object.keys(p).length)})},o.prototype._validate=function(u,p,g,x,S){return S===void 0&&(S={}),(!S||S.validate!==!1)&&Kl(this,u.call(ef,{key:p,layerType:this.type,objectKey:g,value:x,styleSpec:pe,style:{glyphs:!0,sprite:!0}}))},o.prototype.is3D=function(){return!1},o.prototype.isTileClipped=function(){return!1},o.prototype.hasOffscreenPass=function(){return!1},o.prototype.resize=function(){},o.prototype.isStateDependent=function(){for(var u in this.paint._values){var p=this.paint.get(u);if(p instanceof vs&&Fs(p.property.specification)&&(p.value.kind==="source"||p.value.kind==="composite")&&p.value.isStateDependent)return!0}return!1},o}(nt),Pc={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Ic=function(t,o){this._structArray=t,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},ga=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function Ia(t,o){o===void 0&&(o=1);var u=0,p=0;return{members:t.map(function(g){var x=Pc[g.type].BYTES_PER_ELEMENT,S=u=Oc(u,Math.max(o,x)),M=g.components||1;return p=Math.max(p,x),u+=x*M,{name:g.name,type:g.type,components:M,offset:S}}),size:Oc(u,Math.max(p,o)),alignment:o}}function Oc(t,o){return Math.ceil(t/o)*o}ga.serialize=function(t,o){return t._trim(),o&&(t.isTransferred=!0,o.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}},ga.deserialize=function(t){var o=Object.create(this.prototype);return o.arrayBuffer=t.arrayBuffer,o.length=t.length,o.capacity=t.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o},ga.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},ga.prototype.clear=function(){this.length=0},ga.prototype.resize=function(t){this.reserve(t),this.length=t},ga.prototype.reserve=function(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}},ga.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Rl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p){var g=this.length;return this.resize(g+1),this.emplace(g,u,p)},o.prototype.emplace=function(u,p,g){var x=2*u;return this.int16[x+0]=p,this.int16[x+1]=g,u},o}(ga);Rl.prototype.bytesPerElement=4,yn("StructArrayLayout2i4",Rl);var xu=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,g,x){var S=this.length;return this.resize(S+1),this.emplace(S,u,p,g,x)},o.prototype.emplace=function(u,p,g,x,S){var M=4*u;return this.int16[M+0]=p,this.int16[M+1]=g,this.int16[M+2]=x,this.int16[M+3]=S,u},o}(ga);xu.prototype.bytesPerElement=8,yn("StructArrayLayout4i8",xu);var Qs=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,g,x,S,M){var D=this.length;return this.resize(D+1),this.emplace(D,u,p,g,x,S,M)},o.prototype.emplace=function(u,p,g,x,S,M,D){var U=6*u;return this.int16[U+0]=p,this.int16[U+1]=g,this.int16[U+2]=x,this.int16[U+3]=S,this.int16[U+4]=M,this.int16[U+5]=D,u},o}(ga);Qs.prototype.bytesPerElement=12,yn("StructArrayLayout2i4i12",Qs);var Do=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,g,x,S,M){var D=this.length;return this.resize(D+1),this.emplace(D,u,p,g,x,S,M)},o.prototype.emplace=function(u,p,g,x,S,M,D){var U=4*u,j=8*u;return this.int16[U+0]=p,this.int16[U+1]=g,this.uint8[j+4]=x,this.uint8[j+5]=S,this.uint8[j+6]=M,this.uint8[j+7]=D,u},o}(ga);Do.prototype.bytesPerElement=8,yn("StructArrayLayout2i4ub8",Do);var gl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p){var g=this.length;return this.resize(g+1),this.emplace(g,u,p)},o.prototype.emplace=function(u,p,g){var x=2*u;return this.float32[x+0]=p,this.float32[x+1]=g,u},o}(ga);gl.prototype.bytesPerElement=8,yn("StructArrayLayout2f8",gl);var bu=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,g,x,S,M,D,U,j,G){var ae=this.length;return this.resize(ae+1),this.emplace(ae,u,p,g,x,S,M,D,U,j,G)},o.prototype.emplace=function(u,p,g,x,S,M,D,U,j,G,ae){var le=10*u;return this.uint16[le+0]=p,this.uint16[le+1]=g,this.uint16[le+2]=x,this.uint16[le+3]=S,this.uint16[le+4]=M,this.uint16[le+5]=D,this.uint16[le+6]=U,this.uint16[le+7]=j,this.uint16[le+8]=G,this.uint16[le+9]=ae,u},o}(ga);bu.prototype.bytesPerElement=20,yn("StructArrayLayout10ui20",bu);var nf=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,g,x,S,M,D,U,j,G,ae,le){var Ie=this.length;return this.resize(Ie+1),this.emplace(Ie,u,p,g,x,S,M,D,U,j,G,ae,le)},o.prototype.emplace=function(u,p,g,x,S,M,D,U,j,G,ae,le,Ie){var ke=12*u;return this.int16[ke+0]=p,this.int16[ke+1]=g,this.int16[ke+2]=x,this.int16[ke+3]=S,this.uint16[ke+4]=M,this.uint16[ke+5]=D,this.uint16[ke+6]=U,this.uint16[ke+7]=j,this.int16[ke+8]=G,this.int16[ke+9]=ae,this.int16[ke+10]=le,this.int16[ke+11]=Ie,u},o}(ga);nf.prototype.bytesPerElement=24,yn("StructArrayLayout4i4ui4i24",nf);var Ll=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,g){var x=this.length;return this.resize(x+1),this.emplace(x,u,p,g)},o.prototype.emplace=function(u,p,g,x){var S=3*u;return this.float32[S+0]=p,this.float32[S+1]=g,this.float32[S+2]=x,u},o}(ga);Ll.prototype.bytesPerElement=12,yn("StructArrayLayout3f12",Ll);var kl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u){var p=this.length;return this.resize(p+1),this.emplace(p,u)},o.prototype.emplace=function(u,p){return this.uint32[1*u+0]=p,u},o}(ga);kl.prototype.bytesPerElement=4,yn("StructArrayLayout1ul4",kl);var Dl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,g,x,S,M,D,U,j){var G=this.length;return this.resize(G+1),this.emplace(G,u,p,g,x,S,M,D,U,j)},o.prototype.emplace=function(u,p,g,x,S,M,D,U,j,G){var ae=10*u,le=5*u;return this.int16[ae+0]=p,this.int16[ae+1]=g,this.int16[ae+2]=x,this.int16[ae+3]=S,this.int16[ae+4]=M,this.int16[ae+5]=D,this.uint32[le+3]=U,this.uint16[ae+8]=j,this.uint16[ae+9]=G,u},o}(ga);Dl.prototype.bytesPerElement=20,yn("StructArrayLayout6i1ul2ui20",Dl);var ec=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,g,x,S,M){var D=this.length;return this.resize(D+1),this.emplace(D,u,p,g,x,S,M)},o.prototype.emplace=function(u,p,g,x,S,M,D){var U=6*u;return this.int16[U+0]=p,this.int16[U+1]=g,this.int16[U+2]=x,this.int16[U+3]=S,this.int16[U+4]=M,this.int16[U+5]=D,u},o}(ga);ec.prototype.bytesPerElement=12,yn("StructArrayLayout2i2i2i12",ec);var yl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,g,x,S){var M=this.length;return this.resize(M+1),this.emplace(M,u,p,g,x,S)},o.prototype.emplace=function(u,p,g,x,S,M){var D=4*u,U=8*u;return this.float32[D+0]=p,this.float32[D+1]=g,this.float32[D+2]=x,this.int16[U+6]=S,this.int16[U+7]=M,u},o}(ga);yl.prototype.bytesPerElement=16,yn("StructArrayLayout2f1f2i16",yl);var mh=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,g,x){var S=this.length;return this.resize(S+1),this.emplace(S,u,p,g,x)},o.prototype.emplace=function(u,p,g,x,S){var M=12*u,D=3*u;return this.uint8[M+0]=p,this.uint8[M+1]=g,this.float32[D+1]=x,this.float32[D+2]=S,u},o}(ga);mh.prototype.bytesPerElement=12,yn("StructArrayLayout2ub2f12",mh);var el=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,g){var x=this.length;return this.resize(x+1),this.emplace(x,u,p,g)},o.prototype.emplace=function(u,p,g,x){var S=3*u;return this.uint16[S+0]=p,this.uint16[S+1]=g,this.uint16[S+2]=x,u},o}(ga);el.prototype.bytesPerElement=6,yn("StructArrayLayout3ui6",el);var Lu=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,g,x,S,M,D,U,j,G,ae,le,Ie,ke,Ke,Ue,st){var St=this.length;return this.resize(St+1),this.emplace(St,u,p,g,x,S,M,D,U,j,G,ae,le,Ie,ke,Ke,Ue,st)},o.prototype.emplace=function(u,p,g,x,S,M,D,U,j,G,ae,le,Ie,ke,Ke,Ue,st,St){var Gt=24*u,Zt=12*u,or=48*u;return this.int16[Gt+0]=p,this.int16[Gt+1]=g,this.uint16[Gt+2]=x,this.uint16[Gt+3]=S,this.uint32[Zt+2]=M,this.uint32[Zt+3]=D,this.uint32[Zt+4]=U,this.uint16[Gt+10]=j,this.uint16[Gt+11]=G,this.uint16[Gt+12]=ae,this.float32[Zt+7]=le,this.float32[Zt+8]=Ie,this.uint8[or+36]=ke,this.uint8[or+37]=Ke,this.uint8[or+38]=Ue,this.uint32[Zt+10]=st,this.int16[Gt+22]=St,u},o}(ga);Lu.prototype.bytesPerElement=48,yn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Lu);var Df=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,g,x,S,M,D,U,j,G,ae,le,Ie,ke,Ke,Ue,st,St,Gt,Zt,or,Ir,Xr,Dn,ln,Un,gn,ki){var ii=this.length;return this.resize(ii+1),this.emplace(ii,u,p,g,x,S,M,D,U,j,G,ae,le,Ie,ke,Ke,Ue,st,St,Gt,Zt,or,Ir,Xr,Dn,ln,Un,gn,ki)},o.prototype.emplace=function(u,p,g,x,S,M,D,U,j,G,ae,le,Ie,ke,Ke,Ue,st,St,Gt,Zt,or,Ir,Xr,Dn,ln,Un,gn,ki,ii){var Cn=34*u,ei=17*u;return this.int16[Cn+0]=p,this.int16[Cn+1]=g,this.int16[Cn+2]=x,this.int16[Cn+3]=S,this.int16[Cn+4]=M,this.int16[Cn+5]=D,this.int16[Cn+6]=U,this.int16[Cn+7]=j,this.uint16[Cn+8]=G,this.uint16[Cn+9]=ae,this.uint16[Cn+10]=le,this.uint16[Cn+11]=Ie,this.uint16[Cn+12]=ke,this.uint16[Cn+13]=Ke,this.uint16[Cn+14]=Ue,this.uint16[Cn+15]=st,this.uint16[Cn+16]=St,this.uint16[Cn+17]=Gt,this.uint16[Cn+18]=Zt,this.uint16[Cn+19]=or,this.uint16[Cn+20]=Ir,this.uint16[Cn+21]=Xr,this.uint16[Cn+22]=Dn,this.uint32[ei+12]=ln,this.float32[ei+13]=Un,this.float32[ei+14]=gn,this.float32[ei+15]=ki,this.float32[ei+16]=ii,u},o}(ga);Df.prototype.bytesPerElement=68,yn("StructArrayLayout8i15ui1ul4f68",Df);var _l=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u){var p=this.length;return this.resize(p+1),this.emplace(p,u)},o.prototype.emplace=function(u,p){return this.float32[1*u+0]=p,u},o}(ga);_l.prototype.bytesPerElement=4,yn("StructArrayLayout1f4",_l);var eu=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,g){var x=this.length;return this.resize(x+1),this.emplace(x,u,p,g)},o.prototype.emplace=function(u,p,g,x){var S=3*u;return this.int16[S+0]=p,this.int16[S+1]=g,this.int16[S+2]=x,u},o}(ga);eu.prototype.bytesPerElement=6,yn("StructArrayLayout3i6",eu);var af=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,g){var x=this.length;return this.resize(x+1),this.emplace(x,u,p,g)},o.prototype.emplace=function(u,p,g,x){var S=4*u;return this.uint32[2*u+0]=p,this.uint16[S+2]=g,this.uint16[S+3]=x,u},o}(ga);af.prototype.bytesPerElement=8,yn("StructArrayLayout1ul2ui8",af);var Vs=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p){var g=this.length;return this.resize(g+1),this.emplace(g,u,p)},o.prototype.emplace=function(u,p,g){var x=2*u;return this.uint16[x+0]=p,this.uint16[x+1]=g,u},o}(ga);Vs.prototype.bytesPerElement=4,yn("StructArrayLayout2ui4",Vs);var gh=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u){var p=this.length;return this.resize(p+1),this.emplace(p,u)},o.prototype.emplace=function(u,p){return this.uint16[1*u+0]=p,u},o}(ga);gh.prototype.bytesPerElement=2,yn("StructArrayLayout1ui2",gh);var tc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,g,x){var S=this.length;return this.resize(S+1),this.emplace(S,u,p,g,x)},o.prototype.emplace=function(u,p,g,x,S){var M=4*u;return this.float32[M+0]=p,this.float32[M+1]=g,this.float32[M+2]=x,this.float32[M+3]=S,u},o}(ga);tc.prototype.bytesPerElement=16,yn("StructArrayLayout4f16",tc);var l=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return u.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},u.x1.get=function(){return this._structArray.int16[this._pos2+2]},u.y1.get=function(){return this._structArray.int16[this._pos2+3]},u.x2.get=function(){return this._structArray.int16[this._pos2+4]},u.y2.get=function(){return this._structArray.int16[this._pos2+5]},u.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},u.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},u.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},u.anchorPoint.get=function(){return new ie(this.anchorPointX,this.anchorPointY)},Object.defineProperties(o.prototype,u),o}(Ic);l.prototype.size=20;var f=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new l(this,u)},o}(Dl);yn("CollisionBoxArray",f);var c=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return u.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},u.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},u.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},u.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},u.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},u.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},u.segment.get=function(){return this._structArray.uint16[this._pos2+10]},u.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},u.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},u.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},u.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},u.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},u.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},u.placedOrientation.set=function(p){this._structArray.uint8[this._pos1+37]=p},u.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},u.hidden.set=function(p){this._structArray.uint8[this._pos1+38]=p},u.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},u.crossTileID.set=function(p){this._structArray.uint32[this._pos4+10]=p},u.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(o.prototype,u),o}(Ic);c.prototype.size=48;var d=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new c(this,u)},o}(Lu);yn("PlacedSymbolArray",d);var E=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return u.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},u.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},u.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},u.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},u.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},u.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},u.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},u.key.get=function(){return this._structArray.uint16[this._pos2+8]},u.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},u.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},u.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},u.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},u.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},u.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},u.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},u.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},u.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},u.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},u.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},u.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},u.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},u.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},u.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},u.crossTileID.set=function(p){this._structArray.uint32[this._pos4+12]=p},u.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},u.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},u.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},u.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(o.prototype,u),o}(Ic);E.prototype.size=68;var C=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new E(this,u)},o}(Df);yn("SymbolInstanceArray",C);var T=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.getoffsetX=function(u){return this.float32[1*u+0]},o}(_l);yn("GlyphOffsetArray",T);var L=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.getx=function(u){return this.int16[3*u+0]},o.prototype.gety=function(u){return this.int16[3*u+1]},o.prototype.gettileUnitDistanceFromAnchor=function(u){return this.int16[3*u+2]},o}(eu);yn("SymbolLineVertexArray",L);var Z=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return u.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},u.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},u.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(o.prototype,u),o}(Ic);Z.prototype.size=8;var W=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new Z(this,u)},o}(af);yn("FeatureIndexArray",W);var fe=Ia([{name:"a_pos",components:2,type:"Int16"}],4).members,he=function(t){t===void 0&&(t=[]),this.segments=t};function de(t,o){return 256*(t=Mt(Math.floor(t),0,255))+Mt(Math.floor(o),0,255)}he.prototype.prepareSegment=function(t,o,u,p){var g=this.segments[this.segments.length-1];return t>he.MAX_VERTEX_ARRAY_LENGTH&&$e("Max vertices per segment is "+he.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+t),(!g||g.vertexLength+t>he.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==p)&&(g={vertexOffset:o.length,primitiveOffset:u.length,vertexLength:0,primitiveLength:0},p!==void 0&&(g.sortKey=p),this.segments.push(g)),g},he.prototype.get=function(){return this.segments},he.prototype.destroy=function(){for(var t=0,o=this.segments;t<o.length;t+=1){var u=o[t];for(var p in u.vaos)u.vaos[p].destroy()}},he.simpleSegment=function(t,o,u,p){return new he([{vertexOffset:t,primitiveOffset:o,vertexLength:u,primitiveLength:p,vaos:{},sortKey:0}])},he.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,yn("SegmentVector",he);var Le=Ia([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Re=te(function(t){t.exports=function(o,u){var p,g,x,S,M,D,U,j;for(g=o.length-(p=3&o.length),x=u,M=3432918353,D=461845907,j=0;j<g;)U=255&o.charCodeAt(j)|(255&o.charCodeAt(++j))<<8|(255&o.charCodeAt(++j))<<16|(255&o.charCodeAt(++j))<<24,++j,x=27492+(65535&(S=5*(65535&(x=(x^=U=(65535&(U=(U=(65535&U)*M+(((U>>>16)*M&65535)<<16)&4294967295)<<15|U>>>17))*D+(((U>>>16)*D&65535)<<16)&4294967295)<<13|x>>>19))+((5*(x>>>16)&65535)<<16)&4294967295))+((58964+(S>>>16)&65535)<<16);switch(U=0,p){case 3:U^=(255&o.charCodeAt(j+2))<<16;case 2:U^=(255&o.charCodeAt(j+1))<<8;case 1:x^=U=(65535&(U=(U=(65535&(U^=255&o.charCodeAt(j)))*M+(((U>>>16)*M&65535)<<16)&4294967295)<<15|U>>>17))*D+(((U>>>16)*D&65535)<<16)&4294967295}return x^=o.length,x=2246822507*(65535&(x^=x>>>16))+((2246822507*(x>>>16)&65535)<<16)&4294967295,x=3266489909*(65535&(x^=x>>>13))+((3266489909*(x>>>16)&65535)<<16)&4294967295,(x^=x>>>16)>>>0}}),Be=te(function(t){t.exports=function(o,u){for(var p,g=o.length,x=u^g,S=0;g>=4;)p=1540483477*(65535&(p=255&o.charCodeAt(S)|(255&o.charCodeAt(++S))<<8|(255&o.charCodeAt(++S))<<16|(255&o.charCodeAt(++S))<<24))+((1540483477*(p>>>16)&65535)<<16),x=1540483477*(65535&x)+((1540483477*(x>>>16)&65535)<<16)^(p=1540483477*(65535&(p^=p>>>24))+((1540483477*(p>>>16)&65535)<<16)),g-=4,++S;switch(g){case 3:x^=(255&o.charCodeAt(S+2))<<16;case 2:x^=(255&o.charCodeAt(S+1))<<8;case 1:x=1540483477*(65535&(x^=255&o.charCodeAt(S)))+((1540483477*(x>>>16)&65535)<<16)}return x=1540483477*(65535&(x^=x>>>13))+((1540483477*(x>>>16)&65535)<<16),(x^=x>>>15)>>>0}}),Ae=Re,Ve=Be;Ae.murmur3=Re,Ae.murmur2=Ve;var rt=function(){this.ids=[],this.positions=[],this.indexed=!1};rt.prototype.add=function(t,o,u,p){this.ids.push(Wt(t)),this.positions.push(o,u,p)},rt.prototype.getPositions=function(t){for(var o=Wt(t),u=0,p=this.ids.length-1;u<p;){var g=u+p>>1;this.ids[g]>=o?p=g:u=g+1}for(var x=[];this.ids[u]===o;)x.push({index:this.positions[3*u],start:this.positions[3*u+1],end:this.positions[3*u+2]}),u++;return x},rt.serialize=function(t,o){var u=new Float64Array(t.ids),p=new Uint32Array(t.positions);return function g(x,S,M,D){for(;M<D;){for(var U=x[M+D>>1],j=M-1,G=D+1;;){do j++;while(x[j]<U);do G--;while(x[G]>U);if(j>=G)break;Vt(x,j,G),Vt(S,3*j,3*G),Vt(S,3*j+1,3*G+1),Vt(S,3*j+2,3*G+2)}G-M<D-G?(g(x,S,M,G),M=G+1):(g(x,S,G+1,D),D=G)}}(u,p,0,u.length-1),o&&o.push(u.buffer,p.buffer),{ids:u,positions:p}},rt.deserialize=function(t){var o=new rt;return o.ids=t.ids,o.positions=t.positions,o.indexed=!0,o};var xt=Math.pow(2,53)-1;function Wt(t){var o=+t;return!isNaN(o)&&o<=xt?o:Ae(String(t))}function Vt(t,o,u){var p=t[o];t[o]=t[u],t[u]=p}yn("FeaturePositionMap",rt);var Ot=function(t,o){this.gl=t.gl,this.location=o},vr=function(t){function o(u,p){t.call(this,u,p),this.current=0}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))},o}(Ot),Br=function(t){function o(u,p){t.call(this,u,p),this.current=0}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))},o}(Ot),Dr=function(t){function o(u,p){t.call(this,u,p),this.current=[0,0]}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1]))},o}(Ot),an=function(t){function o(u,p){t.call(this,u,p),this.current=[0,0,0]}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2]))},o}(Ot),Bn=function(t){function o(u,p){t.call(this,u,p),this.current=[0,0,0,0]}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3]))},o}(Ot),kn=function(t){function o(u,p){t.call(this,u,p),this.current=Gi.transparent}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a))},o}(Ot),Nn=new Float32Array(16),Bi=function(t){function o(u,p){t.call(this,u,p),this.current=Nn}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(var p=1;p<16;p++)if(u[p]!==this.current[p]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}},o}(Ot);function on(t){return[de(255*t.r,255*t.g),de(255*t.b,255*t.a)]}var si=function(t,o,u){this.value=t,this.uniformNames=o.map(function(p){return"u_"+p}),this.type=u};si.prototype.setUniform=function(t,o,u){t.set(u.constantOr(this.value))},si.prototype.getBinding=function(t,o,u){return this.type==="color"?new kn(t,o):new Br(t,o)};var hi=function(t,o){this.uniformNames=o.map(function(u){return"u_"+u}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};hi.prototype.setConstantPatternPositions=function(t,o){this.pixelRatioFrom=o.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=o.tlbr,this.patternTo=t.tlbr},hi.prototype.setUniform=function(t,o,u,p){var g=p==="u_pattern_to"?this.patternTo:p==="u_pattern_from"?this.patternFrom:p==="u_pixel_ratio_to"?this.pixelRatioTo:p==="u_pixel_ratio_from"?this.pixelRatioFrom:null;g&&t.set(g)},hi.prototype.getBinding=function(t,o,u){return u.substr(0,9)==="u_pattern"?new Bn(t,o):new Br(t,o)};var ri=function(t,o,u,p){this.expression=t,this.type=u,this.maxValue=0,this.paintVertexAttributes=o.map(function(g){return{name:"a_"+g,type:"Float32",components:u==="color"?2:1,offset:0}}),this.paintVertexArray=new p};ri.prototype.populatePaintArray=function(t,o,u,p,g){var x=this.paintVertexArray.length,S=this.expression.evaluate(new Li(0),o,{},p,[],g);this.paintVertexArray.resize(t),this._setPaintValue(x,t,S)},ri.prototype.updatePaintArray=function(t,o,u,p){var g=this.expression.evaluate({zoom:0},u,p);this._setPaintValue(t,o,g)},ri.prototype._setPaintValue=function(t,o,u){if(this.type==="color")for(var p=on(u),g=t;g<o;g++)this.paintVertexArray.emplace(g,p[0],p[1]);else{for(var x=t;x<o;x++)this.paintVertexArray.emplace(x,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}},ri.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},ri.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Hn=function(t,o,u,p,g,x){this.expression=t,this.uniformNames=o.map(function(S){return"u_"+S+"_t"}),this.type=u,this.useIntegerZoom=p,this.zoom=g,this.maxValue=0,this.paintVertexAttributes=o.map(function(S){return{name:"a_"+S,type:"Float32",components:u==="color"?4:2,offset:0}}),this.paintVertexArray=new x};Hn.prototype.populatePaintArray=function(t,o,u,p,g){var x=this.expression.evaluate(new Li(this.zoom),o,{},p,[],g),S=this.expression.evaluate(new Li(this.zoom+1),o,{},p,[],g),M=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(M,t,x,S)},Hn.prototype.updatePaintArray=function(t,o,u,p){var g=this.expression.evaluate({zoom:this.zoom},u,p),x=this.expression.evaluate({zoom:this.zoom+1},u,p);this._setPaintValue(t,o,g,x)},Hn.prototype._setPaintValue=function(t,o,u,p){if(this.type==="color")for(var g=on(u),x=on(p),S=t;S<o;S++)this.paintVertexArray.emplace(S,g[0],g[1],x[0],x[1]);else{for(var M=t;M<o;M++)this.paintVertexArray.emplace(M,u,p);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(p))}},Hn.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Hn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Hn.prototype.setUniform=function(t,o){var u=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,p=Mt(this.expression.interpolationFactor(u,this.zoom,this.zoom+1),0,1);t.set(p)},Hn.prototype.getBinding=function(t,o,u){return new Br(t,o)};var mi=function(t,o,u,p,g,x){this.expression=t,this.type=o,this.useIntegerZoom=u,this.zoom=p,this.layerId=x,this.zoomInPaintVertexArray=new g,this.zoomOutPaintVertexArray=new g};mi.prototype.populatePaintArray=function(t,o,u){var p=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(p,t,o.patterns&&o.patterns[this.layerId],u)},mi.prototype.updatePaintArray=function(t,o,u,p,g){this._setPaintValues(t,o,u.patterns&&u.patterns[this.layerId],g)},mi.prototype._setPaintValues=function(t,o,u,p){if(p&&u){var g=p[u.min],x=p[u.mid],S=p[u.max];if(g&&x&&S)for(var M=t;M<o;M++)this.zoomInPaintVertexArray.emplace(M,x.tl[0],x.tl[1],x.br[0],x.br[1],g.tl[0],g.tl[1],g.br[0],g.br[1],x.pixelRatio,g.pixelRatio),this.zoomOutPaintVertexArray.emplace(M,x.tl[0],x.tl[1],x.br[0],x.br[1],S.tl[0],S.tl[1],S.br[0],S.br[1],x.pixelRatio,S.pixelRatio)}},mi.prototype.upload=function(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Le.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Le.members,this.expression.isStateDependent))},mi.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var Rn=function(t,o,u){this.binders={},this._buffers=[];var p=[];for(var g in t.paint._values)if(u(g)){var x=t.paint.get(g);if(x instanceof vs&&Fs(x.property.specification)){var S=Ha(g,t.type),M=x.value,D=x.property.specification.type,U=x.property.useIntegerZoom,j=x.property.specification["property-type"],G=j==="cross-faded"||j==="cross-faded-data-driven";if(M.kind==="constant")this.binders[g]=G?new hi(M.value,S):new si(M.value,S,D),p.push("/u_"+g);else if(M.kind==="source"||G){var ae=eo(g,D,"source");this.binders[g]=G?new mi(M,D,U,o,ae,t.id):new ri(M,S,D,ae),p.push("/a_"+g)}else{var le=eo(g,D,"composite");this.binders[g]=new Hn(M,S,D,U,o,le),p.push("/z_"+g)}}}this.cacheKey=p.sort().join("")};Rn.prototype.getMaxValue=function(t){var o=this.binders[t];return o instanceof ri||o instanceof Hn?o.maxValue:0},Rn.prototype.populatePaintArrays=function(t,o,u,p,g){for(var x in this.binders){var S=this.binders[x];(S instanceof ri||S instanceof Hn||S instanceof mi)&&S.populatePaintArray(t,o,u,p,g)}},Rn.prototype.setConstantPatternPositions=function(t,o){for(var u in this.binders){var p=this.binders[u];p instanceof hi&&p.setConstantPatternPositions(t,o)}},Rn.prototype.updatePaintArrays=function(t,o,u,p,g){var x=!1;for(var S in t)for(var M=0,D=o.getPositions(S);M<D.length;M+=1){var U=D[M],j=u.feature(U.index);for(var G in this.binders){var ae=this.binders[G];if((ae instanceof ri||ae instanceof Hn||ae instanceof mi)&&ae.expression.isStateDependent===!0){var le=p.paint.get(G);ae.expression=le.value,ae.updatePaintArray(U.start,U.end,j,t[S],g),x=!0}}}return x},Rn.prototype.defines=function(){var t=[];for(var o in this.binders){var u=this.binders[o];(u instanceof si||u instanceof hi)&&t.push.apply(t,u.uniformNames.map(function(p){return"#define HAS_UNIFORM_"+p}))}return t},Rn.prototype.getBinderAttributes=function(){var t=[];for(var o in this.binders){var u=this.binders[o];if(u instanceof ri||u instanceof Hn)for(var p=0;p<u.paintVertexAttributes.length;p++)t.push(u.paintVertexAttributes[p].name);else if(u instanceof mi)for(var g=0;g<Le.members.length;g++)t.push(Le.members[g].name)}return t},Rn.prototype.getBinderUniforms=function(){var t=[];for(var o in this.binders){var u=this.binders[o];if(u instanceof si||u instanceof hi||u instanceof Hn)for(var p=0,g=u.uniformNames;p<g.length;p+=1)t.push(g[p])}return t},Rn.prototype.getPaintVertexBuffers=function(){return this._buffers},Rn.prototype.getUniforms=function(t,o){var u=[];for(var p in this.binders){var g=this.binders[p];if(g instanceof si||g instanceof hi||g instanceof Hn)for(var x=0,S=g.uniformNames;x<S.length;x+=1){var M=S[x];if(o[M]){var D=g.getBinding(t,o[M],M);u.push({name:M,property:p,binding:D})}}}return u},Rn.prototype.setUniforms=function(t,o,u,p){for(var g=0,x=o;g<x.length;g+=1){var S=x[g],M=S.name,D=S.property;this.binders[D].setUniform(S.binding,p,u.get(D),M)}},Rn.prototype.updatePaintBuffers=function(t){for(var o in this._buffers=[],this.binders){var u=this.binders[o];if(t&&u instanceof mi){var p=t.fromScale===2?u.zoomInPaintVertexBuffer:u.zoomOutPaintVertexBuffer;p&&this._buffers.push(p)}else(u instanceof ri||u instanceof Hn)&&u.paintVertexBuffer&&this._buffers.push(u.paintVertexBuffer)}},Rn.prototype.upload=function(t){for(var o in this.binders){var u=this.binders[o];(u instanceof ri||u instanceof Hn||u instanceof mi)&&u.upload(t)}this.updatePaintBuffers()},Rn.prototype.destroy=function(){for(var t in this.binders){var o=this.binders[t];(o instanceof ri||o instanceof Hn||o instanceof mi)&&o.destroy()}};var Wn=function(t,o,u){u===void 0&&(u=function(){return!0}),this.programConfigurations={};for(var p=0,g=t;p<g.length;p+=1){var x=g[p];this.programConfigurations[x.id]=new Rn(x,o,u)}this.needsUpload=!1,this._featureMap=new rt,this._bufferOffset=0};function Ha(t,o){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[t]||[t.replace(o+"-","").replace(/-/g,"_")]}function eo(t,o,u){var p={color:{source:gl,composite:tc},number:{source:_l,composite:gl}},g=function(x){return{"line-pattern":{source:bu,composite:bu},"fill-pattern":{source:bu,composite:bu},"fill-extrusion-pattern":{source:bu,composite:bu}}[x]}(t);return g&&g[u]||p[o][u]}Wn.prototype.populatePaintArrays=function(t,o,u,p,g,x){for(var S in this.programConfigurations)this.programConfigurations[S].populatePaintArrays(t,o,p,g,x);o.id!==void 0&&this._featureMap.add(o.id,u,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0},Wn.prototype.updatePaintArrays=function(t,o,u,p){for(var g=0,x=u;g<x.length;g+=1){var S=x[g];this.needsUpload=this.programConfigurations[S.id].updatePaintArrays(t,this._featureMap,o,S,p)||this.needsUpload}},Wn.prototype.get=function(t){return this.programConfigurations[t]},Wn.prototype.upload=function(t){if(this.needsUpload){for(var o in this.programConfigurations)this.programConfigurations[o].upload(t);this.needsUpload=!1}},Wn.prototype.destroy=function(){for(var t in this.programConfigurations)this.programConfigurations[t].destroy()},yn("ConstantBinder",si),yn("CrossFadedConstantBinder",hi),yn("SourceExpressionBinder",ri),yn("CrossFadedCompositeBinder",mi),yn("CompositeExpressionBinder",Hn),yn("ProgramConfiguration",Rn,{omit:["_buffers"]}),yn("ProgramConfigurationSet",Wn);var bo=Math.pow(2,14)-1,To=-bo-1;function to(t){for(var o=8192/t.extent,u=t.loadGeometry(),p=0;p<u.length;p++)for(var g=u[p],x=0;x<g.length;x++){var S=g[x],M=Math.round(S.x*o),D=Math.round(S.y*o);S.x=Mt(M,To,bo),S.y=Mt(D,To,bo),(M<S.x||M>S.x+1||D<S.y||D>S.y+1)&&$e("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return u}function vo(t,o){return{type:t.type,id:t.id,properties:t.properties,geometry:o?to(t):[]}}function Is(t,o,u,p,g){t.emplaceBack(2*o+(p+1)/2,2*u+(g+1)/2)}var gs=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Rl,this.indexArray=new el,this.segments=new he,this.programConfigurations=new Wn(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};function Va(t,o){for(var u=0;u<t.length;u++)if(tu(o,t[u]))return!0;for(var p=0;p<o.length;p++)if(tu(t,o[p]))return!0;return!!Eu(t,o)}function ca(t,o,u){return!!tu(t,o)||!!tl(o,t,u)}function Os(t,o){if(t.length===1)return Rc(o,t[0]);for(var u=0;u<o.length;u++)for(var p=o[u],g=0;g<p.length;g++)if(tu(t,p[g]))return!0;for(var x=0;x<t.length;x++)if(Rc(o,t[x]))return!0;for(var S=0;S<o.length;S++)if(Eu(t,o[S]))return!0;return!1}function Gs(t,o,u){if(t.length>1){if(Eu(t,o))return!0;for(var p=0;p<o.length;p++)if(tl(o[p],t,u))return!0}for(var g=0;g<t.length;g++)if(tl(t[g],o,u))return!0;return!1}function Eu(t,o){if(t.length===0||o.length===0)return!1;for(var u=0;u<t.length-1;u++)for(var p=t[u],g=t[u+1],x=0;x<o.length-1;x++)if(rc(p,g,o[x],o[x+1]))return!0;return!1}function rc(t,o,u,p){return kt(t,u,p)!==kt(o,u,p)&&kt(t,o,u)!==kt(t,o,p)}function tl(t,o,u){var p=u*u;if(o.length===1)return t.distSqr(o[0])<p;for(var g=1;g<o.length;g++)if(nc(t,o[g-1],o[g])<p)return!0;return!1}function nc(t,o,u){var p=o.distSqr(u);if(p===0)return t.distSqr(o);var g=((t.x-o.x)*(u.x-o.x)+(t.y-o.y)*(u.y-o.y))/p;return t.distSqr(g<0?o:g>1?u:u.sub(o)._mult(g)._add(o))}function Rc(t,o){for(var u,p,g,x=!1,S=0;S<t.length;S++)for(var M=0,D=(u=t[S]).length-1;M<u.length;D=M++)(p=u[M]).y>o.y!=(g=u[D]).y>o.y&&o.x<(g.x-p.x)*(o.y-p.y)/(g.y-p.y)+p.x&&(x=!x);return x}function tu(t,o){for(var u=!1,p=0,g=t.length-1;p<t.length;g=p++){var x=t[p],S=t[g];x.y>o.y!=S.y>o.y&&o.x<(S.x-x.x)*(o.y-x.y)/(S.y-x.y)+x.x&&(u=!u)}return u}function ys(t,o,u){var p=u[0],g=u[2];if(t.x<p.x&&o.x<p.x||t.x>g.x&&o.x>g.x||t.y<p.y&&o.y<p.y||t.y>g.y&&o.y>g.y)return!1;var x=kt(t,o,u[0]);return x!==kt(t,o,u[1])||x!==kt(t,o,u[2])||x!==kt(t,o,u[3])}function ku(t,o,u){var p=o.paint.get(t).value;return p.kind==="constant"?p.value:u.programConfigurations.get(o.id).getMaxValue(t)}function Fo(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function rl(t,o,u,p,g){if(!o[0]&&!o[1])return t;var x=ie.convert(o)._mult(g);u==="viewport"&&x._rotate(-p);for(var S=[],M=0;M<t.length;M++)S.push(t[M].sub(x));return S}gs.prototype.populate=function(t,o,u){var p=this.layers[0],g=[],x=null;p.type==="circle"&&(x=p.layout.get("circle-sort-key"));for(var S=0,M=t;S<M.length;S+=1){var D=M[S],U=D.feature,j=D.id,G=D.index,ae=D.sourceLayerIndex,le=this.layers[0]._featureFilter.needGeometry,Ie=vo(U,le);if(this.layers[0]._featureFilter.filter(new Li(this.zoom),Ie,u)){var ke=x?x.evaluate(Ie,{},u):void 0,Ke={id:j,properties:U.properties,type:U.type,sourceLayerIndex:ae,index:G,geometry:le?Ie.geometry:to(U),patterns:{},sortKey:ke};g.push(Ke)}}x&&g.sort(function(Xr,Dn){return Xr.sortKey-Dn.sortKey});for(var Ue=0,st=g;Ue<st.length;Ue+=1){var St=st[Ue],Gt=St.geometry,Zt=St.index,or=St.sourceLayerIndex,Ir=t[Zt].feature;this.addFeature(St,Gt,Zt,u),o.featureIndex.insert(Ir,Gt,Zt,or,this.index)}},gs.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},gs.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},gs.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},gs.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,fe),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},gs.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},gs.prototype.addFeature=function(t,o,u,p){for(var g=0,x=o;g<x.length;g+=1)for(var S=0,M=x[g];S<M.length;S+=1){var D=M[S],U=D.x,j=D.y;if(!(U<0||U>=8192||j<0||j>=8192)){var G=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),ae=G.vertexLength;Is(this.layoutVertexArray,U,j,-1,-1),Is(this.layoutVertexArray,U,j,1,-1),Is(this.layoutVertexArray,U,j,1,1),Is(this.layoutVertexArray,U,j,-1,1),this.indexArray.emplaceBack(ae,ae+1,ae+2),this.indexArray.emplaceBack(ae,ae+3,ae+2),G.vertexLength+=4,G.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,{},p)},yn("CircleBucket",gs,{omit:["layers"]});var Hs=new es({"circle-sort-key":new An(pe.layout_circle["circle-sort-key"])}),Su={paint:new es({"circle-radius":new An(pe.paint_circle["circle-radius"]),"circle-color":new An(pe.paint_circle["circle-color"]),"circle-blur":new An(pe.paint_circle["circle-blur"]),"circle-opacity":new An(pe.paint_circle["circle-opacity"]),"circle-translate":new In(pe.paint_circle["circle-translate"]),"circle-translate-anchor":new In(pe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new In(pe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new In(pe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new An(pe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new An(pe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new An(pe.paint_circle["circle-stroke-opacity"])}),layout:Hs},Qi=typeof Float32Array!="undefined"?Float32Array:Array;function Rs(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function as(t,o,u){var p=o[0],g=o[1],x=o[2],S=o[3],M=o[4],D=o[5],U=o[6],j=o[7],G=o[8],ae=o[9],le=o[10],Ie=o[11],ke=o[12],Ke=o[13],Ue=o[14],st=o[15],St=u[0],Gt=u[1],Zt=u[2],or=u[3];return t[0]=St*p+Gt*M+Zt*G+or*ke,t[1]=St*g+Gt*D+Zt*ae+or*Ke,t[2]=St*x+Gt*U+Zt*le+or*Ue,t[3]=St*S+Gt*j+Zt*Ie+or*st,t[4]=(St=u[4])*p+(Gt=u[5])*M+(Zt=u[6])*G+(or=u[7])*ke,t[5]=St*g+Gt*D+Zt*ae+or*Ke,t[6]=St*x+Gt*U+Zt*le+or*Ue,t[7]=St*S+Gt*j+Zt*Ie+or*st,t[8]=(St=u[8])*p+(Gt=u[9])*M+(Zt=u[10])*G+(or=u[11])*ke,t[9]=St*g+Gt*D+Zt*ae+or*Ke,t[10]=St*x+Gt*U+Zt*le+or*Ue,t[11]=St*S+Gt*j+Zt*Ie+or*st,t[12]=(St=u[12])*p+(Gt=u[13])*M+(Zt=u[14])*G+(or=u[15])*ke,t[13]=St*g+Gt*D+Zt*ae+or*Ke,t[14]=St*x+Gt*U+Zt*le+or*Ue,t[15]=St*S+Gt*j+Zt*Ie+or*st,t}Math.hypot||(Math.hypot=function(){for(var t=arguments,o=0,u=arguments.length;u--;)o+=t[u]*t[u];return Math.sqrt(o)});var fu,xl=as;function ic(t,o,u){var p=o[0],g=o[1],x=o[2],S=o[3];return t[0]=u[0]*p+u[4]*g+u[8]*x+u[12]*S,t[1]=u[1]*p+u[5]*g+u[9]*x+u[13]*S,t[2]=u[2]*p+u[6]*g+u[10]*x+u[14]*S,t[3]=u[3]*p+u[7]*g+u[11]*x+u[15]*S,t}fu=new Qi(3),Qi!=Float32Array&&(fu[0]=0,fu[1]=0,fu[2]=0),function(){var t=new Qi(4);Qi!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}();var Lc=(function(){var t=new Qi(2);Qi!=Float32Array&&(t[0]=0,t[1]=0)}(),function(t){function o(u){t.call(this,u,Su)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.createBucket=function(u){return new gs(u)},o.prototype.queryRadius=function(u){var p=u;return ku("circle-radius",this,p)+ku("circle-stroke-width",this,p)+Fo(this.paint.get("circle-translate"))},o.prototype.queryIntersectsFeature=function(u,p,g,x,S,M,D,U){for(var j=rl(u,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),M.angle,D),G=this.paint.get("circle-radius").evaluate(p,g)+this.paint.get("circle-stroke-width").evaluate(p,g),ae=this.paint.get("circle-pitch-alignment")==="map",le=ae?j:function(Ir,Xr){return Ir.map(function(Dn){return Ls(Dn,Xr)})}(j,U),Ie=ae?G*D:G,ke=0,Ke=x;ke<Ke.length;ke+=1)for(var Ue=0,st=Ke[ke];Ue<st.length;Ue+=1){var St=st[Ue],Gt=ae?St:Ls(St,U),Zt=Ie,or=ic([],[St.x,St.y,0,1],U);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Zt*=or[3]/M.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Zt*=M.cameraToCenterDistance/or[3]),ca(le,Gt,Zt))return!0}return!1},o}(Aa));function Ls(t,o){var u=ic([],[t.x,t.y,0,1],o);return new ie(u[0]/u[3],u[1]/u[3])}var Fl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(gs);function hu(t,o,u,p){var g=o.width,x=o.height;if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==g*x*u)throw new RangeError("mismatched image size")}else p=new Uint8Array(g*x*u);return t.width=g,t.height=x,t.data=p,t}function nl(t,o,u){var p=o.width,g=o.height;if(p!==t.width||g!==t.height){var x=hu({},{width:p,height:g},u);Ws(t,x,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,p),height:Math.min(t.height,g)},u),t.width=p,t.height=g,t.data=x.data}}function Ws(t,o,u,p,g,x){if(g.width===0||g.height===0)return o;if(g.width>t.width||g.height>t.height||u.x>t.width-g.width||u.y>t.height-g.height)throw new RangeError("out of range source coordinates for image copy");if(g.width>o.width||g.height>o.height||p.x>o.width-g.width||p.y>o.height-g.height)throw new RangeError("out of range destination coordinates for image copy");for(var S=t.data,M=o.data,D=0;D<g.height;D++)for(var U=((u.y+D)*t.width+u.x)*x,j=((p.y+D)*o.width+p.x)*x,G=0;G<g.width*x;G++)M[j+G]=S[U+G];return o}yn("HeatmapBucket",Fl,{omit:["layers"]});var pu=function(t,o){hu(this,t,1,o)};pu.prototype.resize=function(t){nl(this,t,1)},pu.prototype.clone=function(){return new pu({width:this.width,height:this.height},new Uint8Array(this.data))},pu.copy=function(t,o,u,p,g){Ws(t,o,u,p,g,1)};var Go=function(t,o){hu(this,t,4,o)};Go.prototype.resize=function(t){nl(this,t,4)},Go.prototype.replace=function(t,o){o?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t},Go.prototype.clone=function(){return new Go({width:this.width,height:this.height},new Uint8Array(this.data))},Go.copy=function(t,o,u,p,g){Ws(t,o,u,p,g,4)},yn("AlphaImage",pu),yn("RGBAImage",Go);var kc={paint:new es({"heatmap-radius":new An(pe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new An(pe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new In(pe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new _u(pe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new In(pe.paint_heatmap["heatmap-opacity"])})};function Ff(t){var o={},u=t.resolution||256,p=t.clips?t.clips.length:1,g=t.image||new Go({width:u,height:p}),x=function(Ie,ke,Ke){o[t.evaluationKey]=Ke;var Ue=t.expression.evaluate(o);g.data[Ie+ke+0]=Math.floor(255*Ue.r/Ue.a),g.data[Ie+ke+1]=Math.floor(255*Ue.g/Ue.a),g.data[Ie+ke+2]=Math.floor(255*Ue.b/Ue.a),g.data[Ie+ke+3]=Math.floor(255*Ue.a)};if(t.clips)for(var S=0,M=0;S<p;++S,M+=4*u)for(var D=0,U=0;D<u;D++,U+=4){var j=D/(u-1),G=t.clips[S];x(M,U,G.start*(1-j)+G.end*j)}else for(var ae=0,le=0;ae<u;ae++,le+=4)x(0,le,ae/(u-1));return g}var yh=function(t){function o(u){t.call(this,u,kc),this._updateColorRamp()}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.createBucket=function(u){return new Fl(u)},o.prototype._handleSpecialPaintPropertyUpdate=function(u){u==="heatmap-color"&&this._updateColorRamp()},o.prototype._updateColorRamp=function(){this.colorRamp=Ff({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},o.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},o.prototype.queryRadius=function(){return 0},o.prototype.queryIntersectsFeature=function(){return!1},o.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},o}(Aa),Bf={paint:new es({"hillshade-illumination-direction":new In(pe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new In(pe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new In(pe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new In(pe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new In(pe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new In(pe.paint_hillshade["hillshade-accent-color"])})},qh=function(t){function o(u){t.call(this,u,Bf)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},o}(Aa),Nf=Ia([{name:"a_pos",components:2,type:"Int16"}],4).members,Cs=_h,of=_h;function _h(t,o,u){u=u||2;var p,g,x,S,M,D,U,j=o&&o.length,G=j?o[0]*u:t.length,ae=Kh(t,0,G,u,!0),le=[];if(!ae||ae.next===ae.prev)return le;if(j&&(ae=function(ke,Ke,Ue,st){var St,Gt,Zt,or=[];for(St=0,Gt=Ke.length;St<Gt;St++)(Zt=Kh(ke,Ke[St]*st,St<Gt-1?Ke[St+1]*st:ke.length,st,!1))===Zt.next&&(Zt.steiner=!0),or.push(Up(Zt));for(or.sort(Np),St=0;St<or.length;St++)wd(or[St],Ue),Ue=bl(Ue,Ue.next);return Ue}(t,o,ae,u)),t.length>80*u){p=x=t[0],g=S=t[1];for(var Ie=u;Ie<G;Ie+=u)(M=t[Ie])<p&&(p=M),(D=t[Ie+1])<g&&(g=D),M>x&&(x=M),D>S&&(S=D);U=(U=Math.max(x-p,S-g))!==0?1/U:0}return Dc(ae,le,u,p,g,U),le}function Kh(t,o,u,p,g){var x,S;if(g===jf(t,o,u,p)>0)for(x=o;x<u;x+=p)S=Bc(x,t[x],t[x+1],S);else for(x=u-p;x>=o;x-=p)S=Bc(x,t[x],t[x+1],S);return S&&xh(S,S.next)&&(ac(S),S=S.next),S}function bl(t,o){if(!t)return t;o||(o=t);var u,p=t;do if(u=!1,p.steiner||!xh(p,p.next)&&Bo(p.prev,p,p.next)!==0)p=p.next;else{if(ac(p),(p=o=p.prev)===p.next)break;u=!0}while(u||p!==o);return o}function Dc(t,o,u,p,g,x,S){if(t){!S&&x&&function(j,G,ae,le){var Ie=j;do Ie.z===null&&(Ie.z=Qh(Ie.x,Ie.y,G,ae,le)),Ie.prevZ=Ie.prev,Ie.nextZ=Ie.next,Ie=Ie.next;while(Ie!==j);Ie.prevZ.nextZ=null,Ie.prevZ=null,function(ke){var Ke,Ue,st,St,Gt,Zt,or,Ir,Xr=1;do{for(Ue=ke,ke=null,Gt=null,Zt=0;Ue;){for(Zt++,st=Ue,or=0,Ke=0;Ke<Xr&&(or++,st=st.nextZ);Ke++);for(Ir=Xr;or>0||Ir>0&&st;)or!==0&&(Ir===0||!st||Ue.z<=st.z)?(St=Ue,Ue=Ue.nextZ,or--):(St=st,st=st.nextZ,Ir--),Gt?Gt.nextZ=St:ke=St,St.prevZ=Gt,Gt=St;Ue=st}Gt.nextZ=null,Xr*=2}while(Zt>1)}(Ie)}(t,p,g,x);for(var M,D,U=t;t.prev!==t.next;)if(M=t.prev,D=t.next,x?Ad(t,p,g,x):$h(t))o.push(M.i/u),o.push(t.i/u),o.push(D.i/u),ac(t),t=D.next,U=D.next;else if((t=D)===U){S?S===1?Dc(t=sf(bl(t),o,u),o,u,p,g,x,2):S===2&&Jh(t,o,u,p,g,x):Dc(bl(t),o,u,p,g,x,1);break}}}function $h(t){var o=t.prev,u=t,p=t.next;if(Bo(o,u,p)>=0)return!1;for(var g=t.next.next;g!==t.prev;){if(Fc(o.x,o.y,u.x,u.y,p.x,p.y,g.x,g.y)&&Bo(g.prev,g,g.next)>=0)return!1;g=g.next}return!0}function Ad(t,o,u,p){var g=t.prev,x=t,S=t.next;if(Bo(g,x,S)>=0)return!1;for(var M=g.x>x.x?g.x>S.x?g.x:S.x:x.x>S.x?x.x:S.x,D=g.y>x.y?g.y>S.y?g.y:S.y:x.y>S.y?x.y:S.y,U=Qh(g.x<x.x?g.x<S.x?g.x:S.x:x.x<S.x?x.x:S.x,g.y<x.y?g.y<S.y?g.y:S.y:x.y<S.y?x.y:S.y,o,u,p),j=Qh(M,D,o,u,p),G=t.prevZ,ae=t.nextZ;G&&G.z>=U&&ae&&ae.z<=j;){if(G!==t.prev&&G!==t.next&&Fc(g.x,g.y,x.x,x.y,S.x,S.y,G.x,G.y)&&Bo(G.prev,G,G.next)>=0||(G=G.prevZ,ae!==t.prev&&ae!==t.next&&Fc(g.x,g.y,x.x,x.y,S.x,S.y,ae.x,ae.y)&&Bo(ae.prev,ae,ae.next)>=0))return!1;ae=ae.nextZ}for(;G&&G.z>=U;){if(G!==t.prev&&G!==t.next&&Fc(g.x,g.y,x.x,x.y,S.x,S.y,G.x,G.y)&&Bo(G.prev,G,G.next)>=0)return!1;G=G.prevZ}for(;ae&&ae.z<=j;){if(ae!==t.prev&&ae!==t.next&&Fc(g.x,g.y,x.x,x.y,S.x,S.y,ae.x,ae.y)&&Bo(ae.prev,ae,ae.next)>=0)return!1;ae=ae.nextZ}return!0}function sf(t,o,u){var p=t;do{var g=p.prev,x=p.next.next;!xh(g,x)&&Zp(g,p,p.next,x)&&Uf(g,x)&&Uf(x,g)&&(o.push(g.i/u),o.push(p.i/u),o.push(x.i/u),ac(p),ac(p.next),p=t=x),p=p.next}while(p!==t);return bl(p)}function Jh(t,o,u,p,g,x){var S=t;do{for(var M=S.next.next;M!==S.prev;){if(S.i!==M.i&&Td(S,M)){var D=Zf(S,M);return S=bl(S,S.next),D=bl(D,D.next),Dc(S,o,u,p,g,x),void Dc(D,o,u,p,g,x)}M=M.next}S=S.next}while(S!==t)}function Np(t,o){return t.x-o.x}function wd(t,o){if(o=function(p,g){var x,S=g,M=p.x,D=p.y,U=-1/0;do{if(D<=S.y&&D>=S.next.y&&S.next.y!==S.y){var j=S.x+(D-S.y)*(S.next.x-S.x)/(S.next.y-S.y);if(j<=M&&j>U){if(U=j,j===M){if(D===S.y)return S;if(D===S.next.y)return S.next}x=S.x<S.next.x?S:S.next}}S=S.next}while(S!==g);if(!x)return null;if(M===U)return x;var G,ae=x,le=x.x,Ie=x.y,ke=1/0;S=x;do M>=S.x&&S.x>=le&&M!==S.x&&Fc(D<Ie?M:U,D,le,Ie,D<Ie?U:M,D,S.x,S.y)&&(G=Math.abs(D-S.y)/(M-S.x),Uf(S,p)&&(G<ke||G===ke&&(S.x>x.x||S.x===x.x&&zp(x,S)))&&(x=S,ke=G)),S=S.next;while(S!==ae);return x}(t,o)){var u=Zf(o,t);bl(o,o.next),bl(u,u.next)}}function zp(t,o){return Bo(t.prev,t,o.prev)<0&&Bo(o.next,t,t.next)<0}function Qh(t,o,u,p,g){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-u)*g)|t<<8))|t<<4))|t<<2))|t<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=32767*(o-p)*g)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function Up(t){var o=t,u=t;do(o.x<u.x||o.x===u.x&&o.y<u.y)&&(u=o),o=o.next;while(o!==t);return u}function Fc(t,o,u,p,g,x,S,M){return(g-S)*(o-M)-(t-S)*(x-M)>=0&&(t-S)*(p-M)-(u-S)*(o-M)>=0&&(u-S)*(x-M)-(g-S)*(p-M)>=0}function Td(t,o){return t.next.i!==o.i&&t.prev.i!==o.i&&!function(u,p){var g=u;do{if(g.i!==u.i&&g.next.i!==u.i&&g.i!==p.i&&g.next.i!==p.i&&Zp(g,g.next,u,p))return!0;g=g.next}while(g!==u);return!1}(t,o)&&(Uf(t,o)&&Uf(o,t)&&function(u,p){var g=u,x=!1,S=(u.x+p.x)/2,M=(u.y+p.y)/2;do g.y>M!=g.next.y>M&&g.next.y!==g.y&&S<(g.next.x-g.x)*(M-g.y)/(g.next.y-g.y)+g.x&&(x=!x),g=g.next;while(g!==u);return x}(t,o)&&(Bo(t.prev,t,o.prev)||Bo(t,o.prev,o))||xh(t,o)&&Bo(t.prev,t,t.next)>0&&Bo(o.prev,o,o.next)>0)}function Bo(t,o,u){return(o.y-t.y)*(u.x-o.x)-(o.x-t.x)*(u.y-o.y)}function xh(t,o){return t.x===o.x&&t.y===o.y}function Zp(t,o,u,p){var g=zf(Bo(t,o,u)),x=zf(Bo(t,o,p)),S=zf(Bo(u,p,t)),M=zf(Bo(u,p,o));return g!==x&&S!==M||!(g!==0||!bh(t,u,o))||!(x!==0||!bh(t,p,o))||!(S!==0||!bh(u,t,p))||!(M!==0||!bh(u,o,p))}function bh(t,o,u){return o.x<=Math.max(t.x,u.x)&&o.x>=Math.min(t.x,u.x)&&o.y<=Math.max(t.y,u.y)&&o.y>=Math.min(t.y,u.y)}function zf(t){return t>0?1:t<0?-1:0}function Uf(t,o){return Bo(t.prev,t,t.next)<0?Bo(t,o,t.next)>=0&&Bo(t,t.prev,o)>=0:Bo(t,o,t.prev)<0||Bo(t,t.next,o)<0}function Zf(t,o){var u=new uf(t.i,t.x,t.y),p=new uf(o.i,o.x,o.y),g=t.next,x=o.prev;return t.next=o,o.prev=t,u.next=g,g.prev=u,p.next=u,u.prev=p,x.next=p,p.prev=x,p}function Bc(t,o,u,p){var g=new uf(t,o,u);return p?(g.next=p.next,g.prev=p,p.next.prev=g,p.next=g):(g.prev=g,g.next=g),g}function ac(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function uf(t,o,u){this.i=t,this.x=o,this.y=u,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function jf(t,o,u,p){for(var g=0,x=o,S=u-p;x<u;x+=p)g+=(t[S]-t[x])*(t[x+1]+t[S+1]),S=x;return g}function Eh(t,o,u,p,g){(function x(S,M,D,U,j){for(;U>D;){if(U-D>600){var G=U-D+1,ae=M-D+1,le=Math.log(G),Ie=.5*Math.exp(2*le/3),ke=.5*Math.sqrt(le*Ie*(G-Ie)/G)*(ae-G/2<0?-1:1);x(S,M,Math.max(D,Math.floor(M-ae*Ie/G+ke)),Math.min(U,Math.floor(M+(G-ae)*Ie/G+ke)),j)}var Ke=S[M],Ue=D,st=U;for(oc(S,D,M),j(S[U],Ke)>0&&oc(S,D,U);Ue<st;){for(oc(S,Ue,st),Ue++,st--;j(S[Ue],Ke)<0;)Ue++;for(;j(S[st],Ke)>0;)st--}j(S[D],Ke)===0?oc(S,D,st):oc(S,++st,U),st<=M&&(D=st+1),M<=st&&(U=st-1)}})(t,o,u||0,p||t.length-1,g||Sh)}function oc(t,o,u){var p=t[o];t[o]=t[u],t[u]=p}function Sh(t,o){return t<o?-1:t>o?1:0}function El(t,o){var u=t.length;if(u<=1)return[t];for(var p,g,x=[],S=0;S<u;S++){var M=yr(t[S]);M!==0&&(t[S].area=Math.abs(M),g===void 0&&(g=M<0),g===M<0?(p&&x.push(p),p=[t[S]]):p.push(t[S]))}if(p&&x.push(p),o>1)for(var D=0;D<x.length;D++)x[D].length<=o||(Eh(x[D],o,1,x[D].length-1,Ch),x[D]=x[D].slice(0,o));return x}function Ch(t,o){return o.area-t.area}function lf(t,o,u){for(var p=u.patternDependencies,g=!1,x=0,S=o;x<S.length;x+=1){var M=S[x].paint.get(t+"-pattern");M.isConstant()||(g=!0);var D=M.constantOr(null);D&&(g=!0,p[D.to]=!0,p[D.from]=!0)}return g}function cf(t,o,u,p,g){for(var x=g.patternDependencies,S=0,M=o;S<M.length;S+=1){var D=M[S],U=D.paint.get(t+"-pattern").value;if(U.kind!=="constant"){var j=U.evaluate({zoom:p-1},u,{},g.availableImages),G=U.evaluate({zoom:p},u,{},g.availableImages),ae=U.evaluate({zoom:p+1},u,{},g.availableImages);G=G&&G.name?G.name:G,ae=ae&&ae.name?ae.name:ae,x[j=j&&j.name?j.name:j]=!0,x[G]=!0,x[ae]=!0,u.patterns[D.id]={min:j,mid:G,max:ae}}}return u}_h.deviation=function(t,o,u,p){var g=o&&o.length,x=Math.abs(jf(t,0,g?o[0]*u:t.length,u));if(g)for(var S=0,M=o.length;S<M;S++)x-=Math.abs(jf(t,o[S]*u,S<M-1?o[S+1]*u:t.length,u));var D=0;for(S=0;S<p.length;S+=3){var U=p[S]*u,j=p[S+1]*u,G=p[S+2]*u;D+=Math.abs((t[U]-t[G])*(t[j+1]-t[U+1])-(t[U]-t[j])*(t[G+1]-t[U+1]))}return x===0&&D===0?0:Math.abs((D-x)/x)},_h.flatten=function(t){for(var o=t[0][0].length,u={vertices:[],holes:[],dimensions:o},p=0,g=0;g<t.length;g++){for(var x=0;x<t[g].length;x++)for(var S=0;S<o;S++)u.vertices.push(t[g][x][S]);g>0&&u.holes.push(p+=t[g-1].length)}return u},Cs.default=of;var ru=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Rl,this.indexArray=new el,this.indexArray2=new Vs,this.programConfigurations=new Wn(t.layers,t.zoom),this.segments=new he,this.segments2=new he,this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};ru.prototype.populate=function(t,o,u){this.hasPattern=lf("fill",this.layers,o);for(var p=this.layers[0].layout.get("fill-sort-key"),g=[],x=0,S=t;x<S.length;x+=1){var M=S[x],D=M.feature,U=M.id,j=M.index,G=M.sourceLayerIndex,ae=this.layers[0]._featureFilter.needGeometry,le=vo(D,ae);if(this.layers[0]._featureFilter.filter(new Li(this.zoom),le,u)){var Ie=p?p.evaluate(le,{},u,o.availableImages):void 0,ke={id:U,properties:D.properties,type:D.type,sourceLayerIndex:G,index:j,geometry:ae?le.geometry:to(D),patterns:{},sortKey:Ie};g.push(ke)}}p&&g.sort(function(Ir,Xr){return Ir.sortKey-Xr.sortKey});for(var Ke=0,Ue=g;Ke<Ue.length;Ke+=1){var st=Ue[Ke],St=st.geometry,Gt=st.index,Zt=st.sourceLayerIndex;if(this.hasPattern){var or=cf("fill",this.layers,st,this.zoom,o);this.patternFeatures.push(or)}else this.addFeature(st,St,Gt,u,{});o.featureIndex.insert(t[Gt].feature,St,Gt,Zt,this.index)}},ru.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},ru.prototype.addFeatures=function(t,o,u){for(var p=0,g=this.patternFeatures;p<g.length;p+=1){var x=g[p];this.addFeature(x,x.geometry,x.index,o,u)}},ru.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},ru.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ru.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Nf),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0},ru.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},ru.prototype.addFeature=function(t,o,u,p,g){for(var x=0,S=El(o,500);x<S.length;x+=1){for(var M=S[x],D=0,U=0,j=M;U<j.length;U+=1)D+=j[U].length;for(var G=this.segments.prepareSegment(D,this.layoutVertexArray,this.indexArray),ae=G.vertexLength,le=[],Ie=[],ke=0,Ke=M;ke<Ke.length;ke+=1){var Ue=Ke[ke];if(Ue.length!==0){Ue!==M[0]&&Ie.push(le.length/2);var st=this.segments2.prepareSegment(Ue.length,this.layoutVertexArray,this.indexArray2),St=st.vertexLength;this.layoutVertexArray.emplaceBack(Ue[0].x,Ue[0].y),this.indexArray2.emplaceBack(St+Ue.length-1,St),le.push(Ue[0].x),le.push(Ue[0].y);for(var Gt=1;Gt<Ue.length;Gt++)this.layoutVertexArray.emplaceBack(Ue[Gt].x,Ue[Gt].y),this.indexArray2.emplaceBack(St+Gt-1,St+Gt),le.push(Ue[Gt].x),le.push(Ue[Gt].y);st.vertexLength+=Ue.length,st.primitiveLength+=Ue.length}}for(var Zt=Cs(le,Ie),or=0;or<Zt.length;or+=3)this.indexArray.emplaceBack(ae+Zt[or],ae+Zt[or+1],ae+Zt[or+2]);G.vertexLength+=D,G.primitiveLength+=Zt.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,g,p)},yn("FillBucket",ru,{omit:["layers","patternFeatures"]});var ff=new es({"fill-sort-key":new An(pe.layout_fill["fill-sort-key"])}),hf={paint:new es({"fill-antialias":new In(pe.paint_fill["fill-antialias"]),"fill-opacity":new An(pe.paint_fill["fill-opacity"]),"fill-color":new An(pe.paint_fill["fill-color"]),"fill-outline-color":new An(pe.paint_fill["fill-outline-color"]),"fill-translate":new In(pe.paint_fill["fill-translate"]),"fill-translate-anchor":new In(pe.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ql(pe.paint_fill["fill-pattern"])}),layout:ff},Vf=function(t){function o(u){t.call(this,u,hf)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.recalculate=function(u,p){t.prototype.recalculate.call(this,u,p);var g=this.paint._values["fill-outline-color"];g.value.kind==="constant"&&g.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},o.prototype.createBucket=function(u){return new ru(u)},o.prototype.queryRadius=function(){return Fo(this.paint.get("fill-translate"))},o.prototype.queryIntersectsFeature=function(u,p,g,x,S,M,D){return Os(rl(u,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),M.angle,D),x)},o.prototype.isTileClipped=function(){return!0},o}(Aa),Gf=Ia([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,Hf=il;function il(t,o,u,p,g){this.properties={},this.extent=u,this.type=0,this._pbf=t,this._geometry=-1,this._keys=p,this._values=g,t.readFields(Nc,this,o)}function Nc(t,o,u){t==1?o.id=u.readVarint():t==2?function(p,g){for(var x=p.readVarint()+p.pos;p.pos<x;){var S=g._keys[p.readVarint()],M=g._values[p.readVarint()];g.properties[S]=M}}(u,o):t==3?o.type=u.readVarint():t==4&&(o._geometry=u.pos)}function jp(t){for(var o,u,p=0,g=0,x=t.length,S=x-1;g<x;S=g++)p+=((u=t[S]).x-(o=t[g]).x)*(o.y+u.y);return p}il.types=["Unknown","Point","LineString","Polygon"],il.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var o,u=t.readVarint()+t.pos,p=1,g=0,x=0,S=0,M=[];t.pos<u;){if(g<=0){var D=t.readVarint();p=7&D,g=D>>3}if(g--,p===1||p===2)x+=t.readSVarint(),S+=t.readSVarint(),p===1&&(o&&M.push(o),o=[]),o.push(new ie(x,S));else{if(p!==7)throw new Error("unknown command "+p);o&&o.push(o[0].clone())}}return o&&M.push(o),M},il.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var o=t.readVarint()+t.pos,u=1,p=0,g=0,x=0,S=1/0,M=-1/0,D=1/0,U=-1/0;t.pos<o;){if(p<=0){var j=t.readVarint();u=7&j,p=j>>3}if(p--,u===1||u===2)(g+=t.readSVarint())<S&&(S=g),g>M&&(M=g),(x+=t.readSVarint())<D&&(D=x),x>U&&(U=x);else if(u!==7)throw new Error("unknown command "+u)}return[S,D,M,U]},il.prototype.toGeoJSON=function(t,o,u){var p,g,x=this.extent*Math.pow(2,u),S=this.extent*t,M=this.extent*o,D=this.loadGeometry(),U=il.types[this.type];function j(le){for(var Ie=0;Ie<le.length;Ie++){var ke=le[Ie];le[Ie]=[360*(ke.x+S)/x-180,360/Math.PI*Math.atan(Math.exp((180-360*(ke.y+M)/x)*Math.PI/180))-90]}}switch(this.type){case 1:var G=[];for(p=0;p<D.length;p++)G[p]=D[p][0];j(D=G);break;case 2:for(p=0;p<D.length;p++)j(D[p]);break;case 3:for(D=function(le){var Ie=le.length;if(Ie<=1)return[le];for(var ke,Ke,Ue=[],st=0;st<Ie;st++){var St=jp(le[st]);St!==0&&(Ke===void 0&&(Ke=St<0),Ke===St<0?(ke&&Ue.push(ke),ke=[le[st]]):ke.push(le[st]))}return ke&&Ue.push(ke),Ue}(D),p=0;p<D.length;p++)for(g=0;g<D[p].length;g++)j(D[p][g])}D.length===1?D=D[0]:U="Multi"+U;var ae={type:"Feature",geometry:{type:U,coordinates:D},properties:this.properties};return"id"in this&&(ae.id=this.id),ae};var Ah=Vp;function Vp(t,o){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Md,this,o),this.length=this._features.length}function Md(t,o,u){t===15?o.version=u.readVarint():t===1?o.name=u.readString():t===5?o.extent=u.readVarint():t===2?o._features.push(u.pos):t===3?o._keys.push(u.readString()):t===4&&o._values.push(function(p){for(var g=null,x=p.readVarint()+p.pos;p.pos<x;){var S=p.readVarint()>>3;g=S===1?p.readString():S===2?p.readFloat():S===3?p.readDouble():S===4?p.readVarint64():S===5?p.readVarint():S===6?p.readSVarint():S===7?p.readBoolean():null}return g}(u))}function yv(t,o,u){if(t===3){var p=new Ah(u,u.readVarint()+u.pos);p.length&&(o[p.name]=p)}}Vp.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var o=this._pbf.readVarint()+this._pbf.pos;return new Hf(this._pbf,o,this.extent,this._keys,this._values)};var Lr={VectorTile:function(t,o){this.layers=t.readFields(yv,{},o)},VectorTileFeature:Hf,VectorTileLayer:Ah},Gp=Lr.VectorTileFeature.types,$t=Math.pow(2,13);function pf(t,o,u,p,g,x,S,M){t.emplaceBack(o,u,2*Math.floor(p*$t)+S,g*$t*2,x*$t*2,Math.round(M))}var al=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Qs,this.indexArray=new el,this.programConfigurations=new Wn(t.layers,t.zoom),this.segments=new he,this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};function ep(t,o){return t.x===o.x&&(t.x<0||t.x>8192)||t.y===o.y&&(t.y<0||t.y>8192)}al.prototype.populate=function(t,o,u){this.features=[],this.hasPattern=lf("fill-extrusion",this.layers,o);for(var p=0,g=t;p<g.length;p+=1){var x=g[p],S=x.feature,M=x.id,D=x.index,U=x.sourceLayerIndex,j=this.layers[0]._featureFilter.needGeometry,G=vo(S,j);if(this.layers[0]._featureFilter.filter(new Li(this.zoom),G,u)){var ae={id:M,sourceLayerIndex:U,index:D,geometry:j?G.geometry:to(S),properties:S.properties,type:S.type,patterns:{}};this.hasPattern?this.features.push(cf("fill-extrusion",this.layers,ae,this.zoom,o)):this.addFeature(ae,ae.geometry,D,u,{}),o.featureIndex.insert(S,ae.geometry,D,U,this.index,!0)}}},al.prototype.addFeatures=function(t,o,u){for(var p=0,g=this.features;p<g.length;p+=1){var x=g[p];this.addFeature(x,x.geometry,x.index,o,u)}},al.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},al.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},al.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},al.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Gf),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},al.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},al.prototype.addFeature=function(t,o,u,p,g){for(var x=0,S=El(o,500);x<S.length;x+=1){for(var M=S[x],D=0,U=0,j=M;U<j.length;U+=1)D+=j[U].length;for(var G=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),ae=0,le=M;ae<le.length;ae+=1){var Ie=le[ae];if(Ie.length!==0&&!((ei=Ie).every(function(Ei){return Ei.x<0})||ei.every(function(Ei){return Ei.x>8192})||ei.every(function(Ei){return Ei.y<0})||ei.every(function(Ei){return Ei.y>8192})))for(var ke=0,Ke=0;Ke<Ie.length;Ke++){var Ue=Ie[Ke];if(Ke>=1){var st=Ie[Ke-1];if(!ep(Ue,st)){G.vertexLength+4>he.MAX_VERTEX_ARRAY_LENGTH&&(G=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var St=Ue.sub(st)._perp()._unit(),Gt=st.dist(Ue);ke+Gt>32768&&(ke=0),pf(this.layoutVertexArray,Ue.x,Ue.y,St.x,St.y,0,0,ke),pf(this.layoutVertexArray,Ue.x,Ue.y,St.x,St.y,0,1,ke),pf(this.layoutVertexArray,st.x,st.y,St.x,St.y,0,0,ke+=Gt),pf(this.layoutVertexArray,st.x,st.y,St.x,St.y,0,1,ke);var Zt=G.vertexLength;this.indexArray.emplaceBack(Zt,Zt+2,Zt+1),this.indexArray.emplaceBack(Zt+1,Zt+2,Zt+3),G.vertexLength+=4,G.primitiveLength+=2}}}}if(G.vertexLength+D>he.MAX_VERTEX_ARRAY_LENGTH&&(G=this.segments.prepareSegment(D,this.layoutVertexArray,this.indexArray)),Gp[t.type]==="Polygon"){for(var or=[],Ir=[],Xr=G.vertexLength,Dn=0,ln=M;Dn<ln.length;Dn+=1){var Un=ln[Dn];if(Un.length!==0){Un!==M[0]&&Ir.push(or.length/2);for(var gn=0;gn<Un.length;gn++){var ki=Un[gn];pf(this.layoutVertexArray,ki.x,ki.y,0,0,1,1,0),or.push(ki.x),or.push(ki.y)}}}for(var ii=Cs(or,Ir),Cn=0;Cn<ii.length;Cn+=3)this.indexArray.emplaceBack(Xr+ii[Cn],Xr+ii[Cn+2],Xr+ii[Cn+1]);G.primitiveLength+=ii.length/3,G.vertexLength+=D}}var ei;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,g,p)},yn("FillExtrusionBucket",al,{omit:["layers","features"]});var Hp={paint:new es({"fill-extrusion-opacity":new In(pe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new An(pe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new In(pe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new In(pe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ql(pe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new An(pe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new An(pe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new In(pe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},ol=function(t){function o(u){t.call(this,u,Hp)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.createBucket=function(u){return new al(u)},o.prototype.queryRadius=function(){return Fo(this.paint.get("fill-extrusion-translate"))},o.prototype.is3D=function(){return!0},o.prototype.queryIntersectsFeature=function(u,p,g,x,S,M,D,U){var j=rl(u,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),M.angle,D),G=this.paint.get("fill-extrusion-height").evaluate(p,g),ae=this.paint.get("fill-extrusion-base").evaluate(p,g),le=function(ke,Ke,Ue,st){for(var St=[],Gt=0,Zt=ke;Gt<Zt.length;Gt+=1){var or=Zt[Gt],Ir=[or.x,or.y,0,1];ic(Ir,Ir,Ke),St.push(new ie(Ir[0]/Ir[3],Ir[1]/Ir[3]))}return St}(j,U),Ie=function(ke,Ke,Ue,st){for(var St=[],Gt=[],Zt=st[8]*Ke,or=st[9]*Ke,Ir=st[10]*Ke,Xr=st[11]*Ke,Dn=st[8]*Ue,ln=st[9]*Ue,Un=st[10]*Ue,gn=st[11]*Ue,ki=0,ii=ke;ki<ii.length;ki+=1){for(var Cn=[],ei=[],Ei=0,ta=ii[ki];Ei<ta.length;Ei+=1){var Zn=ta[Ei],ua=Zn.x,ro=Zn.y,Io=st[0]*ua+st[4]*ro+st[12],So=st[1]*ua+st[5]*ro+st[13],fo=st[2]*ua+st[6]*ro+st[14],Oo=st[3]*ua+st[7]*ro+st[15],Ea=fo+Ir,cs=Oo+Xr,Mi=Io+Dn,_s=So+ln,Xs=fo+Un,No=Oo+gn,ee=new ie((Io+Zt)/cs,(So+or)/cs);ee.z=Ea/cs,Cn.push(ee);var Wi=new ie(Mi/No,_s/No);Wi.z=Xs/No,ei.push(Wi)}St.push(Cn),Gt.push(ei)}return[St,Gt]}(x,ae,G,U);return function(ke,Ke,Ue){var st=1/0;Os(Ue,Ke)&&(st=sc(Ue,Ke[0]));for(var St=0;St<Ke.length;St++)for(var Gt=Ke[St],Zt=ke[St],or=0;or<Gt.length-1;or++){var Ir=Gt[or],Xr=[Ir,Gt[or+1],Zt[or+1],Zt[or],Ir];Va(Ue,Xr)&&(st=Math.min(st,sc(Ue,Xr)))}return st!==1/0&&st}(Ie[0],Ie[1],le)},o}(Aa);function df(t,o){return t.x*o.x+t.y*o.y}function sc(t,o){if(t.length===1){for(var u,p=0,g=o[p++];!u||g.equals(u);)if(!(u=o[p++]))return 1/0;for(;p<o.length;p++){var x=o[p],S=t[0],M=u.sub(g),D=x.sub(g),U=S.sub(g),j=df(M,M),G=df(M,D),ae=df(D,D),le=df(U,M),Ie=df(U,D),ke=j*ae-G*G,Ke=(ae*le-G*Ie)/ke,Ue=(j*Ie-G*le)/ke,st=g.z*(1-Ke-Ue)+u.z*Ke+x.z*Ue;if(isFinite(st))return st}return 1/0}for(var St=1/0,Gt=0,Zt=o;Gt<Zt.length;Gt+=1)St=Math.min(St,Zt[Gt].z);return St}var Du=Ia([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,Wp=Ia([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,tp=Lr.VectorTileFeature.types,Wf=Math.cos(Math.PI/180*37.5),wh=Math.pow(2,14)/.5,ya=function(t){var o=this;this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(u){o.gradients[u.id]={}}),this.layoutVertexArray=new Do,this.layoutVertexArray2=new gl,this.indexArray=new el,this.programConfigurations=new Wn(t.layers,t.zoom),this.segments=new he,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};ya.prototype.populate=function(t,o,u){this.hasPattern=lf("line",this.layers,o);for(var p=this.layers[0].layout.get("line-sort-key"),g=[],x=0,S=t;x<S.length;x+=1){var M=S[x],D=M.feature,U=M.id,j=M.index,G=M.sourceLayerIndex,ae=this.layers[0]._featureFilter.needGeometry,le=vo(D,ae);if(this.layers[0]._featureFilter.filter(new Li(this.zoom),le,u)){var Ie=p?p.evaluate(le,{},u):void 0,ke={id:U,properties:D.properties,type:D.type,sourceLayerIndex:G,index:j,geometry:ae?le.geometry:to(D),patterns:{},sortKey:Ie};g.push(ke)}}p&&g.sort(function(Ir,Xr){return Ir.sortKey-Xr.sortKey});for(var Ke=0,Ue=g;Ke<Ue.length;Ke+=1){var st=Ue[Ke],St=st.geometry,Gt=st.index,Zt=st.sourceLayerIndex;if(this.hasPattern){var or=cf("line",this.layers,st,this.zoom,o);this.patternFeatures.push(or)}else this.addFeature(st,St,Gt,u,{});o.featureIndex.insert(t[Gt].feature,St,Gt,Zt,this.index)}},ya.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},ya.prototype.addFeatures=function(t,o,u){for(var p=0,g=this.patternFeatures;p<g.length;p+=1){var x=g[p];this.addFeature(x,x.geometry,x.index,o,u)}},ya.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},ya.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ya.prototype.upload=function(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Wp)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Du),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},ya.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},ya.prototype.lineFeatureClips=function(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}},ya.prototype.addFeature=function(t,o,u,p,g){var x=this.layers[0].layout,S=x.get("line-join").evaluate(t,{}),M=x.get("line-cap"),D=x.get("line-miter-limit"),U=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(var j=0,G=o;j<G.length;j+=1)this.addLine(G[j],t,S,M,D,U);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,g,p)},ya.prototype.addLine=function(t,o,u,p,g,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var S=0;S<t.length-1;S++)this.totalDistance+=t[S].dist(t[S+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var M=tp[o.type]==="Polygon",D=t.length;D>=2&&t[D-1].equals(t[D-2]);)D--;for(var U=0;U<D-1&&t[U].equals(t[U+1]);)U++;if(!(D<(M?3:2))){u==="bevel"&&(g=1.05);var j,G=this.overscaling<=16?122880/(512*this.overscaling):0,ae=this.segments.prepareSegment(10*D,this.layoutVertexArray,this.indexArray),le=void 0,Ie=void 0,ke=void 0,Ke=void 0;this.e1=this.e2=-1,M&&(Ke=t[U].sub(j=t[D-2])._unit()._perp());for(var Ue=U;Ue<D;Ue++)if(!(Ie=Ue===D-1?M?t[U+1]:void 0:t[Ue+1])||!t[Ue].equals(Ie)){Ke&&(ke=Ke),j&&(le=j),j=t[Ue],Ke=Ie?Ie.sub(j)._unit()._perp():ke;var st=(ke=ke||Ke).add(Ke);st.x===0&&st.y===0||st._unit();var St=ke.x*Ke.x+ke.y*Ke.y,Gt=st.x*Ke.x+st.y*Ke.y,Zt=Gt!==0?1/Gt:1/0,or=2*Math.sqrt(2-2*Gt),Ir=Gt<Wf&&le&&Ie,Xr=ke.x*Ke.y-ke.y*Ke.x>0;if(Ir&&Ue>U){var Dn=j.dist(le);if(Dn>2*G){var ln=j.sub(j.sub(le)._mult(G/Dn)._round());this.updateDistance(le,ln),this.addCurrentVertex(ln,ke,0,0,ae),le=ln}}var Un=le&&Ie,gn=Un?u:M?"butt":p;if(Un&&gn==="round"&&(Zt<x?gn="miter":Zt<=2&&(gn="fakeround")),gn==="miter"&&Zt>g&&(gn="bevel"),gn==="bevel"&&(Zt>2&&(gn="flipbevel"),Zt<g&&(gn="miter")),le&&this.updateDistance(le,j),gn==="miter")st._mult(Zt),this.addCurrentVertex(j,st,0,0,ae);else if(gn==="flipbevel"){if(Zt>100)st=Ke.mult(-1);else{var ki=Zt*ke.add(Ke).mag()/ke.sub(Ke).mag();st._perp()._mult(ki*(Xr?-1:1))}this.addCurrentVertex(j,st,0,0,ae),this.addCurrentVertex(j,st.mult(-1),0,0,ae)}else if(gn==="bevel"||gn==="fakeround"){var ii=-Math.sqrt(Zt*Zt-1),Cn=Xr?ii:0,ei=Xr?0:ii;if(le&&this.addCurrentVertex(j,ke,Cn,ei,ae),gn==="fakeround")for(var Ei=Math.round(180*or/Math.PI/20),ta=1;ta<Ei;ta++){var Zn=ta/Ei;if(Zn!==.5){var ua=Zn-.5;Zn+=Zn*ua*(Zn-1)*((1.0904+St*(St*(3.55645-1.43519*St)-3.2452))*ua*ua+(.848013+St*(.215638*St-1.06021)))}var ro=Ke.sub(ke)._mult(Zn)._add(ke)._unit()._mult(Xr?-1:1);this.addHalfVertex(j,ro.x,ro.y,!1,Xr,0,ae)}Ie&&this.addCurrentVertex(j,Ke,-Cn,-ei,ae)}else if(gn==="butt")this.addCurrentVertex(j,st,0,0,ae);else if(gn==="square"){var Io=le?1:-1;this.addCurrentVertex(j,st,Io,Io,ae)}else gn==="round"&&(le&&(this.addCurrentVertex(j,ke,0,0,ae),this.addCurrentVertex(j,ke,1,1,ae,!0)),Ie&&(this.addCurrentVertex(j,Ke,-1,-1,ae,!0),this.addCurrentVertex(j,Ke,0,0,ae)));if(Ir&&Ue<D-1){var So=j.dist(Ie);if(So>2*G){var fo=j.add(Ie.sub(j)._mult(G/So)._round());this.updateDistance(j,fo),this.addCurrentVertex(fo,Ke,0,0,ae),j=fo}}}}},ya.prototype.addCurrentVertex=function(t,o,u,p,g,x){x===void 0&&(x=!1);var S=o.y*p-o.x,M=-o.y-o.x*p;this.addHalfVertex(t,o.x+o.y*u,o.y-o.x*u,x,!1,u,g),this.addHalfVertex(t,S,M,x,!0,-p,g),this.distance>wh/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(t,o,u,p,g,x))},ya.prototype.addHalfVertex=function(t,o,u,p,g,x,S){var M=.5*(this.lineClips?this.scaledDistance*(wh-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t.x<<1)+(p?1:0),(t.y<<1)+(g?1:0),Math.round(63*o)+128,Math.round(63*u)+128,1+(x===0?0:x<0?-1:1)|(63&M)<<2,M>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var D=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,D),S.primitiveLength++),g?this.e2=D:this.e1=D},ya.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},ya.prototype.updateDistance=function(t,o){this.distance+=t.dist(o),this.updateScaledDistance()},yn("LineBucket",ya,{omit:["layers","patternFeatures"]});var Bl=new es({"line-cap":new In(pe.layout_line["line-cap"]),"line-join":new An(pe.layout_line["line-join"]),"line-miter-limit":new In(pe.layout_line["line-miter-limit"]),"line-round-limit":new In(pe.layout_line["line-round-limit"]),"line-sort-key":new An(pe.layout_line["line-sort-key"])}),Mo={paint:new es({"line-opacity":new An(pe.paint_line["line-opacity"]),"line-color":new An(pe.paint_line["line-color"]),"line-translate":new In(pe.paint_line["line-translate"]),"line-translate-anchor":new In(pe.paint_line["line-translate-anchor"]),"line-width":new An(pe.paint_line["line-width"]),"line-gap-width":new An(pe.paint_line["line-gap-width"]),"line-offset":new An(pe.paint_line["line-offset"]),"line-blur":new An(pe.paint_line["line-blur"]),"line-dasharray":new ms(pe.paint_line["line-dasharray"]),"line-pattern":new Ql(pe.paint_line["line-pattern"]),"line-gradient":new _u(pe.paint_line["line-gradient"])}),layout:Bl},nu=new(function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.possiblyEvaluate=function(u,p){return p=new Li(Math.floor(p.zoom),{now:p.now,fadeDuration:p.fadeDuration,zoomHistory:p.zoomHistory,transition:p.transition}),t.prototype.possiblyEvaluate.call(this,u,p)},o.prototype.evaluate=function(u,p,g,x){return p=bt({},p,{zoom:Math.floor(p.zoom)}),t.prototype.evaluate.call(this,u,p,g,x)},o}(An))(Mo.paint.properties["line-width"].specification);nu.useIntegerZoom=!0;var rp=function(t){function o(u){t.call(this,u,Mo),this.gradientVersion=0}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._handleSpecialPaintPropertyUpdate=function(u){u==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof ds,this.gradientVersion=(this.gradientVersion+1)%Ge)},o.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},o.prototype.recalculate=function(u,p){t.prototype.recalculate.call(this,u,p),this.paint._values["line-floorwidth"]=nu.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,u)},o.prototype.createBucket=function(u){return new ya(u)},o.prototype.queryRadius=function(u){var p=u,g=np(ku("line-width",this,p),ku("line-gap-width",this,p)),x=ku("line-offset",this,p);return g/2+Math.abs(x)+Fo(this.paint.get("line-translate"))},o.prototype.queryIntersectsFeature=function(u,p,g,x,S,M,D){var U=rl(u,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),M.angle,D),j=D/2*np(this.paint.get("line-width").evaluate(p,g),this.paint.get("line-gap-width").evaluate(p,g)),G=this.paint.get("line-offset").evaluate(p,g);return G&&(x=function(ae,le){for(var Ie=[],ke=new ie(0,0),Ke=0;Ke<ae.length;Ke++){for(var Ue=ae[Ke],st=[],St=0;St<Ue.length;St++){var Gt=Ue[St],Zt=Ue[St+1],or=St===0?ke:Gt.sub(Ue[St-1])._unit()._perp(),Ir=St===Ue.length-1?ke:Zt.sub(Gt)._unit()._perp(),Xr=or._add(Ir)._unit();Xr._mult(1/(Xr.x*Ir.x+Xr.y*Ir.y)),st.push(Xr._mult(le)._add(Gt))}Ie.push(st)}return Ie}(x,G*D)),function(ae,le,Ie){for(var ke=0;ke<le.length;ke++){var Ke=le[ke];if(ae.length>=3){for(var Ue=0;Ue<Ke.length;Ue++)if(tu(ae,Ke[Ue]))return!0}if(Gs(ae,Ke,Ie))return!0}return!1}(U,x,j)},o.prototype.isTileClipped=function(){return!0},o}(Aa);function np(t,o){return o>0?o+2*t:t}var ip=Ia([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Pd=Ia([{name:"a_projected_pos",components:3,type:"Float32"}],4),Id=(Ia([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Ia([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),ap=(Ia([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),Ia([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Od=Ia([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Rd(t,o,u){return t.sections.forEach(function(p){p.text=function(g,x,S){var M=x.layout.get("text-transform").evaluate(S,{});return M==="uppercase"?g=g.toLocaleUpperCase():M==="lowercase"&&(g=g.toLocaleLowerCase()),Ps.applyArabicShaping&&(g=Ps.applyArabicShaping(g)),g}(p.text,o,u)}),t}Ia([{name:"triangle",components:3,type:"Uint16"}]),Ia([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Ia([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Ia([{type:"Float32",name:"offsetX"}]),Ia([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Xf={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},Xp=function(t,o,u,p,g){var x,S,M=8*g-p-1,D=(1<<M)-1,U=D>>1,j=-7,G=u?g-1:0,ae=u?-1:1,le=t[o+G];for(G+=ae,x=le&(1<<-j)-1,le>>=-j,j+=M;j>0;x=256*x+t[o+G],G+=ae,j-=8);for(S=x&(1<<-j)-1,x>>=-j,j+=p;j>0;S=256*S+t[o+G],G+=ae,j-=8);if(x===0)x=1-U;else{if(x===D)return S?NaN:1/0*(le?-1:1);S+=Math.pow(2,p),x-=U}return(le?-1:1)*S*Math.pow(2,x-p)},op=function(t,o,u,p,g,x){var S,M,D,U=8*x-g-1,j=(1<<U)-1,G=j>>1,ae=g===23?Math.pow(2,-24)-Math.pow(2,-77):0,le=p?0:x-1,Ie=p?1:-1,ke=o<0||o===0&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(M=isNaN(o)?1:0,S=j):(S=Math.floor(Math.log(o)/Math.LN2),o*(D=Math.pow(2,-S))<1&&(S--,D*=2),(o+=S+G>=1?ae/D:ae*Math.pow(2,1-G))*D>=2&&(S++,D/=2),S+G>=j?(M=0,S=j):S+G>=1?(M=(o*D-1)*Math.pow(2,g),S+=G):(M=o*Math.pow(2,G-1)*Math.pow(2,g),S=0));g>=8;t[u+le]=255&M,le+=Ie,M/=256,g-=8);for(S=S<<g|M,U+=g;U>0;t[u+le]=255&S,le+=Ie,S/=256,U-=8);t[u+le-Ie]|=128*ke},Yf=La;function La(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}La.Varint=0,La.Fixed64=1,La.Bytes=2,La.Fixed32=5;var sp=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function uc(t){return t.type===La.Bytes?t.readVarint()+t.pos:t.pos+1}function vf(t,o,u){return u?4294967296*o+(t>>>0):4294967296*(o>>>0)+(t>>>0)}function Th(t,o,u){var p=o<=16383?1:o<=2097151?2:o<=268435455?3:Math.floor(Math.log(o)/(7*Math.LN2));u.realloc(p);for(var g=u.pos-1;g>=t;g--)u.buf[g+p]=u.buf[g]}function Yp(t,o){for(var u=0;u<t.length;u++)o.writeVarint(t[u])}function z(t,o){for(var u=0;u<t.length;u++)o.writeSVarint(t[u])}function me(t,o){for(var u=0;u<t.length;u++)o.writeFloat(t[u])}function ze(t,o){for(var u=0;u<t.length;u++)o.writeDouble(t[u])}function Ft(t,o){for(var u=0;u<t.length;u++)o.writeBoolean(t[u])}function lr(t,o){for(var u=0;u<t.length;u++)o.writeFixed32(t[u])}function Lt(t,o){for(var u=0;u<t.length;u++)o.writeSFixed32(t[u])}function er(t,o){for(var u=0;u<t.length;u++)o.writeFixed64(t[u])}function fr(t,o){for(var u=0;u<t.length;u++)o.writeSFixed64(t[u])}function _r(t,o){return(t[o]|t[o+1]<<8|t[o+2]<<16)+16777216*t[o+3]}function rr(t,o,u){t[u]=o,t[u+1]=o>>>8,t[u+2]=o>>>16,t[u+3]=o>>>24}function Sr(t,o){return(t[o]|t[o+1]<<8|t[o+2]<<16)+(t[o+3]<<24)}function Rr(t,o,u){t===1&&u.readMessage(jr,o)}function jr(t,o,u){if(t===3){var p=u.readMessage(Er,{}),g=p.width,x=p.height,S=p.left,M=p.top,D=p.advance;o.push({id:p.id,bitmap:new pu({width:g+6,height:x+6},p.bitmap),metrics:{width:g,height:x,left:S,top:M,advance:D}})}}function Er(t,o,u){t===1?o.id=u.readVarint():t===2?o.bitmap=u.readBytes():t===3?o.width=u.readVarint():t===4?o.height=u.readVarint():t===5?o.left=u.readSVarint():t===6?o.top=u.readSVarint():t===7&&(o.advance=u.readVarint())}function Mr(t){for(var o=0,u=0,p=0,g=t;p<g.length;p+=1){var x=g[p];o+=x.w*x.h,u=Math.max(u,x.w)}t.sort(function(ke,Ke){return Ke.h-ke.h});for(var S=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),u),h:1/0}],M=0,D=0,U=0,j=t;U<j.length;U+=1)for(var G=j[U],ae=S.length-1;ae>=0;ae--){var le=S[ae];if(!(G.w>le.w||G.h>le.h)){if(G.x=le.x,G.y=le.y,D=Math.max(D,G.y+G.h),M=Math.max(M,G.x+G.w),G.w===le.w&&G.h===le.h){var Ie=S.pop();ae<S.length&&(S[ae]=Ie)}else G.h===le.h?(le.x+=G.w,le.w-=G.w):G.w===le.w?(le.y+=G.h,le.h-=G.h):(S.push({x:le.x+G.w,y:le.y,w:le.w-G.w,h:G.h}),le.y+=G.h,le.h-=G.h);break}}return{w:M,h:D,fill:o/(M*D)||0}}La.prototype={destroy:function(){this.buf=null},readFields:function(t,o,u){for(u=u||this.length;this.pos<u;){var p=this.readVarint(),g=p>>3,x=this.pos;this.type=7&p,t(g,o,this),this.pos===x&&this.skip(p)}return o},readMessage:function(t,o){return this.readFields(t,o,this.readVarint()+this.pos)},readFixed32:function(){var t=_r(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Sr(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=_r(this.buf,this.pos)+4294967296*_r(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=_r(this.buf,this.pos)+4294967296*Sr(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=Xp(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Xp(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var o,u,p=this.buf;return o=127&(u=p[this.pos++]),u<128?o:(o|=(127&(u=p[this.pos++]))<<7,u<128?o:(o|=(127&(u=p[this.pos++]))<<14,u<128?o:(o|=(127&(u=p[this.pos++]))<<21,u<128?o:function(g,x,S){var M,D,U=S.buf;if(M=(112&(D=U[S.pos++]))>>4,D<128||(M|=(127&(D=U[S.pos++]))<<3,D<128)||(M|=(127&(D=U[S.pos++]))<<10,D<128)||(M|=(127&(D=U[S.pos++]))<<17,D<128)||(M|=(127&(D=U[S.pos++]))<<24,D<128)||(M|=(1&(D=U[S.pos++]))<<31,D<128))return vf(g,M,x);throw new Error("Expected varint not more than 10 bytes")}(o|=(15&(u=p[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,o=this.pos;return this.pos=t,t-o>=12&&sp?function(u,p,g){return sp.decode(u.subarray(p,g))}(this.buf,o,t):function(u,p,g){for(var x="",S=p;S<g;){var M,D,U,j=u[S],G=null,ae=j>239?4:j>223?3:j>191?2:1;if(S+ae>g)break;ae===1?j<128&&(G=j):ae===2?(192&(M=u[S+1]))==128&&(G=(31&j)<<6|63&M)<=127&&(G=null):ae===3?(D=u[S+2],(192&(M=u[S+1]))==128&&(192&D)==128&&((G=(15&j)<<12|(63&M)<<6|63&D)<=2047||G>=55296&&G<=57343)&&(G=null)):ae===4&&(D=u[S+2],U=u[S+3],(192&(M=u[S+1]))==128&&(192&D)==128&&(192&U)==128&&((G=(15&j)<<18|(63&M)<<12|(63&D)<<6|63&U)<=65535||G>=1114112)&&(G=null)),G===null?(G=65533,ae=1):G>65535&&(G-=65536,x+=String.fromCharCode(G>>>10&1023|55296),G=56320|1023&G),x+=String.fromCharCode(G),S+=ae}return x}(this.buf,o,t)},readBytes:function(){var t=this.readVarint()+this.pos,o=this.buf.subarray(this.pos,t);return this.pos=t,o},readPackedVarint:function(t,o){if(this.type!==La.Bytes)return t.push(this.readVarint(o));var u=uc(this);for(t=t||[];this.pos<u;)t.push(this.readVarint(o));return t},readPackedSVarint:function(t){if(this.type!==La.Bytes)return t.push(this.readSVarint());var o=uc(this);for(t=t||[];this.pos<o;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==La.Bytes)return t.push(this.readBoolean());var o=uc(this);for(t=t||[];this.pos<o;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==La.Bytes)return t.push(this.readFloat());var o=uc(this);for(t=t||[];this.pos<o;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==La.Bytes)return t.push(this.readDouble());var o=uc(this);for(t=t||[];this.pos<o;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==La.Bytes)return t.push(this.readFixed32());var o=uc(this);for(t=t||[];this.pos<o;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==La.Bytes)return t.push(this.readSFixed32());var o=uc(this);for(t=t||[];this.pos<o;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==La.Bytes)return t.push(this.readFixed64());var o=uc(this);for(t=t||[];this.pos<o;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==La.Bytes)return t.push(this.readSFixed64());var o=uc(this);for(t=t||[];this.pos<o;)t.push(this.readSFixed64());return t},skip:function(t){var o=7&t;if(o===La.Varint)for(;this.buf[this.pos++]>127;);else if(o===La.Bytes)this.pos=this.readVarint()+this.pos;else if(o===La.Fixed32)this.pos+=4;else{if(o!==La.Fixed64)throw new Error("Unimplemented type: "+o);this.pos+=8}},writeTag:function(t,o){this.writeVarint(t<<3|o)},realloc:function(t){for(var o=this.length||16;o<this.pos+t;)o*=2;if(o!==this.length){var u=new Uint8Array(o);u.set(this.buf),this.buf=u,this.length=o}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),rr(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),rr(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),rr(this.buf,-1&t,this.pos),rr(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),rr(this.buf,-1&t,this.pos),rr(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(o,u){var p,g;if(o>=0?(p=o%4294967296|0,g=o/4294967296|0):(g=~(-o/4294967296),4294967295^(p=~(-o%4294967296))?p=p+1|0:(p=0,g=g+1|0)),o>=18446744073709552e3||o<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");u.realloc(10),function(x,S,M){M.buf[M.pos++]=127&x|128,x>>>=7,M.buf[M.pos++]=127&x|128,x>>>=7,M.buf[M.pos++]=127&x|128,x>>>=7,M.buf[M.pos++]=127&x|128,M.buf[M.pos]=127&(x>>>=7)}(p,0,u),function(x,S){var M=(7&x)<<4;S.buf[S.pos++]|=M|((x>>>=3)?128:0),x&&(S.buf[S.pos++]=127&x|((x>>>=7)?128:0),x&&(S.buf[S.pos++]=127&x|((x>>>=7)?128:0),x&&(S.buf[S.pos++]=127&x|((x>>>=7)?128:0),x&&(S.buf[S.pos++]=127&x|((x>>>=7)?128:0),x&&(S.buf[S.pos++]=127&x)))))}(g,u)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var o=this.pos;this.pos=function(p,g,x){for(var S,M,D=0;D<g.length;D++){if((S=g.charCodeAt(D))>55295&&S<57344){if(!M){S>56319||D+1===g.length?(p[x++]=239,p[x++]=191,p[x++]=189):M=S;continue}if(S<56320){p[x++]=239,p[x++]=191,p[x++]=189,M=S;continue}S=M-55296<<10|S-56320|65536,M=null}else M&&(p[x++]=239,p[x++]=191,p[x++]=189,M=null);S<128?p[x++]=S:(S<2048?p[x++]=S>>6|192:(S<65536?p[x++]=S>>12|224:(p[x++]=S>>18|240,p[x++]=S>>12&63|128),p[x++]=S>>6&63|128),p[x++]=63&S|128)}return x}(this.buf,t,this.pos);var u=this.pos-o;u>=128&&Th(o,u,this),this.pos=o-1,this.writeVarint(u),this.pos+=u},writeFloat:function(t){this.realloc(4),op(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),op(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var o=t.length;this.writeVarint(o),this.realloc(o);for(var u=0;u<o;u++)this.buf[this.pos++]=t[u]},writeRawMessage:function(t,o){this.pos++;var u=this.pos;t(o,this);var p=this.pos-u;p>=128&&Th(u,p,this),this.pos=u-1,this.writeVarint(p),this.pos+=p},writeMessage:function(t,o,u){this.writeTag(t,La.Bytes),this.writeRawMessage(o,u)},writePackedVarint:function(t,o){o.length&&this.writeMessage(t,Yp,o)},writePackedSVarint:function(t,o){o.length&&this.writeMessage(t,z,o)},writePackedBoolean:function(t,o){o.length&&this.writeMessage(t,Ft,o)},writePackedFloat:function(t,o){o.length&&this.writeMessage(t,me,o)},writePackedDouble:function(t,o){o.length&&this.writeMessage(t,ze,o)},writePackedFixed32:function(t,o){o.length&&this.writeMessage(t,lr,o)},writePackedSFixed32:function(t,o){o.length&&this.writeMessage(t,Lt,o)},writePackedFixed64:function(t,o){o.length&&this.writeMessage(t,er,o)},writePackedSFixed64:function(t,o){o.length&&this.writeMessage(t,fr,o)},writeBytesField:function(t,o){this.writeTag(t,La.Bytes),this.writeBytes(o)},writeFixed32Field:function(t,o){this.writeTag(t,La.Fixed32),this.writeFixed32(o)},writeSFixed32Field:function(t,o){this.writeTag(t,La.Fixed32),this.writeSFixed32(o)},writeFixed64Field:function(t,o){this.writeTag(t,La.Fixed64),this.writeFixed64(o)},writeSFixed64Field:function(t,o){this.writeTag(t,La.Fixed64),this.writeSFixed64(o)},writeVarintField:function(t,o){this.writeTag(t,La.Varint),this.writeVarint(o)},writeSVarintField:function(t,o){this.writeTag(t,La.Varint),this.writeSVarint(o)},writeStringField:function(t,o){this.writeTag(t,La.Bytes),this.writeString(o)},writeFloatField:function(t,o){this.writeTag(t,La.Fixed32),this.writeFloat(o)},writeDoubleField:function(t,o){this.writeTag(t,La.Fixed64),this.writeDouble(o)},writeBooleanField:function(t,o){this.writeVarintField(t,Boolean(o))}};var ut=function(t,o){var u=o.pixelRatio,p=o.version,g=o.stretchX,x=o.stretchY,S=o.content;this.paddedRect=t,this.pixelRatio=u,this.stretchX=g,this.stretchY=x,this.content=S,this.version=p},Xt={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};Xt.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},Xt.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},Xt.tlbr.get=function(){return this.tl.concat(this.br)},Xt.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(ut.prototype,Xt);var br=function(t,o){var u={},p={};this.haveRenderCallbacks=[];var g=[];this.addImages(t,u,g),this.addImages(o,p,g);var x=Mr(g),S=new Go({width:x.w||1,height:x.h||1});for(var M in t){var D=t[M],U=u[M].paddedRect;Go.copy(D.data,S,{x:0,y:0},{x:U.x+1,y:U.y+1},D.data)}for(var j in o){var G=o[j],ae=p[j].paddedRect,le=ae.x+1,Ie=ae.y+1,ke=G.data.width,Ke=G.data.height;Go.copy(G.data,S,{x:0,y:0},{x:le,y:Ie},G.data),Go.copy(G.data,S,{x:0,y:Ke-1},{x:le,y:Ie-1},{width:ke,height:1}),Go.copy(G.data,S,{x:0,y:0},{x:le,y:Ie+Ke},{width:ke,height:1}),Go.copy(G.data,S,{x:ke-1,y:0},{x:le-1,y:Ie},{width:1,height:Ke}),Go.copy(G.data,S,{x:0,y:0},{x:le+ke,y:Ie},{width:1,height:Ke})}this.image=S,this.iconPositions=u,this.patternPositions=p};br.prototype.addImages=function(t,o,u){for(var p in t){var g=t[p],x={x:0,y:0,w:g.data.width+2,h:g.data.height+2};u.push(x),o[p]=new ut(x,g),g.hasRenderCallback&&this.haveRenderCallbacks.push(p)}},br.prototype.patchUpdatedImages=function(t,o){for(var u in t.dispatchRenderCallbacks(this.haveRenderCallbacks),t.updatedImages)this.patchUpdatedImage(this.iconPositions[u],t.getImage(u),o),this.patchUpdatedImage(this.patternPositions[u],t.getImage(u),o)},br.prototype.patchUpdatedImage=function(t,o,u){if(t&&o&&t.version!==o.version){t.version=o.version;var p=t.tl;u.update(o.data,void 0,{x:p[0],y:p[1]})}},yn("ImagePosition",ut),yn("ImageAtlas",br);var zr={horizontal:1,vertical:2,horizontalOnly:3},hr=function(){this.scale=1,this.fontStack="",this.imageName=null};hr.forText=function(t,o){var u=new hr;return u.scale=t||1,u.fontStack=o,u},hr.forImage=function(t){var o=new hr;return o.imageName=t,o};var Ar=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function Vr(t,o,u,p,g,x,S,M,D,U,j,G,ae,le,Ie,ke){var Ke,Ue=Ar.fromFeature(t,g);G===zr.vertical&&Ue.verticalizePunctuation();var st=Ps.processBidirectionalText,St=Ps.processStyledBidirectionalText;if(st&&Ue.sections.length===1){Ke=[];for(var Gt=0,Zt=st(Ue.toString(),$r(Ue,U,x,o,p,le,Ie));Gt<Zt.length;Gt+=1){var or=Zt[Gt],Ir=new Ar;Ir.text=or,Ir.sections=Ue.sections;for(var Xr=0;Xr<or.length;Xr++)Ir.sectionIndex.push(0);Ke.push(Ir)}}else if(St){Ke=[];for(var Dn=0,ln=St(Ue.text,Ue.sectionIndex,$r(Ue,U,x,o,p,le,Ie));Dn<ln.length;Dn+=1){var Un=ln[Dn],gn=new Ar;gn.text=Un[0],gn.sectionIndex=Un[1],gn.sections=Ue.sections,Ke.push(gn)}}else Ke=function(Cn,ei){for(var Ei=[],ta=Cn.text,Zn=0,ua=0,ro=ei;ua<ro.length;ua+=1){var Io=ro[ua];Ei.push(Cn.substring(Zn,Io)),Zn=Io}return Zn<ta.length&&Ei.push(Cn.substring(Zn,ta.length)),Ei}(Ue,$r(Ue,U,x,o,p,le,Ie));var ki=[],ii={positionedLines:ki,text:Ue.toString(),top:j[1],bottom:j[1],left:j[0],right:j[0],writingMode:G,iconsInText:!1,verticalizable:!1};return function(Cn,ei,Ei,ta,Zn,ua,ro,Io,So,fo,Oo,Ea){for(var cs=0,Mi=-17,_s=0,Xs=0,No=Io==="right"?1:Io==="left"?0:.5,ee=0,Wi=0,Na=Zn;Wi<Na.length;Wi+=1){var Oa=Na[Wi];Oa.trim();var ia=Oa.getMaxScale(),Ys=24*(ia-1),ws={positionedGlyphs:[],lineOffset:0};Cn.positionedLines[ee]=ws;var ka=ws.positionedGlyphs,zo=0;if(Oa.length()){for(var Ts=0;Ts<Oa.length();Ts++){var pa=Oa.getSection(Ts),zl=Oa.getSectionIndex(Ts),Cu=Oa.getCharCode(Ts),sl=0,Uo=null,lc=null,ul=null,Kf=24,yf=!(So===zr.horizontal||!Oo&&!Lf(Cu)||Oo&&(On[Cu]||(hc=Cu,Kr.Arabic(hc)||Kr["Arabic Supplement"](hc)||Kr["Arabic Extended-A"](hc)||Kr["Arabic Presentation Forms-A"](hc)||Kr["Arabic Presentation Forms-B"](hc))));if(pa.imageName){var $f=ta[pa.imageName];if(!$f)continue;ul=pa.imageName,Cn.iconsInText=Cn.iconsInText||!0,lc=$f.paddedRect;var cc=$f.displaySize;pa.scale=24*pa.scale/Ea,sl=Ys+(24-cc[1]*pa.scale),Kf=(Uo={width:cc[0],height:cc[1],left:1,top:-3,advance:yf?cc[1]:cc[0]}).advance;var fc=yf?cc[0]*pa.scale-24*ia:cc[1]*pa.scale-24*ia;fc>0&&fc>zo&&(zo=fc)}else{var lp=Ei[pa.fontStack],Jf=lp&&lp[Cu];if(Jf&&Jf.rect)lc=Jf.rect,Uo=Jf.metrics;else{var Ph=ei[pa.fontStack],Jp=Ph&&Ph[Cu];if(!Jp)continue;Uo=Jp.metrics}sl=24*(ia-pa.scale)}yf?(Cn.verticalizable=!0,ka.push({glyph:Cu,imageName:ul,x:cs,y:Mi+sl,vertical:yf,scale:pa.scale,fontStack:pa.fontStack,sectionIndex:zl,metrics:Uo,rect:lc}),cs+=Kf*pa.scale+fo):(ka.push({glyph:Cu,imageName:ul,x:cs,y:Mi+sl,vertical:yf,scale:pa.scale,fontStack:pa.fontStack,sectionIndex:zl,metrics:Uo,rect:lc}),cs+=Uo.advance*pa.scale+fo)}ka.length!==0&&(_s=Math.max(cs-fo,_s),yi(ka,0,ka.length-1,No,zo)),cs=0;var Qp=ua*ia+zo;ws.lineOffset=Math.max(zo,Ys),Mi+=Qp,Xs=Math.max(Qp,Xs),++ee}else Mi+=ua,++ee}var hc,cp=Mi- -17,pc=Jr(ro),_f=pc.horizontalAlign,Nu=pc.verticalAlign;(function(ed,td,Uc,Ih,fp,Oh,Qf,Rh,hp){var xf,kd=(td-Uc)*fp;xf=Oh!==Qf?-Rh*Ih- -17:(-Ih*hp+.5)*Qf;for(var Lh=0,pp=ed;Lh<pp.length;Lh+=1)for(var bf=0,dp=pp[Lh].positionedGlyphs;bf<dp.length;bf+=1){var eh=dp[bf];eh.x+=kd,eh.y+=xf}})(Cn.positionedLines,No,_f,Nu,_s,Xs,ua,cp,Zn.length),Cn.top+=-Nu*cp,Cn.bottom=Cn.top+cp,Cn.left+=-_f*_s,Cn.right=Cn.left+_s}(ii,o,u,p,Ke,S,M,D,G,U,ae,ke),!function(Cn){for(var ei=0,Ei=Cn;ei<Ei.length;ei+=1)if(Ei[ei].positionedGlyphs.length!==0)return!1;return!0}(ki)&&ii}Ar.fromFeature=function(t,o){for(var u=new Ar,p=0;p<t.sections.length;p++){var g=t.sections[p];g.image?u.addImageSection(g):u.addTextSection(g,o)}return u},Ar.prototype.length=function(){return this.text.length},Ar.prototype.getSection=function(t){return this.sections[this.sectionIndex[t]]},Ar.prototype.getSectionIndex=function(t){return this.sectionIndex[t]},Ar.prototype.getCharCode=function(t){return this.text.charCodeAt(t)},Ar.prototype.verticalizePunctuation=function(){this.text=function(t){for(var o="",u=0;u<t.length;u++){var p=t.charCodeAt(u+1)||null,g=t.charCodeAt(u-1)||null;o+=p&&Ou(p)&&!Xf[t[u+1]]||g&&Ou(g)&&!Xf[t[u-1]]||!Xf[t[u]]?t[u]:Xf[t[u]]}return o}(this.text)},Ar.prototype.trim=function(){for(var t=0,o=0;o<this.text.length&&On[this.text.charCodeAt(o)];o++)t++;for(var u=this.text.length,p=this.text.length-1;p>=0&&p>=t&&On[this.text.charCodeAt(p)];p--)u--;this.text=this.text.substring(t,u),this.sectionIndex=this.sectionIndex.slice(t,u)},Ar.prototype.substring=function(t,o){var u=new Ar;return u.text=this.text.substring(t,o),u.sectionIndex=this.sectionIndex.slice(t,o),u.sections=this.sections,u},Ar.prototype.toString=function(){return this.text},Ar.prototype.getMaxScale=function(){var t=this;return this.sectionIndex.reduce(function(o,u){return Math.max(o,t.sections[u].scale)},0)},Ar.prototype.addTextSection=function(t,o){this.text+=t.text,this.sections.push(hr.forText(t.scale,t.fontStack||o));for(var u=this.sections.length-1,p=0;p<t.text.length;++p)this.sectionIndex.push(u)},Ar.prototype.addImageSection=function(t){var o=t.image?t.image.name:"";if(o.length!==0){var u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCharCode(u),this.sections.push(hr.forImage(o)),this.sectionIndex.push(this.sections.length-1)):$e("Reached maximum number of images 6401")}else $e("Can't add FormattedSection with an empty image.")},Ar.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var On={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},tr={};function ar(t,o,u,p,g,x){if(o.imageName){var S=p[o.imageName];return S?S.displaySize[0]*o.scale*24/x+g:0}var M=u[o.fontStack],D=M&&M[t];return D?D.metrics.advance*o.scale+g:0}function _n(t,o,u,p){var g=Math.pow(t-o,2);return p?t<o?g/2:2*g:g+Math.abs(u)*u}function Gr(t,o,u){var p=0;return t===10&&(p-=1e4),u&&(p+=150),t!==40&&t!==65288||(p+=50),o!==41&&o!==65289||(p+=50),p}function wr(t,o,u,p,g,x){for(var S=null,M=_n(o,u,g,x),D=0,U=p;D<U.length;D+=1){var j=U[D],G=_n(o-j.x,u,g,x)+j.badness;G<=M&&(S=j,M=G)}return{index:t,x:o,priorBreak:S,badness:M}}function $r(t,o,u,p,g,x,S){if(x!=="point")return[];if(!t)return[];for(var M,D=[],U=function(Ke,Ue,st,St,Gt,Zt){for(var or=0,Ir=0;Ir<Ke.length();Ir++){var Xr=Ke.getSection(Ir);or+=ar(Ke.getCharCode(Ir),Xr,St,Gt,Ue,Zt)}return or/Math.max(1,Math.ceil(or/st))}(t,o,u,p,g,S),j=t.text.indexOf("\u200B")>=0,G=0,ae=0;ae<t.length();ae++){var le=t.getSection(ae),Ie=t.getCharCode(ae);if(On[Ie]||(G+=ar(Ie,le,p,g,o,S)),ae<t.length()-1){var ke=!((M=Ie)<11904||!(Kr["Bopomofo Extended"](M)||Kr.Bopomofo(M)||Kr["CJK Compatibility Forms"](M)||Kr["CJK Compatibility Ideographs"](M)||Kr["CJK Compatibility"](M)||Kr["CJK Radicals Supplement"](M)||Kr["CJK Strokes"](M)||Kr["CJK Symbols and Punctuation"](M)||Kr["CJK Unified Ideographs Extension A"](M)||Kr["CJK Unified Ideographs"](M)||Kr["Enclosed CJK Letters and Months"](M)||Kr["Halfwidth and Fullwidth Forms"](M)||Kr.Hiragana(M)||Kr["Ideographic Description Characters"](M)||Kr["Kangxi Radicals"](M)||Kr["Katakana Phonetic Extensions"](M)||Kr.Katakana(M)||Kr["Vertical Forms"](M)||Kr["Yi Radicals"](M)||Kr["Yi Syllables"](M)));(tr[Ie]||ke||le.imageName)&&D.push(wr(ae+1,G,U,D,Gr(Ie,t.getCharCode(ae+1),ke&&j),!1))}}return function Ke(Ue){return Ue?Ke(Ue.priorBreak).concat(Ue.index):[]}(wr(t.length(),G,U,D,0,!0))}function Jr(t){var o=.5,u=.5;switch(t){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":u=1;break;case"top":case"top-right":case"top-left":u=0}return{horizontalAlign:o,verticalAlign:u}}function yi(t,o,u,p,g){if(p||g)for(var x=t[u],S=(t[u].x+x.metrics.advance*x.scale)*p,M=o;M<=u;M++)t[M].x-=S,t[M].y+=g}function ai(t,o,u,p,g,x){var S,M=t.image;if(M.content){var D=M.content,U=M.pixelRatio||1;S=[D[0]/U,D[1]/U,M.displaySize[0]-D[2]/U,M.displaySize[1]-D[3]/U]}var j,G,ae,le,Ie=o.left*x,ke=o.right*x;u==="width"||u==="both"?(le=g[0]+Ie-p[3],G=g[0]+ke+p[1]):G=(le=g[0]+(Ie+ke-M.displaySize[0])/2)+M.displaySize[0];var Ke=o.top*x,Ue=o.bottom*x;return u==="height"||u==="both"?(j=g[1]+Ke-p[0],ae=g[1]+Ue+p[2]):ae=(j=g[1]+(Ke+Ue-M.displaySize[1])/2)+M.displaySize[1],{image:M,top:j,right:G,bottom:ae,left:le,collisionPadding:S}}tr[10]=!0,tr[32]=!0,tr[38]=!0,tr[40]=!0,tr[41]=!0,tr[43]=!0,tr[45]=!0,tr[47]=!0,tr[173]=!0,tr[183]=!0,tr[8203]=!0,tr[8208]=!0,tr[8211]=!0,tr[8231]=!0;var qr=function(t){function o(u,p,g,x){t.call(this,u,p),this.angle=g,x!==void 0&&(this.segment=x)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.clone=function(){return new o(this.x,this.y,this.angle,this.segment)},o}(ie);function en(t,o){var u=o.expression;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new Li(t+1))};if(u.kind==="source")return{kind:"source"};for(var p=u.zoomStops,g=u.interpolationType,x=0;x<p.length&&p[x]<=t;)x++;for(var S=x=Math.max(0,x-1);S<p.length&&p[S]<t+1;)S++;S=Math.min(p.length-1,S);var M=p[x],D=p[S];return u.kind==="composite"?{kind:"composite",minZoom:M,maxZoom:D,interpolationType:g}:{kind:"camera",minZoom:M,maxZoom:D,minSize:u.evaluate(new Li(M)),maxSize:u.evaluate(new Li(D)),interpolationType:g}}function $n(t,o,u){var p=o.uSize,g=u.lowerSize;return t.kind==="source"?g/128:t.kind==="composite"?sa(g/128,u.upperSize/128,o.uSizeT):p}function pi(t,o){var u=0,p=0;if(t.kind==="constant")p=t.layoutSize;else if(t.kind!=="source"){var g=t.interpolationType,x=g?Mt(_e.interpolationFactor(g,o,t.minZoom,t.maxZoom),0,1):0;t.kind==="camera"?p=sa(t.minSize,t.maxSize,x):u=x}return{uSizeT:u,uSize:p}}yn("Anchor",qr);var Ni=Object.freeze({__proto__:null,getSizeData:en,evaluateSizeForFeature:$n,evaluateSizeForZoom:pi,SIZE_PACK_FACTOR:128});function co(t,o,u,p,g){if(o.segment===void 0)return!0;for(var x=o,S=o.segment+1,M=0;M>-u/2;){if(--S<0)return!1;M-=t[S].dist(x),x=t[S]}M+=t[S].dist(t[S+1]),S++;for(var D=[],U=0;M<u/2;){var j=t[S],G=t[S+1];if(!G)return!1;var ae=t[S-1].angleTo(j)-j.angleTo(G);for(ae=Math.abs((ae+3*Math.PI)%(2*Math.PI)-Math.PI),D.push({distance:M,angleDelta:ae}),U+=ae;M-D[0].distance>p;)U-=D.shift().angleDelta;if(U>g)return!1;S++,M+=j.dist(G)}return!0}function mo(t){for(var o=0,u=0;u<t.length-1;u++)o+=t[u].dist(t[u+1]);return o}function zi(t,o,u){return t?.6*o*u:0}function os(t,o){return Math.max(t?t.right-t.left:0,o?o.right-o.left:0)}function Ka(t,o,u,p,g,x){for(var S=zi(u,g,x),M=os(u,p)*x,D=0,U=mo(t)/2,j=0;j<t.length-1;j++){var G=t[j],ae=t[j+1],le=G.dist(ae);if(D+le>U){var Ie=(U-D)/le,ke=sa(G.x,ae.x,Ie),Ke=sa(G.y,ae.y,Ie),Ue=new qr(ke,Ke,ae.angleTo(G),j);return Ue._round(),!S||co(t,Ue,M,S,o)?Ue:void 0}D+=le}}function Ho(t,o,u,p,g,x,S,M,D){var U=zi(p,x,S),j=os(p,g),G=j*S,ae=t[0].x===0||t[0].x===D||t[0].y===0||t[0].y===D;return o-G<o/4&&(o=G+o/4),function le(Ie,ke,Ke,Ue,st,St,Gt,Zt,or){for(var Ir=St/2,Xr=mo(Ie),Dn=0,ln=ke-Ke,Un=[],gn=0;gn<Ie.length-1;gn++){for(var ki=Ie[gn],ii=Ie[gn+1],Cn=ki.dist(ii),ei=ii.angleTo(ki);ln+Ke<Dn+Cn;){var Ei=((ln+=Ke)-Dn)/Cn,ta=sa(ki.x,ii.x,Ei),Zn=sa(ki.y,ii.y,Ei);if(ta>=0&&ta<or&&Zn>=0&&Zn<or&&ln-Ir>=0&&ln+Ir<=Xr){var ua=new qr(ta,Zn,ei,gn);ua._round(),Ue&&!co(Ie,ua,St,Ue,st)||Un.push(ua)}}Dn+=Cn}return Zt||Un.length||Gt||(Un=le(Ie,Dn/2,Ke,Ue,st,St,Gt,!0,or)),Un}(t,ae?o/2*M%o:(j/2+2*x)*S*M%o,o,U,u,G,ae,!1,D)}function Eo(t,o,u,p,g){for(var x=[],S=0;S<t.length;S++)for(var M=t[S],D=void 0,U=0;U<M.length-1;U++){var j=M[U],G=M[U+1];j.x<o&&G.x<o||(j.x<o?j=new ie(o,j.y+(o-j.x)/(G.x-j.x)*(G.y-j.y))._round():G.x<o&&(G=new ie(o,j.y+(o-j.x)/(G.x-j.x)*(G.y-j.y))._round()),j.y<u&&G.y<u||(j.y<u?j=new ie(j.x+(u-j.y)/(G.y-j.y)*(G.x-j.x),u)._round():G.y<u&&(G=new ie(j.x+(u-j.y)/(G.y-j.y)*(G.x-j.x),u)._round()),j.x>=p&&G.x>=p||(j.x>=p?j=new ie(p,j.y+(p-j.x)/(G.x-j.x)*(G.y-j.y))._round():G.x>=p&&(G=new ie(p,j.y+(p-j.x)/(G.x-j.x)*(G.y-j.y))._round()),j.y>=g&&G.y>=g||(j.y>=g?j=new ie(j.x+(g-j.y)/(G.y-j.y)*(G.x-j.x),g)._round():G.y>=g&&(G=new ie(j.x+(g-j.y)/(G.y-j.y)*(G.x-j.x),g)._round()),D&&j.equals(D[D.length-1])||x.push(D=[j]),D.push(G)))))}return x}function ts(t,o,u,p){var g=[],x=t.image,S=x.pixelRatio,M=x.paddedRect.w-2,D=x.paddedRect.h-2,U=t.right-t.left,j=t.bottom-t.top,G=x.stretchX||[[0,M]],ae=x.stretchY||[[0,D]],le=function(ta,Zn){return ta+Zn[1]-Zn[0]},Ie=G.reduce(le,0),ke=ae.reduce(le,0),Ke=M-Ie,Ue=D-ke,st=0,St=Ie,Gt=0,Zt=ke,or=0,Ir=Ke,Xr=0,Dn=Ue;if(x.content&&p){var ln=x.content;st=Wo(G,0,ln[0]),Gt=Wo(ae,0,ln[1]),St=Wo(G,ln[0],ln[2]),Zt=Wo(ae,ln[1],ln[3]),or=ln[0]-st,Xr=ln[1]-Gt,Ir=ln[2]-ln[0]-St,Dn=ln[3]-ln[1]-Zt}var Un=function(ta,Zn,ua,ro){var Io=go(ta.stretch-st,St,U,t.left),So=_i(ta.fixed-or,Ir,ta.stretch,Ie),fo=go(Zn.stretch-Gt,Zt,j,t.top),Oo=_i(Zn.fixed-Xr,Dn,Zn.stretch,ke),Ea=go(ua.stretch-st,St,U,t.left),cs=_i(ua.fixed-or,Ir,ua.stretch,Ie),Mi=go(ro.stretch-Gt,Zt,j,t.top),_s=_i(ro.fixed-Xr,Dn,ro.stretch,ke),Xs=new ie(Io,fo),No=new ie(Ea,fo),ee=new ie(Ea,Mi),Wi=new ie(Io,Mi),Na=new ie(So/S,Oo/S),Oa=new ie(cs/S,_s/S),ia=o*Math.PI/180;if(ia){var Ys=Math.sin(ia),ws=Math.cos(ia),ka=[ws,-Ys,Ys,ws];Xs._matMult(ka),No._matMult(ka),Wi._matMult(ka),ee._matMult(ka)}var zo=ta.stretch+ta.fixed,Ts=Zn.stretch+Zn.fixed;return{tl:Xs,tr:No,bl:Wi,br:ee,tex:{x:x.paddedRect.x+1+zo,y:x.paddedRect.y+1+Ts,w:ua.stretch+ua.fixed-zo,h:ro.stretch+ro.fixed-Ts},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Na,pixelOffsetBR:Oa,minFontScaleX:Ir/S/U,minFontScaleY:Dn/S/j,isSDF:u}};if(p&&(x.stretchX||x.stretchY))for(var gn=ss(G,Ke,Ie),ki=ss(ae,Ue,ke),ii=0;ii<gn.length-1;ii++)for(var Cn=gn[ii],ei=gn[ii+1],Ei=0;Ei<ki.length-1;Ei++)g.push(Un(Cn,ki[Ei],ei,ki[Ei+1]));else g.push(Un({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:M+1},{fixed:0,stretch:D+1}));return g}function Wo(t,o,u){for(var p=0,g=0,x=t;g<x.length;g+=1){var S=x[g];p+=Math.max(o,Math.min(u,S[1]))-Math.max(o,Math.min(u,S[0]))}return p}function ss(t,o,u){for(var p=[{fixed:-1,stretch:0}],g=0,x=t;g<x.length;g+=1){var S=x[g],M=S[0],D=S[1],U=p[p.length-1];p.push({fixed:M-U.stretch,stretch:U.stretch}),p.push({fixed:M-U.stretch,stretch:U.stretch+(D-M)})}return p.push({fixed:o+1,stretch:u}),p}function go(t,o,u,p){return t/o*u+p}function _i(t,o,u,p){return t-o*u/p}var Xo=function(t,o,u,p,g,x,S,M,D,U){if(this.boxStartIndex=t.length,D){var j=x.top,G=x.bottom,ae=x.collisionPadding;ae&&(j-=ae[1],G+=ae[3]);var le=G-j;le>0&&(le=Math.max(10,le),this.circleDiameter=le)}else{var Ie=x.top*S-M,ke=x.bottom*S+M,Ke=x.left*S-M,Ue=x.right*S+M,st=x.collisionPadding;if(st&&(Ke-=st[0]*S,Ie-=st[1]*S,Ue+=st[2]*S,ke+=st[3]*S),U){var St=new ie(Ke,Ie),Gt=new ie(Ue,Ie),Zt=new ie(Ke,ke),or=new ie(Ue,ke),Ir=U*Math.PI/180;St._rotate(Ir),Gt._rotate(Ir),Zt._rotate(Ir),or._rotate(Ir),Ke=Math.min(St.x,Gt.x,Zt.x,or.x),Ue=Math.max(St.x,Gt.x,Zt.x,or.x),Ie=Math.min(St.y,Gt.y,Zt.y,or.y),ke=Math.max(St.y,Gt.y,Zt.y,or.y)}t.emplaceBack(o.x,o.y,Ke,Ie,Ue,ke,u,p,g)}this.boxEndIndex=t.length},na=function(t,o){if(t===void 0&&(t=[]),o===void 0&&(o=us),this.data=t,this.length=this.data.length,this.compare=o,this.length>0)for(var u=(this.length>>1)-1;u>=0;u--)this._down(u)};function us(t,o){return t<o?-1:t>o?1:0}function ni(t,o,u){o===void 0&&(o=1),u===void 0&&(u=!1);for(var p=1/0,g=1/0,x=-1/0,S=-1/0,M=t[0],D=0;D<M.length;D++){var U=M[D];(!D||U.x<p)&&(p=U.x),(!D||U.y<g)&&(g=U.y),(!D||U.x>x)&&(x=U.x),(!D||U.y>S)&&(S=U.y)}var j=Math.min(x-p,S-g),G=j/2,ae=new na([],Ui);if(j===0)return new ie(p,g);for(var le=p;le<x;le+=j)for(var Ie=g;Ie<S;Ie+=j)ae.push(new fa(le+G,Ie+G,G,t));for(var ke=function(st){for(var St=0,Gt=0,Zt=0,or=st[0],Ir=0,Xr=or.length,Dn=Xr-1;Ir<Xr;Dn=Ir++){var ln=or[Ir],Un=or[Dn],gn=ln.x*Un.y-Un.x*ln.y;Gt+=(ln.x+Un.x)*gn,Zt+=(ln.y+Un.y)*gn,St+=3*gn}return new fa(Gt/St,Zt/St,0,st)}(t),Ke=ae.length;ae.length;){var Ue=ae.pop();(Ue.d>ke.d||!ke.d)&&(ke=Ue,u&&console.log("found best %d after %d probes",Math.round(1e4*Ue.d)/1e4,Ke)),Ue.max-ke.d<=o||(ae.push(new fa(Ue.p.x-(G=Ue.h/2),Ue.p.y-G,G,t)),ae.push(new fa(Ue.p.x+G,Ue.p.y-G,G,t)),ae.push(new fa(Ue.p.x-G,Ue.p.y+G,G,t)),ae.push(new fa(Ue.p.x+G,Ue.p.y+G,G,t)),Ke+=4)}return u&&(console.log("num probes: "+Ke),console.log("best distance: "+ke.d)),ke.p}function Ui(t,o){return o.max-t.max}function fa(t,o,u,p){this.p=new ie(t,o),this.h=u,this.d=function(g,x){for(var S=!1,M=1/0,D=0;D<x.length;D++)for(var U=x[D],j=0,G=U.length,ae=G-1;j<G;ae=j++){var le=U[j],Ie=U[ae];le.y>g.y!=Ie.y>g.y&&g.x<(Ie.x-le.x)*(g.y-le.y)/(Ie.y-le.y)+le.x&&(S=!S),M=Math.min(M,nc(g,le,Ie))}return(S?1:-1)*Math.sqrt(M)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}na.prototype.push=function(t){this.data.push(t),this.length++,this._up(this.length-1)},na.prototype.pop=function(){if(this.length!==0){var t=this.data[0],o=this.data.pop();return this.length--,this.length>0&&(this.data[0]=o,this._down(0)),t}},na.prototype.peek=function(){return this.data[0]},na.prototype._up=function(t){for(var o=this.data,u=this.compare,p=o[t];t>0;){var g=t-1>>1,x=o[g];if(u(p,x)>=0)break;o[t]=x,t=g}o[t]=p},na.prototype._down=function(t){for(var o=this.data,u=this.compare,p=this.length>>1,g=o[t];t<p;){var x=1+(t<<1),S=o[x],M=x+1;if(M<this.length&&u(o[M],S)<0&&(x=M,S=o[M]),u(S,g)>=0)break;o[t]=S,t=x}o[t]=g};var Po=Number.POSITIVE_INFINITY;function Sl(t,o){return o[1]!==Po?function(u,p,g){var x=0,S=0;switch(p=Math.abs(p),g=Math.abs(g),u){case"top-right":case"top-left":case"top":S=g-7;break;case"bottom-right":case"bottom-left":case"bottom":S=7-g}switch(u){case"top-right":case"bottom-right":case"right":x=-p;break;case"top-left":case"bottom-left":case"left":x=p}return[x,S]}(t,o[0],o[1]):function(u,p){var g=0,x=0;p<0&&(p=0);var S=p/Math.sqrt(2);switch(u){case"top-right":case"top-left":x=S-7;break;case"bottom-right":case"bottom-left":x=7-S;break;case"bottom":x=7-p;break;case"top":x=p-7}switch(u){case"top-right":case"bottom-right":g=-S;break;case"top-left":case"bottom-left":g=S;break;case"left":g=p;break;case"right":g=-p}return[g,x]}(t,o[0])}function Me(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Bt(t,o,u,p,g,x,S,M,D,U,j,G,ae,le,Ie){var ke=function(Gt,Zt,or,Ir,Xr,Dn,ln,Un){for(var gn=Ir.layout.get("text-rotate").evaluate(Dn,{})*Math.PI/180,ki=[],ii=0,Cn=Zt.positionedLines;ii<Cn.length;ii+=1)for(var ei=Cn[ii],Ei=0,ta=ei.positionedGlyphs;Ei<ta.length;Ei+=1){var Zn=ta[Ei];if(Zn.rect){var ua=Zn.rect||{},ro=4,Io=!0,So=1,fo=0,Oo=(Xr||Un)&&Zn.vertical,Ea=Zn.metrics.advance*Zn.scale/2;if(Un&&Zt.verticalizable&&(fo=ei.lineOffset/2-(Zn.imageName?-(24-Zn.metrics.width*Zn.scale)/2:24*(Zn.scale-1))),Zn.imageName){var cs=ln[Zn.imageName];Io=cs.sdf,ro=1/(So=cs.pixelRatio)}var Mi=Xr?[Zn.x+Ea,Zn.y]:[0,0],_s=Xr?[0,0]:[Zn.x+Ea+or[0],Zn.y+or[1]-fo],Xs=[0,0];Oo&&(Xs=_s,_s=[0,0]);var No=(Zn.metrics.left-ro)*Zn.scale-Ea+_s[0],ee=(-Zn.metrics.top-ro)*Zn.scale+_s[1],Wi=No+ua.w*Zn.scale/So,Na=ee+ua.h*Zn.scale/So,Oa=new ie(No,ee),ia=new ie(Wi,ee),Ys=new ie(No,Na),ws=new ie(Wi,Na);if(Oo){var ka=new ie(-Ea,Ea- -17),zo=-Math.PI/2,Ts=12-Ea,pa=new ie(22-Ts,-(Zn.imageName?Ts:0)),zl=new(Function.prototype.bind.apply(ie,[null].concat(Xs)));Oa._rotateAround(zo,ka)._add(pa)._add(zl),ia._rotateAround(zo,ka)._add(pa)._add(zl),Ys._rotateAround(zo,ka)._add(pa)._add(zl),ws._rotateAround(zo,ka)._add(pa)._add(zl)}if(gn){var Cu=Math.sin(gn),sl=Math.cos(gn),Uo=[sl,-Cu,Cu,sl];Oa._matMult(Uo),ia._matMult(Uo),Ys._matMult(Uo),ws._matMult(Uo)}var lc=new ie(0,0),ul=new ie(0,0);ki.push({tl:Oa,tr:ia,bl:Ys,br:ws,tex:ua,writingMode:Zt.writingMode,glyphOffset:Mi,sectionIndex:Zn.sectionIndex,isSDF:Io,pixelOffsetTL:lc,pixelOffsetBR:ul,minFontScaleX:0,minFontScaleY:0})}}return ki}(0,u,M,g,x,S,p,t.allowVerticalPlacement),Ke=t.textSizeData,Ue=null;Ke.kind==="source"?(Ue=[128*g.layout.get("text-size").evaluate(S,{})])[0]>32640&&$e(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):Ke.kind==="composite"&&((Ue=[128*le.compositeTextSizes[0].evaluate(S,{},Ie),128*le.compositeTextSizes[1].evaluate(S,{},Ie)])[0]>32640||Ue[1]>32640)&&$e(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),t.addSymbols(t.text,ke,Ue,M,x,S,U,o,D.lineStartIndex,D.lineLength,ae,Ie);for(var st=0,St=j;st<St.length;st+=1)G[St[st]]=t.text.placedSymbolArray.length-1;return 4*ke.length}function Ct(t){for(var o in t)return t[o];return null}function dn(t,o,u,p){var g=t.compareText;if(o in g){for(var x=g[o],S=x.length-1;S>=0;S--)if(p.dist(x[S])<u)return!0}else g[o]=[];return g[o].push(p),!1}var Zi=Lr.VectorTileFeature.types,Se=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ce(t,o,u,p,g,x,S,M,D,U,j,G,ae){var le=M?Math.min(32640,Math.round(M[0])):0,Ie=M?Math.min(32640,Math.round(M[1])):0;t.emplaceBack(o,u,Math.round(32*p),Math.round(32*g),x,S,(le<<1)+(D?1:0),Ie,16*U,16*j,256*G,256*ae)}function He(t,o,u){t.emplaceBack(o.x,o.y,u),t.emplaceBack(o.x,o.y,u),t.emplaceBack(o.x,o.y,u),t.emplaceBack(o.x,o.y,u)}function ht(t){for(var o=0,u=t.sections;o<u.length;o+=1)if(rf(u[o].text))return!0;return!1}var Pt=function(t){this.layoutVertexArray=new nf,this.indexArray=new el,this.programConfigurations=t,this.segments=new he,this.dynamicLayoutVertexArray=new Ll,this.opacityVertexArray=new kl,this.placedSymbolArray=new d};Pt.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},Pt.prototype.upload=function(t,o,u,p){this.isEmpty()||(u&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ip.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Pd.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Se,!0),this.opacityVertexBuffer.itemSize=1),(u||p)&&this.programConfigurations.upload(t))},Pt.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},yn("SymbolBuffers",Pt);var Je=function(t,o,u){this.layoutVertexArray=new t,this.layoutAttributes=o,this.indexArray=new u,this.segments=new he,this.collisionVertexArray=new mh};Je.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Id.members,!0)},Je.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},yn("CollisionBuffers",Je);var Ne=function(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(x){return x.id}),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Rs([]),this.placementViewportMatrix=Rs([]);var o=this.layers[0]._unevaluatedLayout._values;this.textSizeData=en(this.zoom,o["text-size"]),this.iconSizeData=en(this.zoom,o["icon-size"]);var u=this.layers[0].layout,p=u.get("symbol-sort-key"),g=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=g!=="viewport-y"&&p.constantOr(1)!==void 0,this.sortFeaturesByY=(g==="viewport-y"||g==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,u.get("symbol-placement")==="point"&&(this.writingModes=u.get("text-writing-mode").map(function(x){return zr[x]})),this.stateDependentLayerIds=this.layers.filter(function(x){return x.isStateDependent()}).map(function(x){return x.id}),this.sourceID=t.sourceID};Ne.prototype.createArrays=function(){this.text=new Pt(new Wn(this.layers,this.zoom,function(t){return/^text/.test(t)})),this.icon=new Pt(new Wn(this.layers,this.zoom,function(t){return/^icon/.test(t)})),this.glyphOffsetArray=new T,this.lineVertexArray=new L,this.symbolInstances=new C},Ne.prototype.calculateGlyphDependencies=function(t,o,u,p,g){for(var x=0;x<t.length;x++)if(o[t.charCodeAt(x)]=!0,(u||p)&&g){var S=Xf[t.charAt(x)];S&&(o[S.charCodeAt(0)]=!0)}},Ne.prototype.populate=function(t,o,u){var p=this.layers[0],g=p.layout,x=g.get("text-font"),S=g.get("text-field"),M=g.get("icon-image"),D=(S.value.kind!=="constant"||S.value.value instanceof Ma&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),U=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,j=g.get("symbol-sort-key");if(this.features=[],D||U){for(var G=o.iconDependencies,ae=o.glyphDependencies,le=o.availableImages,Ie=new Li(this.zoom),ke=0,Ke=t;ke<Ke.length;ke+=1){var Ue=Ke[ke],st=Ue.feature,St=Ue.id,Gt=Ue.index,Zt=Ue.sourceLayerIndex,or=p._featureFilter.needGeometry,Ir=vo(st,or);if(p._featureFilter.filter(Ie,Ir,u)){or||(Ir.geometry=to(st));var Xr=void 0;if(D){var Dn=p.getValueAndResolveTokens("text-field",Ir,u,le),ln=Ma.factory(Dn);ht(ln)&&(this.hasRTLText=!0),(!this.hasRTLText||vh()==="unavailable"||this.hasRTLText&&Ps.isParsed())&&(Xr=Rd(ln,p,Ir))}var Un=void 0;if(U){var gn=p.getValueAndResolveTokens("icon-image",Ir,u,le);Un=gn instanceof Pa?gn:Pa.fromString(gn)}if(Xr||Un){var ki=this.sortFeaturesByKey?j.evaluate(Ir,{},u):void 0;if(this.features.push({id:St,text:Xr,icon:Un,index:Gt,sourceLayerIndex:Zt,geometry:Ir.geometry,properties:st.properties,type:Zi[st.type],sortKey:ki}),Un&&(G[Un.name]=!0),Xr){var ii=x.evaluate(Ir,{},u).join(","),Cn=g.get("text-rotation-alignment")==="map"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(zr.vertical)>=0;for(var ei=0,Ei=Xr.sections;ei<Ei.length;ei+=1){var ta=Ei[ei];if(ta.image)G[ta.image.name]=!0;else{var Zn=tf(Xr.toString()),ua=ta.fontStack||ii,ro=ae[ua]=ae[ua]||{};this.calculateGlyphDependencies(ta.text,ro,Cn,this.allowVerticalPlacement,Zn)}}}}}}g.get("symbol-placement")==="line"&&(this.features=function(Io){var So={},fo={},Oo=[],Ea=0;function cs(ka){Oo.push(Io[ka]),Ea++}function Mi(ka,zo,Ts){var pa=fo[ka];return delete fo[ka],fo[zo]=pa,Oo[pa].geometry[0].pop(),Oo[pa].geometry[0]=Oo[pa].geometry[0].concat(Ts[0]),pa}function _s(ka,zo,Ts){var pa=So[zo];return delete So[zo],So[ka]=pa,Oo[pa].geometry[0].shift(),Oo[pa].geometry[0]=Ts[0].concat(Oo[pa].geometry[0]),pa}function Xs(ka,zo,Ts){var pa=Ts?zo[0][zo[0].length-1]:zo[0][0];return ka+":"+pa.x+":"+pa.y}for(var No=0;No<Io.length;No++){var ee=Io[No],Wi=ee.geometry,Na=ee.text?ee.text.toString():null;if(Na){var Oa=Xs(Na,Wi),ia=Xs(Na,Wi,!0);if(Oa in fo&&ia in So&&fo[Oa]!==So[ia]){var Ys=_s(Oa,ia,Wi),ws=Mi(Oa,ia,Oo[Ys].geometry);delete So[Oa],delete fo[ia],fo[Xs(Na,Oo[ws].geometry,!0)]=ws,Oo[Ys].geometry=null}else Oa in fo?Mi(Oa,ia,Wi):ia in So?_s(Oa,ia,Wi):(cs(No),So[Oa]=Ea-1,fo[ia]=Ea-1)}else cs(No)}return Oo.filter(function(ka){return ka.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(Io,So){return Io.sortKey-So.sortKey})}},Ne.prototype.update=function(t,o,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,o,this.layers,u),this.icon.programConfigurations.updatePaintArrays(t,o,this.layers,u))},Ne.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},Ne.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},Ne.prototype.upload=function(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},Ne.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},Ne.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},Ne.prototype.addToLineVertexArray=function(t,o){var u=this.lineVertexArray.length;if(t.segment!==void 0){for(var p=t.dist(o[t.segment+1]),g=t.dist(o[t.segment]),x={},S=t.segment+1;S<o.length;S++)x[S]={x:o[S].x,y:o[S].y,tileUnitDistanceFromAnchor:p},S<o.length-1&&(p+=o[S+1].dist(o[S]));for(var M=t.segment||0;M>=0;M--)x[M]={x:o[M].x,y:o[M].y,tileUnitDistanceFromAnchor:g},M>0&&(g+=o[M-1].dist(o[M]));for(var D=0;D<o.length;D++){var U=x[D];this.lineVertexArray.emplaceBack(U.x,U.y,U.tileUnitDistanceFromAnchor)}}return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}},Ne.prototype.addSymbols=function(t,o,u,p,g,x,S,M,D,U,j,G){for(var ae=t.indexArray,le=t.layoutVertexArray,Ie=t.segments.prepareSegment(4*o.length,le,ae,this.canOverlap?x.sortKey:void 0),ke=this.glyphOffsetArray.length,Ke=Ie.vertexLength,Ue=this.allowVerticalPlacement&&S===zr.vertical?Math.PI/2:0,st=x.text&&x.text.sections,St=0;St<o.length;St++){var Gt=o[St],Zt=Gt.tl,or=Gt.tr,Ir=Gt.bl,Xr=Gt.br,Dn=Gt.tex,ln=Gt.pixelOffsetTL,Un=Gt.pixelOffsetBR,gn=Gt.minFontScaleX,ki=Gt.minFontScaleY,ii=Gt.glyphOffset,Cn=Gt.isSDF,ei=Gt.sectionIndex,Ei=Ie.vertexLength,ta=ii[1];ce(le,M.x,M.y,Zt.x,ta+Zt.y,Dn.x,Dn.y,u,Cn,ln.x,ln.y,gn,ki),ce(le,M.x,M.y,or.x,ta+or.y,Dn.x+Dn.w,Dn.y,u,Cn,Un.x,ln.y,gn,ki),ce(le,M.x,M.y,Ir.x,ta+Ir.y,Dn.x,Dn.y+Dn.h,u,Cn,ln.x,Un.y,gn,ki),ce(le,M.x,M.y,Xr.x,ta+Xr.y,Dn.x+Dn.w,Dn.y+Dn.h,u,Cn,Un.x,Un.y,gn,ki),He(t.dynamicLayoutVertexArray,M,Ue),ae.emplaceBack(Ei,Ei+1,Ei+2),ae.emplaceBack(Ei+1,Ei+2,Ei+3),Ie.vertexLength+=4,Ie.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ii[0]),St!==o.length-1&&ei===o[St+1].sectionIndex||t.programConfigurations.populatePaintArrays(le.length,x,x.index,{},G,st&&st[ei])}t.placedSymbolArray.emplaceBack(M.x,M.y,ke,this.glyphOffsetArray.length-ke,Ke,D,U,M.segment,u?u[0]:0,u?u[1]:0,p[0],p[1],S,0,!1,0,j)},Ne.prototype._addCollisionDebugVertex=function(t,o,u,p,g,x){return o.emplaceBack(0,0),t.emplaceBack(u.x,u.y,p,g,Math.round(x.x),Math.round(x.y))},Ne.prototype.addCollisionDebugVertices=function(t,o,u,p,g,x,S){var M=g.segments.prepareSegment(4,g.layoutVertexArray,g.indexArray),D=M.vertexLength,U=g.layoutVertexArray,j=g.collisionVertexArray,G=S.anchorX,ae=S.anchorY;this._addCollisionDebugVertex(U,j,x,G,ae,new ie(t,o)),this._addCollisionDebugVertex(U,j,x,G,ae,new ie(u,o)),this._addCollisionDebugVertex(U,j,x,G,ae,new ie(u,p)),this._addCollisionDebugVertex(U,j,x,G,ae,new ie(t,p)),M.vertexLength+=4;var le=g.indexArray;le.emplaceBack(D,D+1),le.emplaceBack(D+1,D+2),le.emplaceBack(D+2,D+3),le.emplaceBack(D+3,D),M.primitiveLength+=4},Ne.prototype.addDebugCollisionBoxes=function(t,o,u,p){for(var g=t;g<o;g++){var x=this.collisionBoxArray.get(g);this.addCollisionDebugVertices(x.x1,x.y1,x.x2,x.y2,p?this.textCollisionBox:this.iconCollisionBox,x.anchorPoint,u)}},Ne.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Je(ec,ap.members,Vs),this.iconCollisionBox=new Je(ec,ap.members,Vs);for(var t=0;t<this.symbolInstances.length;t++){var o=this.symbolInstances.get(t);this.addDebugCollisionBoxes(o.textBoxStartIndex,o.textBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.iconBoxStartIndex,o.iconBoxEndIndex,o,!1),this.addDebugCollisionBoxes(o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o,!1)}},Ne.prototype._deserializeCollisionBoxesForSymbol=function(t,o,u,p,g,x,S,M,D){for(var U={},j=o;j<u;j++){var G=t.get(j);U.textBox={x1:G.x1,y1:G.y1,x2:G.x2,y2:G.y2,anchorPointX:G.anchorPointX,anchorPointY:G.anchorPointY},U.textFeatureIndex=G.featureIndex;break}for(var ae=p;ae<g;ae++){var le=t.get(ae);U.verticalTextBox={x1:le.x1,y1:le.y1,x2:le.x2,y2:le.y2,anchorPointX:le.anchorPointX,anchorPointY:le.anchorPointY},U.verticalTextFeatureIndex=le.featureIndex;break}for(var Ie=x;Ie<S;Ie++){var ke=t.get(Ie);U.iconBox={x1:ke.x1,y1:ke.y1,x2:ke.x2,y2:ke.y2,anchorPointX:ke.anchorPointX,anchorPointY:ke.anchorPointY},U.iconFeatureIndex=ke.featureIndex;break}for(var Ke=M;Ke<D;Ke++){var Ue=t.get(Ke);U.verticalIconBox={x1:Ue.x1,y1:Ue.y1,x2:Ue.x2,y2:Ue.y2,anchorPointX:Ue.anchorPointX,anchorPointY:Ue.anchorPointY},U.verticalIconFeatureIndex=Ue.featureIndex;break}return U},Ne.prototype.deserializeCollisionBoxes=function(t){this.collisionArrays=[];for(var o=0;o<this.symbolInstances.length;o++){var u=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}},Ne.prototype.hasTextData=function(){return this.text.segments.get().length>0},Ne.prototype.hasIconData=function(){return this.icon.segments.get().length>0},Ne.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},Ne.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},Ne.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},Ne.prototype.addIndicesForPlacedSymbol=function(t,o){for(var u=t.placedSymbolArray.get(o),p=u.vertexStartIndex+4*u.numGlyphs,g=u.vertexStartIndex;g<p;g+=4)t.indexArray.emplaceBack(g,g+1,g+2),t.indexArray.emplaceBack(g+1,g+2,g+3)},Ne.prototype.getSortedSymbolIndexes=function(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var o=Math.sin(t),u=Math.cos(t),p=[],g=[],x=[],S=0;S<this.symbolInstances.length;++S){x.push(S);var M=this.symbolInstances.get(S);p.push(0|Math.round(o*M.anchorX+u*M.anchorY)),g.push(M.featureIndex)}return x.sort(function(D,U){return p[D]-p[U]||g[U]-g[D]}),x},Ne.prototype.addToSortKeyRanges=function(t,o){var u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===o?u.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:t,symbolInstanceEnd:t+1})},Ne.prototype.sortFeatures=function(t){var o=this;if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var u=0,p=this.symbolInstanceIndexes;u<p.length;u+=1){var g=this.symbolInstances.get(p[u]);this.featureSortOrder.push(g.featureIndex),[g.rightJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.leftJustifiedTextSymbolIndex].forEach(function(x,S,M){x>=0&&M.indexOf(x)===S&&o.addIndicesForPlacedSymbol(o.text,x)}),g.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,g.verticalPlacedTextSymbolIndex),g.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,g.placedIconSymbolIndex),g.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,g.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},yn("SymbolBucket",Ne,{omit:["layers","collisionBoxArray","features","compareText"]}),Ne.MAX_GLYPHS=65535,Ne.addDynamicAttributes=He;var it=new es({"symbol-placement":new In(pe.layout_symbol["symbol-placement"]),"symbol-spacing":new In(pe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new In(pe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new An(pe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new In(pe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new In(pe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new In(pe.layout_symbol["icon-ignore-placement"]),"icon-optional":new In(pe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new In(pe.layout_symbol["icon-rotation-alignment"]),"icon-size":new An(pe.layout_symbol["icon-size"]),"icon-text-fit":new In(pe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new In(pe.layout_symbol["icon-text-fit-padding"]),"icon-image":new An(pe.layout_symbol["icon-image"]),"icon-rotate":new An(pe.layout_symbol["icon-rotate"]),"icon-padding":new In(pe.layout_symbol["icon-padding"]),"icon-keep-upright":new In(pe.layout_symbol["icon-keep-upright"]),"icon-offset":new An(pe.layout_symbol["icon-offset"]),"icon-anchor":new An(pe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new In(pe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new In(pe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new In(pe.layout_symbol["text-rotation-alignment"]),"text-field":new An(pe.layout_symbol["text-field"]),"text-font":new An(pe.layout_symbol["text-font"]),"text-size":new An(pe.layout_symbol["text-size"]),"text-max-width":new An(pe.layout_symbol["text-max-width"]),"text-line-height":new In(pe.layout_symbol["text-line-height"]),"text-letter-spacing":new An(pe.layout_symbol["text-letter-spacing"]),"text-justify":new An(pe.layout_symbol["text-justify"]),"text-radial-offset":new An(pe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new In(pe.layout_symbol["text-variable-anchor"]),"text-anchor":new An(pe.layout_symbol["text-anchor"]),"text-max-angle":new In(pe.layout_symbol["text-max-angle"]),"text-writing-mode":new In(pe.layout_symbol["text-writing-mode"]),"text-rotate":new An(pe.layout_symbol["text-rotate"]),"text-padding":new In(pe.layout_symbol["text-padding"]),"text-keep-upright":new In(pe.layout_symbol["text-keep-upright"]),"text-transform":new An(pe.layout_symbol["text-transform"]),"text-offset":new An(pe.layout_symbol["text-offset"]),"text-allow-overlap":new In(pe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new In(pe.layout_symbol["text-ignore-placement"]),"text-optional":new In(pe.layout_symbol["text-optional"])}),ye={paint:new es({"icon-opacity":new An(pe.paint_symbol["icon-opacity"]),"icon-color":new An(pe.paint_symbol["icon-color"]),"icon-halo-color":new An(pe.paint_symbol["icon-halo-color"]),"icon-halo-width":new An(pe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new An(pe.paint_symbol["icon-halo-blur"]),"icon-translate":new In(pe.paint_symbol["icon-translate"]),"icon-translate-anchor":new In(pe.paint_symbol["icon-translate-anchor"]),"text-opacity":new An(pe.paint_symbol["text-opacity"]),"text-color":new An(pe.paint_symbol["text-color"],{runtimeType:Yr,getOverride:function(t){return t.textColor},hasOverride:function(t){return!!t.textColor}}),"text-halo-color":new An(pe.paint_symbol["text-halo-color"]),"text-halo-width":new An(pe.paint_symbol["text-halo-width"]),"text-halo-blur":new An(pe.paint_symbol["text-halo-blur"]),"text-translate":new In(pe.paint_symbol["text-translate"]),"text-translate-anchor":new In(pe.paint_symbol["text-translate-anchor"])}),layout:it},je=function(t){this.type=t.property.overrides?t.property.overrides.runtimeType:un,this.defaultValue=t};je.prototype.evaluate=function(t){if(t.formattedSection){var o=this.defaultValue.property.overrides;if(o&&o.hasOverride(t.formattedSection))return o.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default},je.prototype.eachChild=function(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)},je.prototype.outputDefined=function(){return!1},je.prototype.serialize=function(){return null},yn("FormatSectionOverride",je,{omit:["defaultValue"]});var we=function(t){function o(u){t.call(this,u,ye)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.recalculate=function(u,p){if(t.prototype.recalculate.call(this,u,p),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var g=this.layout.get("text-writing-mode");if(g){for(var x=[],S=0,M=g;S<M.length;S+=1){var D=M[S];x.indexOf(D)<0&&x.push(D)}this.layout._values["text-writing-mode"]=x}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},o.prototype.getValueAndResolveTokens=function(u,p,g,x){var S=this.layout.get(u).evaluate(p,{},g,x),M=this._unevaluatedLayout._values[u];return M.isDataDriven()||jo(M.value)||!S?S:function(D,U){return U.replace(/{([^{}]+)}/g,function(j,G){return G in D?String(D[G]):""})}(p.properties,S)},o.prototype.createBucket=function(u){return new Ne(u)},o.prototype.queryRadius=function(){return 0},o.prototype.queryIntersectsFeature=function(){return!1},o.prototype._setPaintOverrides=function(){for(var u=0,p=ye.paint.overridableProperties;u<p.length;u+=1){var g=p[u];if(o.hasPaintOverride(this.layout,g)){var x,S=this.paint.get(g),M=new je(S),D=new dl(M,S.property.specification);x=S.value.kind==="constant"||S.value.kind==="source"?new Yu("source",D):new Vo("composite",D,S.value.zoomStops,S.value._interpolationType),this.paint._values[g]=new vs(S.property,x,S.parameters)}}},o.prototype._handleOverridablePaintPropertyUpdate=function(u,p,g){return!(!this.layout||p.isDataDriven()||g.isDataDriven())&&o.hasPaintOverride(this.layout,u)},o.hasPaintOverride=function(u,p){var g=u.get("text-field"),x=ye.paint.properties[p],S=!1,M=function(j){for(var G=0,ae=j;G<ae.length;G+=1)if(x.overrides&&x.overrides.hasOverride(ae[G]))return void(S=!0)};if(g.value.kind==="constant"&&g.value.value instanceof Ma)M(g.value.value.sections);else if(g.value.kind==="source"){var D=function(j){S||(j instanceof yo&&ra(j.value)===ea?M(j.value.sections):j instanceof qo?M(j.sections):j.eachChild(D))},U=g.value;U._styleExpression&&D(U._styleExpression.expression)}return S},o}(Aa),pt={paint:new es({"background-color":new In(pe.paint_background["background-color"]),"background-pattern":new ms(pe.paint_background["background-pattern"]),"background-opacity":new In(pe.paint_background["background-opacity"])})},Et=function(t){function o(u){t.call(this,u,pt)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(Aa),pr={paint:new es({"raster-opacity":new In(pe.paint_raster["raster-opacity"]),"raster-hue-rotate":new In(pe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new In(pe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new In(pe.paint_raster["raster-brightness-max"]),"raster-saturation":new In(pe.paint_raster["raster-saturation"]),"raster-contrast":new In(pe.paint_raster["raster-contrast"]),"raster-resampling":new In(pe.paint_raster["raster-resampling"]),"raster-fade-duration":new In(pe.paint_raster["raster-fade-duration"])})},Ur=function(t){function o(u){t.call(this,u,pr)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(Aa),Nr=function(t){function o(u){t.call(this,u,{}),this.implementation=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},o.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},o.prototype.recalculate=function(){},o.prototype.updateTransitions=function(){},o.prototype.hasTransition=function(){},o.prototype.serialize=function(){},o.prototype.onAdd=function(u){this.implementation.onAdd&&this.implementation.onAdd(u,u.painter.context.gl)},o.prototype.onRemove=function(u){this.implementation.onRemove&&this.implementation.onRemove(u,u.painter.context.gl)},o}(Aa),tn={circle:Lc,heatmap:yh,hillshade:qh,fill:Vf,"fill-extrusion":ol,line:rp,symbol:we,background:Et,raster:Ur},Fr=re.HTMLImageElement,Sn=re.HTMLCanvasElement,sn=re.HTMLVideoElement,bn=re.ImageData,vn=re.ImageBitmap,mn=function(t,o,u,p){this.context=t,this.format=u,this.texture=t.gl.createTexture(),this.update(o,p)};mn.prototype.update=function(t,o,u){var p=t.width,g=t.height,x=!(this.size&&this.size[0]===p&&this.size[1]===g||u),S=this.context,M=S.gl;if(this.useMipmap=Boolean(o&&o.useMipmap),M.bindTexture(M.TEXTURE_2D,this.texture),S.pixelStoreUnpackFlipY.set(!1),S.pixelStoreUnpack.set(1),S.pixelStoreUnpackPremultiplyAlpha.set(this.format===M.RGBA&&(!o||o.premultiply!==!1)),x)this.size=[p,g],t instanceof Fr||t instanceof Sn||t instanceof sn||t instanceof bn||vn&&t instanceof vn?M.texImage2D(M.TEXTURE_2D,0,this.format,this.format,M.UNSIGNED_BYTE,t):M.texImage2D(M.TEXTURE_2D,0,this.format,p,g,0,this.format,M.UNSIGNED_BYTE,t.data);else{var D=u||{x:0,y:0},U=D.x,j=D.y;t instanceof Fr||t instanceof Sn||t instanceof sn||t instanceof bn||vn&&t instanceof vn?M.texSubImage2D(M.TEXTURE_2D,0,U,j,M.RGBA,M.UNSIGNED_BYTE,t):M.texSubImage2D(M.TEXTURE_2D,0,U,j,p,g,M.RGBA,M.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&M.generateMipmap(M.TEXTURE_2D)},mn.prototype.bind=function(t,o,u){var p=this.context.gl;p.bindTexture(p.TEXTURE_2D,this.texture),u!==p.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(u=p.LINEAR),t!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,t),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,u||t),this.filter=t),o!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,o),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,o),this.wrap=o)},mn.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},mn.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Kn=function(t){var o=this;this._callback=t,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){o._triggered=!1,o._callback()})};Kn.prototype.trigger=function(){var t=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){t._triggered=!1,t._callback()},0))},Kn.prototype.remove=function(){delete this._channel,this._callback=function(){}};var wa=function(t,o,u){this.target=t,this.parent=o,this.mapId=u,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},Qt(["receive","process"],this),this.invoker=new Kn(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Pr()?t:re};function Vn(t,o,u){var p=2*Math.PI*6378137/256/Math.pow(2,u);return[t*p-2*Math.PI*6378137/2,o*p-2*Math.PI*6378137/2]}wa.prototype.send=function(t,o,u,p,g){var x=this;g===void 0&&(g=!1);var S=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(this.callbacks[S]=u);var M=Ye(this.globalScope)?void 0:[];return this.target.postMessage({id:S,type:t,hasCallback:!!u,targetMapId:p,mustQueue:g,sourceMapId:this.mapId,data:gu(o,M)},M),{cancel:function(){u&&delete x.callbacks[S],x.target.postMessage({id:S,type:"<cancel>",targetMapId:p,sourceMapId:x.mapId})}}},wa.prototype.receive=function(t){var o=t.data,u=o.id;if(u&&(!o.targetMapId||this.mapId===o.targetMapId))if(o.type==="<cancel>"){delete this.tasks[u];var p=this.cancelCallbacks[u];delete this.cancelCallbacks[u],p&&p()}else Pr()||o.mustQueue?(this.tasks[u]=o,this.taskQueue.push(u),this.invoker.trigger()):this.processTask(u,o)},wa.prototype.process=function(){if(this.taskQueue.length){var t=this.taskQueue.shift(),o=this.tasks[t];delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),o&&this.processTask(t,o)}},wa.prototype.processTask=function(t,o){var u=this;if(o.type==="<response>"){var p=this.callbacks[t];delete this.callbacks[t],p&&(o.error?p(Ns(o.error)):p(null,Ns(o.data)))}else{var g=!1,x=Ye(this.globalScope)?void 0:[],S=o.hasCallback?function(j,G){g=!0,delete u.cancelCallbacks[t],u.target.postMessage({id:t,type:"<response>",sourceMapId:u.mapId,error:j?gu(j):null,data:gu(G,x)},x)}:function(j){g=!0},M=null,D=Ns(o.data);if(this.parent[o.type])M=this.parent[o.type](o.sourceMapId,D,S);else if(this.parent.getWorkerSource){var U=o.type.split(".");M=this.parent.getWorkerSource(o.sourceMapId,U[0],D.source)[U[1]](D,S)}else S(new Error("Could not find function "+o.type));!g&&M&&M.cancel&&(this.cancelCallbacks[t]=M.cancel)}},wa.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var wn=function(t,o){t&&(o?this.setSouthWest(t).setNorthEast(o):t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))};wn.prototype.setNorthEast=function(t){return this._ne=t instanceof ha?new ha(t.lng,t.lat):ha.convert(t),this},wn.prototype.setSouthWest=function(t){return this._sw=t instanceof ha?new ha(t.lng,t.lat):ha.convert(t),this},wn.prototype.extend=function(t){var o,u,p=this._sw,g=this._ne;if(t instanceof ha)o=t,u=t;else{if(!(t instanceof wn))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(wn.convert(t)):this.extend(ha.convert(t)):this;if(u=t._ne,!(o=t._sw)||!u)return this}return p||g?(p.lng=Math.min(o.lng,p.lng),p.lat=Math.min(o.lat,p.lat),g.lng=Math.max(u.lng,g.lng),g.lat=Math.max(u.lat,g.lat)):(this._sw=new ha(o.lng,o.lat),this._ne=new ha(u.lng,u.lat)),this},wn.prototype.getCenter=function(){return new ha((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},wn.prototype.getSouthWest=function(){return this._sw},wn.prototype.getNorthEast=function(){return this._ne},wn.prototype.getNorthWest=function(){return new ha(this.getWest(),this.getNorth())},wn.prototype.getSouthEast=function(){return new ha(this.getEast(),this.getSouth())},wn.prototype.getWest=function(){return this._sw.lng},wn.prototype.getSouth=function(){return this._sw.lat},wn.prototype.getEast=function(){return this._ne.lng},wn.prototype.getNorth=function(){return this._ne.lat},wn.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},wn.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},wn.prototype.isEmpty=function(){return!(this._sw&&this._ne)},wn.prototype.contains=function(t){var o=ha.convert(t),u=o.lng,p=o.lat,g=this._sw.lng<=u&&u<=this._ne.lng;return this._sw.lng>this._ne.lng&&(g=this._sw.lng>=u&&u>=this._ne.lng),this._sw.lat<=p&&p<=this._ne.lat&&g},wn.convert=function(t){return!t||t instanceof wn?t:new wn(t)};var ha=function(t,o){if(isNaN(t)||isNaN(o))throw new Error("Invalid LngLat object: ("+t+", "+o+")");if(this.lng=+t,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};ha.prototype.wrap=function(){return new ha(ir(this.lng,-180,180),this.lat)},ha.prototype.toArray=function(){return[this.lng,this.lat]},ha.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},ha.prototype.distanceTo=function(t){var o=Math.PI/180,u=this.lat*o,p=t.lat*o,g=Math.sin(u)*Math.sin(p)+Math.cos(u)*Math.cos(p)*Math.cos((t.lng-this.lng)*o);return 63710088e-1*Math.acos(Math.min(g,1))},ha.prototype.toBounds=function(t){t===void 0&&(t=0);var o=360*t/40075017,u=o/Math.cos(Math.PI/180*this.lat);return new wn(new ha(this.lng-u,this.lat-o),new ha(this.lng+u,this.lat+o))},ha.convert=function(t){if(t instanceof ha)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new ha(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new ha(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var Nl=2*Math.PI*63710088e-1;function ks(t){return Nl*Math.cos(t*Math.PI/180)}function Cl(t){return(180+t)/360}function Fu(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function qp(t,o){return t/ks(o)}function Bu(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}var zc=function(t,o,u){u===void 0&&(u=0),this.x=+t,this.y=+o,this.z=+u};zc.fromLngLat=function(t,o){o===void 0&&(o=0);var u=ha.convert(t);return new zc(Cl(u.lng),Fu(u.lat),qp(o,u.lat))},zc.prototype.toLngLat=function(){return new ha(360*this.x-180,Bu(this.y))},zc.prototype.toAltitude=function(){return this.z*ks(Bu(this.y))},zc.prototype.meterInMercatorCoordinateUnits=function(){return 1/Nl*(t=Bu(this.y),1/Math.cos(t*Math.PI/180));var t};var Mh=function(t,o,u){this.z=t,this.x=o,this.y=u,this.key=Kp(0,t,t,o,u)};Mh.prototype.equals=function(t){return this.z===t.z&&this.x===t.x&&this.y===t.y},Mh.prototype.url=function(t,o){var u,p,g,x,S,M=(p=this.y,g=this.z,x=Vn(256*(u=this.x),256*(p=Math.pow(2,g)-p-1),g),S=Vn(256*(u+1),256*(p+1),g),x[0]+","+x[1]+","+S[0]+","+S[1]),D=function(U,j,G){for(var ae,le="",Ie=U;Ie>0;Ie--)le+=(j&(ae=1<<Ie-1)?1:0)+(G&ae?2:0);return le}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",D).replace("{bbox-epsg-3857}",M)},Mh.prototype.getTilePoint=function(t){var o=Math.pow(2,this.z);return new ie(8192*(t.x*o-this.x),8192*(t.y*o-this.y))},Mh.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var _m=function(t,o){this.wrap=t,this.canonical=o,this.key=Kp(t,o.z,o.z,o.x,o.y)},ls=function(t,o,u,p,g){this.overscaledZ=t,this.wrap=o,this.canonical=new Mh(u,+p,+g),this.key=Kp(o,t,u,p,g)};function Kp(t,o,u,p,g){(t*=2)<0&&(t=-1*t-1);var x=1<<u;return(x*x*t+x*g+p).toString(36)+u.toString(36)+o.toString(36)}ls.prototype.equals=function(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)},ls.prototype.scaledTo=function(t){var o=this.canonical.z-t;return t>this.canonical.z?new ls(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ls(t,this.wrap,t,this.canonical.x>>o,this.canonical.y>>o)},ls.prototype.calculateScaledKey=function(t,o){var u=this.canonical.z-t;return t>this.canonical.z?Kp(this.wrap*+o,t,this.canonical.z,this.canonical.x,this.canonical.y):Kp(this.wrap*+o,t,t,this.canonical.x>>u,this.canonical.y>>u)},ls.prototype.isChildOf=function(t){if(t.wrap!==this.wrap)return!1;var o=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>o&&t.canonical.y===this.canonical.y>>o},ls.prototype.children=function(t){if(this.overscaledZ>=t)return[new ls(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var o=this.canonical.z+1,u=2*this.canonical.x,p=2*this.canonical.y;return[new ls(o,this.wrap,o,u,p),new ls(o,this.wrap,o,u+1,p),new ls(o,this.wrap,o,u,p+1),new ls(o,this.wrap,o,u+1,p+1)]},ls.prototype.isLessThan=function(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))},ls.prototype.wrapped=function(){return new ls(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},ls.prototype.unwrapTo=function(t){return new ls(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)},ls.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},ls.prototype.toUnwrapped=function(){return new _m(this.wrap,this.canonical)},ls.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},ls.prototype.getTilePoint=function(t){return this.canonical.getTilePoint(new zc(t.x-this.wrap,t.y))},yn("CanonicalTileID",Mh),yn("OverscaledTileID",ls,{omit:["posMatrix"]});var mf=function(t,o,u){if(this.uid=t,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return $e('"'+u+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=o.height;var p=this.dim=o.height-2;this.data=new Uint32Array(o.data.buffer),this.encoding=u||"mapbox";for(var g=0;g<p;g++)this.data[this._idx(-1,g)]=this.data[this._idx(0,g)],this.data[this._idx(p,g)]=this.data[this._idx(p-1,g)],this.data[this._idx(g,-1)]=this.data[this._idx(g,0)],this.data[this._idx(g,p)]=this.data[this._idx(g,p-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(p,-1)]=this.data[this._idx(p-1,0)],this.data[this._idx(-1,p)]=this.data[this._idx(0,p-1)],this.data[this._idx(p,p)]=this.data[this._idx(p-1,p-1)]};mf.prototype.get=function(t,o){var u=new Uint8Array(this.data.buffer),p=4*this._idx(t,o);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(u[p],u[p+1],u[p+2])},mf.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},mf.prototype._idx=function(t,o){if(t<-1||t>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(t+1)},mf.prototype._unpackMapbox=function(t,o,u){return(256*t*256+256*o+u)/10-1e4},mf.prototype._unpackTerrarium=function(t,o,u){return 256*t+o+u/256-32768},mf.prototype.getPixels=function(){return new Go({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},mf.prototype.backfillBorder=function(t,o,u){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");var p=o*this.dim,g=o*this.dim+this.dim,x=u*this.dim,S=u*this.dim+this.dim;switch(o){case-1:p=g-1;break;case 1:g=p+1}switch(u){case-1:x=S-1;break;case 1:S=x+1}for(var M=-o*this.dim,D=-u*this.dim,U=x;U<S;U++)for(var j=p;j<g;j++)this.data[this._idx(j,U)]=t.data[this._idx(j+M,U+D)]},yn("DEMData",mf);var Ld=function(t){this._stringToNumber={},this._numberToString=[];for(var o=0;o<t.length;o++){var u=t[o];this._stringToNumber[u]=o,this._numberToString[o]=u}};Ld.prototype.encode=function(t){return this._stringToNumber[t]},Ld.prototype.decode=function(t){return this._numberToString[t]};var $p=function(t,o,u,p,g){this.type="Feature",this._vectorTileFeature=t,t._z=o,t._x=u,t._y=p,this.properties=t.properties,this.id=g},_v={geometry:{configurable:!0}};_v.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},_v.geometry.set=function(t){this._geometry=t},$p.prototype.toJSON=function(){var t={geometry:this.geometry};for(var o in this)o!=="_geometry"&&o!=="_vectorTileFeature"&&(t[o]=this[o]);return t},Object.defineProperties($p.prototype,_v);var up=function(){this.state={},this.stateChanges={},this.deletedStates={}};up.prototype.updateState=function(t,o,u){var p=String(o);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][p]=this.stateChanges[t][p]||{},bt(this.stateChanges[t][p],u),this.deletedStates[t]===null)for(var g in this.deletedStates[t]={},this.state[t])g!==p&&(this.deletedStates[t][g]=null);else if(this.deletedStates[t]&&this.deletedStates[t][p]===null)for(var x in this.deletedStates[t][p]={},this.state[t][p])u[x]||(this.deletedStates[t][p][x]=null);else for(var S in u)this.deletedStates[t]&&this.deletedStates[t][p]&&this.deletedStates[t][p][S]===null&&delete this.deletedStates[t][p][S]},up.prototype.removeFeatureState=function(t,o,u){if(this.deletedStates[t]!==null){var p=String(o);if(this.deletedStates[t]=this.deletedStates[t]||{},u&&o!==void 0)this.deletedStates[t][p]!==null&&(this.deletedStates[t][p]=this.deletedStates[t][p]||{},this.deletedStates[t][p][u]=null);else if(o!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][p])for(u in this.deletedStates[t][p]={},this.stateChanges[t][p])this.deletedStates[t][p][u]=null;else this.deletedStates[t][p]=null;else this.deletedStates[t]=null}},up.prototype.getState=function(t,o){var u=String(o),p=bt({},(this.state[t]||{})[u],(this.stateChanges[t]||{})[u]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){var g=this.deletedStates[t][o];if(g===null)return{};for(var x in g)delete p[x]}return p},up.prototype.initializeTileState=function(t,o){t.setFeatureState(this.state,o)},up.prototype.coalesceChanges=function(t,o){var u={};for(var p in this.stateChanges){this.state[p]=this.state[p]||{};var g={};for(var x in this.stateChanges[p])this.state[p][x]||(this.state[p][x]={}),bt(this.state[p][x],this.stateChanges[p][x]),g[x]=this.state[p][x];u[p]=g}for(var S in this.deletedStates){this.state[S]=this.state[S]||{};var M={};if(this.deletedStates[S]===null)for(var D in this.state[S])M[D]={},this.state[S][D]={};else for(var U in this.deletedStates[S]){if(this.deletedStates[S][U]===null)this.state[S][U]={};else for(var j=0,G=Object.keys(this.deletedStates[S][U]);j<G.length;j+=1)delete this.state[S][U][G[j]];M[U]=this.state[S][U]}u[S]=u[S]||{},bt(u[S],M)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(var ae in t)t[ae].setFeatureState(u,o)};var gf=function(t,o){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new $u(8192,16,0),this.grid3D=new $u(8192,16,0),this.featureIndexArray=new W,this.promoteId=o};function xm(t,o,u,p,g){return Kt(t,function(x,S){var M=o instanceof js?o.get(S):null;return M&&M.evaluate?M.evaluate(u,p,g):M})}function bm(t){for(var o=1/0,u=1/0,p=-1/0,g=-1/0,x=0,S=t;x<S.length;x+=1){var M=S[x];o=Math.min(o,M.x),u=Math.min(u,M.y),p=Math.max(p,M.x),g=Math.max(g,M.y)}return{minX:o,minY:u,maxX:p,maxY:g}}function p0(t,o){return o-t}gf.prototype.insert=function(t,o,u,p,g,x){var S=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,p,g);for(var M=x?this.grid3D:this.grid,D=0;D<o.length;D++){for(var U=o[D],j=[1/0,1/0,-1/0,-1/0],G=0;G<U.length;G++){var ae=U[G];j[0]=Math.min(j[0],ae.x),j[1]=Math.min(j[1],ae.y),j[2]=Math.max(j[2],ae.x),j[3]=Math.max(j[3],ae.y)}j[0]<8192&&j[1]<8192&&j[2]>=0&&j[3]>=0&&M.insert(S,j[0],j[1],j[2],j[3])}},gf.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new Lr.VectorTile(new Yf(this.rawTileData)).layers,this.sourceLayerCoder=new Ld(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},gf.prototype.query=function(t,o,u,p){var g=this;this.loadVTLayers();for(var x=t.params||{},S=8192/t.tileSize/t.scale,M=wc(x.filter),D=t.queryGeometry,U=t.queryPadding*S,j=bm(D),G=this.grid.query(j.minX-U,j.minY-U,j.maxX+U,j.maxY+U),ae=bm(t.cameraQueryGeometry),le=this.grid3D.query(ae.minX-U,ae.minY-U,ae.maxX+U,ae.maxY+U,function(Gt,Zt,or,Ir){return function(Xr,Dn,ln,Un,gn){for(var ki=0,ii=Xr;ki<ii.length;ki+=1){var Cn=ii[ki];if(Dn<=Cn.x&&ln<=Cn.y&&Un>=Cn.x&&gn>=Cn.y)return!0}var ei=[new ie(Dn,ln),new ie(Dn,gn),new ie(Un,gn),new ie(Un,ln)];if(Xr.length>2){for(var Ei=0,ta=ei;Ei<ta.length;Ei+=1)if(tu(Xr,ta[Ei]))return!0}for(var Zn=0;Zn<Xr.length-1;Zn++)if(ys(Xr[Zn],Xr[Zn+1],ei))return!0;return!1}(t.cameraQueryGeometry,Gt-U,Zt-U,or+U,Ir+U)}),Ie=0,ke=le;Ie<ke.length;Ie+=1)G.push(ke[Ie]);G.sort(p0);for(var Ke,Ue={},st=function(Gt){var Zt=G[Gt];if(Zt!==Ke){Ke=Zt;var or=g.featureIndexArray.get(Zt),Ir=null;g.loadMatchingFeature(Ue,or.bucketIndex,or.sourceLayerIndex,or.featureIndex,M,x.layers,x.availableImages,o,u,p,function(Xr,Dn,ln){return Ir||(Ir=to(Xr)),Dn.queryIntersectsFeature(D,Xr,ln,Ir,g.z,t.transform,S,t.pixelPosMatrix)})}},St=0;St<G.length;St++)st(St);return Ue},gf.prototype.loadMatchingFeature=function(t,o,u,p,g,x,S,M,D,U,j){var G=this.bucketLayerIDs[o];if(!x||function(Xr,Dn){for(var ln=0;ln<Xr.length;ln++)if(Dn.indexOf(Xr[ln])>=0)return!0;return!1}(x,G)){var ae=this.sourceLayerCoder.decode(u),le=this.vtLayers[ae].feature(p);if(g.needGeometry){var Ie=vo(le,!0);if(!g.filter(new Li(this.tileID.overscaledZ),Ie,this.tileID.canonical))return}else if(!g.filter(new Li(this.tileID.overscaledZ),le))return;for(var ke=this.getId(le,ae),Ke=0;Ke<G.length;Ke++){var Ue=G[Ke];if(!(x&&x.indexOf(Ue)<0)){var st=M[Ue];if(st){var St={};ke!==void 0&&U&&(St=U.getState(st.sourceLayer||"_geojsonTileLayer",ke));var Gt=bt({},D[Ue]);Gt.paint=xm(Gt.paint,st.paint,le,St,S),Gt.layout=xm(Gt.layout,st.layout,le,St,S);var Zt=!j||j(le,st,St);if(Zt){var or=new $p(le,this.z,this.x,this.y,ke);or.layer=Gt;var Ir=t[Ue];Ir===void 0&&(Ir=t[Ue]=[]),Ir.push({featureIndex:p,feature:or,intersectionZ:Zt})}}}}}},gf.prototype.lookupSymbolFeatures=function(t,o,u,p,g,x,S,M){var D={};this.loadVTLayers();for(var U=wc(g),j=0,G=t;j<G.length;j+=1)this.loadMatchingFeature(D,u,p,G[j],U,x,S,M,o);return D},gf.prototype.hasLayer=function(t){for(var o=0,u=this.bucketLayerIDs;o<u.length;o+=1)for(var p=0,g=u[o];p<g.length;p+=1)if(t===g[p])return!0;return!1},gf.prototype.getId=function(t,o){var u=t.id;return this.promoteId&&typeof(u=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[o]])=="boolean"&&(u=Number(u)),u},yn("FeatureIndex",gf,{omit:["rawTileData","sourceLayerCoder"]});var As=function(t,o){this.tileID=t,this.uid=At(),this.uses=0,this.tileSize=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};As.prototype.registerFadeDuration=function(t){var o=t+this.timeAdded;o<qi.now()||this.fadeEndTime&&o<this.fadeEndTime||(this.fadeEndTime=o)},As.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},As.prototype.loadVectorData=function(t,o,u){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){for(var p in t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(U,j){var G={};if(!j)return G;for(var ae=function(){var ke=Ie[le],Ke=ke.layerIds.map(function(St){return j.getLayer(St)}).filter(Boolean);if(Ke.length!==0){ke.layers=Ke,ke.stateDependentLayerIds&&(ke.stateDependentLayers=ke.stateDependentLayerIds.map(function(St){return Ke.filter(function(Gt){return Gt.id===St})[0]}));for(var Ue=0,st=Ke;Ue<st.length;Ue+=1)G[st[Ue].id]=ke}},le=0,Ie=U;le<Ie.length;le+=1)ae();return G}(t.buckets,o.style),this.hasSymbolBuckets=!1,this.buckets){var g=this.buckets[p];if(g instanceof Ne){if(this.hasSymbolBuckets=!0,!u)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var x in this.buckets){var S=this.buckets[x];if(S instanceof Ne&&S.hasRTLText){this.hasRTLText=!0,Ps.isLoading()||Ps.isLoaded()||vh()!=="deferred"||Js();break}}for(var M in this.queryPadding=0,this.buckets){var D=this.buckets[M];this.queryPadding=Math.max(this.queryPadding,o.style.getLayer(M).queryRadius(D))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new f},As.prototype.unloadVectorData=function(){for(var t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},As.prototype.getBucket=function(t){return this.buckets[t.id]},As.prototype.upload=function(t){for(var o in this.buckets){var u=this.buckets[o];u.uploadPending()&&u.upload(t)}var p=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new mn(t,this.imageAtlas.image,p.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new mn(t,this.glyphAtlasImage,p.ALPHA),this.glyphAtlasImage=null)},As.prototype.prepare=function(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)},As.prototype.queryRenderedFeatures=function(t,o,u,p,g,x,S,M,D,U){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:p,cameraQueryGeometry:g,scale:x,tileSize:this.tileSize,pixelPosMatrix:U,transform:M,params:S,queryPadding:this.queryPadding*D},t,o,u):{}},As.prototype.querySourceFeatures=function(t,o){var u=this.latestFeatureIndex;if(u&&u.rawTileData){var p=u.loadVTLayers(),g=o?o.sourceLayer:"",x=p._geojsonTileLayer||p[g];if(x)for(var S=wc(o&&o.filter),M=this.tileID.canonical,D=M.z,U=M.x,j=M.y,G={z:D,x:U,y:j},ae=0;ae<x.length;ae++){var le=x.feature(ae);if(S.needGeometry){var Ie=vo(le,!0);if(!S.filter(new Li(this.tileID.overscaledZ),Ie,this.tileID.canonical))continue}else if(!S.filter(new Li(this.tileID.overscaledZ),le))continue;var ke=u.getId(le,g),Ke=new $p(le,D,U,j,ke);Ke.tile=G,t.push(Ke)}}},As.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},As.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},As.prototype.setExpiryData=function(t){var o=this.expirationTime;if(t.cacheControl){var u=Wr(t.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){var p=Date.now(),g=!1;if(this.expirationTime>p)g=!1;else if(o)if(this.expirationTime<o)g=!0;else{var x=this.expirationTime-o;x?this.expirationTime=p+Math.max(x,3e4):g=!0}else g=!0;g?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},As.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},As.prototype.setFeatureState=function(t,o){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(t).length!==0){var u=this.latestFeatureIndex.loadVTLayers();for(var p in this.buckets)if(o.style.hasLayer(p)){var g=this.buckets[p],x=g.layers[0].sourceLayer||"_geojsonTileLayer",S=u[x],M=t[x];if(S&&M&&Object.keys(M).length!==0){g.update(M,S,this.imageAtlas&&this.imageAtlas.patternPositions||{});var D=o&&o.style&&o.style.getLayer(p);D&&(this.queryPadding=Math.max(this.queryPadding,D.queryRadius(g)))}}}},As.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},As.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<qi.now()},As.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},As.prototype.setHoldDuration=function(t){this.symbolFadeHoldUntil=qi.now()+t},As.prototype.setDependencies=function(t,o){for(var u={},p=0,g=o;p<g.length;p+=1)u[g[p]]=!0;this.dependencies[t]=u},As.prototype.hasDependency=function(t,o){for(var u=0,p=t;u<p.length;u+=1){var g=this.dependencies[p[u]];if(g){for(var x=0,S=o;x<S.length;x+=1)if(g[S[x]])return!0}}return!1};var qf=re.performance,Em=function(t){this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},qf.mark(this._marks.start)};Em.prototype.finish=function(){qf.mark(this._marks.end);var t=qf.getEntriesByName(this._marks.measure);return t.length===0&&(qf.measure(this._marks.measure,this._marks.start,this._marks.end),t=qf.getEntriesByName(this._marks.measure),qf.clearMarks(this._marks.start),qf.clearMarks(this._marks.end),qf.clearMeasures(this._marks.measure)),t},v.Actor=wa,v.AlphaImage=pu,v.CanonicalTileID=Mh,v.CollisionBoxArray=f,v.Color=Gi,v.DEMData=mf,v.DataConstantProperty=In,v.DictionaryCoder=Ld,v.EXTENT=8192,v.ErrorEvent=We,v.EvaluationParameters=Li,v.Event=Oe,v.Evented=nt,v.FeatureIndex=gf,v.FillBucket=ru,v.FillExtrusionBucket=al,v.ImageAtlas=br,v.ImagePosition=ut,v.LineBucket=ya,v.LngLat=ha,v.LngLatBounds=wn,v.MercatorCoordinate=zc,v.ONE_EM=24,v.OverscaledTileID=ls,v.Point=ie,v.Point$1=ie,v.Properties=es,v.Protobuf=Yf,v.RGBAImage=Go,v.RequestManager=Di,v.RequestPerformance=Em,v.ResourceType=rn,v.SegmentVector=he,v.SourceFeatureState=up,v.StructArrayLayout1ui2=gh,v.StructArrayLayout2f1f2i16=yl,v.StructArrayLayout2i4=Rl,v.StructArrayLayout3ui6=el,v.StructArrayLayout4i8=xu,v.SymbolBucket=Ne,v.Texture=mn,v.Tile=As,v.Transitionable=po,v.Uniform1f=Br,v.Uniform1i=vr,v.Uniform2f=Dr,v.Uniform3f=an,v.Uniform4f=Bn,v.UniformColor=kn,v.UniformMatrix4f=Bi,v.UnwrappedTileID=_m,v.ValidationError=Fe,v.WritingMode=zr,v.ZoomHistory=Rf,v.add=function(t,o,u){return t[0]=o[0]+u[0],t[1]=o[1]+u[1],t[2]=o[2]+u[2],t},v.addDynamicAttributes=He,v.asyncAll=function(t,o,u){if(!t.length)return u(null,[]);var p=t.length,g=new Array(t.length),x=null;t.forEach(function(S,M){o(S,function(D,U){D&&(x=D),g[M]=U,--p==0&&u(x,g)})})},v.bezier=Ce,v.bindAll=Qt,v.browser=qi,v.cacheEntryPossiblyAdded=function(t){++ci>Tr&&(t.getActor().send("enforceCacheSizeLimit",sr),ci=0)},v.clamp=Mt,v.clearTileCache=function(t){var o=re.caches.delete("mapbox-tiles");t&&o.catch(t).then(function(){return t()})},v.clipLine=Eo,v.clone=function(t){var o=new Qi(16);return o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7],o[8]=t[8],o[9]=t[9],o[10]=t[10],o[11]=t[11],o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15],o},v.clone$1=qe,v.clone$2=function(t){var o=new Qi(3);return o[0]=t[0],o[1]=t[1],o[2]=t[2],o},v.collisionCircleLayout=Od,v.config=jn,v.create=function(){var t=new Qi(16);return Qi!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},v.create$1=function(){var t=new Qi(9);return Qi!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},v.create$2=function(){var t=new Qi(4);return Qi!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},v.createCommonjsModule=te,v.createExpression=Pu,v.createLayout=Ia,v.createStyleLayer=function(t){return t.type==="custom"?new Nr(t):new tn[t.type](t)},v.cross=function(t,o,u){var p=o[0],g=o[1],x=o[2],S=u[0],M=u[1],D=u[2];return t[0]=g*D-x*M,t[1]=x*S-p*D,t[2]=p*M-g*S,t},v.deepEqual=function t(o,u){if(Array.isArray(o)){if(!Array.isArray(u)||o.length!==u.length)return!1;for(var p=0;p<o.length;p++)if(!t(o[p],u[p]))return!1;return!0}if(typeof o=="object"&&o!==null&&u!==null){if(typeof u!="object"||Object.keys(o).length!==Object.keys(u).length)return!1;for(var g in o)if(!t(o[g],u[g]))return!1;return!0}return o===u},v.dot=function(t,o){return t[0]*o[0]+t[1]*o[1]+t[2]*o[2]},v.dot$1=function(t,o){return t[0]*o[0]+t[1]*o[1]+t[2]*o[2]+t[3]*o[3]},v.ease=tt,v.emitValidationErrors=Kl,v.endsWith=X,v.enforceCacheSizeLimit=function(t){I(),Ki&&Ki.then(function(o){o.keys().then(function(u){for(var p=0;p<u.length-t;p++)o.delete(u[p])})})},v.evaluateSizeForFeature=$n,v.evaluateSizeForZoom=pi,v.evaluateVariableOffset=Sl,v.evented=kf,v.extend=bt,v.featureFilter=wc,v.filterObject=vt,v.fromRotation=function(t,o){var u=Math.sin(o),p=Math.cos(o);return t[0]=p,t[1]=u,t[2]=0,t[3]=-u,t[4]=p,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},v.getAnchorAlignment=Jr,v.getAnchorJustification=Me,v.getArrayBuffer=Da,v.getImage=$,v.getJSON=function(t,o){return _a(bt(t,{type:"json"}),o)},v.getRTLTextPluginStatus=vh,v.getReferrer=Ii,v.getVideo=function(t,o){var u,p,g=re.document.createElement("video");g.muted=!0,g.onloadstart=function(){o(null,g)};for(var x=0;x<t.length;x++){var S=re.document.createElement("source");u=t[x],p=void 0,(p=re.document.createElement("a")).href=u,(p.protocol!==re.document.location.protocol||p.host!==re.document.location.host)&&(g.crossOrigin="Anonymous"),S.src=t[x],g.appendChild(S)}return{cancel:function(){}}},v.identity=Rs,v.invert=function(t,o){var u=o[0],p=o[1],g=o[2],x=o[3],S=o[4],M=o[5],D=o[6],U=o[7],j=o[8],G=o[9],ae=o[10],le=o[11],Ie=o[12],ke=o[13],Ke=o[14],Ue=o[15],st=u*M-p*S,St=u*D-g*S,Gt=u*U-x*S,Zt=p*D-g*M,or=p*U-x*M,Ir=g*U-x*D,Xr=j*ke-G*Ie,Dn=j*Ke-ae*Ie,ln=j*Ue-le*Ie,Un=G*Ke-ae*ke,gn=G*Ue-le*ke,ki=ae*Ue-le*Ke,ii=st*ki-St*gn+Gt*Un+Zt*ln-or*Dn+Ir*Xr;return ii?(t[0]=(M*ki-D*gn+U*Un)*(ii=1/ii),t[1]=(g*gn-p*ki-x*Un)*ii,t[2]=(ke*Ir-Ke*or+Ue*Zt)*ii,t[3]=(ae*or-G*Ir-le*Zt)*ii,t[4]=(D*ln-S*ki-U*Dn)*ii,t[5]=(u*ki-g*ln+x*Dn)*ii,t[6]=(Ke*Gt-Ie*Ir-Ue*St)*ii,t[7]=(j*Ir-ae*Gt+le*St)*ii,t[8]=(S*gn-M*ln+U*Xr)*ii,t[9]=(p*ln-u*gn-x*Xr)*ii,t[10]=(Ie*or-ke*Gt+Ue*st)*ii,t[11]=(G*Gt-j*or-le*st)*ii,t[12]=(M*Dn-S*Un-D*Xr)*ii,t[13]=(u*Un-p*Dn+g*Xr)*ii,t[14]=(ke*St-Ie*Zt-Ke*st)*ii,t[15]=(j*Zt-G*St+ae*st)*ii,t):null},v.isChar=Kr,v.isMapboxURL=Ai,v.keysDifference=function(t,o){var u=[];for(var p in t)p in o||u.push(p);return u},v.makeRequest=_a,v.mapObject=Kt,v.mercatorXfromLng=Cl,v.mercatorYfromLat=Fu,v.mercatorZfromAltitude=qp,v.mul=xl,v.multiply=as,v.mvt=Lr,v.nextPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},v.normalize=function(t,o){var u=o[0],p=o[1],g=o[2],x=u*u+p*p+g*g;return x>0&&(x=1/Math.sqrt(x)),t[0]=o[0]*x,t[1]=o[1]*x,t[2]=o[2]*x,t},v.number=sa,v.offscreenCanvasSupported=Gn,v.ortho=function(t,o,u,p,g,x,S){var M=1/(o-u),D=1/(p-g),U=1/(x-S);return t[0]=-2*M,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*D,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*U,t[11]=0,t[12]=(o+u)*M,t[13]=(g+p)*D,t[14]=(S+x)*U,t[15]=1,t},v.parseGlyphPBF=function(t){return new Yf(t).readFields(Rr,[])},v.pbf=Yf,v.performSymbolLayout=function(t,o,u,p,g,x,S){t.createArrays(),t.tilePixelRatio=8192/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;var M=t.layers[0].layout,D=t.layers[0]._unevaluatedLayout._values,U={};if(t.textSizeData.kind==="composite"){var j=t.textSizeData,G=j.maxZoom;U.compositeTextSizes=[D["text-size"].possiblyEvaluate(new Li(j.minZoom),S),D["text-size"].possiblyEvaluate(new Li(G),S)]}if(t.iconSizeData.kind==="composite"){var ae=t.iconSizeData,le=ae.maxZoom;U.compositeIconSizes=[D["icon-size"].possiblyEvaluate(new Li(ae.minZoom),S),D["icon-size"].possiblyEvaluate(new Li(le),S)]}U.layoutTextSize=D["text-size"].possiblyEvaluate(new Li(t.zoom+1),S),U.layoutIconSize=D["icon-size"].possiblyEvaluate(new Li(t.zoom+1),S),U.textMaxSize=D["text-size"].possiblyEvaluate(new Li(18));for(var Ie=24*M.get("text-line-height"),ke=M.get("text-rotation-alignment")==="map"&&M.get("symbol-placement")!=="point",Ke=M.get("text-keep-upright"),Ue=M.get("text-size"),st=function(){var Zt=Gt[St],or=M.get("text-font").evaluate(Zt,{},S).join(","),Ir=Ue.evaluate(Zt,{},S),Xr=U.layoutTextSize.evaluate(Zt,{},S),Dn=U.layoutIconSize.evaluate(Zt,{},S),ln={horizontal:{},vertical:void 0},Un=Zt.text,gn=[0,0];if(Un){var ki=Un.toString(),ii=24*M.get("text-letter-spacing").evaluate(Zt,{},S),Cn=function(Wi){for(var Na=0,Oa=Wi;Na<Oa.length;Na+=1)if(ia=Oa[Na].charCodeAt(0),Kr.Arabic(ia)||Kr["Arabic Supplement"](ia)||Kr["Arabic Extended-A"](ia)||Kr["Arabic Presentation Forms-A"](ia)||Kr["Arabic Presentation Forms-B"](ia))return!1;var ia;return!0}(ki)?ii:0,ei=M.get("text-anchor").evaluate(Zt,{},S),Ei=M.get("text-variable-anchor");if(!Ei){var ta=M.get("text-radial-offset").evaluate(Zt,{},S);gn=ta?Sl(ei,[24*ta,Po]):M.get("text-offset").evaluate(Zt,{},S).map(function(Wi){return 24*Wi})}var Zn=ke?"center":M.get("text-justify").evaluate(Zt,{},S),ua=M.get("symbol-placement"),ro=ua==="point"?24*M.get("text-max-width").evaluate(Zt,{},S):0,Io=function(){t.allowVerticalPlacement&&tf(ki)&&(ln.vertical=Vr(Un,o,u,g,or,ro,Ie,ei,"left",Cn,gn,zr.vertical,!0,ua,Xr,Ir))};if(!ke&&Ei){for(var So=Zn==="auto"?Ei.map(function(Wi){return Me(Wi)}):[Zn],fo=!1,Oo=0;Oo<So.length;Oo++){var Ea=So[Oo];if(!ln.horizontal[Ea])if(fo)ln.horizontal[Ea]=ln.horizontal[0];else{var cs=Vr(Un,o,u,g,or,ro,Ie,"center",Ea,Cn,gn,zr.horizontal,!1,ua,Xr,Ir);cs&&(ln.horizontal[Ea]=cs,fo=cs.positionedLines.length===1)}}Io()}else{Zn==="auto"&&(Zn=Me(ei));var Mi=Vr(Un,o,u,g,or,ro,Ie,ei,Zn,Cn,gn,zr.horizontal,!1,ua,Xr,Ir);Mi&&(ln.horizontal[Zn]=Mi),Io(),tf(ki)&&ke&&Ke&&(ln.vertical=Vr(Un,o,u,g,or,ro,Ie,ei,Zn,Cn,gn,zr.vertical,!1,ua,Xr,Ir))}}var _s=void 0,Xs=!1;if(Zt.icon&&Zt.icon.name){var No=p[Zt.icon.name];No&&(_s=function(Wi,Na,Oa){var ia=Jr(Oa),Ys=Na[0]-Wi.displaySize[0]*ia.horizontalAlign,ws=Na[1]-Wi.displaySize[1]*ia.verticalAlign;return{image:Wi,top:ws,bottom:ws+Wi.displaySize[1],left:Ys,right:Ys+Wi.displaySize[0]}}(g[Zt.icon.name],M.get("icon-offset").evaluate(Zt,{},S),M.get("icon-anchor").evaluate(Zt,{},S)),Xs=No.sdf,t.sdfIcons===void 0?t.sdfIcons=No.sdf:t.sdfIcons!==No.sdf&&$e("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(No.pixelRatio!==t.pixelRatio||M.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}var ee=Ct(ln.horizontal)||ln.vertical;t.iconsInText=!!ee&&ee.iconsInText,(ee||_s)&&function(Wi,Na,Oa,ia,Ys,ws,ka,zo,Ts,pa,zl){var Cu=ws.textMaxSize.evaluate(Na,{});Cu===void 0&&(Cu=ka);var sl,Uo=Wi.layers[0].layout,lc=Uo.get("icon-offset").evaluate(Na,{},zl),ul=Ct(Oa.horizontal),Kf=ka/24,yf=Wi.tilePixelRatio*Kf,$f=Wi.tilePixelRatio*Cu/24,cc=Wi.tilePixelRatio*zo,fc=Wi.tilePixelRatio*Uo.get("symbol-spacing"),lp=Uo.get("text-padding")*Wi.tilePixelRatio,Jf=Uo.get("icon-padding")*Wi.tilePixelRatio,Ph=Uo.get("text-max-angle")/180*Math.PI,Jp=Uo.get("text-rotation-alignment")==="map"&&Uo.get("symbol-placement")!=="point",Qp=Uo.get("icon-rotation-alignment")==="map"&&Uo.get("symbol-placement")!=="point",hc=Uo.get("symbol-placement"),cp=fc/2,pc=Uo.get("icon-text-fit");ia&&pc!=="none"&&(Wi.allowVerticalPlacement&&Oa.vertical&&(sl=ai(ia,Oa.vertical,pc,Uo.get("icon-text-fit-padding"),lc,Kf)),ul&&(ia=ai(ia,ul,pc,Uo.get("icon-text-fit-padding"),lc,Kf)));var _f=function(xv,kh){kh.x<0||kh.x>=8192||kh.y<0||kh.y>=8192||function(Ro,Al,bv,Zc,ad,Bd,vp,Ul,mp,xs,gp,yp,od,Nd,Dh,zd,Ud,Zd,jd,Vd,Au,_p,Gd,Zl,Ev){var Sv,th,Fh,Bh,rh,Nh=Ro.addToLineVertexArray(Al,bv),Cv=0,Hd=0,Wd=0,Xd=0,sd=-1,nh=-1,dc={},Av=Ae(""),Yd=0,qd=0;if(Ul._unevaluatedLayout.getValue("text-radial-offset")===void 0?(Yd=(Sv=Ul.layout.get("text-offset").evaluate(Au,{},Zl).map(function(Ep){return 24*Ep}))[0],qd=Sv[1]):(Yd=24*Ul.layout.get("text-radial-offset").evaluate(Au,{},Zl),qd=Po),Ro.allowVerticalPlacement&&Zc.vertical){var wv=Ul.layout.get("text-rotate").evaluate(Au,{},Zl)+90;Bh=new Xo(mp,Al,xs,gp,yp,Zc.vertical,od,Nd,Dh,wv),vp&&(rh=new Xo(mp,Al,xs,gp,yp,vp,Ud,Zd,Dh,wv))}if(ad){var Kd=Ul.layout.get("icon-rotate").evaluate(Au,{}),Tv=Ul.layout.get("icon-text-fit")!=="none",Mv=ts(ad,Kd,Gd,Tv),$d=vp?ts(vp,Kd,Gd,Tv):void 0;Fh=new Xo(mp,Al,xs,gp,yp,ad,Ud,Zd,!1,Kd),Cv=4*Mv.length;var Pv=Ro.iconSizeData,xp=null;Pv.kind==="source"?(xp=[128*Ul.layout.get("icon-size").evaluate(Au,{})])[0]>32640&&$e(Ro.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):Pv.kind==="composite"&&((xp=[128*_p.compositeIconSizes[0].evaluate(Au,{},Zl),128*_p.compositeIconSizes[1].evaluate(Au,{},Zl)])[0]>32640||xp[1]>32640)&&$e(Ro.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),Ro.addSymbols(Ro.icon,Mv,xp,Vd,jd,Au,!1,Al,Nh.lineStartIndex,Nh.lineLength,-1,Zl),sd=Ro.icon.placedSymbolArray.length-1,$d&&(Hd=4*$d.length,Ro.addSymbols(Ro.icon,$d,xp,Vd,jd,Au,zr.vertical,Al,Nh.lineStartIndex,Nh.lineLength,-1,Zl),nh=Ro.icon.placedSymbolArray.length-1)}for(var Iv in Zc.horizontal){var ud=Zc.horizontal[Iv];if(!th){Av=Ae(ud.text);var Sm=Ul.layout.get("text-rotate").evaluate(Au,{},Zl);th=new Xo(mp,Al,xs,gp,yp,ud,od,Nd,Dh,Sm)}var Ov=ud.positionedLines.length===1;if(Wd+=Bt(Ro,Al,ud,Bd,Ul,Dh,Au,zd,Nh,Zc.vertical?zr.horizontal:zr.horizontalOnly,Ov?Object.keys(Zc.horizontal):[Iv],dc,sd,_p,Zl),Ov)break}Zc.vertical&&(Xd+=Bt(Ro,Al,Zc.vertical,Bd,Ul,Dh,Au,zd,Nh,zr.vertical,["vertical"],dc,nh,_p,Zl));var Cm=th?th.boxStartIndex:Ro.collisionBoxArray.length,Am=th?th.boxEndIndex:Ro.collisionBoxArray.length,wm=Bh?Bh.boxStartIndex:Ro.collisionBoxArray.length,ld=Bh?Bh.boxEndIndex:Ro.collisionBoxArray.length,Ef=Fh?Fh.boxStartIndex:Ro.collisionBoxArray.length,Rv=Fh?Fh.boxEndIndex:Ro.collisionBoxArray.length,Lv=rh?rh.boxStartIndex:Ro.collisionBoxArray.length,cd=rh?rh.boxEndIndex:Ro.collisionBoxArray.length,jl=-1,bp=function(Ep,Dv){return Ep&&Ep.circleDiameter?Math.max(Ep.circleDiameter,Dv):Dv};jl=bp(th,jl),jl=bp(Bh,jl),jl=bp(Fh,jl);var kv=(jl=bp(rh,jl))>-1?1:0;kv&&(jl*=Ev/24),Ro.glyphOffsetArray.length>=Ne.MAX_GLYPHS&&$e("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Au.sortKey!==void 0&&Ro.addToSortKeyRanges(Ro.symbolInstances.length,Au.sortKey),Ro.symbolInstances.emplaceBack(Al.x,Al.y,dc.right>=0?dc.right:-1,dc.center>=0?dc.center:-1,dc.left>=0?dc.left:-1,dc.vertical||-1,sd,nh,Av,Cm,Am,wm,ld,Ef,Rv,Lv,cd,xs,Wd,Xd,Cv,Hd,kv,0,od,Yd,qd,jl)}(Wi,kh,xv,Oa,ia,Ys,sl,Wi.layers[0],Wi.collisionBoxArray,Na.index,Na.sourceLayerIndex,Wi.index,yf,lp,Jp,Ts,cc,Jf,Qp,lc,Na,ws,pa,zl,ka)};if(hc==="line")for(var Nu=0,ed=Eo(Na.geometry,0,0,8192,8192);Nu<ed.length;Nu+=1)for(var td=ed[Nu],Uc=0,Ih=Ho(td,fc,Ph,Oa.vertical||ul,ia,24,$f,Wi.overscaling,8192);Uc<Ih.length;Uc+=1){var fp=Ih[Uc];ul&&dn(Wi,ul.text,cp,fp)||_f(td,fp)}else if(hc==="line-center")for(var Oh=0,Qf=Na.geometry;Oh<Qf.length;Oh+=1){var Rh=Qf[Oh];if(Rh.length>1){var hp=Ka(Rh,Ph,Oa.vertical||ul,ia,24,$f);hp&&_f(Rh,hp)}}else if(Na.type==="Polygon")for(var xf=0,kd=El(Na.geometry,0);xf<kd.length;xf+=1){var Lh=kd[xf],pp=ni(Lh,16);_f(Lh[0],new qr(pp.x,pp.y,0))}else if(Na.type==="LineString")for(var bf=0,dp=Na.geometry;bf<dp.length;bf+=1){var eh=dp[bf];_f(eh,new qr(eh[0].x,eh[0].y,0))}else if(Na.type==="Point")for(var rd=0,Dd=Na.geometry;rd<Dd.length;rd+=1)for(var nd=0,Fd=Dd[rd];nd<Fd.length;nd+=1){var id=Fd[nd];_f([id],new qr(id.x,id.y,0))}}(t,Zt,ln,_s,p,U,Xr,Dn,gn,Xs,S)},St=0,Gt=t.features;St<Gt.length;St+=1)st();x&&t.generateCollisionDebugBuffers()},v.perspective=function(t,o,u,p,g){var x,S=1/Math.tan(o/2);return t[0]=S/u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=S,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,g!=null&&g!==1/0?(t[10]=(g+p)*(x=1/(p-g)),t[14]=2*g*p*x):(t[10]=-1,t[14]=-2*p),t},v.pick=function(t,o){for(var u={},p=0;p<o.length;p++){var g=o[p];g in t&&(u[g]=t[g])}return u},v.plugin=Ps,v.polygonIntersectsPolygon=Va,v.postMapLoadEvent=jt,v.postTurnstileEvent=Xa,v.potpack=Mr,v.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],v.register=yn,v.registerForPluginStateChange=function(t){return t({pluginStatus:Ms,pluginURL:wo}),kf.on("pluginStateChange",t),t},v.renderColorRamp=Ff,v.rotate=function(t,o,u){var p=o[0],g=o[1],x=o[2],S=o[3],M=Math.sin(u),D=Math.cos(u);return t[0]=p*D+x*M,t[1]=g*D+S*M,t[2]=p*-M+x*D,t[3]=g*-M+S*D,t},v.rotateX=function(t,o,u){var p=Math.sin(u),g=Math.cos(u),x=o[4],S=o[5],M=o[6],D=o[7],U=o[8],j=o[9],G=o[10],ae=o[11];return o!==t&&(t[0]=o[0],t[1]=o[1],t[2]=o[2],t[3]=o[3],t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15]),t[4]=x*g+U*p,t[5]=S*g+j*p,t[6]=M*g+G*p,t[7]=D*g+ae*p,t[8]=U*g-x*p,t[9]=j*g-S*p,t[10]=G*g-M*p,t[11]=ae*g-D*p,t},v.rotateZ=function(t,o,u){var p=Math.sin(u),g=Math.cos(u),x=o[0],S=o[1],M=o[2],D=o[3],U=o[4],j=o[5],G=o[6],ae=o[7];return o!==t&&(t[8]=o[8],t[9]=o[9],t[10]=o[10],t[11]=o[11],t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15]),t[0]=x*g+U*p,t[1]=S*g+j*p,t[2]=M*g+G*p,t[3]=D*g+ae*p,t[4]=U*g-x*p,t[5]=j*g-S*p,t[6]=G*g-M*p,t[7]=ae*g-D*p,t},v.scale=function(t,o,u){var p=u[0],g=u[1],x=u[2];return t[0]=o[0]*p,t[1]=o[1]*p,t[2]=o[2]*p,t[3]=o[3]*p,t[4]=o[4]*g,t[5]=o[5]*g,t[6]=o[6]*g,t[7]=o[7]*g,t[8]=o[8]*x,t[9]=o[9]*x,t[10]=o[10]*x,t[11]=o[11]*x,t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15],t},v.scale$1=function(t,o,u){return t[0]=o[0]*u,t[1]=o[1]*u,t[2]=o[2]*u,t[3]=o[3]*u,t},v.scale$2=function(t,o,u){return t[0]=o[0]*u,t[1]=o[1]*u,t[2]=o[2]*u,t},v.setCacheLimits=function(t,o){sr=t,Tr=o},v.setRTLTextPlugin=function(t,o,u){if(u===void 0&&(u=!1),Ms==="deferred"||Ms==="loading"||Ms==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");wo=qi.resolveURL(t),Ms="deferred",Ru=o,ba(),u||Js()},v.sphericalToCartesian=function(t){var o=t[0],u=t[1],p=t[2];return u+=90,u*=Math.PI/180,p*=Math.PI/180,{x:o*Math.cos(u)*Math.sin(p),y:o*Math.sin(u)*Math.sin(p),z:o*Math.cos(p)}},v.sqrLen=function(t){var o=t[0],u=t[1];return o*o+u*u},v.styleSpec=pe,v.sub=function(t,o,u){return t[0]=o[0]-u[0],t[1]=o[1]-u[1],t[2]=o[2]-u[2],t},v.symbolSize=Ni,v.transformMat3=function(t,o,u){var p=o[0],g=o[1],x=o[2];return t[0]=p*u[0]+g*u[3]+x*u[6],t[1]=p*u[1]+g*u[4]+x*u[7],t[2]=p*u[2]+g*u[5]+x*u[8],t},v.transformMat4=ic,v.translate=function(t,o,u){var p,g,x,S,M,D,U,j,G,ae,le,Ie,ke=u[0],Ke=u[1],Ue=u[2];return o===t?(t[12]=o[0]*ke+o[4]*Ke+o[8]*Ue+o[12],t[13]=o[1]*ke+o[5]*Ke+o[9]*Ue+o[13],t[14]=o[2]*ke+o[6]*Ke+o[10]*Ue+o[14],t[15]=o[3]*ke+o[7]*Ke+o[11]*Ue+o[15]):(g=o[1],x=o[2],S=o[3],M=o[4],D=o[5],U=o[6],j=o[7],G=o[8],ae=o[9],le=o[10],Ie=o[11],t[0]=p=o[0],t[1]=g,t[2]=x,t[3]=S,t[4]=M,t[5]=D,t[6]=U,t[7]=j,t[8]=G,t[9]=ae,t[10]=le,t[11]=Ie,t[12]=p*ke+M*Ke+G*Ue+o[12],t[13]=g*ke+D*Ke+ae*Ue+o[13],t[14]=x*ke+U*Ke+le*Ue+o[14],t[15]=S*ke+j*Ke+Ie*Ue+o[15]),t},v.triggerPluginCompletionEvent=dh,v.uniqueId=At,v.validateCustomStyleLayer=function(t){var o=[],u=t.id;return u===void 0&&o.push({message:"layers."+u+': missing required property "id"'}),t.render===void 0&&o.push({message:"layers."+u+': missing required method "render"'}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&o.push({message:"layers."+u+': property "renderingMode" must be either "2d" or "3d"'}),o},v.validateLight=Xh,v.validateStyle=ef,v.values=function(t){var o=[];for(var u in t)o.push(t[u]);return o},v.vectorTile=Lr,v.version="1.13.2",v.warnOnce=$e,v.webpSupported=Xn,v.window=re,v.wrap=ir}),J(["./shared"],function(v){"use strict";function te(V){var $=typeof V;if($==="number"||$==="boolean"||$==="string"||V==null)return JSON.stringify(V);if(Array.isArray(V)){for(var se="[",ge=0,Oe=V;ge<Oe.length;ge+=1)se+=te(Oe[ge])+",";return se+"]"}for(var We=Object.keys(V).sort(),nt="{",pe=0;pe<We.length;pe++)nt+=JSON.stringify(We[pe])+":"+te(V[We[pe]])+",";return nt+"}"}function B(V){for(var $="",se=0,ge=v.refProperties;se<ge.length;se+=1)$+="/"+te(V[ge[se]]);return $}var Q=function(V){this.keyCache={},V&&this.replace(V)};Q.prototype.replace=function(V){this._layerConfigs={},this._layers={},this.update(V,[])},Q.prototype.update=function(V,$){for(var se=this,ge=0,Oe=V;ge<Oe.length;ge+=1){var We=Oe[ge];this._layerConfigs[We.id]=We;var nt=this._layers[We.id]=v.createStyleLayer(We);nt._featureFilter=v.featureFilter(nt.filter),this.keyCache[We.id]&&delete this.keyCache[We.id]}for(var pe=0,Fe=$;pe<Fe.length;pe+=1){var yt=Fe[pe];delete this.keyCache[yt],delete this._layerConfigs[yt],delete this._layers[yt]}this.familiesBySource={};for(var dr=0,Dt=function(Zr,Yr){for(var oi={},Qr=0;Qr<Zr.length;Qr++){var Ti=Yr&&Yr[Zr[Qr].id]||B(Zr[Qr]);Yr&&(Yr[Zr[Qr].id]=Ti);var ea=oi[Ti];ea||(ea=oi[Ti]=[]),ea.push(Zr[Qr])}var bi=[];for(var Oi in oi)bi.push(oi[Oi]);return bi}(v.values(this._layerConfigs),this.keyCache);dr<Dt.length;dr+=1){var zt=Dt[dr].map(function(Zr){return se._layers[Zr.id]}),gr=zt[0];if(gr.visibility!=="none"){var En=gr.source||"",un=this.familiesBySource[En];un||(un=this.familiesBySource[En]={});var Tt=gr.sourceLayer||"_geojsonTileLayer",nn=un[Tt];nn||(nn=un[Tt]=[]),nn.push(zt)}}};var ie=function(V){var $={},se=[];for(var ge in V){var Oe=V[ge],We=$[ge]={};for(var nt in Oe){var pe=Oe[+nt];if(pe&&pe.bitmap.width!==0&&pe.bitmap.height!==0){var Fe={x:0,y:0,w:pe.bitmap.width+2,h:pe.bitmap.height+2};se.push(Fe),We[nt]={rect:Fe,metrics:pe.metrics}}}}var yt=v.potpack(se),dr=new v.AlphaImage({width:yt.w||1,height:yt.h||1});for(var Dt in V){var zt=V[Dt];for(var gr in zt){var En=zt[+gr];if(En&&En.bitmap.width!==0&&En.bitmap.height!==0){var un=$[Dt][gr].rect;v.AlphaImage.copy(En.bitmap,dr,{x:0,y:0},{x:un.x+1,y:un.y+1},En.bitmap)}}}this.image=dr,this.positions=$};v.register("GlyphAtlas",ie);var Ee=function(V){this.tileID=new v.OverscaledTileID(V.tileID.overscaledZ,V.tileID.wrap,V.tileID.canonical.z,V.tileID.canonical.x,V.tileID.canonical.y),this.uid=V.uid,this.zoom=V.zoom,this.pixelRatio=V.pixelRatio,this.tileSize=V.tileSize,this.source=V.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=V.showCollisionBoxes,this.collectResourceTiming=!!V.collectResourceTiming,this.returnDependencies=!!V.returnDependencies,this.promoteId=V.promoteId};function re(V,$,se){for(var ge=new v.EvaluationParameters($),Oe=0,We=V;Oe<We.length;Oe+=1)We[Oe].recalculate(ge,se)}function Ge(V,$){var se=v.getArrayBuffer(V.request,function(ge,Oe,We,nt){ge?$(ge):Oe&&$(null,{vectorTile:new v.vectorTile.VectorTile(new v.pbf(Oe)),rawData:Oe,cacheControl:We,expires:nt})});return function(){se.cancel(),$()}}Ee.prototype.parse=function(V,$,se,ge,Oe){var We=this;this.status="parsing",this.data=V,this.collisionBoxArray=new v.CollisionBoxArray;var nt=new v.DictionaryCoder(Object.keys(V.layers).sort()),pe=new v.FeatureIndex(this.tileID,this.promoteId);pe.bucketLayerIDs=[];var Fe,yt,dr,Dt,zt={},gr={featureIndex:pe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:se},En=$.familiesBySource[this.source];for(var un in En){var Tt=V.layers[un];if(Tt){Tt.version===1&&v.warnOnce('Vector tile source "'+this.source+'" layer "'+un+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var nn=nt.encode(un),Zr=[],Yr=0;Yr<Tt.length;Yr++){var oi=Tt.feature(Yr),Qr=pe.getId(oi,un);Zr.push({feature:oi,id:Qr,index:Yr,sourceLayerIndex:nn})}for(var Ti=0,ea=En[un];Ti<ea.length;Ti+=1){var bi=ea[Ti],Oi=bi[0];Oi.minzoom&&this.zoom<Math.floor(Oi.minzoom)||Oi.maxzoom&&this.zoom>=Oi.maxzoom||Oi.visibility!=="none"&&(re(bi,this.zoom,se),(zt[Oi.id]=Oi.createBucket({index:pe.bucketLayerIDs.length,layers:bi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:nn,sourceID:this.source})).populate(Zr,gr,this.tileID.canonical),pe.bucketLayerIDs.push(bi.map(function(oa){return oa.id})))}}}var Ci=v.mapObject(gr.glyphDependencies,function(oa){return Object.keys(oa).map(Number)});Object.keys(Ci).length?ge.send("getGlyphs",{uid:this.uid,stacks:Ci},function(oa,Ri){Fe||(Fe=oa,yt=Ri,Fa.call(We))}):yt={};var ti=Object.keys(gr.iconDependencies);ti.length?ge.send("getImages",{icons:ti,source:this.source,tileID:this.tileID,type:"icons"},function(oa,Ri){Fe||(Fe=oa,dr=Ri,Fa.call(We))}):dr={};var Xi=Object.keys(gr.patternDependencies);function Fa(){if(Fe)return Oe(Fe);if(yt&&dr&&Dt){var oa=new ie(yt),Ri=new v.ImageAtlas(dr,Dt);for(var Gi in zt){var Za=zt[Gi];Za instanceof v.SymbolBucket?(re(Za.layers,this.zoom,se),v.performSymbolLayout(Za,yt,oa.positions,dr,Ri.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):Za.hasPattern&&(Za instanceof v.LineBucket||Za instanceof v.FillBucket||Za instanceof v.FillExtrusionBucket)&&(re(Za.layers,this.zoom,se),Za.addFeatures(gr,this.tileID.canonical,Ri.patternPositions))}this.status="done",Oe(null,{buckets:v.values(zt).filter(function(au){return!au.isEmpty()}),featureIndex:pe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:oa.image,imageAtlas:Ri,glyphMap:this.returnDependencies?yt:null,iconMap:this.returnDependencies?dr:null,glyphPositions:this.returnDependencies?oa.positions:null})}}Xi.length?ge.send("getImages",{icons:Xi,source:this.source,tileID:this.tileID,type:"patterns"},function(oa,Ri){Fe||(Fe=oa,Dt=Ri,Fa.call(We))}):Dt={},Fa.call(this)};var Ce=function(V,$,se,ge){this.actor=V,this.layerIndex=$,this.availableImages=se,this.loadVectorData=ge||Ge,this.loading={},this.loaded={}};Ce.prototype.loadTile=function(V,$){var se=this,ge=V.uid;this.loading||(this.loading={});var Oe=!!(V&&V.request&&V.request.collectResourceTiming)&&new v.RequestPerformance(V.request),We=this.loading[ge]=new Ee(V);We.abort=this.loadVectorData(V,function(nt,pe){if(delete se.loading[ge],nt||!pe)return We.status="done",se.loaded[ge]=We,$(nt);var Fe=pe.rawData,yt={};pe.expires&&(yt.expires=pe.expires),pe.cacheControl&&(yt.cacheControl=pe.cacheControl);var dr={};if(Oe){var Dt=Oe.finish();Dt&&(dr.resourceTiming=JSON.parse(JSON.stringify(Dt)))}We.vectorTile=pe.vectorTile,We.parse(pe.vectorTile,se.layerIndex,se.availableImages,se.actor,function(zt,gr){if(zt||!gr)return $(zt);$(null,v.extend({rawTileData:Fe.slice(0)},gr,yt,dr))}),se.loaded=se.loaded||{},se.loaded[ge]=We})},Ce.prototype.reloadTile=function(V,$){var se=this,ge=this.loaded,Oe=V.uid,We=this;if(ge&&ge[Oe]){var nt=ge[Oe];nt.showCollisionBoxes=V.showCollisionBoxes;var pe=function(Fe,yt){var dr=nt.reloadCallback;dr&&(delete nt.reloadCallback,nt.parse(nt.vectorTile,We.layerIndex,se.availableImages,We.actor,dr)),$(Fe,yt)};nt.status==="parsing"?nt.reloadCallback=pe:nt.status==="done"&&(nt.vectorTile?nt.parse(nt.vectorTile,this.layerIndex,this.availableImages,this.actor,pe):pe())}},Ce.prototype.abortTile=function(V,$){var se=this.loading,ge=V.uid;se&&se[ge]&&se[ge].abort&&(se[ge].abort(),delete se[ge]),$()},Ce.prototype.removeTile=function(V,$){var se=this.loaded,ge=V.uid;se&&se[ge]&&delete se[ge],$()};var tt=v.window.ImageBitmap,Mt=function(){this.loaded={}};function ir(V,$){if(V.length!==0){bt(V[0],$);for(var se=1;se<V.length;se++)bt(V[se],!$)}}function bt(V,$){for(var se=0,ge=0,Oe=V.length,We=Oe-1;ge<Oe;We=ge++)se+=(V[ge][0]-V[We][0])*(V[We][1]+V[ge][1]);se>=0!=!!$&&V.reverse()}Mt.prototype.loadTile=function(V,$){var se=V.uid,ge=V.encoding,Oe=V.rawImageData,We=tt&&Oe instanceof tt?this.getImageData(Oe):Oe,nt=new v.DEMData(se,We,ge);this.loaded=this.loaded||{},this.loaded[se]=nt,$(null,nt)},Mt.prototype.getImageData=function(V){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(V.width,V.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=V.width,this.offscreenCanvas.height=V.height,this.offscreenCanvasContext.drawImage(V,0,0,V.width,V.height);var $=this.offscreenCanvasContext.getImageData(-1,-1,V.width+2,V.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new v.RGBAImage({width:$.width,height:$.height},$.data)},Mt.prototype.removeTile=function(V){var $=this.loaded,se=V.uid;$&&$[se]&&delete $[se]};var qt=v.vectorTile.VectorTileFeature.prototype.toGeoJSON,At=function(V){this._feature=V,this.extent=v.EXTENT,this.type=V.type,this.properties=V.tags,"id"in V&&!isNaN(V.id)&&(this.id=parseInt(V.id,10))};At.prototype.loadGeometry=function(){if(this._feature.type===1){for(var V=[],$=0,se=this._feature.geometry;$<se.length;$+=1){var ge=se[$];V.push([new v.Point$1(ge[0],ge[1])])}return V}for(var Oe=[],We=0,nt=this._feature.geometry;We<nt.length;We+=1){for(var pe=[],Fe=0,yt=nt[We];Fe<yt.length;Fe+=1){var dr=yt[Fe];pe.push(new v.Point$1(dr[0],dr[1]))}Oe.push(pe)}return Oe},At.prototype.toGeoJSON=function(V,$,se){return qt.call(this,V,$,se)};var ot=function(V){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=v.EXTENT,this.length=V.length,this._features=V};ot.prototype.feature=function(V){return new At(this._features[V])};var ct=v.vectorTile.VectorTileFeature,Qt=X;function X(V,$){this.options=$||{},this.features=V,this.length=V.length}function Kt(V,$){this.id=typeof V.id=="number"?V.id:void 0,this.type=V.type,this.rawGeometry=V.type===1?[V.geometry]:V.geometry,this.properties=V.tags,this.extent=$||4096}X.prototype.feature=function(V){return new Kt(this.features[V],this.options.extent)},Kt.prototype.loadGeometry=function(){var V=this.rawGeometry;this.geometry=[];for(var $=0;$<V.length;$++){for(var se=V[$],ge=[],Oe=0;Oe<se.length;Oe++)ge.push(new v.Point$1(se[Oe][0],se[Oe][1]));this.geometry.push(ge)}return this.geometry},Kt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var V=this.geometry,$=1/0,se=-1/0,ge=1/0,Oe=-1/0,We=0;We<V.length;We++)for(var nt=V[We],pe=0;pe<nt.length;pe++){var Fe=nt[pe];$=Math.min($,Fe.x),se=Math.max(se,Fe.x),ge=Math.min(ge,Fe.y),Oe=Math.max(Oe,Fe.y)}return[$,ge,se,Oe]},Kt.prototype.toGeoJSON=ct.prototype.toGeoJSON;var vt=dt,qe=Qt;function dt(V){var $=new v.pbf;return function(se,ge){for(var Oe in se.layers)ge.writeMessage(3,$e,se.layers[Oe])}(V,$),$.finish()}function $e(V,$){var se;$.writeVarintField(15,V.version||1),$.writeStringField(1,V.name||""),$.writeVarintField(5,V.extent||4096);var ge={keys:[],values:[],keycache:{},valuecache:{}};for(se=0;se<V.length;se++)ge.feature=V.feature(se),$.writeMessage(2,kt,ge);var Oe=ge.keys;for(se=0;se<Oe.length;se++)$.writeStringField(3,Oe[se]);var We=ge.values;for(se=0;se<We.length;se++)$.writeMessage(4,Ye,We[se])}function kt(V,$){var se=V.feature;se.id!==void 0&&$.writeVarintField(1,se.id),$.writeMessage(2,yr,V),$.writeVarintField(3,se.type),$.writeMessage(4,Te,se)}function yr(V,$){var se=V.feature,ge=V.keys,Oe=V.values,We=V.keycache,nt=V.valuecache;for(var pe in se.properties){var Fe=We[pe];Fe===void 0&&(ge.push(pe),We[pe]=Fe=ge.length-1),$.writeVarint(Fe);var yt=se.properties[pe],dr=typeof yt;dr!=="string"&&dr!=="boolean"&&dr!=="number"&&(yt=JSON.stringify(yt));var Dt=dr+":"+yt,zt=nt[Dt];zt===void 0&&(Oe.push(yt),nt[Dt]=zt=Oe.length-1),$.writeVarint(zt)}}function Pr(V,$){return($<<3)+(7&V)}function Wr(V){return V<<1^V>>31}function Te(V,$){for(var se=V.loadGeometry(),ge=V.type,Oe=0,We=0,nt=se.length,pe=0;pe<nt;pe++){var Fe=se[pe],yt=1;ge===1&&(yt=Fe.length),$.writeVarint(Pr(1,yt));for(var dr=ge===3?Fe.length-1:Fe.length,Dt=0;Dt<dr;Dt++){Dt===1&&ge!==1&&$.writeVarint(Pr(2,dr-1));var zt=Fe[Dt].x-Oe,gr=Fe[Dt].y-We;$.writeVarint(Wr(zt)),$.writeVarint(Wr(gr)),Oe+=zt,We+=gr}ge===3&&$.writeVarint(Pr(7,1))}}function Ye(V,$){var se=typeof V;se==="string"?$.writeStringField(1,V):se==="boolean"?$.writeBooleanField(7,V):se==="number"&&(V%1!=0?$.writeDoubleField(3,V):V<0?$.writeSVarintField(6,V):$.writeVarintField(5,V))}function De(V,$,se,ge){wt(V,se,ge),wt($,2*se,2*ge),wt($,2*se+1,2*ge+1)}function wt(V,$,se){var ge=V[$];V[$]=V[se],V[se]=ge}function gt(V,$,se,ge){var Oe=V-se,We=$-ge;return Oe*Oe+We*We}vt.fromVectorTileJs=dt,vt.fromGeojsonVt=function(V,$){$=$||{};var se={};for(var ge in V)se[ge]=new Qt(V[ge].features,$),se[ge].name=ge,se[ge].version=$.version,se[ge].extent=$.extent;return dt({layers:se})},vt.GeoJSONWrapper=qe;var Ut=function(V){return V[0]},Jt=function(V){return V[1]},Cr=function(V,$,se,ge,Oe){$===void 0&&($=Ut),se===void 0&&(se=Jt),ge===void 0&&(ge=64),Oe===void 0&&(Oe=Float64Array),this.nodeSize=ge,this.points=V;for(var We=V.length<65536?Uint16Array:Uint32Array,nt=this.ids=new We(V.length),pe=this.coords=new Oe(2*V.length),Fe=0;Fe<V.length;Fe++)nt[Fe]=Fe,pe[2*Fe]=$(V[Fe]),pe[2*Fe+1]=se(V[Fe]);(function yt(dr,Dt,zt,gr,En,un){if(!(En-gr<=zt)){var Tt=gr+En>>1;(function nn(Zr,Yr,oi,Qr,Ti,ea){for(;Ti>Qr;){if(Ti-Qr>600){var bi=Ti-Qr+1,Oi=oi-Qr+1,Ci=Math.log(bi),ti=.5*Math.exp(2*Ci/3),Xi=.5*Math.sqrt(Ci*ti*(bi-ti)/bi)*(Oi-bi/2<0?-1:1);nn(Zr,Yr,oi,Math.max(Qr,Math.floor(oi-Oi*ti/bi+Xi)),Math.min(Ti,Math.floor(oi+(bi-Oi)*ti/bi+Xi)),ea)}var Fa=Yr[2*oi+ea],oa=Qr,Ri=Ti;for(De(Zr,Yr,Qr,oi),Yr[2*Ti+ea]>Fa&&De(Zr,Yr,Qr,Ti);oa<Ri;){for(De(Zr,Yr,oa,Ri),oa++,Ri--;Yr[2*oa+ea]<Fa;)oa++;for(;Yr[2*Ri+ea]>Fa;)Ri--}Yr[2*Qr+ea]===Fa?De(Zr,Yr,Qr,Ri):De(Zr,Yr,++Ri,Ti),Ri<=oi&&(Qr=Ri+1),oi<=Ri&&(Ti=Ri-1)}})(dr,Dt,Tt,gr,En,un%2),yt(dr,Dt,zt,gr,Tt-1,un+1),yt(dr,Dt,zt,Tt+1,En,un+1)}})(nt,pe,ge,0,nt.length-1,0)};Cr.prototype.range=function(V,$,se,ge){return function(Oe,We,nt,pe,Fe,yt,dr){for(var Dt,zt,gr=[0,Oe.length-1,0],En=[];gr.length;){var un=gr.pop(),Tt=gr.pop(),nn=gr.pop();if(Tt-nn<=dr)for(var Zr=nn;Zr<=Tt;Zr++)zt=We[2*Zr+1],(Dt=We[2*Zr])>=nt&&Dt<=Fe&&zt>=pe&&zt<=yt&&En.push(Oe[Zr]);else{var Yr=Math.floor((nn+Tt)/2);zt=We[2*Yr+1],(Dt=We[2*Yr])>=nt&&Dt<=Fe&&zt>=pe&&zt<=yt&&En.push(Oe[Yr]);var oi=(un+1)%2;(un===0?nt<=Dt:pe<=zt)&&(gr.push(nn),gr.push(Yr-1),gr.push(oi)),(un===0?Fe>=Dt:yt>=zt)&&(gr.push(Yr+1),gr.push(Tt),gr.push(oi))}}return En}(this.ids,this.coords,V,$,se,ge,this.nodeSize)},Cr.prototype.within=function(V,$,se){return function(ge,Oe,We,nt,pe,Fe){for(var yt=[0,ge.length-1,0],dr=[],Dt=pe*pe;yt.length;){var zt=yt.pop(),gr=yt.pop(),En=yt.pop();if(gr-En<=Fe)for(var un=En;un<=gr;un++)gt(Oe[2*un],Oe[2*un+1],We,nt)<=Dt&&dr.push(ge[un]);else{var Tt=Math.floor((En+gr)/2),nn=Oe[2*Tt],Zr=Oe[2*Tt+1];gt(nn,Zr,We,nt)<=Dt&&dr.push(ge[Tt]);var Yr=(zt+1)%2;(zt===0?We-pe<=nn:nt-pe<=Zr)&&(yt.push(En),yt.push(Tt-1),yt.push(Yr)),(zt===0?We+pe>=nn:nt+pe>=Zr)&&(yt.push(Tt+1),yt.push(gr),yt.push(Yr))}}return dr}(this.ids,this.coords,V,$,se,this.nodeSize)};var Yn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(V){return V}},hn=function(V){this.options=aa(Object.create(Yn),V),this.trees=new Array(this.options.maxZoom+1)};function qi(V,$,se,ge,Oe){return{x:V,y:$,zoom:1/0,id:se,parentId:-1,numPoints:ge,properties:Oe}}function jn(V,$){var se=V.geometry.coordinates,ge=se[1];return{x:qn(se[0]),y:li(ge),zoom:1/0,index:$,parentId:-1}}function Xn(V){return{type:"Feature",id:V.id,properties:vi(V),geometry:{type:"Point",coordinates:[(ge=V.x,360*(ge-.5)),($=V.y,se=(180-360*$)*Math.PI/180,360*Math.atan(Math.exp(se))/Math.PI-90)]}};var $,se,ge}function vi(V){var $=V.numPoints,se=$>=1e4?Math.round($/1e3)+"k":$>=1e3?Math.round($/100)/10+"k":$;return aa(aa({},V.properties),{cluster:!0,cluster_id:V.id,point_count:$,point_count_abbreviated:se})}function qn(V){return V/360+.5}function li(V){var $=Math.sin(V*Math.PI/180),se=.5-.25*Math.log((1+$)/(1-$))/Math.PI;return se<0?0:se>1?1:se}function aa(V,$){for(var se in $)V[se]=$[se];return V}function Di(V){return V.x}function Ai(V){return V.y}function Vi(V,$,se,ge,Oe,We){var nt=Oe-se,pe=We-ge;if(nt!==0||pe!==0){var Fe=((V-se)*nt+($-ge)*pe)/(nt*nt+pe*pe);Fe>1?(se=Oe,ge=We):Fe>0&&(se+=nt*Fe,ge+=pe*Fe)}return(nt=V-se)*nt+(pe=$-ge)*pe}function la(V,$,se,ge){var Oe={id:V===void 0?null:V,type:$,geometry:se,tags:ge,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(We){var nt=We.geometry,pe=We.type;if(pe==="Point"||pe==="MultiPoint"||pe==="LineString")wi(We,nt);else if(pe==="Polygon"||pe==="MultiLineString")for(var Fe=0;Fe<nt.length;Fe++)wi(We,nt[Fe]);else if(pe==="MultiPolygon")for(Fe=0;Fe<nt.length;Fe++)for(var yt=0;yt<nt[Fe].length;yt++)wi(We,nt[Fe][yt])}(Oe),Oe}function wi(V,$){for(var se=0;se<$.length;se+=3)V.minX=Math.min(V.minX,$[se]),V.minY=Math.min(V.minY,$[se+1]),V.maxX=Math.max(V.maxX,$[se]),V.maxY=Math.max(V.maxY,$[se+1])}function Sa(V,$,se,ge){if($.geometry){var Oe=$.geometry.coordinates,We=$.geometry.type,nt=Math.pow(se.tolerance/((1<<se.maxZoom)*se.extent),2),pe=[],Fe=$.id;if(se.promoteId?Fe=$.properties[se.promoteId]:se.generateId&&(Fe=ge||0),We==="Point")Mn(Oe,pe);else if(We==="MultiPoint")for(var yt=0;yt<Oe.length;yt++)Mn(Oe[yt],pe);else if(We==="LineString")Si(Oe,pe,nt,!1);else if(We==="MultiLineString"){if(se.lineMetrics){for(yt=0;yt<Oe.length;yt++)Si(Oe[yt],pe=[],nt,!1),V.push(la(Fe,"LineString",pe,$.properties));return}ji(Oe,pe,nt,!1)}else if(We==="Polygon")ji(Oe,pe,nt,!0);else{if(We!=="MultiPolygon"){if(We==="GeometryCollection"){for(yt=0;yt<$.geometry.geometries.length;yt++)Sa(V,{id:Fe,geometry:$.geometry.geometries[yt],properties:$.properties},se,ge);return}throw new Error("Input data is not a valid GeoJSON object.")}for(yt=0;yt<Oe.length;yt++){var dr=[];ji(Oe[yt],dr,nt,!0),pe.push(dr)}}V.push(la(Fe,We,pe,$.properties))}}function Mn(V,$){$.push(Ki(V[0])),$.push(Wa(V[1])),$.push(0)}function Si(V,$,se,ge){for(var Oe,We,nt=0,pe=0;pe<V.length;pe++){var Fe=Ki(V[pe][0]),yt=Wa(V[pe][1]);$.push(Fe),$.push(yt),$.push(0),pe>0&&(nt+=ge?(Oe*yt-Fe*We)/2:Math.sqrt(Math.pow(Fe-Oe,2)+Math.pow(yt-We,2))),Oe=Fe,We=yt}var dr=$.length-3;$[2]=1,function Dt(zt,gr,En,un){for(var Tt,nn=un,Zr=En-gr>>1,Yr=En-gr,oi=zt[gr],Qr=zt[gr+1],Ti=zt[En],ea=zt[En+1],bi=gr+3;bi<En;bi+=3){var Oi=Vi(zt[bi],zt[bi+1],oi,Qr,Ti,ea);if(Oi>nn)Tt=bi,nn=Oi;else if(Oi===nn){var Ci=Math.abs(bi-Zr);Ci<Yr&&(Tt=bi,Yr=Ci)}}nn>un&&(Tt-gr>3&&Dt(zt,gr,Tt,un),zt[Tt+2]=nn,En-Tt>3&&Dt(zt,Tt,En,un))}($,0,dr,se),$[dr+2]=1,$.size=Math.abs(nt),$.start=0,$.end=$.size}function ji(V,$,se,ge){for(var Oe=0;Oe<V.length;Oe++){var We=[];Si(V[Oe],We,se,ge),$.push(We)}}function Ki(V){return V/360+.5}function Wa(V){var $=Math.sin(V*Math.PI/180),se=.5-.25*Math.log((1+$)/(1-$))/Math.PI;return se<0?0:se>1?1:se}function ve(V,$,se,ge,Oe,We,nt,pe){if(ge/=$,We>=(se/=$)&&nt<ge)return V;if(nt<se||We>=ge)return null;for(var Fe=[],yt=0;yt<V.length;yt++){var dr=V[yt],Dt=dr.geometry,zt=dr.type,gr=Oe===0?dr.minX:dr.minY,En=Oe===0?dr.maxX:dr.maxY;if(gr>=se&&En<ge)Fe.push(dr);else if(!(En<se||gr>=ge)){var un=[];if(zt==="Point"||zt==="MultiPoint")Fn(Dt,un,se,ge,Oe);else if(zt==="LineString")Xa(Dt,un,se,ge,Oe,!1,pe.lineMetrics);else if(zt==="MultiLineString")jt(Dt,un,se,ge,Oe,!1);else if(zt==="Polygon")jt(Dt,un,se,ge,Oe,!0);else if(zt==="MultiPolygon")for(var Tt=0;Tt<Dt.length;Tt++){var nn=[];jt(Dt[Tt],nn,se,ge,Oe,!0),nn.length&&un.push(nn)}if(un.length){if(pe.lineMetrics&&zt==="LineString"){for(Tt=0;Tt<un.length;Tt++)Fe.push(la(dr.id,zt,un[Tt],dr.tags));continue}zt!=="LineString"&&zt!=="MultiLineString"||(un.length===1?(zt="LineString",un=un[0]):zt="MultiLineString"),zt!=="Point"&&zt!=="MultiPoint"||(zt=un.length===3?"Point":"MultiPoint"),Fe.push(la(dr.id,zt,un,dr.tags))}}}return Fe.length?Fe:null}function Fn(V,$,se,ge,Oe){for(var We=0;We<V.length;We+=3){var nt=V[We+Oe];nt>=se&&nt<=ge&&($.push(V[We]),$.push(V[We+1]),$.push(V[We+2]))}}function Xa(V,$,se,ge,Oe,We,nt){for(var pe,Fe,yt=fs(V),dr=Oe===0?Tr:I,Dt=V.start,zt=0;zt<V.length-3;zt+=3){var gr=V[zt],En=V[zt+1],un=V[zt+2],Tt=V[zt+3],nn=V[zt+4],Zr=Oe===0?gr:En,Yr=Oe===0?Tt:nn,oi=!1;nt&&(pe=Math.sqrt(Math.pow(gr-Tt,2)+Math.pow(En-nn,2))),Zr<se?Yr>se&&(Fe=dr(yt,gr,En,Tt,nn,se),nt&&(yt.start=Dt+pe*Fe)):Zr>ge?Yr<ge&&(Fe=dr(yt,gr,En,Tt,nn,ge),nt&&(yt.start=Dt+pe*Fe)):sr(yt,gr,En,un),Yr<se&&Zr>=se&&(Fe=dr(yt,gr,En,Tt,nn,se),oi=!0),Yr>ge&&Zr<=ge&&(Fe=dr(yt,gr,En,Tt,nn,ge),oi=!0),!We&&oi&&(nt&&(yt.end=Dt+pe*Fe),$.push(yt),yt=fs(V)),nt&&(Dt+=pe)}var Qr=V.length-3;gr=V[Qr],En=V[Qr+1],un=V[Qr+2],(Zr=Oe===0?gr:En)>=se&&Zr<=ge&&sr(yt,gr,En,un),Qr=yt.length-3,We&&Qr>=3&&(yt[Qr]!==yt[0]||yt[Qr+1]!==yt[1])&&sr(yt,yt[0],yt[1],yt[2]),yt.length&&$.push(yt)}function fs(V){var $=[];return $.size=V.size,$.start=V.start,$.end=V.end,$}function jt(V,$,se,ge,Oe,We){for(var nt=0;nt<V.length;nt++)Xa(V[nt],$,se,ge,Oe,We,!1)}function sr(V,$,se,ge){V.push($),V.push(se),V.push(ge)}function Tr(V,$,se,ge,Oe,We){var nt=(We-$)/(ge-$);return V.push(We),V.push(se+(Oe-se)*nt),V.push(1),nt}function I(V,$,se,ge,Oe,We){var nt=(We-se)/(Oe-se);return V.push($+(ge-$)*nt),V.push(We),V.push(1),nt}function ur(V,$){for(var se=[],ge=0;ge<V.length;ge++){var Oe,We=V[ge],nt=We.type;if(nt==="Point"||nt==="MultiPoint"||nt==="LineString")Oe=Ln(We.geometry,$);else if(nt==="MultiLineString"||nt==="Polygon"){Oe=[];for(var pe=0;pe<We.geometry.length;pe++)Oe.push(Ln(We.geometry[pe],$))}else if(nt==="MultiPolygon")for(Oe=[],pe=0;pe<We.geometry.length;pe++){for(var Fe=[],yt=0;yt<We.geometry[pe].length;yt++)Fe.push(Ln(We.geometry[pe][yt],$));Oe.push(Fe)}se.push(la(We.id,nt,Oe,We.tags))}return se}function Ln(V,$){var se=[];se.size=V.size,V.start!==void 0&&(se.start=V.start,se.end=V.end);for(var ge=0;ge<V.length;ge+=3)se.push(V[ge]+$,V[ge+1],V[ge+2]);return se}function ci(V,$){if(V.transformed)return V;var se,ge,Oe,We=1<<V.z,nt=V.x,pe=V.y;for(se=0;se<V.features.length;se++){var Fe=V.features[se],yt=Fe.geometry,dr=Fe.type;if(Fe.geometry=[],dr===1)for(ge=0;ge<yt.length;ge+=2)Fe.geometry.push(Gn(yt[ge],yt[ge+1],$,We,nt,pe));else for(ge=0;ge<yt.length;ge++){var Dt=[];for(Oe=0;Oe<yt[ge].length;Oe+=2)Dt.push(Gn(yt[ge][Oe],yt[ge][Oe+1],$,We,nt,pe));Fe.geometry.push(Dt)}}return V.transformed=!0,V}function Gn(V,$,se,ge,Oe,We){return[Math.round(se*(V*ge-Oe)),Math.round(se*($*ge-We))]}function rn(V,$,se,ge,Oe){for(var We=$===Oe.maxZoom?0:Oe.tolerance/((1<<$)*Oe.extent),nt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:se,y:ge,z:$,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},pe=0;pe<V.length;pe++){nt.numFeatures++,Pi(nt,V[pe],We,Oe);var Fe=V[pe].minX,yt=V[pe].minY,dr=V[pe].maxX,Dt=V[pe].maxY;Fe<nt.minX&&(nt.minX=Fe),yt<nt.minY&&(nt.minY=yt),dr>nt.maxX&&(nt.maxX=dr),Dt>nt.maxY&&(nt.maxY=Dt)}return nt}function Pi(V,$,se,ge){var Oe=$.geometry,We=$.type,nt=[];if(We==="Point"||We==="MultiPoint")for(var pe=0;pe<Oe.length;pe+=3)nt.push(Oe[pe]),nt.push(Oe[pe+1]),V.numPoints++,V.numSimplified++;else if(We==="LineString")Ii(nt,Oe,V,se,!1,!1);else if(We==="MultiLineString"||We==="Polygon")for(pe=0;pe<Oe.length;pe++)Ii(nt,Oe[pe],V,se,We==="Polygon",pe===0);else if(We==="MultiPolygon")for(var Fe=0;Fe<Oe.length;Fe++){var yt=Oe[Fe];for(pe=0;pe<yt.length;pe++)Ii(nt,yt[pe],V,se,!0,pe===0)}if(nt.length){var dr=$.tags||null;if(We==="LineString"&&ge.lineMetrics){for(var Dt in dr={},$.tags)dr[Dt]=$.tags[Dt];dr.mapbox_clip_start=Oe.start/Oe.size,dr.mapbox_clip_end=Oe.end/Oe.size}var zt={geometry:nt,type:We==="Polygon"||We==="MultiPolygon"?3:We==="LineString"||We==="MultiLineString"?2:1,tags:dr};$.id!==null&&(zt.id=$.id),V.features.push(zt)}}function Ii(V,$,se,ge,Oe,We){var nt=ge*ge;if(ge>0&&$.size<(Oe?nt:ge))se.numPoints+=$.length/3;else{for(var pe=[],Fe=0;Fe<$.length;Fe+=3)(ge===0||$[Fe+2]>nt)&&(se.numSimplified++,pe.push($[Fe]),pe.push($[Fe+1])),se.numPoints++;Oe&&function(yt,dr){for(var Dt=0,zt=0,gr=yt.length,En=gr-2;zt<gr;En=zt,zt+=2)Dt+=(yt[zt]-yt[En])*(yt[zt+1]+yt[En+1]);if(Dt>0===dr)for(zt=0,gr=yt.length;zt<gr/2;zt+=2){var un=yt[zt],Tt=yt[zt+1];yt[zt]=yt[gr-2-zt],yt[zt+1]=yt[gr-1-zt],yt[gr-2-zt]=un,yt[gr-1-zt]=Tt}}(pe,We),V.push(pe)}}function Ja(V,$){var se=($=this.options=function(Oe,We){for(var nt in We)Oe[nt]=We[nt];return Oe}(Object.create(this.options),$)).debug;if(se&&console.time("preprocess data"),$.maxZoom<0||$.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if($.promoteId&&$.generateId)throw new Error("promoteId and generateId cannot be used together.");var ge=function(Oe,We){var nt=[];if(Oe.type==="FeatureCollection")for(var pe=0;pe<Oe.features.length;pe++)Sa(nt,Oe.features[pe],We,pe);else Sa(nt,Oe.type==="Feature"?Oe:{geometry:Oe},We);return nt}(V,$);this.tiles={},this.tileCoords=[],se&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",$.indexMaxZoom,$.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(ge=function(Oe,We){var nt=We.buffer/We.extent,pe=Oe,Fe=ve(Oe,1,-1-nt,nt,0,-1,2,We),yt=ve(Oe,1,1-nt,2+nt,0,-1,2,We);return(Fe||yt)&&(pe=ve(Oe,1,-nt,1+nt,0,-1,2,We)||[],Fe&&(pe=ur(Fe,1).concat(pe)),yt&&(pe=pe.concat(ur(yt,-1)))),pe}(ge,$)).length&&this.splitTile(ge,0,0,0),se&&(ge.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function hs(V,$,se){return 32*((1<<V)*se+$)+V}function _a(V,$){var se=V.tileID.canonical;if(!this._geoJSONIndex)return $(null,null);var ge=this._geoJSONIndex.getTile(se.z,se.x,se.y);if(!ge)return $(null,null);var Oe=new ot(ge.features),We=vt(Oe);We.byteOffset===0&&We.byteLength===We.buffer.byteLength||(We=new Uint8Array(We)),$(null,{vectorTile:Oe,rawData:We.buffer})}hn.prototype.load=function(V){var $=this.options,se=$.log,ge=$.minZoom,Oe=$.maxZoom,We=$.nodeSize;se&&console.time("total time");var nt="prepare "+V.length+" points";se&&console.time(nt),this.points=V;for(var pe=[],Fe=0;Fe<V.length;Fe++)V[Fe].geometry&&pe.push(jn(V[Fe],Fe));this.trees[Oe+1]=new Cr(pe,Di,Ai,We,Float32Array),se&&console.timeEnd(nt);for(var yt=Oe;yt>=ge;yt--){var dr=+Date.now();pe=this._cluster(pe,yt),this.trees[yt]=new Cr(pe,Di,Ai,We,Float32Array),se&&console.log("z%d: %d clusters in %dms",yt,pe.length,+Date.now()-dr)}return se&&console.timeEnd("total time"),this},hn.prototype.getClusters=function(V,$){var se=((V[0]+180)%360+360)%360-180,ge=Math.max(-90,Math.min(90,V[1])),Oe=V[2]===180?180:((V[2]+180)%360+360)%360-180,We=Math.max(-90,Math.min(90,V[3]));if(V[2]-V[0]>=360)se=-180,Oe=180;else if(se>Oe){var nt=this.getClusters([se,ge,180,We],$),pe=this.getClusters([-180,ge,Oe,We],$);return nt.concat(pe)}for(var Fe=this.trees[this._limitZoom($)],yt=[],dr=0,Dt=Fe.range(qn(se),li(We),qn(Oe),li(ge));dr<Dt.length;dr+=1){var zt=Fe.points[Dt[dr]];yt.push(zt.numPoints?Xn(zt):this.points[zt.index])}return yt},hn.prototype.getChildren=function(V){var $=this._getOriginId(V),se=this._getOriginZoom(V),ge="No cluster with the specified id.",Oe=this.trees[se];if(!Oe)throw new Error(ge);var We=Oe.points[$];if(!We)throw new Error(ge);for(var nt=this.options.radius/(this.options.extent*Math.pow(2,se-1)),pe=[],Fe=0,yt=Oe.within(We.x,We.y,nt);Fe<yt.length;Fe+=1){var dr=Oe.points[yt[Fe]];dr.parentId===V&&pe.push(dr.numPoints?Xn(dr):this.points[dr.index])}if(pe.length===0)throw new Error(ge);return pe},hn.prototype.getLeaves=function(V,$,se){var ge=[];return this._appendLeaves(ge,V,$=$||10,se=se||0,0),ge},hn.prototype.getTile=function(V,$,se){var ge=this.trees[this._limitZoom(V)],Oe=Math.pow(2,V),We=this.options,nt=We.radius/We.extent,pe=(se-nt)/Oe,Fe=(se+1+nt)/Oe,yt={features:[]};return this._addTileFeatures(ge.range(($-nt)/Oe,pe,($+1+nt)/Oe,Fe),ge.points,$,se,Oe,yt),$===0&&this._addTileFeatures(ge.range(1-nt/Oe,pe,1,Fe),ge.points,Oe,se,Oe,yt),$===Oe-1&&this._addTileFeatures(ge.range(0,pe,nt/Oe,Fe),ge.points,-1,se,Oe,yt),yt.features.length?yt:null},hn.prototype.getClusterExpansionZoom=function(V){for(var $=this._getOriginZoom(V)-1;$<=this.options.maxZoom;){var se=this.getChildren(V);if($++,se.length!==1)break;V=se[0].properties.cluster_id}return $},hn.prototype._appendLeaves=function(V,$,se,ge,Oe){for(var We=0,nt=this.getChildren($);We<nt.length;We+=1){var pe=nt[We],Fe=pe.properties;if(Fe&&Fe.cluster?Oe+Fe.point_count<=ge?Oe+=Fe.point_count:Oe=this._appendLeaves(V,Fe.cluster_id,se,ge,Oe):Oe<ge?Oe++:V.push(pe),V.length===se)break}return Oe},hn.prototype._addTileFeatures=function(V,$,se,ge,Oe,We){for(var nt=0,pe=V;nt<pe.length;nt+=1){var Fe=$[pe[nt]],yt=Fe.numPoints,dr={type:1,geometry:[[Math.round(this.options.extent*(Fe.x*Oe-se)),Math.round(this.options.extent*(Fe.y*Oe-ge))]],tags:yt?vi(Fe):this.points[Fe.index].properties},Dt=void 0;yt?Dt=Fe.id:this.options.generateId?Dt=Fe.index:this.points[Fe.index].id&&(Dt=this.points[Fe.index].id),Dt!==void 0&&(dr.id=Dt),We.features.push(dr)}},hn.prototype._limitZoom=function(V){return Math.max(this.options.minZoom,Math.min(+V,this.options.maxZoom+1))},hn.prototype._cluster=function(V,$){for(var se=[],ge=this.options,Oe=ge.reduce,We=ge.minPoints,nt=ge.radius/(ge.extent*Math.pow(2,$)),pe=0;pe<V.length;pe++){var Fe=V[pe];if(!(Fe.zoom<=$)){Fe.zoom=$;for(var yt=this.trees[$+1],dr=yt.within(Fe.x,Fe.y,nt),Dt=Fe.numPoints||1,zt=Dt,gr=0,En=dr;gr<En.length;gr+=1){var un=yt.points[En[gr]];un.zoom>$&&(zt+=un.numPoints||1)}if(zt>=We){for(var Tt=Fe.x*Dt,nn=Fe.y*Dt,Zr=Oe&&Dt>1?this._map(Fe,!0):null,Yr=(pe<<5)+($+1)+this.points.length,oi=0,Qr=dr;oi<Qr.length;oi+=1){var Ti=yt.points[Qr[oi]];if(!(Ti.zoom<=$)){Ti.zoom=$;var ea=Ti.numPoints||1;Tt+=Ti.x*ea,nn+=Ti.y*ea,Ti.parentId=Yr,Oe&&(Zr||(Zr=this._map(Fe,!0)),Oe(Zr,this._map(Ti)))}}Fe.parentId=Yr,se.push(qi(Tt/zt,nn/zt,Yr,zt,Zr))}else if(se.push(Fe),zt>1)for(var bi=0,Oi=dr;bi<Oi.length;bi+=1){var Ci=yt.points[Oi[bi]];Ci.zoom<=$||(Ci.zoom=$,se.push(Ci))}}}return se},hn.prototype._getOriginId=function(V){return V-this.points.length>>5},hn.prototype._getOriginZoom=function(V){return(V-this.points.length)%32},hn.prototype._map=function(V,$){if(V.numPoints)return $?aa({},V.properties):V.properties;var se=this.points[V.index].properties,ge=this.options.map(se);return $&&ge===se?aa({},ge):ge},Ja.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ja.prototype.splitTile=function(V,$,se,ge,Oe,We,nt){for(var pe=[V,$,se,ge],Fe=this.options,yt=Fe.debug;pe.length;){ge=pe.pop(),se=pe.pop(),$=pe.pop(),V=pe.pop();var dr=1<<$,Dt=hs($,se,ge),zt=this.tiles[Dt];if(!zt&&(yt>1&&console.time("creation"),zt=this.tiles[Dt]=rn(V,$,se,ge,Fe),this.tileCoords.push({z:$,x:se,y:ge}),yt)){yt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",$,se,ge,zt.numFeatures,zt.numPoints,zt.numSimplified),console.timeEnd("creation"));var gr="z"+$;this.stats[gr]=(this.stats[gr]||0)+1,this.total++}if(zt.source=V,Oe){if($===Fe.maxZoom||$===Oe)continue;var En=1<<Oe-$;if(se!==Math.floor(We/En)||ge!==Math.floor(nt/En))continue}else if($===Fe.indexMaxZoom||zt.numPoints<=Fe.indexMaxPoints)continue;if(zt.source=null,V.length!==0){yt>1&&console.time("clipping");var un,Tt,nn,Zr,Yr,oi,Qr=.5*Fe.buffer/Fe.extent,Ti=.5-Qr,ea=.5+Qr,bi=1+Qr;un=Tt=nn=Zr=null,Yr=ve(V,dr,se-Qr,se+ea,0,zt.minX,zt.maxX,Fe),oi=ve(V,dr,se+Ti,se+bi,0,zt.minX,zt.maxX,Fe),V=null,Yr&&(un=ve(Yr,dr,ge-Qr,ge+ea,1,zt.minY,zt.maxY,Fe),Tt=ve(Yr,dr,ge+Ti,ge+bi,1,zt.minY,zt.maxY,Fe),Yr=null),oi&&(nn=ve(oi,dr,ge-Qr,ge+ea,1,zt.minY,zt.maxY,Fe),Zr=ve(oi,dr,ge+Ti,ge+bi,1,zt.minY,zt.maxY,Fe),oi=null),yt>1&&console.timeEnd("clipping"),pe.push(un||[],$+1,2*se,2*ge),pe.push(Tt||[],$+1,2*se,2*ge+1),pe.push(nn||[],$+1,2*se+1,2*ge),pe.push(Zr||[],$+1,2*se+1,2*ge+1)}}},Ja.prototype.getTile=function(V,$,se){var ge=this.options,Oe=ge.extent,We=ge.debug;if(V<0||V>24)return null;var nt=1<<V,pe=hs(V,$=($%nt+nt)%nt,se);if(this.tiles[pe])return ci(this.tiles[pe],Oe);We>1&&console.log("drilling down to z%d-%d-%d",V,$,se);for(var Fe,yt=V,dr=$,Dt=se;!Fe&&yt>0;)yt--,dr=Math.floor(dr/2),Dt=Math.floor(Dt/2),Fe=this.tiles[hs(yt,dr,Dt)];return Fe&&Fe.source?(We>1&&console.log("found parent tile z%d-%d-%d",yt,dr,Dt),We>1&&console.time("drilling down"),this.splitTile(Fe.source,yt,dr,Dt,V,$,se),We>1&&console.timeEnd("drilling down"),this.tiles[pe]?ci(this.tiles[pe],Oe):null):null};var Da=function(V){function $(se,ge,Oe,We){V.call(this,se,ge,Oe,_a),We&&(this.loadGeoJSON=We)}return V&&($.__proto__=V),($.prototype=Object.create(V&&V.prototype)).constructor=$,$.prototype.loadData=function(se,ge){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=ge,this._pendingLoadDataParams=se,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},$.prototype._loadData=function(){var se=this;if(this._pendingCallback&&this._pendingLoadDataParams){var ge=this._pendingCallback,Oe=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var We=!!(Oe&&Oe.request&&Oe.request.collectResourceTiming)&&new v.RequestPerformance(Oe.request);this.loadGeoJSON(Oe,function(nt,pe){if(nt||!pe)return ge(nt);if(typeof pe!="object")return ge(new Error("Input data given to '"+Oe.source+"' is not a valid GeoJSON object."));(function zt(gr,En){var un,Tt=gr&&gr.type;if(Tt==="FeatureCollection")for(un=0;un<gr.features.length;un++)zt(gr.features[un],En);else if(Tt==="GeometryCollection")for(un=0;un<gr.geometries.length;un++)zt(gr.geometries[un],En);else if(Tt==="Feature")zt(gr.geometry,En);else if(Tt==="Polygon")ir(gr.coordinates,En);else if(Tt==="MultiPolygon")for(un=0;un<gr.coordinates.length;un++)ir(gr.coordinates[un],En);return gr})(pe,!0);try{if(Oe.filter){var Fe=v.createExpression(Oe.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Fe.result==="error")throw new Error(Fe.value.map(function(zt){return zt.key+": "+zt.message}).join(", "));var yt=pe.features.filter(function(zt){return Fe.value.evaluate({zoom:0},zt)});pe={type:"FeatureCollection",features:yt}}se._geoJSONIndex=Oe.cluster?new hn(function(zt){var gr=zt.superclusterOptions,En=zt.clusterProperties;if(!En||!gr)return gr;for(var un={},Tt={},nn={accumulated:null,zoom:0},Zr={properties:null},Yr=Object.keys(En),oi=0,Qr=Yr;oi<Qr.length;oi+=1){var Ti=Qr[oi],ea=En[Ti],bi=ea[0],Oi=v.createExpression(ea[1]),Ci=v.createExpression(typeof bi=="string"?[bi,["accumulated"],["get",Ti]]:bi);un[Ti]=Oi.value,Tt[Ti]=Ci.value}return gr.map=function(ti){Zr.properties=ti;for(var Xi={},Fa=0,oa=Yr;Fa<oa.length;Fa+=1){var Ri=oa[Fa];Xi[Ri]=un[Ri].evaluate(nn,Zr)}return Xi},gr.reduce=function(ti,Xi){Zr.properties=Xi;for(var Fa=0,oa=Yr;Fa<oa.length;Fa+=1){var Ri=oa[Fa];nn.accumulated=ti[Ri],ti[Ri]=Tt[Ri].evaluate(nn,Zr)}},gr}(Oe)).load(pe.features):function(zt,gr){return new Ja(zt,gr)}(pe,Oe.geojsonVtOptions)}catch(zt){return ge(zt)}se.loaded={};var dr={};if(We){var Dt=We.finish();Dt&&(dr.resourceTiming={},dr.resourceTiming[Oe.source]=JSON.parse(JSON.stringify(Dt)))}ge(null,dr)})}},$.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},$.prototype.reloadTile=function(se,ge){var Oe=this.loaded;return Oe&&Oe[se.uid]?V.prototype.reloadTile.call(this,se,ge):this.loadTile(se,ge)},$.prototype.loadGeoJSON=function(se,ge){if(se.request)v.getJSON(se.request,ge);else{if(typeof se.data!="string")return ge(new Error("Input data given to '"+se.source+"' is not a valid GeoJSON object."));try{return ge(null,JSON.parse(se.data))}catch(Oe){return ge(new Error("Input data given to '"+se.source+"' is not a valid GeoJSON object."))}}},$.prototype.removeSource=function(se,ge){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),ge()},$.prototype.getClusterExpansionZoom=function(se,ge){try{ge(null,this._geoJSONIndex.getClusterExpansionZoom(se.clusterId))}catch(Oe){ge(Oe)}},$.prototype.getClusterChildren=function(se,ge){try{ge(null,this._geoJSONIndex.getChildren(se.clusterId))}catch(Oe){ge(Oe)}},$.prototype.getClusterLeaves=function(se,ge){try{ge(null,this._geoJSONIndex.getLeaves(se.clusterId,se.limit,se.offset))}catch(Oe){ge(Oe)}},$}(Ce),Ta=function(V){var $=this;this.self=V,this.actor=new v.Actor(V,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:Ce,geojson:Da},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(se,ge){if($.workerSourceTypes[se])throw new Error('Worker source with name "'+se+'" already registered.');$.workerSourceTypes[se]=ge},this.self.registerRTLTextPlugin=function(se){if(v.plugin.isParsed())throw new Error("RTL text plugin already registered.");v.plugin.applyArabicShaping=se.applyArabicShaping,v.plugin.processBidirectionalText=se.processBidirectionalText,v.plugin.processStyledBidirectionalText=se.processStyledBidirectionalText}};return Ta.prototype.setReferrer=function(V,$){this.referrer=$},Ta.prototype.setImages=function(V,$,se){for(var ge in this.availableImages[V]=$,this.workerSources[V]){var Oe=this.workerSources[V][ge];for(var We in Oe)Oe[We].availableImages=$}se()},Ta.prototype.setLayers=function(V,$,se){this.getLayerIndex(V).replace($),se()},Ta.prototype.updateLayers=function(V,$,se){this.getLayerIndex(V).update($.layers,$.removedIds),se()},Ta.prototype.loadTile=function(V,$,se){this.getWorkerSource(V,$.type,$.source).loadTile($,se)},Ta.prototype.loadDEMTile=function(V,$,se){this.getDEMWorkerSource(V,$.source).loadTile($,se)},Ta.prototype.reloadTile=function(V,$,se){this.getWorkerSource(V,$.type,$.source).reloadTile($,se)},Ta.prototype.abortTile=function(V,$,se){this.getWorkerSource(V,$.type,$.source).abortTile($,se)},Ta.prototype.removeTile=function(V,$,se){this.getWorkerSource(V,$.type,$.source).removeTile($,se)},Ta.prototype.removeDEMTile=function(V,$){this.getDEMWorkerSource(V,$.source).removeTile($)},Ta.prototype.removeSource=function(V,$,se){if(this.workerSources[V]&&this.workerSources[V][$.type]&&this.workerSources[V][$.type][$.source]){var ge=this.workerSources[V][$.type][$.source];delete this.workerSources[V][$.type][$.source],ge.removeSource!==void 0?ge.removeSource($,se):se()}},Ta.prototype.loadWorkerSource=function(V,$,se){try{this.self.importScripts($.url),se()}catch(ge){se(ge.toString())}},Ta.prototype.syncRTLPluginState=function(V,$,se){try{v.plugin.setState($);var ge=v.plugin.getPluginURL();if(v.plugin.isLoaded()&&!v.plugin.isParsed()&&ge!=null){this.self.importScripts(ge);var Oe=v.plugin.isParsed();se(Oe?void 0:new Error("RTL Text Plugin failed to import scripts from "+ge),Oe)}}catch(We){se(We.toString())}},Ta.prototype.getAvailableImages=function(V){var $=this.availableImages[V];return $||($=[]),$},Ta.prototype.getLayerIndex=function(V){var $=this.layerIndexes[V];return $||($=this.layerIndexes[V]=new Q),$},Ta.prototype.getWorkerSource=function(V,$,se){var ge=this;return this.workerSources[V]||(this.workerSources[V]={}),this.workerSources[V][$]||(this.workerSources[V][$]={}),this.workerSources[V][$][se]||(this.workerSources[V][$][se]=new this.workerSourceTypes[$]({send:function(Oe,We,nt){ge.actor.send(Oe,We,nt,V)}},this.getLayerIndex(V),this.getAvailableImages(V))),this.workerSources[V][$][se]},Ta.prototype.getDEMWorkerSource=function(V,$){return this.demWorkerSources[V]||(this.demWorkerSources[V]={}),this.demWorkerSources[V][$]||(this.demWorkerSources[V][$]=new Mt),this.demWorkerSources[V][$]},Ta.prototype.enforceCacheSizeLimit=function(V,$){v.enforceCacheSizeLimit($)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new Ta(self)),Ta}),J(["./shared"],function(v){"use strict";var te=v.createCommonjsModule(function(l){function f(E){return!c(E)}function c(E){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var T,L,Z=new Blob([""],{type:"text/javascript"}),W=URL.createObjectURL(Z);try{L=new Worker(W),T=!0}catch(fe){T=!1}return L&&L.terminate(),URL.revokeObjectURL(W),T}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var T=document.createElement("canvas");T.width=T.height=1;var L=T.getContext("2d");if(!L)return!1;var Z=L.getImageData(0,0,1,1);return Z&&Z.width===T.width}()?(d[C=E&&E.failIfMajorPerformanceCaveat]===void 0&&(d[C]=function(T){var L=function(W){var fe=document.createElement("canvas"),he=Object.create(f.webGLContextAttributes);return he.failIfMajorPerformanceCaveat=W,fe.probablySupportsContext?fe.probablySupportsContext("webgl",he)||fe.probablySupportsContext("experimental-webgl",he):fe.supportsContext?fe.supportsContext("webgl",he)||fe.supportsContext("experimental-webgl",he):fe.getContext("webgl",he)||fe.getContext("experimental-webgl",he)}(T);if(!L)return!1;var Z=L.createShader(L.VERTEX_SHADER);return!(!Z||L.isContextLost())&&(L.shaderSource(Z,"void main() {}"),L.compileShader(Z),L.getShaderParameter(Z,L.COMPILE_STATUS)===!0)}(C)),d[C]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var C}l.exports?l.exports=f:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=f,window.mapboxgl.notSupportedReason=c);var d={};f.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),B={create:function(l,f,c){var d=v.window.document.createElement(l);return f!==void 0&&(d.className=f),c&&c.appendChild(d),d},createNS:function(l,f){return v.window.document.createElementNS(l,f)}},Q=v.window.document&&v.window.document.documentElement.style;function ie(l){if(!Q)return l[0];for(var f=0;f<l.length;f++)if(l[f]in Q)return l[f];return l[0]}var Ee,re=ie(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);B.disableDrag=function(){Q&&re&&(Ee=Q[re],Q[re]="none")},B.enableDrag=function(){Q&&re&&(Q[re]=Ee)};var Ge=ie(["transform","WebkitTransform"]);B.setTransform=function(l,f){l.style[Ge]=f};var Ce=!1;try{var tt=Object.defineProperty({},"passive",{get:function(){Ce=!0}});v.window.addEventListener("test",tt,tt),v.window.removeEventListener("test",tt,tt)}catch(l){Ce=!1}B.addEventListener=function(l,f,c,d){d===void 0&&(d={}),l.addEventListener(f,c,"passive"in d&&Ce?d:d.capture)},B.removeEventListener=function(l,f,c,d){d===void 0&&(d={}),l.removeEventListener(f,c,"passive"in d&&Ce?d:d.capture)};var Mt=function(l){l.preventDefault(),l.stopPropagation(),v.window.removeEventListener("click",Mt,!0)};function ir(l){var f=l.userImage;return!!(f&&f.render&&f.render())&&(l.data.replace(new Uint8Array(f.data.buffer)),!0)}B.suppressClick=function(){v.window.addEventListener("click",Mt,!0),v.window.setTimeout(function(){v.window.removeEventListener("click",Mt,!0)},0)},B.mousePos=function(l,f){var c=l.getBoundingClientRect();return new v.Point(f.clientX-c.left-l.clientLeft,f.clientY-c.top-l.clientTop)},B.touchPos=function(l,f){for(var c=l.getBoundingClientRect(),d=[],E=0;E<f.length;E++)d.push(new v.Point(f[E].clientX-c.left-l.clientLeft,f[E].clientY-c.top-l.clientTop));return d},B.mouseButton=function(l){return v.window.InstallTrigger!==void 0&&l.button===2&&l.ctrlKey&&v.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:l.button},B.remove=function(l){l.parentNode&&l.parentNode.removeChild(l)};var bt=function(l){function f(){l.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new v.RGBAImage({width:1,height:1}),this.dirty=!0}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.isLoaded=function(){return this.loaded},f.prototype.setLoaded=function(c){if(this.loaded!==c&&(this.loaded=c,c)){for(var d=0,E=this.requestors;d<E.length;d+=1){var C=E[d];this._notify(C.ids,C.callback)}this.requestors=[]}},f.prototype.getImage=function(c){return this.images[c]},f.prototype.addImage=function(c,d){this._validate(c,d)&&(this.images[c]=d)},f.prototype._validate=function(c,d){var E=!0;return this._validateStretch(d.stretchX,d.data&&d.data.width)||(this.fire(new v.ErrorEvent(new Error('Image "'+c+'" has invalid "stretchX" value'))),E=!1),this._validateStretch(d.stretchY,d.data&&d.data.height)||(this.fire(new v.ErrorEvent(new Error('Image "'+c+'" has invalid "stretchY" value'))),E=!1),this._validateContent(d.content,d)||(this.fire(new v.ErrorEvent(new Error('Image "'+c+'" has invalid "content" value'))),E=!1),E},f.prototype._validateStretch=function(c,d){if(!c)return!0;for(var E=0,C=0,T=c;C<T.length;C+=1){var L=T[C];if(L[0]<E||L[1]<L[0]||d<L[1])return!1;E=L[1]}return!0},f.prototype._validateContent=function(c,d){return!(c&&(c.length!==4||c[0]<0||d.data.width<c[0]||c[1]<0||d.data.height<c[1]||c[2]<0||d.data.width<c[2]||c[3]<0||d.data.height<c[3]||c[2]<c[0]||c[3]<c[1]))},f.prototype.updateImage=function(c,d){d.version=this.images[c].version+1,this.images[c]=d,this.updatedImages[c]=!0},f.prototype.removeImage=function(c){var d=this.images[c];delete this.images[c],delete this.patterns[c],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()},f.prototype.listImages=function(){return Object.keys(this.images)},f.prototype.getImages=function(c,d){var E=!0;if(!this.isLoaded())for(var C=0,T=c;C<T.length;C+=1)this.images[T[C]]||(E=!1);this.isLoaded()||E?this._notify(c,d):this.requestors.push({ids:c,callback:d})},f.prototype._notify=function(c,d){for(var E={},C=0,T=c;C<T.length;C+=1){var L=T[C];this.images[L]||this.fire(new v.Event("styleimagemissing",{id:L}));var Z=this.images[L];Z?E[L]={data:Z.data.clone(),pixelRatio:Z.pixelRatio,sdf:Z.sdf,version:Z.version,stretchX:Z.stretchX,stretchY:Z.stretchY,content:Z.content,hasRenderCallback:Boolean(Z.userImage&&Z.userImage.render)}:v.warnOnce('Image "'+L+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}d(null,E)},f.prototype.getPixelSize=function(){var c=this.atlasImage;return{width:c.width,height:c.height}},f.prototype.getPattern=function(c){var d=this.patterns[c],E=this.getImage(c);if(!E)return null;if(d&&d.position.version===E.version)return d.position;if(d)d.position.version=E.version;else{var C={w:E.data.width+2,h:E.data.height+2,x:0,y:0},T=new v.ImagePosition(C,E);this.patterns[c]={bin:C,position:T}}return this._updatePatternAtlas(),this.patterns[c].position},f.prototype.bind=function(c){var d=c.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new v.Texture(c,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)},f.prototype._updatePatternAtlas=function(){var c=[];for(var d in this.patterns)c.push(this.patterns[d].bin);var E=v.potpack(c),C=E.w,T=E.h,L=this.atlasImage;for(var Z in L.resize({width:C||1,height:T||1}),this.patterns){var W=this.patterns[Z].bin,fe=W.x+1,he=W.y+1,de=this.images[Z].data,Le=de.width,Re=de.height;v.RGBAImage.copy(de,L,{x:0,y:0},{x:fe,y:he},{width:Le,height:Re}),v.RGBAImage.copy(de,L,{x:0,y:Re-1},{x:fe,y:he-1},{width:Le,height:1}),v.RGBAImage.copy(de,L,{x:0,y:0},{x:fe,y:he+Re},{width:Le,height:1}),v.RGBAImage.copy(de,L,{x:Le-1,y:0},{x:fe-1,y:he},{width:1,height:Re}),v.RGBAImage.copy(de,L,{x:0,y:0},{x:fe+Le,y:he},{width:1,height:Re})}this.dirty=!0},f.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},f.prototype.dispatchRenderCallbacks=function(c){for(var d=0,E=c;d<E.length;d+=1){var C=E[d];if(!this.callbackDispatchedThisFrame[C]){this.callbackDispatchedThisFrame[C]=!0;var T=this.images[C];ir(T)&&this.updateImage(C,T)}}},f}(v.Evented),qt=ct,At=ct,ot=1e20;function ct(l,f,c,d,E,C){this.fontSize=l||24,this.buffer=f===void 0?3:f,this.cutoff=d||.25,this.fontFamily=E||"sans-serif",this.fontWeight=C||"normal",this.radius=c||8;var T=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=T,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(T*T),this.gridInner=new Float64Array(T*T),this.f=new Float64Array(T),this.d=new Float64Array(T),this.z=new Float64Array(T+1),this.v=new Int16Array(T),this.middle=Math.round(T/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Qt(l,f,c,d,E,C,T){for(var L=0;L<f;L++){for(var Z=0;Z<c;Z++)d[Z]=l[Z*f+L];for(X(d,E,C,T,c),Z=0;Z<c;Z++)l[Z*f+L]=E[Z]}for(Z=0;Z<c;Z++){for(L=0;L<f;L++)d[L]=l[Z*f+L];for(X(d,E,C,T,f),L=0;L<f;L++)l[Z*f+L]=Math.sqrt(E[L])}}function X(l,f,c,d,E){c[0]=0,d[0]=-ot,d[1]=+ot;for(var C=1,T=0;C<E;C++){for(var L=(l[C]+C*C-(l[c[T]]+c[T]*c[T]))/(2*C-2*c[T]);L<=d[T];)T--,L=(l[C]+C*C-(l[c[T]]+c[T]*c[T]))/(2*C-2*c[T]);c[++T]=C,d[T]=L,d[T+1]=+ot}for(C=0,T=0;C<E;C++){for(;d[T+1]<C;)T++;f[C]=(C-c[T])*(C-c[T])+l[c[T]]}}ct.prototype.draw=function(l){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(l,this.buffer,this.middle);for(var f=this.ctx.getImageData(0,0,this.size,this.size),c=new Uint8ClampedArray(this.size*this.size),d=0;d<this.size*this.size;d++){var E=f.data[4*d+3]/255;this.gridOuter[d]=E===1?0:E===0?ot:Math.pow(Math.max(0,.5-E),2),this.gridInner[d]=E===1?ot:E===0?0:Math.pow(Math.max(0,E-.5),2)}for(Qt(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),Qt(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),d=0;d<this.size*this.size;d++)c[d]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[d]-this.gridInner[d])/this.radius+this.cutoff))));return c},qt.default=At;var Kt=function(l,f){this.requestManager=l,this.localIdeographFontFamily=f,this.entries={}};Kt.prototype.setURL=function(l){this.url=l},Kt.prototype.getGlyphs=function(l,f){var c=this,d=[];for(var E in l)for(var C=0,T=l[E];C<T.length;C+=1)d.push({stack:E,id:T[C]});v.asyncAll(d,function(L,Z){var W=L.stack,fe=L.id,he=c.entries[W];he||(he=c.entries[W]={glyphs:{},requests:{},ranges:{}});var de=he.glyphs[fe];if(de===void 0){if(de=c._tinySDF(he,W,fe))return he.glyphs[fe]=de,void Z(null,{stack:W,id:fe,glyph:de});var Le=Math.floor(fe/256);if(256*Le>65535)Z(new Error("glyphs > 65535 not supported"));else if(he.ranges[Le])Z(null,{stack:W,id:fe,glyph:de});else{var Re=he.requests[Le];Re||(Re=he.requests[Le]=[],Kt.loadGlyphRange(W,Le,c.url,c.requestManager,function(Be,Ae){if(Ae){for(var Ve in Ae)c._doesCharSupportLocalGlyph(+Ve)||(he.glyphs[+Ve]=Ae[+Ve]);he.ranges[Le]=!0}for(var rt=0,xt=Re;rt<xt.length;rt+=1)(0,xt[rt])(Be,Ae);delete he.requests[Le]})),Re.push(function(Be,Ae){Be?Z(Be):Ae&&Z(null,{stack:W,id:fe,glyph:Ae[fe]||null})})}}else Z(null,{stack:W,id:fe,glyph:de})},function(L,Z){if(L)f(L);else if(Z){for(var W={},fe=0,he=Z;fe<he.length;fe+=1){var de=he[fe],Le=de.stack,Re=de.id,Be=de.glyph;(W[Le]||(W[Le]={}))[Re]=Be&&{id:Be.id,bitmap:Be.bitmap.clone(),metrics:Be.metrics}}f(null,W)}})},Kt.prototype._doesCharSupportLocalGlyph=function(l){return!!this.localIdeographFontFamily&&(v.isChar["CJK Unified Ideographs"](l)||v.isChar["Hangul Syllables"](l)||v.isChar.Hiragana(l)||v.isChar.Katakana(l))},Kt.prototype._tinySDF=function(l,f,c){var d=this.localIdeographFontFamily;if(d&&this._doesCharSupportLocalGlyph(c)){var E=l.tinySDF;if(!E){var C="400";/bold/i.test(f)?C="900":/medium/i.test(f)?C="500":/light/i.test(f)&&(C="200"),E=l.tinySDF=new Kt.TinySDF(24,3,8,.25,d,C)}return{id:c,bitmap:new v.AlphaImage({width:30,height:30},E.draw(String.fromCharCode(c))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},Kt.loadGlyphRange=function(l,f,c,d,E){var C=256*f,T=C+255,L=d.transformRequest(d.normalizeGlyphsURL(c).replace("{fontstack}",l).replace("{range}",C+"-"+T),v.ResourceType.Glyphs);v.getArrayBuffer(L,function(Z,W){if(Z)E(Z);else if(W){for(var fe={},he=0,de=v.parseGlyphPBF(W);he<de.length;he+=1){var Le=de[he];fe[Le.id]=Le}E(null,fe)}})},Kt.TinySDF=qt;var vt=function(){this.specification=v.styleSpec.light.position};vt.prototype.possiblyEvaluate=function(l,f){return v.sphericalToCartesian(l.expression.evaluate(f))},vt.prototype.interpolate=function(l,f,c){return{x:v.number(l.x,f.x,c),y:v.number(l.y,f.y,c),z:v.number(l.z,f.z,c)}};var qe=new v.Properties({anchor:new v.DataConstantProperty(v.styleSpec.light.anchor),position:new vt,color:new v.DataConstantProperty(v.styleSpec.light.color),intensity:new v.DataConstantProperty(v.styleSpec.light.intensity)}),dt=function(l){function f(c){l.call(this),this._transitionable=new v.Transitionable(qe),this.setLight(c),this._transitioning=this._transitionable.untransitioned()}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getLight=function(){return this._transitionable.serialize()},f.prototype.setLight=function(c,d){if(d===void 0&&(d={}),!this._validate(v.validateLight,c,d))for(var E in c){var C=c[E];v.endsWith(E,"-transition")?this._transitionable.setTransition(E.slice(0,-"-transition".length),C):this._transitionable.setValue(E,C)}},f.prototype.updateTransitions=function(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)},f.prototype.hasTransition=function(){return this._transitioning.hasTransition()},f.prototype.recalculate=function(c){this.properties=this._transitioning.possiblyEvaluate(c)},f.prototype._validate=function(c,d,E){return(!E||E.validate!==!1)&&v.emitValidationErrors(this,c.call(v.validateStyle,v.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:v.styleSpec})))},f}(v.Evented),$e=function(l,f){this.width=l,this.height=f,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};$e.prototype.getDash=function(l,f){var c=l.join(",")+String(f);return this.dashEntry[c]||(this.dashEntry[c]=this.addDash(l,f)),this.dashEntry[c]},$e.prototype.getDashRanges=function(l,f,c){var d=[],E=l.length%2==1?-l[l.length-1]*c:0,C=l[0]*c,T=!0;d.push({left:E,right:C,isDash:T,zeroLength:l[0]===0});for(var L=l[0],Z=1;Z<l.length;Z++){var W=l[Z];d.push({left:E=L*c,right:C=(L+=W)*c,isDash:T=!T,zeroLength:W===0})}return d},$e.prototype.addRoundDash=function(l,f,c){for(var d=f/2,E=-c;E<=c;E++)for(var C=this.width*(this.nextRow+c+E),T=0,L=l[T],Z=0;Z<this.width;Z++){Z/L.right>1&&(L=l[++T]);var W=Math.abs(Z-L.left),fe=Math.abs(Z-L.right),he=Math.min(W,fe),de=void 0,Le=E/c*(d+1);if(L.isDash){var Re=d-Math.abs(Le);de=Math.sqrt(he*he+Re*Re)}else de=d-Math.sqrt(he*he+Le*Le);this.data[C+Z]=Math.max(0,Math.min(255,de+128))}},$e.prototype.addRegularDash=function(l){for(var f=l.length-1;f>=0;--f){var c=l[f],d=l[f+1];c.zeroLength?l.splice(f,1):d&&d.isDash===c.isDash&&(d.left=c.left,l.splice(f,1))}var E=l[0],C=l[l.length-1];E.isDash===C.isDash&&(E.left=C.left-this.width,C.right=E.right+this.width);for(var T=this.width*this.nextRow,L=0,Z=l[L],W=0;W<this.width;W++){W/Z.right>1&&(Z=l[++L]);var fe=Math.abs(W-Z.left),he=Math.abs(W-Z.right),de=Math.min(fe,he);this.data[T+W]=Math.max(0,Math.min(255,(Z.isDash?de:-de)+128))}},$e.prototype.addDash=function(l,f){var c=f?7:0,d=2*c+1;if(this.nextRow+d>this.height)return v.warnOnce("LineAtlas out of space"),null;for(var E=0,C=0;C<l.length;C++)E+=l[C];if(E!==0){var T=this.width/E,L=this.getDashRanges(l,this.width,T);f?this.addRoundDash(L,T,c):this.addRegularDash(L)}var Z={y:(this.nextRow+c+.5)/this.height,height:2*c/this.height,width:E};return this.nextRow+=d,this.dirty=!0,Z},$e.prototype.bind=function(l){var f=l.gl;this.texture?(f.bindTexture(f.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,f.texSubImage2D(f.TEXTURE_2D,0,0,0,this.width,this.height,f.ALPHA,f.UNSIGNED_BYTE,this.data))):(this.texture=f.createTexture(),f.bindTexture(f.TEXTURE_2D,this.texture),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR),f.texImage2D(f.TEXTURE_2D,0,f.ALPHA,this.width,this.height,0,f.ALPHA,f.UNSIGNED_BYTE,this.data))};var kt=function l(f,c){this.workerPool=f,this.actors=[],this.currentActor=0,this.id=v.uniqueId();for(var d=this.workerPool.acquire(this.id),E=0;E<d.length;E++){var C=new l.Actor(d[E],c,this.id);C.name="Worker "+E,this.actors.push(C)}};function yr(l,f,c){var d=function(E,C){if(E)return c(E);if(C){var T=v.pick(v.extend(C,l),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);C.vector_layers&&(T.vectorLayers=C.vector_layers,T.vectorLayerIds=T.vectorLayers.map(function(L){return L.id})),T.tiles=f.canonicalizeTileset(T,l.url),c(null,T)}};return l.url?v.getJSON(f.transformRequest(f.normalizeSourceURL(l.url),v.ResourceType.Source),d):v.browser.frame(function(){return d(null,l)})}kt.prototype.broadcast=function(l,f,c){v.asyncAll(this.actors,function(d,E){d.send(l,f,E)},c=c||function(){})},kt.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},kt.prototype.remove=function(){this.actors.forEach(function(l){l.remove()}),this.actors=[],this.workerPool.release(this.id)},kt.Actor=v.Actor;var Pr=function(l,f,c){this.bounds=v.LngLatBounds.convert(this.validateBounds(l)),this.minzoom=f||0,this.maxzoom=c||24};Pr.prototype.validateBounds=function(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]},Pr.prototype.contains=function(l){var f=Math.pow(2,l.z),c=Math.floor(v.mercatorXfromLng(this.bounds.getWest())*f),d=Math.floor(v.mercatorYfromLat(this.bounds.getNorth())*f),E=Math.ceil(v.mercatorXfromLng(this.bounds.getEast())*f),C=Math.ceil(v.mercatorYfromLat(this.bounds.getSouth())*f);return l.x>=c&&l.x<E&&l.y>=d&&l.y<C};var Wr=function(l){function f(c,d,E,C){if(l.call(this),this.id=c,this.dispatcher=E,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,v.extend(this,v.pick(d,["url","scheme","tileSize","promoteId"])),this._options=v.extend({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(C)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this._loaded=!1,this.fire(new v.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=yr(this._options,this.map._requestManager,function(d,E){c._tileJSONRequest=null,c._loaded=!0,d?c.fire(new v.ErrorEvent(d)):E&&(v.extend(c,E),E.bounds&&(c.tileBounds=new Pr(E.bounds,c.minzoom,c.maxzoom)),v.postTurnstileEvent(E.tiles,c.map._requestManager._customAccessToken),v.postMapLoadEvent(E.tiles,c.map._getMapId(),c.map._requestManager._skuToken,c.map._requestManager._customAccessToken),c.fire(new v.Event("data",{dataType:"source",sourceDataType:"metadata"})),c.fire(new v.Event("data",{dataType:"source",sourceDataType:"content"})))})},f.prototype.loaded=function(){return this._loaded},f.prototype.hasTile=function(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.setSourceProperty=function(c){this._tileJSONRequest&&this._tileJSONRequest.cancel(),c(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},f.prototype.setTiles=function(c){var d=this;return this.setSourceProperty(function(){d._options.tiles=c}),this},f.prototype.setUrl=function(c){var d=this;return this.setSourceProperty(function(){d.url=c,d._options.url=c}),this},f.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},f.prototype.serialize=function(){return v.extend({},this._options)},f.prototype.loadTile=function(c,d){var E=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),C={request:this.map._requestManager.transformRequest(E,v.ResourceType.Tile),uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:v.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function T(L,Z){return delete c.request,c.aborted?d(null):L&&L.status!==404?d(L):(Z&&Z.resourceTiming&&(c.resourceTiming=Z.resourceTiming),this.map._refreshExpiredTiles&&Z&&c.setExpiryData(Z),c.loadVectorData(Z,this.map.painter),v.cacheEntryPossiblyAdded(this.dispatcher),d(null),void(c.reloadCallback&&(this.loadTile(c,c.reloadCallback),c.reloadCallback=null)))}C.request.collectResourceTiming=this._collectResourceTiming,c.actor&&c.state!=="expired"?c.state==="loading"?c.reloadCallback=d:c.request=c.actor.send("reloadTile",C,T.bind(this)):(c.actor=this.dispatcher.getActor(),c.request=c.actor.send("loadTile",C,T.bind(this)))},f.prototype.abortTile=function(c){c.request&&(c.request.cancel(),delete c.request),c.actor&&c.actor.send("abortTile",{uid:c.uid,type:this.type,source:this.id},void 0)},f.prototype.unloadTile=function(c){c.unloadVectorData(),c.actor&&c.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id},void 0)},f.prototype.hasTransition=function(){return!1},f}(v.Evented),Te=function(l){function f(c,d,E,C){l.call(this),this.id=c,this.dispatcher=E,this.setEventedParent(C),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=v.extend({type:"raster"},d),v.extend(this,v.pick(d,["url","scheme","tileSize"]))}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this._loaded=!1,this.fire(new v.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=yr(this._options,this.map._requestManager,function(d,E){c._tileJSONRequest=null,c._loaded=!0,d?c.fire(new v.ErrorEvent(d)):E&&(v.extend(c,E),E.bounds&&(c.tileBounds=new Pr(E.bounds,c.minzoom,c.maxzoom)),v.postTurnstileEvent(E.tiles),v.postMapLoadEvent(E.tiles,c.map._getMapId(),c.map._requestManager._skuToken),c.fire(new v.Event("data",{dataType:"source",sourceDataType:"metadata"})),c.fire(new v.Event("data",{dataType:"source",sourceDataType:"content"})))})},f.prototype.loaded=function(){return this._loaded},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},f.prototype.serialize=function(){return v.extend({},this._options)},f.prototype.hasTile=function(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)},f.prototype.loadTile=function(c,d){var E=this,C=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);c.request=v.getImage(this.map._requestManager.transformRequest(C,v.ResourceType.Tile),function(T,L){if(delete c.request,c.aborted)c.state="unloaded",d(null);else if(T)c.state="errored",d(T);else if(L){E.map._refreshExpiredTiles&&c.setExpiryData(L),delete L.cacheControl,delete L.expires;var Z=E.map.painter.context,W=Z.gl;c.texture=E.map.painter.getTileTexture(L.width),c.texture?c.texture.update(L,{useMipmap:!0}):(c.texture=new v.Texture(Z,L,W.RGBA,{useMipmap:!0}),c.texture.bind(W.LINEAR,W.CLAMP_TO_EDGE,W.LINEAR_MIPMAP_NEAREST),Z.extTextureFilterAnisotropic&&W.texParameterf(W.TEXTURE_2D,Z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Z.extTextureFilterAnisotropicMax)),c.state="loaded",v.cacheEntryPossiblyAdded(E.dispatcher),d(null)}})},f.prototype.abortTile=function(c,d){c.request&&(c.request.cancel(),delete c.request),d()},f.prototype.unloadTile=function(c,d){c.texture&&this.map.painter.saveTileTexture(c.texture),d()},f.prototype.hasTransition=function(){return!1},f}(v.Evented),Ye=function(l){function f(c,d,E,C){l.call(this,c,d,E,C),this.type="raster-dem",this.maxzoom=22,this._options=v.extend({type:"raster-dem"},d),this.encoding=d.encoding||"mapbox"}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},f.prototype.loadTile=function(c,d){var E=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function C(T,L){T&&(c.state="errored",d(T)),L&&(c.dem=L,c.needsHillshadePrepare=!0,c.state="loaded",d(null))}c.request=v.getImage(this.map._requestManager.transformRequest(E,v.ResourceType.Tile),function(T,L){if(delete c.request,c.aborted)c.state="unloaded",d(null);else if(T)c.state="errored",d(T);else if(L){this.map._refreshExpiredTiles&&c.setExpiryData(L),delete L.cacheControl,delete L.expires;var Z=v.window.ImageBitmap&&L instanceof v.window.ImageBitmap&&v.offscreenCanvasSupported()?L:v.browser.getImageData(L,1),W={uid:c.uid,coord:c.tileID,source:this.id,rawImageData:Z,encoding:this.encoding};c.actor&&c.state!=="expired"||(c.actor=this.dispatcher.getActor(),c.actor.send("loadDEMTile",W,C.bind(this)))}}.bind(this)),c.neighboringTiles=this._getNeighboringTiles(c.tileID)},f.prototype._getNeighboringTiles=function(c){var d=c.canonical,E=Math.pow(2,d.z),C=(d.x-1+E)%E,T=d.x===0?c.wrap-1:c.wrap,L=(d.x+1+E)%E,Z=d.x+1===E?c.wrap+1:c.wrap,W={};return W[new v.OverscaledTileID(c.overscaledZ,T,d.z,C,d.y).key]={backfilled:!1},W[new v.OverscaledTileID(c.overscaledZ,Z,d.z,L,d.y).key]={backfilled:!1},d.y>0&&(W[new v.OverscaledTileID(c.overscaledZ,T,d.z,C,d.y-1).key]={backfilled:!1},W[new v.OverscaledTileID(c.overscaledZ,c.wrap,d.z,d.x,d.y-1).key]={backfilled:!1},W[new v.OverscaledTileID(c.overscaledZ,Z,d.z,L,d.y-1).key]={backfilled:!1}),d.y+1<E&&(W[new v.OverscaledTileID(c.overscaledZ,T,d.z,C,d.y+1).key]={backfilled:!1},W[new v.OverscaledTileID(c.overscaledZ,c.wrap,d.z,d.x,d.y+1).key]={backfilled:!1},W[new v.OverscaledTileID(c.overscaledZ,Z,d.z,L,d.y+1).key]={backfilled:!1}),W},f.prototype.unloadTile=function(c){c.demTexture&&this.map.painter.saveTileTexture(c.demTexture),c.fbo&&(c.fbo.destroy(),delete c.fbo),c.dem&&delete c.dem,delete c.neighboringTiles,c.state="unloaded",c.actor&&c.actor.send("removeDEMTile",{uid:c.uid,source:this.id})},f}(Te),De=function(l){function f(c,d,E,C){l.call(this),this.id=c,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=E.getActor(),this.setEventedParent(C),this._data=d.data,this._options=v.extend({},d),this._collectResourceTiming=d.collectResourceTiming,this._resourceTiming=[],d.maxzoom!==void 0&&(this.maxzoom=d.maxzoom),d.type&&(this.type=d.type),d.attribution&&(this.attribution=d.attribution),this.promoteId=d.promoteId;var T=v.EXTENT/this.tileSize;this.workerOptions=v.extend({source:this.id,cluster:d.cluster||!1,geojsonVtOptions:{buffer:(d.buffer!==void 0?d.buffer:128)*T,tolerance:(d.tolerance!==void 0?d.tolerance:.375)*T,extent:v.EXTENT,maxZoom:this.maxzoom,lineMetrics:d.lineMetrics||!1,generateId:d.generateId||!1},superclusterOptions:{maxZoom:d.clusterMaxZoom!==void 0?Math.min(d.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,d.clusterMinPoints||2),extent:v.EXTENT,radius:(d.clusterRadius||50)*T,log:!1,generateId:d.generateId||!1},clusterProperties:d.clusterProperties,filter:d.filter},d.workerOptions)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this.fire(new v.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(d){if(d)c.fire(new v.ErrorEvent(d));else{var E={dataType:"source",sourceDataType:"metadata"};c._collectResourceTiming&&c._resourceTiming&&c._resourceTiming.length>0&&(E.resourceTiming=c._resourceTiming,c._resourceTiming=[]),c.fire(new v.Event("data",E))}})},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.setData=function(c){var d=this;return this._data=c,this.fire(new v.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(E){if(E)d.fire(new v.ErrorEvent(E));else{var C={dataType:"source",sourceDataType:"content"};d._collectResourceTiming&&d._resourceTiming&&d._resourceTiming.length>0&&(C.resourceTiming=d._resourceTiming,d._resourceTiming=[]),d.fire(new v.Event("data",C))}}),this},f.prototype.getClusterExpansionZoom=function(c,d){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:c,source:this.id},d),this},f.prototype.getClusterChildren=function(c,d){return this.actor.send("geojson.getClusterChildren",{clusterId:c,source:this.id},d),this},f.prototype.getClusterLeaves=function(c,d,E,C){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:c,limit:d,offset:E},C),this},f.prototype._updateWorkerData=function(c){var d=this;this._loaded=!1;var E=v.extend({},this.workerOptions),C=this._data;typeof C=="string"?(E.request=this.map._requestManager.transformRequest(v.browser.resolveURL(C),v.ResourceType.Source),E.request.collectResourceTiming=this._collectResourceTiming):E.data=JSON.stringify(C),this.actor.send(this.type+".loadData",E,function(T,L){d._removed||L&&L.abandoned||(d._loaded=!0,L&&L.resourceTiming&&L.resourceTiming[d.id]&&(d._resourceTiming=L.resourceTiming[d.id].slice(0)),d.actor.send(d.type+".coalesce",{source:E.source},null),c(T))})},f.prototype.loaded=function(){return this._loaded},f.prototype.loadTile=function(c,d){var E=this,C=c.actor?"reloadTile":"loadTile";c.actor=this.actor,c.request=this.actor.send(C,{type:this.type,uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:v.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(T,L){return delete c.request,c.unloadVectorData(),c.aborted?d(null):T?d(T):(c.loadVectorData(L,E.map.painter,C==="reloadTile"),d(null))})},f.prototype.abortTile=function(c){c.request&&(c.request.cancel(),delete c.request),c.aborted=!0},f.prototype.unloadTile=function(c){c.unloadVectorData(),this.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})},f.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},f.prototype.serialize=function(){return v.extend({},this._options,{type:this.type,data:this._data})},f.prototype.hasTransition=function(){return!1},f}(v.Evented),wt=v.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),gt=function(l){function f(c,d,E,C){l.call(this),this.id=c,this.dispatcher=E,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(C),this.options=d}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(c,d){var E=this;this._loaded=!1,this.fire(new v.Event("dataloading",{dataType:"source"})),this.url=this.options.url,v.getImage(this.map._requestManager.transformRequest(this.url,v.ResourceType.Image),function(C,T){E._loaded=!0,C?E.fire(new v.ErrorEvent(C)):T&&(E.image=T,c&&(E.coordinates=c),d&&d(),E._finishLoading())})},f.prototype.loaded=function(){return this._loaded},f.prototype.updateImage=function(c){var d=this;return this.image&&c.url?(this.options.url=c.url,this.load(c.coordinates,function(){d.texture=null}),this):this},f.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new v.Event("data",{dataType:"source",sourceDataType:"metadata"})))},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.setCoordinates=function(c){var d=this;this.coordinates=c;var E=c.map(v.MercatorCoordinate.fromLngLat);this.tileID=function(T){for(var L=1/0,Z=1/0,W=-1/0,fe=-1/0,he=0,de=T;he<de.length;he+=1){var Le=de[he];L=Math.min(L,Le.x),Z=Math.min(Z,Le.y),W=Math.max(W,Le.x),fe=Math.max(fe,Le.y)}var Re=Math.max(W-L,fe-Z),Be=Math.max(0,Math.floor(-Math.log(Re)/Math.LN2)),Ae=Math.pow(2,Be);return new v.CanonicalTileID(Be,Math.floor((L+W)/2*Ae),Math.floor((Z+fe)/2*Ae))}(E),this.minzoom=this.maxzoom=this.tileID.z;var C=E.map(function(T){return d.tileID.getTilePoint(T)._round()});return this._boundsArray=new v.StructArrayLayout4i8,this._boundsArray.emplaceBack(C[0].x,C[0].y,0,0),this._boundsArray.emplaceBack(C[1].x,C[1].y,v.EXTENT,0),this._boundsArray.emplaceBack(C[3].x,C[3].y,0,v.EXTENT),this._boundsArray.emplaceBack(C[2].x,C[2].y,v.EXTENT,v.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new v.Event("data",{dataType:"source",sourceDataType:"content"})),this},f.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var c=this.map.painter.context,d=c.gl;for(var E in this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,wt.members)),this.boundsSegments||(this.boundsSegments=v.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new v.Texture(c,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this.tiles){var C=this.tiles[E];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture)}}},f.prototype.loadTile=function(c,d){this.tileID&&this.tileID.equals(c.tileID.canonical)?(this.tiles[String(c.tileID.wrap)]=c,c.buckets={},d(null)):(c.state="errored",d(null))},f.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},f.prototype.hasTransition=function(){return!1},f}(v.Evented),Ut=function(l){function f(c,d,E,C){l.call(this,c,d,E,C),this.roundZoom=!0,this.type="video",this.options=d}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this._loaded=!1;var d=this.options;this.urls=[];for(var E=0,C=d.urls;E<C.length;E+=1)this.urls.push(this.map._requestManager.transformRequest(C[E],v.ResourceType.Source).url);v.getVideo(this.urls,function(T,L){c._loaded=!0,T?c.fire(new v.ErrorEvent(T)):L&&(c.video=L,c.video.loop=!0,c.video.addEventListener("playing",function(){c.map.triggerRepaint()}),c.map&&c.video.play(),c._finishLoading())})},f.prototype.pause=function(){this.video&&this.video.pause()},f.prototype.play=function(){this.video&&this.video.play()},f.prototype.seek=function(c){if(this.video){var d=this.video.seekable;c<d.start(0)||c>d.end(0)?this.fire(new v.ErrorEvent(new v.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+d.start(0)+" and "+d.end(0)+"-second mark."))):this.video.currentTime=c}},f.prototype.getVideo=function(){return this.video},f.prototype.onAdd=function(c){this.map||(this.map=c,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},f.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var c=this.map.painter.context,d=c.gl;for(var E in this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,wt.members)),this.boundsSegments||(this.boundsSegments=v.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),d.texSubImage2D(d.TEXTURE_2D,0,0,0,d.RGBA,d.UNSIGNED_BYTE,this.video)):(this.texture=new v.Texture(c,this.video,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this.tiles){var C=this.tiles[E];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture)}}},f.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},f.prototype.hasTransition=function(){return this.video&&!this.video.paused},f}(gt),Jt=function(l){function f(c,d,E,C){l.call(this,c,d,E,C),d.coordinates?Array.isArray(d.coordinates)&&d.coordinates.length===4&&!d.coordinates.some(function(T){return!Array.isArray(T)||T.length!==2||T.some(function(L){return typeof L!="number"})})||this.fire(new v.ErrorEvent(new v.ValidationError("sources."+c,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new v.ErrorEvent(new v.ValidationError("sources."+c,null,'missing required property "coordinates"'))),d.animate&&typeof d.animate!="boolean"&&this.fire(new v.ErrorEvent(new v.ValidationError("sources."+c,null,'optional "animate" property must be a boolean value'))),d.canvas?typeof d.canvas=="string"||d.canvas instanceof v.window.HTMLCanvasElement||this.fire(new v.ErrorEvent(new v.ValidationError("sources."+c,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new v.ErrorEvent(new v.ValidationError("sources."+c,null,'missing required property "canvas"'))),this.options=d,this.animate=d.animate===void 0||d.animate}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof v.window.HTMLCanvasElement?this.options.canvas:v.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new v.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},f.prototype.getCanvas=function(){return this.canvas},f.prototype.onAdd=function(c){this.map=c,this.load(),this.canvas&&this.animate&&this.play()},f.prototype.onRemove=function(){this.pause()},f.prototype.prepare=function(){var c=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,c=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,c=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var d=this.map.painter.context,E=d.gl;for(var C in this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,wt.members)),this.boundsSegments||(this.boundsSegments=v.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(c||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new v.Texture(d,this.canvas,E.RGBA,{premultiply:!0}),this.tiles){var T=this.tiles[C];T.state!=="loaded"&&(T.state="loaded",T.texture=this.texture)}}},f.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},f.prototype.hasTransition=function(){return this._playing},f.prototype._hasInvalidDimensions=function(){for(var c=0,d=[this.canvas.width,this.canvas.height];c<d.length;c+=1){var E=d[c];if(isNaN(E)||E<=0)return!0}return!1},f}(gt),Cr={vector:Wr,raster:Te,"raster-dem":Ye,geojson:De,video:Ut,image:gt,canvas:Jt};function Yn(l,f){var c=v.identity([]);return v.translate(c,c,[1,1,0]),v.scale(c,c,[.5*l.width,.5*l.height,1]),v.multiply(c,c,l.calculatePosMatrix(f.toUnwrapped()))}function hn(l,f,c,d,E,C){var T=function(Be,Ae,Ve){if(Be)for(var rt=0,xt=Be;rt<xt.length;rt+=1){var Wt=Ae[xt[rt]];if(Wt&&Wt.source===Ve&&Wt.type==="fill-extrusion")return!0}else for(var Vt in Ae){var Ot=Ae[Vt];if(Ot.source===Ve&&Ot.type==="fill-extrusion")return!0}return!1}(E&&E.layers,f,l.id),L=C.maxPitchScaleFactor(),Z=l.tilesIn(d,L,T);Z.sort(qi);for(var W=[],fe=0,he=Z;fe<he.length;fe+=1){var de=he[fe];W.push({wrappedTileID:de.tileID.wrapped().key,queryResults:de.tile.queryRenderedFeatures(f,c,l._state,de.queryGeometry,de.cameraQueryGeometry,de.scale,E,C,L,Yn(l.transform,de.tileID))})}var Le=function(Be){for(var Ae={},Ve={},rt=0,xt=Be;rt<xt.length;rt+=1){var Wt=xt[rt],Vt=Wt.queryResults,Ot=Wt.wrappedTileID,vr=Ve[Ot]=Ve[Ot]||{};for(var Br in Vt)for(var Dr=Vt[Br],an=vr[Br]=vr[Br]||{},Bn=Ae[Br]=Ae[Br]||[],kn=0,Nn=Dr;kn<Nn.length;kn+=1){var Bi=Nn[kn];an[Bi.featureIndex]||(an[Bi.featureIndex]=!0,Bn.push(Bi))}}return Ae}(W);for(var Re in Le)Le[Re].forEach(function(Be){var Ae=Be.feature,Ve=l.getFeatureState(Ae.layer["source-layer"],Ae.id);Ae.source=Ae.layer.source,Ae.layer["source-layer"]&&(Ae.sourceLayer=Ae.layer["source-layer"]),Ae.state=Ve});return Le}function qi(l,f){var c=l.tileID,d=f.tileID;return c.overscaledZ-d.overscaledZ||c.canonical.y-d.canonical.y||c.wrap-d.wrap||c.canonical.x-d.canonical.x}var jn=function(l,f){this.max=l,this.onRemove=f,this.reset()};jn.prototype.reset=function(){for(var l in this.data)for(var f=0,c=this.data[l];f<c.length;f+=1){var d=c[f];d.timeout&&clearTimeout(d.timeout),this.onRemove(d.value)}return this.data={},this.order=[],this},jn.prototype.add=function(l,f,c){var d=this,E=l.wrapped().key;this.data[E]===void 0&&(this.data[E]=[]);var C={value:f,timeout:void 0};if(c!==void 0&&(C.timeout=setTimeout(function(){d.remove(l,C)},c)),this.data[E].push(C),this.order.push(E),this.order.length>this.max){var T=this._getAndRemoveByKey(this.order[0]);T&&this.onRemove(T)}return this},jn.prototype.has=function(l){return l.wrapped().key in this.data},jn.prototype.getAndRemove=function(l){return this.has(l)?this._getAndRemoveByKey(l.wrapped().key):null},jn.prototype._getAndRemoveByKey=function(l){var f=this.data[l].shift();return f.timeout&&clearTimeout(f.timeout),this.data[l].length===0&&delete this.data[l],this.order.splice(this.order.indexOf(l),1),f.value},jn.prototype.getByKey=function(l){var f=this.data[l];return f?f[0].value:null},jn.prototype.get=function(l){return this.has(l)?this.data[l.wrapped().key][0].value:null},jn.prototype.remove=function(l,f){if(!this.has(l))return this;var c=l.wrapped().key,d=f===void 0?0:this.data[c].indexOf(f),E=this.data[c][d];return this.data[c].splice(d,1),E.timeout&&clearTimeout(E.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(E.value),this.order.splice(this.order.indexOf(c),1),this},jn.prototype.setMaxSize=function(l){for(this.max=l;this.order.length>this.max;){var f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this},jn.prototype.filter=function(l){var f=[];for(var c in this.data)for(var d=0,E=this.data[c];d<E.length;d+=1){var C=E[d];l(C.value)||f.push(C)}for(var T=0,L=f;T<L.length;T+=1){var Z=L[T];this.remove(Z.value.tileID,Z)}};var Xn=function(l,f,c){this.context=l;var d=l.gl;this.buffer=d.createBuffer(),this.dynamicDraw=Boolean(c),this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),d.bufferData(d.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer};Xn.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},Xn.prototype.updateData=function(l){var f=this.context.gl;this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)},Xn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var vi={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},qn=function(l,f,c,d){this.length=f.length,this.attributes=c,this.itemSize=f.bytesPerElement,this.dynamicDraw=d,this.context=l;var E=l.gl;this.buffer=E.createBuffer(),l.bindVertexBuffer.set(this.buffer),E.bufferData(E.ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer};qn.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},qn.prototype.updateData=function(l){var f=this.context.gl;this.bind(),f.bufferSubData(f.ARRAY_BUFFER,0,l.arrayBuffer)},qn.prototype.enableAttributes=function(l,f){for(var c=0;c<this.attributes.length;c++){var d=f.attributes[this.attributes[c].name];d!==void 0&&l.enableVertexAttribArray(d)}},qn.prototype.setVertexAttribPointers=function(l,f,c){for(var d=0;d<this.attributes.length;d++){var E=this.attributes[d],C=f.attributes[E.name];C!==void 0&&l.vertexAttribPointer(C,E.components,l[vi[E.type]],!1,this.itemSize,E.offset+this.itemSize*(c||0))}},qn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var li=function(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};li.prototype.get=function(){return this.current},li.prototype.set=function(l){},li.prototype.getDefault=function(){return this.default},li.prototype.setDefault=function(){this.set(this.default)};var aa=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return v.Color.transparent},f.prototype.set=function(c){var d=this.current;(c.r!==d.r||c.g!==d.g||c.b!==d.b||c.a!==d.a||this.dirty)&&(this.gl.clearColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)},f}(li),Di=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 1},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.clearDepth(c),this.current=c,this.dirty=!1)},f}(li),Ai=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 0},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.clearStencil(c),this.current=c,this.dirty=!1)},f}(li),Vi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return[!0,!0,!0,!0]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||this.dirty)&&(this.gl.colorMask(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)},f}(li),la=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!0},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.depthMask(c),this.current=c,this.dirty=!1)},f}(li),wi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 255},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.stencilMask(c),this.current=c,this.dirty=!1)},f}(li),Sa=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},f.prototype.set=function(c){var d=this.current;(c.func!==d.func||c.ref!==d.ref||c.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(c.func,c.ref,c.mask),this.current=c,this.dirty=!1)},f}(li),Mn=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){var c=this.gl;return[c.KEEP,c.KEEP,c.KEEP]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(c[0],c[1],c[2]),this.current=c,this.dirty=!1)},f}(li),Si=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=c,this.dirty=!1}},f}(li),ji=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return[0,1]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||this.dirty)&&(this.gl.depthRange(c[0],c[1]),this.current=c,this.dirty=!1)},f}(li),Ki=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=c,this.dirty=!1}},f}(li),Wa=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.LESS},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.depthFunc(c),this.current=c,this.dirty=!1)},f}(li),ve=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.BLEND):d.disable(d.BLEND),this.current=c,this.dirty=!1}},f}(li),Fn=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){var c=this.gl;return[c.ONE,c.ZERO]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(c[0],c[1]),this.current=c,this.dirty=!1)},f}(li),Xa=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return v.Color.transparent},f.prototype.set=function(c){var d=this.current;(c.r!==d.r||c.g!==d.g||c.b!==d.b||c.a!==d.a||this.dirty)&&(this.gl.blendColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)},f}(li),fs=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.FUNC_ADD},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.blendEquation(c),this.current=c,this.dirty=!1)},f}(li),jt=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=c,this.dirty=!1}},f}(li),sr=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.BACK},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.cullFace(c),this.current=c,this.dirty=!1)},f}(li),Tr=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.CCW},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.frontFace(c),this.current=c,this.dirty=!1)},f}(li),I=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.useProgram(c),this.current=c,this.dirty=!1)},f}(li),ur=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.TEXTURE0},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.activeTexture(c),this.current=c,this.dirty=!1)},f}(li),Ln=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){var c=this.gl;return[0,0,c.drawingBufferWidth,c.drawingBufferHeight]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||this.dirty)&&(this.gl.viewport(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)},f}(li),ci=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,c),this.current=c,this.dirty=!1}},f}(li),Gn=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,c),this.current=c,this.dirty=!1}},f}(li),rn=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindTexture(d.TEXTURE_2D,c),this.current=c,this.dirty=!1}},f}(li),Pi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,c),this.current=c,this.dirty=!1}},f}(li),Ii=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){var d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,c),this.current=c,this.dirty=!1},f}(li),Ja=function(l){function f(c){l.call(this,c),this.vao=c.extVertexArrayObject}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){this.vao&&(c!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(c),this.current=c,this.dirty=!1)},f}(li),hs=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 4},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,c),this.current=c,this.dirty=!1}},f}(li),_a=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c),this.current=c,this.dirty=!1}},f}(li),Da=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,c),this.current=c,this.dirty=!1}},f}(li),Ta=function(l){function f(c,d){l.call(this,c),this.context=c,this.parent=d}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f}(li),V=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.setDirty=function(){this.dirty=!0},f.prototype.set=function(c){if(c!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}},f}(Ta),$=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.set=function(c){if(c!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,c),this.current=c,this.dirty=!1}},f}(Ta),se=function(l,f,c,d){this.context=l,this.width=f,this.height=c;var E=this.framebuffer=l.gl.createFramebuffer();this.colorAttachment=new V(l,E),d&&(this.depthAttachment=new $(l,E))};se.prototype.destroy=function(){var l=this.context.gl,f=this.colorAttachment.get();if(f&&l.deleteTexture(f),this.depthAttachment){var c=this.depthAttachment.get();c&&l.deleteRenderbuffer(c)}l.deleteFramebuffer(this.framebuffer)};var ge=function(l,f,c){this.func=l,this.mask=f,this.range=c};ge.ReadOnly=!1,ge.ReadWrite=!0,ge.disabled=new ge(519,ge.ReadOnly,[0,1]);var Oe=function(l,f,c,d,E,C){this.test=l,this.ref=f,this.mask=c,this.fail=d,this.depthFail=E,this.pass=C};Oe.disabled=new Oe({func:519,mask:0},0,0,7680,7680,7680);var We=function(l,f,c){this.blendFunction=l,this.blendColor=f,this.mask=c};We.disabled=new We(We.Replace=[1,0],v.Color.transparent,[!1,!1,!1,!1]),We.unblended=new We(We.Replace,v.Color.transparent,[!0,!0,!0,!0]),We.alphaBlended=new We([1,771],v.Color.transparent,[!0,!0,!0,!0]);var nt=function(l,f,c){this.enable=l,this.mode=f,this.frontFace=c};nt.disabled=new nt(!1,1029,2305),nt.backCCW=new nt(!0,1029,2305);var pe=function(l){this.gl=l,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new aa(this),this.clearDepth=new Di(this),this.clearStencil=new Ai(this),this.colorMask=new Vi(this),this.depthMask=new la(this),this.stencilMask=new wi(this),this.stencilFunc=new Sa(this),this.stencilOp=new Mn(this),this.stencilTest=new Si(this),this.depthRange=new ji(this),this.depthTest=new Ki(this),this.depthFunc=new Wa(this),this.blend=new ve(this),this.blendFunc=new Fn(this),this.blendColor=new Xa(this),this.blendEquation=new fs(this),this.cullFace=new jt(this),this.cullFaceSide=new sr(this),this.frontFace=new Tr(this),this.program=new I(this),this.activeTexture=new ur(this),this.viewport=new Ln(this),this.bindFramebuffer=new ci(this),this.bindRenderbuffer=new Gn(this),this.bindTexture=new rn(this),this.bindVertexBuffer=new Pi(this),this.bindElementBuffer=new Ii(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Ja(this),this.pixelStoreUnpack=new hs(this),this.pixelStoreUnpackPremultiplyAlpha=new _a(this),this.pixelStoreUnpackFlipY=new Da(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=l.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(l.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=l.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=l.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE)};pe.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},pe.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},pe.prototype.createIndexBuffer=function(l,f){return new Xn(this,l,f)},pe.prototype.createVertexBuffer=function(l,f,c){return new qn(this,l,f,c)},pe.prototype.createRenderbuffer=function(l,f,c){var d=this.gl,E=d.createRenderbuffer();return this.bindRenderbuffer.set(E),d.renderbufferStorage(d.RENDERBUFFER,l,f,c),this.bindRenderbuffer.set(null),E},pe.prototype.createFramebuffer=function(l,f,c){return new se(this,l,f,c)},pe.prototype.clear=function(l){var f=l.color,c=l.depth,d=this.gl,E=0;f&&(E|=d.COLOR_BUFFER_BIT,this.clearColor.set(f),this.colorMask.set([!0,!0,!0,!0])),c!==void 0&&(E|=d.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),d.clear(E)},pe.prototype.setCullFace=function(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))},pe.prototype.setDepthMode=function(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)},pe.prototype.setStencilMode=function(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)},pe.prototype.setColorMode=function(l){v.deepEqual(l.blendFunction,We.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)},pe.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var Fe=function(l){function f(c,d,E){var C=this;l.call(this),this.id=c,this.dispatcher=E,this.on("data",function(T){T.dataType==="source"&&T.sourceDataType==="metadata"&&(C._sourceLoaded=!0),C._sourceLoaded&&!C._paused&&T.dataType==="source"&&T.sourceDataType==="content"&&(C.reload(),C.transform&&C.update(C.transform))}),this.on("error",function(){C._sourceErrored=!0}),this._source=function(T,L,Z,W){var fe=new Cr[L.type](T,L,Z,W);if(fe.id!==T)throw new Error("Expected Source id to be "+T+" instead of "+fe.id);return v.bindAll(["load","abort","unload","serialize","prepare"],fe),fe}(c,d,E,this),this._tiles={},this._cache=new jn(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new v.SourceFeatureState}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.onAdd=function(c){this.map=c,this._maxTileCacheSize=c?c._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(c)},f.prototype.onRemove=function(c){this._source&&this._source.onRemove&&this._source.onRemove(c)},f.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var c in this._tiles){var d=this._tiles[c];if(d.state!=="loaded"&&d.state!=="errored")return!1}return!0},f.prototype.getSource=function(){return this._source},f.prototype.pause=function(){this._paused=!0},f.prototype.resume=function(){if(this._paused){var c=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,c&&this.reload(),this.transform&&this.update(this.transform)}},f.prototype._loadTile=function(c,d){return this._source.loadTile(c,d)},f.prototype._unloadTile=function(c){if(this._source.unloadTile)return this._source.unloadTile(c,function(){})},f.prototype._abortTile=function(c){if(this._source.abortTile)return this._source.abortTile(c,function(){})},f.prototype.serialize=function(){return this._source.serialize()},f.prototype.prepare=function(c){for(var d in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var E=this._tiles[d];E.upload(c),E.prepare(this.map.style.imageManager)}},f.prototype.getIds=function(){return v.values(this._tiles).map(function(c){return c.tileID}).sort(yt).map(function(c){return c.key})},f.prototype.getRenderableIds=function(c){var d=this,E=[];for(var C in this._tiles)this._isIdRenderable(C,c)&&E.push(this._tiles[C]);return c?E.sort(function(T,L){var Z=T.tileID,W=L.tileID,fe=new v.Point(Z.canonical.x,Z.canonical.y)._rotate(d.transform.angle),he=new v.Point(W.canonical.x,W.canonical.y)._rotate(d.transform.angle);return Z.overscaledZ-W.overscaledZ||he.y-fe.y||he.x-fe.x}).map(function(T){return T.tileID.key}):E.map(function(T){return T.tileID}).sort(yt).map(function(T){return T.key})},f.prototype.hasRenderableParent=function(c){var d=this.findLoadedParent(c,0);return!!d&&this._isIdRenderable(d.tileID.key)},f.prototype._isIdRenderable=function(c,d){return this._tiles[c]&&this._tiles[c].hasData()&&!this._coveredTiles[c]&&(d||!this._tiles[c].holdingForFade())},f.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var c in this._cache.reset(),this._tiles)this._tiles[c].state!=="errored"&&this._reloadTile(c,"reloading")},f.prototype._reloadTile=function(c,d){var E=this._tiles[c];E&&(E.state!=="loading"&&(E.state=d),this._loadTile(E,this._tileLoaded.bind(this,E,c,d)))},f.prototype._tileLoaded=function(c,d,E,C){if(C)return c.state="errored",void(C.status!==404?this._source.fire(new v.ErrorEvent(C,{tile:c})):this.update(this.transform));c.timeAdded=v.browser.now(),E==="expired"&&(c.refreshedUponExpiration=!0),this._setTileReloadTimer(d,c),this.getSource().type==="raster-dem"&&c.dem&&this._backfillDEM(c),this._state.initializeTileState(c,this.map?this.map.painter:null),this._source.fire(new v.Event("data",{dataType:"source",tile:c,coord:c.tileID}))},f.prototype._backfillDEM=function(c){for(var d=this.getRenderableIds(),E=0;E<d.length;E++){var C=d[E];if(c.neighboringTiles&&c.neighboringTiles[C]){var T=this.getTileByID(C);L(c,T),L(T,c)}}function L(Z,W){Z.needsHillshadePrepare=!0;var fe=W.tileID.canonical.x-Z.tileID.canonical.x,he=W.tileID.canonical.y-Z.tileID.canonical.y,de=Math.pow(2,Z.tileID.canonical.z),Le=W.tileID.key;fe===0&&he===0||Math.abs(he)>1||(Math.abs(fe)>1&&(Math.abs(fe+de)===1?fe+=de:Math.abs(fe-de)===1&&(fe-=de)),W.dem&&Z.dem&&(Z.dem.backfillBorder(W.dem,fe,he),Z.neighboringTiles&&Z.neighboringTiles[Le]&&(Z.neighboringTiles[Le].backfilled=!0)))}},f.prototype.getTile=function(c){return this.getTileByID(c.key)},f.prototype.getTileByID=function(c){return this._tiles[c]},f.prototype._retainLoadedChildren=function(c,d,E,C){for(var T in this._tiles){var L=this._tiles[T];if(!(C[T]||!L.hasData()||L.tileID.overscaledZ<=d||L.tileID.overscaledZ>E)){for(var Z=L.tileID;L&&L.tileID.overscaledZ>d+1;){var W=L.tileID.scaledTo(L.tileID.overscaledZ-1);(L=this._tiles[W.key])&&L.hasData()&&(Z=W)}for(var fe=Z;fe.overscaledZ>d;)if(c[(fe=fe.scaledTo(fe.overscaledZ-1)).key]){C[Z.key]=Z;break}}}},f.prototype.findLoadedParent=function(c,d){if(c.key in this._loadedParentTiles){var E=this._loadedParentTiles[c.key];return E&&E.tileID.overscaledZ>=d?E:null}for(var C=c.overscaledZ-1;C>=d;C--){var T=c.scaledTo(C),L=this._getLoadedTile(T);if(L)return L}},f.prototype._getLoadedTile=function(c){var d=this._tiles[c.key];return d&&d.hasData()?d:this._cache.getByKey(c.wrapped().key)},f.prototype.updateCacheSize=function(c){var d=Math.ceil(c.width/this._source.tileSize)+1,E=Math.ceil(c.height/this._source.tileSize)+1,C=Math.floor(d*E*5),T=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,C):C;this._cache.setMaxSize(T)},f.prototype.handleWrapJump=function(c){var d=Math.round((c-(this._prevLng===void 0?c:this._prevLng))/360);if(this._prevLng=c,d){var E={};for(var C in this._tiles){var T=this._tiles[C];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+d),E[T.tileID.key]=T}for(var L in this._tiles=E,this._timers)clearTimeout(this._timers[L]),delete this._timers[L];for(var Z in this._tiles)this._setTileReloadTimer(Z,this._tiles[Z])}},f.prototype.update=function(c){var d=this;if(this.transform=c,this._sourceLoaded&&!this._paused){var E;this.updateCacheSize(c),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?E=c.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(vr){return new v.OverscaledTileID(vr.canonical.z,vr.wrap,vr.canonical.z,vr.canonical.x,vr.canonical.y)}):(E=c.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(E=E.filter(function(vr){return d._source.hasTile(vr)}))):E=[];var C=c.coveringZoomLevel(this._source),T=Math.max(C-f.maxOverzooming,this._source.minzoom),L=Math.max(C+f.maxUnderzooming,this._source.minzoom),Z=this._updateRetainedTiles(E,C);if(dr(this._source.type)){for(var W={},fe={},he=0,de=Object.keys(Z);he<de.length;he+=1){var Le=de[he],Re=Z[Le],Be=this._tiles[Le];if(Be&&!(Be.fadeEndTime&&Be.fadeEndTime<=v.browser.now())){var Ae=this.findLoadedParent(Re,T);Ae&&(this._addTile(Ae.tileID),W[Ae.tileID.key]=Ae.tileID),fe[Le]=Re}}for(var Ve in this._retainLoadedChildren(fe,C,L,Z),W)Z[Ve]||(this._coveredTiles[Ve]=!0,Z[Ve]=W[Ve])}for(var rt in Z)this._tiles[rt].clearFadeHold();for(var xt=0,Wt=v.keysDifference(this._tiles,Z);xt<Wt.length;xt+=1){var Vt=Wt[xt],Ot=this._tiles[Vt];Ot.hasSymbolBuckets&&!Ot.holdingForFade()?Ot.setHoldDuration(this.map._fadeDuration):Ot.hasSymbolBuckets&&!Ot.symbolFadeFinished()||this._removeTile(Vt)}this._updateLoadedParentTileCache()}},f.prototype.releaseSymbolFadeTiles=function(){for(var c in this._tiles)this._tiles[c].holdingForFade()&&this._removeTile(c)},f.prototype._updateRetainedTiles=function(c,d){for(var E={},C={},T=Math.max(d-f.maxOverzooming,this._source.minzoom),L=Math.max(d+f.maxUnderzooming,this._source.minzoom),Z={},W=0,fe=c;W<fe.length;W+=1){var he=fe[W],de=this._addTile(he);E[he.key]=he,de.hasData()||d<this._source.maxzoom&&(Z[he.key]=he)}this._retainLoadedChildren(Z,d,L,E);for(var Le=0,Re=c;Le<Re.length;Le+=1){var Be=Re[Le],Ae=this._tiles[Be.key];if(!Ae.hasData()){if(d+1>this._source.maxzoom){var Ve=Be.children(this._source.maxzoom)[0],rt=this.getTile(Ve);if(rt&&rt.hasData()){E[Ve.key]=Ve;continue}}else{var xt=Be.children(this._source.maxzoom);if(E[xt[0].key]&&E[xt[1].key]&&E[xt[2].key]&&E[xt[3].key])continue}for(var Wt=Ae.wasRequested(),Vt=Be.overscaledZ-1;Vt>=T;--Vt){var Ot=Be.scaledTo(Vt);if(C[Ot.key]||(C[Ot.key]=!0,!(Ae=this.getTile(Ot))&&Wt&&(Ae=this._addTile(Ot)),Ae&&(E[Ot.key]=Ot,Wt=Ae.wasRequested(),Ae.hasData())))break}}}return E},f.prototype._updateLoadedParentTileCache=function(){for(var c in this._loadedParentTiles={},this._tiles){for(var d=[],E=void 0,C=this._tiles[c].tileID;C.overscaledZ>0;){if(C.key in this._loadedParentTiles){E=this._loadedParentTiles[C.key];break}d.push(C.key);var T=C.scaledTo(C.overscaledZ-1);if(E=this._getLoadedTile(T))break;C=T}for(var L=0,Z=d;L<Z.length;L+=1)this._loadedParentTiles[Z[L]]=E}},f.prototype._addTile=function(c){var d=this._tiles[c.key];if(d)return d;(d=this._cache.getAndRemove(c))&&(this._setTileReloadTimer(c.key,d),d.tileID=c,this._state.initializeTileState(d,this.map?this.map.painter:null),this._cacheTimers[c.key]&&(clearTimeout(this._cacheTimers[c.key]),delete this._cacheTimers[c.key],this._setTileReloadTimer(c.key,d)));var E=Boolean(d);return E||(d=new v.Tile(c,this._source.tileSize*c.overscaleFactor()),this._loadTile(d,this._tileLoaded.bind(this,d,c.key,d.state))),d?(d.uses++,this._tiles[c.key]=d,E||this._source.fire(new v.Event("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d):null},f.prototype._setTileReloadTimer=function(c,d){var E=this;c in this._timers&&(clearTimeout(this._timers[c]),delete this._timers[c]);var C=d.getExpiryTimeout();C&&(this._timers[c]=setTimeout(function(){E._reloadTile(c,"expired"),delete E._timers[c]},C))},f.prototype._removeTile=function(c){var d=this._tiles[c];d&&(d.uses--,delete this._tiles[c],this._timers[c]&&(clearTimeout(this._timers[c]),delete this._timers[c]),d.uses>0||(d.hasData()&&d.state!=="reloading"?this._cache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))},f.prototype.clearTiles=function(){for(var c in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(c);this._cache.reset()},f.prototype.tilesIn=function(c,d,E){var C=this,T=[],L=this.transform;if(!L)return T;for(var Z=E?L.getCameraQueryGeometry(c):c,W=c.map(function(Vt){return L.pointCoordinate(Vt)}),fe=Z.map(function(Vt){return L.pointCoordinate(Vt)}),he=this.getIds(),de=1/0,Le=1/0,Re=-1/0,Be=-1/0,Ae=0,Ve=fe;Ae<Ve.length;Ae+=1){var rt=Ve[Ae];de=Math.min(de,rt.x),Le=Math.min(Le,rt.y),Re=Math.max(Re,rt.x),Be=Math.max(Be,rt.y)}for(var xt=function(Vt){var Ot=C._tiles[he[Vt]];if(!Ot.holdingForFade()){var vr=Ot.tileID,Br=Math.pow(2,L.zoom-Ot.tileID.overscaledZ),Dr=d*Ot.queryPadding*v.EXTENT/Ot.tileSize/Br,an=[vr.getTilePoint(new v.MercatorCoordinate(de,Le)),vr.getTilePoint(new v.MercatorCoordinate(Re,Be))];if(an[0].x-Dr<v.EXTENT&&an[0].y-Dr<v.EXTENT&&an[1].x+Dr>=0&&an[1].y+Dr>=0){var Bn=W.map(function(Nn){return vr.getTilePoint(Nn)}),kn=fe.map(function(Nn){return vr.getTilePoint(Nn)});T.push({tile:Ot,tileID:vr,queryGeometry:Bn,cameraQueryGeometry:kn,scale:Br})}}},Wt=0;Wt<he.length;Wt++)xt(Wt);return T},f.prototype.getVisibleCoordinates=function(c){for(var d=this,E=this.getRenderableIds(c).map(function(Z){return d._tiles[Z].tileID}),C=0,T=E;C<T.length;C+=1){var L=T[C];L.posMatrix=this.transform.calculatePosMatrix(L.toUnwrapped())}return E},f.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(dr(this._source.type))for(var c in this._tiles){var d=this._tiles[c];if(d.fadeEndTime!==void 0&&d.fadeEndTime>=v.browser.now())return!0}return!1},f.prototype.setFeatureState=function(c,d,E){this._state.updateState(c=c||"_geojsonTileLayer",d,E)},f.prototype.removeFeatureState=function(c,d,E){this._state.removeFeatureState(c=c||"_geojsonTileLayer",d,E)},f.prototype.getFeatureState=function(c,d){return this._state.getState(c=c||"_geojsonTileLayer",d)},f.prototype.setDependencies=function(c,d,E){var C=this._tiles[c];C&&C.setDependencies(d,E)},f.prototype.reloadTilesForDependencies=function(c,d){for(var E in this._tiles)this._tiles[E].hasDependency(c,d)&&this._reloadTile(E,"reloading");this._cache.filter(function(C){return!C.hasDependency(c,d)})},f}(v.Evented);function yt(l,f){var c=Math.abs(2*l.wrap)-+(l.wrap<0),d=Math.abs(2*f.wrap)-+(f.wrap<0);return l.overscaledZ-f.overscaledZ||d-c||f.canonical.y-l.canonical.y||f.canonical.x-l.canonical.x}function dr(l){return l==="raster"||l==="image"||l==="video"}function Dt(){return new v.window.Worker(tc.workerUrl)}Fe.maxOverzooming=10,Fe.maxUnderzooming=3;var zt="mapboxgl_preloaded_worker_pool",gr=function(){this.active={}};gr.prototype.acquire=function(l){if(!this.workers)for(this.workers=[];this.workers.length<gr.workerCount;)this.workers.push(new Dt);return this.active[l]=!0,this.workers.slice()},gr.prototype.release=function(l){delete this.active[l],this.numActive()===0&&(this.workers.forEach(function(f){f.terminate()}),this.workers=null)},gr.prototype.isPreloaded=function(){return!!this.active[zt]},gr.prototype.numActive=function(){return Object.keys(this.active).length};var En,un=Math.floor(v.browser.hardwareConcurrency/2);function Tt(){return En||(En=new gr),En}function nn(l,f){var c={};for(var d in l)d!=="ref"&&(c[d]=l[d]);return v.refProperties.forEach(function(E){E in f&&(c[E]=f[E])}),c}function Zr(l){l=l.slice();for(var f=Object.create(null),c=0;c<l.length;c++)f[l[c].id]=l[c];for(var d=0;d<l.length;d++)"ref"in l[d]&&(l[d]=nn(l[d],f[l[d].ref]));return l}gr.workerCount=Math.max(Math.min(un,6),1);var Yr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function oi(l,f,c){c.push({command:Yr.addSource,args:[l,f[l]]})}function Qr(l,f,c){f.push({command:Yr.removeSource,args:[l]}),c[l]=!0}function Ti(l,f,c,d){Qr(l,c,d),oi(l,f,c)}function ea(l,f,c){var d;for(d in l[c])if(l[c].hasOwnProperty(d)&&d!=="data"&&!v.deepEqual(l[c][d],f[c][d]))return!1;for(d in f[c])if(f[c].hasOwnProperty(d)&&d!=="data"&&!v.deepEqual(l[c][d],f[c][d]))return!1;return!0}function bi(l,f,c,d,E,C){var T;for(T in f=f||{},l=l||{})l.hasOwnProperty(T)&&(v.deepEqual(l[T],f[T])||c.push({command:C,args:[d,T,f[T],E]}));for(T in f)f.hasOwnProperty(T)&&!l.hasOwnProperty(T)&&(v.deepEqual(l[T],f[T])||c.push({command:C,args:[d,T,f[T],E]}))}function Oi(l){return l.id}function Ci(l,f){return l[f.id]=f,l}var ti=function(l,f){this.reset(l,f)};ti.prototype.reset=function(l,f){this.points=l||[],this._distances=[0];for(var c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(f||0,.5*this.length),this.paddedLength=this.length-2*this.padding},ti.prototype.lerp=function(l){if(this.points.length===1)return this.points[0];l=v.clamp(l,0,1);for(var f=1,c=this._distances[f],d=l*this.paddedLength+this.padding;c<d&&f<this._distances.length;)c=this._distances[++f];var E=f-1,C=this._distances[E],T=c-C,L=T>0?(d-C)/T:0;return this.points[E].mult(1-L).add(this.points[f].mult(L))};var Xi=function(l,f,c){var d=this.boxCells=[],E=this.circleCells=[];this.xCellCount=Math.ceil(l/c),this.yCellCount=Math.ceil(f/c);for(var C=0;C<this.xCellCount*this.yCellCount;C++)d.push([]),E.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=f,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/f,this.boxUid=0,this.circleUid=0};function Fa(l,f,c,d,E){var C=v.create();return f?(v.scale(C,C,[1/E,1/E,1]),c||v.rotateZ(C,C,d.angle)):v.multiply(C,d.labelPlaneMatrix,l),C}function oa(l,f,c,d,E){if(f){var C=v.clone(l);return v.scale(C,C,[E,E,1]),c||v.rotateZ(C,C,-d.angle),C}return d.glCoordMatrix}function Ri(l,f){var c=[l.x,l.y,0,1];ja(c,c,f);var d=c[3];return{point:new v.Point(c[0]/d,c[1]/d),signedDistanceFromCamera:d}}function Gi(l,f){return .5+l/f*.5}function Za(l,f){var c=l[0]/l[3],d=l[1]/l[3];return c>=-f[0]&&c<=f[0]&&d>=-f[1]&&d<=f[1]}function au(l,f,c,d,E,C,T,L){var Z=d?l.textSizeData:l.iconSizeData,W=v.evaluateSizeForZoom(Z,c.transform.zoom),fe=[256/c.width*2+1,256/c.height*2+1],he=d?l.text.dynamicLayoutVertexArray:l.icon.dynamicLayoutVertexArray;he.clear();for(var de=l.lineVertexArray,Le=d?l.text.placedSymbolArray:l.icon.placedSymbolArray,Re=c.transform.width/c.transform.height,Be=!1,Ae=0;Ae<Le.length;Ae++){var Ve=Le.get(Ae);if(Ve.hidden||Ve.writingMode===v.WritingMode.vertical&&!Be)yo(Ve.numGlyphs,he);else{Be=!1;var rt=[Ve.anchorX,Ve.anchorY,0,1];if(v.transformMat4(rt,rt,f),Za(rt,fe)){var xt=Gi(c.transform.cameraToCenterDistance,rt[3]),Wt=v.evaluateSizeForFeature(Z,W,Ve),Vt=T?Wt/xt:Wt*xt,Ot=new v.Point(Ve.anchorX,Ve.anchorY),vr=Ri(Ot,E).point,Br={},Dr=Es(Ve,Vt,!1,L,f,E,C,l.glyphOffsetArray,de,he,vr,Ot,Br,Re);Be=Dr.useVertical,(Dr.notEnoughRoom||Be||Dr.needsFlipping&&Es(Ve,Vt,!0,L,f,E,C,l.glyphOffsetArray,de,he,vr,Ot,Br,Re).notEnoughRoom)&&yo(Ve.numGlyphs,he)}else yo(Ve.numGlyphs,he)}}d?l.text.dynamicLayoutVertexBuffer.updateData(he):l.icon.dynamicLayoutVertexBuffer.updateData(he)}function Ma(l,f,c,d,E,C,T,L,Z,W,fe){var he=L.glyphStartIndex+L.numGlyphs,de=L.lineStartIndex,Le=L.lineStartIndex+L.lineLength,Re=f.getoffsetX(L.glyphStartIndex),Be=f.getoffsetX(he-1),Ae=ra(l*Re,c,d,E,C,T,L.segment,de,Le,Z,W,fe);if(!Ae)return null;var Ve=ra(l*Be,c,d,E,C,T,L.segment,de,Le,Z,W,fe);return Ve?{first:Ae,last:Ve}:null}function Pa(l,f,c,d){return l===v.WritingMode.horizontal&&Math.abs(c.y-f.y)>Math.abs(c.x-f.x)*d?{useVertical:!0}:(l===v.WritingMode.vertical?f.y<c.y:f.x>c.x)?{needsFlipping:!0}:null}function Es(l,f,c,d,E,C,T,L,Z,W,fe,he,de,Le){var Re,Be=f/24,Ae=l.lineOffsetX*Be,Ve=l.lineOffsetY*Be;if(l.numGlyphs>1){var rt=l.glyphStartIndex+l.numGlyphs,xt=l.lineStartIndex,Wt=l.lineStartIndex+l.lineLength,Vt=Ma(Be,L,Ae,Ve,c,fe,he,l,Z,C,de);if(!Vt)return{notEnoughRoom:!0};var Ot=Ri(Vt.first.point,T).point,vr=Ri(Vt.last.point,T).point;if(d&&!c){var Br=Pa(l.writingMode,Ot,vr,Le);if(Br)return Br}Re=[Vt.first];for(var Dr=l.glyphStartIndex+1;Dr<rt-1;Dr++)Re.push(ra(Be*L.getoffsetX(Dr),Ae,Ve,c,fe,he,l.segment,xt,Wt,Z,C,de));Re.push(Vt.last)}else{if(d&&!c){var an=Ri(he,E).point,Bn=l.lineStartIndex+l.segment+1,kn=new v.Point(Z.getx(Bn),Z.gety(Bn)),Nn=Ri(kn,E),Bi=Nn.signedDistanceFromCamera>0?Nn.point:ps(he,kn,an,1,E),on=Pa(l.writingMode,an,Bi,Le);if(on)return on}var si=ra(Be*L.getoffsetX(l.glyphStartIndex),Ae,Ve,c,fe,he,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,Z,C,de);if(!si)return{notEnoughRoom:!0};Re=[si]}for(var hi=0,ri=Re;hi<ri.length;hi+=1){var Hn=ri[hi];v.addDynamicAttributes(W,Hn.point,Hn.angle)}return{}}function ps(l,f,c,d,E){var C=Ri(l.add(l.sub(f)._unit()),E).point,T=c.sub(C);return c.add(T._mult(d/T.mag()))}function ra(l,f,c,d,E,C,T,L,Z,W,fe,he){var de=d?l-f:l+f,Le=de>0?1:-1,Re=0;d&&(Le*=-1,Re=Math.PI),Le<0&&(Re+=Math.PI);for(var Be=Le>0?L+T:L+T+1,Ae=E,Ve=E,rt=0,xt=0,Wt=Math.abs(de),Vt=[];rt+xt<=Wt;){if((Be+=Le)<L||Be>=Z)return null;if(Ve=Ae,Vt.push(Ae),(Ae=he[Be])===void 0){var Ot=new v.Point(W.getx(Be),W.gety(Be)),vr=Ri(Ot,fe);if(vr.signedDistanceFromCamera>0)Ae=he[Be]=vr.point;else{var Br=Be-Le;Ae=ps(rt===0?C:new v.Point(W.getx(Br),W.gety(Br)),Ot,Ve,Wt-rt+1,fe)}}rt+=xt,xt=Ve.dist(Ae)}var Dr=(Wt-rt)/xt,an=Ae.sub(Ve),Bn=an.mult(Dr)._add(Ve);Bn._add(an._unit()._perp()._mult(c*Le));var kn=Re+Math.atan2(Ae.y-Ve.y,Ae.x-Ve.x);return Vt.push(Bn),{point:Bn,angle:kn,path:Vt}}Xi.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Xi.prototype.insert=function(l,f,c,d,E){this._forEachCell(f,c,d,E,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(f),this.bboxes.push(c),this.bboxes.push(d),this.bboxes.push(E)},Xi.prototype.insertCircle=function(l,f,c,d){this._forEachCell(f-d,c-d,f+d,c+d,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(f),this.circles.push(c),this.circles.push(d)},Xi.prototype._insertBoxCell=function(l,f,c,d,E,C){this.boxCells[E].push(C)},Xi.prototype._insertCircleCell=function(l,f,c,d,E,C){this.circleCells[E].push(C)},Xi.prototype._query=function(l,f,c,d,E,C){if(c<0||l>this.width||d<0||f>this.height)return!E&&[];var T=[];if(l<=0&&f<=0&&this.width<=c&&this.height<=d){if(E)return!0;for(var L=0;L<this.boxKeys.length;L++)T.push({key:this.boxKeys[L],x1:this.bboxes[4*L],y1:this.bboxes[4*L+1],x2:this.bboxes[4*L+2],y2:this.bboxes[4*L+3]});for(var Z=0;Z<this.circleKeys.length;Z++){var W=this.circles[3*Z],fe=this.circles[3*Z+1],he=this.circles[3*Z+2];T.push({key:this.circleKeys[Z],x1:W-he,y1:fe-he,x2:W+he,y2:fe+he})}return C?T.filter(C):T}return this._forEachCell(l,f,c,d,this._queryCell,T,{hitTest:E,seenUids:{box:{},circle:{}}},C),E?T.length>0:T},Xi.prototype._queryCircle=function(l,f,c,d,E){var C=l-c,T=l+c,L=f-c,Z=f+c;if(T<0||C>this.width||Z<0||L>this.height)return!d&&[];var W=[];return this._forEachCell(C,L,T,Z,this._queryCellCircle,W,{hitTest:d,circle:{x:l,y:f,radius:c},seenUids:{box:{},circle:{}}},E),d?W.length>0:W},Xi.prototype.query=function(l,f,c,d,E){return this._query(l,f,c,d,!1,E)},Xi.prototype.hitTest=function(l,f,c,d,E){return this._query(l,f,c,d,!0,E)},Xi.prototype.hitTestCircle=function(l,f,c,d){return this._queryCircle(l,f,c,!0,d)},Xi.prototype._queryCell=function(l,f,c,d,E,C,T,L){var Z=T.seenUids,W=this.boxCells[E];if(W!==null)for(var fe=this.bboxes,he=0,de=W;he<de.length;he+=1){var Le=de[he];if(!Z.box[Le]){Z.box[Le]=!0;var Re=4*Le;if(l<=fe[Re+2]&&f<=fe[Re+3]&&c>=fe[Re+0]&&d>=fe[Re+1]&&(!L||L(this.boxKeys[Le]))){if(T.hitTest)return C.push(!0),!0;C.push({key:this.boxKeys[Le],x1:fe[Re],y1:fe[Re+1],x2:fe[Re+2],y2:fe[Re+3]})}}}var Be=this.circleCells[E];if(Be!==null)for(var Ae=this.circles,Ve=0,rt=Be;Ve<rt.length;Ve+=1){var xt=rt[Ve];if(!Z.circle[xt]){Z.circle[xt]=!0;var Wt=3*xt;if(this._circleAndRectCollide(Ae[Wt],Ae[Wt+1],Ae[Wt+2],l,f,c,d)&&(!L||L(this.circleKeys[xt]))){if(T.hitTest)return C.push(!0),!0;var Vt=Ae[Wt],Ot=Ae[Wt+1],vr=Ae[Wt+2];C.push({key:this.circleKeys[xt],x1:Vt-vr,y1:Ot-vr,x2:Vt+vr,y2:Ot+vr})}}}},Xi.prototype._queryCellCircle=function(l,f,c,d,E,C,T,L){var Z=T.circle,W=T.seenUids,fe=this.boxCells[E];if(fe!==null)for(var he=this.bboxes,de=0,Le=fe;de<Le.length;de+=1){var Re=Le[de];if(!W.box[Re]){W.box[Re]=!0;var Be=4*Re;if(this._circleAndRectCollide(Z.x,Z.y,Z.radius,he[Be+0],he[Be+1],he[Be+2],he[Be+3])&&(!L||L(this.boxKeys[Re])))return C.push(!0),!0}}var Ae=this.circleCells[E];if(Ae!==null)for(var Ve=this.circles,rt=0,xt=Ae;rt<xt.length;rt+=1){var Wt=xt[rt];if(!W.circle[Wt]){W.circle[Wt]=!0;var Vt=3*Wt;if(this._circlesCollide(Ve[Vt],Ve[Vt+1],Ve[Vt+2],Z.x,Z.y,Z.radius)&&(!L||L(this.circleKeys[Wt])))return C.push(!0),!0}}},Xi.prototype._forEachCell=function(l,f,c,d,E,C,T,L){for(var Z=this._convertToXCellCoord(l),W=this._convertToYCellCoord(f),fe=this._convertToXCellCoord(c),he=this._convertToYCellCoord(d),de=Z;de<=fe;de++)for(var Le=W;Le<=he;Le++)if(E.call(this,l,f,c,d,this.xCellCount*Le+de,C,T,L))return},Xi.prototype._convertToXCellCoord=function(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))},Xi.prototype._convertToYCellCoord=function(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))},Xi.prototype._circlesCollide=function(l,f,c,d,E,C){var T=d-l,L=E-f,Z=c+C;return Z*Z>T*T+L*L},Xi.prototype._circleAndRectCollide=function(l,f,c,d,E,C,T){var L=(C-d)/2,Z=Math.abs(l-(d+L));if(Z>L+c)return!1;var W=(T-E)/2,fe=Math.abs(f-(E+W));if(fe>W+c)return!1;if(Z<=L||fe<=W)return!0;var he=Z-L,de=fe-W;return he*he+de*de<=c*c};var ju=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function yo(l,f){for(var c=0;c<l;c++){var d=f.length;f.resize(d+4),f.float32.set(ju,3*d)}}function ja(l,f,c){var d=f[0],E=f[1];return l[0]=c[0]*d+c[4]*E+c[12],l[1]=c[1]*d+c[5]*E+c[13],l[3]=c[3]*d+c[7]*E+c[15],l}var oo=function(l,f,c){f===void 0&&(f=new Xi(l.width+200,l.height+200,25)),c===void 0&&(c=new Xi(l.width+200,l.height+200,25)),this.transform=l,this.grid=f,this.ignoredGrid=c,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+100,this.screenBottomBoundary=l.height+100,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200};function $i(l,f,c){return f*(v.EXTENT/(l.tileSize*Math.pow(2,c-l.tileID.overscaledZ)))}oo.prototype.placeCollisionBox=function(l,f,c,d,E){var C=this.projectAndGetPerspectiveRatio(d,l.anchorPointX,l.anchorPointY),T=c*C.perspectiveRatio,L=l.x1*T+C.point.x,Z=l.y1*T+C.point.y,W=l.x2*T+C.point.x,fe=l.y2*T+C.point.y;return!this.isInsideGrid(L,Z,W,fe)||!f&&this.grid.hitTest(L,Z,W,fe,E)?{box:[],offscreen:!1}:{box:[L,Z,W,fe],offscreen:this.isOffscreen(L,Z,W,fe)}},oo.prototype.placeCollisionCircles=function(l,f,c,d,E,C,T,L,Z,W,fe,he,de){var Le=[],Re=new v.Point(f.anchorX,f.anchorY),Be=Ri(Re,C),Ae=Gi(this.transform.cameraToCenterDistance,Be.signedDistanceFromCamera),Ve=(W?E/Ae:E*Ae)/v.ONE_EM,rt=Ri(Re,T).point,xt=Ma(Ve,d,f.lineOffsetX*Ve,f.lineOffsetY*Ve,!1,rt,Re,f,c,T,{}),Wt=!1,Vt=!1,Ot=!0;if(xt){for(var vr=.5*he*Ae+de,Br=new v.Point(-100,-100),Dr=new v.Point(this.screenRightBoundary,this.screenBottomBoundary),an=new ti,Bn=xt.first,kn=xt.last,Nn=[],Bi=Bn.path.length-1;Bi>=1;Bi--)Nn.push(Bn.path[Bi]);for(var on=1;on<kn.path.length;on++)Nn.push(kn.path[on]);var si=2.5*vr;if(L){var hi=Nn.map(function(Gs){return Ri(Gs,L)});Nn=hi.some(function(Gs){return Gs.signedDistanceFromCamera<=0})?[]:hi.map(function(Gs){return Gs.point})}var ri=[];if(Nn.length>0){for(var Hn=Nn[0].clone(),mi=Nn[0].clone(),Rn=1;Rn<Nn.length;Rn++)Hn.x=Math.min(Hn.x,Nn[Rn].x),Hn.y=Math.min(Hn.y,Nn[Rn].y),mi.x=Math.max(mi.x,Nn[Rn].x),mi.y=Math.max(mi.y,Nn[Rn].y);ri=Hn.x>=Br.x&&mi.x<=Dr.x&&Hn.y>=Br.y&&mi.y<=Dr.y?[Nn]:mi.x<Br.x||Hn.x>Dr.x||mi.y<Br.y||Hn.y>Dr.y?[]:v.clipLine([Nn],Br.x,Br.y,Dr.x,Dr.y)}for(var Wn=0,Ha=ri;Wn<Ha.length;Wn+=1){var eo;an.reset(Ha[Wn],.25*vr),eo=an.length<=.5*vr?1:Math.ceil(an.paddedLength/si)+1;for(var bo=0;bo<eo;bo++){var To=bo/Math.max(eo-1,1),to=an.lerp(To),vo=to.x+100,Is=to.y+100;Le.push(vo,Is,vr,0);var gs=vo-vr,Va=Is-vr,ca=vo+vr,Os=Is+vr;if(Ot=Ot&&this.isOffscreen(gs,Va,ca,Os),Vt=Vt||this.isInsideGrid(gs,Va,ca,Os),!l&&this.grid.hitTestCircle(vo,Is,vr,fe)&&(Wt=!0,!Z))return{circles:[],offscreen:!1,collisionDetected:Wt}}}}return{circles:!Z&&Wt||!Vt?[]:Le,offscreen:Ot,collisionDetected:Wt}},oo.prototype.queryRenderedSymbols=function(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var f=[],c=1/0,d=1/0,E=-1/0,C=-1/0,T=0,L=l;T<L.length;T+=1){var Z=L[T],W=new v.Point(Z.x+100,Z.y+100);c=Math.min(c,W.x),d=Math.min(d,W.y),E=Math.max(E,W.x),C=Math.max(C,W.y),f.push(W)}for(var fe={},he={},de=0,Le=this.grid.query(c,d,E,C).concat(this.ignoredGrid.query(c,d,E,C));de<Le.length;de+=1){var Re=Le[de],Be=Re.key;if(fe[Be.bucketInstanceId]===void 0&&(fe[Be.bucketInstanceId]={}),!fe[Be.bucketInstanceId][Be.featureIndex]){var Ae=[new v.Point(Re.x1,Re.y1),new v.Point(Re.x2,Re.y1),new v.Point(Re.x2,Re.y2),new v.Point(Re.x1,Re.y2)];v.polygonIntersectsPolygon(f,Ae)&&(fe[Be.bucketInstanceId][Be.featureIndex]=!0,he[Be.bucketInstanceId]===void 0&&(he[Be.bucketInstanceId]=[]),he[Be.bucketInstanceId].push(Be.featureIndex))}}return he},oo.prototype.insertCollisionBox=function(l,f,c,d,E){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:d,collisionGroupID:E},l[0],l[1],l[2],l[3])},oo.prototype.insertCollisionCircles=function(l,f,c,d,E){for(var C=f?this.ignoredGrid:this.grid,T={bucketInstanceId:c,featureIndex:d,collisionGroupID:E},L=0;L<l.length;L+=4)C.insertCircle(T,l[L],l[L+1],l[L+2])},oo.prototype.projectAndGetPerspectiveRatio=function(l,f,c){var d=[f,c,0,1];return ja(d,d,l),{point:new v.Point((d[0]/d[3]+1)/2*this.transform.width+100,(-d[1]/d[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/d[3]*.5}},oo.prototype.isOffscreen=function(l,f,c,d){return c<100||l>=this.screenRightBoundary||d<100||f>this.screenBottomBoundary},oo.prototype.isInsideGrid=function(l,f,c,d){return c>=0&&l<this.gridRightBoundary&&d>=0&&f<this.gridBottomBoundary},oo.prototype.getViewportMatrix=function(){var l=v.identity([]);return v.translate(l,l,[-100,-100,0]),l};var qo=function(l,f,c,d){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?f:-f))):d&&c?1:0,this.placed=c};qo.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var Ko=function(l,f,c,d,E){this.text=new qo(l?l.text:null,f,c,E),this.icon=new qo(l?l.icon:null,f,d,E)};Ko.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var Vu=function(l,f,c){this.text=l,this.icon=f,this.skipFade=c},Co=function(){this.invProjMatrix=v.create(),this.viewportMatrix=v.create(),this.circles=[]},$o=function(l,f,c,d,E){this.bucketInstanceId=l,this.featureIndex=f,this.sourceLayerIndex=c,this.bucketIndex=d,this.tileID=E},xa=function(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}};function _o(l,f,c,d,E){var C=v.getAnchorAlignment(l),T=-(C.horizontalAlign-.5)*f,L=-(C.verticalAlign-.5)*c,Z=v.evaluateVariableOffset(l,d);return new v.Point(T+Z[0]*E,L+Z[1]*E)}function Jo(l,f,c,d,E,C){var T=l.x1,L=l.x2,Z=l.y1,W=l.y2,fe=l.anchorPointX,he=l.anchorPointY,de=new v.Point(f,c);return d&&de._rotate(E?C:-C),{x1:T+de.x,y1:Z+de.y,x2:L+de.x,y2:W+de.y,anchorPointX:fe,anchorPointY:he}}xa.prototype.get=function(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){var f=++this.maxGroupID;this.collisionGroups[l]={ID:f,predicate:function(c){return c.collisionGroupID===f}}}return this.collisionGroups[l]};var so=function(l,f,c,d){this.transform=l.clone(),this.collisionIndex=new oo(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=f,this.retainedQueryData={},this.collisionGroups=new xa(c),this.collisionCircleArrays={},this.prevPlacement=d,d&&(d.prevPlacement=void 0),this.placedOrientations={}};function ou(l,f,c,d,E){l.emplaceBack(f?1:0,c?1:0,d||0,E||0),l.emplaceBack(f?1:0,c?1:0,d||0,E||0),l.emplaceBack(f?1:0,c?1:0,d||0,E||0),l.emplaceBack(f?1:0,c?1:0,d||0,E||0)}so.prototype.getBucketParts=function(l,f,c,d){var E=c.getBucket(f),C=c.latestFeatureIndex;if(E&&C&&f.id===E.layerIds[0]){var T=c.collisionBoxArray,L=E.layers[0].layout,Z=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),W=c.tileSize/v.EXTENT,fe=this.transform.calculatePosMatrix(c.tileID.toUnwrapped()),he=L.get("text-pitch-alignment")==="map",de=L.get("text-rotation-alignment")==="map",Le=$i(c,1,this.transform.zoom),Re=Fa(fe,he,de,this.transform,Le),Be=null;if(he){var Ae=oa(fe,he,de,this.transform,Le);Be=v.multiply([],this.transform.labelPlaneMatrix,Ae)}this.retainedQueryData[E.bucketInstanceId]=new $o(E.bucketInstanceId,C,E.sourceLayerIndex,E.index,c.tileID);var Ve={bucket:E,layout:L,posMatrix:fe,textLabelPlaneMatrix:Re,labelToScreenMatrix:Be,scale:Z,textPixelRatio:W,holdingForFade:c.holdingForFade(),collisionBoxArray:T,partiallyEvaluatedTextSize:v.evaluateSizeForZoom(E.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(E.sourceID)};if(d)for(var rt=0,xt=E.sortKeyRanges;rt<xt.length;rt+=1){var Wt=xt[rt];l.push({sortKey:Wt.sortKey,symbolInstanceStart:Wt.symbolInstanceStart,symbolInstanceEnd:Wt.symbolInstanceEnd,parameters:Ve})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:E.symbolInstances.length,parameters:Ve})}},so.prototype.attemptAnchorPlacement=function(l,f,c,d,E,C,T,L,Z,W,fe,he,de,Le,Re){var Be,Ae=[he.textOffset0,he.textOffset1],Ve=_o(l,c,d,Ae,E),rt=this.collisionIndex.placeCollisionBox(Jo(f,Ve.x,Ve.y,C,T,this.transform.angle),fe,L,Z,W.predicate);if(!Re||this.collisionIndex.placeCollisionBox(Jo(Re,Ve.x,Ve.y,C,T,this.transform.angle),fe,L,Z,W.predicate).box.length!==0)return rt.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[he.crossTileID]&&this.prevPlacement.placements[he.crossTileID]&&this.prevPlacement.placements[he.crossTileID].text&&(Be=this.prevPlacement.variableOffsets[he.crossTileID].anchor),this.variableOffsets[he.crossTileID]={textOffset:Ae,width:c,height:d,anchor:l,textBoxScale:E,prevAnchor:Be},this.markUsedJustification(de,l,he,Le),de.allowVerticalPlacement&&(this.markUsedOrientation(de,Le,he),this.placedOrientations[he.crossTileID]=Le),{shift:Ve,placedGlyphBoxes:rt}):void 0},so.prototype.placeLayerBucketPart=function(l,f,c){var d=this,E=l.parameters,C=E.bucket,T=E.layout,L=E.posMatrix,Z=E.textLabelPlaneMatrix,W=E.labelToScreenMatrix,fe=E.textPixelRatio,he=E.holdingForFade,de=E.collisionBoxArray,Le=E.partiallyEvaluatedTextSize,Re=E.collisionGroup,Be=T.get("text-optional"),Ae=T.get("icon-optional"),Ve=T.get("text-allow-overlap"),rt=T.get("icon-allow-overlap"),xt=T.get("text-rotation-alignment")==="map",Wt=T.get("text-pitch-alignment")==="map",Vt=T.get("icon-text-fit")!=="none",Ot=T.get("symbol-z-order")==="viewport-y",vr=Ve&&(rt||!C.hasIconData()||Ae),Br=rt&&(Ve||!C.hasTextData()||Be);!C.collisionArrays&&de&&C.deserializeCollisionBoxes(de);var Dr=function(on,si){if(!f[on.crossTileID])if(he)d.placements[on.crossTileID]=new Vu(!1,!1,!1);else{var hi,ri=!1,Hn=!1,mi=!0,Rn=null,Wn={box:null,offscreen:null},Ha={box:null,offscreen:null},eo=null,bo=null,To=0,to=0,vo=0;si.textFeatureIndex?To=si.textFeatureIndex:on.useRuntimeCollisionCircles&&(To=on.featureIndex),si.verticalTextFeatureIndex&&(to=si.verticalTextFeatureIndex);var Is=si.textBox;if(Is){var gs=function(Qi){var Rs=v.WritingMode.horizontal;if(C.allowVerticalPlacement&&!Qi&&d.prevPlacement){var as=d.prevPlacement.placedOrientations[on.crossTileID];as&&(d.placedOrientations[on.crossTileID]=as,d.markUsedOrientation(C,Rs=as,on))}return Rs},Va=function(Qi,Rs){if(C.allowVerticalPlacement&&on.numVerticalGlyphVertices>0&&si.verticalTextBox)for(var as=0,fu=C.writingModes;as<fu.length&&(fu[as]===v.WritingMode.vertical?(Wn=Rs(),Ha=Wn):Wn=Qi(),!(Wn&&Wn.box&&Wn.box.length));as+=1);else Wn=Qi()};if(T.get("text-variable-anchor")){var ca=T.get("text-variable-anchor");if(d.prevPlacement&&d.prevPlacement.variableOffsets[on.crossTileID]){var Os=d.prevPlacement.variableOffsets[on.crossTileID];ca.indexOf(Os.anchor)>0&&(ca=ca.filter(function(Qi){return Qi!==Os.anchor})).unshift(Os.anchor)}var Gs=function(Qi,Rs,as){for(var fu=Qi.x2-Qi.x1,xl=Qi.y2-Qi.y1,ic=on.textBoxScale,Lc=Vt&&!rt?Rs:null,Ls={box:[],offscreen:!1},Fl=Ve?2*ca.length:ca.length,hu=0;hu<Fl;++hu){var nl=d.attemptAnchorPlacement(ca[hu%ca.length],Qi,fu,xl,ic,xt,Wt,fe,L,Re,hu>=ca.length,on,C,as,Lc);if(nl&&(Ls=nl.placedGlyphBoxes)&&Ls.box&&Ls.box.length){ri=!0,Rn=nl.shift;break}}return Ls};Va(function(){return Gs(Is,si.iconBox,v.WritingMode.horizontal)},function(){var Qi=si.verticalTextBox;return C.allowVerticalPlacement&&!(Wn&&Wn.box&&Wn.box.length)&&on.numVerticalGlyphVertices>0&&Qi?Gs(Qi,si.verticalIconBox,v.WritingMode.vertical):{box:null,offscreen:null}}),Wn&&(ri=Wn.box,mi=Wn.offscreen);var Eu=gs(Wn&&Wn.box);if(!ri&&d.prevPlacement){var rc=d.prevPlacement.variableOffsets[on.crossTileID];rc&&(d.variableOffsets[on.crossTileID]=rc,d.markUsedJustification(C,rc.anchor,on,Eu))}}else{var tl=function(Qi,Rs){var as=d.collisionIndex.placeCollisionBox(Qi,Ve,fe,L,Re.predicate);return as&&as.box&&as.box.length&&(d.markUsedOrientation(C,Rs,on),d.placedOrientations[on.crossTileID]=Rs),as};Va(function(){return tl(Is,v.WritingMode.horizontal)},function(){var Qi=si.verticalTextBox;return C.allowVerticalPlacement&&on.numVerticalGlyphVertices>0&&Qi?tl(Qi,v.WritingMode.vertical):{box:null,offscreen:null}}),gs(Wn&&Wn.box&&Wn.box.length)}}if(ri=(hi=Wn)&&hi.box&&hi.box.length>0,mi=hi&&hi.offscreen,on.useRuntimeCollisionCircles){var nc=C.text.placedSymbolArray.get(on.centerJustifiedTextSymbolIndex),Rc=v.evaluateSizeForFeature(C.textSizeData,Le,nc),tu=T.get("text-padding");eo=d.collisionIndex.placeCollisionCircles(Ve,nc,C.lineVertexArray,C.glyphOffsetArray,Rc,L,Z,W,c,Wt,Re.predicate,on.collisionCircleDiameter,tu),ri=Ve||eo.circles.length>0&&!eo.collisionDetected,mi=mi&&eo.offscreen}if(si.iconFeatureIndex&&(vo=si.iconFeatureIndex),si.iconBox){var ys=function(Qi){var Rs=Vt&&Rn?Jo(Qi,Rn.x,Rn.y,xt,Wt,d.transform.angle):Qi;return d.collisionIndex.placeCollisionBox(Rs,rt,fe,L,Re.predicate)};Hn=Ha&&Ha.box&&Ha.box.length&&si.verticalIconBox?(bo=ys(si.verticalIconBox)).box.length>0:(bo=ys(si.iconBox)).box.length>0,mi=mi&&bo.offscreen}var ku=Be||on.numHorizontalGlyphVertices===0&&on.numVerticalGlyphVertices===0,Fo=Ae||on.numIconVertices===0;if(ku||Fo?Fo?ku||(Hn=Hn&&ri):ri=Hn&&ri:Hn=ri=Hn&&ri,ri&&hi&&hi.box&&d.collisionIndex.insertCollisionBox(hi.box,T.get("text-ignore-placement"),C.bucketInstanceId,Ha&&Ha.box&&to?to:To,Re.ID),Hn&&bo&&d.collisionIndex.insertCollisionBox(bo.box,T.get("icon-ignore-placement"),C.bucketInstanceId,vo,Re.ID),eo&&(ri&&d.collisionIndex.insertCollisionCircles(eo.circles,T.get("text-ignore-placement"),C.bucketInstanceId,To,Re.ID),c)){var rl=C.bucketInstanceId,Hs=d.collisionCircleArrays[rl];Hs===void 0&&(Hs=d.collisionCircleArrays[rl]=new Co);for(var Su=0;Su<eo.circles.length;Su+=4)Hs.circles.push(eo.circles[Su+0]),Hs.circles.push(eo.circles[Su+1]),Hs.circles.push(eo.circles[Su+2]),Hs.circles.push(eo.collisionDetected?1:0)}d.placements[on.crossTileID]=new Vu(ri||vr,Hn||Br,mi||C.justReloaded),f[on.crossTileID]=!0}};if(Ot)for(var an=C.getSortedSymbolIndexes(this.transform.angle),Bn=an.length-1;Bn>=0;--Bn){var kn=an[Bn];Dr(C.symbolInstances.get(kn),C.collisionArrays[kn])}else for(var Nn=l.symbolInstanceStart;Nn<l.symbolInstanceEnd;Nn++)Dr(C.symbolInstances.get(Nn),C.collisionArrays[Nn]);if(c&&C.bucketInstanceId in this.collisionCircleArrays){var Bi=this.collisionCircleArrays[C.bucketInstanceId];v.invert(Bi.invProjMatrix,L),Bi.viewportMatrix=this.collisionIndex.getViewportMatrix()}C.justReloaded=!1},so.prototype.markUsedJustification=function(l,f,c,d){var E;E=d===v.WritingMode.vertical?c.verticalPlacedTextSymbolIndex:{left:c.leftJustifiedTextSymbolIndex,center:c.centerJustifiedTextSymbolIndex,right:c.rightJustifiedTextSymbolIndex}[v.getAnchorJustification(f)];for(var C=0,T=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex,c.verticalPlacedTextSymbolIndex];C<T.length;C+=1){var L=T[C];L>=0&&(l.text.placedSymbolArray.get(L).crossTileID=E>=0&&L!==E?0:c.crossTileID)}},so.prototype.markUsedOrientation=function(l,f,c){for(var d=f===v.WritingMode.horizontal||f===v.WritingMode.horizontalOnly?f:0,E=f===v.WritingMode.vertical?f:0,C=0,T=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex];C<T.length;C+=1)l.text.placedSymbolArray.get(T[C]).placedOrientation=d;c.verticalPlacedTextSymbolIndex&&(l.text.placedSymbolArray.get(c.verticalPlacedTextSymbolIndex).placedOrientation=E)},so.prototype.commit=function(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;var f=this.prevPlacement,c=!1;this.prevZoomAdjustment=f?f.zoomAdjustment(this.transform.zoom):0;var d=f?f.symbolFadeChange(l):1,E=f?f.opacities:{},C=f?f.variableOffsets:{},T=f?f.placedOrientations:{};for(var L in this.placements){var Z=this.placements[L],W=E[L];W?(this.opacities[L]=new Ko(W,d,Z.text,Z.icon),c=c||Z.text!==W.text.placed||Z.icon!==W.icon.placed):(this.opacities[L]=new Ko(null,d,Z.text,Z.icon,Z.skipFade),c=c||Z.text||Z.icon)}for(var fe in E){var he=E[fe];if(!this.opacities[fe]){var de=new Ko(he,d,!1,!1);de.isHidden()||(this.opacities[fe]=de,c=c||he.text.placed||he.icon.placed)}}for(var Le in C)this.variableOffsets[Le]||!this.opacities[Le]||this.opacities[Le].isHidden()||(this.variableOffsets[Le]=C[Le]);for(var Re in T)this.placedOrientations[Re]||!this.opacities[Re]||this.opacities[Re].isHidden()||(this.placedOrientations[Re]=T[Re]);c?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=f?f.lastPlacementChangeTime:l)},so.prototype.updateLayerOpacities=function(l,f){for(var c={},d=0,E=f;d<E.length;d+=1){var C=E[d],T=C.getBucket(l);T&&C.latestFeatureIndex&&l.id===T.layerIds[0]&&this.updateBucketOpacities(T,c,C.collisionBoxArray)}},so.prototype.updateBucketOpacities=function(l,f,c){var d=this;l.hasTextData()&&l.text.opacityVertexArray.clear(),l.hasIconData()&&l.icon.opacityVertexArray.clear(),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();var E=l.layers[0].layout,C=new Ko(null,0,!1,!1,!0),T=E.get("text-allow-overlap"),L=E.get("icon-allow-overlap"),Z=E.get("text-variable-anchor"),W=E.get("text-rotation-alignment")==="map",fe=E.get("text-pitch-alignment")==="map",he=E.get("icon-text-fit")!=="none",de=new Ko(null,0,T&&(L||!l.hasIconData()||E.get("icon-optional")),L&&(T||!l.hasTextData()||E.get("text-optional")),!0);!l.collisionArrays&&c&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(c);for(var Le=function(Ve,rt,xt){for(var Wt=0;Wt<rt/4;Wt++)Ve.opacityVertexArray.emplaceBack(xt)},Re=function(Ve){var rt=l.symbolInstances.get(Ve),xt=rt.numHorizontalGlyphVertices,Wt=rt.numVerticalGlyphVertices,Vt=rt.crossTileID,Ot=d.opacities[Vt];f[Vt]?Ot=C:Ot||(d.opacities[Vt]=Ot=de),f[Vt]=!0;var vr=rt.numIconVertices>0,Br=d.placedOrientations[rt.crossTileID],Dr=Br===v.WritingMode.vertical,an=Br===v.WritingMode.horizontal||Br===v.WritingMode.horizontalOnly;if(xt>0||Wt>0){var Bn=lt(Ot.text);Le(l.text,xt,Dr?It:Bn),Le(l.text,Wt,an?It:Bn);var kn=Ot.text.isHidden();[rt.rightJustifiedTextSymbolIndex,rt.centerJustifiedTextSymbolIndex,rt.leftJustifiedTextSymbolIndex].forEach(function(Wn){Wn>=0&&(l.text.placedSymbolArray.get(Wn).hidden=kn||Dr?1:0)}),rt.verticalPlacedTextSymbolIndex>=0&&(l.text.placedSymbolArray.get(rt.verticalPlacedTextSymbolIndex).hidden=kn||an?1:0);var Nn=d.variableOffsets[rt.crossTileID];Nn&&d.markUsedJustification(l,Nn.anchor,rt,Br);var Bi=d.placedOrientations[rt.crossTileID];Bi&&(d.markUsedJustification(l,"left",rt,Bi),d.markUsedOrientation(l,Bi,rt))}if(vr){var on=lt(Ot.icon),si=!(he&&rt.verticalPlacedIconSymbolIndex&&Dr);rt.placedIconSymbolIndex>=0&&(Le(l.icon,rt.numIconVertices,si?on:It),l.icon.placedSymbolArray.get(rt.placedIconSymbolIndex).hidden=Ot.icon.isHidden()),rt.verticalPlacedIconSymbolIndex>=0&&(Le(l.icon,rt.numVerticalIconVertices,si?It:on),l.icon.placedSymbolArray.get(rt.verticalPlacedIconSymbolIndex).hidden=Ot.icon.isHidden())}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){var hi=l.collisionArrays[Ve];if(hi){var ri=new v.Point(0,0);if(hi.textBox||hi.verticalTextBox){var Hn=!0;if(Z){var mi=d.variableOffsets[Vt];mi?(ri=_o(mi.anchor,mi.width,mi.height,mi.textOffset,mi.textBoxScale),W&&ri._rotate(fe?d.transform.angle:-d.transform.angle)):Hn=!1}hi.textBox&&ou(l.textCollisionBox.collisionVertexArray,Ot.text.placed,!Hn||Dr,ri.x,ri.y),hi.verticalTextBox&&ou(l.textCollisionBox.collisionVertexArray,Ot.text.placed,!Hn||an,ri.x,ri.y)}var Rn=Boolean(!an&&hi.verticalIconBox);hi.iconBox&&ou(l.iconCollisionBox.collisionVertexArray,Ot.icon.placed,Rn,he?ri.x:0,he?ri.y:0),hi.verticalIconBox&&ou(l.iconCollisionBox.collisionVertexArray,Ot.icon.placed,!Rn,he?ri.x:0,he?ri.y:0)}}},Be=0;Be<l.symbolInstances.length;Be++)Re(Be);if(l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.bucketInstanceId in this.collisionCircleArrays){var Ae=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=Ae.invProjMatrix,l.placementViewportMatrix=Ae.viewportMatrix,l.collisionCircleArray=Ae.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}},so.prototype.symbolFadeChange=function(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},so.prototype.zoomAdjustment=function(l){return Math.max(0,(this.transform.zoom-l)/1.5)},so.prototype.hasTransitions=function(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration},so.prototype.stillRecent=function(l,f){var c=this.zoomAtLastRecencyCheck===f?1-this.zoomAdjustment(f):1;return this.zoomAtLastRecencyCheck=f,this.commitTime+this.fadeDuration*c>l},so.prototype.setStale=function(){this.stale=!0};var xc=Math.pow(2,25),Ds=Math.pow(2,24),ne=Math.pow(2,17),be=Math.pow(2,16),Qe=Math.pow(2,9),Rt=Math.pow(2,8),kr=Math.pow(2,1);function lt(l){if(l.opacity===0&&!l.placed)return 0;if(l.opacity===1&&l.placed)return 4294967295;var f=l.placed?1:0,c=Math.floor(127*l.opacity);return c*xc+f*Ds+c*ne+f*be+c*Qe+f*Rt+c*kr+f}var It=0,uo=function(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&l.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};uo.prototype.continuePlacement=function(l,f,c,d,E){for(var C=this._bucketParts;this._currentTileIndex<l.length;)if(f.getBucketParts(C,d,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,E())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,C.sort(function(T,L){return T.sortKey-L.sortKey}));this._currentPartIndex<C.length;)if(f.placeLayerBucketPart(C[this._currentPartIndex],this._seenCrossTileIDs,c),this._currentPartIndex++,E())return!0;return!1};var Ji=function(l,f,c,d,E,C,T){this.placement=new so(l,E,C,T),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=d,this._done=!1};Ji.prototype.isDone=function(){return this._done},Ji.prototype.continuePlacement=function(l,f,c){for(var d=this,E=v.browser.now(),C=function(){var Z=v.browser.now()-E;return!d._forceFullPlacement&&Z>2};this._currentPlacementIndex>=0;){var T=f[l[this._currentPlacementIndex]],L=this.placement.collisionIndex.transform.zoom;if(T.type==="symbol"&&(!T.minzoom||T.minzoom<=L)&&(!T.maxzoom||T.maxzoom>L)){if(this._inProgressLayer||(this._inProgressLayer=new uo(T)),this._inProgressLayer.continuePlacement(c[T.source],this.placement,this._showCollisionBoxes,T,C))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Ji.prototype.commit=function(l){return this.placement.commit(l),this.placement};var Ya=512/v.EXTENT/2,Qo=function(l,f,c){this.tileID=l,this.indexedSymbolInstances={},this.bucketInstanceId=c;for(var d=0;d<f.length;d++){var E=f.get(d),C=E.key;this.indexedSymbolInstances[C]||(this.indexedSymbolInstances[C]=[]),this.indexedSymbolInstances[C].push({crossTileID:E.crossTileID,coord:this.getScaledCoordinates(E,l)})}};Qo.prototype.getScaledCoordinates=function(l,f){var c=Ya/Math.pow(2,f.canonical.z-this.tileID.canonical.z);return{x:Math.floor((f.canonical.x*v.EXTENT+l.anchorX)*c),y:Math.floor((f.canonical.y*v.EXTENT+l.anchorY)*c)}},Qo.prototype.findMatches=function(l,f,c){for(var d=this.tileID.canonical.z<f.canonical.z?1:Math.pow(2,this.tileID.canonical.z-f.canonical.z),E=0;E<l.length;E++){var C=l.get(E);if(!C.crossTileID){var T=this.indexedSymbolInstances[C.key];if(T)for(var L=this.getScaledCoordinates(C,f),Z=0,W=T;Z<W.length;Z+=1){var fe=W[Z];if(Math.abs(fe.coord.x-L.x)<=d&&Math.abs(fe.coord.y-L.y)<=d&&!c[fe.crossTileID]){c[fe.crossTileID]=!0,C.crossTileID=fe.crossTileID;break}}}}};var pn=function(){this.maxCrossTileID=0};pn.prototype.generate=function(){return++this.maxCrossTileID};var cn=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};cn.prototype.handleWrapJump=function(l){var f=Math.round((l-this.lng)/360);if(f!==0)for(var c in this.indexes){var d=this.indexes[c],E={};for(var C in d){var T=d[C];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+f),E[T.tileID.key]=T}this.indexes[c]=E}this.lng=l},cn.prototype.addBucket=function(l,f,c){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===f.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(var d=0;d<f.symbolInstances.length;d++)f.symbolInstances.get(d).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]={});var E=this.usedCrossTileIDs[l.overscaledZ];for(var C in this.indexes){var T=this.indexes[C];if(Number(C)>l.overscaledZ)for(var L in T){var Z=T[L];Z.tileID.isChildOf(l)&&Z.findMatches(f.symbolInstances,l,E)}else{var W=T[l.scaledTo(Number(C)).key];W&&W.findMatches(f.symbolInstances,l,E)}}for(var fe=0;fe<f.symbolInstances.length;fe++){var he=f.symbolInstances.get(fe);he.crossTileID||(he.crossTileID=c.generate(),E[he.crossTileID]=!0)}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new Qo(l,f.symbolInstances,f.bucketInstanceId),!0},cn.prototype.removeBucketCrossTileIDs=function(l,f){for(var c in f.indexedSymbolInstances)for(var d=0,E=f.indexedSymbolInstances[c];d<E.length;d+=1)delete this.usedCrossTileIDs[l][E[d].crossTileID]},cn.prototype.removeStaleBuckets=function(l){var f=!1;for(var c in this.indexes){var d=this.indexes[c];for(var E in d)l[d[E].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,d[E]),delete d[E],f=!0)}return f};var Yt=function(){this.layerIndexes={},this.crossTileIDs=new pn,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};Yt.prototype.addLayer=function(l,f,c){var d=this.layerIndexes[l.id];d===void 0&&(d=this.layerIndexes[l.id]=new cn);var E=!1,C={};d.handleWrapJump(c);for(var T=0,L=f;T<L.length;T+=1){var Z=L[T],W=Z.getBucket(l);W&&l.id===W.layerIds[0]&&(W.bucketInstanceId||(W.bucketInstanceId=++this.maxBucketInstanceId),d.addBucket(Z.tileID,W,this.crossTileIDs)&&(E=!0),C[W.bucketInstanceId]=!0)}return d.removeStaleBuckets(C)&&(E=!0),E},Yt.prototype.pruneUnusedLayers=function(l){var f={};for(var c in l.forEach(function(d){f[d]=!0}),this.layerIndexes)f[c]||delete this.layerIndexes[c]};var Zo=function(l,f){return v.emitValidationErrors(l,f&&f.filter(function(c){return c.identifier!=="source.canvas"}))},xe=v.pick(Yr,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Ks=v.pick(Yr,["setCenter","setZoom","setBearing","setPitch"]),su=function(){var l={},f=v.styleSpec.$version;for(var c in v.styleSpec.$root){var d,E=v.styleSpec.$root[c];E.required&&(d=c==="version"?f:E.type==="array"?[]:{})!=null&&(l[c]=d)}return l}(),ds=function(l){function f(c,d){var E=this;d===void 0&&(d={}),l.call(this),this.map=c,this.dispatcher=new kt(Tt(),this),this.imageManager=new bt,this.imageManager.setEventedParent(this),this.glyphManager=new Kt(c._requestManager,d.localIdeographFontFamily),this.lineAtlas=new $e(256,512),this.crossTileSymbolIndex=new Yt,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new v.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",v.getReferrer());var C=this;this._rtlTextPluginCallback=f.registerForPluginStateChange(function(T){C.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:T.pluginStatus,pluginURL:T.pluginURL},function(L,Z){if(v.triggerPluginCompletionEvent(L),Z&&Z.every(function(fe){return fe}))for(var W in C.sourceCaches)C.sourceCaches[W].reload()})}),this.on("data",function(T){if(T.dataType==="source"&&T.sourceDataType==="metadata"){var L=E.sourceCaches[T.sourceId];if(L){var Z=L.getSource();if(Z&&Z.vectorLayerIds)for(var W in E._layers){var fe=E._layers[W];fe.source===Z.id&&E._validateLayer(fe)}}}})}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.loadURL=function(c,d){var E=this;d===void 0&&(d={}),this.fire(new v.Event("dataloading",{dataType:"style"}));var C=typeof d.validate=="boolean"?d.validate:!v.isMapboxURL(c);c=this.map._requestManager.normalizeStyleURL(c,d.accessToken);var T=this.map._requestManager.transformRequest(c,v.ResourceType.Style);this._request=v.getJSON(T,function(L,Z){E._request=null,L?E.fire(new v.ErrorEvent(L)):Z&&E._load(Z,C)})},f.prototype.loadJSON=function(c,d){var E=this;d===void 0&&(d={}),this.fire(new v.Event("dataloading",{dataType:"style"})),this._request=v.browser.frame(function(){E._request=null,E._load(c,d.validate!==!1)})},f.prototype.loadEmpty=function(){this.fire(new v.Event("dataloading",{dataType:"style"})),this._load(su,!1)},f.prototype._load=function(c,d){if(!d||!Zo(this,v.validateStyle(c))){for(var E in this._loaded=!0,this.stylesheet=c,c.sources)this.addSource(E,c.sources[E],{validate:!1});c.sprite?this._loadSprite(c.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(c.glyphs);var C=Zr(this.stylesheet.layers);this._order=C.map(function(W){return W.id}),this._layers={},this._serializedLayers={};for(var T=0,L=C;T<L.length;T+=1){var Z=L[T];(Z=v.createStyleLayer(Z)).setEventedParent(this,{layer:{id:Z.id}}),this._layers[Z.id]=Z,this._serializedLayers[Z.id]=Z.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new dt(this.stylesheet.light),this.fire(new v.Event("data",{dataType:"style"})),this.fire(new v.Event("style.load"))}},f.prototype._loadSprite=function(c){var d=this;this._spriteRequest=function(E,C,T){var L,Z,W,fe=v.browser.devicePixelRatio>1?"@2x":"",he=v.getJSON(C.transformRequest(C.normalizeSpriteURL(E,fe,".json"),v.ResourceType.SpriteJSON),function(Re,Be){he=null,W||(W=Re,L=Be,Le())}),de=v.getImage(C.transformRequest(C.normalizeSpriteURL(E,fe,".png"),v.ResourceType.SpriteImage),function(Re,Be){de=null,W||(W=Re,Z=Be,Le())});function Le(){if(W)T(W);else if(L&&Z){var Re=v.browser.getImageData(Z),Be={};for(var Ae in L){var Ve=L[Ae],rt=Ve.width,xt=Ve.height,Wt=Ve.x,Vt=Ve.y,Ot=Ve.sdf,vr=Ve.pixelRatio,Br=Ve.stretchX,Dr=Ve.stretchY,an=Ve.content,Bn=new v.RGBAImage({width:rt,height:xt});v.RGBAImage.copy(Re,Bn,{x:Wt,y:Vt},{x:0,y:0},{width:rt,height:xt}),Be[Ae]={data:Bn,pixelRatio:vr,sdf:Ot,stretchX:Br,stretchY:Dr,content:an}}T(null,Be)}}return{cancel:function(){he&&(he.cancel(),he=null),de&&(de.cancel(),de=null)}}}(c,this.map._requestManager,function(E,C){if(d._spriteRequest=null,E)d.fire(new v.ErrorEvent(E));else if(C)for(var T in C)d.imageManager.addImage(T,C[T]);d.imageManager.setLoaded(!0),d._availableImages=d.imageManager.listImages(),d.dispatcher.broadcast("setImages",d._availableImages),d.fire(new v.Event("data",{dataType:"style"}))})},f.prototype._validateLayer=function(c){var d=this.sourceCaches[c.source];if(d){var E=c.sourceLayer;if(E){var C=d.getSource();(C.type==="geojson"||C.vectorLayerIds&&C.vectorLayerIds.indexOf(E)===-1)&&this.fire(new v.ErrorEvent(new Error('Source layer "'+E+'" does not exist on source "'+C.id+'" as specified by style layer "'+c.id+'"')))}}},f.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var c in this.sourceCaches)if(!this.sourceCaches[c].loaded())return!1;return!!this.imageManager.isLoaded()},f.prototype._serializeLayers=function(c){for(var d=[],E=0,C=c;E<C.length;E+=1){var T=this._layers[C[E]];T.type!=="custom"&&d.push(T.serialize())}return d},f.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var c in this.sourceCaches)if(this.sourceCaches[c].hasTransition())return!0;for(var d in this._layers)if(this._layers[d].hasTransition())return!0;return!1},f.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},f.prototype.update=function(c){if(this._loaded){var d=this._changed;if(this._changed){var E=Object.keys(this._updatedLayers),C=Object.keys(this._removedLayers);for(var T in(E.length||C.length)&&this._updateWorkerLayers(E,C),this._updatedSources){var L=this._updatedSources[T];L==="reload"?this._reloadSource(T):L==="clear"&&this._clearSource(T)}for(var Z in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[Z].updateTransitions(c);this.light.updateTransitions(c),this._resetUpdates()}var W={};for(var fe in this.sourceCaches){var he=this.sourceCaches[fe];W[fe]=he.used,he.used=!1}for(var de=0,Le=this._order;de<Le.length;de+=1){var Re=this._layers[Le[de]];Re.recalculate(c,this._availableImages),!Re.isHidden(c.zoom)&&Re.source&&(this.sourceCaches[Re.source].used=!0)}for(var Be in W){var Ae=this.sourceCaches[Be];W[Be]!==Ae.used&&Ae.fire(new v.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:Be}))}this.light.recalculate(c),this.z=c.zoom,d&&this.fire(new v.Event("data",{dataType:"style"}))}},f.prototype._updateTilesForChangedImages=function(){var c=Object.keys(this._changedImages);if(c.length){for(var d in this.sourceCaches)this.sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],c);this._changedImages={}}},f.prototype._updateWorkerLayers=function(c,d){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(c),removedIds:d})},f.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},f.prototype.setState=function(c){var d=this;if(this._checkLoaded(),Zo(this,v.validateStyle(c)))return!1;(c=v.clone$1(c)).layers=Zr(c.layers);var E=function(T,L){if(!T)return[{command:Yr.setStyle,args:[L]}];var Z=[];try{if(!v.deepEqual(T.version,L.version))return[{command:Yr.setStyle,args:[L]}];v.deepEqual(T.center,L.center)||Z.push({command:Yr.setCenter,args:[L.center]}),v.deepEqual(T.zoom,L.zoom)||Z.push({command:Yr.setZoom,args:[L.zoom]}),v.deepEqual(T.bearing,L.bearing)||Z.push({command:Yr.setBearing,args:[L.bearing]}),v.deepEqual(T.pitch,L.pitch)||Z.push({command:Yr.setPitch,args:[L.pitch]}),v.deepEqual(T.sprite,L.sprite)||Z.push({command:Yr.setSprite,args:[L.sprite]}),v.deepEqual(T.glyphs,L.glyphs)||Z.push({command:Yr.setGlyphs,args:[L.glyphs]}),v.deepEqual(T.transition,L.transition)||Z.push({command:Yr.setTransition,args:[L.transition]}),v.deepEqual(T.light,L.light)||Z.push({command:Yr.setLight,args:[L.light]});var W={},fe=[];(function(de,Le,Re,Be){var Ae;for(Ae in Le=Le||{},de=de||{})de.hasOwnProperty(Ae)&&(Le.hasOwnProperty(Ae)||Qr(Ae,Re,Be));for(Ae in Le)Le.hasOwnProperty(Ae)&&(de.hasOwnProperty(Ae)?v.deepEqual(de[Ae],Le[Ae])||(de[Ae].type==="geojson"&&Le[Ae].type==="geojson"&&ea(de,Le,Ae)?Re.push({command:Yr.setGeoJSONSourceData,args:[Ae,Le[Ae].data]}):Ti(Ae,Le,Re,Be)):oi(Ae,Le,Re))})(T.sources,L.sources,fe,W);var he=[];T.layers&&T.layers.forEach(function(de){W[de.source]?Z.push({command:Yr.removeLayer,args:[de.id]}):he.push(de)}),Z=Z.concat(fe),function(de,Le,Re){Le=Le||[];var Be,Ae,Ve,rt,xt,Wt,Vt,Ot=(de=de||[]).map(Oi),vr=Le.map(Oi),Br=de.reduce(Ci,{}),Dr=Le.reduce(Ci,{}),an=Ot.slice(),Bn=Object.create(null);for(Be=0,Ae=0;Be<Ot.length;Be++)Dr.hasOwnProperty(Ve=Ot[Be])?Ae++:(Re.push({command:Yr.removeLayer,args:[Ve]}),an.splice(an.indexOf(Ve,Ae),1));for(Be=0,Ae=0;Be<vr.length;Be++)an[an.length-1-Be]!==(Ve=vr[vr.length-1-Be])&&(Br.hasOwnProperty(Ve)?(Re.push({command:Yr.removeLayer,args:[Ve]}),an.splice(an.lastIndexOf(Ve,an.length-Ae),1)):Ae++,Re.push({command:Yr.addLayer,args:[Dr[Ve],Wt=an[an.length-Be]]}),an.splice(an.length-Be,0,Ve),Bn[Ve]=!0);for(Be=0;Be<vr.length;Be++)if(rt=Br[Ve=vr[Be]],xt=Dr[Ve],!Bn[Ve]&&!v.deepEqual(rt,xt))if(v.deepEqual(rt.source,xt.source)&&v.deepEqual(rt["source-layer"],xt["source-layer"])&&v.deepEqual(rt.type,xt.type)){for(Vt in bi(rt.layout,xt.layout,Re,Ve,null,Yr.setLayoutProperty),bi(rt.paint,xt.paint,Re,Ve,null,Yr.setPaintProperty),v.deepEqual(rt.filter,xt.filter)||Re.push({command:Yr.setFilter,args:[Ve,xt.filter]}),v.deepEqual(rt.minzoom,xt.minzoom)&&v.deepEqual(rt.maxzoom,xt.maxzoom)||Re.push({command:Yr.setLayerZoomRange,args:[Ve,xt.minzoom,xt.maxzoom]}),rt)rt.hasOwnProperty(Vt)&&Vt!=="layout"&&Vt!=="paint"&&Vt!=="filter"&&Vt!=="metadata"&&Vt!=="minzoom"&&Vt!=="maxzoom"&&(Vt.indexOf("paint.")===0?bi(rt[Vt],xt[Vt],Re,Ve,Vt.slice(6),Yr.setPaintProperty):v.deepEqual(rt[Vt],xt[Vt])||Re.push({command:Yr.setLayerProperty,args:[Ve,Vt,xt[Vt]]}));for(Vt in xt)xt.hasOwnProperty(Vt)&&!rt.hasOwnProperty(Vt)&&Vt!=="layout"&&Vt!=="paint"&&Vt!=="filter"&&Vt!=="metadata"&&Vt!=="minzoom"&&Vt!=="maxzoom"&&(Vt.indexOf("paint.")===0?bi(rt[Vt],xt[Vt],Re,Ve,Vt.slice(6),Yr.setPaintProperty):v.deepEqual(rt[Vt],xt[Vt])||Re.push({command:Yr.setLayerProperty,args:[Ve,Vt,xt[Vt]]}))}else Re.push({command:Yr.removeLayer,args:[Ve]}),Wt=an[an.lastIndexOf(Ve)+1],Re.push({command:Yr.addLayer,args:[xt,Wt]})}(he,L.layers,Z)}catch(de){console.warn("Unable to compute style diff:",de),Z=[{command:Yr.setStyle,args:[L]}]}return Z}(this.serialize(),c).filter(function(T){return!(T.command in Ks)});if(E.length===0)return!1;var C=E.filter(function(T){return!(T.command in xe)});if(C.length>0)throw new Error("Unimplemented: "+C.map(function(T){return T.command}).join(", ")+".");return E.forEach(function(T){T.command!=="setTransition"&&d[T.command].apply(d,T.args)}),this.stylesheet=c,!0},f.prototype.addImage=function(c,d){if(this.getImage(c))return this.fire(new v.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(c,d),this._afterImageUpdated(c)},f.prototype.updateImage=function(c,d){this.imageManager.updateImage(c,d)},f.prototype.getImage=function(c){return this.imageManager.getImage(c)},f.prototype.removeImage=function(c){if(!this.getImage(c))return this.fire(new v.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(c),this._afterImageUpdated(c)},f.prototype._afterImageUpdated=function(c){this._availableImages=this.imageManager.listImages(),this._changedImages[c]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new v.Event("data",{dataType:"style"}))},f.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},f.prototype.addSource=function(c,d,E){var C=this;if(E===void 0&&(E={}),this._checkLoaded(),this.sourceCaches[c]!==void 0)throw new Error("There is already a source with this ID");if(!d.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(d).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(v.validateStyle.source,"sources."+c,d,null,E))){this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);var T=this.sourceCaches[c]=new Fe(c,d,this.dispatcher);T.style=this,T.setEventedParent(this,function(){return{isSourceLoaded:C.loaded(),source:T.serialize(),sourceId:c}}),T.onAdd(this.map),this._changed=!0}},f.prototype.removeSource=function(c){if(this._checkLoaded(),this.sourceCaches[c]===void 0)throw new Error("There is no source with this ID");for(var d in this._layers)if(this._layers[d].source===c)return this.fire(new v.ErrorEvent(new Error('Source "'+c+'" cannot be removed while layer "'+d+'" is using it.')));var E=this.sourceCaches[c];delete this.sourceCaches[c],delete this._updatedSources[c],E.fire(new v.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:c})),E.setEventedParent(null),E.clearTiles(),E.onRemove&&E.onRemove(this.map),this._changed=!0},f.prototype.setGeoJSONSourceData=function(c,d){this._checkLoaded(),this.sourceCaches[c].getSource().setData(d),this._changed=!0},f.prototype.getSource=function(c){return this.sourceCaches[c]&&this.sourceCaches[c].getSource()},f.prototype.addLayer=function(c,d,E){E===void 0&&(E={}),this._checkLoaded();var C=c.id;if(this.getLayer(C))this.fire(new v.ErrorEvent(new Error('Layer with id "'+C+'" already exists on this map')));else{var T;if(c.type==="custom"){if(Zo(this,v.validateCustomStyleLayer(c)))return;T=v.createStyleLayer(c)}else{if(typeof c.source=="object"&&(this.addSource(C,c.source),c=v.clone$1(c),c=v.extend(c,{source:C})),this._validate(v.validateStyle.layer,"layers."+C,c,{arrayIndex:-1},E))return;T=v.createStyleLayer(c),this._validateLayer(T),T.setEventedParent(this,{layer:{id:C}}),this._serializedLayers[T.id]=T.serialize()}var L=d?this._order.indexOf(d):this._order.length;if(d&&L===-1)this.fire(new v.ErrorEvent(new Error('Layer with id "'+d+'" does not exist on this map.')));else{if(this._order.splice(L,0,C),this._layerOrderChanged=!0,this._layers[C]=T,this._removedLayers[C]&&T.source&&T.type!=="custom"){var Z=this._removedLayers[C];delete this._removedLayers[C],Z.type!==T.type?this._updatedSources[T.source]="clear":(this._updatedSources[T.source]="reload",this.sourceCaches[T.source].pause())}this._updateLayer(T),T.onAdd&&T.onAdd(this.map)}}},f.prototype.moveLayer=function(c,d){if(this._checkLoaded(),this._changed=!0,this._layers[c]){if(c!==d){var E=this._order.indexOf(c);this._order.splice(E,1);var C=d?this._order.indexOf(d):this._order.length;d&&C===-1?this.fire(new v.ErrorEvent(new Error('Layer with id "'+d+'" does not exist on this map.'))):(this._order.splice(C,0,c),this._layerOrderChanged=!0)}}else this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be moved.")))},f.prototype.removeLayer=function(c){this._checkLoaded();var d=this._layers[c];if(d){d.setEventedParent(null);var E=this._order.indexOf(c);this._order.splice(E,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[c]=d,delete this._layers[c],delete this._serializedLayers[c],delete this._updatedLayers[c],delete this._updatedPaintProps[c],d.onRemove&&d.onRemove(this.map)}else this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be removed.")))},f.prototype.getLayer=function(c){return this._layers[c]},f.prototype.hasLayer=function(c){return c in this._layers},f.prototype.setLayerZoomRange=function(c,d,E){this._checkLoaded();var C=this.getLayer(c);C?C.minzoom===d&&C.maxzoom===E||(d!=null&&(C.minzoom=d),E!=null&&(C.maxzoom=E),this._updateLayer(C)):this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot have zoom extent.")))},f.prototype.setFilter=function(c,d,E){E===void 0&&(E={}),this._checkLoaded();var C=this.getLayer(c);if(C){if(!v.deepEqual(C.filter,d))return d==null?(C.filter=void 0,void this._updateLayer(C)):void(this._validate(v.validateStyle.filter,"layers."+C.id+".filter",d,null,E)||(C.filter=v.clone$1(d),this._updateLayer(C)))}else this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be filtered.")))},f.prototype.getFilter=function(c){return v.clone$1(this.getLayer(c).filter)},f.prototype.setLayoutProperty=function(c,d,E,C){C===void 0&&(C={}),this._checkLoaded();var T=this.getLayer(c);T?v.deepEqual(T.getLayoutProperty(d),E)||(T.setLayoutProperty(d,E,C),this._updateLayer(T)):this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be styled.")))},f.prototype.getLayoutProperty=function(c,d){var E=this.getLayer(c);if(E)return E.getLayoutProperty(d);this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style.")))},f.prototype.setPaintProperty=function(c,d,E,C){C===void 0&&(C={}),this._checkLoaded();var T=this.getLayer(c);T?v.deepEqual(T.getPaintProperty(d),E)||(T.setPaintProperty(d,E,C)&&this._updateLayer(T),this._changed=!0,this._updatedPaintProps[c]=!0):this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be styled.")))},f.prototype.getPaintProperty=function(c,d){return this.getLayer(c).getPaintProperty(d)},f.prototype.setFeatureState=function(c,d){this._checkLoaded();var E=c.source,C=c.sourceLayer,T=this.sourceCaches[E];if(T!==void 0){var L=T.getSource().type;L==="geojson"&&C?this.fire(new v.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):L!=="vector"||C?(c.id===void 0&&this.fire(new v.ErrorEvent(new Error("The feature id parameter must be provided."))),T.setFeatureState(C,c.id,d)):this.fire(new v.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new v.ErrorEvent(new Error("The source '"+E+"' does not exist in the map's style.")))},f.prototype.removeFeatureState=function(c,d){this._checkLoaded();var E=c.source,C=this.sourceCaches[E];if(C!==void 0){var T=C.getSource().type,L=T==="vector"?c.sourceLayer:void 0;T!=="vector"||L?d&&typeof c.id!="string"&&typeof c.id!="number"?this.fire(new v.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):C.removeFeatureState(L,c.id,d):this.fire(new v.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new v.ErrorEvent(new Error("The source '"+E+"' does not exist in the map's style.")))},f.prototype.getFeatureState=function(c){this._checkLoaded();var d=c.source,E=c.sourceLayer,C=this.sourceCaches[d];if(C!==void 0){if(C.getSource().type!=="vector"||E)return c.id===void 0&&this.fire(new v.ErrorEvent(new Error("The feature id parameter must be provided."))),C.getFeatureState(E,c.id);this.fire(new v.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new v.ErrorEvent(new Error("The source '"+d+"' does not exist in the map's style.")))},f.prototype.getTransition=function(){return v.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},f.prototype.serialize=function(){return v.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:v.mapObject(this.sourceCaches,function(c){return c.serialize()}),layers:this._serializeLayers(this._order)},function(c){return c!==void 0})},f.prototype._updateLayer=function(c){this._updatedLayers[c.id]=!0,c.source&&!this._updatedSources[c.source]&&this.sourceCaches[c.source].getSource().type!=="raster"&&(this._updatedSources[c.source]="reload",this.sourceCaches[c.source].pause()),this._changed=!0},f.prototype._flattenAndSortRenderedFeatures=function(c){for(var d=this,E=function(Br){return d._layers[Br].type==="fill-extrusion"},C={},T=[],L=this._order.length-1;L>=0;L--){var Z=this._order[L];if(E(Z)){C[Z]=L;for(var W=0,fe=c;W<fe.length;W+=1){var he=fe[W][Z];if(he)for(var de=0,Le=he;de<Le.length;de+=1)T.push(Le[de])}}}T.sort(function(Br,Dr){return Dr.intersectionZ-Br.intersectionZ});for(var Re=[],Be=this._order.length-1;Be>=0;Be--){var Ae=this._order[Be];if(E(Ae))for(var Ve=T.length-1;Ve>=0;Ve--){var rt=T[Ve].feature;if(C[rt.layer.id]<Be)break;Re.push(rt),T.pop()}else for(var xt=0,Wt=c;xt<Wt.length;xt+=1){var Vt=Wt[xt][Ae];if(Vt)for(var Ot=0,vr=Vt;Ot<vr.length;Ot+=1)Re.push(vr[Ot].feature)}}return Re},f.prototype.queryRenderedFeatures=function(c,d,E){d&&d.filter&&this._validate(v.validateStyle.filter,"queryRenderedFeatures.filter",d.filter,null,d);var C={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new v.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var T=0,L=d.layers;T<L.length;T+=1){var Z=L[T],W=this._layers[Z];if(!W)return this.fire(new v.ErrorEvent(new Error("The layer '"+Z+"' does not exist in the map's style and cannot be queried for features."))),[];C[W.source]=!0}}var fe=[];for(var he in d.availableImages=this._availableImages,this.sourceCaches)d.layers&&!C[he]||fe.push(hn(this.sourceCaches[he],this._layers,this._serializedLayers,c,d,E));return this.placement&&fe.push(function(de,Le,Re,Be,Ae,Ve,rt){for(var xt={},Wt=Ve.queryRenderedSymbols(Be),Vt=[],Ot=0,vr=Object.keys(Wt).map(Number);Ot<vr.length;Ot+=1)Vt.push(rt[vr[Ot]]);Vt.sort(qi);for(var Br=function(){var Nn=an[Dr],Bi=Nn.featureIndex.lookupSymbolFeatures(Wt[Nn.bucketInstanceId],Le,Nn.bucketIndex,Nn.sourceLayerIndex,Ae.filter,Ae.layers,Ae.availableImages,de);for(var on in Bi){var si=xt[on]=xt[on]||[],hi=Bi[on];hi.sort(function(mi,Rn){var Wn=Nn.featureSortOrder;if(Wn){var Ha=Wn.indexOf(mi.featureIndex);return Wn.indexOf(Rn.featureIndex)-Ha}return Rn.featureIndex-mi.featureIndex});for(var ri=0,Hn=hi;ri<Hn.length;ri+=1)si.push(Hn[ri])}},Dr=0,an=Vt;Dr<an.length;Dr+=1)Br();var Bn=function(Nn){xt[Nn].forEach(function(Bi){var on=Bi.feature,si=Re[de[Nn].source].getFeatureState(on.layer["source-layer"],on.id);on.source=on.layer.source,on.layer["source-layer"]&&(on.sourceLayer=on.layer["source-layer"]),on.state=si})};for(var kn in xt)Bn(kn);return xt}(this._layers,this._serializedLayers,this.sourceCaches,c,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(fe)},f.prototype.querySourceFeatures=function(c,d){d&&d.filter&&this._validate(v.validateStyle.filter,"querySourceFeatures.filter",d.filter,null,d);var E=this.sourceCaches[c];return E?function(C,T){for(var L=C.getRenderableIds().map(function(Le){return C.getTileByID(Le)}),Z=[],W={},fe=0;fe<L.length;fe++){var he=L[fe],de=he.tileID.canonical.key;W[de]||(W[de]=!0,he.querySourceFeatures(Z,T))}return Z}(E,d):[]},f.prototype.addSourceType=function(c,d,E){return f.getSourceType(c)?E(new Error('A source type called "'+c+'" already exists.')):(f.setSourceType(c,d),d.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:c,url:d.workerSourceURL},E):E(null,null))},f.prototype.getLight=function(){return this.light.getLight()},f.prototype.setLight=function(c,d){d===void 0&&(d={}),this._checkLoaded();var E=this.light.getLight(),C=!1;for(var T in c)if(!v.deepEqual(c[T],E[T])){C=!0;break}if(C){var L={now:v.browser.now(),transition:v.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(c,d),this.light.updateTransitions(L)}},f.prototype._validate=function(c,d,E,C,T){return T===void 0&&(T={}),(!T||T.validate!==!1)&&Zo(this,c.call(v.validateStyle,v.extend({key:d,style:this.serialize(),value:E,styleSpec:v.styleSpec},C)))},f.prototype._remove=function(){for(var c in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),v.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[c].setEventedParent(null);for(var d in this.sourceCaches)this.sourceCaches[d].clearTiles(),this.sourceCaches[d].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},f.prototype._clearSource=function(c){this.sourceCaches[c].clearTiles()},f.prototype._reloadSource=function(c){this.sourceCaches[c].resume(),this.sourceCaches[c].reload()},f.prototype._updateSources=function(c){for(var d in this.sourceCaches)this.sourceCaches[d].update(c)},f.prototype._generateCollisionBoxes=function(){for(var c in this.sourceCaches)this._reloadSource(c)},f.prototype._updatePlacement=function(c,d,E,C,T){T===void 0&&(T=!1);for(var L=!1,Z=!1,W={},fe=0,he=this._order;fe<he.length;fe+=1){var de=this._layers[he[fe]];if(de.type==="symbol"){if(!W[de.source]){var Le=this.sourceCaches[de.source];W[de.source]=Le.getRenderableIds(!0).map(function(rt){return Le.getTileByID(rt)}).sort(function(rt,xt){return xt.tileID.overscaledZ-rt.tileID.overscaledZ||(rt.tileID.isLessThan(xt.tileID)?-1:1)})}var Re=this.crossTileSymbolIndex.addLayer(de,W[de.source],c.center.lng);L=L||Re}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((T=T||this._layerOrderChanged||E===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(v.browser.now(),c.zoom))&&(this.pauseablePlacement=new Ji(c,this._order,T,d,E,C,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,W),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(v.browser.now()),Z=!0),L&&this.pauseablePlacement.placement.setStale()),Z||L)for(var Be=0,Ae=this._order;Be<Ae.length;Be+=1){var Ve=this._layers[Ae[Be]];Ve.type==="symbol"&&this.placement.updateLayerOpacities(Ve,W[Ve.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(v.browser.now())},f.prototype._releaseSymbolFadeTiles=function(){for(var c in this.sourceCaches)this.sourceCaches[c].releaseSymbolFadeTiles()},f.prototype.getImages=function(c,d,E){this.imageManager.getImages(d.icons,E),this._updateTilesForChangedImages();var C=this.sourceCaches[d.source];C&&C.setDependencies(d.tileID.key,d.type,d.icons)},f.prototype.getGlyphs=function(c,d,E){this.glyphManager.getGlyphs(d.stacks,E)},f.prototype.getResource=function(c,d,E){return v.makeRequest(d,E)},f}(v.Evented);ds.getSourceType=function(l){return Cr[l]},ds.setSourceType=function(l,f){Cr[l]=f},ds.registerForPluginStateChange=v.registerForPluginStateChange;var sa=v.createLayout([{name:"a_pos",type:"Int16",components:2}]),xo=Hi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),Wl=Hi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),bc=Hi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Gu=Hi(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),Ec=Hi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Tl=Hi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),Hu=Hi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),uu=Hi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),Wu=Hi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),_=Hi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),w=Hi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),N=Hi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),O=Hi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),K=Hi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),_e=Hi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),Xe=Hi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),ft=Hi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),mt=Hi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),cr=Hi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),xr=Hi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Pn=Hi(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),fi=Hi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),Qn=Hi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),Yi=Hi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),da=Hi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),Ra=Hi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function Hi(l,f){var c=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,d=f.match(/attribute ([\w]+) ([\w]+)/g),E=l.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),C=f.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),T=C?C.concat(E):E,L={};return{fragmentSource:l=l.replace(c,function(Z,W,fe,he,de){return L[de]=!0,W==="define"?`
#ifndef HAS_UNIFORM_u_`+de+`
varying `+fe+" "+he+" "+de+`;
#else
uniform `+fe+" "+he+" u_"+de+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+de+`
    `+fe+" "+he+" "+de+" = u_"+de+`;
#endif
`}),vertexSource:f=f.replace(c,function(Z,W,fe,he,de){var Le=he==="float"?"vec2":"vec4",Re=de.match(/color/)?"color":Le;return L[de]?W==="define"?`
#ifndef HAS_UNIFORM_u_`+de+`
uniform lowp float u_`+de+`_t;
attribute `+fe+" "+Le+" a_"+de+`;
varying `+fe+" "+he+" "+de+`;
#else
uniform `+fe+" "+he+" u_"+de+`;
#endif
`:Re==="vec4"?`
#ifndef HAS_UNIFORM_u_`+de+`
    `+de+" = a_"+de+`;
#else
    `+fe+" "+he+" "+de+" = u_"+de+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+de+`
    `+de+" = unpack_mix_"+Re+"(a_"+de+", u_"+de+`_t);
#else
    `+fe+" "+he+" "+de+" = u_"+de+`;
#endif
`:W==="define"?`
#ifndef HAS_UNIFORM_u_`+de+`
uniform lowp float u_`+de+`_t;
attribute `+fe+" "+Le+" a_"+de+`;
#else
uniform `+fe+" "+he+" u_"+de+`;
#endif
`:Re==="vec4"?`
#ifndef HAS_UNIFORM_u_`+de+`
    `+fe+" "+he+" "+de+" = a_"+de+`;
#else
    `+fe+" "+he+" "+de+" = u_"+de+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+de+`
    `+fe+" "+he+" "+de+" = unpack_mix_"+Re+"(a_"+de+", u_"+de+`_t);
#else
    `+fe+" "+he+" "+de+" = u_"+de+`;
#endif
`}),staticAttributes:d,staticUniforms:T}}var Lo=Object.freeze({__proto__:null,prelude:xo,background:Wl,backgroundPattern:bc,circle:Gu,clippingMask:Ec,heatmap:Tl,heatmapTexture:Hu,collisionBox:uu,collisionCircle:Wu,debug:_,fill:w,fillOutline:N,fillOutlinePattern:O,fillPattern:K,fillExtrusion:_e,fillExtrusionPattern:Xe,hillshadePrepare:ft,hillshade:mt,line:cr,lineGradient:xr,linePattern:Pn,lineSDF:fi,raster:Qn,symbolIcon:Yi,symbolSDF:da,symbolTextAndIcon:Ra}),Ss=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function hl(l){for(var f=[],c=0;c<l.length;c++)if(l[c]!==null){var d=l[c].split(" ");f.push(d.pop())}return f}Ss.prototype.bind=function(l,f,c,d,E,C,T,L){this.context=l;for(var Z=this.boundPaintVertexBuffers.length!==d.length,W=0;!Z&&W<d.length;W++)this.boundPaintVertexBuffers[W]!==d[W]&&(Z=!0);l.extVertexArrayObject&&this.vao&&this.boundProgram===f&&this.boundLayoutVertexBuffer===c&&!Z&&this.boundIndexBuffer===E&&this.boundVertexOffset===C&&this.boundDynamicVertexBuffer===T&&this.boundDynamicVertexBuffer2===L?(l.bindVertexArrayOES.set(this.vao),T&&T.bind(),E&&E.dynamicDraw&&E.bind(),L&&L.bind()):this.freshBind(f,c,d,E,C,T,L)},Ss.prototype.freshBind=function(l,f,c,d,E,C,T){var L,Z=l.numAttributes,W=this.context,fe=W.gl;if(W.extVertexArrayObject)this.vao&&this.destroy(),this.vao=W.extVertexArrayObject.createVertexArrayOES(),W.bindVertexArrayOES.set(this.vao),L=0,this.boundProgram=l,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=d,this.boundVertexOffset=E,this.boundDynamicVertexBuffer=C,this.boundDynamicVertexBuffer2=T;else{L=W.currentNumAttributes||0;for(var he=Z;he<L;he++)fe.disableVertexAttribArray(he)}f.enableAttributes(fe,l);for(var de=0,Le=c;de<Le.length;de+=1)Le[de].enableAttributes(fe,l);C&&C.enableAttributes(fe,l),T&&T.enableAttributes(fe,l),f.bind(),f.setVertexAttribPointers(fe,l,E);for(var Re=0,Be=c;Re<Be.length;Re+=1){var Ae=Be[Re];Ae.bind(),Ae.setVertexAttribPointers(fe,l,E)}C&&(C.bind(),C.setVertexAttribPointers(fe,l,E)),d&&d.bind(),T&&(T.bind(),T.setVertexAttribPointers(fe,l,E)),W.currentNumAttributes=Z},Ss.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var Gc=function(l,f,c,d,E,C){var T=l.gl;this.program=T.createProgram();for(var L=hl(c.staticAttributes),Z=d?d.getBinderAttributes():[],W=L.concat(Z),fe=c.staticUniforms?hl(c.staticUniforms):[],he=d?d.getBinderUniforms():[],de=[],Le=0,Re=fe.concat(he);Le<Re.length;Le+=1){var Be=Re[Le];de.indexOf(Be)<0&&de.push(Be)}var Ae=d?d.defines():[];C&&Ae.push("#define OVERDRAW_INSPECTOR;");var Ve=Ae.concat(xo.fragmentSource,c.fragmentSource).join(`
`),rt=Ae.concat(xo.vertexSource,c.vertexSource).join(`
`),xt=T.createShader(T.FRAGMENT_SHADER);if(T.isContextLost())this.failedToCreate=!0;else{T.shaderSource(xt,Ve),T.compileShader(xt),T.attachShader(this.program,xt);var Wt=T.createShader(T.VERTEX_SHADER);if(T.isContextLost())this.failedToCreate=!0;else{T.shaderSource(Wt,rt),T.compileShader(Wt),T.attachShader(this.program,Wt),this.attributes={};var Vt={};this.numAttributes=W.length;for(var Ot=0;Ot<this.numAttributes;Ot++)W[Ot]&&(T.bindAttribLocation(this.program,Ot,W[Ot]),this.attributes[W[Ot]]=Ot);T.linkProgram(this.program),T.deleteShader(Wt),T.deleteShader(xt);for(var vr=0;vr<de.length;vr++){var Br=de[vr];if(Br&&!Vt[Br]){var Dr=T.getUniformLocation(this.program,Br);Dr&&(Vt[Br]=Dr)}}this.fixedUniforms=E(l,Vt),this.binderUniforms=d?d.getUniforms(l,Vt):[]}}};function Xu(l,f,c){var d=1/$i(c,1,f.transform.tileZoom),E=Math.pow(2,c.tileID.overscaledZ),C=c.tileSize*Math.pow(2,f.transform.tileZoom)/E,T=C*(c.tileID.canonical.x+c.tileID.wrap*E),L=C*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_scale:[d,l.fromScale,l.toScale],u_fade:l.t,u_pixel_coord_upper:[T>>16,L>>16],u_pixel_coord_lower:[65535&T,65535&L]}}Gc.prototype.draw=function(l,f,c,d,E,C,T,L,Z,W,fe,he,de,Le,Re,Be){var Ae,Ve=l.gl;if(!this.failedToCreate){for(var rt in l.program.set(this.program),l.setDepthMode(c),l.setStencilMode(d),l.setColorMode(E),l.setCullFace(C),this.fixedUniforms)this.fixedUniforms[rt].set(T[rt]);Le&&Le.setUniforms(l,this.binderUniforms,he,{zoom:de});for(var xt=(Ae={},Ae[Ve.LINES]=2,Ae[Ve.TRIANGLES]=3,Ae[Ve.LINE_STRIP]=1,Ae)[f],Wt=0,Vt=fe.get();Wt<Vt.length;Wt+=1){var Ot=Vt[Wt],vr=Ot.vaos||(Ot.vaos={});(vr[L]||(vr[L]=new Ss)).bind(l,this,Z,Le?Le.getPaintVertexBuffers():[],W,Ot.vertexOffset,Re,Be),Ve.drawElements(f,Ot.primitiveLength*xt,Ve.UNSIGNED_SHORT,Ot.primitiveOffset*xt*2)}}};var Sc=function(l,f,c,d){var E=f.style.light,C=E.properties.get("position"),T=[C.x,C.y,C.z],L=v.create$1();E.properties.get("anchor")==="viewport"&&v.fromRotation(L,-f.transform.angle),v.transformMat3(T,T,L);var Z=E.properties.get("color");return{u_matrix:l,u_lightpos:T,u_lightintensity:E.properties.get("intensity"),u_lightcolor:[Z.r,Z.g,Z.b],u_vertical_gradient:+c,u_opacity:d}},Mu=function(l,f,c,d,E,C,T){return v.extend(Sc(l,f,c,d),Xu(C,f,T),{u_height_factor:-Math.pow(2,E.overscaledZ)/T.tileSize/8})},vu=function(l){return{u_matrix:l}},Ao=function(l,f,c,d){return v.extend(vu(l),Xu(c,f,d))},va=function(l,f){return{u_matrix:l,u_world:f}},uh=function(l,f,c,d,E){return v.extend(Ao(l,f,c,d),{u_world:E})},lh=function(l,f,c,d){var E,C,T=l.transform;if(d.paint.get("circle-pitch-alignment")==="map"){var L=$i(c,1,T.zoom);E=!0,C=[L,L]}else E=!1,C=T.pixelsToGLUnits;return{u_camera_to_center_distance:T.cameraToCenterDistance,u_scale_with_map:+(d.paint.get("circle-pitch-scale")==="map"),u_matrix:l.translatePosMatrix(f.posMatrix,c,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_pitch_with_map:+E,u_device_pixel_ratio:v.browser.devicePixelRatio,u_extrude_scale:C}},ho=function(l,f,c){var d=$i(c,1,f.zoom),E=Math.pow(2,f.zoom-c.tileID.overscaledZ),C=c.tileID.overscaleFactor();return{u_matrix:l,u_camera_to_center_distance:f.cameraToCenterDistance,u_pixels_to_tile_units:d,u_extrude_scale:[f.pixelsToGLUnits[0]/(d*E),f.pixelsToGLUnits[1]/(d*E)],u_overscale_factor:C}},Pf=function(l,f,c){return{u_matrix:l,u_inv_matrix:f,u_camera_to_center_distance:c.cameraToCenterDistance,u_viewport_size:[c.width,c.height]}},mu=function(l,f,c){return c===void 0&&(c=1),{u_matrix:l,u_color:f,u_overlay:0,u_overlay_scale:c}},Fs=function(l){return{u_matrix:l}},Cc=function(l,f,c,d){return{u_matrix:l,u_extrude_scale:$i(f,1,c),u_intensity:d}},pl=function(l,f,c){var d=l.transform;return{u_matrix:If(l,f,c),u_ratio:1/$i(f,1,d.zoom),u_device_pixel_ratio:v.browser.devicePixelRatio,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},Ca=function(l,f,c,d){return v.extend(pl(l,f,c),{u_image:0,u_image_height:d})},Ml=function(l,f,c,d){var E=l.transform,C=ns(f,E);return{u_matrix:If(l,f,c),u_texsize:f.imageAtlasTexture.size,u_ratio:1/$i(f,1,E.zoom),u_device_pixel_ratio:v.browser.devicePixelRatio,u_image:0,u_scale:[C,d.fromScale,d.toScale],u_fade:d.t,u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]]}},Xl=function(l,f,c,d,E){var C=l.lineAtlas,T=ns(f,l.transform),L=c.layout.get("line-cap")==="round",Z=C.getDash(d.from,L),W=C.getDash(d.to,L),fe=Z.width*E.fromScale,he=W.width*E.toScale;return v.extend(pl(l,f,c),{u_patternscale_a:[T/fe,-Z.height/2],u_patternscale_b:[T/he,-W.height/2],u_sdfgamma:C.width/(256*Math.min(fe,he)*v.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:Z.y,u_tex_y_b:W.y,u_mix:E.t})};function ns(l,f){return 1/$i(l,1,f.tileZoom)}function If(l,f,c){return l.translatePosMatrix(f.tileID.posMatrix,f,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}var ch=function(l,f,c,d,E){return{u_matrix:l,u_tl_parent:f,u_scale_parent:c,u_buffer_scale:1,u_fade_t:d.mix,u_opacity:d.opacity*E.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:E.paint.get("raster-brightness-min"),u_brightness_high:E.paint.get("raster-brightness-max"),u_saturation_factor:(T=E.paint.get("raster-saturation"),T>0?1-1/(1.001-T):-T),u_contrast_factor:(C=E.paint.get("raster-contrast"),C>0?1/(1-C):1+C),u_spin_weights:fh(E.paint.get("raster-hue-rotate"))};var C,T};function fh(l){l*=Math.PI/180;var f=Math.sin(l),c=Math.cos(l);return[(2*c+1)/3,(-Math.sqrt(3)*f-c+1)/3,(Math.sqrt(3)*f-c+1)/3]}var Hc,dl=function(l,f,c,d,E,C,T,L,Z,W){var fe=E.transform;return{u_is_size_zoom_constant:+(l==="constant"||l==="source"),u_is_size_feature_constant:+(l==="constant"||l==="camera"),u_size_t:f?f.uSizeT:0,u_size:f?f.uSize:0,u_camera_to_center_distance:fe.cameraToCenterDistance,u_pitch:fe.pitch/360*2*Math.PI,u_rotate_symbol:+c,u_aspect_ratio:fe.width/fe.height,u_fade_change:E.options.fadeDuration?E.symbolFadeChange:1,u_matrix:C,u_label_plane_matrix:T,u_coord_matrix:L,u_is_text:+Z,u_pitch_with_map:+d,u_texsize:W,u_texture:0}},jo=function(l,f,c,d,E,C,T,L,Z,W,fe){var he=E.transform;return v.extend(dl(l,f,c,d,E,C,T,L,Z,W),{u_gamma_scale:d?Math.cos(he._pitch)*he.cameraToCenterDistance:1,u_device_pixel_ratio:v.browser.devicePixelRatio,u_is_halo:+fe})},Pu=function(l,f,c,d,E,C,T,L,Z,W){return v.extend(jo(l,f,c,d,E,C,T,L,!0,Z,!0),{u_texsize_icon:W,u_texture_icon:1})},Yu=function(l,f,c){return{u_matrix:l,u_opacity:f,u_color:c}},Vo=function(l,f,c,d,E,C){return v.extend(function(T,L,Z,W){var fe=Z.imageManager.getPattern(T.from.toString()),he=Z.imageManager.getPattern(T.to.toString()),de=Z.imageManager.getPixelSize(),Le=de.width,Re=de.height,Be=Math.pow(2,W.tileID.overscaledZ),Ae=W.tileSize*Math.pow(2,Z.transform.tileZoom)/Be,Ve=Ae*(W.tileID.canonical.x+W.tileID.wrap*Be),rt=Ae*W.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:fe.tl,u_pattern_br_a:fe.br,u_pattern_tl_b:he.tl,u_pattern_br_b:he.br,u_texsize:[Le,Re],u_mix:L.t,u_pattern_size_a:fe.displaySize,u_pattern_size_b:he.displaySize,u_scale_a:L.fromScale,u_scale_b:L.toScale,u_tile_units_to_pixels:1/$i(W,1,Z.transform.tileZoom),u_pixel_coord_upper:[Ve>>16,rt>>16],u_pixel_coord_lower:[65535&Ve,65535&rt]}}(d,C,c,E),{u_matrix:l,u_opacity:f})},Pl={fillExtrusion:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_lightpos:new v.Uniform3f(l,f.u_lightpos),u_lightintensity:new v.Uniform1f(l,f.u_lightintensity),u_lightcolor:new v.Uniform3f(l,f.u_lightcolor),u_vertical_gradient:new v.Uniform1f(l,f.u_vertical_gradient),u_opacity:new v.Uniform1f(l,f.u_opacity)}},fillExtrusionPattern:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_lightpos:new v.Uniform3f(l,f.u_lightpos),u_lightintensity:new v.Uniform1f(l,f.u_lightintensity),u_lightcolor:new v.Uniform3f(l,f.u_lightcolor),u_vertical_gradient:new v.Uniform1f(l,f.u_vertical_gradient),u_height_factor:new v.Uniform1f(l,f.u_height_factor),u_image:new v.Uniform1i(l,f.u_image),u_texsize:new v.Uniform2f(l,f.u_texsize),u_pixel_coord_upper:new v.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(l,f.u_pixel_coord_lower),u_scale:new v.Uniform3f(l,f.u_scale),u_fade:new v.Uniform1f(l,f.u_fade),u_opacity:new v.Uniform1f(l,f.u_opacity)}},fill:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix)}},fillPattern:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_image:new v.Uniform1i(l,f.u_image),u_texsize:new v.Uniform2f(l,f.u_texsize),u_pixel_coord_upper:new v.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(l,f.u_pixel_coord_lower),u_scale:new v.Uniform3f(l,f.u_scale),u_fade:new v.Uniform1f(l,f.u_fade)}},fillOutline:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_world:new v.Uniform2f(l,f.u_world)}},fillOutlinePattern:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_world:new v.Uniform2f(l,f.u_world),u_image:new v.Uniform1i(l,f.u_image),u_texsize:new v.Uniform2f(l,f.u_texsize),u_pixel_coord_upper:new v.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(l,f.u_pixel_coord_lower),u_scale:new v.Uniform3f(l,f.u_scale),u_fade:new v.Uniform1f(l,f.u_fade)}},circle:function(l,f){return{u_camera_to_center_distance:new v.Uniform1f(l,f.u_camera_to_center_distance),u_scale_with_map:new v.Uniform1i(l,f.u_scale_with_map),u_pitch_with_map:new v.Uniform1i(l,f.u_pitch_with_map),u_extrude_scale:new v.Uniform2f(l,f.u_extrude_scale),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_matrix:new v.UniformMatrix4f(l,f.u_matrix)}},collisionBox:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_camera_to_center_distance:new v.Uniform1f(l,f.u_camera_to_center_distance),u_pixels_to_tile_units:new v.Uniform1f(l,f.u_pixels_to_tile_units),u_extrude_scale:new v.Uniform2f(l,f.u_extrude_scale),u_overscale_factor:new v.Uniform1f(l,f.u_overscale_factor)}},collisionCircle:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_inv_matrix:new v.UniformMatrix4f(l,f.u_inv_matrix),u_camera_to_center_distance:new v.Uniform1f(l,f.u_camera_to_center_distance),u_viewport_size:new v.Uniform2f(l,f.u_viewport_size)}},debug:function(l,f){return{u_color:new v.UniformColor(l,f.u_color),u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_overlay:new v.Uniform1i(l,f.u_overlay),u_overlay_scale:new v.Uniform1f(l,f.u_overlay_scale)}},clippingMask:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix)}},heatmap:function(l,f){return{u_extrude_scale:new v.Uniform1f(l,f.u_extrude_scale),u_intensity:new v.Uniform1f(l,f.u_intensity),u_matrix:new v.UniformMatrix4f(l,f.u_matrix)}},heatmapTexture:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_world:new v.Uniform2f(l,f.u_world),u_image:new v.Uniform1i(l,f.u_image),u_color_ramp:new v.Uniform1i(l,f.u_color_ramp),u_opacity:new v.Uniform1f(l,f.u_opacity)}},hillshade:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_image:new v.Uniform1i(l,f.u_image),u_latrange:new v.Uniform2f(l,f.u_latrange),u_light:new v.Uniform2f(l,f.u_light),u_shadow:new v.UniformColor(l,f.u_shadow),u_highlight:new v.UniformColor(l,f.u_highlight),u_accent:new v.UniformColor(l,f.u_accent)}},hillshadePrepare:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_image:new v.Uniform1i(l,f.u_image),u_dimension:new v.Uniform2f(l,f.u_dimension),u_zoom:new v.Uniform1f(l,f.u_zoom),u_unpack:new v.Uniform4f(l,f.u_unpack)}},line:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_ratio:new v.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_units_to_pixels:new v.Uniform2f(l,f.u_units_to_pixels)}},lineGradient:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_ratio:new v.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_units_to_pixels:new v.Uniform2f(l,f.u_units_to_pixels),u_image:new v.Uniform1i(l,f.u_image),u_image_height:new v.Uniform1f(l,f.u_image_height)}},linePattern:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_texsize:new v.Uniform2f(l,f.u_texsize),u_ratio:new v.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_image:new v.Uniform1i(l,f.u_image),u_units_to_pixels:new v.Uniform2f(l,f.u_units_to_pixels),u_scale:new v.Uniform3f(l,f.u_scale),u_fade:new v.Uniform1f(l,f.u_fade)}},lineSDF:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_ratio:new v.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_units_to_pixels:new v.Uniform2f(l,f.u_units_to_pixels),u_patternscale_a:new v.Uniform2f(l,f.u_patternscale_a),u_patternscale_b:new v.Uniform2f(l,f.u_patternscale_b),u_sdfgamma:new v.Uniform1f(l,f.u_sdfgamma),u_image:new v.Uniform1i(l,f.u_image),u_tex_y_a:new v.Uniform1f(l,f.u_tex_y_a),u_tex_y_b:new v.Uniform1f(l,f.u_tex_y_b),u_mix:new v.Uniform1f(l,f.u_mix)}},raster:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_tl_parent:new v.Uniform2f(l,f.u_tl_parent),u_scale_parent:new v.Uniform1f(l,f.u_scale_parent),u_buffer_scale:new v.Uniform1f(l,f.u_buffer_scale),u_fade_t:new v.Uniform1f(l,f.u_fade_t),u_opacity:new v.Uniform1f(l,f.u_opacity),u_image0:new v.Uniform1i(l,f.u_image0),u_image1:new v.Uniform1i(l,f.u_image1),u_brightness_low:new v.Uniform1f(l,f.u_brightness_low),u_brightness_high:new v.Uniform1f(l,f.u_brightness_high),u_saturation_factor:new v.Uniform1f(l,f.u_saturation_factor),u_contrast_factor:new v.Uniform1f(l,f.u_contrast_factor),u_spin_weights:new v.Uniform3f(l,f.u_spin_weights)}},symbolIcon:function(l,f){return{u_is_size_zoom_constant:new v.Uniform1i(l,f.u_is_size_zoom_constant),u_is_size_feature_constant:new v.Uniform1i(l,f.u_is_size_feature_constant),u_size_t:new v.Uniform1f(l,f.u_size_t),u_size:new v.Uniform1f(l,f.u_size),u_camera_to_center_distance:new v.Uniform1f(l,f.u_camera_to_center_distance),u_pitch:new v.Uniform1f(l,f.u_pitch),u_rotate_symbol:new v.Uniform1i(l,f.u_rotate_symbol),u_aspect_ratio:new v.Uniform1f(l,f.u_aspect_ratio),u_fade_change:new v.Uniform1f(l,f.u_fade_change),u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_label_plane_matrix:new v.UniformMatrix4f(l,f.u_label_plane_matrix),u_coord_matrix:new v.UniformMatrix4f(l,f.u_coord_matrix),u_is_text:new v.Uniform1i(l,f.u_is_text),u_pitch_with_map:new v.Uniform1i(l,f.u_pitch_with_map),u_texsize:new v.Uniform2f(l,f.u_texsize),u_texture:new v.Uniform1i(l,f.u_texture)}},symbolSDF:function(l,f){return{u_is_size_zoom_constant:new v.Uniform1i(l,f.u_is_size_zoom_constant),u_is_size_feature_constant:new v.Uniform1i(l,f.u_is_size_feature_constant),u_size_t:new v.Uniform1f(l,f.u_size_t),u_size:new v.Uniform1f(l,f.u_size),u_camera_to_center_distance:new v.Uniform1f(l,f.u_camera_to_center_distance),u_pitch:new v.Uniform1f(l,f.u_pitch),u_rotate_symbol:new v.Uniform1i(l,f.u_rotate_symbol),u_aspect_ratio:new v.Uniform1f(l,f.u_aspect_ratio),u_fade_change:new v.Uniform1f(l,f.u_fade_change),u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_label_plane_matrix:new v.UniformMatrix4f(l,f.u_label_plane_matrix),u_coord_matrix:new v.UniformMatrix4f(l,f.u_coord_matrix),u_is_text:new v.Uniform1i(l,f.u_is_text),u_pitch_with_map:new v.Uniform1i(l,f.u_pitch_with_map),u_texsize:new v.Uniform2f(l,f.u_texsize),u_texture:new v.Uniform1i(l,f.u_texture),u_gamma_scale:new v.Uniform1f(l,f.u_gamma_scale),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_is_halo:new v.Uniform1i(l,f.u_is_halo)}},symbolTextAndIcon:function(l,f){return{u_is_size_zoom_constant:new v.Uniform1i(l,f.u_is_size_zoom_constant),u_is_size_feature_constant:new v.Uniform1i(l,f.u_is_size_feature_constant),u_size_t:new v.Uniform1f(l,f.u_size_t),u_size:new v.Uniform1f(l,f.u_size),u_camera_to_center_distance:new v.Uniform1f(l,f.u_camera_to_center_distance),u_pitch:new v.Uniform1f(l,f.u_pitch),u_rotate_symbol:new v.Uniform1i(l,f.u_rotate_symbol),u_aspect_ratio:new v.Uniform1f(l,f.u_aspect_ratio),u_fade_change:new v.Uniform1f(l,f.u_fade_change),u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_label_plane_matrix:new v.UniformMatrix4f(l,f.u_label_plane_matrix),u_coord_matrix:new v.UniformMatrix4f(l,f.u_coord_matrix),u_is_text:new v.Uniform1i(l,f.u_is_text),u_pitch_with_map:new v.Uniform1i(l,f.u_pitch_with_map),u_texsize:new v.Uniform2f(l,f.u_texsize),u_texsize_icon:new v.Uniform2f(l,f.u_texsize_icon),u_texture:new v.Uniform1i(l,f.u_texture),u_texture_icon:new v.Uniform1i(l,f.u_texture_icon),u_gamma_scale:new v.Uniform1f(l,f.u_gamma_scale),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_is_halo:new v.Uniform1i(l,f.u_is_halo)}},background:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_opacity:new v.Uniform1f(l,f.u_opacity),u_color:new v.UniformColor(l,f.u_color)}},backgroundPattern:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_opacity:new v.Uniform1f(l,f.u_opacity),u_image:new v.Uniform1i(l,f.u_image),u_pattern_tl_a:new v.Uniform2f(l,f.u_pattern_tl_a),u_pattern_br_a:new v.Uniform2f(l,f.u_pattern_br_a),u_pattern_tl_b:new v.Uniform2f(l,f.u_pattern_tl_b),u_pattern_br_b:new v.Uniform2f(l,f.u_pattern_br_b),u_texsize:new v.Uniform2f(l,f.u_texsize),u_mix:new v.Uniform1f(l,f.u_mix),u_pattern_size_a:new v.Uniform2f(l,f.u_pattern_size_a),u_pattern_size_b:new v.Uniform2f(l,f.u_pattern_size_b),u_scale_a:new v.Uniform1f(l,f.u_scale_a),u_scale_b:new v.Uniform1f(l,f.u_scale_b),u_pixel_coord_upper:new v.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(l,f.u_pixel_coord_lower),u_tile_units_to_pixels:new v.Uniform1f(l,f.u_tile_units_to_pixels)}}};function qu(l,f,c,d,E,C,T){for(var L=l.context,Z=L.gl,W=l.useProgram("collisionBox"),fe=[],he=0,de=0,Le=0;Le<d.length;Le++){var Re=d[Le],Be=f.getTile(Re),Ae=Be.getBucket(c);if(Ae){var Ve=Re.posMatrix;E[0]===0&&E[1]===0||(Ve=l.translatePosMatrix(Re.posMatrix,Be,E,C));var rt=T?Ae.textCollisionBox:Ae.iconCollisionBox,xt=Ae.collisionCircleArray;if(xt.length>0){var Wt=v.create(),Vt=Ve;v.mul(Wt,Ae.placementInvProjMatrix,l.transform.glCoordMatrix),v.mul(Wt,Wt,Ae.placementViewportMatrix),fe.push({circleArray:xt,circleOffset:de,transform:Vt,invTransform:Wt}),de=he+=xt.length/4}rt&&W.draw(L,Z.LINES,ge.disabled,Oe.disabled,l.colorModeForRenderPass(),nt.disabled,ho(Ve,l.transform,Be),c.id,rt.layoutVertexBuffer,rt.indexBuffer,rt.segments,null,l.transform.zoom,null,null,rt.collisionVertexBuffer)}}if(T&&fe.length){var Ot=l.useProgram("collisionCircle"),vr=new v.StructArrayLayout2f1f2i16;vr.resize(4*he),vr._trim();for(var Br=0,Dr=0,an=fe;Dr<an.length;Dr+=1)for(var Bn=an[Dr],kn=0;kn<Bn.circleArray.length/4;kn++){var Nn=4*kn,Bi=Bn.circleArray[Nn+0],on=Bn.circleArray[Nn+1],si=Bn.circleArray[Nn+2],hi=Bn.circleArray[Nn+3];vr.emplace(Br++,Bi,on,si,hi,0),vr.emplace(Br++,Bi,on,si,hi,1),vr.emplace(Br++,Bi,on,si,hi,2),vr.emplace(Br++,Bi,on,si,hi,3)}(!Hc||Hc.length<2*he)&&(Hc=function(eo){var bo=2*eo,To=new v.StructArrayLayout3ui6;To.resize(bo),To._trim();for(var to=0;to<bo;to++){var vo=6*to;To.uint16[vo+0]=4*to+0,To.uint16[vo+1]=4*to+1,To.uint16[vo+2]=4*to+2,To.uint16[vo+3]=4*to+2,To.uint16[vo+4]=4*to+3,To.uint16[vo+5]=4*to+0}return To}(he));for(var ri=L.createIndexBuffer(Hc,!0),Hn=L.createVertexBuffer(vr,v.collisionCircleLayout.members,!0),mi=0,Rn=fe;mi<Rn.length;mi+=1){var Wn=Rn[mi],Ha=Pf(Wn.transform,Wn.invTransform,l.transform);Ot.draw(L,Z.TRIANGLES,ge.disabled,Oe.disabled,l.colorModeForRenderPass(),nt.disabled,Ha,c.id,Hn,ri,v.SegmentVector.simpleSegment(0,2*Wn.circleOffset,Wn.circleArray.length,Wn.circleArray.length/2),null,l.transform.zoom,null,null,null)}Hn.destroy(),ri.destroy()}}var $s=v.identity(new Float32Array(16));function Wc(l,f,c,d,E,C){var T=v.getAnchorAlignment(l),L=-(T.horizontalAlign-.5)*f,Z=-(T.verticalAlign-.5)*c,W=v.evaluateVariableOffset(l,d);return new v.Point((L/E+W[0])*C,(Z/E+W[1])*C)}function Xc(l,f,c,d,E,C,T,L,Z,W,fe){var he=l.text.placedSymbolArray,de=l.text.dynamicLayoutVertexArray,Le=l.icon.dynamicLayoutVertexArray,Re={};de.clear();for(var Be=0;Be<he.length;Be++){var Ae=he.get(Be),Ve=Ae.hidden||!Ae.crossTileID||l.allowVerticalPlacement&&!Ae.placedOrientation?null:d[Ae.crossTileID];if(Ve){var rt=new v.Point(Ae.anchorX,Ae.anchorY),xt=Ri(rt,c?L:T),Wt=Gi(C.cameraToCenterDistance,xt.signedDistanceFromCamera),Vt=E.evaluateSizeForFeature(l.textSizeData,W,Ae)*Wt/v.ONE_EM;c&&(Vt*=l.tilePixelRatio/Z);for(var Ot=Wc(Ve.anchor,Ve.width,Ve.height,Ve.textOffset,Ve.textBoxScale,Vt),vr=c?Ri(rt.add(Ot),T).point:xt.point.add(f?Ot.rotate(-C.angle):Ot),Br=l.allowVerticalPlacement&&Ae.placedOrientation===v.WritingMode.vertical?Math.PI/2:0,Dr=0;Dr<Ae.numGlyphs;Dr++)v.addDynamicAttributes(de,vr,Br);fe&&Ae.associatedIconIndex>=0&&(Re[Ae.associatedIconIndex]={shiftedAnchor:vr,angle:Br})}else yo(Ae.numGlyphs,de)}if(fe){Le.clear();for(var an=l.icon.placedSymbolArray,Bn=0;Bn<an.length;Bn++){var kn=an.get(Bn);if(kn.hidden)yo(kn.numGlyphs,Le);else{var Nn=Re[Bn];if(Nn)for(var Bi=0;Bi<kn.numGlyphs;Bi++)v.addDynamicAttributes(Le,Nn.shiftedAnchor,Nn.angle);else yo(kn.numGlyphs,Le)}}l.icon.dynamicLayoutVertexBuffer.updateData(Le)}l.text.dynamicLayoutVertexBuffer.updateData(de)}function Yc(l,f,c){return c.iconsInText&&f?"symbolTextAndIcon":l?"symbolSDF":"symbolIcon"}function Ku(l,f,c,d,E,C,T,L,Z,W,fe,he){for(var de=l.context,Le=de.gl,Re=l.transform,Be=L==="map",Ae=Z==="map",Ve=Be&&c.layout.get("symbol-placement")!=="point",rt=Be&&!Ae&&!Ve,xt=c.layout.get("symbol-sort-key").constantOr(1)!==void 0,Wt=!1,Vt=l.depthModeForSublayer(0,ge.ReadOnly),Ot=c.layout.get("text-variable-anchor"),vr=[],Br=0,Dr=d;Br<Dr.length;Br+=1){var an=Dr[Br],Bn=f.getTile(an),kn=Bn.getBucket(c);if(kn){var Nn=E?kn.text:kn.icon;if(Nn&&Nn.segments.get().length){var Bi=Nn.programConfigurations.get(c.id),on=E||kn.sdfIcons,si=E?kn.textSizeData:kn.iconSizeData,hi=Ae||Re.pitch!==0,ri=l.useProgram(Yc(on,E,kn),Bi),Hn=v.evaluateSizeForZoom(si,Re.zoom),mi=void 0,Rn=[0,0],Wn=void 0,Ha=void 0,eo=null,bo=void 0;if(E)Wn=Bn.glyphAtlasTexture,Ha=Le.LINEAR,mi=Bn.glyphAtlasTexture.size,kn.iconsInText&&(Rn=Bn.imageAtlasTexture.size,eo=Bn.imageAtlasTexture,bo=hi||l.options.rotating||l.options.zooming||si.kind==="composite"||si.kind==="camera"?Le.LINEAR:Le.NEAREST);else{var To=c.layout.get("icon-size").constantOr(0)!==1||kn.iconsNeedLinear;Wn=Bn.imageAtlasTexture,Ha=on||l.options.rotating||l.options.zooming||To||hi?Le.LINEAR:Le.NEAREST,mi=Bn.imageAtlasTexture.size}var to=$i(Bn,1,l.transform.zoom),vo=Fa(an.posMatrix,Ae,Be,l.transform,to),Is=oa(an.posMatrix,Ae,Be,l.transform,to),gs=Ot&&kn.hasTextData(),Va=c.layout.get("icon-text-fit")!=="none"&&gs&&kn.hasIconData();Ve&&au(kn,an.posMatrix,l,E,vo,Is,Ae,W);var ca=l.translatePosMatrix(an.posMatrix,Bn,C,T),Os=Ve||E&&Ot||Va?$s:vo,Gs=l.translatePosMatrix(Is,Bn,C,T,!0),Eu=on&&c.paint.get(E?"text-halo-width":"icon-halo-width").constantOr(1)!==0,rc={program:ri,buffers:Nn,uniformValues:on?kn.iconsInText?Pu(si.kind,Hn,rt,Ae,l,ca,Os,Gs,mi,Rn):jo(si.kind,Hn,rt,Ae,l,ca,Os,Gs,E,mi,!0):dl(si.kind,Hn,rt,Ae,l,ca,Os,Gs,E,mi),atlasTexture:Wn,atlasTextureIcon:eo,atlasInterpolation:Ha,atlasInterpolationIcon:bo,isSDF:on,hasHalo:Eu};if(xt&&kn.canOverlap){Wt=!0;for(var tl=0,nc=Nn.segments.get();tl<nc.length;tl+=1){var Rc=nc[tl];vr.push({segments:new v.SegmentVector([Rc]),sortKey:Rc.sortKey,state:rc})}}else vr.push({segments:Nn.segments,sortKey:0,state:rc})}}}Wt&&vr.sort(function(Hs,Su){return Hs.sortKey-Su.sortKey});for(var tu=0,ys=vr;tu<ys.length;tu+=1){var ku=ys[tu],Fo=ku.state;if(de.activeTexture.set(Le.TEXTURE0),Fo.atlasTexture.bind(Fo.atlasInterpolation,Le.CLAMP_TO_EDGE),Fo.atlasTextureIcon&&(de.activeTexture.set(Le.TEXTURE1),Fo.atlasTextureIcon&&Fo.atlasTextureIcon.bind(Fo.atlasInterpolationIcon,Le.CLAMP_TO_EDGE)),Fo.isSDF){var rl=Fo.uniformValues;Fo.hasHalo&&(rl.u_is_halo=1,Yl(Fo.buffers,ku.segments,c,l,Fo.program,Vt,fe,he,rl)),rl.u_is_halo=0}Yl(Fo.buffers,ku.segments,c,l,Fo.program,Vt,fe,he,Fo.uniformValues)}}function Yl(l,f,c,d,E,C,T,L,Z){var W=d.context;E.draw(W,W.gl.TRIANGLES,C,T,L,nt.disabled,Z,c.id,l.layoutVertexBuffer,l.indexBuffer,f,c.paint,d.transform.zoom,l.programConfigurations.get(c.id),l.dynamicLayoutVertexBuffer,l.opacityVertexBuffer)}function Ac(l,f,c,d,E,C,T){var L,Z,W,fe,he,de=l.context.gl,Le=c.paint.get("fill-pattern"),Re=Le&&Le.constantOr(1),Be=c.getCrossfadeParameters();T?(Z=Re&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",L=de.LINES):(Z=Re?"fillPattern":"fill",L=de.TRIANGLES);for(var Ae=0,Ve=d;Ae<Ve.length;Ae+=1){var rt=Ve[Ae],xt=f.getTile(rt);if(!Re||xt.patternsLoaded()){var Wt=xt.getBucket(c);if(Wt){var Vt=Wt.programConfigurations.get(c.id),Ot=l.useProgram(Z,Vt);Re&&(l.context.activeTexture.set(de.TEXTURE0),xt.imageAtlasTexture.bind(de.LINEAR,de.CLAMP_TO_EDGE),Vt.updatePaintBuffers(Be));var vr=Le.constantOr(null);if(vr&&xt.imageAtlas){var Br=xt.imageAtlas,Dr=Br.patternPositions[vr.to.toString()],an=Br.patternPositions[vr.from.toString()];Dr&&an&&Vt.setConstantPatternPositions(Dr,an)}var Bn=l.translatePosMatrix(rt.posMatrix,xt,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(T){fe=Wt.indexBuffer2,he=Wt.segments2;var kn=[de.drawingBufferWidth,de.drawingBufferHeight];W=Z==="fillOutlinePattern"&&Re?uh(Bn,l,Be,xt,kn):va(Bn,kn)}else fe=Wt.indexBuffer,he=Wt.segments,W=Re?Ao(Bn,l,Be,xt):vu(Bn);Ot.draw(l.context,L,E,l.stencilModeForClipping(rt),C,nt.disabled,W,c.id,Wt.layoutVertexBuffer,fe,he,c.paint,l.transform.zoom,Vt)}}}}function qc(l,f,c,d,E,C,T){for(var L=l.context,Z=L.gl,W=c.paint.get("fill-extrusion-pattern"),fe=W.constantOr(1),he=c.getCrossfadeParameters(),de=c.paint.get("fill-extrusion-opacity"),Le=0,Re=d;Le<Re.length;Le+=1){var Be=Re[Le],Ae=f.getTile(Be),Ve=Ae.getBucket(c);if(Ve){var rt=Ve.programConfigurations.get(c.id),xt=l.useProgram(fe?"fillExtrusionPattern":"fillExtrusion",rt);fe&&(l.context.activeTexture.set(Z.TEXTURE0),Ae.imageAtlasTexture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE),rt.updatePaintBuffers(he));var Wt=W.constantOr(null);if(Wt&&Ae.imageAtlas){var Vt=Ae.imageAtlas,Ot=Vt.patternPositions[Wt.to.toString()],vr=Vt.patternPositions[Wt.from.toString()];Ot&&vr&&rt.setConstantPatternPositions(Ot,vr)}var Br=l.translatePosMatrix(Be.posMatrix,Ae,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),Dr=c.paint.get("fill-extrusion-vertical-gradient"),an=fe?Mu(Br,l,Dr,de,Be,he,Ae):Sc(Br,l,Dr,de);xt.draw(L,L.gl.TRIANGLES,E,C,T,nt.backCCW,an,c.id,Ve.layoutVertexBuffer,Ve.indexBuffer,Ve.segments,c.paint,l.transform.zoom,rt)}}}function wc(l,f,c,d,E,C){var T=l.context,L=T.gl,Z=f.fbo;if(Z){var W=l.useProgram("hillshade");T.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,Z.colorAttachment.get());var fe=function(he,de,Le){var Re=Le.paint.get("hillshade-shadow-color"),Be=Le.paint.get("hillshade-highlight-color"),Ae=Le.paint.get("hillshade-accent-color"),Ve=Le.paint.get("hillshade-illumination-direction")*(Math.PI/180);Le.paint.get("hillshade-illumination-anchor")==="viewport"&&(Ve-=he.transform.angle);var rt,xt,Wt,Vt=!he.options.moving;return{u_matrix:he.transform.calculatePosMatrix(de.tileID.toUnwrapped(),Vt),u_image:0,u_latrange:(rt=de.tileID,xt=Math.pow(2,rt.canonical.z),Wt=rt.canonical.y,[new v.MercatorCoordinate(0,Wt/xt).toLngLat().lat,new v.MercatorCoordinate(0,(Wt+1)/xt).toLngLat().lat]),u_light:[Le.paint.get("hillshade-exaggeration"),Ve],u_shadow:Re,u_highlight:Be,u_accent:Ae}}(l,f,c);W.draw(T,L.TRIANGLES,d,E,C,nt.disabled,fe,c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}}function hh(l,f,c,d,E,C){var T=l.context,L=T.gl,Z=f.dem;if(Z&&Z.data){var W=Z.dim,fe=Z.stride,he=Z.getPixels();if(T.activeTexture.set(L.TEXTURE1),T.pixelStoreUnpackPremultiplyAlpha.set(!1),f.demTexture=f.demTexture||l.getTileTexture(fe),f.demTexture){var de=f.demTexture;de.update(he,{premultiply:!1}),de.bind(L.NEAREST,L.CLAMP_TO_EDGE)}else f.demTexture=new v.Texture(T,he,L.RGBA,{premultiply:!1}),f.demTexture.bind(L.NEAREST,L.CLAMP_TO_EDGE);T.activeTexture.set(L.TEXTURE0);var Le=f.fbo;if(!Le){var Re=new v.Texture(T,{width:W,height:W,data:null},L.RGBA);Re.bind(L.LINEAR,L.CLAMP_TO_EDGE),(Le=f.fbo=T.createFramebuffer(W,W,!0)).colorAttachment.set(Re.texture)}T.bindFramebuffer.set(Le.framebuffer),T.viewport.set([0,0,W,W]),l.useProgram("hillshadePrepare").draw(T,L.TRIANGLES,d,E,C,nt.disabled,function(Be,Ae){var Ve=Ae.stride,rt=v.create();return v.ortho(rt,0,v.EXTENT,-v.EXTENT,0,0,1),v.translate(rt,rt,[0,-v.EXTENT,0]),{u_matrix:rt,u_image:1,u_dimension:[Ve,Ve],u_zoom:Be.overscaledZ,u_unpack:Ae.getUnpackVector()}}(f.tileID,Z),c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments),f.needsHillshadePrepare=!1}}function Tc(l,f,c,d,E){var C=d.paint.get("raster-fade-duration");if(C>0){var T=v.browser.now(),L=(T-l.timeAdded)/C,Z=f?(T-f.timeAdded)/C:-1,W=c.getSource(),fe=E.coveringZoomLevel({tileSize:W.tileSize,roundZoom:W.roundZoom}),he=!f||Math.abs(f.tileID.overscaledZ-fe)>Math.abs(l.tileID.overscaledZ-fe),de=he&&l.refreshedUponExpiration?1:v.clamp(he?L:1-Z,0,1);return l.refreshedUponExpiration&&L>=1&&(l.refreshedUponExpiration=!1),f?{opacity:1,mix:1-de}:{opacity:de,mix:0}}return{opacity:1,mix:0}}var vl=new v.Color(1,0,0,1),Kc=new v.Color(0,1,0,1),$c=new v.Color(0,0,1,1),Iu=new v.Color(1,0,1,1),Jc=new v.Color(0,1,1,1);function Of(l,f,c,d){Il(l,0,f+c/2,l.transform.width,c,d)}function ph(l,f,c,d){Il(l,f-c/2,0,c,l.transform.height,d)}function Il(l,f,c,d,E,C){var T=l.context,L=T.gl;L.enable(L.SCISSOR_TEST),L.scissor(f*v.browser.devicePixelRatio,c*v.browser.devicePixelRatio,d*v.browser.devicePixelRatio,E*v.browser.devicePixelRatio),T.clear({color:C}),L.disable(L.SCISSOR_TEST)}function Wh(l,f,c){var d=l.context,E=d.gl,C=c.posMatrix,T=l.useProgram("debug"),L=ge.disabled,Z=Oe.disabled,W=l.colorModeForRenderPass();d.activeTexture.set(E.TEXTURE0),l.emptyTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),T.draw(d,E.LINE_STRIP,L,Z,W,nt.disabled,mu(C,v.Color.red),"$debug",l.debugBuffer,l.tileBorderIndexBuffer,l.debugSegments);var fe=f.getTileByID(c.key).latestRawTileData,he=Math.floor((fe&&fe.byteLength||0)/1024),de=f.getTile(c).tileSize,Le=512/Math.min(de,512)*(c.overscaledZ/l.transform.zoom)*.5,Re=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(Re+=" => "+c.overscaledZ),function(Be,Ae){Be.initDebugOverlayCanvas();var Ve=Be.debugOverlayCanvas,rt=Be.context.gl,xt=Be.debugOverlayCanvas.getContext("2d");xt.clearRect(0,0,Ve.width,Ve.height),xt.shadowColor="white",xt.shadowBlur=2,xt.lineWidth=1.5,xt.strokeStyle="white",xt.textBaseline="top",xt.font="bold 36px Open Sans, sans-serif",xt.fillText(Ae,5,5),xt.strokeText(Ae,5,5),Be.debugOverlayTexture.update(Ve),Be.debugOverlayTexture.bind(rt.LINEAR,rt.CLAMP_TO_EDGE)}(l,Re+" "+he+"kb"),T.draw(d,E.TRIANGLES,L,Z,We.alphaBlended,nt.disabled,mu(C,v.Color.transparent,Le),"$debug",l.debugBuffer,l.quadTriangleIndexBuffer,l.debugSegments)}var is={symbol:function(l,f,c,d,E){if(l.renderPass==="translucent"){var C=Oe.disabled,T=l.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(L,Z,W,fe,he,de,Le){for(var Re=Z.transform,Be=he==="map",Ae=de==="map",Ve=0,rt=L;Ve<rt.length;Ve+=1){var xt=rt[Ve],Wt=fe.getTile(xt),Vt=Wt.getBucket(W);if(Vt&&Vt.text&&Vt.text.segments.get().length){var Ot=v.evaluateSizeForZoom(Vt.textSizeData,Re.zoom),vr=$i(Wt,1,Z.transform.zoom),Br=Fa(xt.posMatrix,Ae,Be,Z.transform,vr),Dr=W.layout.get("icon-text-fit")!=="none"&&Vt.hasIconData();if(Ot){var an=Math.pow(2,Re.zoom-Wt.tileID.overscaledZ);Xc(Vt,Be,Ae,Le,v.symbolSize,Re,Br,xt.posMatrix,an,Ot,Dr)}}}}(d,l,c,f,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),E),c.paint.get("icon-opacity").constantOr(1)!==0&&Ku(l,f,c,d,!1,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),c.layout.get("icon-rotation-alignment"),c.layout.get("icon-pitch-alignment"),c.layout.get("icon-keep-upright"),C,T),c.paint.get("text-opacity").constantOr(1)!==0&&Ku(l,f,c,d,!0,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),c.layout.get("text-keep-upright"),C,T),f.map.showCollisionBoxes&&(qu(l,f,c,d,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),qu(l,f,c,d,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))}},circle:function(l,f,c,d){if(l.renderPass==="translucent"){var E=c.paint.get("circle-opacity"),C=c.paint.get("circle-stroke-width"),T=c.paint.get("circle-stroke-opacity"),L=c.layout.get("circle-sort-key").constantOr(1)!==void 0;if(E.constantOr(1)!==0||C.constantOr(1)!==0&&T.constantOr(1)!==0){for(var Z=l.context,W=Z.gl,fe=l.depthModeForSublayer(0,ge.ReadOnly),he=Oe.disabled,de=l.colorModeForRenderPass(),Le=[],Re=0;Re<d.length;Re++){var Be=d[Re],Ae=f.getTile(Be),Ve=Ae.getBucket(c);if(Ve){var rt=Ve.programConfigurations.get(c.id),xt={programConfiguration:rt,program:l.useProgram("circle",rt),layoutVertexBuffer:Ve.layoutVertexBuffer,indexBuffer:Ve.indexBuffer,uniformValues:lh(l,Be,Ae,c)};if(L)for(var Wt=0,Vt=Ve.segments.get();Wt<Vt.length;Wt+=1){var Ot=Vt[Wt];Le.push({segments:new v.SegmentVector([Ot]),sortKey:Ot.sortKey,state:xt})}else Le.push({segments:Ve.segments,sortKey:0,state:xt})}}L&&Le.sort(function(Bn,kn){return Bn.sortKey-kn.sortKey});for(var vr=0,Br=Le;vr<Br.length;vr+=1){var Dr=Br[vr],an=Dr.state;an.program.draw(Z,W.TRIANGLES,fe,he,de,nt.disabled,an.uniformValues,c.id,an.layoutVertexBuffer,an.indexBuffer,Dr.segments,c.paint,l.transform.zoom,an.programConfiguration)}}}},heatmap:function(l,f,c,d){if(c.paint.get("heatmap-opacity")!==0)if(l.renderPass==="offscreen"){var E=l.context,C=E.gl,T=Oe.disabled,L=new We([C.ONE,C.ONE],v.Color.transparent,[!0,!0,!0,!0]);(function(Le,Re,Be){var Ae=Le.gl;Le.activeTexture.set(Ae.TEXTURE1),Le.viewport.set([0,0,Re.width/4,Re.height/4]);var Ve=Be.heatmapFbo;if(Ve)Ae.bindTexture(Ae.TEXTURE_2D,Ve.colorAttachment.get()),Le.bindFramebuffer.set(Ve.framebuffer);else{var rt=Ae.createTexture();Ae.bindTexture(Ae.TEXTURE_2D,rt),Ae.texParameteri(Ae.TEXTURE_2D,Ae.TEXTURE_WRAP_S,Ae.CLAMP_TO_EDGE),Ae.texParameteri(Ae.TEXTURE_2D,Ae.TEXTURE_WRAP_T,Ae.CLAMP_TO_EDGE),Ae.texParameteri(Ae.TEXTURE_2D,Ae.TEXTURE_MIN_FILTER,Ae.LINEAR),Ae.texParameteri(Ae.TEXTURE_2D,Ae.TEXTURE_MAG_FILTER,Ae.LINEAR),Ve=Be.heatmapFbo=Le.createFramebuffer(Re.width/4,Re.height/4,!1),function(xt,Wt,Vt,Ot){var vr=xt.gl;vr.texImage2D(vr.TEXTURE_2D,0,vr.RGBA,Wt.width/4,Wt.height/4,0,vr.RGBA,xt.extRenderToTextureHalfFloat?xt.extTextureHalfFloat.HALF_FLOAT_OES:vr.UNSIGNED_BYTE,null),Ot.colorAttachment.set(Vt)}(Le,Re,rt,Ve)}})(E,l,c),E.clear({color:v.Color.transparent});for(var Z=0;Z<d.length;Z++){var W=d[Z];if(!f.hasRenderableParent(W)){var fe=f.getTile(W),he=fe.getBucket(c);if(he){var de=he.programConfigurations.get(c.id);l.useProgram("heatmap",de).draw(E,C.TRIANGLES,ge.disabled,T,L,nt.disabled,Cc(W.posMatrix,fe,l.transform.zoom,c.paint.get("heatmap-intensity")),c.id,he.layoutVertexBuffer,he.indexBuffer,he.segments,c.paint,l.transform.zoom,de)}}}E.viewport.set([0,0,l.width,l.height])}else l.renderPass==="translucent"&&(l.context.setColorMode(l.colorModeForRenderPass()),function(Le,Re){var Be=Le.context,Ae=Be.gl,Ve=Re.heatmapFbo;if(Ve){Be.activeTexture.set(Ae.TEXTURE0),Ae.bindTexture(Ae.TEXTURE_2D,Ve.colorAttachment.get()),Be.activeTexture.set(Ae.TEXTURE1);var rt=Re.colorRampTexture;rt||(rt=Re.colorRampTexture=new v.Texture(Be,Re.colorRamp,Ae.RGBA)),rt.bind(Ae.LINEAR,Ae.CLAMP_TO_EDGE),Le.useProgram("heatmapTexture").draw(Be,Ae.TRIANGLES,ge.disabled,Oe.disabled,Le.colorModeForRenderPass(),nt.disabled,function(xt,Wt,Vt,Ot){var vr=v.create();v.ortho(vr,0,xt.width,xt.height,0,0,1);var Br=xt.context.gl;return{u_matrix:vr,u_world:[Br.drawingBufferWidth,Br.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:Wt.paint.get("heatmap-opacity")}}(Le,Re),Re.id,Le.viewportBuffer,Le.quadTriangleIndexBuffer,Le.viewportSegments,Re.paint,Le.transform.zoom)}}(l,c))},line:function(l,f,c,d){if(l.renderPass==="translucent"){var E=c.paint.get("line-opacity"),C=c.paint.get("line-width");if(E.constantOr(1)!==0&&C.constantOr(1)!==0)for(var T=l.depthModeForSublayer(0,ge.ReadOnly),L=l.colorModeForRenderPass(),Z=c.paint.get("line-dasharray"),W=c.paint.get("line-pattern"),fe=W.constantOr(1),he=c.paint.get("line-gradient"),de=c.getCrossfadeParameters(),Le=fe?"linePattern":Z?"lineSDF":he?"lineGradient":"line",Re=l.context,Be=Re.gl,Ae=!0,Ve=0,rt=d;Ve<rt.length;Ve+=1){var xt=rt[Ve],Wt=f.getTile(xt);if(!fe||Wt.patternsLoaded()){var Vt=Wt.getBucket(c);if(Vt){var Ot=Vt.programConfigurations.get(c.id),vr=l.context.program.get(),Br=l.useProgram(Le,Ot),Dr=Ae||Br.program!==vr,an=W.constantOr(null);if(an&&Wt.imageAtlas){var Bn=Wt.imageAtlas,kn=Bn.patternPositions[an.to.toString()],Nn=Bn.patternPositions[an.from.toString()];kn&&Nn&&Ot.setConstantPatternPositions(kn,Nn)}var Bi=fe?Ml(l,Wt,c,de):Z?Xl(l,Wt,c,Z,de):he?Ca(l,Wt,c,Vt.lineClipsArray.length):pl(l,Wt,c);if(fe)Re.activeTexture.set(Be.TEXTURE0),Wt.imageAtlasTexture.bind(Be.LINEAR,Be.CLAMP_TO_EDGE),Ot.updatePaintBuffers(de);else if(Z&&(Dr||l.lineAtlas.dirty))Re.activeTexture.set(Be.TEXTURE0),l.lineAtlas.bind(Re);else if(he){var on=Vt.gradients[c.id],si=on.texture;if(c.gradientVersion!==on.version){var hi=256;if(c.stepInterpolant){var ri=f.getSource().maxzoom,Hn=xt.canonical.z===ri?Math.ceil(1<<l.transform.maxZoom-xt.canonical.z):1;hi=v.clamp(v.nextPowerOfTwo(Vt.maxLineLength/v.EXTENT*1024*Hn),256,Re.maxTextureSize)}on.gradient=v.renderColorRamp({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:hi,image:on.gradient||void 0,clips:Vt.lineClipsArray}),on.texture?on.texture.update(on.gradient):on.texture=new v.Texture(Re,on.gradient,Be.RGBA),on.version=c.gradientVersion,si=on.texture}Re.activeTexture.set(Be.TEXTURE0),si.bind(c.stepInterpolant?Be.NEAREST:Be.LINEAR,Be.CLAMP_TO_EDGE)}Br.draw(Re,Be.TRIANGLES,T,l.stencilModeForClipping(xt),L,nt.disabled,Bi,c.id,Vt.layoutVertexBuffer,Vt.indexBuffer,Vt.segments,c.paint,l.transform.zoom,Ot,Vt.layoutVertexBuffer2),Ae=!1}}}}},fill:function(l,f,c,d){var E=c.paint.get("fill-color"),C=c.paint.get("fill-opacity");if(C.constantOr(1)!==0){var T=l.colorModeForRenderPass(),L=c.paint.get("fill-pattern"),Z=l.opaquePassEnabledForLayer()&&!L.constantOr(1)&&E.constantOr(v.Color.transparent).a===1&&C.constantOr(0)===1?"opaque":"translucent";if(l.renderPass===Z){var W=l.depthModeForSublayer(1,l.renderPass==="opaque"?ge.ReadWrite:ge.ReadOnly);Ac(l,f,c,d,W,T,!1)}if(l.renderPass==="translucent"&&c.paint.get("fill-antialias")){var fe=l.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,ge.ReadOnly);Ac(l,f,c,d,fe,T,!0)}}},"fill-extrusion":function(l,f,c,d){var E=c.paint.get("fill-extrusion-opacity");if(E!==0&&l.renderPass==="translucent"){var C=new ge(l.context.gl.LEQUAL,ge.ReadWrite,l.depthRangeFor3D);if(E!==1||c.paint.get("fill-extrusion-pattern").constantOr(1))qc(l,f,c,d,C,Oe.disabled,We.disabled),qc(l,f,c,d,C,l.stencilModeFor3D(),l.colorModeForRenderPass());else{var T=l.colorModeForRenderPass();qc(l,f,c,d,C,Oe.disabled,T)}}},hillshade:function(l,f,c,d){if(l.renderPass==="offscreen"||l.renderPass==="translucent"){for(var E=l.context,C=l.depthModeForSublayer(0,ge.ReadOnly),T=l.colorModeForRenderPass(),L=l.renderPass==="translucent"?l.stencilConfigForOverlap(d):[{},d],Z=L[0],W=0,fe=L[1];W<fe.length;W+=1){var he=fe[W],de=f.getTile(he);de.needsHillshadePrepare&&l.renderPass==="offscreen"?hh(l,de,c,C,Oe.disabled,T):l.renderPass==="translucent"&&wc(l,de,c,C,Z[he.overscaledZ],T)}E.viewport.set([0,0,l.width,l.height])}},raster:function(l,f,c,d){if(l.renderPass==="translucent"&&c.paint.get("raster-opacity")!==0&&d.length)for(var E=l.context,C=E.gl,T=f.getSource(),L=l.useProgram("raster"),Z=l.colorModeForRenderPass(),W=T instanceof gt?[{},d]:l.stencilConfigForOverlap(d),fe=W[0],he=W[1],de=he[he.length-1].overscaledZ,Le=!l.options.moving,Re=0,Be=he;Re<Be.length;Re+=1){var Ae=Be[Re],Ve=l.depthModeForSublayer(Ae.overscaledZ-de,c.paint.get("raster-opacity")===1?ge.ReadWrite:ge.ReadOnly,C.LESS),rt=f.getTile(Ae),xt=l.transform.calculatePosMatrix(Ae.toUnwrapped(),Le);rt.registerFadeDuration(c.paint.get("raster-fade-duration"));var Wt=f.findLoadedParent(Ae,0),Vt=Tc(rt,Wt,f,c,l.transform),Ot=void 0,vr=void 0,Br=c.paint.get("raster-resampling")==="nearest"?C.NEAREST:C.LINEAR;E.activeTexture.set(C.TEXTURE0),rt.texture.bind(Br,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST),E.activeTexture.set(C.TEXTURE1),Wt?(Wt.texture.bind(Br,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST),Ot=Math.pow(2,Wt.tileID.overscaledZ-rt.tileID.overscaledZ),vr=[rt.tileID.canonical.x*Ot%1,rt.tileID.canonical.y*Ot%1]):rt.texture.bind(Br,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST);var Dr=ch(xt,vr||[0,0],Ot||1,Vt,c);T instanceof gt?L.draw(E,C.TRIANGLES,Ve,Oe.disabled,Z,nt.disabled,Dr,c.id,T.boundsBuffer,l.quadTriangleIndexBuffer,T.boundsSegments):L.draw(E,C.TRIANGLES,Ve,fe[Ae.overscaledZ],Z,nt.disabled,Dr,c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}},background:function(l,f,c){var d=c.paint.get("background-color"),E=c.paint.get("background-opacity");if(E!==0){var C=l.context,T=C.gl,L=l.transform,Z=L.tileSize,W=c.paint.get("background-pattern");if(!l.isPatternMissing(W)){var fe=!W&&d.a===1&&E===1&&l.opaquePassEnabledForLayer()?"opaque":"translucent";if(l.renderPass===fe){var he=Oe.disabled,de=l.depthModeForSublayer(0,fe==="opaque"?ge.ReadWrite:ge.ReadOnly),Le=l.colorModeForRenderPass(),Re=l.useProgram(W?"backgroundPattern":"background"),Be=L.coveringTiles({tileSize:Z});W&&(C.activeTexture.set(T.TEXTURE0),l.imageManager.bind(l.context));for(var Ae=c.getCrossfadeParameters(),Ve=0,rt=Be;Ve<rt.length;Ve+=1){var xt=rt[Ve],Wt=l.transform.calculatePosMatrix(xt.toUnwrapped()),Vt=W?Vo(Wt,E,l,W,{tileID:xt,tileSize:Z},Ae):Yu(Wt,E,d);Re.draw(C,T.TRIANGLES,de,he,Le,nt.disabled,Vt,c.id,l.tileExtentBuffer,l.quadTriangleIndexBuffer,l.tileExtentSegments)}}}}},debug:function(l,f,c){for(var d=0;d<c.length;d++)Wh(l,f,c[d])},custom:function(l,f,c){var d=l.context,E=c.implementation;if(l.renderPass==="offscreen"){var C=E.prerender;C&&(l.setCustomLayerDefaults(),d.setColorMode(l.colorModeForRenderPass()),C.call(E,d.gl,l.transform.customLayerMatrix()),d.setDirty(),l.setBaseState())}else if(l.renderPass==="translucent"){l.setCustomLayerDefaults(),d.setColorMode(l.colorModeForRenderPass()),d.setStencilMode(Oe.disabled);var T=E.renderingMode==="3d"?new ge(l.context.gl.LEQUAL,ge.ReadWrite,l.depthRangeFor3D):l.depthModeForSublayer(0,ge.ReadOnly);d.setDepthMode(T),E.render(d.gl,l.transform.customLayerMatrix()),d.setDirty(),l.setBaseState(),d.bindFramebuffer.set(null)}}},qa=function(l,f){this.context=new pe(l),this.transform=f,this._tileTextures={},this.setup(),this.numSublayers=Fe.maxUnderzooming+Fe.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Yt,this.gpuTimers={}};qa.prototype.resize=function(l,f){if(this.width=l*v.browser.devicePixelRatio,this.height=f*v.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var c=0,d=this.style._order;c<d.length;c+=1)this.style._layers[d[c]].resize()},qa.prototype.setup=function(){var l=this.context,f=new v.StructArrayLayout2i4;f.emplaceBack(0,0),f.emplaceBack(v.EXTENT,0),f.emplaceBack(0,v.EXTENT),f.emplaceBack(v.EXTENT,v.EXTENT),this.tileExtentBuffer=l.createVertexBuffer(f,sa.members),this.tileExtentSegments=v.SegmentVector.simpleSegment(0,0,4,2);var c=new v.StructArrayLayout2i4;c.emplaceBack(0,0),c.emplaceBack(v.EXTENT,0),c.emplaceBack(0,v.EXTENT),c.emplaceBack(v.EXTENT,v.EXTENT),this.debugBuffer=l.createVertexBuffer(c,sa.members),this.debugSegments=v.SegmentVector.simpleSegment(0,0,4,5);var d=new v.StructArrayLayout4i8;d.emplaceBack(0,0,0,0),d.emplaceBack(v.EXTENT,0,v.EXTENT,0),d.emplaceBack(0,v.EXTENT,0,v.EXTENT),d.emplaceBack(v.EXTENT,v.EXTENT,v.EXTENT,v.EXTENT),this.rasterBoundsBuffer=l.createVertexBuffer(d,wt.members),this.rasterBoundsSegments=v.SegmentVector.simpleSegment(0,0,4,2);var E=new v.StructArrayLayout2i4;E.emplaceBack(0,0),E.emplaceBack(1,0),E.emplaceBack(0,1),E.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(E,sa.members),this.viewportSegments=v.SegmentVector.simpleSegment(0,0,4,2);var C=new v.StructArrayLayout1ui2;C.emplaceBack(0),C.emplaceBack(1),C.emplaceBack(3),C.emplaceBack(2),C.emplaceBack(0),this.tileBorderIndexBuffer=l.createIndexBuffer(C);var T=new v.StructArrayLayout3ui6;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(T),this.emptyTexture=new v.Texture(l,{width:1,height:1,data:new Uint8Array([0,0,0,0])},l.gl.RGBA);var L=this.context.gl;this.stencilClearMode=new Oe({func:L.ALWAYS,mask:0},0,255,L.ZERO,L.ZERO,L.ZERO)},qa.prototype.clearStencil=function(){var l=this.context,f=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var c=v.create();v.ortho(c,0,this.width,this.height,0,0,1),v.scale(c,c,[f.drawingBufferWidth,f.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(l,f.TRIANGLES,ge.disabled,this.stencilClearMode,We.disabled,nt.disabled,Fs(c),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},qa.prototype._renderTileClippingMasks=function(l,f){if(this.currentStencilSource!==l.source&&l.isTileClipped()&&f&&f.length){this.currentStencilSource=l.source;var c=this.context,d=c.gl;this.nextStencilID+f.length>256&&this.clearStencil(),c.setColorMode(We.disabled),c.setDepthMode(ge.disabled);var E=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var C=0,T=f;C<T.length;C+=1){var L=T[C],Z=this._tileClippingMaskIDs[L.key]=this.nextStencilID++;E.draw(c,d.TRIANGLES,ge.disabled,new Oe({func:d.ALWAYS,mask:0},Z,255,d.KEEP,d.KEEP,d.REPLACE),We.disabled,nt.disabled,Fs(L.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},qa.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var l=this.nextStencilID++,f=this.context.gl;return new Oe({func:f.NOTEQUAL,mask:255},l,255,f.KEEP,f.KEEP,f.REPLACE)},qa.prototype.stencilModeForClipping=function(l){var f=this.context.gl;return new Oe({func:f.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,f.KEEP,f.KEEP,f.REPLACE)},qa.prototype.stencilConfigForOverlap=function(l){var f,c=this.context.gl,d=l.sort(function(Z,W){return W.overscaledZ-Z.overscaledZ}),E=d[d.length-1].overscaledZ,C=d[0].overscaledZ-E+1;if(C>1){this.currentStencilSource=void 0,this.nextStencilID+C>256&&this.clearStencil();for(var T={},L=0;L<C;L++)T[L+E]=new Oe({func:c.GEQUAL,mask:255},L+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=C,[T,d]}return[(f={},f[E]=Oe.disabled,f),d]},qa.prototype.colorModeForRenderPass=function(){var l=this.context.gl;return this._showOverdrawInspector?new We([l.CONSTANT_COLOR,l.ONE],new v.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?We.unblended:We.alphaBlended},qa.prototype.depthModeForSublayer=function(l,f,c){if(!this.opaquePassEnabledForLayer())return ge.disabled;var d=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new ge(c||this.context.gl.LEQUAL,f,[d,d])},qa.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},qa.prototype.render=function(l,f){var c=this;this.style=l,this.options=f,this.lineAtlas=l.lineAtlas,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(v.browser.now()),this.imageManager.beginFrame();var d=this.style._order,E=this.style.sourceCaches;for(var C in E){var T=E[C];T.used&&T.prepare(this.context)}var L,Z,W={},fe={},he={};for(var de in E){var Le=E[de];W[de]=Le.getVisibleCoordinates(),fe[de]=W[de].slice().reverse(),he[de]=Le.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var Re=0;Re<d.length;Re++)if(this.style._layers[d[Re]].is3D()){this.opaquePassCutoff=Re;break}this.renderPass="offscreen";for(var Be=0,Ae=d;Be<Ae.length;Be+=1){var Ve=this.style._layers[Ae[Be]];if(Ve.hasOffscreenPass()&&!Ve.isHidden(this.transform.zoom)){var rt=fe[Ve.source];(Ve.type==="custom"||rt.length)&&this.renderLayer(this,E[Ve.source],Ve,rt)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:f.showOverdrawInspector?v.Color.black:v.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=f.showOverdrawInspector,this.depthRangeFor3D=[0,1-(l._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=d.length-1;this.currentLayer>=0;this.currentLayer--){var xt=this.style._layers[d[this.currentLayer]],Wt=E[xt.source],Vt=W[xt.source];this._renderTileClippingMasks(xt,Vt),this.renderLayer(this,Wt,xt,Vt)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<d.length;this.currentLayer++){var Ot=this.style._layers[d[this.currentLayer]],vr=E[Ot.source],Br=(Ot.type==="symbol"?he:fe)[Ot.source];this._renderTileClippingMasks(Ot,W[Ot.source]),this.renderLayer(this,vr,Ot,Br)}this.options.showTileBoundaries&&(v.values(this.style._layers).forEach(function(Dr){Dr.source&&!Dr.isHidden(c.transform.zoom)&&(Dr.source!==(Z&&Z.id)&&(Z=c.style.sourceCaches[Dr.source]),(!L||L.getSource().maxzoom<Z.getSource().maxzoom)&&(L=Z))}),L&&is.debug(this,L,L.getVisibleCoordinates())),this.options.showPadding&&function(Dr){var an=Dr.transform.padding;Of(Dr,Dr.transform.height-(an.top||0),3,vl),Of(Dr,an.bottom||0,3,Kc),ph(Dr,an.left||0,3,$c),ph(Dr,Dr.transform.width-(an.right||0),3,Iu);var Bn=Dr.transform.centerPoint;(function(kn,Nn,Bi,on){Il(kn,Nn-1,Bi-10,2,20,on),Il(kn,Nn-10,Bi-1,20,2,on)})(Dr,Bn.x,Dr.transform.height-Bn.y,Jc)}(this),this.context.setDefault()},qa.prototype.renderLayer=function(l,f,c,d){c.isHidden(this.transform.zoom)||(c.type==="background"||c.type==="custom"||d.length)&&(this.id=c.id,this.gpuTimingStart(c),is[c.type](l,f,c,d,this.style.placement.variableOffsets),this.gpuTimingEnd())},qa.prototype.gpuTimingStart=function(l){if(this.options.gpuTiming){var f=this.context.extTimerQuery,c=this.gpuTimers[l.id];c||(c=this.gpuTimers[l.id]={calls:0,cpuTime:0,query:f.createQueryEXT()}),c.calls++,f.beginQueryEXT(f.TIME_ELAPSED_EXT,c.query)}},qa.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var l=this.context.extTimerQuery;l.endQueryEXT(l.TIME_ELAPSED_EXT)}},qa.prototype.collectGpuTimers=function(){var l=this.gpuTimers;return this.gpuTimers={},l},qa.prototype.queryGpuTimers=function(l){var f={};for(var c in l){var d=l[c],E=this.context.extTimerQuery,C=E.getQueryObjectEXT(d.query,E.QUERY_RESULT_EXT)/1e6;E.deleteQueryEXT(d.query),f[c]=C}return f},qa.prototype.translatePosMatrix=function(l,f,c,d,E){if(!c[0]&&!c[1])return l;var C=E?d==="map"?this.transform.angle:0:d==="viewport"?-this.transform.angle:0;if(C){var T=Math.sin(C),L=Math.cos(C);c=[c[0]*L-c[1]*T,c[0]*T+c[1]*L]}var Z=[E?c[0]:$i(f,c[0],this.transform.zoom),E?c[1]:$i(f,c[1],this.transform.zoom),0],W=new Float32Array(16);return v.translate(W,l,Z),W},qa.prototype.saveTileTexture=function(l){var f=this._tileTextures[l.size[0]];f?f.push(l):this._tileTextures[l.size[0]]=[l]},qa.prototype.getTileTexture=function(l){var f=this._tileTextures[l];return f&&f.length>0?f.pop():null},qa.prototype.isPatternMissing=function(l){if(!l)return!1;if(!l.from||!l.to)return!0;var f=this.imageManager.getPattern(l.from.toString()),c=this.imageManager.getPattern(l.to.toString());return!f||!c},qa.prototype.useProgram=function(l,f){this.cache=this.cache||{};var c=""+l+(f?f.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[c]||(this.cache[c]=new Gc(this.context,l,Lo[l],f,Pl[l],this._showOverdrawInspector)),this.cache[c]},qa.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},qa.prototype.setBaseState=function(){var l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)},qa.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=v.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new v.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},qa.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var ql=function(l,f){this.points=l,this.planes=f};ql.fromInvProjectionMatrix=function(l,f,c){var d=Math.pow(2,c),E=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(T){return v.transformMat4([],T,l)}).map(function(T){return v.scale$1([],T,1/T[3]/f*d)}),C=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(T){var L=v.sub([],E[T[0]],E[T[1]]),Z=v.sub([],E[T[2]],E[T[1]]),W=v.normalize([],v.cross([],L,Z)),fe=-v.dot(W,E[T[1]]);return W.concat(fe)});return new ql(E,C)};var Ol=function(l,f){this.min=l,this.max=f,this.center=v.scale$2([],v.add([],this.min,this.max),.5)};Ol.prototype.quadrant=function(l){for(var f=[l%2==0,l<2],c=v.clone$2(this.min),d=v.clone$2(this.max),E=0;E<f.length;E++)c[E]=f[E]?this.min[E]:this.center[E],d[E]=f[E]?this.center[E]:this.max[E];return d[2]=this.max[2],new Ol(c,d)},Ol.prototype.distanceX=function(l){return Math.max(Math.min(this.max[0],l[0]),this.min[0])-l[0]},Ol.prototype.distanceY=function(l){return Math.max(Math.min(this.max[1],l[1]),this.min[1])-l[1]},Ol.prototype.intersects=function(l){for(var f=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],c=!0,d=0;d<l.planes.length;d++){for(var E=l.planes[d],C=0,T=0;T<f.length;T++)C+=v.dot$1(E,f[T])>=0;if(C===0)return 0;C!==f.length&&(c=!1)}if(c)return 2;for(var L=0;L<3;L++){for(var Z=Number.MAX_VALUE,W=-Number.MAX_VALUE,fe=0;fe<l.points.length;fe++){var he=l.points[fe][L]-this.min[L];Z=Math.min(Z,he),W=Math.max(W,he)}if(W<0||Z>this.max[L]-this.min[L])return 0}return 1};var lu=function(l,f,c,d){if(l===void 0&&(l=0),f===void 0&&(f=0),c===void 0&&(c=0),d===void 0&&(d=0),isNaN(l)||l<0||isNaN(f)||f<0||isNaN(c)||c<0||isNaN(d)||d<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=f,this.left=c,this.right=d};lu.prototype.interpolate=function(l,f,c){return f.top!=null&&l.top!=null&&(this.top=v.number(l.top,f.top,c)),f.bottom!=null&&l.bottom!=null&&(this.bottom=v.number(l.bottom,f.bottom,c)),f.left!=null&&l.left!=null&&(this.left=v.number(l.left,f.left,c)),f.right!=null&&l.right!=null&&(this.right=v.number(l.right,f.right,c)),this},lu.prototype.getCenter=function(l,f){var c=v.clamp((this.left+l-this.right)/2,0,l),d=v.clamp((this.top+f-this.bottom)/2,0,f);return new v.Point(c,d)},lu.prototype.equals=function(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right},lu.prototype.clone=function(){return new lu(this.top,this.bottom,this.left,this.right)},lu.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var Fi=function(l,f,c,d,E){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=E===void 0||E,this._minZoom=l||0,this._maxZoom=f||22,this._minPitch=c==null?0:c,this._maxPitch=d==null?60:d,this.setMaxBounds(),this.width=0,this.height=0,this._center=new v.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new lu,this._posMatrixCache={},this._alignedPosMatrixCache={}},Ba={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};Fi.prototype.clone=function(){var l=new Fi(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return l.tileSize=this.tileSize,l.latRange=this.latRange,l.width=this.width,l.height=this.height,l._center=this._center,l.zoom=this.zoom,l.angle=this.angle,l._fov=this._fov,l._pitch=this._pitch,l._unmodified=this._unmodified,l._edgeInsets=this._edgeInsets.clone(),l._calcMatrices(),l},Ba.minZoom.get=function(){return this._minZoom},Ba.minZoom.set=function(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))},Ba.maxZoom.get=function(){return this._maxZoom},Ba.maxZoom.set=function(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))},Ba.minPitch.get=function(){return this._minPitch},Ba.minPitch.set=function(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))},Ba.maxPitch.get=function(){return this._maxPitch},Ba.maxPitch.set=function(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))},Ba.renderWorldCopies.get=function(){return this._renderWorldCopies},Ba.renderWorldCopies.set=function(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l},Ba.worldSize.get=function(){return this.tileSize*this.scale},Ba.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Ba.size.get=function(){return new v.Point(this.width,this.height)},Ba.bearing.get=function(){return-this.angle/Math.PI*180},Ba.bearing.set=function(l){var f=-v.wrap(l,-180,180)*Math.PI/180;this.angle!==f&&(this._unmodified=!1,this.angle=f,this._calcMatrices(),this.rotationMatrix=v.create$2(),v.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Ba.pitch.get=function(){return this._pitch/Math.PI*180},Ba.pitch.set=function(l){var f=v.clamp(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==f&&(this._unmodified=!1,this._pitch=f,this._calcMatrices())},Ba.fov.get=function(){return this._fov/Math.PI*180},Ba.fov.set=function(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=l/180*Math.PI,this._calcMatrices())},Ba.zoom.get=function(){return this._zoom},Ba.zoom.set=function(l){var f=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==f&&(this._unmodified=!1,this._zoom=f,this.scale=this.zoomScale(f),this.tileZoom=Math.floor(f),this.zoomFraction=f-this.tileZoom,this._constrain(),this._calcMatrices())},Ba.center.get=function(){return this._center},Ba.center.set=function(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._constrain(),this._calcMatrices())},Ba.padding.get=function(){return this._edgeInsets.toJSON()},Ba.padding.set=function(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())},Ba.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},Fi.prototype.isPaddingEqual=function(l){return this._edgeInsets.equals(l)},Fi.prototype.interpolatePadding=function(l,f,c){this._unmodified=!1,this._edgeInsets.interpolate(l,f,c),this._constrain(),this._calcMatrices()},Fi.prototype.coveringZoomLevel=function(l){var f=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,f)},Fi.prototype.getVisibleUnwrappedCoordinates=function(l){var f=[new v.UnwrappedTileID(0,l)];if(this._renderWorldCopies)for(var c=this.pointCoordinate(new v.Point(0,0)),d=this.pointCoordinate(new v.Point(this.width,0)),E=this.pointCoordinate(new v.Point(this.width,this.height)),C=this.pointCoordinate(new v.Point(0,this.height)),T=Math.floor(Math.min(c.x,d.x,E.x,C.x)),L=Math.floor(Math.max(c.x,d.x,E.x,C.x)),Z=T-1;Z<=L+1;Z++)Z!==0&&f.push(new v.UnwrappedTileID(Z,l));return f},Fi.prototype.coveringTiles=function(l){var f=this.coveringZoomLevel(l),c=f;if(l.minzoom!==void 0&&f<l.minzoom)return[];l.maxzoom!==void 0&&f>l.maxzoom&&(f=l.maxzoom);var d=v.MercatorCoordinate.fromLngLat(this.center),E=Math.pow(2,f),C=[E*d.x,E*d.y,0],T=ql.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,f),L=l.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(L=f);var Z=function(Dr){return{aabb:new Ol([Dr*E,0,0],[(Dr+1)*E,E,0]),zoom:0,x:0,y:0,wrap:Dr,fullyVisible:!1}},W=[],fe=[],he=f,de=l.reparseOverscaled?c:f;if(this._renderWorldCopies)for(var Le=1;Le<=3;Le++)W.push(Z(-Le)),W.push(Z(Le));for(W.push(Z(0));W.length>0;){var Re=W.pop(),Be=Re.x,Ae=Re.y,Ve=Re.fullyVisible;if(!Ve){var rt=Re.aabb.intersects(T);if(rt===0)continue;Ve=rt===2}var xt=Re.aabb.distanceX(C),Wt=Re.aabb.distanceY(C),Vt=Math.max(Math.abs(xt),Math.abs(Wt));if(Re.zoom===he||Vt>3+(1<<he-Re.zoom)-2&&Re.zoom>=L)fe.push({tileID:new v.OverscaledTileID(Re.zoom===he?de:Re.zoom,Re.wrap,Re.zoom,Be,Ae),distanceSq:v.sqrLen([C[0]-.5-Be,C[1]-.5-Ae])});else for(var Ot=0;Ot<4;Ot++){var vr=(Be<<1)+Ot%2,Br=(Ae<<1)+(Ot>>1);W.push({aabb:Re.aabb.quadrant(Ot),zoom:Re.zoom+1,x:vr,y:Br,wrap:Re.wrap,fullyVisible:Ve})}}return fe.sort(function(Dr,an){return Dr.distanceSq-an.distanceSq}).map(function(Dr){return Dr.tileID})},Fi.prototype.resize=function(l,f){this.width=l,this.height=f,this.pixelsToGLUnits=[2/l,-2/f],this._constrain(),this._calcMatrices()},Ba.unmodified.get=function(){return this._unmodified},Fi.prototype.zoomScale=function(l){return Math.pow(2,l)},Fi.prototype.scaleZoom=function(l){return Math.log(l)/Math.LN2},Fi.prototype.project=function(l){var f=v.clamp(l.lat,-this.maxValidLatitude,this.maxValidLatitude);return new v.Point(v.mercatorXfromLng(l.lng)*this.worldSize,v.mercatorYfromLat(f)*this.worldSize)},Fi.prototype.unproject=function(l){return new v.MercatorCoordinate(l.x/this.worldSize,l.y/this.worldSize).toLngLat()},Ba.point.get=function(){return this.project(this.center)},Fi.prototype.setLocationAtPoint=function(l,f){var c=this.pointCoordinate(f),d=this.pointCoordinate(this.centerPoint),E=this.locationCoordinate(l),C=new v.MercatorCoordinate(E.x-(c.x-d.x),E.y-(c.y-d.y));this.center=this.coordinateLocation(C),this._renderWorldCopies&&(this.center=this.center.wrap())},Fi.prototype.locationPoint=function(l){return this.coordinatePoint(this.locationCoordinate(l))},Fi.prototype.pointLocation=function(l){return this.coordinateLocation(this.pointCoordinate(l))},Fi.prototype.locationCoordinate=function(l){return v.MercatorCoordinate.fromLngLat(l)},Fi.prototype.coordinateLocation=function(l){return l.toLngLat()},Fi.prototype.pointCoordinate=function(l){var f=[l.x,l.y,0,1],c=[l.x,l.y,1,1];v.transformMat4(f,f,this.pixelMatrixInverse),v.transformMat4(c,c,this.pixelMatrixInverse);var d=f[3],E=c[3],C=f[1]/d,T=c[1]/E,L=f[2]/d,Z=c[2]/E,W=L===Z?0:(0-L)/(Z-L);return new v.MercatorCoordinate(v.number(f[0]/d,c[0]/E,W)/this.worldSize,v.number(C,T,W)/this.worldSize)},Fi.prototype.coordinatePoint=function(l){var f=[l.x*this.worldSize,l.y*this.worldSize,0,1];return v.transformMat4(f,f,this.pixelMatrix),new v.Point(f[0]/f[3],f[1]/f[3])},Fi.prototype.getBounds=function(){return new v.LngLatBounds().extend(this.pointLocation(new v.Point(0,0))).extend(this.pointLocation(new v.Point(this.width,0))).extend(this.pointLocation(new v.Point(this.width,this.height))).extend(this.pointLocation(new v.Point(0,this.height)))},Fi.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new v.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},Fi.prototype.setMaxBounds=function(l){l?(this.lngRange=[l.getWest(),l.getEast()],this.latRange=[l.getSouth(),l.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},Fi.prototype.calculatePosMatrix=function(l,f){f===void 0&&(f=!1);var c=l.key,d=f?this._alignedPosMatrixCache:this._posMatrixCache;if(d[c])return d[c];var E=l.canonical,C=this.worldSize/this.zoomScale(E.z),T=E.x+Math.pow(2,E.z)*l.wrap,L=v.identity(new Float64Array(16));return v.translate(L,L,[T*C,E.y*C,0]),v.scale(L,L,[C/v.EXTENT,C/v.EXTENT,1]),v.multiply(L,f?this.alignedProjMatrix:this.projMatrix,L),d[c]=new Float32Array(L),d[c]},Fi.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},Fi.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var l,f,c,d,E=-90,C=90,T=-180,L=180,Z=this.size,W=this._unmodified;if(this.latRange){var fe=this.latRange;E=v.mercatorYfromLat(fe[1])*this.worldSize,l=(C=v.mercatorYfromLat(fe[0])*this.worldSize)-E<Z.y?Z.y/(C-E):0}if(this.lngRange){var he=this.lngRange;T=v.mercatorXfromLng(he[0])*this.worldSize,f=(L=v.mercatorXfromLng(he[1])*this.worldSize)-T<Z.x?Z.x/(L-T):0}var de=this.point,Le=Math.max(f||0,l||0);if(Le)return this.center=this.unproject(new v.Point(f?(L+T)/2:de.x,l?(C+E)/2:de.y)),this.zoom+=this.scaleZoom(Le),this._unmodified=W,void(this._constraining=!1);if(this.latRange){var Re=de.y,Be=Z.y/2;Re-Be<E&&(d=E+Be),Re+Be>C&&(d=C-Be)}if(this.lngRange){var Ae=de.x,Ve=Z.x/2;Ae-Ve<T&&(c=T+Ve),Ae+Ve>L&&(c=L-Ve)}c===void 0&&d===void 0||(this.center=this.unproject(new v.Point(c!==void 0?c:de.x,d!==void 0?d:de.y))),this._unmodified=W,this._constraining=!1}},Fi.prototype._calcMatrices=function(){if(this.height){var l=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var f=Math.PI/2+this._pitch,c=this._fov*(.5+l.y/this.height),d=Math.sin(c)*this.cameraToCenterDistance/Math.sin(v.clamp(Math.PI-f-c,.01,Math.PI-.01)),E=this.point,C=E.x,T=E.y,L=1.01*(Math.cos(Math.PI/2-this._pitch)*d+this.cameraToCenterDistance),Z=this.height/50,W=new Float64Array(16);v.perspective(W,this._fov,this.width/this.height,Z,L),W[8]=2*-l.x/this.width,W[9]=2*l.y/this.height,v.scale(W,W,[1,-1,1]),v.translate(W,W,[0,0,-this.cameraToCenterDistance]),v.rotateX(W,W,this._pitch),v.rotateZ(W,W,this.angle),v.translate(W,W,[-C,-T,0]),this.mercatorMatrix=v.scale([],W,[this.worldSize,this.worldSize,this.worldSize]),v.scale(W,W,[1,1,v.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=W,this.invProjMatrix=v.invert([],this.projMatrix);var fe=this.width%2/2,he=this.height%2/2,de=Math.cos(this.angle),Le=Math.sin(this.angle),Re=C-Math.round(C)+de*fe+Le*he,Be=T-Math.round(T)+de*he+Le*fe,Ae=new Float64Array(W);if(v.translate(Ae,Ae,[Re>.5?Re-1:Re,Be>.5?Be-1:Be,0]),this.alignedProjMatrix=Ae,W=v.create(),v.scale(W,W,[this.width/2,-this.height/2,1]),v.translate(W,W,[1,-1,0]),this.labelPlaneMatrix=W,W=v.create(),v.scale(W,W,[1,-1,1]),v.translate(W,W,[-1,-1,0]),v.scale(W,W,[2/this.width,2/this.height,1]),this.glCoordMatrix=W,this.pixelMatrix=v.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(W=v.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=W,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Fi.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var l=this.pointCoordinate(new v.Point(0,0)),f=[l.x*this.worldSize,l.y*this.worldSize,0,1];return v.transformMat4(f,f,this.pixelMatrix)[3]/this.cameraToCenterDistance},Fi.prototype.getCameraPoint=function(){var l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new v.Point(0,l))},Fi.prototype.getCameraQueryGeometry=function(l){var f=this.getCameraPoint();if(l.length===1)return[l[0],f];for(var c=f.x,d=f.y,E=f.x,C=f.y,T=0,L=l;T<L.length;T+=1){var Z=L[T];c=Math.min(c,Z.x),d=Math.min(d,Z.y),E=Math.max(E,Z.x),C=Math.max(C,Z.y)}return[new v.Point(c,d),new v.Point(E,d),new v.Point(E,C),new v.Point(c,C),new v.Point(c,d)]},Object.defineProperties(Fi.prototype,Ba);var Bs=function(l){var f,c,d,E;this._hashName=l&&encodeURIComponent(l),v.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(f=this._updateHashUnthrottled.bind(this),c=!1,d=null,E=function(){d=null,c&&(f(),d=setTimeout(E,300),c=!1)},function(){return c=!0,d||E(),d})};Bs.prototype.addTo=function(l){return this._map=l,v.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Bs.prototype.remove=function(){return v.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Bs.prototype.getHashString=function(l){var f=this._map.getCenter(),c=Math.round(100*this._map.getZoom())/100,d=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),E=Math.pow(10,d),C=Math.round(f.lng*E)/E,T=Math.round(f.lat*E)/E,L=this._map.getBearing(),Z=this._map.getPitch(),W="";if(W+=l?"/"+C+"/"+T+"/"+c:c+"/"+T+"/"+C,(L||Z)&&(W+="/"+Math.round(10*L)/10),Z&&(W+="/"+Math.round(Z)),this._hashName){var fe=this._hashName,he=!1,de=v.window.location.hash.slice(1).split("&").map(function(Le){var Re=Le.split("=")[0];return Re===fe?(he=!0,Re+"="+W):Le}).filter(function(Le){return Le});return he||de.push(fe+"="+W),"#"+de.join("&")}return"#"+W},Bs.prototype._getCurrentHash=function(){var l,f=this,c=v.window.location.hash.replace("#","");return this._hashName?(c.split("&").map(function(d){return d.split("=")}).forEach(function(d){d[0]===f._hashName&&(l=d)}),(l&&l[1]||"").split("/")):c.split("/")},Bs.prototype._onHashChange=function(){var l=this._getCurrentHash();if(l.length>=3&&!l.some(function(c){return isNaN(c)})){var f=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(l[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:f,pitch:+(l[4]||0)}),!0}return!1},Bs.prototype._updateHashUnthrottled=function(){var l=v.window.location.href.replace(/(#.+)?$/,this.getHashString());try{v.window.history.replaceState(v.window.history.state,null,l)}catch(f){}};var Qc={linearity:.3,easing:v.bezier(0,0,.3,1)},ml=v.extend({deceleration:2500,maxSpeed:1400},Qc),ef=v.extend({deceleration:20,maxSpeed:1400},Qc),Xh=v.extend({deceleration:1e3,maxSpeed:360},Qc),Yh=v.extend({deceleration:1e3,maxSpeed:90},Qc),Mc=function(l){this._map=l,this.clear()};function Kl(l,f){(!l.duration||l.duration<f.duration)&&(l.duration=f.duration,l.easing=f.easing)}function $u(l,f,c){var d=c.maxSpeed,E=c.linearity,C=c.deceleration,T=v.clamp(l*E/(f/1e3),-d,d),L=Math.abs(T)/(C*E);return{easing:c.easing,duration:1e3*L,amount:T*(L/2)}}Mc.prototype.clear=function(){this._inertiaBuffer=[]},Mc.prototype.record=function(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:v.browser.now(),settings:l})},Mc.prototype._drainInertiaBuffer=function(){for(var l=this._inertiaBuffer,f=v.browser.now();l.length>0&&f-l[0].time>160;)l.shift()},Mc.prototype._onMoveEnd=function(l){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var f={zoom:0,bearing:0,pitch:0,pan:new v.Point(0,0),pinchAround:void 0,around:void 0},c=0,d=this._inertiaBuffer;c<d.length;c+=1){var E=d[c].settings;f.zoom+=E.zoomDelta||0,f.bearing+=E.bearingDelta||0,f.pitch+=E.pitchDelta||0,E.panDelta&&f.pan._add(E.panDelta),E.around&&(f.around=E.around),E.pinchAround&&(f.pinchAround=E.pinchAround)}var C=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,T={};if(f.pan.mag()){var L=$u(f.pan.mag(),C,v.extend({},ml,l||{}));T.offset=f.pan.mult(L.amount/f.pan.mag()),T.center=this._map.transform.center,Kl(T,L)}if(f.zoom){var Z=$u(f.zoom,C,ef);T.zoom=this._map.transform.zoom+Z.amount,Kl(T,Z)}if(f.bearing){var W=$u(f.bearing,C,Xh);T.bearing=this._map.transform.bearing+v.clamp(W.amount,-179,179),Kl(T,W)}if(f.pitch){var fe=$u(f.pitch,C,Yh);T.pitch=this._map.transform.pitch+fe.amount,Kl(T,fe)}if(T.zoom||T.bearing){var he=f.pinchAround===void 0?f.around:f.pinchAround;T.around=he?this._map.unproject(he):this._map.getCenter()}return this.clear(),v.extend(T,{noMoveStart:!0})}};var ko=function(l){function f(d,E,C,T){T===void 0&&(T={});var L=B.mousePos(E.getCanvasContainer(),C),Z=E.unproject(L);l.call(this,d,v.extend({point:L,lngLat:Z,originalEvent:C},T)),this._defaultPrevented=!1,this.target=E}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,c),f}(v.Event),$l=function(l){function f(d,E,C){var T=d==="touchend"?C.changedTouches:C.touches,L=B.touchPos(E.getCanvasContainer(),T),Z=L.map(function(he){return E.unproject(he)}),W=L.reduce(function(he,de,Le,Re){return he.add(de.div(Re.length))},new v.Point(0,0)),fe=E.unproject(W);l.call(this,d,{points:L,point:W,lngLats:Z,lngLat:fe,originalEvent:C}),this._defaultPrevented=!1}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,c),f}(v.Event),Jl=function(l){function f(d,E,C){l.call(this,d,{originalEvent:C}),this._defaultPrevented=!1}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,c),f}(v.Event),Qa=function(l,f){this._map=l,this._clickTolerance=f.clickTolerance};Qa.prototype.reset=function(){delete this._mousedownPos},Qa.prototype.wheel=function(l){return this._firePreventable(new Jl(l.type,this._map,l))},Qa.prototype.mousedown=function(l,f){return this._mousedownPos=f,this._firePreventable(new ko(l.type,this._map,l))},Qa.prototype.mouseup=function(l){this._map.fire(new ko(l.type,this._map,l))},Qa.prototype.click=function(l,f){this._mousedownPos&&this._mousedownPos.dist(f)>=this._clickTolerance||this._map.fire(new ko(l.type,this._map,l))},Qa.prototype.dblclick=function(l){return this._firePreventable(new ko(l.type,this._map,l))},Qa.prototype.mouseover=function(l){this._map.fire(new ko(l.type,this._map,l))},Qa.prototype.mouseout=function(l){this._map.fire(new ko(l.type,this._map,l))},Qa.prototype.touchstart=function(l){return this._firePreventable(new $l(l.type,this._map,l))},Qa.prototype.touchmove=function(l){this._map.fire(new $l(l.type,this._map,l))},Qa.prototype.touchend=function(l){this._map.fire(new $l(l.type,this._map,l))},Qa.prototype.touchcancel=function(l){this._map.fire(new $l(l.type,this._map,l))},Qa.prototype._firePreventable=function(l){if(this._map.fire(l),l.defaultPrevented)return{}},Qa.prototype.isEnabled=function(){return!0},Qa.prototype.isActive=function(){return!1},Qa.prototype.enable=function(){},Qa.prototype.disable=function(){};var yn=function(l){this._map=l};yn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},yn.prototype.mousemove=function(l){this._map.fire(new ko(l.type,this._map,l))},yn.prototype.mousedown=function(){this._delayContextMenu=!0},yn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ko("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},yn.prototype.contextmenu=function(l){this._delayContextMenu?this._contextMenuEvent=l:this._map.fire(new ko(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()},yn.prototype.isEnabled=function(){return!0},yn.prototype.isActive=function(){return!1},yn.prototype.enable=function(){},yn.prototype.disable=function(){};var lo=function(l,f){this._map=l,this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=f.clickTolerance||1};function Ju(l,f){for(var c={},d=0;d<l.length;d++)c[l[d].identifier]=f[d];return c}lo.prototype.isEnabled=function(){return!!this._enabled},lo.prototype.isActive=function(){return!!this._active},lo.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},lo.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},lo.prototype.mousedown=function(l,f){this.isEnabled()&&l.shiftKey&&l.button===0&&(B.disableDrag(),this._startPos=this._lastPos=f,this._active=!0)},lo.prototype.mousemoveWindow=function(l,f){if(this._active){var c=f;if(!(this._lastPos.equals(c)||!this._box&&c.dist(this._startPos)<this._clickTolerance)){var d=this._startPos;this._lastPos=c,this._box||(this._box=B.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",l));var E=Math.min(d.x,c.x),C=Math.max(d.x,c.x),T=Math.min(d.y,c.y),L=Math.max(d.y,c.y);B.setTransform(this._box,"translate("+E+"px,"+T+"px)"),this._box.style.width=C-E+"px",this._box.style.height=L-T+"px"}}},lo.prototype.mouseupWindow=function(l,f){var c=this;if(this._active&&l.button===0){var d=this._startPos,E=f;if(this.reset(),B.suppressClick(),d.x!==E.x||d.y!==E.y)return this._map.fire(new v.Event("boxzoomend",{originalEvent:l})),{cameraAnimation:function(C){return C.fitScreenCoordinates(d,E,c._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",l)}},lo.prototype.keydown=function(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))},lo.prototype.blur=function(){this.reset()},lo.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(B.remove(this._box),this._box=null),B.enableDrag(),delete this._startPos,delete this._lastPos},lo.prototype._fireEvent=function(l,f){return this._map.fire(new v.Event(l,{originalEvent:f}))};var Qu=function(l){this.reset(),this.numTouches=l.numTouches};Qu.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},Qu.prototype.touchstart=function(l,f,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=l.timeStamp),c.length===this.numTouches&&(this.centroid=function(d){for(var E=new v.Point(0,0),C=0,T=d;C<T.length;C+=1)E._add(T[C]);return E.div(d.length)}(f),this.touches=Ju(c,f)))},Qu.prototype.touchmove=function(l,f,c){if(!this.aborted&&this.centroid){var d=Ju(c,f);for(var E in this.touches){var C=d[E];(!C||C.dist(this.touches[E])>30)&&(this.aborted=!0)}}},Qu.prototype.touchend=function(l,f,c){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){var d=!this.aborted&&this.centroid;if(this.reset(),d)return d}};var gu=function(l){this.singleTap=new Qu(l),this.numTaps=l.numTaps,this.reset()};gu.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},gu.prototype.touchstart=function(l,f,c){this.singleTap.touchstart(l,f,c)},gu.prototype.touchmove=function(l,f,c){this.singleTap.touchmove(l,f,c)},gu.prototype.touchend=function(l,f,c){var d=this.singleTap.touchend(l,f,c);if(d){var E=l.timeStamp-this.lastTime<500,C=!this.lastTap||this.lastTap.dist(d)<30;if(E&&C||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=d,this.count===this.numTaps)return this.reset(),d}};var Ns=function(){this._zoomIn=new gu({numTouches:1,numTaps:2}),this._zoomOut=new gu({numTouches:2,numTaps:1}),this.reset()};Ns.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},Ns.prototype.touchstart=function(l,f,c){this._zoomIn.touchstart(l,f,c),this._zoomOut.touchstart(l,f,c)},Ns.prototype.touchmove=function(l,f,c){this._zoomIn.touchmove(l,f,c),this._zoomOut.touchmove(l,f,c)},Ns.prototype.touchend=function(l,f,c){var d=this,E=this._zoomIn.touchend(l,f,c),C=this._zoomOut.touchend(l,f,c);return E?(this._active=!0,l.preventDefault(),setTimeout(function(){return d.reset()},0),{cameraAnimation:function(T){return T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(E)},{originalEvent:l})}}):C?(this._active=!0,l.preventDefault(),setTimeout(function(){return d.reset()},0),{cameraAnimation:function(T){return T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(C)},{originalEvent:l})}}):void 0},Ns.prototype.touchcancel=function(){this.reset()},Ns.prototype.enable=function(){this._enabled=!0},Ns.prototype.disable=function(){this._enabled=!1,this.reset()},Ns.prototype.isEnabled=function(){return this._enabled},Ns.prototype.isActive=function(){return this._active};var Rf={0:1,2:2},Kr=function(l){this.reset(),this._clickTolerance=l.clickTolerance||1};Kr.prototype.blur=function(){this.reset()},Kr.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},Kr.prototype._correctButton=function(l,f){return!1},Kr.prototype._move=function(l,f){return{}},Kr.prototype.mousedown=function(l,f){if(!this._lastPoint){var c=B.mouseButton(l);this._correctButton(l,c)&&(this._lastPoint=f,this._eventButton=c)}},Kr.prototype.mousemoveWindow=function(l,f){var c=this._lastPoint;if(c){if(l.preventDefault(),function(d,E){var C=Rf[E];return d.buttons===void 0||(d.buttons&C)!==C}(l,this._eventButton))this.reset();else if(this._moved||!(f.dist(c)<this._clickTolerance))return this._moved=!0,this._lastPoint=f,this._move(c,f)}},Kr.prototype.mouseupWindow=function(l){this._lastPoint&&B.mouseButton(l)===this._eventButton&&(this._moved&&B.suppressClick(),this.reset())},Kr.prototype.enable=function(){this._enabled=!0},Kr.prototype.disable=function(){this._enabled=!1,this.reset()},Kr.prototype.isEnabled=function(){return this._enabled},Kr.prototype.isActive=function(){return this._active};var tf=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.mousedown=function(c,d){l.prototype.mousedown.call(this,c,d),this._lastPoint&&(this._active=!0)},f.prototype._correctButton=function(c,d){return d===0&&!c.ctrlKey},f.prototype._move=function(c,d){return{around:d,panDelta:d.sub(c)}},f}(Kr),Lf=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype._correctButton=function(c,d){return d===0&&c.ctrlKey||d===2},f.prototype._move=function(c,d){var E=.8*(d.x-c.x);if(E)return this._active=!0,{bearingDelta:E}},f.prototype.contextmenu=function(c){c.preventDefault()},f}(Kr),Ou=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype._correctButton=function(c,d){return d===0&&c.ctrlKey||d===2},f.prototype._move=function(c,d){var E=-.5*(d.y-c.y);if(E)return this._active=!0,{pitchDelta:E}},f.prototype.contextmenu=function(c){c.preventDefault()},f}(Kr),Ga=function(l){this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset()};Ga.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new v.Point(0,0)},Ga.prototype.touchstart=function(l,f,c){return this._calculateTransform(l,f,c)},Ga.prototype.touchmove=function(l,f,c){if(this._active&&!(c.length<this._minTouches))return l.preventDefault(),this._calculateTransform(l,f,c)},Ga.prototype.touchend=function(l,f,c){this._calculateTransform(l,f,c),this._active&&c.length<this._minTouches&&this.reset()},Ga.prototype.touchcancel=function(){this.reset()},Ga.prototype._calculateTransform=function(l,f,c){c.length>0&&(this._active=!0);var d=Ju(c,f),E=new v.Point(0,0),C=new v.Point(0,0),T=0;for(var L in d){var Z=d[L],W=this._touches[L];W&&(E._add(Z),C._add(Z.sub(W)),T++,d[L]=Z)}if(this._touches=d,!(T<this._minTouches)&&C.mag()){var fe=C.div(T);if(this._sum._add(fe),!(this._sum.mag()<this._clickTolerance))return{around:E.div(T),panDelta:fe}}},Ga.prototype.enable=function(){this._enabled=!0},Ga.prototype.disable=function(){this._enabled=!1,this.reset()},Ga.prototype.isEnabled=function(){return this._enabled},Ga.prototype.isActive=function(){return this._active};var zs=function(){this.reset()};function rf(l,f,c){for(var d=0;d<l.length;d++)if(l[d].identifier===c)return f[d]}function Ru(l,f){return Math.log(l/f)/Math.LN2}zs.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},zs.prototype._start=function(l){},zs.prototype._move=function(l,f,c){return{}},zs.prototype.touchstart=function(l,f,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([f[0],f[1]]))},zs.prototype.touchmove=function(l,f,c){if(this._firstTwoTouches){l.preventDefault();var d=this._firstTwoTouches,E=d[1],C=rf(c,f,d[0]),T=rf(c,f,E);if(C&&T){var L=this._aroundCenter?null:C.add(T).div(2);return this._move([C,T],L,l)}}},zs.prototype.touchend=function(l,f,c){if(this._firstTwoTouches){var d=this._firstTwoTouches,E=d[1],C=rf(c,f,d[0]),T=rf(c,f,E);C&&T||(this._active&&B.suppressClick(),this.reset())}},zs.prototype.touchcancel=function(){this.reset()},zs.prototype.enable=function(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"},zs.prototype.disable=function(){this._enabled=!1,this.reset()},zs.prototype.isEnabled=function(){return this._enabled},zs.prototype.isActive=function(){return this._active};var Ms=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.reset=function(){l.prototype.reset.call(this),delete this._distance,delete this._startDistance},f.prototype._start=function(c){this._startDistance=this._distance=c[0].dist(c[1])},f.prototype._move=function(c,d){var E=this._distance;if(this._distance=c[0].dist(c[1]),this._active||!(Math.abs(Ru(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ru(this._distance,E),pinchAround:d}},f}(zs);function wo(l,f){return 180*l.angleWith(f)/Math.PI}var dh=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.reset=function(){l.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},f.prototype._start=function(c){this._startVector=this._vector=c[0].sub(c[1]),this._minDiameter=c[0].dist(c[1])},f.prototype._move=function(c,d){var E=this._vector;if(this._vector=c[0].sub(c[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:wo(this._vector,E),pinchAround:d}},f.prototype._isBelowThreshold=function(c){this._minDiameter=Math.min(this._minDiameter,c.mag());var d=25/(Math.PI*this._minDiameter)*360,E=wo(c,this._startVector);return Math.abs(E)<d},f}(zs);function ba(l){return Math.abs(l.y)>Math.abs(l.x)}var kf=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.reset=function(){l.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},f.prototype._start=function(c){this._lastPoints=c,ba(c[0].sub(c[1]))&&(this._valid=!1)},f.prototype._move=function(c,d,E){var C=c[0].sub(this._lastPoints[0]),T=c[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(C,T,E.timeStamp),this._valid)return this._lastPoints=c,this._active=!0,{pitchDelta:(C.y+T.y)/2*-.5}},f.prototype.gestureBeginsVertically=function(c,d,E){if(this._valid!==void 0)return this._valid;var C=c.mag()>=2,T=d.mag()>=2;if(C||T){if(!C||!T)return this._firstMove===void 0&&(this._firstMove=E),E-this._firstMove<100&&void 0;var L=c.y>0==d.y>0;return ba(c)&&ba(d)&&L}},f}(zs),vh={panStep:100,bearingStep:15,pitchStep:10},Js=function(){var l=vh;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1};function Ps(l){return l*(2-l)}Js.prototype.blur=function(){this.reset()},Js.prototype.reset=function(){this._active=!1},Js.prototype.keydown=function(l){var f=this;if(!(l.altKey||l.ctrlKey||l.metaKey)){var c=0,d=0,E=0,C=0,T=0;switch(l.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:l.shiftKey?d=-1:(l.preventDefault(),C=-1);break;case 39:l.shiftKey?d=1:(l.preventDefault(),C=1);break;case 38:l.shiftKey?E=1:(l.preventDefault(),T=-1);break;case 40:l.shiftKey?E=-1:(l.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(d=0,E=0),{cameraAnimation:function(L){var Z=L.getZoom();L.easeTo({duration:300,easeId:"keyboardHandler",easing:Ps,zoom:c?Math.round(Z)+c*(l.shiftKey?2:1):Z,bearing:L.getBearing()+d*f._bearingStep,pitch:L.getPitch()+E*f._pitchStep,offset:[-C*f._panStep,-T*f._panStep],center:L.getCenter()},{originalEvent:l})}}}},Js.prototype.enable=function(){this._enabled=!0},Js.prototype.disable=function(){this._enabled=!1,this.reset()},Js.prototype.isEnabled=function(){return this._enabled},Js.prototype.isActive=function(){return this._active},Js.prototype.disableRotation=function(){this._rotationDisabled=!0},Js.prototype.enableRotation=function(){this._rotationDisabled=!1};var Li=function(l,f){this._map=l,this._el=l.getCanvasContainer(),this._handler=f,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,v.bindAll(["_onTimeout"],this)};Li.prototype.setZoomRate=function(l){this._defaultZoomRate=l},Li.prototype.setWheelZoomRate=function(l){this._wheelZoomRate=l},Li.prototype.isEnabled=function(){return!!this._enabled},Li.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},Li.prototype.isZooming=function(){return!!this._zooming},Li.prototype.enable=function(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=l&&l.around==="center")},Li.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Li.prototype.wheel=function(l){if(this.isEnabled()){var f=l.deltaMode===v.window.WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY,c=v.browser.now(),d=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,f!==0&&f%4.000244140625==0?this._type="wheel":f!==0&&Math.abs(f)<4?this._type="trackpad":d>400?(this._type=null,this._lastValue=f,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(d*f)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,f+=this._lastValue)),l.shiftKey&&f&&(f/=4),this._type&&(this._lastWheelEvent=l,this._delta-=f,this._active||this._start(l)),l.preventDefault()}},Li.prototype._onTimeout=function(l){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},Li.prototype._start=function(l){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var f=B.mousePos(this._el,l);this._around=v.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(f)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},Li.prototype.renderFrame=function(){var l=this;if(this._frameId&&(this._frameId=null,this.isActive())){var f=this._map.transform;if(this._delta!==0){var c=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,d=2/(1+Math.exp(-Math.abs(this._delta*c)));this._delta<0&&d!==0&&(d=1/d);var E=typeof this._targetZoom=="number"?f.zoomScale(this._targetZoom):f.scale;this._targetZoom=Math.min(f.maxZoom,Math.max(f.minZoom,f.scaleZoom(E*d))),this._type==="wheel"&&(this._startZoom=f.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var C,T=typeof this._targetZoom=="number"?this._targetZoom:f.zoom,L=this._startZoom,Z=this._easing,W=!1;if(this._type==="wheel"&&L&&Z){var fe=Math.min((v.browser.now()-this._lastWheelEventTime)/200,1),he=Z(fe);C=v.number(L,T,he),fe<1?this._frameId||(this._frameId=!0):W=!0}else C=T,W=!0;return this._active=!0,W&&(this._active=!1,this._finishTimeout=setTimeout(function(){l._zooming=!1,l._handler._triggerRenderFrame(),delete l._targetZoom,delete l._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!W,zoomDelta:C-f.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},Li.prototype._smoothOutEasing=function(l){var f=v.ease;if(this._prevEase){var c=this._prevEase,d=(v.browser.now()-c.start)/c.duration,E=c.easing(d+.01)-c.easing(d),C=.27/Math.sqrt(E*E+1e-4)*.01,T=Math.sqrt(.0729-C*C);f=v.bezier(C,T,.25,1)}return this._prevEase={start:v.browser.now(),duration:l,easing:f},f},Li.prototype.blur=function(){this.reset()},Li.prototype.reset=function(){this._active=!1};var yu=function(l,f){this._clickZoom=l,this._tapZoom=f};yu.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},yu.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},yu.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},yu.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var ma=function(){this.reset()};ma.prototype.reset=function(){this._active=!1},ma.prototype.blur=function(){this.reset()},ma.prototype.dblclick=function(l,f){return l.preventDefault(),{cameraAnimation:function(c){c.easeTo({duration:300,zoom:c.getZoom()+(l.shiftKey?-1:1),around:c.unproject(f)},{originalEvent:l})}}},ma.prototype.enable=function(){this._enabled=!0},ma.prototype.disable=function(){this._enabled=!1,this.reset()},ma.prototype.isEnabled=function(){return this._enabled},ma.prototype.isActive=function(){return this._active};var po=function(){this._tap=new gu({numTouches:1,numTaps:1}),this.reset()};po.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},po.prototype.touchstart=function(l,f,c){this._swipePoint||(this._tapTime&&l.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?c.length>0&&(this._swipePoint=f[0],this._swipeTouch=c[0].identifier):this._tap.touchstart(l,f,c))},po.prototype.touchmove=function(l,f,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;var d=f[0],E=d.y-this._swipePoint.y;return this._swipePoint=d,l.preventDefault(),this._active=!0,{zoomDelta:E/128}}}else this._tap.touchmove(l,f,c)},po.prototype.touchend=function(l,f,c){this._tapTime?this._swipePoint&&c.length===0&&this.reset():this._tap.touchend(l,f,c)&&(this._tapTime=l.timeStamp)},po.prototype.touchcancel=function(){this.reset()},po.prototype.enable=function(){this._enabled=!0},po.prototype.disable=function(){this._enabled=!1,this.reset()},po.prototype.isEnabled=function(){return this._enabled},po.prototype.isActive=function(){return this._active};var Us=function(l,f,c){this._el=l,this._mousePan=f,this._touchPan=c};Us.prototype.enable=function(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},Us.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},Us.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},Us.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var cu=function(l,f,c){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=f,this._mousePitch=c};cu.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},cu.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},cu.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},cu.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var Zs=function(l,f,c,d){this._el=l,this._touchZoom=f,this._touchRotate=c,this._tapDragZoom=d,this._rotationDisabled=!1,this._enabled=!0};Zs.prototype.enable=function(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},Zs.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},Zs.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},Zs.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},Zs.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},Zs.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var vs=function(l){return l.zoom||l.drag||l.pitch||l.rotate},js=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f}(v.Event);function In(l){return l.panDelta&&l.panDelta.mag()||l.zoomDelta||l.bearingDelta||l.pitchDelta}var An=function(l,f){this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Mc(l),this._bearingSnap=f.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(f),v.bindAll(["handleEvent","handleWindowEvent"],this);var c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[v.window.document,"mousemove",{capture:!0}],[v.window.document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[v.window,"blur",void 0]];for(var d=0,E=this._listeners;d<E.length;d+=1){var C=E[d],T=C[0];B.addEventListener(T,C[1],T===v.window.document?this.handleWindowEvent:this.handleEvent,C[2])}};An.prototype.destroy=function(){for(var l=0,f=this._listeners;l<f.length;l+=1){var c=f[l],d=c[0];B.removeEventListener(d,c[1],d===v.window.document?this.handleWindowEvent:this.handleEvent,c[2])}},An.prototype._addDefaultHandlers=function(l){var f=this._map,c=f.getCanvasContainer();this._add("mapEvent",new Qa(f,l));var d=f.boxZoom=new lo(f,l);this._add("boxZoom",d);var E=new Ns,C=new ma;f.doubleClickZoom=new yu(C,E),this._add("tapZoom",E),this._add("clickZoom",C);var T=new po;this._add("tapDragZoom",T);var L=f.touchPitch=new kf;this._add("touchPitch",L);var Z=new Lf(l),W=new Ou(l);f.dragRotate=new cu(l,Z,W),this._add("mouseRotate",Z,["mousePitch"]),this._add("mousePitch",W,["mouseRotate"]);var fe=new tf(l),he=new Ga(l);f.dragPan=new Us(c,fe,he),this._add("mousePan",fe),this._add("touchPan",he,["touchZoom","touchRotate"]);var de=new dh,Le=new Ms;f.touchZoomRotate=new Zs(c,Le,de,T),this._add("touchRotate",de,["touchPan","touchZoom"]),this._add("touchZoom",Le,["touchPan","touchRotate"]);var Re=f.scrollZoom=new Li(f,this);this._add("scrollZoom",Re,["mousePan"]);var Be=f.keyboard=new Js;this._add("keyboard",Be),this._add("blockableMapEvent",new yn(f));for(var Ae=0,Ve=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];Ae<Ve.length;Ae+=1){var rt=Ve[Ae];l.interactive&&l[rt]&&f[rt].enable(l[rt])}},An.prototype._add=function(l,f,c){this._handlers.push({handlerName:l,handler:f,allowed:c}),this._handlersById[l]=f},An.prototype.stop=function(l){if(!this._updatingCamera){for(var f=0,c=this._handlers;f<c.length;f+=1)c[f].handler.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}},An.prototype.isActive=function(){for(var l=0,f=this._handlers;l<f.length;l+=1)if(f[l].handler.isActive())return!0;return!1},An.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},An.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},An.prototype.isMoving=function(){return Boolean(vs(this._eventsInProgress))||this.isZooming()},An.prototype._blockedByActive=function(l,f,c){for(var d in l)if(d!==c&&(!f||f.indexOf(d)<0))return!0;return!1},An.prototype.handleWindowEvent=function(l){this.handleEvent(l,l.type+"Window")},An.prototype._getMapTouches=function(l){for(var f=[],c=0,d=l;c<d.length;c+=1){var E=d[c];this._el.contains(E.target)&&f.push(E)}return f},An.prototype.handleEvent=function(l,f){this._updatingCamera=!0;for(var c=l.type==="renderFrame"?void 0:l,d={needsRenderFrame:!1},E={},C={},T=l.touches?this._getMapTouches(l.touches):void 0,L=T?B.touchPos(this._el,T):B.mousePos(this._el,l),Z=0,W=this._handlers;Z<W.length;Z+=1){var fe=W[Z],he=fe.handlerName,de=fe.handler,Le=fe.allowed;if(de.isEnabled()){var Re=void 0;this._blockedByActive(C,Le,he)?de.reset():de[f||l.type]&&(Re=de[f||l.type](l,L,T),this.mergeHandlerResult(d,E,Re,he,c),Re&&Re.needsRenderFrame&&this._triggerRenderFrame()),(Re||de.isActive())&&(C[he]=de)}}var Be={};for(var Ae in this._previousActiveHandlers)C[Ae]||(Be[Ae]=c);this._previousActiveHandlers=C,(Object.keys(Be).length||In(d))&&(this._changes.push([d,E,Be]),this._triggerRenderFrame()),(Object.keys(C).length||In(d))&&this._map._stop(!0),this._updatingCamera=!1;var Ve=d.cameraAnimation;Ve&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Ve(this._map))},An.prototype.mergeHandlerResult=function(l,f,c,d,E){if(c){v.extend(l,c);var C={handlerName:d,originalEvent:c.originalEvent||E};c.zoomDelta!==void 0&&(f.zoom=C),c.panDelta!==void 0&&(f.drag=C),c.pitchDelta!==void 0&&(f.pitch=C),c.bearingDelta!==void 0&&(f.rotate=C)}},An.prototype._applyChanges=function(){for(var l={},f={},c={},d=0,E=this._changes;d<E.length;d+=1){var C=E[d],T=C[0],L=C[1],Z=C[2];T.panDelta&&(l.panDelta=(l.panDelta||new v.Point(0,0))._add(T.panDelta)),T.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+T.zoomDelta),T.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+T.bearingDelta),T.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+T.pitchDelta),T.around!==void 0&&(l.around=T.around),T.pinchAround!==void 0&&(l.pinchAround=T.pinchAround),T.noInertia&&(l.noInertia=T.noInertia),v.extend(f,L),v.extend(c,Z)}this._updateMapTransform(l,f,c),this._changes=[]},An.prototype._updateMapTransform=function(l,f,c){var d=this._map,E=d.transform;if(!In(l))return this._fireEvents(f,c,!0);var C=l.panDelta,T=l.zoomDelta,L=l.bearingDelta,Z=l.pitchDelta,W=l.around,fe=l.pinchAround;fe!==void 0&&(W=fe),d._stop(!0),W=W||d.transform.centerPoint;var he=E.pointLocation(C?W.sub(C):W);L&&(E.bearing+=L),Z&&(E.pitch+=Z),T&&(E.zoom+=T),E.setLocationAtPoint(he,W),this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(f,c,!0)},An.prototype._fireEvents=function(l,f,c){var d=this,E=vs(this._eventsInProgress),C=vs(l),T={};for(var L in l)this._eventsInProgress[L]||(T[L+"start"]=l[L].originalEvent),this._eventsInProgress[L]=l[L];for(var Z in!E&&C&&this._fireEvent("movestart",C.originalEvent),T)this._fireEvent(Z,T[Z]);for(var W in C&&this._fireEvent("move",C.originalEvent),l)this._fireEvent(W,l[W].originalEvent);var fe,he={};for(var de in this._eventsInProgress){var Le=this._eventsInProgress[de],Re=Le.handlerName,Be=Le.originalEvent;this._handlersById[Re].isActive()||(delete this._eventsInProgress[de],he[de+"end"]=fe=f[Re]||Be)}for(var Ae in he)this._fireEvent(Ae,he[Ae]);var Ve=vs(this._eventsInProgress);if(c&&(E||C)&&!Ve){this._updatingCamera=!0;var rt=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),xt=function(Wt){return Wt!==0&&-d._bearingSnap<Wt&&Wt<d._bearingSnap};rt?(xt(rt.bearing||this._map.getBearing())&&(rt.bearing=0),this._map.easeTo(rt,{originalEvent:fe})):(this._map.fire(new v.Event("moveend",{originalEvent:fe})),xt(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},An.prototype._fireEvent=function(l,f){this._map.fire(new v.Event(l,f?{originalEvent:f}:{}))},An.prototype._requestFrame=function(){var l=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(f){delete l._frameId,l.handleEvent(new js("renderFrame",{timeStamp:f})),l._applyChanges()})},An.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var Ql=function(l){function f(c,d){l.call(this),this._moving=!1,this._zooming=!1,this.transform=c,this._bearingSnap=d.bearingSnap,v.bindAll(["_renderFrameCallback"],this)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getCenter=function(){return new v.LngLat(this.transform.center.lng,this.transform.center.lat)},f.prototype.setCenter=function(c,d){return this.jumpTo({center:c},d)},f.prototype.panBy=function(c,d,E){return c=v.Point.convert(c).mult(-1),this.panTo(this.transform.center,v.extend({offset:c},d),E)},f.prototype.panTo=function(c,d,E){return this.easeTo(v.extend({center:c},d),E)},f.prototype.getZoom=function(){return this.transform.zoom},f.prototype.setZoom=function(c,d){return this.jumpTo({zoom:c},d),this},f.prototype.zoomTo=function(c,d,E){return this.easeTo(v.extend({zoom:c},d),E)},f.prototype.zoomIn=function(c,d){return this.zoomTo(this.getZoom()+1,c,d),this},f.prototype.zoomOut=function(c,d){return this.zoomTo(this.getZoom()-1,c,d),this},f.prototype.getBearing=function(){return this.transform.bearing},f.prototype.setBearing=function(c,d){return this.jumpTo({bearing:c},d),this},f.prototype.getPadding=function(){return this.transform.padding},f.prototype.setPadding=function(c,d){return this.jumpTo({padding:c},d),this},f.prototype.rotateTo=function(c,d,E){return this.easeTo(v.extend({bearing:c},d),E)},f.prototype.resetNorth=function(c,d){return this.rotateTo(0,v.extend({duration:1e3},c),d),this},f.prototype.resetNorthPitch=function(c,d){return this.easeTo(v.extend({bearing:0,pitch:0,duration:1e3},c),d),this},f.prototype.snapToNorth=function(c,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(c,d):this},f.prototype.getPitch=function(){return this.transform.pitch},f.prototype.setPitch=function(c,d){return this.jumpTo({pitch:c},d),this},f.prototype.cameraForBounds=function(c,d){c=v.LngLatBounds.convert(c);var E=d&&d.bearing||0;return this._cameraForBoxAndBearing(c.getNorthWest(),c.getSouthEast(),E,d)},f.prototype._cameraForBoxAndBearing=function(c,d,E,C){var T={top:0,bottom:0,right:0,left:0};if(typeof(C=v.extend({padding:T,offset:[0,0],maxZoom:this.transform.maxZoom},C)).padding=="number"){var L=C.padding;C.padding={top:L,bottom:L,right:L,left:L}}C.padding=v.extend(T,C.padding);var Z=this.transform,W=Z.padding,fe=Z.project(v.LngLat.convert(c)),he=Z.project(v.LngLat.convert(d)),de=fe.rotate(-E*Math.PI/180),Le=he.rotate(-E*Math.PI/180),Re=new v.Point(Math.max(de.x,Le.x),Math.max(de.y,Le.y)),Be=new v.Point(Math.min(de.x,Le.x),Math.min(de.y,Le.y)),Ae=Re.sub(Be),Ve=(Z.width-(W.left+W.right+C.padding.left+C.padding.right))/Ae.x,rt=(Z.height-(W.top+W.bottom+C.padding.top+C.padding.bottom))/Ae.y;if(!(rt<0||Ve<0)){var xt=Math.min(Z.scaleZoom(Z.scale*Math.min(Ve,rt)),C.maxZoom),Wt=typeof C.offset.x=="number"?new v.Point(C.offset.x,C.offset.y):v.Point.convert(C.offset),Vt=new v.Point((C.padding.left-C.padding.right)/2,(C.padding.top-C.padding.bottom)/2).rotate(E*Math.PI/180),Ot=Wt.add(Vt).mult(Z.scale/Z.zoomScale(xt));return{center:Z.unproject(fe.add(he).div(2).sub(Ot)),zoom:xt,bearing:E}}v.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},f.prototype.fitBounds=function(c,d,E){return this._fitInternal(this.cameraForBounds(c,d),d,E)},f.prototype.fitScreenCoordinates=function(c,d,E,C,T){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(v.Point.convert(c)),this.transform.pointLocation(v.Point.convert(d)),E,C),C,T)},f.prototype._fitInternal=function(c,d,E){return c?(delete(d=v.extend(c,d)).padding,d.linear?this.easeTo(d,E):this.flyTo(d,E)):this},f.prototype.jumpTo=function(c,d){this.stop();var E=this.transform,C=!1,T=!1,L=!1;return"zoom"in c&&E.zoom!==+c.zoom&&(C=!0,E.zoom=+c.zoom),c.center!==void 0&&(E.center=v.LngLat.convert(c.center)),"bearing"in c&&E.bearing!==+c.bearing&&(T=!0,E.bearing=+c.bearing),"pitch"in c&&E.pitch!==+c.pitch&&(L=!0,E.pitch=+c.pitch),c.padding==null||E.isPaddingEqual(c.padding)||(E.padding=c.padding),this.fire(new v.Event("movestart",d)).fire(new v.Event("move",d)),C&&this.fire(new v.Event("zoomstart",d)).fire(new v.Event("zoom",d)).fire(new v.Event("zoomend",d)),T&&this.fire(new v.Event("rotatestart",d)).fire(new v.Event("rotate",d)).fire(new v.Event("rotateend",d)),L&&this.fire(new v.Event("pitchstart",d)).fire(new v.Event("pitch",d)).fire(new v.Event("pitchend",d)),this.fire(new v.Event("moveend",d))},f.prototype.easeTo=function(c,d){var E=this;this._stop(!1,c.easeId),((c=v.extend({offset:[0,0],duration:500,easing:v.ease},c)).animate===!1||!c.essential&&v.browser.prefersReducedMotion)&&(c.duration=0);var C=this.transform,T=this.getZoom(),L=this.getBearing(),Z=this.getPitch(),W=this.getPadding(),fe="zoom"in c?+c.zoom:T,he="bearing"in c?this._normalizeBearing(c.bearing,L):L,de="pitch"in c?+c.pitch:Z,Le="padding"in c?c.padding:C.padding,Re=v.Point.convert(c.offset),Be=C.centerPoint.add(Re),Ae=C.pointLocation(Be),Ve=v.LngLat.convert(c.center||Ae);this._normalizeCenter(Ve);var rt,xt,Wt=C.project(Ae),Vt=C.project(Ve).sub(Wt),Ot=C.zoomScale(fe-T);c.around&&(rt=v.LngLat.convert(c.around),xt=C.locationPoint(rt));var vr={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||fe!==T,this._rotating=this._rotating||L!==he,this._pitching=this._pitching||de!==Z,this._padding=!C.isPaddingEqual(Le),this._easeId=c.easeId,this._prepareEase(d,c.noMoveStart,vr),this._ease(function(Br){if(E._zooming&&(C.zoom=v.number(T,fe,Br)),E._rotating&&(C.bearing=v.number(L,he,Br)),E._pitching&&(C.pitch=v.number(Z,de,Br)),E._padding&&(C.interpolatePadding(W,Le,Br),Be=C.centerPoint.add(Re)),rt)C.setLocationAtPoint(rt,xt);else{var Dr=C.zoomScale(C.zoom-T),an=fe>T?Math.min(2,Ot):Math.max(.5,Ot),Bn=Math.pow(an,1-Br),kn=C.unproject(Wt.add(Vt.mult(Br*Bn)).mult(Dr));C.setLocationAtPoint(C.renderWorldCopies?kn.wrap():kn,Be)}E._fireMoveEvents(d)},function(Br){E._afterEase(d,Br)},c),this},f.prototype._prepareEase=function(c,d,E){E===void 0&&(E={}),this._moving=!0,d||E.moving||this.fire(new v.Event("movestart",c)),this._zooming&&!E.zooming&&this.fire(new v.Event("zoomstart",c)),this._rotating&&!E.rotating&&this.fire(new v.Event("rotatestart",c)),this._pitching&&!E.pitching&&this.fire(new v.Event("pitchstart",c))},f.prototype._fireMoveEvents=function(c){this.fire(new v.Event("move",c)),this._zooming&&this.fire(new v.Event("zoom",c)),this._rotating&&this.fire(new v.Event("rotate",c)),this._pitching&&this.fire(new v.Event("pitch",c))},f.prototype._afterEase=function(c,d){if(!this._easeId||!d||this._easeId!==d){delete this._easeId;var E=this._zooming,C=this._rotating,T=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,E&&this.fire(new v.Event("zoomend",c)),C&&this.fire(new v.Event("rotateend",c)),T&&this.fire(new v.Event("pitchend",c)),this.fire(new v.Event("moveend",c))}},f.prototype.flyTo=function(c,d){var E=this;if(!c.essential&&v.browser.prefersReducedMotion){var C=v.pick(c,["center","zoom","bearing","pitch","around"]);return this.jumpTo(C,d)}this.stop(),c=v.extend({offset:[0,0],speed:1.2,curve:1.42,easing:v.ease},c);var T=this.transform,L=this.getZoom(),Z=this.getBearing(),W=this.getPitch(),fe=this.getPadding(),he="zoom"in c?v.clamp(+c.zoom,T.minZoom,T.maxZoom):L,de="bearing"in c?this._normalizeBearing(c.bearing,Z):Z,Le="pitch"in c?+c.pitch:W,Re="padding"in c?c.padding:T.padding,Be=T.zoomScale(he-L),Ae=v.Point.convert(c.offset),Ve=T.centerPoint.add(Ae),rt=T.pointLocation(Ve),xt=v.LngLat.convert(c.center||rt);this._normalizeCenter(xt);var Wt=T.project(rt),Vt=T.project(xt).sub(Wt),Ot=c.curve,vr=Math.max(T.width,T.height),Br=vr/Be,Dr=Vt.mag();if("minZoom"in c){var an=v.clamp(Math.min(c.minZoom,L,he),T.minZoom,T.maxZoom),Bn=vr/T.zoomScale(an-L);Ot=Math.sqrt(Bn/Dr*2)}var kn=Ot*Ot;function Nn(Rn){var Wn=(Br*Br-vr*vr+(Rn?-1:1)*kn*kn*Dr*Dr)/(2*(Rn?Br:vr)*kn*Dr);return Math.log(Math.sqrt(Wn*Wn+1)-Wn)}function Bi(Rn){return(Math.exp(Rn)-Math.exp(-Rn))/2}function on(Rn){return(Math.exp(Rn)+Math.exp(-Rn))/2}var si=Nn(0),hi=function(Rn){return on(si)/on(si+Ot*Rn)},ri=function(Rn){return vr*((on(si)*(Bi(Wn=si+Ot*Rn)/on(Wn))-Bi(si))/kn)/Dr;var Wn},Hn=(Nn(1)-si)/Ot;if(Math.abs(Dr)<1e-6||!isFinite(Hn)){if(Math.abs(vr-Br)<1e-6)return this.easeTo(c,d);var mi=Br<vr?-1:1;Hn=Math.abs(Math.log(Br/vr))/Ot,ri=function(){return 0},hi=function(Rn){return Math.exp(mi*Ot*Rn)}}return c.duration="duration"in c?+c.duration:1e3*Hn/("screenSpeed"in c?+c.screenSpeed/Ot:+c.speed),c.maxDuration&&c.duration>c.maxDuration&&(c.duration=0),this._zooming=!0,this._rotating=Z!==de,this._pitching=Le!==W,this._padding=!T.isPaddingEqual(Re),this._prepareEase(d,!1),this._ease(function(Rn){var Wn=Rn*Hn,Ha=1/hi(Wn);T.zoom=Rn===1?he:L+T.scaleZoom(Ha),E._rotating&&(T.bearing=v.number(Z,de,Rn)),E._pitching&&(T.pitch=v.number(W,Le,Rn)),E._padding&&(T.interpolatePadding(fe,Re,Rn),Ve=T.centerPoint.add(Ae));var eo=Rn===1?xt:T.unproject(Wt.add(Vt.mult(ri(Wn))).mult(Ha));T.setLocationAtPoint(T.renderWorldCopies?eo.wrap():eo,Ve),E._fireMoveEvents(d)},function(){return E._afterEase(d)},c),this},f.prototype.isEasing=function(){return!!this._easeFrameId},f.prototype.stop=function(){return this._stop()},f.prototype._stop=function(c,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var E=this._onEaseEnd;delete this._onEaseEnd,E.call(this,d)}if(!c){var C=this.handlers;C&&C.stop(!1)}return this},f.prototype._ease=function(c,d,E){E.animate===!1||E.duration===0?(c(1),d()):(this._easeStart=v.browser.now(),this._easeOptions=E,this._onEaseFrame=c,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},f.prototype._renderFrameCallback=function(){var c=Math.min((v.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(c)),c<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},f.prototype._normalizeBearing=function(c,d){c=v.wrap(c,-180,180);var E=Math.abs(c-d);return Math.abs(c-360-d)<E&&(c-=360),Math.abs(c+360-d)<E&&(c+=360),c},f.prototype._normalizeCenter=function(c){var d=this.transform;if(d.renderWorldCopies&&!d.lngRange){var E=c.lng-d.center.lng;c.lng+=E>180?-360:E<-180?360:0}},f}(v.Evented),ms=function(l){l===void 0&&(l={}),this.options=l,v.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};ms.prototype.getDefaultPosition=function(){return"bottom-right"},ms.prototype.onAdd=function(l){var f=this.options&&this.options.compact;return this._map=l,this._container=B.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=B.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=B.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),f&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),f===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},ms.prototype.onRemove=function(){B.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},ms.prototype._setElementTitle=function(l,f){var c=this._map._getUIString("AttributionControl."+f);l.title=c,l.setAttribute("aria-label",c)},ms.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},ms.prototype._updateEditLink=function(){var l=this._editLink;l||(l=this._editLink=this._container.querySelector(".mapbox-improve-map"));var f=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||v.config.ACCESS_TOKEN}];if(l){var c=f.reduce(function(d,E,C){return E.value&&(d+=E.key+"="+E.value+(C<f.length-1?"&":"")),d},"?");l.href=v.config.FEEDBACK_URL+"/"+c+(this._map._hash?this._map._hash.getHashString(!0):""),l.rel="noopener nofollow",this._setElementTitle(l,"MapFeedback")}},ms.prototype._updateData=function(l){!l||l.sourceDataType!=="metadata"&&l.sourceDataType!=="visibility"&&l.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},ms.prototype._updateAttributions=function(){if(this._map.style){var l=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=l.concat(this.options.customAttribution.map(function(L){return typeof L!="string"?"":L})):typeof this.options.customAttribution=="string"&&l.push(this.options.customAttribution)),this._map.style.stylesheet){var f=this._map.style.stylesheet;this.styleOwner=f.owner,this.styleId=f.id}var c=this._map.style.sourceCaches;for(var d in c){var E=c[d];if(E.used){var C=E.getSource();C.attribution&&l.indexOf(C.attribution)<0&&l.push(C.attribution)}}l.sort(function(L,Z){return L.length-Z.length});var T=(l=l.filter(function(L,Z){for(var W=Z+1;W<l.length;W++)if(l[W].indexOf(L)>=0)return!1;return!0})).join(" | ");T!==this._attribHTML&&(this._attribHTML=T,l.length?(this._innerContainer.innerHTML=T,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},ms.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var _u=function(){v.bindAll(["_updateLogo"],this),v.bindAll(["_updateCompact"],this)};_u.prototype.onAdd=function(l){this._map=l,this._container=B.create("div","mapboxgl-ctrl");var f=B.create("a","mapboxgl-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://www.mapbox.com/",f.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),f.setAttribute("rel","noopener nofollow"),this._container.appendChild(f),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},_u.prototype.onRemove=function(){B.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},_u.prototype.getDefaultPosition=function(){return"bottom-left"},_u.prototype._updateLogo=function(l){l&&l.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},_u.prototype._logoRequired=function(){if(this._map.style){var l=this._map.style.sourceCaches;for(var f in l)if(l[f].getSource().mapbox_logo)return!0;return!1}},_u.prototype._updateCompact=function(){var l=this._container.children;if(l.length){var f=l[0];this._map.getCanvasContainer().offsetWidth<250?f.classList.add("mapboxgl-compact"):f.classList.remove("mapboxgl-compact")}};var es=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};es.prototype.add=function(l){var f=++this._id;return this._queue.push({callback:l,id:f,cancelled:!1}),f},es.prototype.remove=function(l){for(var f=this._currentlyRunning,c=0,d=f?this._queue.concat(f):this._queue;c<d.length;c+=1){var E=d[c];if(E.id===l)return void(E.cancelled=!0)}},es.prototype.run=function(l){l===void 0&&(l=0);var f=this._currentlyRunning=this._queue;this._queue=[];for(var c=0,d=f;c<d.length;c+=1){var E=d[c];if(!E.cancelled&&(E.callback(l),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},es.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var Aa={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Pc=v.window.HTMLImageElement,Ic=v.window.HTMLElement,ga=v.window.ImageBitmap,Ia={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Oc=function(l){function f(d){var E=this;if((d=v.extend({},Ia,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var C=new Fi(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies);if(l.call(this,C,d),this._interactive=d.interactive,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._crossSourceCollisions=d.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=d.collectResourceTiming,this._renderTaskQueue=new es,this._controls=[],this._mapId=v.uniqueId(),this._locale=v.extend({},Aa,d.locale),this._clickTolerance=d.clickTolerance,this._requestManager=new v.RequestManager(d.transformRequest,d.accessToken),typeof d.container=="string"){if(this._container=v.window.document.getElementById(d.container),!this._container)throw new Error("Container '"+d.container+"' not found.")}else{if(!(d.container instanceof Ic))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(d.maxBounds&&this.setMaxBounds(d.maxBounds),v.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return E._update(!1)}),this.on("moveend",function(){return E._update(!1)}),this.on("zoom",function(){return E._update(!0)}),v.window!==void 0&&(v.window.addEventListener("online",this._onWindowOnline,!1),v.window.addEventListener("resize",this._onWindowResize,!1),v.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new An(this,d),this._hash=d.hash&&new Bs(typeof d.hash=="string"&&d.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch}),d.bounds&&(this.resize(),this.fitBounds(d.bounds,v.extend({},d.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=d.localIdeographFontFamily,d.style&&this.setStyle(d.style,{localIdeographFontFamily:d.localIdeographFontFamily}),d.attributionControl&&this.addControl(new ms({customAttribution:d.customAttribution})),this.addControl(new _u,d.logoPosition),this.on("style.load",function(){E.transform.unmodified&&E.jumpTo(E.style.stylesheet)}),this.on("data",function(T){E._update(T.dataType==="style"),E.fire(new v.Event(T.dataType+"data",T))}),this.on("dataloading",function(T){E.fire(new v.Event(T.dataType+"dataloading",T))})}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return f.prototype._getMapId=function(){return this._mapId},f.prototype.addControl=function(d,E){if(E===void 0&&(E=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new v.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var C=d.onAdd(this);this._controls.push(d);var T=this._controlPositions[E];return E.indexOf("bottom")!==-1?T.insertBefore(C,T.firstChild):T.appendChild(C),this},f.prototype.removeControl=function(d){if(!d||!d.onRemove)return this.fire(new v.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var E=this._controls.indexOf(d);return E>-1&&this._controls.splice(E,1),d.onRemove(this),this},f.prototype.hasControl=function(d){return this._controls.indexOf(d)>-1},f.prototype.resize=function(d){var E=this._containerDimensions(),C=E[0],T=E[1];if(C===this.transform.width&&T===this.transform.height)return this;this._resizeCanvas(C,T),this.transform.resize(C,T),this.painter.resize(C,T);var L=!this._moving;return L&&this.fire(new v.Event("movestart",d)).fire(new v.Event("move",d)),this.fire(new v.Event("resize",d)),L&&this.fire(new v.Event("moveend",d)),this},f.prototype.getBounds=function(){return this.transform.getBounds()},f.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},f.prototype.setMaxBounds=function(d){return this.transform.setMaxBounds(v.LngLatBounds.convert(d)),this._update()},f.prototype.setMinZoom=function(d){if((d=d==null?-2:d)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d&&this.setZoom(d),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},f.prototype.getMinZoom=function(){return this.transform.minZoom},f.prototype.setMaxZoom=function(d){if((d=d==null?22:d)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d&&this.setZoom(d),this;throw new Error("maxZoom must be greater than the current minZoom")},f.prototype.getMaxZoom=function(){return this.transform.maxZoom},f.prototype.setMinPitch=function(d){if((d=d==null?0:d)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d&&this.setPitch(d),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},f.prototype.getMinPitch=function(){return this.transform.minPitch},f.prototype.setMaxPitch=function(d){if((d=d==null?60:d)>60)throw new Error("maxPitch must be less than or equal to 60");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d&&this.setPitch(d),this;throw new Error("maxPitch must be greater than the current minPitch")},f.prototype.getMaxPitch=function(){return this.transform.maxPitch},f.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},f.prototype.setRenderWorldCopies=function(d){return this.transform.renderWorldCopies=d,this._update()},f.prototype.project=function(d){return this.transform.locationPoint(v.LngLat.convert(d))},f.prototype.unproject=function(d){return this.transform.pointLocation(v.Point.convert(d))},f.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},f.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},f.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},f.prototype._createDelegatedListener=function(d,E,C){var T,L=this;if(d==="mouseenter"||d==="mouseover"){var Z=!1;return{layer:E,listener:C,delegates:{mousemove:function(fe){var he=L.getLayer(E)?L.queryRenderedFeatures(fe.point,{layers:[E]}):[];he.length?Z||(Z=!0,C.call(L,new ko(d,L,fe.originalEvent,{features:he}))):Z=!1},mouseout:function(){Z=!1}}}}if(d==="mouseleave"||d==="mouseout"){var W=!1;return{layer:E,listener:C,delegates:{mousemove:function(fe){(L.getLayer(E)?L.queryRenderedFeatures(fe.point,{layers:[E]}):[]).length?W=!0:W&&(W=!1,C.call(L,new ko(d,L,fe.originalEvent)))},mouseout:function(fe){W&&(W=!1,C.call(L,new ko(d,L,fe.originalEvent)))}}}}return{layer:E,listener:C,delegates:(T={},T[d]=function(fe){var he=L.getLayer(E)?L.queryRenderedFeatures(fe.point,{layers:[E]}):[];he.length&&(fe.features=he,C.call(L,fe),delete fe.features)},T)}},f.prototype.on=function(d,E,C){if(C===void 0)return l.prototype.on.call(this,d,E);var T=this._createDelegatedListener(d,E,C);for(var L in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(T),T.delegates)this.on(L,T.delegates[L]);return this},f.prototype.once=function(d,E,C){if(C===void 0)return l.prototype.once.call(this,d,E);var T=this._createDelegatedListener(d,E,C);for(var L in T.delegates)this.once(L,T.delegates[L]);return this},f.prototype.off=function(d,E,C){var T=this;return C===void 0?l.prototype.off.call(this,d,E):(this._delegatedListeners&&this._delegatedListeners[d]&&function(L){for(var Z=L[d],W=0;W<Z.length;W++){var fe=Z[W];if(fe.layer===E&&fe.listener===C){for(var he in fe.delegates)T.off(he,fe.delegates[he]);return Z.splice(W,1),T}}}(this._delegatedListeners),this)},f.prototype.queryRenderedFeatures=function(d,E){if(!this.style)return[];var C;if(E!==void 0||d===void 0||d instanceof v.Point||Array.isArray(d)||(E=d,d=void 0),E=E||{},(d=d||[[0,0],[this.transform.width,this.transform.height]])instanceof v.Point||typeof d[0]=="number")C=[v.Point.convert(d)];else{var T=v.Point.convert(d[0]),L=v.Point.convert(d[1]);C=[T,new v.Point(L.x,T.y),L,new v.Point(T.x,L.y),T]}return this.style.queryRenderedFeatures(C,E,this.transform)},f.prototype.querySourceFeatures=function(d,E){return this.style.querySourceFeatures(d,E)},f.prototype.setStyle=function(d,E){return(E=v.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},E)).diff!==!1&&E.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&d?(this._diffStyle(d,E),this):(this._localIdeographFontFamily=E.localIdeographFontFamily,this._updateStyle(d,E))},f.prototype._getUIString=function(d){var E=this._locale[d];if(E==null)throw new Error("Missing UI string '"+d+"'");return E},f.prototype._updateStyle=function(d,E){return this.style&&(this.style.setEventedParent(null),this.style._remove()),d?(this.style=new ds(this,E||{}),this.style.setEventedParent(this,{style:this.style}),typeof d=="string"?this.style.loadURL(d):this.style.loadJSON(d),this):(delete this.style,this)},f.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new ds(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},f.prototype._diffStyle=function(d,E){var C=this;if(typeof d=="string"){var T=this._requestManager.normalizeStyleURL(d),L=this._requestManager.transformRequest(T,v.ResourceType.Style);v.getJSON(L,function(Z,W){Z?C.fire(new v.ErrorEvent(Z)):W&&C._updateDiff(W,E)})}else typeof d=="object"&&this._updateDiff(d,E)},f.prototype._updateDiff=function(d,E){try{this.style.setState(d)&&this._update(!0)}catch(C){v.warnOnce("Unable to perform style diff: "+(C.message||C.error||C)+".  Rebuilding the style from scratch."),this._updateStyle(d,E)}},f.prototype.getStyle=function(){if(this.style)return this.style.serialize()},f.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():v.warnOnce("There is no style added to the map.")},f.prototype.addSource=function(d,E){return this._lazyInitEmptyStyle(),this.style.addSource(d,E),this._update(!0)},f.prototype.isSourceLoaded=function(d){var E=this.style&&this.style.sourceCaches[d];if(E!==void 0)return E.loaded();this.fire(new v.ErrorEvent(new Error("There is no source with ID '"+d+"'")))},f.prototype.areTilesLoaded=function(){var d=this.style&&this.style.sourceCaches;for(var E in d){var C=d[E]._tiles;for(var T in C){var L=C[T];if(L.state!=="loaded"&&L.state!=="errored")return!1}}return!0},f.prototype.addSourceType=function(d,E,C){return this._lazyInitEmptyStyle(),this.style.addSourceType(d,E,C)},f.prototype.removeSource=function(d){return this.style.removeSource(d),this._update(!0)},f.prototype.getSource=function(d){return this.style.getSource(d)},f.prototype.addImage=function(d,E,C){C===void 0&&(C={});var T=C.pixelRatio;T===void 0&&(T=1);var L=C.sdf;L===void 0&&(L=!1);var Z=C.stretchX,W=C.stretchY,fe=C.content;if(this._lazyInitEmptyStyle(),E instanceof Pc||ga&&E instanceof ga){var he=v.browser.getImageData(E);this.style.addImage(d,{data:new v.RGBAImage({width:he.width,height:he.height},he.data),pixelRatio:T,stretchX:Z,stretchY:W,content:fe,sdf:L,version:0})}else{if(E.width===void 0||E.height===void 0)return this.fire(new v.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var de=E;this.style.addImage(d,{data:new v.RGBAImage({width:E.width,height:E.height},new Uint8Array(E.data)),pixelRatio:T,stretchX:Z,stretchY:W,content:fe,sdf:L,version:0,userImage:de}),de.onAdd&&de.onAdd(this,d)}},f.prototype.updateImage=function(d,E){var C=this.style.getImage(d);if(!C)return this.fire(new v.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var T=E instanceof Pc||ga&&E instanceof ga?v.browser.getImageData(E):E,L=T.width,Z=T.height,W=T.data;return L===void 0||Z===void 0?this.fire(new v.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):L!==C.data.width||Z!==C.data.height?this.fire(new v.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(C.data.replace(W,!(E instanceof Pc||ga&&E instanceof ga)),void this.style.updateImage(d,C))},f.prototype.hasImage=function(d){return d?!!this.style.getImage(d):(this.fire(new v.ErrorEvent(new Error("Missing required image id"))),!1)},f.prototype.removeImage=function(d){this.style.removeImage(d)},f.prototype.loadImage=function(d,E){v.getImage(this._requestManager.transformRequest(d,v.ResourceType.Image),E)},f.prototype.listImages=function(){return this.style.listImages()},f.prototype.addLayer=function(d,E){return this._lazyInitEmptyStyle(),this.style.addLayer(d,E),this._update(!0)},f.prototype.moveLayer=function(d,E){return this.style.moveLayer(d,E),this._update(!0)},f.prototype.removeLayer=function(d){return this.style.removeLayer(d),this._update(!0)},f.prototype.getLayer=function(d){return this.style.getLayer(d)},f.prototype.setLayerZoomRange=function(d,E,C){return this.style.setLayerZoomRange(d,E,C),this._update(!0)},f.prototype.setFilter=function(d,E,C){return C===void 0&&(C={}),this.style.setFilter(d,E,C),this._update(!0)},f.prototype.getFilter=function(d){return this.style.getFilter(d)},f.prototype.setPaintProperty=function(d,E,C,T){return T===void 0&&(T={}),this.style.setPaintProperty(d,E,C,T),this._update(!0)},f.prototype.getPaintProperty=function(d,E){return this.style.getPaintProperty(d,E)},f.prototype.setLayoutProperty=function(d,E,C,T){return T===void 0&&(T={}),this.style.setLayoutProperty(d,E,C,T),this._update(!0)},f.prototype.getLayoutProperty=function(d,E){return this.style.getLayoutProperty(d,E)},f.prototype.setLight=function(d,E){return E===void 0&&(E={}),this._lazyInitEmptyStyle(),this.style.setLight(d,E),this._update(!0)},f.prototype.getLight=function(){return this.style.getLight()},f.prototype.setFeatureState=function(d,E){return this.style.setFeatureState(d,E),this._update()},f.prototype.removeFeatureState=function(d,E){return this.style.removeFeatureState(d,E),this._update()},f.prototype.getFeatureState=function(d){return this.style.getFeatureState(d)},f.prototype.getContainer=function(){return this._container},f.prototype.getCanvasContainer=function(){return this._canvasContainer},f.prototype.getCanvas=function(){return this._canvas},f.prototype._containerDimensions=function(){var d=0,E=0;return this._container&&(d=this._container.clientWidth||400,E=this._container.clientHeight||300),[d,E]},f.prototype._detectMissingCSS=function(){v.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&v.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},f.prototype._setupContainer=function(){var d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=B.create("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();var E=this._canvasContainer=B.create("div","mapboxgl-canvas-container",d);this._interactive&&E.classList.add("mapboxgl-interactive"),this._canvas=B.create("canvas","mapboxgl-canvas",E),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var C=this._containerDimensions();this._resizeCanvas(C[0],C[1]);var T=this._controlContainer=B.create("div","mapboxgl-control-container",d),L=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(Z){L[Z]=B.create("div","mapboxgl-ctrl-"+Z,T)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},f.prototype._resizeCanvas=function(d,E){var C=v.browser.devicePixelRatio||1;this._canvas.width=C*d,this._canvas.height=C*E,this._canvas.style.width=d+"px",this._canvas.style.height=E+"px"},f.prototype._setupPainter=function(){var d=v.extend({},te.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),E=this._canvas.getContext("webgl",d)||this._canvas.getContext("experimental-webgl",d);E?(this.painter=new qa(E,this.transform),v.webpSupported.testSupport(E)):this.fire(new v.ErrorEvent(new Error("Failed to initialize WebGL")))},f.prototype._contextLost=function(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new v.Event("webglcontextlost",{originalEvent:d}))},f.prototype._contextRestored=function(d){this._setupPainter(),this.resize(),this._update(),this.fire(new v.Event("webglcontextrestored",{originalEvent:d}))},f.prototype._onMapScroll=function(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},f.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},f.prototype._update=function(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this},f.prototype._requestRenderFrame=function(d){return this._update(),this._renderTaskQueue.add(d)},f.prototype._cancelRenderFrame=function(d){this._renderTaskQueue.remove(d)},f.prototype._render=function(d){var E,C=this,T=0,L=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(E=L.createQueryEXT(),L.beginQueryEXT(L.TIME_ELAPSED_EXT,E),T=v.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(d),!this._removed){var Z=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var W=this.transform.zoom,fe=v.browser.now();this.style.zoomHistory.update(W,fe);var he=new v.EvaluationParameters(W,{now:fe,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),de=he.crossFadingFactor();de===1&&de===this._crossFadingFactor||(Z=!0,this._crossFadingFactor=de),this.style.update(he)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new v.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new v.Event("load"))),this.style&&(this.style.hasTransitions()||Z)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var Le=v.browser.now()-T;L.endQueryEXT(L.TIME_ELAPSED_EXT,E),setTimeout(function(){var Ae=L.getQueryObjectEXT(E,L.QUERY_RESULT_EXT)/1e6;L.deleteQueryEXT(E),C.fire(new v.Event("gpu-timing-frame",{cpuTime:Le,gpuTime:Ae}))},50)}if(this.listens("gpu-timing-layer")){var Re=this.painter.collectGpuTimers();setTimeout(function(){var Ae=C.painter.queryGpuTimers(Re);C.fire(new v.Event("gpu-timing-layer",{layerTimes:Ae}))},50)}var Be=this._sourcesDirty||this._styleDirty||this._placementDirty;return Be||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new v.Event("idle")),!this._loaded||this._fullyLoaded||Be||(this._fullyLoaded=!0),this}},f.prototype.remove=function(){this._hash&&this._hash.remove();for(var d=0,E=this._controls;d<E.length;d+=1)E[d].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),v.window!==void 0&&(v.window.removeEventListener("resize",this._onWindowResize,!1),v.window.removeEventListener("orientationchange",this._onWindowResize,!1),v.window.removeEventListener("online",this._onWindowOnline,!1));var C=this.painter.context.gl.getExtension("WEBGL_lose_context");C&&C.loseContext(),Rl(this._canvasContainer),Rl(this._controlContainer),Rl(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new v.Event("remove"))},f.prototype.triggerRepaint=function(){var d=this;this.style&&!this._frame&&(this._frame=v.browser.frame(function(E){d._frame=null,d._render(E)}))},f.prototype._onWindowOnline=function(){this._update()},f.prototype._onWindowResize=function(d){this._trackResize&&this.resize({originalEvent:d})._update()},c.showTileBoundaries.get=function(){return!!this._showTileBoundaries},c.showTileBoundaries.set=function(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())},c.showPadding.get=function(){return!!this._showPadding},c.showPadding.set=function(d){this._showPadding!==d&&(this._showPadding=d,this._update())},c.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},c.showCollisionBoxes.set=function(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())},c.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},c.showOverdrawInspector.set=function(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())},c.repaint.get=function(){return!!this._repaint},c.repaint.set=function(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())},c.vertices.get=function(){return!!this._vertices},c.vertices.set=function(d){this._vertices=d,this._update()},f.prototype._setCacheLimits=function(d,E){v.setCacheLimits(d,E)},c.version.get=function(){return v.version},Object.defineProperties(f.prototype,c),f}(Ql);function Rl(l){l.parentNode&&l.parentNode.removeChild(l)}var xu={showCompass:!0,showZoom:!0,visualizePitch:!1},Qs=function(l){var f=this;this.options=v.extend({},xu,l),this._container=B.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(c){return c.preventDefault()}),this.options.showZoom&&(v.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(c){return f._map.zoomIn({},{originalEvent:c})}),B.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(c){return f._map.zoomOut({},{originalEvent:c})}),B.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(v.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(c){f.options.visualizePitch?f._map.resetNorthPitch({},{originalEvent:c}):f._map.resetNorth({},{originalEvent:c})}),this._compassIcon=B.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};Qs.prototype._updateZoomButtons=function(){var l=this._map.getZoom(),f=l===this._map.getMaxZoom(),c=l===this._map.getMinZoom();this._zoomInButton.disabled=f,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",f.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())},Qs.prototype._rotateCompassArrow=function(){var l=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=l},Qs.prototype.onAdd=function(l){return this._map=l,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Do(this._map,this._compass,this.options.visualizePitch)),this._container},Qs.prototype.onRemove=function(){B.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},Qs.prototype._createButton=function(l,f){var c=B.create("button",l,this._container);return c.type="button",c.addEventListener("click",f),c},Qs.prototype._setButtonTitle=function(l,f){var c=this._map._getUIString("NavigationControl."+f);l.title=c,l.setAttribute("aria-label",c)};var Do=function(l,f,c){c===void 0&&(c=!1),this._clickTolerance=10,this.element=f,this.mouseRotate=new Lf({clickTolerance:l.dragRotate._mouseRotate._clickTolerance}),this.map=l,c&&(this.mousePitch=new Ou({clickTolerance:l.dragRotate._mousePitch._clickTolerance})),v.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),B.addEventListener(f,"mousedown",this.mousedown),B.addEventListener(f,"touchstart",this.touchstart,{passive:!1}),B.addEventListener(f,"touchmove",this.touchmove),B.addEventListener(f,"touchend",this.touchend),B.addEventListener(f,"touchcancel",this.reset)};function gl(l,f,c){if(l=new v.LngLat(l.lng,l.lat),f){var d=new v.LngLat(l.lng-360,l.lat),E=new v.LngLat(l.lng+360,l.lat),C=c.locationPoint(l).distSqr(f);c.locationPoint(d).distSqr(f)<C?l=d:c.locationPoint(E).distSqr(f)<C&&(l=E)}for(;Math.abs(l.lng-c.center.lng)>180;){var T=c.locationPoint(l);if(T.x>=0&&T.y>=0&&T.x<=c.width&&T.y<=c.height)break;l.lng>c.center.lng?l.lng-=360:l.lng+=360}return l}Do.prototype.down=function(l,f){this.mouseRotate.mousedown(l,f),this.mousePitch&&this.mousePitch.mousedown(l,f),B.disableDrag()},Do.prototype.move=function(l,f){var c=this.map,d=this.mouseRotate.mousemoveWindow(l,f);if(d&&d.bearingDelta&&c.setBearing(c.getBearing()+d.bearingDelta),this.mousePitch){var E=this.mousePitch.mousemoveWindow(l,f);E&&E.pitchDelta&&c.setPitch(c.getPitch()+E.pitchDelta)}},Do.prototype.off=function(){var l=this.element;B.removeEventListener(l,"mousedown",this.mousedown),B.removeEventListener(l,"touchstart",this.touchstart,{passive:!1}),B.removeEventListener(l,"touchmove",this.touchmove),B.removeEventListener(l,"touchend",this.touchend),B.removeEventListener(l,"touchcancel",this.reset),this.offTemp()},Do.prototype.offTemp=function(){B.enableDrag(),B.removeEventListener(v.window,"mousemove",this.mousemove),B.removeEventListener(v.window,"mouseup",this.mouseup)},Do.prototype.mousedown=function(l){this.down(v.extend({},l,{ctrlKey:!0,preventDefault:function(){return l.preventDefault()}}),B.mousePos(this.element,l)),B.addEventListener(v.window,"mousemove",this.mousemove),B.addEventListener(v.window,"mouseup",this.mouseup)},Do.prototype.mousemove=function(l){this.move(l,B.mousePos(this.element,l))},Do.prototype.mouseup=function(l){this.mouseRotate.mouseupWindow(l),this.mousePitch&&this.mousePitch.mouseupWindow(l),this.offTemp()},Do.prototype.touchstart=function(l){l.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=B.touchPos(this.element,l.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return l.preventDefault()}},this._startPos))},Do.prototype.touchmove=function(l){l.targetTouches.length!==1?this.reset():(this._lastPos=B.touchPos(this.element,l.targetTouches)[0],this.move({preventDefault:function(){return l.preventDefault()}},this._lastPos))},Do.prototype.touchend=function(l){l.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},Do.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var bu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function nf(l,f,c){var d=l.classList;for(var E in bu)d.remove("mapboxgl-"+c+"-anchor-"+E);d.add("mapboxgl-"+c+"-anchor-"+f)}var Ll,kl=function(l){function f(c,d){if(l.call(this),(c instanceof v.window.HTMLElement||d)&&(c=v.extend({element:c},d)),v.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=c&&c.anchor||"center",this._color=c&&c.color||"#3FB1CE",this._scale=c&&c.scale||1,this._draggable=c&&c.draggable||!1,this._clickTolerance=c&&c.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=c&&c.rotation||0,this._rotationAlignment=c&&c.rotationAlignment||"auto",this._pitchAlignment=c&&c.pitchAlignment&&c.pitchAlignment!=="auto"?c.pitchAlignment:this._rotationAlignment,c&&c.element)this._element=c.element,this._offset=v.Point.convert(c&&c.offset||[0,0]);else{this._defaultMarker=!0,this._element=B.create("div"),this._element.setAttribute("aria-label","Map marker");var E=B.createNS("http://www.w3.org/2000/svg","svg");E.setAttributeNS(null,"display","block"),E.setAttributeNS(null,"height","41px"),E.setAttributeNS(null,"width","27px"),E.setAttributeNS(null,"viewBox","0 0 27 41");var C=B.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"stroke","none"),C.setAttributeNS(null,"stroke-width","1"),C.setAttributeNS(null,"fill","none"),C.setAttributeNS(null,"fill-rule","evenodd");var T=B.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"fill-rule","nonzero");var L=B.createNS("http://www.w3.org/2000/svg","g");L.setAttributeNS(null,"transform","translate(3.0, 29.0)"),L.setAttributeNS(null,"fill","#000000");for(var Z=0,W=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];Z<W.length;Z+=1){var fe=W[Z],he=B.createNS("http://www.w3.org/2000/svg","ellipse");he.setAttributeNS(null,"opacity","0.04"),he.setAttributeNS(null,"cx","10.5"),he.setAttributeNS(null,"cy","5.80029008"),he.setAttributeNS(null,"rx",fe.rx),he.setAttributeNS(null,"ry",fe.ry),L.appendChild(he)}var de=B.createNS("http://www.w3.org/2000/svg","g");de.setAttributeNS(null,"fill",this._color);var Le=B.createNS("http://www.w3.org/2000/svg","path");Le.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),de.appendChild(Le);var Re=B.createNS("http://www.w3.org/2000/svg","g");Re.setAttributeNS(null,"opacity","0.25"),Re.setAttributeNS(null,"fill","#000000");var Be=B.createNS("http://www.w3.org/2000/svg","path");Be.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Re.appendChild(Be);var Ae=B.createNS("http://www.w3.org/2000/svg","g");Ae.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Ae.setAttributeNS(null,"fill","#FFFFFF");var Ve=B.createNS("http://www.w3.org/2000/svg","g");Ve.setAttributeNS(null,"transform","translate(8.0, 8.0)");var rt=B.createNS("http://www.w3.org/2000/svg","circle");rt.setAttributeNS(null,"fill","#000000"),rt.setAttributeNS(null,"opacity","0.25"),rt.setAttributeNS(null,"cx","5.5"),rt.setAttributeNS(null,"cy","5.5"),rt.setAttributeNS(null,"r","5.4999962");var xt=B.createNS("http://www.w3.org/2000/svg","circle");xt.setAttributeNS(null,"fill","#FFFFFF"),xt.setAttributeNS(null,"cx","5.5"),xt.setAttributeNS(null,"cy","5.5"),xt.setAttributeNS(null,"r","5.4999962"),Ve.appendChild(rt),Ve.appendChild(xt),T.appendChild(L),T.appendChild(de),T.appendChild(Re),T.appendChild(Ae),T.appendChild(Ve),E.appendChild(T),E.setAttributeNS(null,"height",41*this._scale+"px"),E.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(E),this._offset=v.Point.convert(c&&c.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(Wt){Wt.preventDefault()}),this._element.addEventListener("mousedown",function(Wt){Wt.preventDefault()}),nf(this._element,this._anchor,"marker"),this._popup=null}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.addTo=function(c){return this.remove(),this._map=c,c.getCanvasContainer().appendChild(this._element),c.on("move",this._update),c.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},f.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),B.remove(this._element),this._popup&&this._popup.remove(),this},f.prototype.getLngLat=function(){return this._lngLat},f.prototype.setLngLat=function(c){return this._lngLat=v.LngLat.convert(c),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},f.prototype.getElement=function(){return this._element},f.prototype.setPopup=function(c){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),c){if(!("offset"in c.options)){var d=Math.sqrt(Math.pow(13.5,2)/2);c.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[d,-1*(24.6+d)],"bottom-right":[-d,-1*(24.6+d)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=c,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},f.prototype._onKeyPress=function(c){var d=c.code,E=c.charCode||c.keyCode;d!=="Space"&&d!=="Enter"&&E!==32&&E!==13||this.togglePopup()},f.prototype._onMapClick=function(c){var d=c.originalEvent.target,E=this._element;this._popup&&(d===E||E.contains(d))&&this.togglePopup()},f.prototype.getPopup=function(){return this._popup},f.prototype.togglePopup=function(){var c=this._popup;return c?(c.isOpen()?c.remove():c.addTo(this._map),this):this},f.prototype._update=function(c){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=gl(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var d="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?d="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(d="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var E="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?E="rotateX(0deg)":this._pitchAlignment==="map"&&(E="rotateX("+this._map.getPitch()+"deg)"),c&&c.type!=="moveend"||(this._pos=this._pos.round()),B.setTransform(this._element,bu[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+E+" "+d)}},f.prototype.getOffset=function(){return this._offset},f.prototype.setOffset=function(c){return this._offset=v.Point.convert(c),this._update(),this},f.prototype._onMove=function(c){if(!this._isDragging){var d=this._clickTolerance||this._map._clickTolerance;this._isDragging=c.point.dist(this._pointerdownPos)>=d}this._isDragging&&(this._pos=c.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new v.Event("dragstart"))),this.fire(new v.Event("drag")))},f.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new v.Event("dragend")),this._state="inactive"},f.prototype._addDragHandler=function(c){this._element.contains(c.originalEvent.target)&&(c.preventDefault(),this._positionDelta=c.point.sub(this._pos).add(this._offset),this._pointerdownPos=c.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},f.prototype.setDraggable=function(c){return this._draggable=!!c,this._map&&(c?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},f.prototype.isDraggable=function(){return this._draggable},f.prototype.setRotation=function(c){return this._rotation=c||0,this._update(),this},f.prototype.getRotation=function(){return this._rotation},f.prototype.setRotationAlignment=function(c){return this._rotationAlignment=c||"auto",this._update(),this},f.prototype.getRotationAlignment=function(){return this._rotationAlignment},f.prototype.setPitchAlignment=function(c){return this._pitchAlignment=c&&c!=="auto"?c:this._rotationAlignment,this._update(),this},f.prototype.getPitchAlignment=function(){return this._pitchAlignment},f}(v.Evented),Dl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},ec=0,yl=!1,mh=function(l){function f(c){l.call(this),this.options=v.extend({},Dl,c),v.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.onAdd=function(c){var d;return this._map=c,this._container=B.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),d=this._setupUI,Ll!==void 0?d(Ll):v.window.navigator.permissions!==void 0?v.window.navigator.permissions.query({name:"geolocation"}).then(function(E){d(Ll=E.state!=="denied")}):d(Ll=!!v.window.navigator.geolocation),this._container},f.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(v.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),B.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,ec=0,yl=!1},f.prototype._isOutOfMapMaxBounds=function(c){var d=this._map.getMaxBounds(),E=c.coords;return d&&(E.longitude<d.getWest()||E.longitude>d.getEast()||E.latitude<d.getSouth()||E.latitude>d.getNorth())},f.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},f.prototype._onSuccess=function(c){if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new v.Event("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(c),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(c),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new v.Event("geolocate",c)),this._finish()}},f.prototype._updateCamera=function(c){var d=new v.LngLat(c.coords.longitude,c.coords.latitude),E=c.coords.accuracy,C=this._map.getBearing(),T=v.extend({bearing:C},this.options.fitBoundsOptions);this._map.fitBounds(d.toBounds(E),T,{geolocateSource:!0})},f.prototype._updateMarker=function(c){if(c){var d=new v.LngLat(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(d).addTo(this._map),this._userLocationDotMarker.setLngLat(d).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},f.prototype._updateCircleRadius=function(){var c=this._map._container.clientHeight/2,d=this._map.unproject([0,c]),E=this._map.unproject([1,c]),C=d.distanceTo(E),T=Math.ceil(2*this._accuracy/C);this._circleElement.style.width=T+"px",this._circleElement.style.height=T+"px"},f.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},f.prototype._onError=function(c){if(this._map){if(this.options.trackUserLocation)if(c.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(c.code===3&&yl)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new v.Event("error",c)),this._finish()}},f.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},f.prototype._setupUI=function(c){var d=this;if(this._container.addEventListener("contextmenu",function(T){return T.preventDefault()}),this._geolocateButton=B.create("button","mapboxgl-ctrl-geolocate",this._container),B.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",c===!1){v.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var E=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=E,this._geolocateButton.setAttribute("aria-label",E)}else{var C=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=C,this._geolocateButton.setAttribute("aria-label",C)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=B.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new kl(this._dotElement),this._circleElement=B.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new kl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(T){T.geolocateSource||d._watchState!=="ACTIVE_LOCK"||T.originalEvent&&T.originalEvent.type==="resize"||(d._watchState="BACKGROUND",d._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),d._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),d.fire(new v.Event("trackuserlocationend")))})},f.prototype.trigger=function(){if(!this._setup)return v.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new v.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ec--,yl=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new v.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new v.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var c;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++ec>1?(c={maximumAge:6e5,timeout:0},yl=!0):(c=this.options.positionOptions,yl=!1),this._geolocationWatchID=v.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,c)}}else v.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},f.prototype._clearWatch=function(){v.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},f}(v.Evented),el={maxWidth:100,unit:"metric"},Lu=function(l){this.options=v.extend({},el,l),v.bindAll(["_onMove","setUnit"],this)};function Df(l,f,c){var d=c&&c.maxWidth||100,E=l._container.clientHeight/2,C=l.unproject([0,E]),T=l.unproject([d,E]),L=C.distanceTo(T);if(c&&c.unit==="imperial"){var Z=3.2808*L;Z>5280?_l(f,d,Z/5280,l._getUIString("ScaleControl.Miles")):_l(f,d,Z,l._getUIString("ScaleControl.Feet"))}else c&&c.unit==="nautical"?_l(f,d,L/1852,l._getUIString("ScaleControl.NauticalMiles")):L>=1e3?_l(f,d,L/1e3,l._getUIString("ScaleControl.Kilometers")):_l(f,d,L,l._getUIString("ScaleControl.Meters"))}function _l(l,f,c,d){var E,C,T,L=(E=c,(C=Math.pow(10,(""+Math.floor(E)).length-1))*(T=(T=E/C)>=10?10:T>=5?5:T>=3?3:T>=2?2:T>=1?1:function(Z){var W=Math.pow(10,Math.ceil(-Math.log(Z)/Math.LN10));return Math.round(Z*W)/W}(T)));l.style.width=f*(L/c)+"px",l.innerHTML=L+"&nbsp;"+d}Lu.prototype.getDefaultPosition=function(){return"bottom-left"},Lu.prototype._onMove=function(){Df(this._map,this._container,this.options)},Lu.prototype.onAdd=function(l){return this._map=l,this._container=B.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",l.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},Lu.prototype.onRemove=function(){B.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},Lu.prototype.setUnit=function(l){this.options.unit=l,Df(this._map,this._container,this.options)};var eu=function(l){this._fullscreen=!1,l&&l.container&&(l.container instanceof v.window.HTMLElement?this._container=l.container:v.warnOnce("Full screen control 'container' must be a DOM element.")),v.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in v.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in v.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in v.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in v.window.document&&(this._fullscreenchange="MSFullscreenChange")};eu.prototype.onAdd=function(l){return this._map=l,this._container||(this._container=this._map.getContainer()),this._controlContainer=B.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",v.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},eu.prototype.onRemove=function(){B.remove(this._controlContainer),this._map=null,v.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},eu.prototype._checkFullscreenSupport=function(){return!!(v.window.document.fullscreenEnabled||v.window.document.mozFullScreenEnabled||v.window.document.msFullscreenEnabled||v.window.document.webkitFullscreenEnabled)},eu.prototype._setupUI=function(){var l=this._fullscreenButton=B.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);B.create("span","mapboxgl-ctrl-icon",l).setAttribute("aria-hidden",!0),l.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),v.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},eu.prototype._updateTitle=function(){var l=this._getTitle();this._fullscreenButton.setAttribute("aria-label",l),this._fullscreenButton.title=l},eu.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},eu.prototype._isFullscreen=function(){return this._fullscreen},eu.prototype._changeIcon=function(){(v.window.document.fullscreenElement||v.window.document.mozFullScreenElement||v.window.document.webkitFullscreenElement||v.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},eu.prototype._onClickFullscreen=function(){this._isFullscreen()?v.window.document.exitFullscreen?v.window.document.exitFullscreen():v.window.document.mozCancelFullScreen?v.window.document.mozCancelFullScreen():v.window.document.msExitFullscreen?v.window.document.msExitFullscreen():v.window.document.webkitCancelFullScreen&&v.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var af={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Vs=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),gh=function(l){function f(c){l.call(this),this.options=v.extend(Object.create(af),c),v.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.addTo=function(c){return this._map&&this.remove(),this._map=c,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new v.Event("open")),this},f.prototype.isOpen=function(){return!!this._map},f.prototype.remove=function(){return this._content&&B.remove(this._content),this._container&&(B.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new v.Event("close")),this},f.prototype.getLngLat=function(){return this._lngLat},f.prototype.setLngLat=function(c){return this._lngLat=v.LngLat.convert(c),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},f.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},f.prototype.getElement=function(){return this._container},f.prototype.setText=function(c){return this.setDOMContent(v.window.document.createTextNode(c))},f.prototype.setHTML=function(c){var d,E=v.window.document.createDocumentFragment(),C=v.window.document.createElement("body");for(C.innerHTML=c;d=C.firstChild;)E.appendChild(d);return this.setDOMContent(E)},f.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},f.prototype.setMaxWidth=function(c){return this.options.maxWidth=c,this._update(),this},f.prototype.setDOMContent=function(c){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=B.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(c),this._createCloseButton(),this._update(),this._focusFirstElement(),this},f.prototype.addClassName=function(c){this._container&&this._container.classList.add(c)},f.prototype.removeClassName=function(c){this._container&&this._container.classList.remove(c)},f.prototype.setOffset=function(c){return this.options.offset=c,this._update(),this},f.prototype.toggleClassName=function(c){if(this._container)return this._container.classList.toggle(c)},f.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=B.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},f.prototype._onMouseUp=function(c){this._update(c.point)},f.prototype._onMouseMove=function(c){this._update(c.point)},f.prototype._onDrag=function(c){this._update(c.point)},f.prototype._update=function(c){var d=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=B.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=B.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(he){return d._container.classList.add(he)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=gl(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||c)){var E=this._pos=this._trackPointer&&c?c:this._map.project(this._lngLat),C=this.options.anchor,T=function he(de){if(de){if(typeof de=="number"){var Le=Math.round(Math.sqrt(.5*Math.pow(de,2)));return{center:new v.Point(0,0),top:new v.Point(0,de),"top-left":new v.Point(Le,Le),"top-right":new v.Point(-Le,Le),bottom:new v.Point(0,-de),"bottom-left":new v.Point(Le,-Le),"bottom-right":new v.Point(-Le,-Le),left:new v.Point(de,0),right:new v.Point(-de,0)}}if(de instanceof v.Point||Array.isArray(de)){var Re=v.Point.convert(de);return{center:Re,top:Re,"top-left":Re,"top-right":Re,bottom:Re,"bottom-left":Re,"bottom-right":Re,left:Re,right:Re}}return{center:v.Point.convert(de.center||[0,0]),top:v.Point.convert(de.top||[0,0]),"top-left":v.Point.convert(de["top-left"]||[0,0]),"top-right":v.Point.convert(de["top-right"]||[0,0]),bottom:v.Point.convert(de.bottom||[0,0]),"bottom-left":v.Point.convert(de["bottom-left"]||[0,0]),"bottom-right":v.Point.convert(de["bottom-right"]||[0,0]),left:v.Point.convert(de.left||[0,0]),right:v.Point.convert(de.right||[0,0])}}return he(new v.Point(0,0))}(this.options.offset);if(!C){var L,Z=this._container.offsetWidth,W=this._container.offsetHeight;L=E.y+T.bottom.y<W?["top"]:E.y>this._map.transform.height-W?["bottom"]:[],E.x<Z/2?L.push("left"):E.x>this._map.transform.width-Z/2&&L.push("right"),C=L.length===0?"bottom":L.join("-")}var fe=E.add(T[C]).round();B.setTransform(this._container,bu[C]+" translate("+fe.x+"px,"+fe.y+"px)"),nf(this._container,C,"popup")}},f.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var c=this._container.querySelector(Vs);c&&c.focus()}},f.prototype._onClose=function(){this.remove()},f}(v.Evented),tc={version:v.version,supported:te,setRTLTextPlugin:v.setRTLTextPlugin,getRTLTextPluginStatus:v.getRTLTextPluginStatus,Map:Oc,NavigationControl:Qs,GeolocateControl:mh,AttributionControl:ms,ScaleControl:Lu,FullscreenControl:eu,Popup:gh,Marker:kl,Style:ds,LngLat:v.LngLat,LngLatBounds:v.LngLatBounds,Point:v.Point,MercatorCoordinate:v.MercatorCoordinate,Evented:v.Evented,config:v.config,prewarm:function(){Tt().acquire(zt)},clearPrewarmedResources:function(){var l=En;l&&(l.isPreloaded()&&l.numActive()===1?(l.release(zt),En=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return v.config.ACCESS_TOKEN},set accessToken(l){v.config.ACCESS_TOKEN=l},get baseApiUrl(){return v.config.API_URL},set baseApiUrl(l){v.config.API_URL=l},get workerCount(){return gr.workerCount},set workerCount(l){gr.workerCount=l},get maxParallelImageRequests(){return v.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(l){v.config.MAX_PARALLEL_IMAGE_REQUESTS=l},clearStorage:function(l){v.clearTileCache(l)},workerUrl:""};return tc}),Y})},28660:function(Ze,H,R){var Y=R(34155);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var J;(function(v){(function(te){var B=typeof R.g=="object"?R.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),Q=ie(v);typeof B.Reflect=="undefined"?B.Reflect=v:Q=ie(B.Reflect,Q),te(Q);function ie(Ee,re){return function(Ge,Ce){typeof Ee[Ge]!="function"&&Object.defineProperty(Ee,Ge,{configurable:!0,writable:!0,value:Ce}),re&&re(Ge,Ce)}}})(function(te){var B=Object.prototype.hasOwnProperty,Q=typeof Symbol=="function",ie=Q&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",Ee=Q&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",re=typeof Object.create=="function",Ge={__proto__:[]}instanceof Array,Ce=!re&&!Ge,tt={create:re?function(){return fs(Object.create(null))}:Ge?function(){return fs({__proto__:null})}:function(){return fs({})},has:Ce?function(jt,sr){return B.call(jt,sr)}:function(jt,sr){return sr in jt},get:Ce?function(jt,sr){return B.call(jt,sr)?jt[sr]:void 0}:function(jt,sr){return jt[sr]}},Mt=Object.getPrototypeOf(Function),ir=typeof Y=="object"&&{NODE_ENV:"production"}&&{NODE_ENV:"production"}.REFLECT_METADATA_USE_MAP_POLYFILL==="true",bt=!ir&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:ve(),qt=!ir&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Fn(),At=!ir&&typeof WeakMap=="function"?WeakMap:Xa(),ot=new At;function ct(jt,sr,Tr,I){if(hn(Tr)){if(!Ai(jt))throw new TypeError;if(!la(sr))throw new TypeError;return Pr(jt,sr)}else{if(!Ai(jt))throw new TypeError;if(!Xn(sr))throw new TypeError;if(!Xn(I)&&!hn(I)&&!qi(I))throw new TypeError;return qi(I)&&(I=void 0),Tr=Di(Tr),Wr(jt,sr,Tr,I)}}te("decorate",ct);function Qt(jt,sr){function Tr(I,ur){if(!Xn(I))throw new TypeError;if(!hn(ur)&&!wi(ur))throw new TypeError;Ut(jt,sr,I,ur)}return Tr}te("metadata",Qt);function X(jt,sr,Tr,I){if(!Xn(Tr))throw new TypeError;return hn(I)||(I=Di(I)),Ut(jt,sr,Tr,I)}te("defineMetadata",X);function Kt(jt,sr,Tr){if(!Xn(sr))throw new TypeError;return hn(Tr)||(Tr=Di(Tr)),Ye(jt,sr,Tr)}te("hasMetadata",Kt);function vt(jt,sr,Tr){if(!Xn(sr))throw new TypeError;return hn(Tr)||(Tr=Di(Tr)),De(jt,sr,Tr)}te("hasOwnMetadata",vt);function qe(jt,sr,Tr){if(!Xn(sr))throw new TypeError;return hn(Tr)||(Tr=Di(Tr)),wt(jt,sr,Tr)}te("getMetadata",qe);function dt(jt,sr,Tr){if(!Xn(sr))throw new TypeError;return hn(Tr)||(Tr=Di(Tr)),gt(jt,sr,Tr)}te("getOwnMetadata",dt);function $e(jt,sr){if(!Xn(jt))throw new TypeError;return hn(sr)||(sr=Di(sr)),Jt(jt,sr)}te("getMetadataKeys",$e);function kt(jt,sr){if(!Xn(jt))throw new TypeError;return hn(sr)||(sr=Di(sr)),Cr(jt,sr)}te("getOwnMetadataKeys",kt);function yr(jt,sr,Tr){if(!Xn(sr))throw new TypeError;hn(Tr)||(Tr=Di(Tr));var I=Te(sr,Tr,!1);if(hn(I)||!I.delete(jt))return!1;if(I.size>0)return!0;var ur=ot.get(sr);return ur.delete(Tr),ur.size>0||ot.delete(sr),!0}te("deleteMetadata",yr);function Pr(jt,sr){for(var Tr=jt.length-1;Tr>=0;--Tr){var I=jt[Tr],ur=I(sr);if(!hn(ur)&&!qi(ur)){if(!la(ur))throw new TypeError;sr=ur}}return sr}function Wr(jt,sr,Tr,I){for(var ur=jt.length-1;ur>=0;--ur){var Ln=jt[ur],ci=Ln(sr,Tr,I);if(!hn(ci)&&!qi(ci)){if(!Xn(ci))throw new TypeError;I=ci}}return I}function Te(jt,sr,Tr){var I=ot.get(jt);if(hn(I)){if(!Tr)return;I=new bt,ot.set(jt,I)}var ur=I.get(sr);if(hn(ur)){if(!Tr)return;ur=new bt,I.set(sr,ur)}return ur}function Ye(jt,sr,Tr){var I=De(jt,sr,Tr);if(I)return!0;var ur=Wa(sr);return qi(ur)?!1:Ye(jt,ur,Tr)}function De(jt,sr,Tr){var I=Te(sr,Tr,!1);return hn(I)?!1:li(I.has(jt))}function wt(jt,sr,Tr){var I=De(jt,sr,Tr);if(I)return gt(jt,sr,Tr);var ur=Wa(sr);if(!qi(ur))return wt(jt,ur,Tr)}function gt(jt,sr,Tr){var I=Te(sr,Tr,!1);if(!hn(I))return I.get(jt)}function Ut(jt,sr,Tr,I){var ur=Te(Tr,I,!0);ur.set(jt,sr)}function Jt(jt,sr){var Tr=Cr(jt,sr),I=Wa(jt);if(I===null)return Tr;var ur=Jt(I,sr);if(ur.length<=0)return Tr;if(Tr.length<=0)return ur;for(var Ln=new qt,ci=[],Gn=0,rn=Tr;Gn<rn.length;Gn++){var Pi=rn[Gn],Ii=Ln.has(Pi);Ii||(Ln.add(Pi),ci.push(Pi))}for(var Ja=0,hs=ur;Ja<hs.length;Ja++){var Pi=hs[Ja],Ii=Ln.has(Pi);Ii||(Ln.add(Pi),ci.push(Pi))}return ci}function Cr(jt,sr){var Tr=[],I=Te(jt,sr,!1);if(hn(I))return Tr;for(var ur=I.keys(),Ln=Mn(ur),ci=0;;){var Gn=ji(Ln);if(!Gn)return Tr.length=ci,Tr;var rn=Si(Gn);try{Tr[ci]=rn}catch(Pi){try{Ki(Ln)}finally{throw Pi}}ci++}}function Yn(jt){if(jt===null)return 1;switch(typeof jt){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return jt===null?1:6;default:return 6}}function hn(jt){return jt===void 0}function qi(jt){return jt===null}function jn(jt){return typeof jt=="symbol"}function Xn(jt){return typeof jt=="object"?jt!==null:typeof jt=="function"}function vi(jt,sr){switch(Yn(jt)){case 0:return jt;case 1:return jt;case 2:return jt;case 3:return jt;case 4:return jt;case 5:return jt}var Tr=sr===3?"string":sr===5?"number":"default",I=Sa(jt,ie);if(I!==void 0){var ur=I.call(jt,Tr);if(Xn(ur))throw new TypeError;return ur}return qn(jt,Tr==="default"?"number":Tr)}function qn(jt,sr){if(sr==="string"){var Tr=jt.toString;if(Vi(Tr)){var I=Tr.call(jt);if(!Xn(I))return I}var ur=jt.valueOf;if(Vi(ur)){var I=ur.call(jt);if(!Xn(I))return I}}else{var ur=jt.valueOf;if(Vi(ur)){var I=ur.call(jt);if(!Xn(I))return I}var Ln=jt.toString;if(Vi(Ln)){var I=Ln.call(jt);if(!Xn(I))return I}}throw new TypeError}function li(jt){return!!jt}function aa(jt){return""+jt}function Di(jt){var sr=vi(jt,3);return jn(sr)?sr:aa(sr)}function Ai(jt){return Array.isArray?Array.isArray(jt):jt instanceof Object?jt instanceof Array:Object.prototype.toString.call(jt)==="[object Array]"}function Vi(jt){return typeof jt=="function"}function la(jt){return typeof jt=="function"}function wi(jt){switch(Yn(jt)){case 3:return!0;case 4:return!0;default:return!1}}function Sa(jt,sr){var Tr=jt[sr];if(Tr!=null){if(!Vi(Tr))throw new TypeError;return Tr}}function Mn(jt){var sr=Sa(jt,Ee);if(!Vi(sr))throw new TypeError;var Tr=sr.call(jt);if(!Xn(Tr))throw new TypeError;return Tr}function Si(jt){return jt.value}function ji(jt){var sr=jt.next();return sr.done?!1:sr}function Ki(jt){var sr=jt.return;sr&&sr.call(jt)}function Wa(jt){var sr=Object.getPrototypeOf(jt);if(typeof jt!="function"||jt===Mt||sr!==Mt)return sr;var Tr=jt.prototype,I=Tr&&Object.getPrototypeOf(Tr);if(I==null||I===Object.prototype)return sr;var ur=I.constructor;return typeof ur!="function"||ur===jt?sr:ur}function ve(){var jt={},sr=[],Tr=function(){function ci(Gn,rn,Pi){this._index=0,this._keys=Gn,this._values=rn,this._selector=Pi}return ci.prototype["@@iterator"]=function(){return this},ci.prototype[Ee]=function(){return this},ci.prototype.next=function(){var Gn=this._index;if(Gn>=0&&Gn<this._keys.length){var rn=this._selector(this._keys[Gn],this._values[Gn]);return Gn+1>=this._keys.length?(this._index=-1,this._keys=sr,this._values=sr):this._index++,{value:rn,done:!1}}return{value:void 0,done:!0}},ci.prototype.throw=function(Gn){throw this._index>=0&&(this._index=-1,this._keys=sr,this._values=sr),Gn},ci.prototype.return=function(Gn){return this._index>=0&&(this._index=-1,this._keys=sr,this._values=sr),{value:Gn,done:!0}},ci}();return function(){function ci(){this._keys=[],this._values=[],this._cacheKey=jt,this._cacheIndex=-2}return Object.defineProperty(ci.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),ci.prototype.has=function(Gn){return this._find(Gn,!1)>=0},ci.prototype.get=function(Gn){var rn=this._find(Gn,!1);return rn>=0?this._values[rn]:void 0},ci.prototype.set=function(Gn,rn){var Pi=this._find(Gn,!0);return this._values[Pi]=rn,this},ci.prototype.delete=function(Gn){var rn=this._find(Gn,!1);if(rn>=0){for(var Pi=this._keys.length,Ii=rn+1;Ii<Pi;Ii++)this._keys[Ii-1]=this._keys[Ii],this._values[Ii-1]=this._values[Ii];return this._keys.length--,this._values.length--,Gn===this._cacheKey&&(this._cacheKey=jt,this._cacheIndex=-2),!0}return!1},ci.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=jt,this._cacheIndex=-2},ci.prototype.keys=function(){return new Tr(this._keys,this._values,I)},ci.prototype.values=function(){return new Tr(this._keys,this._values,ur)},ci.prototype.entries=function(){return new Tr(this._keys,this._values,Ln)},ci.prototype["@@iterator"]=function(){return this.entries()},ci.prototype[Ee]=function(){return this.entries()},ci.prototype._find=function(Gn,rn){return this._cacheKey!==Gn&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=Gn)),this._cacheIndex<0&&rn&&(this._cacheIndex=this._keys.length,this._keys.push(Gn),this._values.push(void 0)),this._cacheIndex},ci}();function I(ci,Gn){return ci}function ur(ci,Gn){return Gn}function Ln(ci,Gn){return[ci,Gn]}}function Fn(){return function(){function jt(){this._map=new bt}return Object.defineProperty(jt.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),jt.prototype.has=function(sr){return this._map.has(sr)},jt.prototype.add=function(sr){return this._map.set(sr,sr),this},jt.prototype.delete=function(sr){return this._map.delete(sr)},jt.prototype.clear=function(){this._map.clear()},jt.prototype.keys=function(){return this._map.keys()},jt.prototype.values=function(){return this._map.values()},jt.prototype.entries=function(){return this._map.entries()},jt.prototype["@@iterator"]=function(){return this.keys()},jt.prototype[Ee]=function(){return this.keys()},jt}()}function Xa(){var jt=16,sr=tt.create(),Tr=I();return function(){function rn(){this._key=I()}return rn.prototype.has=function(Pi){var Ii=ur(Pi,!1);return Ii!==void 0?tt.has(Ii,this._key):!1},rn.prototype.get=function(Pi){var Ii=ur(Pi,!1);return Ii!==void 0?tt.get(Ii,this._key):void 0},rn.prototype.set=function(Pi,Ii){var Ja=ur(Pi,!0);return Ja[this._key]=Ii,this},rn.prototype.delete=function(Pi){var Ii=ur(Pi,!1);return Ii!==void 0?delete Ii[this._key]:!1},rn.prototype.clear=function(){this._key=I()},rn}();function I(){var rn;do rn="@@WeakMap@@"+Gn();while(tt.has(sr,rn));return sr[rn]=!0,rn}function ur(rn,Pi){if(!B.call(rn,Tr)){if(!Pi)return;Object.defineProperty(rn,Tr,{value:tt.create()})}return rn[Tr]}function Ln(rn,Pi){for(var Ii=0;Ii<Pi;++Ii)rn[Ii]=Math.random()*255|0;return rn}function ci(rn){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(rn)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(rn)):Ln(new Uint8Array(rn),rn):Ln(new Array(rn),rn)}function Gn(){var rn=ci(jt);rn[6]=rn[6]&79|64,rn[8]=rn[8]&191|128;for(var Pi="",Ii=0;Ii<jt;++Ii){var Ja=rn[Ii];(Ii===4||Ii===6||Ii===8)&&(Pi+="-"),Ja<16&&(Pi+="0"),Pi+=Ja.toString(16).toLowerCase()}return Pi}}function fs(jt){return jt.__=void 0,delete jt.__,jt}})})(J||(J={}))},69848:function(Ze){(function(H,R){Ze.exports=R()})(this,function(){"use strict";function H(vt,qe,dt,$e,kt,yr){if(!(kt-$e<=dt)){var Pr=$e+kt>>1;R(vt,qe,Pr,$e,kt,yr%2),H(vt,qe,dt,$e,Pr-1,yr+1),H(vt,qe,dt,Pr+1,kt,yr+1)}}function R(vt,qe,dt,$e,kt,yr){for(;kt>$e;){if(kt-$e>600){var Pr=kt-$e+1,Wr=dt-$e+1,Te=Math.log(Pr),Ye=.5*Math.exp(2*Te/3),De=.5*Math.sqrt(Te*Ye*(Pr-Ye)/Pr)*(Wr-Pr/2<0?-1:1),wt=Math.max($e,Math.floor(dt-Wr*Ye/Pr+De)),gt=Math.min(kt,Math.floor(dt+(Pr-Wr)*Ye/Pr+De));R(vt,qe,dt,wt,gt,yr)}var Ut=qe[2*dt+yr],Jt=$e,Cr=kt;for(Y(vt,qe,$e,dt),qe[2*kt+yr]>Ut&&Y(vt,qe,$e,kt);Jt<Cr;){for(Y(vt,qe,Jt,Cr),Jt++,Cr--;qe[2*Jt+yr]<Ut;)Jt++;for(;qe[2*Cr+yr]>Ut;)Cr--}qe[2*$e+yr]===Ut?Y(vt,qe,$e,Cr):(Cr++,Y(vt,qe,Cr,kt)),Cr<=dt&&($e=Cr+1),dt<=Cr&&(kt=Cr-1)}}function Y(vt,qe,dt,$e){J(vt,dt,$e),J(qe,2*dt,2*$e),J(qe,2*dt+1,2*$e+1)}function J(vt,qe,dt){var $e=vt[qe];vt[qe]=vt[dt],vt[dt]=$e}function v(vt,qe,dt,$e,kt,yr,Pr){for(var Wr=[0,vt.length-1,0],Te=[],Ye,De;Wr.length;){var wt=Wr.pop(),gt=Wr.pop(),Ut=Wr.pop();if(gt-Ut<=Pr){for(var Jt=Ut;Jt<=gt;Jt++)Ye=qe[2*Jt],De=qe[2*Jt+1],Ye>=dt&&Ye<=kt&&De>=$e&&De<=yr&&Te.push(vt[Jt]);continue}var Cr=Math.floor((Ut+gt)/2);Ye=qe[2*Cr],De=qe[2*Cr+1],Ye>=dt&&Ye<=kt&&De>=$e&&De<=yr&&Te.push(vt[Cr]);var Yn=(wt+1)%2;(wt===0?dt<=Ye:$e<=De)&&(Wr.push(Ut),Wr.push(Cr-1),Wr.push(Yn)),(wt===0?kt>=Ye:yr>=De)&&(Wr.push(Cr+1),Wr.push(gt),Wr.push(Yn))}return Te}function te(vt,qe,dt,$e,kt,yr){for(var Pr=[0,vt.length-1,0],Wr=[],Te=kt*kt;Pr.length;){var Ye=Pr.pop(),De=Pr.pop(),wt=Pr.pop();if(De-wt<=yr){for(var gt=wt;gt<=De;gt++)B(qe[2*gt],qe[2*gt+1],dt,$e)<=Te&&Wr.push(vt[gt]);continue}var Ut=Math.floor((wt+De)/2),Jt=qe[2*Ut],Cr=qe[2*Ut+1];B(Jt,Cr,dt,$e)<=Te&&Wr.push(vt[Ut]);var Yn=(Ye+1)%2;(Ye===0?dt-kt<=Jt:$e-kt<=Cr)&&(Pr.push(wt),Pr.push(Ut-1),Pr.push(Yn)),(Ye===0?dt+kt>=Jt:$e+kt>=Cr)&&(Pr.push(Ut+1),Pr.push(De),Pr.push(Yn))}return Wr}function B(vt,qe,dt,$e){var kt=vt-dt,yr=qe-$e;return kt*kt+yr*yr}var Q=function(vt){return vt[0]},ie=function(vt){return vt[1]},Ee=function(qe,dt,$e,kt,yr){dt===void 0&&(dt=Q),$e===void 0&&($e=ie),kt===void 0&&(kt=64),yr===void 0&&(yr=Float64Array),this.nodeSize=kt,this.points=qe;for(var Pr=qe.length<65536?Uint16Array:Uint32Array,Wr=this.ids=new Pr(qe.length),Te=this.coords=new yr(qe.length*2),Ye=0;Ye<qe.length;Ye++)Wr[Ye]=Ye,Te[2*Ye]=dt(qe[Ye]),Te[2*Ye+1]=$e(qe[Ye]);H(Wr,Te,kt,0,Wr.length-1,0)};Ee.prototype.range=function(qe,dt,$e,kt){return v(this.ids,this.coords,qe,dt,$e,kt,this.nodeSize)},Ee.prototype.within=function(qe,dt,$e){return te(this.ids,this.coords,qe,dt,$e,this.nodeSize)};var re={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(vt){return vt}},Ge=Math.fround||function(vt){return function(qe){return vt[0]=+qe,vt[0]}}(new Float32Array(1)),Ce=function(qe){this.options=Qt(Object.create(re),qe),this.trees=new Array(this.options.maxZoom+1)};Ce.prototype.load=function(qe){var dt=this.options,$e=dt.log,kt=dt.minZoom,yr=dt.maxZoom,Pr=dt.nodeSize;$e&&console.time("total time");var Wr="prepare "+qe.length+" points";$e&&console.time(Wr),this.points=qe;for(var Te=[],Ye=0;Ye<qe.length;Ye++)!qe[Ye].geometry||Te.push(Mt(qe[Ye],Ye));this.trees[yr+1]=new Ee(Te,X,Kt,Pr,Float32Array),$e&&console.timeEnd(Wr);for(var De=yr;De>=kt;De--){var wt=+Date.now();Te=this._cluster(Te,De),this.trees[De]=new Ee(Te,X,Kt,Pr,Float32Array),$e&&console.log("z%d: %d clusters in %dms",De,Te.length,+Date.now()-wt)}return $e&&console.timeEnd("total time"),this},Ce.prototype.getClusters=function(qe,dt){var $e=((qe[0]+180)%360+360)%360-180,kt=Math.max(-90,Math.min(90,qe[1])),yr=qe[2]===180?180:((qe[2]+180)%360+360)%360-180,Pr=Math.max(-90,Math.min(90,qe[3]));if(qe[2]-qe[0]>=360)$e=-180,yr=180;else if($e>yr){var Wr=this.getClusters([$e,kt,180,Pr],dt),Te=this.getClusters([-180,kt,yr,Pr],dt);return Wr.concat(Te)}for(var Ye=this.trees[this._limitZoom(dt)],De=Ye.range(qt($e),At(Pr),qt(yr),At(kt)),wt=[],gt=0,Ut=De;gt<Ut.length;gt+=1){var Jt=Ut[gt],Cr=Ye.points[Jt];wt.push(Cr.numPoints?ir(Cr):this.points[Cr.index])}return wt},Ce.prototype.getChildren=function(qe){var dt=this._getOriginId(qe),$e=this._getOriginZoom(qe),kt="No cluster with the specified id.",yr=this.trees[$e];if(!yr)throw new Error(kt);var Pr=yr.points[dt];if(!Pr)throw new Error(kt);for(var Wr=this.options.radius/(this.options.extent*Math.pow(2,$e-1)),Te=yr.within(Pr.x,Pr.y,Wr),Ye=[],De=0,wt=Te;De<wt.length;De+=1){var gt=wt[De],Ut=yr.points[gt];Ut.parentId===qe&&Ye.push(Ut.numPoints?ir(Ut):this.points[Ut.index])}if(Ye.length===0)throw new Error(kt);return Ye},Ce.prototype.getLeaves=function(qe,dt,$e){dt=dt||10,$e=$e||0;var kt=[];return this._appendLeaves(kt,qe,dt,$e,0),kt},Ce.prototype.getTile=function(qe,dt,$e){var kt=this.trees[this._limitZoom(qe)],yr=Math.pow(2,qe),Pr=this.options,Wr=Pr.extent,Te=Pr.radius,Ye=Te/Wr,De=($e-Ye)/yr,wt=($e+1+Ye)/yr,gt={features:[]};return this._addTileFeatures(kt.range((dt-Ye)/yr,De,(dt+1+Ye)/yr,wt),kt.points,dt,$e,yr,gt),dt===0&&this._addTileFeatures(kt.range(1-Ye/yr,De,1,wt),kt.points,yr,$e,yr,gt),dt===yr-1&&this._addTileFeatures(kt.range(0,De,Ye/yr,wt),kt.points,-1,$e,yr,gt),gt.features.length?gt:null},Ce.prototype.getClusterExpansionZoom=function(qe){for(var dt=this._getOriginZoom(qe)-1;dt<=this.options.maxZoom;){var $e=this.getChildren(qe);if(dt++,$e.length!==1)break;qe=$e[0].properties.cluster_id}return dt},Ce.prototype._appendLeaves=function(qe,dt,$e,kt,yr){for(var Pr=this.getChildren(dt),Wr=0,Te=Pr;Wr<Te.length;Wr+=1){var Ye=Te[Wr],De=Ye.properties;if(De&&De.cluster?yr+De.point_count<=kt?yr+=De.point_count:yr=this._appendLeaves(qe,De.cluster_id,$e,kt,yr):yr<kt?yr++:qe.push(Ye),qe.length===$e)break}return yr},Ce.prototype._addTileFeatures=function(qe,dt,$e,kt,yr,Pr){for(var Wr=0,Te=qe;Wr<Te.length;Wr+=1){var Ye=Te[Wr],De=dt[Ye],wt=De.numPoints,gt=void 0,Ut=void 0,Jt=void 0;if(wt)gt=bt(De),Ut=De.x,Jt=De.y;else{var Cr=this.points[De.index];gt=Cr.properties,Ut=qt(Cr.geometry.coordinates[0]),Jt=At(Cr.geometry.coordinates[1])}var Yn={type:1,geometry:[[Math.round(this.options.extent*(Ut*yr-$e)),Math.round(this.options.extent*(Jt*yr-kt))]],tags:gt},hn=void 0;wt?hn=De.id:this.options.generateId?hn=De.index:this.points[De.index].id&&(hn=this.points[De.index].id),hn!==void 0&&(Yn.id=hn),Pr.features.push(Yn)}},Ce.prototype._limitZoom=function(qe){return Math.max(this.options.minZoom,Math.min(+qe,this.options.maxZoom+1))},Ce.prototype._cluster=function(qe,dt){for(var $e=[],kt=this.options,yr=kt.radius,Pr=kt.extent,Wr=kt.reduce,Te=kt.minPoints,Ye=yr/(Pr*Math.pow(2,dt)),De=0;De<qe.length;De++){var wt=qe[De];if(!(wt.zoom<=dt)){wt.zoom=dt;for(var gt=this.trees[dt+1],Ut=gt.within(wt.x,wt.y,Ye),Jt=wt.numPoints||1,Cr=Jt,Yn=0,hn=Ut;Yn<hn.length;Yn+=1){var qi=hn[Yn],jn=gt.points[qi];jn.zoom>dt&&(Cr+=jn.numPoints||1)}if(Cr>Jt&&Cr>=Te){for(var Xn=wt.x*Jt,vi=wt.y*Jt,qn=Wr&&Jt>1?this._map(wt,!0):null,li=(De<<5)+(dt+1)+this.points.length,aa=0,Di=Ut;aa<Di.length;aa+=1){var Ai=Di[aa],Vi=gt.points[Ai];if(!(Vi.zoom<=dt)){Vi.zoom=dt;var la=Vi.numPoints||1;Xn+=Vi.x*la,vi+=Vi.y*la,Vi.parentId=li,Wr&&(qn||(qn=this._map(wt,!0)),Wr(qn,this._map(Vi)))}}wt.parentId=li,$e.push(tt(Xn/Cr,vi/Cr,li,Cr,qn))}else if($e.push(wt),Cr>1)for(var wi=0,Sa=Ut;wi<Sa.length;wi+=1){var Mn=Sa[wi],Si=gt.points[Mn];Si.zoom<=dt||(Si.zoom=dt,$e.push(Si))}}}return $e},Ce.prototype._getOriginId=function(qe){return qe-this.points.length>>5},Ce.prototype._getOriginZoom=function(qe){return(qe-this.points.length)%32},Ce.prototype._map=function(qe,dt){if(qe.numPoints)return dt?Qt({},qe.properties):qe.properties;var $e=this.points[qe.index].properties,kt=this.options.map($e);return dt&&kt===$e?Qt({},kt):kt};function tt(vt,qe,dt,$e,kt){return{x:Ge(vt),y:Ge(qe),zoom:Infinity,id:dt,parentId:-1,numPoints:$e,properties:kt}}function Mt(vt,qe){var dt=vt.geometry.coordinates,$e=dt[0],kt=dt[1];return{x:Ge(qt($e)),y:Ge(At(kt)),zoom:Infinity,index:qe,parentId:-1}}function ir(vt){return{type:"Feature",id:vt.id,properties:bt(vt),geometry:{type:"Point",coordinates:[ot(vt.x),ct(vt.y)]}}}function bt(vt){var qe=vt.numPoints,dt=qe>=1e4?Math.round(qe/1e3)+"k":qe>=1e3?Math.round(qe/100)/10+"k":qe;return Qt(Qt({},vt.properties),{cluster:!0,cluster_id:vt.id,point_count:qe,point_count_abbreviated:dt})}function qt(vt){return vt/360+.5}function At(vt){var qe=Math.sin(vt*Math.PI/180),dt=.5-.25*Math.log((1+qe)/(1-qe))/Math.PI;return dt<0?0:dt>1?1:dt}function ot(vt){return(vt-.5)*360}function ct(vt){var qe=(180-vt*360)*Math.PI/180;return 360*Math.atan(Math.exp(qe))/Math.PI-90}function Qt(vt,qe){for(var dt in qe)vt[dt]=qe[dt];return vt}function X(vt){return vt.x}function Kt(vt){return vt.y}return Ce})},75752:function(Ze){Ze.exports.RADIUS=6378137,Ze.exports.FLATTENING=1/298.257223563,Ze.exports.POLAR_RADIUS=63567523142e-4}}]);
